var _=Object.defineProperty;var z=(p,t,r)=>t in p?_(p,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):p[t]=r;var o=(p,t,r)=>z(p,typeof t!="symbol"?t+"":t,r);import{G as M,a8 as B,N as R,a as d,a9 as U,M as f,n as w,y as b,J as v,z as E,o as I,K as A,ah as g,ai as F,aj as T}from"./three-DBvJLP14.js";class k{constructor(t,r){o(this,"scene");o(this,"spaceship");o(this,"startPortalGroup");o(this,"exitPortalGroup");o(this,"startPortalBox");o(this,"exitPortalBox");o(this,"startPortalParticleSystem");o(this,"exitPortalParticleSystem");o(this,"shouldCreateStartPortal");o(this,"refUrl");o(this,"_isRedirecting");var s;this.scene=t,this.spaceship=r,this.startPortalGroup=null,this.exitPortalGroup=null,this.startPortalBox=null,this.exitPortalBox=null,this.startPortalParticleSystem=null,this.exitPortalParticleSystem=null;const e=((s=window.location)==null?void 0:s.search)||"";this.shouldCreateStartPortal=new URLSearchParams(e).has("portal"),this.refUrl=new URLSearchParams(e).get("ref")||"",this.init()}init(){this.shouldCreateStartPortal&&this.createStartPortal()}createStartPortal(){this.startPortalGroup=new M,this.startPortalGroup.name="startPortal";const t=new B(150,15,32,100),r=new R({color:16711680,emissive:16711680,emissiveIntensity:.5,roughness:.3,metalness:.7}),e=new d(t,r);this.startPortalGroup.add(e);const s=new U(135,32),n=new f({color:16711680,transparent:!0,opacity:.3,side:w}),l=new d(s,n);l.position.z=.1,this.startPortalGroup.add(l);const h=500,u=new b,c=new Float32Array(h*3);for(let a=0;a<h;a++){const i=a/h*Math.PI*2,m=135+(Math.random()*30-15);c[a*3]=Math.cos(i)*m,c[a*3+1]=Math.sin(i)*m,c[a*3+2]=(Math.random()-.5)*15}u.setAttribute("position",new v(c,3));const x=new E({color:16733525,size:3.5,blending:I,transparent:!0});this.startPortalParticleSystem=new A(u,x),this.startPortalGroup.add(this.startPortalParticleSystem),this.startPortalGroup.position.set(0,15e3,0),this.startPortalGroup.rotation.x=Math.PI/2,this.scene.add(this.startPortalGroup),this.startPortalBox=new g().setFromObject(this.startPortalGroup),console.log("Start portal created at position:",this.startPortalGroup.position)}createExitPortal(){this.exitPortalGroup=new M,this.exitPortalGroup.name="exitPortal";const t=new B(150,15,32,100),r=new R({color:65280,emissive:65280,emissiveIntensity:.5,roughness:.3,metalness:.7}),e=new d(t,r);this.exitPortalGroup.add(e);const s=new U(135,32),n=new f({color:65280,transparent:!0,opacity:.3,side:w}),l=new d(s,n);l.position.z=.1,this.exitPortalGroup.add(l);const h=500,u=new b,c=new Float32Array(h*3);for(let P=0;P<h;P++){const y=P/h*Math.PI*2,S=135+(Math.random()*30-15);c[P*3]=Math.cos(y)*S,c[P*3+1]=Math.sin(y)*S,c[P*3+2]=(Math.random()-.5)*15}u.setAttribute("position",new v(c,3));const x=new E({color:5635925,size:3.5,blending:I,transparent:!0});this.exitPortalParticleSystem=new A(u,x),this.exitPortalGroup.add(this.exitPortalParticleSystem);const a=document.createElement("canvas");a.width=1024,a.height=256;const i=a.getContext("2d");i&&(i.fillStyle="black",i.fillRect(0,0,a.width,a.height),i.font="72px Arial",i.fillStyle="#00ff00",i.textAlign="center",i.textBaseline="middle",i.fillText("VIBEVERSE PORTAL",a.width/2,a.height/2));const m=new F(a),L=new T(200,50),C=new f({map:m,transparent:!0,side:w}),G=new d(L,C);G.position.set(0,200,0),this.exitPortalGroup.add(G),this.exitPortalGroup.position.set(0,16e3,0),this.exitPortalGroup.rotation.x=Math.PI/2,this.scene.add(this.exitPortalGroup),this.exitPortalBox=new g().setFromObject(this.exitPortalGroup),console.log("Exit portal created at position:",this.exitPortalGroup.position)}animateStartPortal(t){!this.startPortalGroup||!this.startPortalParticleSystem||!this.startPortalBox||(this.startPortalParticleSystem.rotation.z+=t*.5,Math.random()<.05&&this.startPortalBox.setFromObject(this.startPortalGroup))}animateExitPortal(t){!this.exitPortalGroup||!this.exitPortalParticleSystem||!this.exitPortalBox||(this.exitPortalParticleSystem.rotation.z+=t*.5,Math.random()<.05&&this.exitPortalBox.setFromObject(this.exitPortalGroup))}checkPortalInteractions(t){if(!this.spaceship||!this.spaceship.mesh)return;const r=new g().setFromObject(this.spaceship.mesh);this.startPortalGroup&&this.startPortalBox&&this.spaceship.mesh.position.distanceTo(this.startPortalGroup.position)<400&&r.intersectsBox(this.startPortalBox)&&this.handleStartPortalEntry()}handleStartPortalEntry(){var s;if(this._isRedirecting)return;this._isRedirecting=!0,console.log("Player entered start portal");let t=this.refUrl;if(t&&!t.startsWith("http")&&(t="https://"+t),!t){console.error("No target URL specified for portal"),this._isRedirecting=!1;return}const r=new URLSearchParams(((s=window.location)==null?void 0:s.search)||"");r.delete("ref"),r.delete("portal");let e;try{e=new URL(t);for(const[n,l]of r.entries())e.searchParams.append(n,l)}catch{console.error("Invalid target URL:",t),this._isRedirecting=!1;return}console.log("Redirecting to:",e.toString()),setTimeout(()=>{window.location.href=e.toString()},100)}handleExitPortalEntry(){var s;if(this._isRedirecting)return;this._isRedirecting=!0,console.log("Player entered exit portal");const t="https://portal.pieter.com",r=new URLSearchParams(((s=window.location)==null?void 0:s.search)||""),e=new URL(t);e.searchParams.append("portal","true"),e.searchParams.append("username",this.getUsername()),e.searchParams.append("color","white"),e.searchParams.append("speed",this.getPlayerSpeed());for(const[n,l]of r.entries())["portal","username","color","speed"].includes(n)||e.searchParams.append(n,l);console.log("Redirecting to:",e.toString()),setTimeout(()=>{window.location.href=e.toString()},100)}getUsername(){const t=window.game;return t&&t.selfUsername?t.selfUsername:`Miner${Math.floor(Math.random()*1e4)}`}getPlayerSpeed(){const t=window.game;return t&&t.currentSpeed?t.currentSpeed.toString():this.spaceship&&this.spaceship.velocity?this.spaceship.velocity.length().toString():"10"}update(t){this.animateStartPortal(t),this.checkPortalInteractions(t)}dispose(){this.startPortalGroup&&this.scene.remove(this.startPortalGroup),this.exitPortalGroup&&this.scene.remove(this.exitPortalGroup),this.startPortalGroup=null,this.exitPortalGroup=null,this.startPortalBox=null,this.exitPortalBox=null,this.startPortalParticleSystem=null,this.exitPortalParticleSystem=null}}export{k as VibeVersePortals};
//# sourceMappingURL=vibeVersePortals-CvNQUYkr.js.map
