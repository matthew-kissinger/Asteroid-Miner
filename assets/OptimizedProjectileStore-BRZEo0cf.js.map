{"version":3,"file":"OptimizedProjectileStore-BRZEo0cf.js","sources":["../../js/core/optimized/OptimizedProjectileStore.ts"],"sourcesContent":["// OptimizedProjectileStore.ts - TypedArray-backed projectile data\n\nexport class OptimizedProjectileStore {\n    public capacity: number;\n    public count: number;\n    public pos: Float32Array;\n    public vel: Float32Array;\n    public alive: Uint8Array;\n    public idToIndex: Map<any, number>;\n    public indexToProjectile: any[];\n\n    constructor(capacity: number = 2048) {\n        this.capacity = capacity;\n        this.count = 0;\n        this.pos = new Float32Array(capacity * 3);\n        this.vel = new Float32Array(capacity * 3);\n        this.alive = new Uint8Array(capacity);\n        this.idToIndex = new Map();\n        this.indexToProjectile = new Array(capacity);\n    }\n\n    private _allocIndex(): number {\n        if (this.count >= this.capacity) return -1;\n        const idx = this.count++;\n        return idx;\n    }\n\n    public register(projectile: any): number {\n        const idx = this._allocIndex();\n        if (idx === -1) return -1;\n        this.idToIndex.set(projectile.uuid || projectile.id || idx, idx);\n        this.indexToProjectile[idx] = projectile;\n        this.alive[idx] = 1;\n        // initialize from projectile\n        const p = projectile.position;\n        if (p) {\n            this.pos[idx * 3 + 0] = p.x;\n            this.pos[idx * 3 + 1] = p.y;\n            this.pos[idx * 3 + 2] = p.z;\n        }\n        const v = projectile.velocity || { x: 0, y: 0, z: 0 };\n        this.vel[idx * 3 + 0] = v.x;\n        this.vel[idx * 3 + 1] = v.y;\n        this.vel[idx * 3 + 2] = v.z;\n        return idx;\n    }\n\n    public unregisterByIndex(idx: number): void {\n        if (idx < 0 || idx >= this.count) return;\n        this.alive[idx] = 0;\n        this.indexToProjectile[idx] = null;\n    }\n\n    public unregister(projectile: any): void {\n        const id = projectile.uuid || projectile.id;\n        if (id == null) return;\n        const idx = this.idToIndex.get(id);\n        if (idx == null) return;\n        this.alive[idx] = 0;\n        this.indexToProjectile[idx] = null;\n        this.idToIndex.delete(id);\n    }\n\n    public update(dt: number): void {\n        const n = this.count;\n        for (let i = 0; i < n; i++) {\n            if (!this.alive[i]) continue;\n            const pi = i * 3;\n            this.pos[pi + 0] += this.vel[pi + 0] * dt;\n            this.pos[pi + 1] += this.vel[pi + 1] * dt;\n            this.pos[pi + 2] += this.vel[pi + 2] * dt;\n            const proj = this.indexToProjectile[i];\n            if (proj && proj.position && proj.position.set) {\n                proj.position.set(this.pos[pi + 0], this.pos[pi + 1], this.pos[pi + 2]);\n            }\n        }\n    }\n}\n"],"names":["OptimizedProjectileStore","capacity","__publicField","projectile","idx","p","v","id","dt","n","i","pi","proj"],"mappings":"oKAEO,MAAMA,CAAyB,CASlC,YAAYC,EAAmB,KAAM,CAR9BC,EAAA,iBACAA,EAAA,cACAA,EAAA,YACAA,EAAA,YACAA,EAAA,cACAA,EAAA,kBACAA,EAAA,0BAGH,KAAK,SAAWD,EAChB,KAAK,MAAQ,EACb,KAAK,IAAM,IAAI,aAAaA,EAAW,CAAC,EACxC,KAAK,IAAM,IAAI,aAAaA,EAAW,CAAC,EACnC,KAAA,MAAQ,IAAI,WAAWA,CAAQ,EAC/B,KAAA,cAAgB,IAChB,KAAA,kBAAoB,IAAI,MAAMA,CAAQ,CAAA,CAGvC,aAAsB,CAC1B,OAAI,KAAK,OAAS,KAAK,SAAiB,GAC5B,KAAK,OACV,CAGJ,SAASE,EAAyB,CAC/B,MAAAC,EAAM,KAAK,YAAY,EACzB,GAAAA,IAAQ,GAAW,MAAA,GACvB,KAAK,UAAU,IAAID,EAAW,MAAQA,EAAW,IAAMC,EAAKA,CAAG,EAC1D,KAAA,kBAAkBA,CAAG,EAAID,EACzB,KAAA,MAAMC,CAAG,EAAI,EAElB,MAAMC,EAAIF,EAAW,SACjBE,IACA,KAAK,IAAID,EAAM,EAAI,CAAC,EAAIC,EAAE,EAC1B,KAAK,IAAID,EAAM,EAAI,CAAC,EAAIC,EAAE,EAC1B,KAAK,IAAID,EAAM,EAAI,CAAC,EAAIC,EAAE,GAExB,MAAAC,EAAIH,EAAW,UAAY,CAAE,EAAG,EAAG,EAAG,EAAG,EAAG,CAAE,EACpD,YAAK,IAAIC,EAAM,EAAI,CAAC,EAAIE,EAAE,EAC1B,KAAK,IAAIF,EAAM,EAAI,CAAC,EAAIE,EAAE,EAC1B,KAAK,IAAIF,EAAM,EAAI,CAAC,EAAIE,EAAE,EACnBF,CAAA,CAGJ,kBAAkBA,EAAmB,CACpCA,EAAM,GAAKA,GAAO,KAAK,QACtB,KAAA,MAAMA,CAAG,EAAI,EACb,KAAA,kBAAkBA,CAAG,EAAI,KAAA,CAG3B,WAAWD,EAAuB,CAC/B,MAAAI,EAAKJ,EAAW,MAAQA,EAAW,GACzC,GAAII,GAAM,KAAM,OAChB,MAAMH,EAAM,KAAK,UAAU,IAAIG,CAAE,EAC7BH,GAAO,OACN,KAAA,MAAMA,CAAG,EAAI,EACb,KAAA,kBAAkBA,CAAG,EAAI,KACzB,KAAA,UAAU,OAAOG,CAAE,EAAA,CAGrB,OAAOC,EAAkB,CAC5B,MAAMC,EAAI,KAAK,MACf,QAASC,EAAI,EAAGA,EAAID,EAAGC,IAAK,CACxB,GAAI,CAAC,KAAK,MAAMA,CAAC,EAAG,SACpB,MAAMC,EAAKD,EAAI,EACV,KAAA,IAAIC,EAAK,CAAC,GAAK,KAAK,IAAIA,EAAK,CAAC,EAAIH,EAClC,KAAA,IAAIG,EAAK,CAAC,GAAK,KAAK,IAAIA,EAAK,CAAC,EAAIH,EAClC,KAAA,IAAIG,EAAK,CAAC,GAAK,KAAK,IAAIA,EAAK,CAAC,EAAIH,EACjC,MAAAI,EAAO,KAAK,kBAAkBF,CAAC,EACjCE,GAAQA,EAAK,UAAYA,EAAK,SAAS,KACvCA,EAAK,SAAS,IAAI,KAAK,IAAID,EAAK,CAAC,EAAG,KAAK,IAAIA,EAAK,CAAC,EAAG,KAAK,IAAIA,EAAK,CAAC,CAAC,CAC1E,CACJ,CAER"}