var Q=Object.defineProperty;var X=(c,e,i)=>e in c?Q(c,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):c[e]=i;var u=(c,e,i)=>X(c,typeof e!="symbol"?e+"":e,i);import{y as F,J as b,N as T,a as f,B as C,m as B,r as E,a0 as P,o as A,K as q,a1 as N,n as k,C as O,L as V,G as U,z as Z,V as v,s as H,M as K}from"./three-DBvJLP14.js";import{g as J}from"./pathUtils-CUZPms8F.js";class ee{static createMainHull(e,i){const t=e,s=e*.22,o=e*.06,n=.15,l=new F,r=new Float32Array([-s/2,-o/2,t/2,s/2,-o/2,t/2,-s*n,-o/2,-t/2,s/2,-o/2,t/2,s*n,-o/2,-t/2,-s*n,-o/2,-t/2,-s/2,o/2,t/2,-s*n,o/2,-t/2,s/2,o/2,t/2,s/2,o/2,t/2,-s*n,o/2,-t/2,s*n,o/2,-t/2,-s/2,-o/2,t/2,-s/2,o/2,t/2,-s*n,-o/2,-t/2,-s/2,o/2,t/2,-s*n,o/2,-t/2,-s*n,-o/2,-t/2,s/2,-o/2,t/2,s*n,-o/2,-t/2,s/2,o/2,t/2,s/2,o/2,t/2,s*n,-o/2,-t/2,s*n,o/2,-t/2,-s/2,-o/2,t/2,-s/2,o/2,t/2,s/2,-o/2,t/2,s/2,-o/2,t/2,-s/2,o/2,t/2,s/2,o/2,t/2,-s*n,-o/2,-t/2,-s*n,o/2,-t/2,s*n,-o/2,-t/2,s*n,-o/2,-t/2,-s*n,o/2,-t/2,s*n,o/2,-t/2]);l.setAttribute("position",new b(r,3));const p=new T({color:3355460,metalness:.8,roughness:.3,emissive:1118481,emissiveIntensity:.2}),a=new f(l,p);return a.geometry.computeVertexNormals(),a.castShadow=!0,a.receiveShadow=!0,i.add(a),this.addHullPlates(e,i),a}static addHullPlates(e,i){const t=e*.2,s=e*.18,o=e*.01,n=e*.035;for(let l=0;l<5;l++){const r=e*.4-l*t,p=new C(s,o,t),a=new T({color:4473941,metalness:.7,roughness:.4,emissive:2236962}),h=new f(p,a);h.position.set(0,n,r),h.castShadow=!0,h.receiveShadow=!0,i.add(h)}}}class te{static createCommandBridge(e,i){const t=e*.12,s=e*.06,o=e*.08,n=e*.085,l=e*.28,r=new T({color:5592422,metalness:.7,roughness:.3,emissive:2236962,emissiveIntensity:.2}),p=new C(s,t,o),a=new f(p,r);a.position.set(0,n,l),a.castShadow=!0,a.receiveShadow=!0,i.add(a),this.addBridgeWindows(e,i,n,l);const h=.7,g=new C(s*h,t*h,o*h),d=new f(g,r);d.position.set(-s*1.2,n,l+o*.6),d.castShadow=!0,d.receiveShadow=!0,i.add(d);const m=new f(g,r);return m.position.set(s*1.2,n,l+o*.6),m.castShadow=!0,m.receiveShadow=!0,i.add(m),{mainTower:a,leftTower:d,rightTower:m}}static addBridgeWindows(e,i,t,s){const o=e*.003,n=e*.006,l=6,r=10,p=t-e*.02,a=e*.001,h=new T({color:11189196,emissive:11189196,emissiveIntensity:1,transparent:!0,opacity:.9});for(let g=0;g<l;g++)for(let d=0;d<r;d++){if(Math.random()>.85)continue;const m=new C(o,o,a),y=new f(m,h);y.position.set((d-r/2)*n,p+g*n,s+e*.04+a),i.add(y)}}}class ie{constructor(){u(this,"engineGlows");u(this,"engineTrailParticles");this.engineGlows=[],this.engineTrailParticles=null}createEngineArray(e,i){const t=e*.018,s=e*.04,o=e*.48,n=e*.01,l=e*.2,r=e*.05,p=e*.06,a=new C(l,r,p),h=new T({color:3355460,metalness:.8,roughness:.4}),g=new f(a,h);g.position.set(0,n,o),g.castShadow=!0,g.receiveShadow=!0,i.add(g);const d=new T({color:3368703,emissive:3368703,emissiveIntensity:.7,transparent:!0,opacity:.7}),m=new T({color:3368703,emissive:3368703,emissiveIntensity:1.5,transparent:!0,opacity:.8}),y=2,w=5,M=r*.5;for(let x=0;x<y;x++){const I=n-M*(x-.5);for(let S=0;S<w;S++){const R=(S-(w-1)/2)*(l/(w-1)*.8),j=new B(t,t*1.5,s,16),G=new f(j,d);G.position.set(R,I,o+p*.5),G.rotation.x=Math.PI/2,i.add(G);const Y=new E(t*1.6,16,16),D=new f(Y,m.clone());D.position.set(R,I,o+p*.5+s*1.1),i.add(D),this.engineGlows.push(D);const $=new E(t*2.5,16,16),L=m.clone();L.opacity=.4;const z=new f($,L);z.position.copy(D.position),i.add(z),this.engineGlows.push(z)}}return this.createEngineTrailParticles(e,o,l,i),{engineHousing:g,engineGlows:this.engineGlows}}createEngineTrailParticles(e,i,t,s){const n=new F,l=new Float32Array(200*3),r=new Float32Array(200*3),p=new Float32Array(200),a=[],h=5;for(let d=0;d<h;d++){const m=(d-(h-1)/2)*(t/(h-1)*.8);a.push(m)}for(let d=0;d<200;d++){const m=d*3,y=Math.floor(Math.random()*a.length),w=a[y],M=(Math.random()-.5)*e*.01,x=(Math.random()-.5)*e*.01,I=Math.random()*e*.5;l[m]=w+M,l[m+1]=x,l[m+2]=i+w*.05+I,r[m]=.5+Math.random()*.5,r[m+1]=.7+Math.random()*.3,r[m+2]=1,p[d]=(Math.random()*.5+.5)*e*.004}n.setAttribute("position",new b(l,3)),n.setAttribute("color",new b(r,3)),n.setAttribute("size",new b(p,1));const g=new P({uniforms:{time:{value:0},pointTexture:{value:this.createParticleTexture()}},vertexShader:`
                attribute float size;
                attribute vec3 color;
                varying vec3 vColor;
                uniform float time;
                
                void main() {
                    vColor = color;
                    
                    // Animate size with time
                    float pulseFactor = sin(time * 2.0 + position.z * 0.1) * 0.3 + 0.7;
                    
                    // Calculate position
                    vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);
                    
                    // Size attenuation
                    gl_PointSize = size * pulseFactor * (300.0 / -mvPosition.z);
                    gl_Position = projectionMatrix * mvPosition;
                }
            `,fragmentShader:`
                uniform sampler2D pointTexture;
                varying vec3 vColor;
                
                void main() {
                    // Sample soft particle texture
                    vec4 texColor = texture2D(pointTexture, gl_PointCoord);
                    
                    // Apply color
                    gl_FragColor = vec4(vColor, texColor.r);
                }
            `,transparent:!0,depthWrite:!1,blending:A,vertexColors:!0});this.engineTrailParticles=new q(n,g),s.add(this.engineTrailParticles)}createParticleTexture(){const e=document.createElement("canvas");e.width=64,e.height=64;const i=e.getContext("2d");if(!i)throw new Error("Could not get 2D context");const t=i.createRadialGradient(32,32,0,32,32,32);t.addColorStop(0,"rgba(255,255,255,1)"),t.addColorStop(.3,"rgba(255,255,255,0.8)"),t.addColorStop(.5,"rgba(255,255,255,0.4)"),t.addColorStop(1,"rgba(255,255,255,0)"),i.fillStyle=t,i.fillRect(0,0,64,64);const s=new N(e);return s.needsUpdate=!0,s}setEnginesPower(e){if(this.engineGlows.forEach((i,t)=>{const s=t%2===0,o=i.material;s?(o.emissiveIntensity=.8+e*1.2,o.opacity=.5+e*.5):(o.emissiveIntensity=.5+e*.8,o.opacity=.2+e*.3);const n=1+e*.8;i.scale.set(n,n,n*1.2)}),this.engineTrailParticles&&(this.engineTrailParticles.visible=e>.2,this.engineTrailParticles.geometry.attributes.size)){const i=this.engineTrailParticles.geometry.attributes.size.array,t=this.engineTrailParticles.userData.baseSizes||Array.from(i);this.engineTrailParticles.userData.baseSizes||(this.engineTrailParticles.userData.baseSizes=t);for(let s=0;s<i.length;s++)i[s]=t[s]*(1+e*2);this.engineTrailParticles.geometry.attributes.size.needsUpdate=!0}}updateEngineTrails(){this.engineTrailParticles&&this.engineTrailParticles.material instanceof P&&(this.engineTrailParticles.material.uniforms.time.value+=.02)}}class oe{static createSurfaceDetails(e,i){this.createTurrets(e,i),this.createSurfaceTrenches(e,i),this.createShieldGenerators(e,i)}static createTurrets(e,i){const t=e*.008,s=e*.01,o=e*.01,n=e*.005,l=new T({color:6710903,metalness:.7,roughness:.3}),r=[];for(let a=0;a<12;a++){const h=e*.2-a*e*.07;r.push([-e*.1,e*.035,h])}r.forEach(a=>{const h=new B(o,o,n,8),g=new f(h,l);g.position.set(a[0],a[1],a[2]),i.add(g);const d=new B(t,t,s,8),m=new f(d,l);m.position.set(a[0],a[1]+n*.5+s*.5,a[2]),m.rotation.x=Math.PI/2,m.rotation.z=-Math.PI/6,i.add(m)});const p=[];for(let a=0;a<12;a++){const h=e*.2-a*e*.07;p.push([e*.1,e*.035,h])}p.forEach(a=>{const h=new B(o,o,n,8),g=new f(h,l);g.position.set(a[0],a[1],a[2]),i.add(g);const d=new B(t,t,s,8),m=new f(d,l);m.position.set(a[0],a[1]+n*.5+s*.5,a[2]),m.rotation.x=Math.PI/2,m.rotation.z=Math.PI/6,i.add(m)})}static createSurfaceTrenches(e,i){const t=e*.01,s=e*.01,o=e*.3,n=new T({color:2236979,metalness:.7,roughness:.8,emissive:1118498,emissiveIntensity:.3}),l=new C(t,s,o),r=new f(l,n);r.position.set(0,e*.035,e*.1),i.add(r);const p=new C(t,s,o*.7),a=new f(p,n);a.position.set(-e*.07,e*.035,e*.05),i.add(a);const h=new f(p,n);h.position.set(e*.07,e*.035,e*.05),i.add(h)}static createShieldGenerators(e,i){const t=e*.02,s=e*.05,o=e*.35,n=new T({color:3368618,metalness:.2,roughness:.3,transparent:!0,opacity:.6,emissive:1122884,emissiveIntensity:.3}),l=new E(t,16,16,0,Math.PI*2,0,Math.PI/2),r=new f(l,n);r.position.set(-e*.08,s,o),r.rotation.x=Math.PI,i.add(r);const p=new E(t,16,16,0,Math.PI*2,0,Math.PI/2),a=new f(p,n);return a.position.set(e*.08,s,o),a.rotation.x=Math.PI,i.add(a),{portDome:r,starboardDome:a}}}class W{static createTeleportBeam(e,i){const t=e*.03,s=e*.2,o=e*.8,n=new P({uniforms:{time:{value:0},color:{value:new O(3394815)},pulseFrequency:{value:12},pulseAmplitude:{value:.3}},vertexShader:`
                varying vec2 vUv;
                
                void main() {
                    vUv = uv;
                    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
                }
            `,fragmentShader:`
                uniform float time;
                uniform vec3 color;
                uniform float pulseFrequency;
                uniform float pulseAmplitude;
                varying vec2 vUv;
                
                // Improved pattern with scrolling and pulsing
                void main() {
                    // Create primary energy pattern - vertical striations
                    float verticalPattern = sin(vUv.y * 50.0 - time * 3.0) * 0.5 + 0.5;
                    
                    // Create horizontal pulse bands
                    float horizontalPulse = sin(vUv.y * pulseFrequency - time * 2.0) * pulseAmplitude + (1.0 - pulseAmplitude);
                    
                    // Edge glow effect with distortion
                    float edgeEffect = smoothstep(0.0, 0.4, vUv.x) * smoothstep(1.0, 0.6, vUv.x);
                    
                    // Swirling energy effect
                    float swirl = sin(vUv.y * 30.0 + vUv.x * 5.0 + time * 4.0) * 0.5 + 0.5;
                    
                    // Combine effects
                    float pattern = mix(verticalPattern, swirl, 0.5) * horizontalPulse * edgeEffect;
                    
                    // Add vertical fade for more realistic beam
                    float opacity = (1.0 - vUv.y * 0.8) * 0.9;
                    
                    // Pulsing brightness based on time
                    float pulse = sin(time * 3.0) * 0.1 + 0.9;
                    
                    // Combine final color 
                    vec3 finalColor = color * pulse;
                    
                    // Output final color with combined opacity
                    gl_FragColor = vec4(finalColor, opacity * pattern);
                }
            `,transparent:!0,side:k,blending:A}),l=new B(s,t,o,32,16,!0),r=new f(l,n);return r.position.set(0,-o/2,-e*.1),r.rotation.x=Math.PI,r.visible=!1,i.add(r),r}static createBeamImpactRing(e,i){const t=new V(e*.1,e*.22,32),s=new P({uniforms:{time:{value:0},color:{value:new O(3394815)}},vertexShader:`
                varying vec2 vUv;
                void main() {
                    vUv = uv;
                    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
                }
            `,fragmentShader:`
                uniform float time;
                uniform vec3 color;
                varying vec2 vUv;
                
                void main() {
                    // Animated ripple effect
                    float ripple = sin(distance(vUv, vec2(0.5)) * 20.0 - time * 5.0) * 0.5 + 0.5;
                    
                    // Rotating element
                    float angle = atan(vUv.y - 0.5, vUv.x - 0.5);
                    float rotatingPattern = sin(angle * 8.0 + time * 3.0) * 0.5 + 0.5;
                    
                    // Pulsing opacity
                    float pulse = sin(time * 2.0) * 0.3 + 0.7;
                    
                    // Combine patterns
                    float pattern = mix(ripple, rotatingPattern, 0.5) * pulse;
                    
                    gl_FragColor = vec4(color, pattern * 0.7);
                }
            `,transparent:!0,side:k,blending:A,depthWrite:!1}),o=new f(t,s);return o.position.set(0,-e*1,-e*.1),o.rotation.x=-Math.PI/2,o.visible=!1,i.add(o),o}}class _{static createTeleportParticles(e,i){const s=new F,o=new Float32Array(800*3),n=new Float32Array(800*3),l=new Float32Array(800);for(let a=0;a<800;a++){const h=a*3,g=Math.random()>.3,d=g?Math.random()*e*.03:e*.03+Math.random()*e*.17,m=Math.random()*Math.PI*2,y=-(Math.random()*e*.8);o[h]=d*Math.cos(m),o[h+1]=y,o[h+2]=d*Math.sin(m),g?(n[h]=.3+Math.random()*.2,n[h+1]=.9+Math.random()*.1,n[h+2]=1):(n[h]=.1+Math.random()*.1,n[h+1]=.7+Math.random()*.3,n[h+2]=.9+Math.random()*.1),l[a]=g?e*.002+Math.random()*e*.002:e*.004+Math.random()*e*.006}s.setAttribute("position",new b(o,3)),s.setAttribute("color",new b(n,3)),s.setAttribute("size",new b(l,1));const r=new P({uniforms:{time:{value:0},pointTexture:{value:this.createParticleTexture()}},vertexShader:`
                attribute float size;
                attribute vec3 color;
                varying vec3 vColor;
                uniform float time;
                
                void main() {
                    vColor = color;
                    
                    // Animate size with time
                    float pulseFactor = sin(time * 2.0 + position.z * 0.1) * 0.3 + 0.7;
                    
                    // Calculate position
                    vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);
                    
                    // Size attenuation
                    gl_PointSize = size * pulseFactor * (300.0 / -mvPosition.z);
                    gl_Position = projectionMatrix * mvPosition;
                }
            `,fragmentShader:`
                uniform sampler2D pointTexture;
                varying vec3 vColor;
                
                void main() {
                    // Sample soft particle texture
                    vec4 texColor = texture2D(pointTexture, gl_PointCoord);
                    
                    // Apply color
                    gl_FragColor = vec4(vColor, texColor.r);
                }
            `,transparent:!0,depthWrite:!1,blending:A,vertexColors:!0}),p=new q(s,r);return p.visible=!1,p.position.set(0,0,-e*.1),i.add(p),p}static createParticleTexture(){const e=document.createElement("canvas");e.width=64,e.height=64;const i=e.getContext("2d");if(!i)throw new Error("Could not get 2D context");const t=i.createRadialGradient(32,32,0,32,32,32);t.addColorStop(0,"rgba(255,255,255,1)"),t.addColorStop(.3,"rgba(255,255,255,0.8)"),t.addColorStop(.5,"rgba(255,255,255,0.4)"),t.addColorStop(1,"rgba(255,255,255,0)"),i.fillStyle=t,i.fillRect(0,0,64,64);const s=new N(e);return s.needsUpdate=!0,s}static animateParticles(e){if(!e||!e.visible)return;const i=e.geometry.attributes.position.array;for(let t=0;t<i.length;t+=3)if(i[t+1]-=5,i[t]+=(Math.random()-.5)*2,i[t+2]+=(Math.random()-.5)*2,i[t+1]<-1e3){const o=Math.random()>.3?Math.random()*40:40+Math.random()*180,n=Math.random()*Math.PI*2;i[t]=o*Math.cos(n),i[t+1]=-(Math.random()*400),i[t+2]=o*Math.sin(n)}e.geometry.attributes.position.needsUpdate=!0}}class se{constructor(){u(this,"teleportBeam");u(this,"teleportParticles");u(this,"impactRing");u(this,"teleportBeamActive");this.teleportBeam=null,this.teleportParticles=null,this.impactRing=null,this.teleportBeamActive=!1}setComponents(e,i,t){this.teleportBeam=e,this.teleportParticles=i,this.impactRing=t}activateTeleportBeam(){if(this.teleportBeam){this.teleportBeam.visible=!0,this.teleportParticles.visible=!0,this.impactRing.visible=!0,this.teleportBeamActive=!0;const e=this.teleportBeam.material;e.uniforms.time.value=0;const i=this.impactRing.material;i.uniforms.time.value=0,this.teleportParticles.material instanceof P&&this.teleportParticles.material.uniforms&&(this.teleportParticles.material.uniforms.time.value=0)}}deactivateTeleportBeam(){this.teleportBeam&&(this.teleportBeam.visible=!1,this.teleportParticles.visible=!1,this.impactRing.visible=!1,this.teleportBeamActive=!1)}updateTeleportBeam(e=0){if(!this.teleportBeamActive)return;const i=.02;if(this.teleportBeam&&this.teleportBeam.material instanceof P){this.teleportBeam.material.uniforms.time.value+=i;const t=.3+Math.sin(e*Math.PI*6)*.1;this.teleportBeam.material.uniforms.pulseAmplitude.value=t}if(this.impactRing&&this.impactRing.material instanceof P){this.impactRing.material.uniforms.time.value+=i;const t=1+Math.sin(e*Math.PI*3)*.2;this.impactRing.scale.set(t,t,1)}this.teleportParticles&&this.teleportParticles.material instanceof P&&(this.teleportParticles.material.uniforms.time.value+=i,_.animateParticles(this.teleportParticles))}isBeamActive(){return this.teleportBeamActive}}class ne{constructor(e){u(this,"scene");u(this,"ship");u(this,"engines");u(this,"teleportController");this.scene=e,this.ship=null,this.engines=new ie,this.teleportController=new se,this.createShipModel(),this.scene.add(this.ship),console.log("Star Dreadnought created")}createShipModel(){this.ship=new U,this.ship.name="starDreadnought";const e=1200;this.createStructure(e),this.createSystems(e),this.createTeleporter(e)}createStructure(e){ee.createMainHull(e,this.ship),te.createCommandBridge(e,this.ship)}createSystems(e){this.engines.createEngineArray(e,this.ship),oe.createSurfaceDetails(e,this.ship)}createTeleporter(e){const i=W.createTeleportBeam(e,this.ship),t=W.createBeamImpactRing(e,this.ship),s=_.createTeleportParticles(e,this.ship);this.teleportController.setComponents(i,s,t)}setEnginesPower(e){this.engines.setEnginesPower(e)}activateTeleportBeam(){this.teleportController.activateTeleportBeam()}deactivateTeleportBeam(){this.teleportController.deactivateTeleportBeam()}updateTeleportBeam(e){this.teleportController.updateTeleportBeam(e),this.engines.updateEngineTrails()}get teleportBeamActive(){return this.teleportController.isBeamActive()}getShip(){return this.ship}getEngineGlows(){return this.engines.engineGlows}update(e){this.engines.updateEngineTrails(),this.teleportController.isBeamActive()&&this.teleportController.updateTeleportBeam()}dispose(){this.ship&&(this.scene.remove(this.ship),this.ship.traverse(e=>{const i=e;i.geometry&&i.geometry.dispose(),i.material&&(Array.isArray(i.material)?i.material.forEach(t=>t.dispose()):i.material.dispose())}),this.ship=null)}}function ae(c){if(typeof window.Tone>"u")return console.error("Tone.js not available for intro sound effects"),{};try{console.log("Creating intro sequence sound effects...");const i={};return i.warp=re(c),i.shipArrival=le(c),i.teleport=ce(c),console.log("Intro sequence sound effects created"),i}catch(i){return console.error("Error creating intro sound effects:",i),{}}}function re(c){const e=window.Tone;try{const i=e.Destination,t=new e.Filter({type:"lowpass",frequency:2e3,Q:2}).connect(i),s=new e.Reverb({decay:2,wet:.5}).connect(t),o=new e.FMSynth({harmonicity:3,modulationIndex:10,oscillator:{type:"sine"},envelope:{attack:.1,decay:.2,sustain:.8,release:1.5},modulation:{type:"square"},modulationEnvelope:{attack:.5,decay:.1,sustain:.2,release:.5}}).connect(s),n=new e.Filter({type:"bandpass",frequency:700,Q:.6}).connect(i),l=new e.Gain(.3).connect(n),r=new e.Noise("pink").connect(l);return{lastPlayTime:0,play:function(){if(c&&c.muted)return;const a=e.now();if(a-this.lastPlayTime<.1){console.log("Preventing too rapid warp sound playback");return}this.lastPlayTime=a;const h=c?c.sfxVolume*.36:.18;o.volume.value=e.gainToDb(h),r.start(),o.triggerAttack("C5",a),o.frequency.exponentialRampTo("C2",2,a),l.gain.setValueAtTime(.18,a),l.gain.exponentialRampTo(.01,3,a+1),setTimeout(()=>{o.triggerRelease(),setTimeout(()=>{r.stop()},500)},3e3)}}}catch(i){return console.error("Error creating warp sound:",i),{play:()=>{}}}}function le(c){const e=window.Tone;try{const i=e.Destination,t=new e.Filter({type:"lowpass",frequency:1200,Q:1}).connect(i),s=new e.PolySynth(e.Synth,{oscillator:{type:"triangle"},envelope:{attack:.02,decay:.3,sustain:.1,release:.8}}).connect(t),o=new e.Filter({type:"lowpass",frequency:200,Q:.5}).connect(i),n=new e.Synth({oscillator:{type:"sine"},envelope:{attack:.1,decay:.3,sustain:.6,release:1}}).connect(o);return{play:()=>{if(c&&c.muted)return;const l=e.now(),r=c?c.sfxVolume*.42:.24;s.volume.value=e.gainToDb(r),n.volume.value=e.gainToDb(r*.8),s.triggerAttackRelease(["G3","D4","A4"],1.5,l),n.triggerAttack("G1",l),n.frequency.exponentialRampTo("C2",2,l+.5),setTimeout(()=>{n.triggerRelease()},2e3)}}}catch(i){return console.error("Error creating ship arrival sound:",i),{play:()=>{}}}}function ce(c){const e=window.Tone;try{const i=e.Destination,t=new e.Filter({type:"bandpass",frequency:800,Q:2}).connect(i),s=new e.Chorus({frequency:1.5,delayTime:3.5,depth:.7,wet:.5}).connect(t).start(),o=new e.Synth({oscillator:{type:"sine"},envelope:{attack:.05,decay:.2,sustain:.8,release:1}}).connect(s),n=new e.Filter({type:"highpass",frequency:2e3,Q:1}).connect(i),l=new e.Synth({oscillator:{type:"square"},envelope:{attack:.01,decay:.1,sustain:.6,release:.5}}).connect(n);return{play:()=>{if(c&&c.muted)return;const r=e.now(),p=c?c.sfxVolume*.3:.18;o.volume.value=e.gainToDb(p),l.volume.value=e.gainToDb(p*.4),o.triggerAttack("C4",r),o.frequency.exponentialRampTo("C6",1.5,r),l.triggerAttackRelease("E7",.1,r+.3),setTimeout(()=>{l.triggerAttackRelease("G7",.1,r+.5)},200),setTimeout(()=>{o.triggerRelease()},2e3)}}}catch(i){return console.error("Error creating teleport sound:",i),{play:()=>{}}}}function he(){console.log("Loading dialogue WAV files...");const c=[];try{for(let e=1;e<=8;e++){const i=J(`sounds/dialogue/${e}.wav`);console.log(`Attempting to load dialogue file: ${i}`);const t=new Audio;t.addEventListener("canplaythrough",()=>{console.log(`Dialogue WAV ${e} loaded successfully`)}),t.addEventListener("error",()=>{console.warn(`Dialogue WAV ${e} not found or couldn't be loaded - this is normal if you haven't added the files yet`)}),t.src=i,c.push(t)}return console.log("Dialogue WAV files setup complete - they'll be used if available"),c}catch(e){return console.error("Error in dialogue WAV files setup:",e),[]}}function pe(c,e,i){if(!(e>=8||!c[e]))try{const t=c[e];if(t.readyState>0&&t.error===null){t.volume=i?i.sfxVolume*.8:.5,t.currentTime=0;const s=t.play();s!==void 0&&s.catch(o=>{console.warn(`Couldn't play dialogue WAV ${e}: ${o.message}`)})}else console.log(`Skipping dialogue WAV ${e+1} (not loaded)`)}catch(t){console.warn(`Error playing dialogue WAV ${e+1}, continuing without audio`,t.message)}}class ue{constructor(){u(this,"warpTunnel",null);u(this,"warpPortal",null);u(this,"portalParticles",null);this.setupPortalEffect()}setupPortalEffect(){const e=new V(0,400,64),i=new P({uniforms:{time:{value:0},color:{value:new O(6697898)}},vertexShader:`
                precision highp float;
                varying vec2 vUv;
                void main() {
                    vUv = uv;
                    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
                }
            `,fragmentShader:`
                precision highp float;
                uniform float time;
                uniform vec3 color;
                varying vec2 vUv;
                
                void main() {
                    float distFromCenter = length(vUv - vec2(0.5, 0.5)) * 2.0;
                    float ripple = sin(distFromCenter * 20.0 - time * 3.0) * 0.5 + 0.5;
                    float alpha = (1.0 - distFromCenter) * ripple;
                    
                    vec3 finalColor = color * (0.8 + ripple * 0.4);
                    gl_FragColor = vec4(finalColor, alpha);
                }
            `,transparent:!0,side:k});this.warpPortal=new f(e,i);const t=500,s=new F,o=new Float32Array(t*3);for(let l=0;l<t;l++){const r=Math.random()*Math.PI*2,p=350+Math.random()*150;o[l*3]=Math.cos(r)*p,o[l*3+1]=Math.sin(r)*p,o[l*3+2]=(Math.random()-.5)*50}s.setAttribute("position",new b(o,3));const n=new Z({color:11154431,size:3,transparent:!0,blending:A});this.portalParticles=new q(s,n),this.warpTunnel=new U,this.warpTunnel.add(this.warpPortal),this.warpTunnel.add(this.portalParticles)}updatePortalEffect(){this.warpPortal&&this.warpPortal.material.uniforms&&(this.warpPortal.material.uniforms.time.value+=.016)}setOpacity(e){if(this.portalParticles&&this.portalParticles.material){const i=this.portalParticles.material;Array.isArray(i)?i.forEach(t=>{"opacity"in t&&(t.opacity=e)}):"opacity"in i&&(i.opacity=e)}if(this.warpPortal&&this.warpPortal.material){const i=this.warpPortal.material;Array.isArray(i)?i.forEach(t=>{"opacity"in t&&(t.opacity=e)}):"opacity"in i&&(i.opacity=e)}}setScale(e){this.warpTunnel&&this.warpTunnel.scale.set(e,e,1)}setPosition(e){this.warpTunnel&&this.warpTunnel.position.copy(e)}setRotation(e){this.warpTunnel&&this.warpTunnel.rotation.copy(e)}setVisible(e){this.warpTunnel&&(this.warpTunnel.visible=e)}getPortalGroup(){return this.warpTunnel}dispose(){this.warpPortal&&(this.warpPortal.geometry&&this.warpPortal.geometry.dispose(),this.warpPortal.material&&this.warpPortal.material.dispose()),this.portalParticles&&(this.portalParticles.geometry&&this.portalParticles.geometry.dispose(),this.portalParticles.material&&this.portalParticles.material.dispose()),this.warpTunnel=null,this.warpPortal=null,this.portalParticles=null}}class de{constructor(){u(this,"dialogueBox",null);u(this,"dialogueText",null);u(this,"currentDialogueIndex",0);u(this,"isTyping",!1);u(this,"typeInterval",null);u(this,"dialogueWavs",[]);u(this,"audioManager",null);u(this,"dialogueLines");this.dialogueBox=null,this.dialogueText=null,this.currentDialogueIndex=0,this.isTyping=!1,this.typeInterval=null,this.dialogueWavs=[],this.audioManager=null,this.dialogueLines=["CORP CONTROLLER: [static] Belter #337, status check. Your cryostasis cycle is now complete.",`CORP CONTROLLER: Welcome to your deployment in the Sol System, circa 2077. As you can see, Earth is... well... let's just say "available for unrestricted mining operations" now.`,'CORP CONTROLLER: CorpEx Resource Acquisition reminds you that all planetary bodies in this system are now classified as "unclaimed assets" following the... unfortunate global circumstances.',"CORP CONTROLLER: Your primary objective is resource extraction from the asteroid belt. Initial scans show promising mineral concentrations untouched since the evacuation.","CORP CONTROLLER: The Stargate remains your lifeline. Return for fuel, upgrades, trading, and your allocated 15 minutes of daily entertainment. Remember, a happy belter is a productive belter!","CORP CONTROLLER: Resource extraction targets are non-negotiable. Failure to meet quotas will result in extension of your 42-year contract.","CORP CONTROLLER: Oh, and our long-range scans have detected spectral drone activity in adjacent sectors. Remnants of old defense systems, probably. Nothing a resourceful belter like you can't handle.","CORP CONTROLLER: Connection terminating in 3...2...1... Don't die out there, #337. Replacement clones are expensive.","[TRANSMISSION TERMINATED]","[BELTER #337 DEPLOYMENT ACTIVE]"]}initialize(e,i){this.dialogueWavs=e,this.audioManager=i}setupDialogueUI(){this.dialogueBox=document.createElement("div"),this.dialogueBox.id="intro-dialogue",this.dialogueBox.style.position="fixed",this.dialogueBox.style.bottom="50px",this.dialogueBox.style.left="50%",this.dialogueBox.style.transform="translateX(-50%)",this.dialogueBox.style.width="80%",this.dialogueBox.style.maxWidth="800px",this.dialogueBox.style.backgroundColor="rgba(0, 0, 0, 0.7)",this.dialogueBox.style.color="#30f0c0",this.dialogueBox.style.border="1px solid #30f0c0",this.dialogueBox.style.borderRadius="5px",this.dialogueBox.style.padding="15px",this.dialogueBox.style.fontFamily="Courier New, monospace",this.dialogueBox.style.fontSize="16px",this.dialogueBox.style.zIndex="10000",this.dialogueBox.style.textShadow="0 0 5px #30f0c0",this.dialogueBox.style.boxShadow="0 0 10px rgba(48, 240, 192, 0.3)",this.dialogueBox.style.opacity="0",this.dialogueBox.style.transition="opacity 0.5s",this.dialogueText=document.createElement("div"),this.dialogueText.style.lineHeight="1.5",this.dialogueBox.appendChild(this.dialogueText),document.body.appendChild(this.dialogueBox),setTimeout(()=>{this.dialogueBox&&(this.dialogueBox.style.opacity="1")},200)}typeNextDialogue(e=0,i=!0){if(this.currentDialogueIndex>=this.dialogueLines.length)return!1;const t=this.dialogueLines[this.currentDialogueIndex];pe(this.dialogueWavs,this.currentDialogueIndex,this.audioManager),this.currentDialogueIndex++,this.dialogueText&&(this.dialogueText.textContent=""),this.dialogueBox&&this.dialogueBox.style.opacity==="0"&&(this.dialogueBox.style.opacity="1");let s=0;return this.isTyping=!0,this.typeInterval&&clearInterval(this.typeInterval),this.dialogueText&&(t.includes("TRANSMISSION TERMINATED")||t.includes("DEPLOYMENT ACTIVE")?this.dialogueText.style.color="#ff3030":this.dialogueText.style.color="#30f0c0"),this.typeInterval=setInterval(()=>{if(s<t.length)this.dialogueText&&(this.dialogueText.textContent+=t.charAt(s)),s++;else if(this.typeInterval&&clearInterval(this.typeInterval),this.typeInterval=null,this.isTyping=!1,e<22){const o=Math.max(t.length*50,3e3);setTimeout(()=>{!this.isTyping&&i&&this.typeNextDialogue(e,i)},o)}},30),!0}getCurrentDialogueIndex(){return this.currentDialogueIndex}getIsTyping(){return this.isTyping}cleanup(){this.typeInterval&&(clearInterval(this.typeInterval),this.typeInterval=null),this.dialogueBox&&this.dialogueBox.parentNode&&(this.dialogueBox.parentNode.removeChild(this.dialogueBox),this.dialogueBox=null,this.dialogueText=null),this.currentDialogueIndex=0,this.isTyping=!1}}function me(c,e){var r,p;const{portalEffect:i,starDreadnought:t,camera:s,spaceship:o,introSounds:n,flashOverlay:l}=e;if(i.updatePortalEffect(),i.setPosition(new v(3e4,5e3,0)),i.setRotation(new H(0,0,Math.PI/2)),c<.2){const h=c/.2*3.5;i.setScale(h),s.position.set(0,6e3,12e3),s.lookAt(3e4,5e3,0)}if(c>=.2&&c<.7){c>=.2&&!t.ship.visible&&(t.ship.visible=!0,l&&l(.3),(r=n.shipArrival)!=null&&r.play&&n.shipArrival.play());const a=(c-.2)/.5,h=a<.5?2*a*a:1-Math.pow(-2*a+2,2)/2,g=new v(3e4,5e3,0),d=new v(26e3,5300,-2e3),m=new v(22e3,5e3,0),y=new v,w=new v,M=new v;y.copy(g).multiplyScalar(Math.pow(1-h,2)),w.copy(d).multiplyScalar(2*(1-h)*h),M.copy(m).multiplyScalar(h*h);const x=new v().add(y).add(w).add(M);x.y+=Math.sin(c*Math.PI*3)*80,t.ship.position.copy(x);const I=.4+h*.6;if(t.setEnginesPower(I),c>.3){const R=Math.min((c-.3)/.3,1);i.setOpacity(1-R)}const S=t.ship.position.clone();s.position.set(S.x-3e3,S.y+1e3,8e3),s.lookAt(S)}if(c>=.7){if(i.setOpacity(0),c<.75&&!t.teleportBeamActive&&(t.activateTeleportBeam(),(p=n.teleport)!=null&&p.play&&n.teleport.play()),t.updateTeleportBeam(c),c>.8&&o&&o.mesh&&!o.mesh.visible){const d=t.ship.position;o.mesh.position.set(d.x,d.y-2e3,d.z),o.isDocked&&(console.log("Undocking player ship during intro sequence"),o.isDocked=!1),o.mesh.visible=!0,e.finalPlayerPosition=new v(o.mesh.position.x,o.mesh.position.y,o.mesh.position.z),ge(o,e),l&&l(.3)}const a=t.ship.position.clone(),h=(c-.7)/.3;s.position.set(a.x-2e3+h*2e3,a.y+2e3,5e3-h*3e3);const g=a.y-1e3;s.lookAt(a.x,g,a.z)}}function ge(c,e){const i=new E(30,32,32),t=new K({color:8965375,transparent:!0,opacity:.6,side:k});e.playerShieldEffect=new f(i,t),e.playerShieldEffect.scale.set(1.2,1.2,1.2),c.mesh.add(e.playerShieldEffect),e.shieldPulseTime=0}function fe(c,e){const{portalEffect:i,starDreadnought:t,camera:s,introSounds:o,flashOverlay:n}=e,l=new v(3e4,5e3,0);if(c<.5){if(c<.1&&t.teleportBeamActive&&t.deactivateTeleportBeam(),c>.1){i.setPosition(l),i.setVisible(!0),i.setRotation(new H(0,0,Math.PI/2)),i.setScale(3.5);const p=Math.min((c-.1)/.3,1);i.setOpacity(p)}if(c>.2){const p=Math.min((c-.2)/.3,1),a=Math.PI/2,h=3*Math.PI/2;t.ship.rotation.y=a+(h-a)*p}const r=t.ship.position.clone();s.position.set(r.x,r.y+3e3,r.z+8e3),s.lookAt(r)}else{const r=(c-.5)/.5,p=new v(22e3,5e3,0),a=new v(35e3,5e3,0),h=r*r;let g;if(r<.7){const y=h/.5;g=new v().lerpVectors(p,l,y)}else{const y=(r-.7)/.3;g=new v().lerpVectors(l,a,y)}if(t.ship.position.copy(g),t.setEnginesPower(.7+r*.8),r>.6&&r<.63&&(n(.4),o.warp&&Math.abs(r-.61)<.01&&o.warp.play()),r>.65&&(t.ship.visible=!1),r>.9){const w=(1-(r-.9)/.1)*3.5;i.setScale(w)}const d=p.clone();s.position.set(d.x-2e3,d.y+3e3,1e4);const m=new v().lerpVectors(p,l,.5);s.lookAt(m)}}class Pe{constructor(e,i,t,s){u(this,"scene");u(this,"camera");u(this,"spaceship");u(this,"audio");u(this,"isPlaying");u(this,"sequenceTime");u(this,"onComplete");u(this,"skipEnabled");u(this,"initialCameraPosition");u(this,"initialCameraRotation");u(this,"starDreadnought");u(this,"portalEffect");u(this,"overlay");u(this,"dialogueSystem");u(this,"introSounds");u(this,"dialogueWavs");u(this,"skipButton");u(this,"lastTime");u(this,"animationFrameId");u(this,"finalPlayerPosition");u(this,"playerShieldEffect");u(this,"shieldPulseTime");u(this,"skipHandler");this.scene=e,this.camera=i,this.spaceship=t,this.audio=s,this.isPlaying=!1,this.sequenceTime=0,this.onComplete=null,this.skipEnabled=!1,this.initialCameraPosition=null,this.initialCameraRotation=null,this.starDreadnought=new ne(e),this.portalEffect=new ue,this.overlay=null,this.setupOverlay(),this.dialogueSystem=new de,this.introSounds={},this.dialogueWavs=[],this.skipButton=null,this.lastTime=0,this.animationFrameId=null,console.log("Intro sequence initialized"),this.dialogueWavs=he(),this.introSounds=ae(this.audio),this.dialogueSystem.initialize(this.dialogueWavs,this.audio)}setupOverlay(){this.overlay=document.createElement("div"),this.overlay.id="intro-overlay",this.overlay.style.position="fixed",this.overlay.style.top="0",this.overlay.style.left="0",this.overlay.style.width="100%",this.overlay.style.height="100%",this.overlay.style.backgroundColor="#aa33ff",this.overlay.style.opacity="0",this.overlay.style.transition="opacity 0.5s",this.overlay.style.pointerEvents="none",this.overlay.style.zIndex="9999",document.body.appendChild(this.overlay)}startSequence(e){var n,l,r;if(this.isPlaying)return;console.log("Starting intro sequence..."),this.isPlaying=!0,this.sequenceTime=0,this.onComplete=e||null;const i=this.camera,t=this.scene,s=this.portalEffect,o=this.starDreadnought;this.initialCameraPosition=i.position.clone(),this.initialCameraRotation=i.rotation.clone(),i.position.set(0,6e3,12e3),i.lookAt(3e4,5e3,0),this.spaceship&&this.spaceship.mesh&&(this.spaceship.mesh.visible=!1,this.spaceship.thrust&&(this.spaceship.thrust.forward=!1,this.spaceship.thrust.backward=!1,this.spaceship.thrust.left=!1,this.spaceship.thrust.right=!1,this.spaceship.thrust.boost=!1),this.spaceship.velocity&&this.spaceship.velocity.set(0,0,0)),t.add(s.getPortalGroup()),o.ship.position.set(35e3,5e3,0),o.ship.rotation.y=Math.PI/2,o.ship.visible=!1,this.animate=this.animate.bind(this),this.lastTime=performance.now(),requestAnimationFrame(this.animate),this.setupSkipHandler(),(n=this.dialogueSystem)==null||n.setupDialogueUI(),setTimeout(()=>{var p;(p=this.dialogueSystem)==null||p.typeNextDialogue(this.sequenceTime,this.isPlaying)},2e3),this.introSounds.warp&&((r=(l=this.introSounds.warp).play)==null||r.call(l))}animate(e){if(!this.isPlaying)return;const i=Math.min((e-this.lastTime)/1e3,.1)*.4;if(this.lastTime=e,this.sequenceTime+=i,this.sequenceTime<14){const t=this.createAnimationContext();me(this.sequenceTime/14,t)}else if(this.sequenceTime<24){const t=this.createAnimationContext();fe((this.sequenceTime-14)/10,t)}else{this.completeSequence();return}requestAnimationFrame(this.animate)}createAnimationContext(){return{portalEffect:this.portalEffect,starDreadnought:this.starDreadnought,camera:this.camera,spaceship:this.spaceship,introSounds:this.introSounds,flashOverlay:this.flashOverlay.bind(this),finalPlayerPosition:this.finalPlayerPosition,playerShieldEffect:this.playerShieldEffect,shieldPulseTime:this.shieldPulseTime}}flashOverlay(e=.6){this.overlay&&(this.overlay.style.opacity=e.toString(),setTimeout(()=>{this.overlay&&(this.overlay.style.opacity="0")},300))}setupSkipHandler(){const e=document.createElement("div");e.id="skip-intro-button",e.textContent="SKIP INTRO",e.style.position="fixed",e.style.bottom="10px",e.style.left="50%",e.style.transform="translateX(-50%)",e.style.padding="10px 15px",e.style.backgroundColor="rgba(0, 0, 0, 0.7)",e.style.color="#30f0c0",e.style.border="1px solid #30f0c0",e.style.borderRadius="5px",e.style.cursor="pointer",e.style.zIndex="10000",e.style.fontFamily="Courier New, monospace",e.style.boxShadow="0 0 10px rgba(48, 240, 192, 0.3)",e.addEventListener("click",()=>{this.skipSequence()}),document.body.appendChild(e),this.skipButton=e}skipSequence(){console.log("Skipping intro sequence"),this.spaceship&&this.spaceship.mesh&&(this.spaceship.mesh.position.set(22e3,3e3,0),this.spaceship.mesh.rotation.set(0,0,0),this.spaceship.isDocked=!1,this.spaceship.mesh.visible=!0,this.spaceship.hull!==void 0&&this.spaceship.hull<=0&&(console.log("Fixing spaceship hull from",this.spaceship.hull,"to 100"),this.spaceship.hull=100),this.spaceship.shield!==void 0&&this.spaceship.shield<=0&&(console.log("Fixing spaceship shield from",this.spaceship.shield,"to 50"),this.spaceship.shield=50),this.spaceship.fuel!==void 0&&this.spaceship.fuel<=0&&(console.log("Fixing spaceship fuel from",this.spaceship.fuel,"to 100"),this.spaceship.fuel=100)),this.completeSequence();const e=window;e.gameInstance&&e.gameInstance.spaceship&&(e.gameInstance.spaceship.isDocked=!1,console.log("Ship set to undocked state after skip"),e.gameInstance.spaceship.hull!==void 0&&e.gameInstance.spaceship.hull<=0&&(console.log("Fixing global spaceship hull to 100"),e.gameInstance.spaceship.hull=100),e.gameInstance.spaceship.fuel!==void 0&&e.gameInstance.spaceship.fuel<=0&&(console.log("Fixing global spaceship fuel to 100"),e.gameInstance.spaceship.fuel=100))}completeSequence(){var s,o,n,l;console.log("Intro sequence complete"),this.isPlaying=!1;const e=this.scene,i=this.portalEffect,t=this.starDreadnought;e.remove(i.getPortalGroup()),t.ship.visible=!1,this.skipEnabled=!0,this.playerShieldEffect&&((s=this.spaceship)!=null&&s.mesh)&&((n=(o=this.spaceship.mesh).remove)==null||n.call(o,this.playerShieldEffect),this.playerShieldEffect=null),this.skipButton&&(document.body.removeChild(this.skipButton),this.skipButton=null),this.overlay&&(document.body.removeChild(this.overlay),this.overlay=null),(l=this.dialogueSystem)==null||l.cleanup(),this.spaceship&&this.spaceship.mesh&&(this.spaceship.mesh.visible=!0,this.spaceship.isDocked&&(console.log("Forcing ship to undocked state after intro sequence"),this.spaceship.isDocked=!1),console.log("Player final position:",this.spaceship.mesh.position.x,this.spaceship.mesh.position.y,this.spaceship.mesh.position.z)),this.onComplete&&typeof this.onComplete=="function"&&setTimeout(()=>{var r;console.log("Executing intro sequence completion callback"),(r=this.onComplete)==null||r.call(this)},100)}destroy(){var e;this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null),(e=this.dialogueSystem)==null||e.cleanup(),this.overlay&&this.overlay.parentNode&&this.overlay.parentNode.removeChild(this.overlay),document.removeEventListener("keydown",this.skipHandler),this.portalEffect&&this.portalEffect.dispose(),this.starDreadnought&&typeof this.starDreadnought.destroy=="function"&&this.starDreadnought.destroy(),this.introSounds&&(Object.values(this.introSounds).forEach(i=>{i.dispose&&typeof i.dispose=="function"&&i.dispose()}),this.introSounds={}),this.scene=null,this.camera=null,this.spaceship=null,this.audio=null,this.starDreadnought=null,this.portalEffect=null,this.dialogueSystem=null,this.dialogueWavs=[]}}export{Pe as IntroSequence};
//# sourceMappingURL=introSequence-BCk2nBwV.js.map
