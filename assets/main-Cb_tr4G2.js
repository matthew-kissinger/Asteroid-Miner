const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/game-core-OtPnLuF2.js","assets/three-DBvJLP14.js","assets/ecs-systems-DNfKaFsz.js","assets/vendor-D1adT2yx.js"])))=>i.map(i=>d[i]);
var y=Object.defineProperty;var f=(s,e,i)=>e in s?y(s,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):s[e]=i;var t=(s,e,i)=>f(s,typeof e!="symbol"?e+"":e,i);import{i as g,m as w,G as b,_ as n,a as v,S,D as _}from"./game-core-OtPnLuF2.js";import"./three-DBvJLP14.js";class E{constructor(){t(this,"initializer");t(this,"lifecycle");t(this,"difficultyManager");t(this,"hordeMode");t(this,"audioUpdater");t(this,"objectPools");t(this,"gameLoop");t(this,"boundAnimate");t(this,"startupSequence");t(this,"diagnostics");t(this,"isGameOver",!1);t(this,"introSequenceActive",!1);t(this,"gameTime",0);t(this,"isMobile",!1);t(this,"ui");t(this,"physics");t(this,"spaceship");t(this,"camera");t(this,"combat");t(this,"world");t(this,"renderer");t(this,"audio");t(this,"_environment");t(this,"_controls");t(this,"_updateECS");t(this,"handleResize",()=>{this.renderer&&this.renderer.handleResize()});t(this,"handleVisibilityChange",()=>{document.hidden?this.audio&&this.audio.pauseAllSounds():this.audio&&this.audio.resumeAllSounds()});t(this,"handleKeyDown",e=>{e.key==="Escape"&&this.ui&&this.ui.togglePauseMenu&&this.ui.togglePauseMenu()});g(),window.game=this,w.subscribe("game.over",e=>{this.lifecycle&&this.lifecycle.gameOver(e.reason||"Game Over")}),this.initializer=new b(this)}async initialize(){var e;try{await this.initializer.initializeCore(),this.isGameOver=!1,this.introSequenceActive=!1,this.gameTime=0,this.isMobile=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||window.matchMedia&&window.matchMedia("(max-width: 768px)").matches;const{DifficultyManager:i}=await n(async()=>{const{DifficultyManager:a}=await import("./game-core-OtPnLuF2.js").then(o=>o.d);return{DifficultyManager:a}},__vite__mapDeps([0,1]));this.difficultyManager=new i;const{HordeMode:r}=await n(async()=>{const{HordeMode:a}=await import("./game-core-OtPnLuF2.js").then(o=>o.h);return{HordeMode:a}},__vite__mapDeps([0,1]));this.hordeMode=new r(this);const{AudioUpdater:d}=await n(async()=>{const{AudioUpdater:a}=await import("./game-core-OtPnLuF2.js").then(o=>o.e);return{AudioUpdater:a}},__vite__mapDeps([0,1]));this.audioUpdater=new d(this);const{GameLifecycle:h}=await n(async()=>{const{GameLifecycle:a}=await import("./game-core-OtPnLuF2.js").then(o=>o.f);return{GameLifecycle:a}},__vite__mapDeps([0,1]));this.lifecycle=new h(this);const{ObjectPools:u}=await n(async()=>{const{ObjectPools:a}=await import("./game-core-OtPnLuF2.js").then(o=>o.j);return{ObjectPools:a}},__vite__mapDeps([0,1]));this.objectPools=new u(this),this.initializer.setupEventHandlers(),this.gameLoop=new v(this),this.boundAnimate=this.gameLoop.boundAnimate,this.ui&&this.ui.settings&&this.gameLoop.applyFrameRateSettings(),this.startupSequence=new S(this),this.diagnostics=new _(this);const{initECS:l,updateECS:p}=await n(async()=>{const{initECS:a,updateECS:o}=await import("./ecs-systems-DNfKaFsz.js").then(m=>m.i);return{initECS:a,updateECS:o}},__vite__mapDeps([2,1,3]));l((e=this.renderer)==null?void 0:e.scene),this._updateECS=p,this.startupSequence.initializeGameSequence()}catch(i){throw i}}async initIntroSequence(){await this.startupSequence.initIntroSequence()}async startIntroSequence(){await this.startupSequence.startIntroSequence()}completeIntroSequence(){this.startupSequence.completeIntroSequence()}preWarmBasicShaders(){this.objectPools.preWarmBasicShaders()}initializeObjectPools(){this.objectPools.initializeObjectPools()}startDocked(){this.initializer.startDocked()}setupEventHandlers(){this.initializer.setupEventHandlers()}initializeDifficultyManager(){}activateHordeMode(){this.hordeMode.activate()}getFormattedHordeSurvivalTime(){return this.hordeMode.getFormattedSurvivalTime()}updateAudio(){this.audioUpdater.update()}checkGameOver(){this.lifecycle.checkGameOver()}gameOver(e){this.lifecycle.gameOver(e)}cleanup(){this.lifecycle.cleanup()}destroy(){this.lifecycle.destroy()}update(e){if(!this.isGameOver){if(this.hordeMode.update(),this.physics.update(e),this._updateECS&&this._updateECS(e),this.spaceship.update&&this.spaceship.update(e),this.difficultyManager&&!this.introSequenceActive&&!this.spaceship.isDocked&&this.difficultyManager.update(e),this.ui&&this.ui.updateCoordinates&&this.spaceship&&this.spaceship.mesh){const i=this.spaceship.mesh.position;this.ui.updateCoordinates(i.x,i.y,i.z)}this.controls.update&&this.controls.update(),this.updateCombat(e),this.environment.update&&this.environment.update(e,this.camera),this.ui.update&&this.ui.update(e),this.updateAudio(),this.checkGameOver(),this.updateECSWorld(e)}}get environment(){return this._environment}set environment(e){this._environment=e}get controls(){return this._controls}set controls(e){this._controls=e}updateCombat(e){if(this.combat&&this.combat.updatePlayerReference)try{this.combat.updatePlayerReference()}catch{}else this.combat&&!this.combat.updatePlayerReference&&this.combat.createPlayerReferenceEntity&&!this.combat.playerEntity&&this.combat.createPlayerReferenceEntity();this.combat&&this.combat.update&&this.combat.update(e)}updateECSWorld(e){if(this.world&&!this.introSequenceActive)this.world.messageBus&&this.world.messageBus.fastPublish&&this.world.messageBus.fastPublish("world.preUpdate",{deltaTime:e}),this.world.systemManager.update(e),this.world.messageBus&&this.world.messageBus.fastPublish&&this.world.messageBus.fastPublish("world.postUpdate",{deltaTime:e});else if(this.world&&this.introSequenceActive&&this.world.entityManager&&this.world.systemManager)for(const i of this.world.systemManager.systems)i.constructor.name!=="EnemySystem"&&i.constructor.name!=="EnemyAISystem"&&i.constructor.name!=="CombatSystem"&&i.update(e)}}async function c(){try{const s=document.getElementById("loading-overlay");s&&setTimeout(()=>{s.style.opacity="0",s.style.transition="opacity 1s ease-in-out",setTimeout(()=>{s.parentNode&&s.remove()},1e3)},100),window.game=new E,await window.game.initialize()}catch(s){const e=document.createElement("div");e.style.position="fixed",e.style.top="50%",e.style.left="50%",e.style.transform="translate(-50%, -50%)",e.style.backgroundColor="rgba(0, 0, 0, 0.8)",e.style.color="#ff3030",e.style.padding="20px",e.style.borderRadius="10px",e.style.border="1px solid #ff3030",e.style.zIndex="9999",e.style.textAlign="center",e.style.fontFamily="Courier New, monospace",e.style.maxWidth="80%",e.innerHTML=`
            <h2>Error Starting Game</h2>
            <p>${s.message}</p>
            <p>Check the console for more details (F12).</p>
            <p>You can try refreshing the page or clearing your browser cache.</p>
            <button id="reload-button" style="background: #ff3030; color: white; border: none; padding: 10px; margin-top: 20px; cursor: pointer;">Reload Page</button>
        `,document.body.appendChild(e);const i=document.getElementById("reload-button");i&&i.addEventListener("click",()=>{const r=Date.now();window.location.href=window.location.pathname+"?cache="+r})}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",c):c();export{E as Game};
//# sourceMappingURL=main-Cb_tr4G2.js.map
