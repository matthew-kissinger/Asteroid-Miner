{"version":3,"file":"gameOverScreen-BN38I_7h.js","sources":["../../js/modules/ui/gameOverScreen.ts"],"sourcesContent":["// gameOverScreen.js - Handles the game over UI\n\nimport { getAbsolutePath } from '../../utils/pathUtils.ts';\n\ntype GameOverAudio = {\n    playSound?: (sound: string) => void;\n};\n\ntype HordeModeData = {\n    active: boolean;\n    survivalTime?: string;\n    rawSurvivalTime?: number;\n};\n\ntype GameOverResources = {\n    iron?: number;\n    gold?: number;\n    platinum?: number;\n    resources?: GameOverResources;\n    hordeMode?: HordeModeData;\n};\n\ntype GameOverMessage = {\n    data?: {\n        type?: string;\n        reason?: string;\n    };\n};\n\nexport class GameOverScreen {\n    isVisible: boolean;\n    audio?: GameOverAudio;\n\n    constructor() {\n        this.isVisible = false;\n        this.setupGameOverScreen();\n    }\n    \n    // Helper method to handle paths for GitHub Pages and local development\n    getPath(relativePath: string): string {\n        return getAbsolutePath(relativePath);\n    }\n    \n    setupGameOverScreen(): void {\n        // Add game over container (hidden initially)\n        const gameOverContainer = document.createElement('div');\n        gameOverContainer.id = 'game-over-container';\n        gameOverContainer.style.position = 'absolute';\n        gameOverContainer.style.top = '0';\n        gameOverContainer.style.left = '0';\n        gameOverContainer.style.width = '100%';\n        gameOverContainer.style.height = '100%';\n        gameOverContainer.style.backgroundColor = 'rgba(0, 0, 0, 0.8)';\n        gameOverContainer.style.display = 'flex';\n        gameOverContainer.style.flexDirection = 'column';\n        gameOverContainer.style.alignItems = 'center';\n        gameOverContainer.style.justifyContent = 'center';\n        gameOverContainer.style.color = '#fff';\n        gameOverContainer.style.fontFamily = 'Courier New, monospace';\n        gameOverContainer.style.zIndex = '1000';\n        gameOverContainer.style.display = 'none';\n        document.body.appendChild(gameOverContainer);\n        \n        // Game over title\n        const gameOverTitle = document.createElement('h1');\n        gameOverTitle.textContent = 'GAME OVER';\n        gameOverTitle.style.fontSize = '50px';\n        gameOverTitle.style.color = '#ff0000';\n        gameOverTitle.style.textShadow = '0 0 10px #ff0000';\n        gameOverTitle.style.marginBottom = '20px';\n        gameOverContainer.appendChild(gameOverTitle);\n        \n        // Game over message\n        const gameOverMessage = document.createElement('p');\n        gameOverMessage.id = 'game-over-message';\n        gameOverMessage.textContent = 'Your ship was destroyed by asteroid collision';\n        gameOverMessage.style.fontSize = '18px';\n        gameOverMessage.style.marginBottom = '40px';\n        gameOverContainer.appendChild(gameOverMessage);\n        \n        // Restart button\n        this.setupRestartButton(gameOverContainer);\n        \n        // Resources collected summary (for game over screen)\n        const resourcesSummary = document.createElement('div');\n        resourcesSummary.id = 'resources-summary';\n        resourcesSummary.style.marginTop = '30px';\n        resourcesSummary.style.fontSize = '16px';\n        resourcesSummary.style.textAlign = 'center';\n        gameOverContainer.appendChild(resourcesSummary);\n    }\n    \n    setupRestartButton(container: HTMLElement): void {\n        const restartButton = document.createElement('button');\n        restartButton.id = 'restart-game-button';\n        restartButton.textContent = 'RESTART MISSION';\n        restartButton.style.backgroundColor = 'rgba(120, 220, 232, 0.2)';\n        restartButton.style.color = '#fff';\n        restartButton.style.border = '1px solid rgba(120, 220, 232, 0.5)';\n        restartButton.style.borderRadius = '5px';\n        restartButton.style.padding = '15px 30px';\n        restartButton.style.fontSize = '20px';\n        restartButton.style.fontFamily = '\"Rajdhani\", sans-serif';\n        restartButton.style.cursor = 'pointer';\n        restartButton.style.marginTop = '30px';\n        restartButton.style.transition = 'all 0.2s ease';\n        \n        restartButton.addEventListener('mouseover', () => {\n            restartButton.style.backgroundColor = 'rgba(120, 220, 232, 0.4)';\n            restartButton.style.boxShadow = '0 0 15px rgba(120, 220, 232, 0.5)';\n        });\n        \n        restartButton.addEventListener('mouseout', () => {\n            restartButton.style.backgroundColor = 'rgba(120, 220, 232, 0.2)';\n            restartButton.style.boxShadow = 'none';\n        });\n        \n        restartButton.addEventListener('click', () => {\n            // Play the click sound\n            this.audio?.playSound?.('uiClick');\n            \n            // Show loading status\n            const loadingStatus = document.createElement('div');\n            loadingStatus.textContent = 'Restarting mission...';\n            loadingStatus.style.color = 'rgba(120, 220, 232, 0.9)';\n            loadingStatus.style.marginTop = '10px';\n            container.appendChild(loadingStatus);\n            \n            // Disable the button during reload\n            restartButton.disabled = true;\n            restartButton.style.opacity = '0.5';\n            restartButton.style.cursor = 'default';\n            \n            // Reset game state before reloading\n            // This is critical to ensure difficulty level resets properly\n            if (window.game) {\n                // Reset time-based difficulty scaling\n                if (window.game.difficultyManager) {\n                    window.game.difficultyManager.gameTime = 0;\n                    window.game.difficultyManager.currentLevel = 1;\n                    console.log(\"Reset difficulty level to 1\");\n                }\n                \n                // Reset game time counter\n                window.game.gameTime = 0;\n            }\n            \n            // Reload the page with a small delay to allow the UI update to be seen\n            setTimeout(() => {\n                location.reload();\n            }, 500);\n        });\n        \n        container.appendChild(restartButton);\n    }\n    \n    show(resources: unknown, message: unknown): void {\n        console.log(\"GameOverScreen: Showing game over screen\");\n        \n        // Show game over screen\n        const gameOverContainer = document.getElementById('game-over-container') as HTMLDivElement | null;\n        if (gameOverContainer) {\n            gameOverContainer.style.display = 'flex';\n        }\n        \n        // Set message based on reason\n        const gameOverMessage = document.getElementById('game-over-message') as HTMLParagraphElement | null;\n        const typedMessage = message as string | GameOverMessage | null;\n        if (gameOverMessage) {\n            // Default message\n            let displayMessage = 'Your journey has ended.';\n            \n            // Check if we received a reason type or just a string message\n            if (typeof typedMessage === 'object' && typedMessage?.data && typedMessage.data.type) {\n                // Use the type field for more reliable message categorization\n                const reasonType = typedMessage.data.type;\n                \n                switch (reasonType) {\n                    case 'FUEL_DEPLETED':\n                        displayMessage = 'Your ship drifted into the void after running out of fuel.';\n                        break;\n                    case 'COLLISION_ASTEROID':\n                        displayMessage = 'Your ship was destroyed by an asteroid collision.';\n                        break;\n                    case 'COLLISION_PLANET':\n                        displayMessage = 'Your ship crashed into a planet!';\n                        break;\n                    case 'COMBAT_DEATH':\n                        displayMessage = 'Your ship was destroyed in combat.';\n                        break;\n                    case 'SUN_DEATH':\n                        displayMessage = \"Your ship was incinerated by the sun's heat!\";\n                        break;\n                    default:\n                        // If we have a reason string but don't recognize the type\n                        if (typedMessage.data.reason) {\n                            displayMessage = typedMessage.data.reason;\n                        }\n                }\n            } else if (typeof typedMessage === 'string' && typedMessage.length > 0) {\n                // Fallback to string content checking for backward compatibility\n                if (typedMessage.includes(\"fuel\")) {\n                    displayMessage = 'Your ship drifted into the void after running out of fuel.';\n                } else if (typedMessage.includes(\"asteroid\")) {\n                    displayMessage = 'Your ship was destroyed by an asteroid collision.';\n                } else if (typedMessage.includes(\"combat\")) {\n                    displayMessage = 'Your ship was destroyed in combat.';\n                } else if (typedMessage.includes(\"sun\")) {\n                    displayMessage = \"Your ship was incinerated by the sun's heat!\";\n                } else if (typedMessage.includes(\"planet\")) {\n                    displayMessage = \"Your ship crashed into a planet!\";\n                } else {\n                    // Use the provided message if none of our standardized reasons match\n                    displayMessage = typedMessage;\n                }\n            }\n            \n            gameOverMessage.textContent = displayMessage;\n        }\n        \n        // Check if game was in horde mode\n        let wasHordeMode = false;\n        let hordeSurvivalTime = \"00:00\";\n        let rawSurvivalTime = 0;\n        \n        const typedResources = resources as GameOverResources | null;\n        if (typedResources && typedResources.hordeMode) {\n            wasHordeMode = typedResources.hordeMode.active;\n            hordeSurvivalTime = typedResources.hordeMode.survivalTime || \"00:00\";\n            rawSurvivalTime = typedResources.hordeMode.rawSurvivalTime || 0;\n        }\n        \n        // Handle different resource data formats\n        // It might be wrapped in a gameStats structure or come directly\n        let resourceData = typedResources;\n        \n        // Check if resources has a nested resources property (from gameOver method in game.js)\n        if (typedResources && typedResources.resources) {\n            console.log(\"GameOverScreen: Using nested resources data structure\");\n            resourceData = typedResources.resources;\n        }\n        \n        // Ensure we have valid resource values with defaults\n        const iron = resourceData && resourceData.iron ? resourceData.iron : 0;\n        const gold = resourceData && resourceData.gold ? resourceData.gold : 0;\n        const platinum = resourceData && resourceData.platinum ? resourceData.platinum : 0;\n        \n        // Update resources summary with guaranteed safe values\n        const resourcesSummary = document.getElementById('resources-summary') as HTMLDivElement | null;\n        if (resourcesSummary) {\n            // Create horde mode section if applicable\n            if (wasHordeMode) {\n                // Get minutes for special messages\n                const minutes = Math.floor(rawSurvivalTime / 1000 / 60);\n                \n                // Determine message based on survival time\n                let hordeMessage = \"You fought valiantly against overwhelming odds.\";\n                if (minutes >= 10) {\n                    hordeMessage = \"LEGENDARY! Few have survived the horde this long!\";\n                } else if (minutes >= 5) {\n                    hordeMessage = \"IMPRESSIVE! You showed exceptional combat skills!\";\n                } else if (minutes >= 3) {\n                    hordeMessage = \"Well done! You held back the horde longer than most!\";\n                }\n                \n                resourcesSummary.innerHTML = `\n                    <div style=\"margin-bottom:20px; padding:15px; background-color:rgba(255,48,48,0.2); border:1px solid #ff3030; border-radius:5px;\">\n                        <h3 style=\"color:#ff3030; margin-top:0; text-shadow:0 0 5px rgba(255,48,48,0.5);\">HORDE MODE</h3>\n                        <p style=\"font-size:18px; font-weight:bold;\">SURVIVED: <span style=\"color:#ff9999; text-shadow:0 0 5px rgba(255,48,48,0.3);\">${hordeSurvivalTime}</span></p>\n                        <p>${hordeMessage}</p>\n                    </div>\n                    <p>Resources collected:</p>\n                    <p>IRON: ${iron} | GOLD: ${gold} | PLATINUM: ${platinum}</p>\n                `;\n            } else {\n                resourcesSummary.innerHTML = `\n                    <p>Resources collected:</p>\n                    <p>IRON: ${iron} | GOLD: ${gold} | PLATINUM: ${platinum}</p>\n                `;\n            }\n        }\n        \n        // Simpler approach to play explosion sound as a backup\n        try {\n            console.log(\"GameOverScreen: Attempting simple audio playback\");\n            \n            // Create a direct audio element without attaching to DOM\n            const boinkSound = new Audio(this.getPath('sounds/effects/boink.wav'));\n            boinkSound.volume = 0.8;\n            \n            // Play with a slight delay to avoid conflict with other sounds\n            setTimeout(() => {\n                boinkSound.play().catch(err => {\n                    console.warn(\"GameOverScreen: Simple sound failed:\", err);\n                });\n            }, 100);\n            \n        } catch (err) {\n            console.error(\"GameOverScreen: Error with simple sound approach:\", err);\n        }\n        \n        // Lock pointer to prevent camera movement after game over\n        if (document.exitPointerLock) {\n            document.exitPointerLock();\n        }\n    }\n} \n"],"names":["GameOverScreen","__publicField","relativePath","getAbsolutePath","gameOverContainer","gameOverTitle","gameOverMessage","resourcesSummary","container","restartButton","_b","_a","loadingStatus","resources","message","typedMessage","displayMessage","wasHordeMode","hordeSurvivalTime","rawSurvivalTime","typedResources","resourceData","iron","gold","platinum","minutes","hordeMessage","boinkSound","err"],"mappings":"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"}