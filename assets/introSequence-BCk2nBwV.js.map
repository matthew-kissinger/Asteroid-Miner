{"version":3,"file":"introSequence-BCk2nBwV.js","sources":["../../js/modules/environment/dreadnought/structure/hull.ts","../../js/modules/environment/dreadnought/structure/bridge.ts","../../js/modules/environment/dreadnought/systems/engines.ts","../../js/modules/environment/dreadnought/systems/weapons.ts","../../js/modules/environment/dreadnought/teleporter/beam.ts","../../js/modules/environment/dreadnought/teleporter/particles.ts","../../js/modules/environment/dreadnought/teleporter/controller.ts","../../js/modules/environment/dreadnought/starDreadnought.ts","../../js/modules/intro/audio/soundEffects.ts","../../js/modules/intro/audio/dialogueManager.ts","../../js/modules/intro/effects/portalEffect.ts","../../js/modules/intro/ui/dialogueSystem.ts","../../js/modules/intro/animation/arrivalPhase.ts","../../js/modules/intro/animation/departurePhase.ts","../../js/modules/introSequence.ts"],"sourcesContent":["// hull.ts - Creates the main hull structure for the Star Dreadnought\n\nimport * as THREE from 'three';\n\nexport class DreadnoughtHull {\n    static createMainHull(scale: number, ship: THREE.Group): THREE.Mesh {\n        // Create main hull using custom geometry for the distinctive arrow/dagger shape\n        const hullLength = scale;\n        const hullWidth = scale * 0.22;\n        const hullHeight = scale * 0.06;\n        const taperFactor = 0.15; // How much the front tapers\n\n        // Create geometry for the main hull shape\n        const hullGeometry = new THREE.BufferGeometry();\n        \n        // Define vertices for the hull shape (triangulated)\n        const vertices: Float32Array = new Float32Array([\n            // Bottom face\n            -hullWidth/2, -hullHeight/2, hullLength/2,  // bottom left back\n            hullWidth/2, -hullHeight/2, hullLength/2,   // bottom right back\n            -hullWidth*taperFactor, -hullHeight/2, -hullLength/2, // bottom left front\n            \n            hullWidth/2, -hullHeight/2, hullLength/2,   // bottom right back\n            hullWidth*taperFactor, -hullHeight/2, -hullLength/2,  // bottom right front\n            -hullWidth*taperFactor, -hullHeight/2, -hullLength/2, // bottom left front\n            \n            // Top face\n            -hullWidth/2, hullHeight/2, hullLength/2,  // top left back\n            -hullWidth*taperFactor, hullHeight/2, -hullLength/2, // top left front\n            hullWidth/2, hullHeight/2, hullLength/2,   // top right back\n            \n            hullWidth/2, hullHeight/2, hullLength/2,   // top right back\n            -hullWidth*taperFactor, hullHeight/2, -hullLength/2, // top left front\n            hullWidth*taperFactor, hullHeight/2, -hullLength/2,  // top right front\n            \n            // Left face\n            -hullWidth/2, -hullHeight/2, hullLength/2,  // bottom left back\n            -hullWidth/2, hullHeight/2, hullLength/2,   // top left back\n            -hullWidth*taperFactor, -hullHeight/2, -hullLength/2, // bottom left front\n            \n            -hullWidth/2, hullHeight/2, hullLength/2,   // top left back\n            -hullWidth*taperFactor, hullHeight/2, -hullLength/2,  // top left front\n            -hullWidth*taperFactor, -hullHeight/2, -hullLength/2, // bottom left front\n            \n            // Right face\n            hullWidth/2, -hullHeight/2, hullLength/2,  // bottom right back\n            hullWidth*taperFactor, -hullHeight/2, -hullLength/2, // bottom right front\n            hullWidth/2, hullHeight/2, hullLength/2,   // top right back\n            \n            hullWidth/2, hullHeight/2, hullLength/2,   // top right back\n            hullWidth*taperFactor, -hullHeight/2, -hullLength/2, // bottom right front\n            hullWidth*taperFactor, hullHeight/2, -hullLength/2,  // top right front\n            \n            // Back face\n            -hullWidth/2, -hullHeight/2, hullLength/2,  // bottom left back\n            -hullWidth/2, hullHeight/2, hullLength/2,   // top left back\n            hullWidth/2, -hullHeight/2, hullLength/2,   // bottom right back\n            \n            hullWidth/2, -hullHeight/2, hullLength/2,   // bottom right back\n            -hullWidth/2, hullHeight/2, hullLength/2,   // top left back\n            hullWidth/2, hullHeight/2, hullLength/2,    // top right back\n            \n            // Front face (pointed)\n            -hullWidth*taperFactor, -hullHeight/2, -hullLength/2, // bottom left front\n            -hullWidth*taperFactor, hullHeight/2, -hullLength/2,  // top left front\n            hullWidth*taperFactor, -hullHeight/2, -hullLength/2,  // bottom right front\n            \n            hullWidth*taperFactor, -hullHeight/2, -hullLength/2,  // bottom right front\n            -hullWidth*taperFactor, hullHeight/2, -hullLength/2,  // top left front\n            hullWidth*taperFactor, hullHeight/2, -hullLength/2    // top right front\n        ]);\n        \n        // Add attributes to the geometry\n        hullGeometry.setAttribute('position', new THREE.BufferAttribute(vertices, 3));\n        \n        // Material for the main hull - metallic dark gray\n        const hullMaterial = new THREE.MeshStandardMaterial({\n            color: 0x333344,\n            metalness: 0.8,\n            roughness: 0.3,\n            emissive: 0x111111,\n            emissiveIntensity: 0.2\n        });\n        \n        // Create the hull mesh\n        const hull = new THREE.Mesh(hullGeometry, hullMaterial);\n        hull.geometry.computeVertexNormals(); // Auto-generate normals\n        \n        // Cast shadows\n        hull.castShadow = true;\n        hull.receiveShadow = true;\n        \n        // Add to ship group\n        ship.add(hull);\n        \n        // Add additional hull plates for more detail\n        this.addHullPlates(scale, ship);\n\n        return hull;\n    }\n\n    static addHullPlates(scale: number, ship: THREE.Group): void {\n        // Add additional hull plates for more detail and segmentation\n        const plateLength = scale * 0.2;\n        const plateWidth = scale * 0.18;\n        const plateHeight = scale * 0.01;\n        const plateY = scale * 0.035; // Just above the hull\n        \n        // Create 5 plates down the center of the ship\n        for (let i = 0; i < 5; i++) {\n            const plateZ = scale * 0.4 - (i * plateLength);\n            \n            const plateGeometry = new THREE.BoxGeometry(plateWidth, plateHeight, plateLength);\n            const plateMaterial = new THREE.MeshStandardMaterial({\n                color: 0x444455,\n                metalness: 0.7,\n                roughness: 0.4,\n                emissive: 0x222222\n            });\n            \n            const plate = new THREE.Mesh(plateGeometry, plateMaterial);\n            plate.position.set(0, plateY, plateZ);\n            \n            plate.castShadow = true;\n            plate.receiveShadow = true;\n            \n            ship.add(plate);\n        }\n    }\n}","// bridge.ts - Creates the command bridge and tower structures for the Star Dreadnought\n\nimport * as THREE from 'three';\n\ninterface BridgeComponents {\n    mainTower: THREE.Mesh;\n    leftTower: THREE.Mesh;\n    rightTower: THREE.Mesh;\n}\n\nexport class DreadnoughtBridge {\n    static createCommandBridge(scale: number, ship: THREE.Group): BridgeComponents {\n        // Command bridge superstructure - distinctive two-tower design\n        const bridgeHeight = scale * 0.12;\n        const bridgeWidth = scale * 0.06;\n        const bridgeDepth = scale * 0.08;\n        const bridgeY = scale * 0.085; // Position on top of hull\n        const bridgeZ = scale * 0.28; // Position toward the back\n\n        // Bridge material - slightly lighter than hull\n        const bridgeMaterial = new THREE.MeshStandardMaterial({\n            color: 0x555566,\n            metalness: 0.7,\n            roughness: 0.3,\n            emissive: 0x222222,\n            emissiveIntensity: 0.2\n        });\n\n        // Main command tower (larger)\n        const mainTowerGeometry = new THREE.BoxGeometry(bridgeWidth, bridgeHeight, bridgeDepth);\n        const mainTower = new THREE.Mesh(mainTowerGeometry, bridgeMaterial);\n        mainTower.position.set(0, bridgeY, bridgeZ);\n        mainTower.castShadow = true;\n        mainTower.receiveShadow = true;\n        ship.add(mainTower);\n\n        // Add windows to the bridge\n        this.addBridgeWindows(scale, ship, bridgeY, bridgeZ);\n\n        // Secondary command towers (smaller)\n        const secondaryTowerScale = 0.7; // 70% the size of main tower\n        const secondaryTowerGeometry = new THREE.BoxGeometry(\n            bridgeWidth * secondaryTowerScale,\n            bridgeHeight * secondaryTowerScale,\n            bridgeDepth * secondaryTowerScale\n        );\n\n        // Left tower\n        const leftTower = new THREE.Mesh(secondaryTowerGeometry, bridgeMaterial);\n        leftTower.position.set(-bridgeWidth * 1.2, bridgeY, bridgeZ + bridgeDepth * 0.6);\n        leftTower.castShadow = true;\n        leftTower.receiveShadow = true;\n        ship.add(leftTower);\n\n        // Right tower\n        const rightTower = new THREE.Mesh(secondaryTowerGeometry, bridgeMaterial);\n        rightTower.position.set(bridgeWidth * 1.2, bridgeY, bridgeZ + bridgeDepth * 0.6);\n        rightTower.castShadow = true;\n        rightTower.receiveShadow = true;\n        ship.add(rightTower);\n\n        return { mainTower, leftTower, rightTower };\n    }\n\n    static addBridgeWindows(scale: number, ship: THREE.Group, bridgeY: number, bridgeZ: number): void {\n        // Add illuminated windows to the bridge\n        const windowSize = scale * 0.003;\n        const windowSpacing = scale * 0.006;\n        const windowRows = 6;\n        const windowCols = 10;\n        const windowsStartY = bridgeY - scale * 0.02;\n        const windowDepth = scale * 0.001;\n\n        // Window material - emissive for glow\n        const windowMaterial = new THREE.MeshStandardMaterial({\n            color: 0xaabbcc,\n            emissive: 0xaabbcc,\n            emissiveIntensity: 1.0,\n            transparent: true,\n            opacity: 0.9\n        });\n\n        // Create window instances\n        for (let row = 0; row < windowRows; row++) {\n            for (let col = 0; col < windowCols; col++) {\n                // Random chance to skip a window (for variety)\n                if (Math.random() > 0.85) continue;\n\n                const windowGeometry = new THREE.BoxGeometry(windowSize, windowSize, windowDepth);\n                const window = new THREE.Mesh(windowGeometry, windowMaterial);\n\n                // Position window on the front face of the bridge\n                window.position.set(\n                    (col - windowCols / 2) * windowSpacing,\n                    windowsStartY + row * windowSpacing,\n                    bridgeZ + scale * 0.04 + windowDepth\n                );\n\n                ship.add(window);\n            }\n        }\n    }\n}","// engines.ts - Creates engine array, particles, and power control for the Star Dreadnought\n\nimport * as THREE from 'three';\n\ninterface EngineArrayResult {\n    engineHousing: THREE.Mesh;\n    engineGlows: THREE.Mesh[];\n}\n\nexport class DreadnoughtEngines {\n    engineGlows: THREE.Mesh[];\n    engineTrailParticles: THREE.Points | null;\n\n    constructor() {\n        this.engineGlows = [];\n        this.engineTrailParticles = null;\n    }\n\n    createEngineArray(scale: number, ship: THREE.Group): EngineArrayResult {\n        // Create engine array at the back of the ship\n        const engineRadius = scale * 0.018;\n        const engineLength = scale * 0.04;\n        const engineZ = scale * 0.48; // Position at the back\n        const engineY = scale * 0.01; // Slightly above center line\n        \n        // Engine housing\n        const engineHousingWidth = scale * 0.2;\n        const engineHousingHeight = scale * 0.05;\n        const engineHousingLength = scale * 0.06;\n        \n        const housingGeometry = new THREE.BoxGeometry(engineHousingWidth, engineHousingHeight, engineHousingLength);\n        const housingMaterial = new THREE.MeshStandardMaterial({\n            color: 0x333344,\n            metalness: 0.8,\n            roughness: 0.4\n        });\n        \n        const engineHousing = new THREE.Mesh(housingGeometry, housingMaterial);\n        engineHousing.position.set(0, engineY, engineZ);\n        engineHousing.castShadow = true;\n        engineHousing.receiveShadow = true;\n        ship.add(engineHousing);\n        \n        // Engine exhaust material - blue glow for Star Wars style\n        const engineMaterial = new THREE.MeshStandardMaterial({\n            color: 0x3366ff,\n            emissive: 0x3366ff,\n            emissiveIntensity: 0.7,\n            transparent: true,\n            opacity: 0.7\n        });\n        \n        // Glow material (fully emissive)\n        const glowMaterial = new THREE.MeshStandardMaterial({\n            color: 0x3366ff,\n            emissive: 0x3366ff,\n            emissiveIntensity: 1.5,\n            transparent: true,\n            opacity: 0.8\n        });\n        \n        // Create engine exhausts - two rows of engines for Star Destroyer style\n        const engineRows = 2;\n        const enginesPerRow = 5;\n        const verticalSpacing = engineHousingHeight * 0.5;\n        \n        for (let row = 0; row < engineRows; row++) {\n            const rowY = engineY - verticalSpacing * (row - 0.5);\n            \n            for (let i = 0; i < enginesPerRow; i++) {\n                // Distribute engines across the width\n                const posX = (i - (enginesPerRow - 1) / 2) * (engineHousingWidth / (enginesPerRow - 1) * 0.8);\n                \n                // Engine exhaust\n                const engineGeometry = new THREE.CylinderGeometry(engineRadius, engineRadius * 1.5, engineLength, 16);\n                const engine = new THREE.Mesh(engineGeometry, engineMaterial);\n                \n                // Position and orient the engine\n                engine.position.set(posX, rowY, engineZ + engineHousingLength * 0.5);\n                engine.rotation.x = Math.PI / 2; // Orient horizontally\n                \n                ship.add(engine);\n                \n                // Add engine glow with additional outer glow\n                const glowGeometry = new THREE.SphereGeometry(engineRadius * 1.6, 16, 16);\n                const glow = new THREE.Mesh(glowGeometry, glowMaterial.clone());\n                glow.position.set(posX, rowY, engineZ + engineHousingLength * 0.5 + engineLength * 1.1);\n                \n                ship.add(glow);\n                this.engineGlows.push(glow);\n                \n                // Add additional outer glow for more dramatic effect\n                const outerGlowGeometry = new THREE.SphereGeometry(engineRadius * 2.5, 16, 16);\n                const outerGlowMaterial = glowMaterial.clone();\n                outerGlowMaterial.opacity = 0.4;\n                const outerGlow = new THREE.Mesh(outerGlowGeometry, outerGlowMaterial);\n                outerGlow.position.copy(glow.position);\n                \n                ship.add(outerGlow);\n                this.engineGlows.push(outerGlow);\n            }\n        }\n        \n        // Add engine trail particles\n        this.createEngineTrailParticles(scale, engineZ, engineHousingWidth, ship);\n\n        return { engineHousing, engineGlows: this.engineGlows };\n    }\n\n    createEngineTrailParticles(scale: number, engineZ: number, width: number, ship: THREE.Group): void {\n        const particleCount = 200;\n        const particleGeometry = new THREE.BufferGeometry();\n\n        // Create arrays for particle properties\n        const positions: Float32Array = new Float32Array(particleCount * 3);\n        const colors: Float32Array = new Float32Array(particleCount * 3);\n        const sizes: Float32Array = new Float32Array(particleCount);\n        \n        // Engine positions to emit particles from\n        const enginePositions: number[] = [];\n        const enginesPerRow = 5;\n\n        for (let i = 0; i < enginesPerRow; i++) {\n            const posX = (i - (enginesPerRow - 1) / 2) * (width / (enginesPerRow - 1) * 0.8);\n            enginePositions.push(posX);\n        }\n        \n        // Initialize particles\n        for (let i = 0; i < particleCount; i++) {\n            const i3 = i * 3;\n            \n            // Choose an engine position to emit from\n            const engineIndex = Math.floor(Math.random() * enginePositions.length);\n            const engineX = enginePositions[engineIndex];\n            \n            // Random offset from engine\n            const offsetX = (Math.random() - 0.5) * scale * 0.01;\n            const offsetY = (Math.random() - 0.5) * scale * 0.01;\n            \n            // Position behind the engine\n            const trailLength = Math.random() * scale * 0.5;\n\n            positions[i3] = engineX + offsetX; // x\n            positions[i3 + 1] = offsetY; // y\n            positions[i3 + 2] = engineZ + engineX * 0.05 + trailLength; // z with slight angle\n\n            // Blue-white colors for engine glow\n            colors[i3] = 0.5 + Math.random() * 0.5; // r\n            colors[i3 + 1] = 0.7 + Math.random() * 0.3; // g\n            colors[i3 + 2] = 1.0; // b\n\n            // Different sizes for depth\n            sizes[i] = (Math.random() * 0.5 + 0.5) * scale * 0.004;\n        }\n\n        // Add attributes to geometry\n        particleGeometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));\n        particleGeometry.setAttribute('color', new THREE.BufferAttribute(colors, 3));\n        particleGeometry.setAttribute('size', new THREE.BufferAttribute(sizes, 1));\n\n        // Particle material with custom shader\n        const particleMaterial = new THREE.ShaderMaterial({\n            uniforms: {\n                time: { value: 0 },\n                pointTexture: { value: this.createParticleTexture() }\n            },\n            vertexShader: `\n                attribute float size;\n                attribute vec3 color;\n                varying vec3 vColor;\n                uniform float time;\n                \n                void main() {\n                    vColor = color;\n                    \n                    // Animate size with time\n                    float pulseFactor = sin(time * 2.0 + position.z * 0.1) * 0.3 + 0.7;\n                    \n                    // Calculate position\n                    vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n                    \n                    // Size attenuation\n                    gl_PointSize = size * pulseFactor * (300.0 / -mvPosition.z);\n                    gl_Position = projectionMatrix * mvPosition;\n                }\n            `,\n            fragmentShader: `\n                uniform sampler2D pointTexture;\n                varying vec3 vColor;\n                \n                void main() {\n                    // Sample soft particle texture\n                    vec4 texColor = texture2D(pointTexture, gl_PointCoord);\n                    \n                    // Apply color\n                    gl_FragColor = vec4(vColor, texColor.r);\n                }\n            `,\n            transparent: true,\n            depthWrite: false,\n            blending: THREE.AdditiveBlending,\n            vertexColors: true\n        });\n\n        // Create particle system\n        this.engineTrailParticles = new THREE.Points(particleGeometry, particleMaterial);\n        ship.add(this.engineTrailParticles);\n    }\n\n    createParticleTexture(): THREE.Texture {\n        const canvas = document.createElement('canvas');\n        canvas.width = 64;\n        canvas.height = 64;\n\n        const context = canvas.getContext('2d');\n        if (!context) throw new Error('Could not get 2D context');\n\n        const gradient = context.createRadialGradient(32, 32, 0, 32, 32, 32);\n\n        gradient.addColorStop(0, 'rgba(255,255,255,1)');\n        gradient.addColorStop(0.3, 'rgba(255,255,255,0.8)');\n        gradient.addColorStop(0.5, 'rgba(255,255,255,0.4)');\n        gradient.addColorStop(1, 'rgba(255,255,255,0)');\n\n        context.fillStyle = gradient;\n        context.fillRect(0, 0, 64, 64);\n\n        const texture = new THREE.Texture(canvas);\n        texture.needsUpdate = true;\n        return texture;\n    }\n\n    // Set engines power level (0-1)\n    setEnginesPower(power: number): void {\n        // Adjust engine glow intensity based on power level\n        this.engineGlows.forEach((glow: THREE.Mesh, index: number) => {\n            // Alternate between main glow and outer glow\n            const isMainGlow = index % 2 === 0;\n\n            const material = glow.material as THREE.MeshStandardMaterial;\n            if (isMainGlow) {\n                // Main engine glow - brighter\n                material.emissiveIntensity = 0.8 + power * 1.2;\n                material.opacity = 0.5 + power * 0.5;\n            } else {\n                // Outer engine glow - softer\n                material.emissiveIntensity = 0.5 + power * 0.8;\n                material.opacity = 0.2 + power * 0.3;\n            }\n\n            // Scale the glow with power\n            const glowScale = 1 + power * 0.8;\n            glow.scale.set(glowScale, glowScale, glowScale * 1.2); // Stretch slightly on z-axis\n        });\n\n        // Update engine trail particles\n        if (this.engineTrailParticles) {\n            this.engineTrailParticles.visible = power > 0.2;\n\n            // Scale particle sizes based on power\n            if (this.engineTrailParticles.geometry.attributes.size) {\n                const sizes = this.engineTrailParticles.geometry.attributes.size.array as Float32Array;\n                const baseSizes = (this.engineTrailParticles.userData.baseSizes as Float32Array) ||\n                    Array.from(sizes); // Store original sizes if not saved\n\n                // Save original sizes\n                if (!this.engineTrailParticles.userData.baseSizes) {\n                    this.engineTrailParticles.userData.baseSizes = baseSizes;\n                }\n\n                // Scale sizes\n                for (let i = 0; i < sizes.length; i++) {\n                    sizes[i] = (baseSizes as any)[i] * (1 + power * 2);\n                }\n\n                this.engineTrailParticles.geometry.attributes.size.needsUpdate = true;\n            }\n        }\n    }\n\n    // Update engine trail particles animation\n    updateEngineTrails(): void {\n        if (this.engineTrailParticles && this.engineTrailParticles.material instanceof THREE.ShaderMaterial) {\n            this.engineTrailParticles.material.uniforms.time.value += 0.02;\n        }\n    }\n}","// weapons.ts - Creates turrets and surface details for the Star Dreadnought\n\nimport * as THREE from 'three';\n\ninterface ShieldGenerators {\n    portDome: THREE.Mesh;\n    starboardDome: THREE.Mesh;\n}\n\nexport class DreadnoughtWeapons {\n    static createSurfaceDetails(scale: number, ship: THREE.Group): void {\n        // Add surface details for more visual interest\n\n        // Turrets along the sides\n        this.createTurrets(scale, ship);\n\n        // Trenches and surface details\n        this.createSurfaceTrenches(scale, ship);\n\n        // Shield generator domes\n        this.createShieldGenerators(scale, ship);\n    }\n\n    static createTurrets(scale: number, ship: THREE.Group): void {\n        // Create turret batteries along the sides\n        const turretRadius = scale * 0.008;\n        const turretHeight = scale * 0.01;\n        const baseRadius = scale * 0.01;\n        const baseHeight = scale * 0.005;\n\n        // Turret material\n        const turretMaterial = new THREE.MeshStandardMaterial({\n            color: 0x666677,\n            metalness: 0.7,\n            roughness: 0.3\n        });\n\n        // Positions for turrets (port side)\n        const portPositions: number[][] = [];\n        for (let i = 0; i < 12; i++) {\n            const z = scale * 0.2 - (i * scale * 0.07);\n            portPositions.push([-scale * 0.1, scale * 0.035, z]);\n        }\n\n        // Create port side turrets\n        portPositions.forEach((pos: number[]) => {\n            // Turret base\n            const baseGeometry = new THREE.CylinderGeometry(baseRadius, baseRadius, baseHeight, 8);\n            const base = new THREE.Mesh(baseGeometry, turretMaterial);\n            base.position.set(pos[0], pos[1], pos[2]);\n            ship.add(base);\n            \n            // Turret gun\n            const turretGeometry = new THREE.CylinderGeometry(turretRadius, turretRadius, turretHeight, 8);\n            const turret = new THREE.Mesh(turretGeometry, turretMaterial);\n            turret.position.set(pos[0], pos[1] + baseHeight * 0.5 + turretHeight * 0.5, pos[2]);\n            turret.rotation.x = Math.PI / 2; // Orient horizontally\n            turret.rotation.z = -Math.PI / 6; // Angle outward\n            ship.add(turret);\n        });\n\n        // Positions for turrets (starboard side)\n        const starboardPositions: number[][] = [];\n        for (let i = 0; i < 12; i++) {\n            const z = scale * 0.2 - (i * scale * 0.07);\n            starboardPositions.push([scale * 0.1, scale * 0.035, z]);\n        }\n\n        // Create starboard side turrets\n        starboardPositions.forEach((pos: number[]) => {\n            // Turret base\n            const baseGeometry = new THREE.CylinderGeometry(baseRadius, baseRadius, baseHeight, 8);\n            const base = new THREE.Mesh(baseGeometry, turretMaterial);\n            base.position.set(pos[0], pos[1], pos[2]);\n            ship.add(base);\n            \n            // Turret gun\n            const turretGeometry = new THREE.CylinderGeometry(turretRadius, turretRadius, turretHeight, 8);\n            const turret = new THREE.Mesh(turretGeometry, turretMaterial);\n            turret.position.set(pos[0], pos[1] + baseHeight * 0.5 + turretHeight * 0.5, pos[2]);\n            turret.rotation.x = Math.PI / 2; // Orient horizontally\n            turret.rotation.z = Math.PI / 6; // Angle outward\n            ship.add(turret);\n        });\n    }\n\n    static createSurfaceTrenches(scale: number, ship: THREE.Group): void {\n        // Create surface trenches and details\n        const trenchWidth = scale * 0.01;\n        const trenchDepth = scale * 0.01;\n        const trenchLength = scale * 0.3;\n        \n        // Trench material - darker than hull\n        const trenchMaterial = new THREE.MeshStandardMaterial({\n            color: 0x222233,\n            metalness: 0.7,\n            roughness: 0.8,\n            emissive: 0x111122,\n            emissiveIntensity: 0.3\n        });\n        \n        // Center trench (inspired by Death Star trench)\n        const centerTrenchGeometry = new THREE.BoxGeometry(trenchWidth, trenchDepth, trenchLength);\n        const centerTrench = new THREE.Mesh(centerTrenchGeometry, trenchMaterial);\n        centerTrench.position.set(0, scale * 0.035, scale * 0.1);\n        ship.add(centerTrench);\n        \n        // Side trenches\n        const sideTrenchGeometry = new THREE.BoxGeometry(trenchWidth, trenchDepth, trenchLength * 0.7);\n        \n        // Port side trench\n        const portTrench = new THREE.Mesh(sideTrenchGeometry, trenchMaterial);\n        portTrench.position.set(-scale * 0.07, scale * 0.035, scale * 0.05);\n        ship.add(portTrench);\n        \n        // Starboard side trench\n        const starboardTrench = new THREE.Mesh(sideTrenchGeometry, trenchMaterial);\n        starboardTrench.position.set(scale * 0.07, scale * 0.035, scale * 0.05);\n        ship.add(starboardTrench);\n    }\n\n    static createShieldGenerators(scale: number, ship: THREE.Group): ShieldGenerators {\n        // Create shield generator domes\n        const domeRadius = scale * 0.02;\n        const domeY = scale * 0.05;\n        const domeZ = scale * 0.35;\n        \n        // Dome material - slightly transparent blue\n        const domeMaterial = new THREE.MeshStandardMaterial({\n            color: 0x3366aa,\n            metalness: 0.2,\n            roughness: 0.3,\n            transparent: true,\n            opacity: 0.6,\n            emissive: 0x112244,\n            emissiveIntensity: 0.3\n        });\n        \n        // Port side shield generator\n        const portDomeGeometry = new THREE.SphereGeometry(domeRadius, 16, 16, 0, Math.PI * 2, 0, Math.PI / 2);\n        const portDome = new THREE.Mesh(portDomeGeometry, domeMaterial);\n        portDome.position.set(-scale * 0.08, domeY, domeZ);\n        portDome.rotation.x = Math.PI; // Orient half-sphere\n        ship.add(portDome);\n        \n        // Starboard side shield generator\n        const starboardDomeGeometry = new THREE.SphereGeometry(domeRadius, 16, 16, 0, Math.PI * 2, 0, Math.PI / 2);\n        const starboardDome = new THREE.Mesh(starboardDomeGeometry, domeMaterial);\n        starboardDome.position.set(scale * 0.08, domeY, domeZ);\n        starboardDome.rotation.x = Math.PI; // Orient half-sphere\n        ship.add(starboardDome);\n        \n        return { portDome, starboardDome };\n    }\n}","// beam.ts - Creates the teleport beam and impact ring for the Star Dreadnought\n\nimport * as THREE from 'three';\n\nexport class TeleportBeam {\n    static createTeleportBeam(scale: number, ship: THREE.Group): THREE.Mesh {\n        // Create teleport beam (initially inactive)\n        const beamTopRadius = scale * 0.03;\n        const beamBottomRadius = scale * 0.2; // Much wider at bottom for dramatic beam\n        const beamHeight = scale * 0.8; // Longer beam to reach further\n\n        // Custom shader material for energy beam effect with more dynamic patterns\n        const beamMaterial = new THREE.ShaderMaterial({\n            uniforms: {\n                time: { value: 0.0 },\n                color: { value: new THREE.Color(0x33ccff) },\n                pulseFrequency: { value: 12.0 },\n                pulseAmplitude: { value: 0.3 }\n            },\n            vertexShader: `\n                varying vec2 vUv;\n                \n                void main() {\n                    vUv = uv;\n                    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n                }\n            `,\n            fragmentShader: `\n                uniform float time;\n                uniform vec3 color;\n                uniform float pulseFrequency;\n                uniform float pulseAmplitude;\n                varying vec2 vUv;\n                \n                // Improved pattern with scrolling and pulsing\n                void main() {\n                    // Create primary energy pattern - vertical striations\n                    float verticalPattern = sin(vUv.y * 50.0 - time * 3.0) * 0.5 + 0.5;\n                    \n                    // Create horizontal pulse bands\n                    float horizontalPulse = sin(vUv.y * pulseFrequency - time * 2.0) * pulseAmplitude + (1.0 - pulseAmplitude);\n                    \n                    // Edge glow effect with distortion\n                    float edgeEffect = smoothstep(0.0, 0.4, vUv.x) * smoothstep(1.0, 0.6, vUv.x);\n                    \n                    // Swirling energy effect\n                    float swirl = sin(vUv.y * 30.0 + vUv.x * 5.0 + time * 4.0) * 0.5 + 0.5;\n                    \n                    // Combine effects\n                    float pattern = mix(verticalPattern, swirl, 0.5) * horizontalPulse * edgeEffect;\n                    \n                    // Add vertical fade for more realistic beam\n                    float opacity = (1.0 - vUv.y * 0.8) * 0.9;\n                    \n                    // Pulsing brightness based on time\n                    float pulse = sin(time * 3.0) * 0.1 + 0.9;\n                    \n                    // Combine final color \n                    vec3 finalColor = color * pulse;\n                    \n                    // Output final color with combined opacity\n                    gl_FragColor = vec4(finalColor, opacity * pattern);\n                }\n            `,\n            transparent: true,\n            side: THREE.DoubleSide,\n            blending: THREE.AdditiveBlending // Use additive blending for glowing effect\n        });\n\n        // Create beam cone\n        const beamGeometry = new THREE.CylinderGeometry(beamBottomRadius, beamTopRadius, beamHeight, 32, 16, true);\n        const teleportBeam = new THREE.Mesh(beamGeometry, beamMaterial);\n\n        // Position beam below the ship facing down\n        teleportBeam.position.set(0, -beamHeight / 2, -scale * 0.1);\n        teleportBeam.rotation.x = Math.PI; // Point downward\n\n        // Hide beam initially\n        teleportBeam.visible = false;\n\n        // Add to ship\n        ship.add(teleportBeam);\n\n        return teleportBeam;\n    }\n\n    static createBeamImpactRing(scale: number, ship: THREE.Group): THREE.Mesh {\n        // Create a flat ring at the beam impact point\n        const ringGeometry = new THREE.RingGeometry(scale * 0.1, scale * 0.22, 32);\n        const ringMaterial = new THREE.ShaderMaterial({\n            uniforms: {\n                time: { value: 0.0 },\n                color: { value: new THREE.Color(0x33ccff) }\n            },\n            vertexShader: `\n                varying vec2 vUv;\n                void main() {\n                    vUv = uv;\n                    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n                }\n            `,\n            fragmentShader: `\n                uniform float time;\n                uniform vec3 color;\n                varying vec2 vUv;\n                \n                void main() {\n                    // Animated ripple effect\n                    float ripple = sin(distance(vUv, vec2(0.5)) * 20.0 - time * 5.0) * 0.5 + 0.5;\n                    \n                    // Rotating element\n                    float angle = atan(vUv.y - 0.5, vUv.x - 0.5);\n                    float rotatingPattern = sin(angle * 8.0 + time * 3.0) * 0.5 + 0.5;\n                    \n                    // Pulsing opacity\n                    float pulse = sin(time * 2.0) * 0.3 + 0.7;\n                    \n                    // Combine patterns\n                    float pattern = mix(ripple, rotatingPattern, 0.5) * pulse;\n                    \n                    gl_FragColor = vec4(color, pattern * 0.7);\n                }\n            `,\n            transparent: true,\n            side: THREE.DoubleSide,\n            blending: THREE.AdditiveBlending,\n            depthWrite: false\n        });\n\n        const impactRing = new THREE.Mesh(ringGeometry, ringMaterial);\n\n        // Position the ring below the beam's end\n        impactRing.position.set(0, -scale * 1.0, -scale * 0.1);\n        impactRing.rotation.x = -Math.PI / 2; // Face downward\n\n        // Hide initially\n        impactRing.visible = false;\n\n        // Add to ship\n        ship.add(impactRing);\n\n        return impactRing;\n    }\n}","// particles.ts - Creates teleport particle systems for the Star Dreadnought\n\nimport * as THREE from 'three';\n\nexport class TeleportParticles {\n    static createTeleportParticles(scale: number, ship: THREE.Group): THREE.Points {\n        // Create particle system for teleport beam\n        const particleCount = 800; // More particles\n        const particleGeometry = new THREE.BufferGeometry();\n\n        // Create arrays for particle properties\n        const positions: Float32Array = new Float32Array(particleCount * 3);\n        const colors: Float32Array = new Float32Array(particleCount * 3);\n        const sizes: Float32Array = new Float32Array(particleCount);\n        \n        // Initialize particle positions in a cone shape with more variation\n        for (let i = 0; i < particleCount; i++) {\n            const i3 = i * 3;\n\n            // Determine if this should be an inner or outer particle\n            const isInnerBeam = Math.random() > 0.3;\n\n            // Random position within the cone or surrounding area\n            const radius = isInnerBeam\n                ? Math.random() * scale * 0.03 // Inner beam\n                : scale * 0.03 + Math.random() * scale * 0.17; // Outer beam area\n\n            const theta = Math.random() * Math.PI * 2;\n            const height = -(Math.random() * scale * 0.8); // Full beam height\n\n            // Convert to Cartesian\n            positions[i3] = radius * Math.cos(theta); // x\n            positions[i3 + 1] = height; // y (negative for downward direction)\n            positions[i3 + 2] = radius * Math.sin(theta); // z\n\n            // Gradient colors from cyan to blue with variation\n            if (isInnerBeam) {\n                // Brighter inner beam\n                colors[i3] = 0.3 + Math.random() * 0.2; // r\n                colors[i3 + 1] = 0.9 + Math.random() * 0.1; // g\n                colors[i3 + 2] = 1.0; // b\n            } else {\n                // Cooler outer particles\n                colors[i3] = 0.1 + Math.random() * 0.1; // r\n                colors[i3 + 1] = 0.7 + Math.random() * 0.3; // g\n                colors[i3 + 2] = 0.9 + Math.random() * 0.1; // b\n            }\n\n            // Varied particle sizes\n            sizes[i] = isInnerBeam\n                ? scale * 0.002 + Math.random() * scale * 0.002 // Small inner particles\n                : scale * 0.004 + Math.random() * scale * 0.006; // Larger outer particles\n        }\n\n        // Add attributes to geometry\n        particleGeometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));\n        particleGeometry.setAttribute('color', new THREE.BufferAttribute(colors, 3));\n        particleGeometry.setAttribute('size', new THREE.BufferAttribute(sizes, 1));\n        \n        // Particle material with custom shader for better glow\n        const particleMaterial = new THREE.ShaderMaterial({\n            uniforms: {\n                time: { value: 0 },\n                pointTexture: { value: this.createParticleTexture() }\n            },\n            vertexShader: `\n                attribute float size;\n                attribute vec3 color;\n                varying vec3 vColor;\n                uniform float time;\n                \n                void main() {\n                    vColor = color;\n                    \n                    // Animate size with time\n                    float pulseFactor = sin(time * 2.0 + position.z * 0.1) * 0.3 + 0.7;\n                    \n                    // Calculate position\n                    vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n                    \n                    // Size attenuation\n                    gl_PointSize = size * pulseFactor * (300.0 / -mvPosition.z);\n                    gl_Position = projectionMatrix * mvPosition;\n                }\n            `,\n            fragmentShader: `\n                uniform sampler2D pointTexture;\n                varying vec3 vColor;\n                \n                void main() {\n                    // Sample soft particle texture\n                    vec4 texColor = texture2D(pointTexture, gl_PointCoord);\n                    \n                    // Apply color\n                    gl_FragColor = vec4(vColor, texColor.r);\n                }\n            `,\n            transparent: true,\n            depthWrite: false,\n            blending: THREE.AdditiveBlending,\n            vertexColors: true\n        });\n\n        // Create particle system\n        const teleportParticles = new THREE.Points(particleGeometry, particleMaterial);\n        teleportParticles.visible = false;\n\n        // Position particle system\n        teleportParticles.position.set(0, 0, -scale * 0.1);\n\n        // Add to ship\n        ship.add(teleportParticles);\n\n        return teleportParticles;\n    }\n\n    static createParticleTexture(): THREE.Texture {\n        const canvas = document.createElement('canvas');\n        canvas.width = 64;\n        canvas.height = 64;\n\n        const context = canvas.getContext('2d');\n        if (!context) throw new Error('Could not get 2D context');\n\n        const gradient = context.createRadialGradient(32, 32, 0, 32, 32, 32);\n\n        gradient.addColorStop(0, 'rgba(255,255,255,1)');\n        gradient.addColorStop(0.3, 'rgba(255,255,255,0.8)');\n        gradient.addColorStop(0.5, 'rgba(255,255,255,0.4)');\n        gradient.addColorStop(1, 'rgba(255,255,255,0)');\n\n        context.fillStyle = gradient;\n        context.fillRect(0, 0, 64, 64);\n\n        const texture = new THREE.Texture(canvas);\n        texture.needsUpdate = true;\n        return texture;\n    }\n\n    static animateParticles(teleportParticles: THREE.Points): void {\n        if (!teleportParticles || !teleportParticles.visible) return;\n\n        // Moving particles\n        const positions = teleportParticles.geometry.attributes.position.array as Float32Array;\n\n        // Move particles downward and reset when they reach bottom\n        for (let i = 0; i < positions.length; i += 3) {\n            // Move particle down faster\n            positions[i + 1] -= 5;\n\n            // Add slight horizontal movement for realism\n            positions[i] += (Math.random() - 0.5) * 2;\n            positions[i + 2] += (Math.random() - 0.5) * 2;\n\n            // Reset particle when it gets too far\n            if (positions[i + 1] < -1000) {\n                // Get a reference position to place particle within beam\n                const isInnerBeam = Math.random() > 0.3;\n                const radius = isInnerBeam\n                    ? Math.random() * 40 // Inner beam\n                    : 40 + Math.random() * 180; // Outer area\n                const theta = Math.random() * Math.PI * 2;\n\n                positions[i] = radius * Math.cos(theta); // x\n                positions[i + 1] = -(Math.random() * 400); // y (reset to top of beam)\n                positions[i + 2] = radius * Math.sin(theta); // z\n            }\n        }\n\n        // Update buffer geometry\n        teleportParticles.geometry.attributes.position.needsUpdate = true;\n    }\n}","// controller.ts - Controls teleport beam activation and animation for the Star Dreadnought\n\nimport * as THREE from 'three';\nimport { TeleportParticles } from './particles.js';\n\nexport class TeleportController {\n    teleportBeam: THREE.Mesh | null;\n    teleportParticles: THREE.Points | null;\n    impactRing: THREE.Mesh | null;\n    teleportBeamActive: boolean;\n\n    constructor() {\n        this.teleportBeam = null;\n        this.teleportParticles = null;\n        this.impactRing = null;\n        this.teleportBeamActive = false;\n    }\n\n    setComponents(teleportBeam: THREE.Mesh, teleportParticles: THREE.Points, impactRing: THREE.Mesh): void {\n        this.teleportBeam = teleportBeam;\n        this.teleportParticles = teleportParticles;\n        this.impactRing = impactRing;\n    }\n\n    // Activate teleport beam\n    activateTeleportBeam(): void {\n        if (this.teleportBeam) {\n            this.teleportBeam.visible = true;\n            this.teleportParticles!.visible = true;\n            this.impactRing!.visible = true;\n            this.teleportBeamActive = true;\n\n            // Reset animation time\n            const beamMaterial = this.teleportBeam.material as THREE.ShaderMaterial;\n            beamMaterial.uniforms.time.value = 0;\n            const ringMaterial = this.impactRing!.material as THREE.ShaderMaterial;\n            ringMaterial.uniforms.time.value = 0;\n            if (this.teleportParticles!.material instanceof THREE.ShaderMaterial && this.teleportParticles!.material.uniforms) {\n                this.teleportParticles!.material.uniforms.time.value = 0;\n            }\n        }\n    }\n\n    // Deactivate teleport beam\n    deactivateTeleportBeam(): void {\n        if (this.teleportBeam) {\n            this.teleportBeam.visible = false;\n            this.teleportParticles!.visible = false;\n            this.impactRing!.visible = false;\n            this.teleportBeamActive = false;\n        }\n    }\n\n    // Update teleport beam effect\n    updateTeleportBeam(progress: number = 0): void {\n        if (!this.teleportBeamActive) return;\n\n        // Update shader time uniforms for animation\n        const timeIncrement = 0.02;\n\n        // Update beam animation\n        if (this.teleportBeam && this.teleportBeam.material instanceof THREE.ShaderMaterial) {\n            this.teleportBeam.material.uniforms.time.value += timeIncrement;\n\n            // Pulse the beam based on progress\n            const intensity = 0.3 + Math.sin(progress * Math.PI * 6) * 0.1;\n            this.teleportBeam.material.uniforms.pulseAmplitude.value = intensity;\n        }\n\n        // Update impact ring\n        if (this.impactRing && this.impactRing.material instanceof THREE.ShaderMaterial) {\n            this.impactRing.material.uniforms.time.value += timeIncrement;\n\n            // Scale the impact ring with progress\n            const ringScale = 1.0 + Math.sin(progress * Math.PI * 3) * 0.2;\n            this.impactRing.scale.set(ringScale, ringScale, 1);\n        }\n\n        // Animate particles\n        if (this.teleportParticles && this.teleportParticles.material instanceof THREE.ShaderMaterial) {\n            this.teleportParticles.material.uniforms.time.value += timeIncrement;\n\n            // Use the static method from TeleportParticles for animation\n            TeleportParticles.animateParticles(this.teleportParticles);\n        }\n    }\n\n    // Get current beam active state\n    isBeamActive(): boolean {\n        return this.teleportBeamActive;\n    }\n}","// starDreadnought.ts - Main class for the massive Star Dreadnought ship\n// Refactored to delegate to specialized modules\n\nimport * as THREE from 'three';\nimport { DreadnoughtHull } from './structure/hull.js';\nimport { DreadnoughtBridge } from './structure/bridge.js';\nimport { DreadnoughtEngines } from './systems/engines.js';\nimport { DreadnoughtWeapons } from './systems/weapons.js';\nimport { TeleportBeam } from './teleporter/beam.js';\nimport { TeleportParticles } from './teleporter/particles.js';\nimport { TeleportController } from './teleporter/controller.js';\n\nexport class StarDreadnought {\n    scene: THREE.Scene;\n    ship: THREE.Group | null;\n    engines: DreadnoughtEngines;\n    teleportController: TeleportController;\n\n    constructor(scene: THREE.Scene) {\n        this.scene = scene;\n        this.ship = null;\n\n        // Initialize component systems\n        this.engines = new DreadnoughtEngines();\n        this.teleportController = new TeleportController();\n\n        // Create ship model\n        this.createShipModel();\n\n        // Add to scene\n        this.scene.add(this.ship!);\n\n        console.log(\"Star Dreadnought created\");\n    }\n\n    createShipModel(): void {\n        // Create a group for the entire ship\n        this.ship = new THREE.Group();\n        this.ship.name = 'starDreadnought';\n\n        // Set scale - this is a massive ship\n        const shipScale = 1200; // Overall scale factor\n\n        // Delegate construction to specialized modules\n        this.createStructure(shipScale);\n        this.createSystems(shipScale);\n        this.createTeleporter(shipScale);\n    }\n\n    createStructure(scale: number): void {\n        // Main hull - elongated wedge shape\n        DreadnoughtHull.createMainHull(scale, this.ship!);\n\n        // Command bridge superstructure\n        DreadnoughtBridge.createCommandBridge(scale, this.ship!);\n    }\n\n    createSystems(scale: number): void {\n        // Engine array with particles and power control\n        this.engines.createEngineArray(scale, this.ship!);\n\n        // Surface details: turrets, trenches, shield generators\n        DreadnoughtWeapons.createSurfaceDetails(scale, this.ship!);\n    }\n\n    createTeleporter(scale: number): void {\n        // Create teleport beam and impact ring\n        const teleportBeam = TeleportBeam.createTeleportBeam(scale, this.ship!);\n        const impactRing = TeleportBeam.createBeamImpactRing(scale, this.ship!);\n\n        // Create teleport particles\n        const teleportParticles = TeleportParticles.createTeleportParticles(scale, this.ship!);\n\n        // Set up teleport controller with components\n        this.teleportController.setComponents(teleportBeam, teleportParticles, impactRing);\n    }\n\n    // Set engines power level (0-1)\n    setEnginesPower(power: number): void {\n        this.engines.setEnginesPower(power);\n    }\n\n    // Activate teleport beam\n    activateTeleportBeam(): void {\n        this.teleportController.activateTeleportBeam();\n    }\n\n    // Deactivate teleport beam\n    deactivateTeleportBeam(): void {\n        this.teleportController.deactivateTeleportBeam();\n    }\n\n    // Update teleport beam effect\n    updateTeleportBeam(progress?: number): void {\n        this.teleportController.updateTeleportBeam(progress);\n        this.engines.updateEngineTrails();\n    }\n\n    // Check if teleport beam is active\n    get teleportBeamActive(): boolean {\n        return this.teleportController.isBeamActive();\n    }\n\n    // Get ship group for external access\n    getShip(): THREE.Group | null {\n        return this.ship;\n    }\n\n    // Get engine glows for external effects\n    getEngineGlows(): THREE.Mesh[] {\n        return this.engines.engineGlows;\n    }\n\n    // Update method for any ongoing animations\n    update(_deltaTime: number): void {\n        // Update engine trail animations\n        this.engines.updateEngineTrails();\n\n        // Update teleport beam if active\n        if (this.teleportController.isBeamActive()) {\n            this.teleportController.updateTeleportBeam();\n        }\n    }\n\n    // Cleanup method\n    dispose(): void {\n        if (this.ship) {\n            this.scene.remove(this.ship);\n\n            // Traverse and dispose of geometries and materials\n            this.ship.traverse((child: THREE.Object3D) => {\n                const mesh = child as THREE.Mesh;\n                if (mesh.geometry) {\n                    mesh.geometry.dispose();\n                }\n                if (mesh.material) {\n                    if (Array.isArray(mesh.material)) {\n                        mesh.material.forEach((material: THREE.Material) => material.dispose());\n                    } else {\n                        mesh.material.dispose();\n                    }\n                }\n            });\n\n            this.ship = null;\n        }\n    }\n}","// soundEffects.ts - Tone.js sound effects for intro sequence\n\n/**\n * Creates all intro sequence sound effects using Tone.js\n * @param {any} audioManager - Reference to the main audio manager\n * @returns {Object} Object containing all intro sound effects\n */\nexport function createIntroSoundEffects(audioManager: any): any {\n    const Tone = (window as any).Tone;\n    if (typeof Tone === 'undefined') {\n        console.error(\"Tone.js not available for intro sound effects\");\n        return {};\n    }\n    \n    try {\n        console.log(\"Creating intro sequence sound effects...\");\n        \n        const introSounds: any = {};\n        \n        // Create warp portal sound\n        introSounds.warp = createWarpSound(audioManager);\n        \n        // Create ship arrival sound\n        introSounds.shipArrival = createShipArrivalSound(audioManager);\n        \n        // Create teleport beam sound\n        introSounds.teleport = createTeleportSound(audioManager);\n        \n        console.log(\"Intro sequence sound effects created\");\n        return introSounds;\n    } catch (error) {\n        console.error(\"Error creating intro sound effects:\", error);\n        return {};\n    }\n}\n\n// Create warp portal sound effect\nfunction createWarpSound(audioManager: any): any {\n    const Tone = (window as any).Tone;\n    try {\n        // Use Tone.Destination directly - audio system might not be fully initialized yet\n        const destination = Tone.Destination;\n        \n        // Filter for warp sound\n        const warpFilter = new Tone.Filter({\n            type: \"lowpass\",\n            frequency: 2000,\n            Q: 2\n        }).connect(destination);\n        \n        // Add reverb for spaciousness\n        const warpReverb = new Tone.Reverb({\n            decay: 2,\n            wet: 0.5\n        }).connect(warpFilter);\n        \n        // Create synth for warp sound\n        const warpSynth = new Tone.FMSynth({\n            harmonicity: 3,\n            modulationIndex: 10,\n            oscillator: {\n                type: \"sine\"\n            },\n            envelope: {\n                attack: 0.1,\n                decay: 0.2,\n                sustain: 0.8,\n                release: 1.5\n            },\n            modulation: {\n                type: \"square\"\n            },\n            modulationEnvelope: {\n                attack: 0.5,\n                decay: 0.1,\n                sustain: 0.2,\n                release: 0.5\n            }\n        }).connect(warpReverb);\n        \n        // Create noise component for texture\n        const noiseFilter = new Tone.Filter({\n            type: \"bandpass\",\n            frequency: 700,\n            Q: 0.6\n        }).connect(destination);\n        \n        const noiseGain = new Tone.Gain(0.3).connect(noiseFilter);\n        const noise = new Tone.Noise(\"pink\").connect(noiseGain);\n        \n        // Create sound object with proper scope\n        const soundObject = {\n            lastPlayTime: 0, // Track when we last played this sound\n            play: function() {\n                if (audioManager && audioManager.muted) return;\n                \n                const now = Tone.now();\n                \n                // Prevent playing if it was played too recently (within 0.1 seconds)\n                if (now - this.lastPlayTime < 0.1) {\n                    console.log(\"Preventing too rapid warp sound playback\");\n                    return;\n                }\n                \n                // Update last play time\n                this.lastPlayTime = now;\n                \n                // Set volume - reduced by 40%\n                const volumeLevel = audioManager ? audioManager.sfxVolume * 0.36 : 0.18;\n                warpSynth.volume.value = Tone.gainToDb(volumeLevel);\n                \n                // Start noise component with reduced volume\n                noise.start();\n                \n                // Play descending sequence for portal forming\n                warpSynth.triggerAttack(\"C5\", now);\n                warpSynth.frequency.exponentialRampTo(\"C2\", 2, now);\n                \n                // Fade out noise after 3 seconds - start with lower gain\n                noiseGain.gain.setValueAtTime(0.18, now);\n                noiseGain.gain.exponentialRampTo(0.01, 3, now + 1);\n                \n                // Stop synth and noise after 3 seconds\n                setTimeout(() => {\n                    warpSynth.triggerRelease();\n                    setTimeout(() => {\n                        noise.stop();\n                    }, 500);\n                }, 3000);\n            }\n        };\n        \n        return soundObject;\n    } catch (error) {\n        console.error(\"Error creating warp sound:\", error);\n        return { play: () => {} };\n    }\n}\n\n// Create ship arrival sound effect\nfunction createShipArrivalSound(audioManager: any): any {\n    const Tone = (window as any).Tone;\n    try {\n        // Use Tone.Destination directly - audio system might not be fully initialized yet\n        const destination = Tone.Destination;\n        \n        // Filter for arrival sound\n        const arrivalFilter = new Tone.Filter({\n            type: \"lowpass\",\n            frequency: 1200,\n            Q: 1\n        }).connect(destination);\n        \n        // Create synth for ship arrival sound\n        const arrivalSynth = new Tone.PolySynth(Tone.Synth, {\n            oscillator: {\n                type: \"triangle\"\n            },\n            envelope: {\n                attack: 0.02,\n                decay: 0.3,\n                sustain: 0.1,\n                release: 0.8\n            }\n        }).connect(arrivalFilter);\n        \n        // Create deep bass for engine rumble\n        const rumbleFilter = new Tone.Filter({\n            type: \"lowpass\",\n            frequency: 200,\n            Q: 0.5\n        }).connect(destination);\n        \n        const rumbleSynth = new Tone.Synth({\n            oscillator: {\n                type: \"sine\"\n            },\n            envelope: {\n                attack: 0.1,\n                decay: 0.3,\n                sustain: 0.6,\n                release: 1\n            }\n        }).connect(rumbleFilter);\n        \n        // Return the sound object\n        return {\n            play: () => {\n                if (audioManager && audioManager.muted) return;\n                \n                const now = Tone.now();\n                \n                // Set volume - reduced by 40%\n                const volumeLevel = audioManager ? audioManager.sfxVolume * 0.42 : 0.24;\n                arrivalSynth.volume.value = Tone.gainToDb(volumeLevel);\n                rumbleSynth.volume.value = Tone.gainToDb(volumeLevel * 0.8); // Further reduced rumble\n                \n                // Play dramatic chord for ship appearance\n                arrivalSynth.triggerAttackRelease([\"G3\", \"D4\", \"A4\"], 1.5, now);\n                \n                // Add engine rumble\n                rumbleSynth.triggerAttack(\"G1\", now);\n                rumbleSynth.frequency.exponentialRampTo(\"C2\", 2, now + 0.5);\n                \n                // Stop rumble after 2 seconds\n                setTimeout(() => {\n                    rumbleSynth.triggerRelease();\n                }, 2000);\n            }\n        };\n    } catch (error) {\n        console.error(\"Error creating ship arrival sound:\", error);\n        return { play: () => {} };\n    }\n}\n\n// Create teleport beam sound effect\nfunction createTeleportSound(audioManager: any): any {\n    const Tone = (window as any).Tone;\n    try {\n        // Use Tone.Destination directly - audio system might not be fully initialized yet\n        const destination = Tone.Destination;\n        \n        // Filter for teleport sound\n        const teleportFilter = new Tone.Filter({\n            type: \"bandpass\",\n            frequency: 800,\n            Q: 2\n        }).connect(destination);\n        \n        // Add chorus for otherworldly effect\n        const teleportChorus = new Tone.Chorus({\n            frequency: 1.5,\n            delayTime: 3.5,\n            depth: 0.7,\n            wet: 0.5\n        }).connect(teleportFilter).start();\n        \n        // Create synth for teleport beam\n        const teleportSynth = new Tone.Synth({\n            oscillator: {\n                type: \"sine\"\n            },\n            envelope: {\n                attack: 0.05,\n                decay: 0.2,\n                sustain: 0.8,\n                release: 1\n            }\n        }).connect(teleportChorus);\n        \n        // Create high-pitched accent for the beam\n        const beamFilter = new Tone.Filter({\n            type: \"highpass\",\n            frequency: 2000,\n            Q: 1\n        }).connect(destination);\n        \n        const beamSynth = new Tone.Synth({\n            oscillator: {\n                type: \"square\"\n            },\n            envelope: {\n                attack: 0.01,\n                decay: 0.1,\n                sustain: 0.6,\n                release: 0.5\n            }\n        }).connect(beamFilter);\n        \n        // Return the sound object\n        return {\n            play: () => {\n                if (audioManager && audioManager.muted) return;\n                \n                const now = Tone.now();\n                \n                // Set volume - reduced by 40%\n                const volumeLevel = audioManager ? audioManager.sfxVolume * 0.3 : 0.18;\n                teleportSynth.volume.value = Tone.gainToDb(volumeLevel);\n                beamSynth.volume.value = Tone.gainToDb(volumeLevel * 0.4); // Further reduced high pitch\n                \n                // Play upward sweep for teleport activation\n                teleportSynth.triggerAttack(\"C4\", now);\n                teleportSynth.frequency.exponentialRampTo(\"C6\", 1.5, now);\n                \n                // Add high-pitched beam activation sound\n                beamSynth.triggerAttackRelease(\"E7\", 0.1, now + 0.3);\n                setTimeout(() => {\n                    beamSynth.triggerAttackRelease(\"G7\", 0.1, now + 0.5);\n                }, 200);\n                \n                // Release after 2 seconds\n                setTimeout(() => {\n                    teleportSynth.triggerRelease();\n                }, 2000);\n            }\n        };\n    } catch (error) {\n        console.error(\"Error creating teleport sound:\", error);\n        return { play: () => {} };\n    }\n}","// dialogueManager.ts - Manages loading and playing dialogue WAV files for intro sequence\n\nimport { getAbsolutePath } from '../../../utils/pathUtils.js';\n\n/**\n * Load dialogue WAV files (1.wav through 8.wav)\n * @returns {HTMLAudioElement[]} Array of Audio elements for dialogue files\n */\nexport function loadDialogueWavs(): HTMLAudioElement[] {\n    console.log(\"Loading dialogue WAV files...\");\n    \n    const dialogueWavs: HTMLAudioElement[] = [];\n    \n    try {\n        // Load 8 dialogue WAV files\n        for (let i = 1; i <= 8; i++) {\n            const audioPath = getAbsolutePath(`sounds/dialogue/${i}.wav`);\n            console.log(`Attempting to load dialogue file: ${audioPath}`);\n            \n            // Create audio element\n            const audio = new Audio();\n            \n            // Setup event handlers before setting src to avoid race conditions\n            audio.addEventListener('canplaythrough', () => {\n                console.log(`Dialogue WAV ${i} loaded successfully`);\n            });\n            \n            audio.addEventListener('error', () => {\n                console.warn(`Dialogue WAV ${i} not found or couldn't be loaded - this is normal if you haven't added the files yet`);\n                // Don't log the full error object as it's noisy\n            });\n            \n            // Set source after adding event listeners\n            audio.src = audioPath;\n            \n            // Store reference even if loading fails - the game will just skip playing it\n            dialogueWavs.push(audio);\n        }\n        \n        console.log(\"Dialogue WAV files setup complete - they'll be used if available\");\n        return dialogueWavs;\n    } catch (error) {\n        console.error(\"Error in dialogue WAV files setup:\", error);\n        return [];\n    }\n}\n\n/**\n * Play a specific dialogue WAV file\n * @param {HTMLAudioElement[]} dialogueWavs - Array of dialogue audio elements\n * @param {number} index - Index of the dialogue to play\n * @param {any} audioManager - Audio manager for volume control\n */\nexport function playDialogueWav(dialogueWavs: HTMLAudioElement[], index: number, audioManager: any): void {\n    // Only play WAVs for the first 8 dialogues (the ones with voice acting)\n    if (index >= 8 || !dialogueWavs[index]) {\n        return;\n    }\n    \n    try {\n        const dialogueAudio = dialogueWavs[index];\n        \n        // Only attempt to play if the file has actually loaded successfully\n        // We can check this by examining the networkState or readyState\n        if (dialogueAudio.readyState > 0 && dialogueAudio.error === null) {\n            dialogueAudio.volume = audioManager ? audioManager.sfxVolume * 0.8 : 0.5;\n            dialogueAudio.currentTime = 0;\n            \n            // Try to play and catch any potential errors\n            const playPromise = dialogueAudio.play();\n            if (playPromise !== undefined) {\n                playPromise.catch(err => {\n                    console.warn(`Couldn't play dialogue WAV ${index}: ${err.message}`);\n                });\n            }\n        } else {\n            console.log(`Skipping dialogue WAV ${index + 1} (not loaded)`);\n        }\n    } catch (error: any) {\n        console.warn(`Error playing dialogue WAV ${index + 1}, continuing without audio`, error.message);\n    }\n}","// portalEffect.ts - Manages the warp portal visual effects for intro sequence\n\nimport * as THREE from 'three';\n\nexport class PortalEffect {\n    private warpTunnel: THREE.Group | null = null;\n    private warpPortal: THREE.Mesh | null = null;\n    private portalParticles: THREE.Points | null = null;\n\n    constructor() {\n        this.setupPortalEffect();\n    }\n    \n    setupPortalEffect(): void {\n        // Create a circular portal instead of a particle tower\n        const portalGeometry = new THREE.RingGeometry(0, 400, 64);\n        const portalMaterial = new THREE.ShaderMaterial({\n            uniforms: {\n                time: { value: 0 },\n                color: { value: new THREE.Color(0x6633aa) }\n            },\n            vertexShader: `\n                precision highp float;\n                varying vec2 vUv;\n                void main() {\n                    vUv = uv;\n                    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n                }\n            `,\n            fragmentShader: `\n                precision highp float;\n                uniform float time;\n                uniform vec3 color;\n                varying vec2 vUv;\n                \n                void main() {\n                    float distFromCenter = length(vUv - vec2(0.5, 0.5)) * 2.0;\n                    float ripple = sin(distFromCenter * 20.0 - time * 3.0) * 0.5 + 0.5;\n                    float alpha = (1.0 - distFromCenter) * ripple;\n                    \n                    vec3 finalColor = color * (0.8 + ripple * 0.4);\n                    gl_FragColor = vec4(finalColor, alpha);\n                }\n            `,\n            transparent: true,\n            side: THREE.DoubleSide\n        });\n        \n        this.warpPortal = new THREE.Mesh(portalGeometry, portalMaterial);\n        \n        // Create a subtle particle system around the portal for effect\n        const particleCount = 500;\n        const particles = new THREE.BufferGeometry();\n        const positions = new Float32Array(particleCount * 3);\n        \n        for (let i = 0; i < particleCount; i++) {\n            const angle = Math.random() * Math.PI * 2;\n            const radius = 350 + Math.random() * 150;\n            positions[i * 3] = Math.cos(angle) * radius;\n            positions[i * 3 + 1] = Math.sin(angle) * radius;\n            positions[i * 3 + 2] = (Math.random() - 0.5) * 50;\n        }\n        \n        particles.setAttribute('position', new THREE.BufferAttribute(positions, 3));\n        \n        const particleMaterial = new THREE.PointsMaterial({\n            color: 0xaa33ff,\n            size: 3,\n            transparent: true,\n            blending: THREE.AdditiveBlending\n        });\n        \n        this.portalParticles = new THREE.Points(particles, particleMaterial);\n        \n        // Group the portal elements\n        this.warpTunnel = new THREE.Group();\n        this.warpTunnel.add(this.warpPortal);\n        this.warpTunnel.add(this.portalParticles);\n    }\n    \n    /**\n     * Update portal shader uniforms and animations\n     */\n    updatePortalEffect(): void {\n        if (this.warpPortal && (this.warpPortal.material as THREE.ShaderMaterial).uniforms) {\n            (this.warpPortal.material as THREE.ShaderMaterial).uniforms.time.value += 0.016;\n        }\n    }\n    \n    /**\n     * Set portal opacity for fade effects\n     * @param {number} opacity - Opacity value between 0 and 1\n     */\n    setOpacity(opacity: number): void {\n        if (this.portalParticles && this.portalParticles.material) {\n            const particleMaterial = this.portalParticles.material;\n            if (Array.isArray(particleMaterial)) {\n                particleMaterial.forEach((material) => {\n                    if ('opacity' in material) material.opacity = opacity;\n                });\n            } else if ('opacity' in particleMaterial) {\n                particleMaterial.opacity = opacity;\n            }\n        }\n        if (this.warpPortal && this.warpPortal.material) {\n            const portalMaterial = this.warpPortal.material;\n            if (Array.isArray(portalMaterial)) {\n                portalMaterial.forEach((material) => {\n                    if ('opacity' in material) material.opacity = opacity;\n                });\n            } else if ('opacity' in portalMaterial) {\n                portalMaterial.opacity = opacity;\n            }\n        }\n    }\n    \n    /**\n     * Set portal scale\n     * @param {number} scale - Scale factor\n     */\n    setScale(scale: number): void {\n        if (this.warpTunnel) {\n            this.warpTunnel.scale.set(scale, scale, 1);\n        }\n    }\n    \n    /**\n     * Set portal position\n     * @param {THREE.Vector3} position - Position vector\n     */\n    setPosition(position: THREE.Vector3): void {\n        if (this.warpTunnel) {\n            this.warpTunnel.position.copy(position);\n        }\n    }\n    \n    /**\n     * Set portal rotation\n     * @param {THREE.Euler} rotation - Rotation euler angles\n     */\n    setRotation(rotation: THREE.Euler): void {\n        if (this.warpTunnel) {\n            this.warpTunnel.rotation.copy(rotation);\n        }\n    }\n    \n    /**\n     * Set portal visibility\n     * @param {boolean} visible - Whether portal should be visible\n     */\n    setVisible(visible: boolean): void {\n        if (this.warpTunnel) {\n            this.warpTunnel.visible = visible;\n        }\n    }\n    \n    /**\n     * Get the portal group for adding to scene\n     * @returns {THREE.Group | null} The warp tunnel group\n     */\n    getPortalGroup(): THREE.Group | null {\n        return this.warpTunnel;\n    }\n    \n    /**\n     * Clean up portal resources\n     */\n    dispose(): void {\n        if (this.warpPortal) {\n            if (this.warpPortal.geometry) this.warpPortal.geometry.dispose();\n            if (this.warpPortal.material) (this.warpPortal.material as THREE.Material).dispose();\n        }\n        if (this.portalParticles) {\n            if (this.portalParticles.geometry) this.portalParticles.geometry.dispose();\n            if (this.portalParticles.material) (this.portalParticles.material as THREE.Material).dispose();\n        }\n        this.warpTunnel = null;\n        this.warpPortal = null;\n        this.portalParticles = null;\n    }\n}\n","// dialogueSystem.ts - Manages dialogue UI and typing animation for intro sequence\n\nimport { playDialogueWav } from '../audio/dialogueManager.js';\n\nexport class DialogueSystem {\n    private dialogueBox: HTMLDivElement | null = null;\n    private dialogueText: HTMLDivElement | null = null;\n    private currentDialogueIndex: number = 0;\n    private isTyping: boolean = false;\n    private typeInterval: number | ReturnType<typeof setInterval> | null = null;\n    private dialogueWavs: HTMLAudioElement[] = [];\n    private audioManager: any = null;\n    private dialogueLines: string[];\n    \n    constructor() {\n        this.dialogueBox = null;\n        this.dialogueText = null;\n        this.currentDialogueIndex = 0;\n        this.isTyping = false;\n        this.typeInterval = null;\n        this.dialogueWavs = [];\n        this.audioManager = null;\n        \n        // Dialogue lines\n        this.dialogueLines = [\n            \"CORP CONTROLLER: [static] Belter #337, status check. Your cryostasis cycle is now complete.\",\n            \"CORP CONTROLLER: Welcome to your deployment in the Sol System, circa 2077. As you can see, Earth is... well... let's just say \\\"available for unrestricted mining operations\\\" now.\",\n            \"CORP CONTROLLER: CorpEx Resource Acquisition reminds you that all planetary bodies in this system are now classified as \\\"unclaimed assets\\\" following the... unfortunate global circumstances.\",\n            \"CORP CONTROLLER: Your primary objective is resource extraction from the asteroid belt. Initial scans show promising mineral concentrations untouched since the evacuation.\",\n            \"CORP CONTROLLER: The Stargate remains your lifeline. Return for fuel, upgrades, trading, and your allocated 15 minutes of daily entertainment. Remember, a happy belter is a productive belter!\",\n            \"CORP CONTROLLER: Resource extraction targets are non-negotiable. Failure to meet quotas will result in extension of your 42-year contract.\",\n            \"CORP CONTROLLER: Oh, and our long-range scans have detected spectral drone activity in adjacent sectors. Remnants of old defense systems, probably. Nothing a resourceful belter like you can't handle.\",\n            \"CORP CONTROLLER: Connection terminating in 3...2...1... Don't die out there, #337. Replacement clones are expensive.\",\n            \"[TRANSMISSION TERMINATED]\",\n            \"[BELTER #337 DEPLOYMENT ACTIVE]\"\n        ];\n    }\n    \n    /**\n     * Initialize the dialogue system with required dependencies\n     * @param {HTMLAudioElement[]} dialogueWavs - Array of loaded dialogue audio elements\n     * @param {any} audioManager - Audio manager for volume control\n     */\n    initialize(dialogueWavs: HTMLAudioElement[], audioManager: any): void {\n        this.dialogueWavs = dialogueWavs;\n        this.audioManager = audioManager;\n    }\n    \n    /**\n     * Setup the dialogue UI elements\n     */\n    setupDialogueUI(): void {\n        // Create dialogue box\n        this.dialogueBox = document.createElement('div');\n        this.dialogueBox.id = 'intro-dialogue';\n        this.dialogueBox.style.position = 'fixed';\n        this.dialogueBox.style.bottom = '50px';\n        this.dialogueBox.style.left = '50%';\n        this.dialogueBox.style.transform = 'translateX(-50%)';\n        this.dialogueBox.style.width = '80%';\n        this.dialogueBox.style.maxWidth = '800px';\n        this.dialogueBox.style.backgroundColor = 'rgba(0, 0, 0, 0.7)';\n        this.dialogueBox.style.color = '#30f0c0';\n        this.dialogueBox.style.border = '1px solid #30f0c0';\n        this.dialogueBox.style.borderRadius = '5px';\n        this.dialogueBox.style.padding = '15px';\n        this.dialogueBox.style.fontFamily = 'Courier New, monospace';\n        this.dialogueBox.style.fontSize = '16px';\n        this.dialogueBox.style.zIndex = '10000';\n        this.dialogueBox.style.textShadow = '0 0 5px #30f0c0';\n        this.dialogueBox.style.boxShadow = '0 0 10px rgba(48, 240, 192, 0.3)';\n        this.dialogueBox.style.opacity = '0';\n        this.dialogueBox.style.transition = 'opacity 0.5s';\n        \n        // Add dialogue text element\n        this.dialogueText = document.createElement('div');\n        this.dialogueText.style.lineHeight = '1.5';\n        \n        this.dialogueBox.appendChild(this.dialogueText);\n        document.body.appendChild(this.dialogueBox);\n        \n        // Fade in dialogue box\n        setTimeout(() => {\n            if (this.dialogueBox) {\n                this.dialogueBox.style.opacity = '1';\n            }\n        }, 200);\n    }\n    \n    /**\n     * Type out the next dialogue line with animation\n     * @param {number} sequenceTime - Current sequence time for auto-advance logic\n     * @param {boolean} isPlaying - Whether intro sequence is still playing\n     * @returns {boolean} True if there are more dialogues, false if complete\n     */\n    typeNextDialogue(sequenceTime: number = 0, isPlaying: boolean = true): boolean {\n        if (this.currentDialogueIndex >= this.dialogueLines.length) {\n            return false;\n        }\n        \n        const line = this.dialogueLines[this.currentDialogueIndex];\n        \n        // Play the appropriate dialogue WAV file\n        playDialogueWav(this.dialogueWavs, this.currentDialogueIndex, this.audioManager);\n        \n        this.currentDialogueIndex++;\n        \n        // Clear previous text\n        if (this.dialogueText) {\n            this.dialogueText.textContent = '';\n        }\n        \n        // Show dialogue box if not visible\n        if (this.dialogueBox && this.dialogueBox.style.opacity === '0') {\n            this.dialogueBox.style.opacity = '1';\n        }\n        \n        // Type out text\n        let charIndex = 0;\n        this.isTyping = true;\n        \n        // Clear previous interval if exists\n        if (this.typeInterval) {\n            clearInterval(this.typeInterval as any);\n        }\n        \n        // Special effects for transmission terminated line\n        if (this.dialogueText) {\n            if (line.includes(\"TRANSMISSION TERMINATED\") || line.includes(\"DEPLOYMENT ACTIVE\")) {\n                this.dialogueText.style.color = '#ff3030';\n            } else {\n                this.dialogueText.style.color = '#30f0c0';\n            }\n        }\n        \n        // Type each character with random speed for effect\n        this.typeInterval = setInterval(() => {\n            if (charIndex < line.length) {\n                if (this.dialogueText) {\n                    this.dialogueText.textContent += line.charAt(charIndex);\n                }\n                charIndex++;\n                \n                // Typing sound disabled - uiClick sound not available\n                // Could be re-enabled when proper UI sounds are added to the audio system\n            } else {\n                if (this.typeInterval) {\n                    clearInterval(this.typeInterval as any);\n                }\n                this.typeInterval = null;\n                this.isTyping = false;\n                \n                // Automatically advance to next dialogue after a delay\n                // but only for certain progress points in the sequence\n                if (sequenceTime < 22) { // Don't auto advance during the very end\n                    const waitTime = Math.max(line.length * 50, 3000); // Longer lines stay longer\n                    setTimeout(() => {\n                        if (!this.isTyping && isPlaying) {\n                            this.typeNextDialogue(sequenceTime, isPlaying);\n                        }\n                    }, waitTime);\n                }\n            }\n        }, 30); // Base typing speed\n        \n        return true;\n    }\n    \n    /**\n     * Get current dialogue index\n     * @returns {number} Current dialogue index\n     */\n    getCurrentDialogueIndex(): number {\n        return this.currentDialogueIndex;\n    }\n    \n    /**\n     * Check if currently typing\n     * @returns {boolean} True if typing animation is active\n     */\n    getIsTyping(): boolean {\n        return this.isTyping;\n    }\n    \n    /**\n     * Clean up dialogue system resources\n     */\n    cleanup(): void {\n        // Clear typing interval if running\n        if (this.typeInterval) {\n            clearInterval(this.typeInterval as any);\n            this.typeInterval = null;\n        }\n        \n        // Remove dialogue box if it exists\n        if (this.dialogueBox && this.dialogueBox.parentNode) {\n            this.dialogueBox.parentNode.removeChild(this.dialogueBox);\n            this.dialogueBox = null;\n            this.dialogueText = null;\n        }\n        \n        // Reset state\n        this.currentDialogueIndex = 0;\n        this.isTyping = false;\n    }\n}\n","// arrivalPhase.ts - Manages the ship arrival phase of the intro sequence\n\nimport * as THREE from 'three';\nimport type { IntroSequenceAnimationContext } from '../../introSequence.ts';\n\n/**\n * Update the arrival phase animation (portal, ship arrival and player deployment)\n * @param {number} progress - Progress through arrival phase (0-1)\n * @param {any} context - Context object containing all necessary references\n */\nexport function updateArrivalPhase(progress: number, context: IntroSequenceAnimationContext): void {\n    const {\n        portalEffect,\n        starDreadnought,\n        camera,\n        spaceship,\n        introSounds,\n        flashOverlay\n    } = context;\n    \n    // Portal animation\n    portalEffect.updatePortalEffect();\n    \n    // Position portal outside the asteroid belt\n    portalEffect.setPosition(new THREE.Vector3(30000, 5000, 0));\n    portalEffect.setRotation(new THREE.Euler(0, 0, Math.PI/2));\n    \n    // PORTAL GROWTH phase (0-0.2)\n    if (progress < 0.2) {\n        // Grow portal\n        const portalProgress = progress / 0.2;\n        const portalScale = portalProgress * 3.5;\n        portalEffect.setScale(portalScale);\n        \n        // Medium-distance side view of portal formation\n        camera.position.set(0, 6000, 12000);\n        camera.lookAt(30000, 5000, 0); // Look at portal\n    }\n    \n    // SHIP EMERGENCE and JOURNEY phase (0.2-0.7)\n    if (progress >= 0.2 && progress < 0.7) {\n        // Make ship visible when it first emerges\n        if (progress >= 0.2 && !starDreadnought.ship.visible) {\n            starDreadnought.ship.visible = true;\n            if (flashOverlay) {\n                flashOverlay(0.3);\n            }\n\n            // Play arrival sound using Tone.js\n            if (introSounds.shipArrival?.play) {\n                introSounds.shipArrival.play();\n            }\n        }\n        \n        // Smooth continuous movement along Bezier curve\n        const t = (progress - 0.2) / 0.5; // Normalized time for this phase\n        const easeInOut = t < 0.5 \n            ? 2 * t * t \n            : 1 - Math.pow(-2 * t + 2, 2) / 2;\n        \n        // Bezier curve control points for ship path\n        const start = new THREE.Vector3(30000, 5000, 0);        // Portal position\n        const control = new THREE.Vector3(26000, 5300, -2000);  // Control point for curve\n        const end = new THREE.Vector3(22000, 5000, 0);          // Final position above belt\n        \n        // Calculate position along quadratic Bezier curve\n        const p0 = new THREE.Vector3();\n        const p1 = new THREE.Vector3();\n        const p2 = new THREE.Vector3();\n        \n        p0.copy(start).multiplyScalar(Math.pow(1-easeInOut, 2));\n        p1.copy(control).multiplyScalar(2 * (1-easeInOut) * easeInOut);\n        p2.copy(end).multiplyScalar(easeInOut * easeInOut);\n        \n        const position = new THREE.Vector3()\n            .add(p0)\n            .add(p1)\n            .add(p2);\n        \n        // Add subtle vertical oscillation like a naval vessel\n        position.y += Math.sin(progress * Math.PI * 3) * 80;\n        \n        // Update ship position\n        starDreadnought.ship.position.copy(position);\n        \n        // Engine power during journey\n        const enginePower = 0.4 + easeInOut * 0.6;\n        starDreadnought.setEnginesPower(enginePower);\n        \n        // Fade out portal as ship moves away\n        if (progress > 0.3) {\n            const portalFade = Math.min((progress - 0.3) / 0.3, 1.0);\n            portalEffect.setOpacity(1 - portalFade);\n        }\n        \n        // Tracking shot alongside ship journey\n        const shipPos = starDreadnought.ship.position.clone();\n        camera.position.set(\n            shipPos.x - 3000, \n            shipPos.y + 1000, \n            8000\n        );\n        camera.lookAt(shipPos);\n    }\n    \n    // PLAYER DEPLOYMENT phase (0.7-1.0)\n    if (progress >= 0.7) {\n        // Ensure portal is fully invisible\n        portalEffect.setOpacity(0);\n        \n        // Activate teleport beam if not already active\n        if (progress < 0.75 && !starDreadnought.teleportBeamActive) {\n            starDreadnought.activateTeleportBeam();\n\n            // Play teleport sound using Tone.js\n            if (introSounds.teleport?.play) {\n                introSounds.teleport.play();\n            }\n        }\n        \n        // Update teleport beam\n        starDreadnought.updateTeleportBeam(progress);\n        \n        // Deploy player ship\n        if (progress > 0.8 && spaceship && spaceship.mesh && !spaceship.mesh.visible) {\n            // Position player ship BELOW dreadnought but ABOVE the asteroid belt\n            const dreadPos = starDreadnought.ship.position;\n            spaceship.mesh.position.set(\n                dreadPos.x,\n                dreadPos.y - 2000, // 2000 units below dreadnought\n                dreadPos.z\n            );\n\n            // Properly undock the ship - this is critical to update game state\n            if (spaceship.isDocked) {\n                console.log(\"Undocking player ship during intro sequence\");\n                spaceship.isDocked = false; // Force undock directly to avoid position reset\n                spaceship.mesh.visible = true;\n            } else {\n                spaceship.mesh.visible = true;\n            }\n\n            // Store final player position (convert to THREE.Vector3 for reliable clone)\n            context.finalPlayerPosition = new THREE.Vector3(\n                spaceship.mesh.position.x,\n                spaceship.mesh.position.y,\n                spaceship.mesh.position.z\n            );\n\n            // Add shield effect to player ship\n            createPlayerShieldEffect(spaceship, context);\n\n            // Flash effect for ship appearance\n            if (flashOverlay) {\n                flashOverlay(0.3);\n            }\n        }\n        \n        // Teleport beam view camera\n        const shipPos = starDreadnought.ship.position.clone();\n        const t = (progress - 0.7) / 0.3;\n        camera.position.set(\n            shipPos.x - 2000 + t * 2000,\n            shipPos.y + 2000,\n            5000 - t * 3000\n        );\n        \n        // Look at midpoint between ship and deployed player\n        const lookY = shipPos.y - 1000;\n        camera.lookAt(shipPos.x, lookY, shipPos.z);\n    }\n}\n\n/**\n * Create shield effect around player ship\n * @param {any} spaceship - Player spaceship object\n * @param {any} context - Context object for storing shield effect reference\n */\nfunction createPlayerShieldEffect(spaceship: any, context: any): void {\n    // Create a sphere slightly larger than the player ship\n    const geometry = new THREE.SphereGeometry(30, 32, 32);\n    const material = new THREE.MeshBasicMaterial({\n        color: 0x88ccff,\n        transparent: true, \n        opacity: 0.6,\n        side: THREE.DoubleSide\n    });\n    \n    context.playerShieldEffect = new THREE.Mesh(geometry, material);\n    context.playerShieldEffect.scale.set(1.2, 1.2, 1.2);\n    spaceship.mesh.add(context.playerShieldEffect);\n    \n    // Add pulsing animation\n    context.shieldPulseTime = 0;\n}\n","// departurePhase.ts - Manages the ship departure phase of the intro sequence\n\nimport * as THREE from 'three';\n\n/**\n * Update the departure phase animation (ship rotation, portal reappearance, and departure)\n * @param {number} progress - Progress through departure phase (0-1)\n * @param {any} context - Context object containing all necessary references\n */\nexport function updateDeparturePhase(progress: number, context: any): void {\n    const {\n        portalEffect,\n        starDreadnought,\n        camera,\n        introSounds,\n        flashOverlay\n    } = context;\n    \n    // Simple departure sequence: rotate ship 180 degrees and go back through original portal\n    \n    // Original portal location\n    const portalPos = new THREE.Vector3(30000, 5000, 0);\n    \n    // FIRST HALF: Ship rotates and portal reappears (0-0.5)\n    if (progress < 0.5) {\n        // Turn off teleport beam at start\n        if (progress < 0.1 && starDreadnought.teleportBeamActive) {\n            starDreadnought.deactivateTeleportBeam();\n        }\n        \n        // Make portal visible again at original position\n        if (progress > 0.1) {\n            // Position portal back at original entry point\n            portalEffect.setPosition(portalPos);\n            portalEffect.setVisible(true);\n            portalEffect.setRotation(new THREE.Euler(0, 0, Math.PI/2)); // Original orientation\n            \n            // Portal should be at full size immediately\n            portalEffect.setScale(3.5);\n            \n            // Fade in portal\n            const portalProgress = Math.min((progress - 0.1) / 0.3, 1.0);\n            portalEffect.setOpacity(portalProgress);\n        }\n        \n        // Simple 180 degree rotation\n        if (progress > 0.2) {\n            const rotateProgress = Math.min((progress - 0.2) / 0.3, 1.0);\n            const startRot = Math.PI/2;  // Currently facing center\n            const endRot = 3 * Math.PI/2; // 180 degree rotation (facing back toward original portal)\n            starDreadnought.ship.rotation.y = startRot + (endRot - startRot) * rotateProgress;\n        }\n        \n        // Fixed camera position from the side to view the rotation\n        const shipPos = starDreadnought.ship.position.clone();\n        camera.position.set(\n            shipPos.x,\n            shipPos.y + 3000, // High-ish angle\n            shipPos.z + 8000  // Side view\n        );\n        camera.lookAt(shipPos);\n    }\n    \n    // SECOND HALF: Ship accelerates through original portal and disappears (0.5-1.0)\n    else {\n        // Calculate movement progress for this phase\n        const moveProgress = (progress - 0.5) / 0.5;\n        \n        // Ship position calculation - go back toward original portal\n        const startPos = new THREE.Vector3(22000, 5000, 0); // Ship's current position\n        const beyondPos = new THREE.Vector3(35000, 5000, 0); // Beyond portal\n        \n        // Simple acceleration curve\n        const easeIn = moveProgress * moveProgress; // Accelerating movement\n        \n        // Ship position calculation\n        let position: THREE.Vector3;\n        if (moveProgress < 0.7) {\n            // Move to portal\n            const t = easeIn / 0.5; // Normalized and accelerated\n            position = new THREE.Vector3().lerpVectors(startPos, portalPos, t);\n        } else {\n            // Continue beyond portal\n            const t = (moveProgress - 0.7) / 0.3;\n            position = new THREE.Vector3().lerpVectors(portalPos, beyondPos, t);\n        }\n        \n        // Update ship position\n        starDreadnought.ship.position.copy(position);\n        \n        // Increase engine power for dramatic exit\n        starDreadnought.setEnginesPower(0.7 + moveProgress * 0.8);\n        \n        // Flash when ship enters portal\n        if (moveProgress > 0.6 && moveProgress < 0.63) {\n            flashOverlay(0.4);\n            \n            // Play warp sound for re-entry but only exactly once at 0.61\n            if (introSounds.warp && Math.abs(moveProgress - 0.61) < 0.01) {\n                introSounds.warp.play();\n            }\n        }\n        \n        // Hide ship after it enters portal\n        if (moveProgress > 0.65) {\n            starDreadnought.ship.visible = false;\n        }\n        \n        // Collapse portal at the very end\n        if (moveProgress > 0.9) {\n            const collapseProgress = (moveProgress - 0.9) / 0.1;\n            const collapseScale = (1 - collapseProgress) * 3.5;\n            portalEffect.setScale(collapseScale);\n        }\n        \n        // Static camera position showing ship's departure path\n        const shipPos = startPos.clone(); // Use initial position as reference\n        camera.position.set(\n            shipPos.x - 2000,\n            shipPos.y + 3000,\n            10000 // Side view\n        );\n        // Look at the midpoint of the departure path\n        const lookPos = new THREE.Vector3().lerpVectors(startPos, portalPos, 0.5);\n        camera.lookAt(lookPos);\n    }\n}","// introSequence.ts - Manages the cinematic Star Dreadnought intro sequence\n\nimport * as THREE from 'three';\nimport { StarDreadnought } from './environment/starDreadnought.js';\nimport { createIntroSoundEffects } from './intro/audio/soundEffects.js';\nimport { loadDialogueWavs } from './intro/audio/dialogueManager.js';\nimport { PortalEffect } from './intro/effects/portalEffect.js';\nimport { DialogueSystem } from './intro/ui/dialogueSystem.ts';\nimport { updateArrivalPhase } from './intro/animation/arrivalPhase.js';\nimport { updateDeparturePhase } from './intro/animation/departurePhase.js';\n\ntype IntroSoundEffect = {\n    play?: () => void;\n    dispose?: () => void;\n};\n\ntype IntroSoundMap = Record<string, IntroSoundEffect>;\n\ntype AudioManagerLike = {\n    muted?: boolean;\n    sfxVolume?: number;\n    audioContext?: { state: string };\n    resumeAudioContext?: () => void;\n    initialize?: () => Promise<void>;\n};\n\ninterface PortalEffectLike {\n    getPortalGroup: () => THREE.Group;\n    updatePortalEffect: () => void;\n    setOpacity: (opacity: number) => void;\n    setScale: (scale: number) => void;\n    setPosition: (position: THREE.Vector3) => void;\n    setRotation: (rotation: THREE.Euler) => void;\n    setVisible: (visible: boolean) => void;\n    dispose: () => void;\n}\n\ninterface StarDreadnoughtLike {\n    ship: THREE.Group;\n    teleportBeamActive: boolean;\n    setEnginesPower: (power: number) => void;\n    activateTeleportBeam: () => void;\n    deactivateTeleportBeam: () => void;\n    updateTeleportBeam: (progress: number) => void;\n    destroy?: () => void;\n    dispose?: () => void;\n}\n\ninterface VectorLike {\n    set: (x: number, y: number, z: number) => void;\n    x: number;\n    y: number;\n    z: number;\n}\n\ninterface EulerLike {\n    set: (x: number, y: number, z: number) => void;\n}\n\ninterface MeshLike {\n    position: VectorLike;\n    rotation: EulerLike;\n    visible?: boolean;\n    add?: (obj: THREE.Object3D) => void;\n    remove?: (obj: THREE.Object3D) => void;\n}\n\ninterface SpaceshipLike {\n    mesh?: MeshLike;\n    thrust?: {\n        forward: boolean;\n        backward: boolean;\n        left: boolean;\n        right: boolean;\n        boost: boolean;\n    };\n    velocity?: THREE.Vector3;\n    isDocked?: boolean;\n    hull?: number;\n    shield?: number;\n    fuel?: number;\n}\n\ninterface DialogueSystemLike {\n    initialize: (dialogueWavs: HTMLAudioElement[], audioManager?: AudioManagerLike | null) => void;\n    setupDialogueUI: () => void;\n    typeNextDialogue: (sequenceTime?: number, isPlaying?: boolean) => boolean;\n    cleanup: () => void;\n}\n\nexport type IntroSequenceAnimationContext = {\n    portalEffect: PortalEffectLike;\n    starDreadnought: StarDreadnoughtLike;\n    camera: THREE.Camera;\n    spaceship: SpaceshipLike | null;\n    introSounds: IntroSoundMap;\n    flashOverlay: (maxOpacity?: number) => void;\n    finalPlayerPosition?: THREE.Vector3;\n    playerShieldEffect?: THREE.Object3D | null;\n    shieldPulseTime?: number;\n};\n\ntype GameWindowWithInstance = Window & {\n    gameInstance?: {\n        spaceship?: SpaceshipLike;\n    };\n};\n\nexport class IntroSequence {\n    scene: THREE.Scene | null;\n    camera: THREE.Camera | null;\n    spaceship: SpaceshipLike | null;\n    audio: AudioManagerLike | null;\n    isPlaying: boolean;\n    sequenceTime: number;\n    onComplete: (() => void) | null;\n    skipEnabled: boolean;\n    initialCameraPosition: THREE.Vector3 | null;\n    initialCameraRotation: THREE.Euler | null;\n    starDreadnought: StarDreadnoughtLike | null;\n    portalEffect: PortalEffectLike | null;\n    overlay: HTMLDivElement | null;\n    dialogueSystem: DialogueSystemLike | null;\n    introSounds: IntroSoundMap;\n    dialogueWavs: HTMLAudioElement[];\n    skipButton: HTMLDivElement | null;\n    lastTime: number;\n    animationFrameId: number | null;\n    finalPlayerPosition?: THREE.Vector3;\n    playerShieldEffect?: THREE.Object3D | null;\n    shieldPulseTime?: number;\n    skipHandler?: (event: KeyboardEvent) => void;\n\n    constructor(scene: THREE.Scene, camera: THREE.Camera, spaceship: SpaceshipLike | null, audioManager: AudioManagerLike | null) {\n        this.scene = scene;\n        this.camera = camera;\n        this.spaceship = spaceship;\n        this.audio = audioManager;\n        this.isPlaying = false;\n        this.sequenceTime = 0;\n        this.onComplete = null;\n        this.skipEnabled = false; // Only enable skip after first playthrough\n        \n        // Save initial camera position\n        this.initialCameraPosition = null;\n        this.initialCameraRotation = null;\n        \n        // Create StarDreadnought instance\n        this.starDreadnought = new StarDreadnought(scene) as unknown as StarDreadnoughtLike;\n        \n        // Setup portal effect\n        this.portalEffect = new PortalEffect() as unknown as PortalEffectLike;\n        \n        // Overlay for flash effects\n        this.overlay = null;\n        this.setupOverlay();\n        \n        // Setup dialogue system\n        this.dialogueSystem = new DialogueSystem() as unknown as DialogueSystemLike;\n        \n        // Custom sound effects\n        this.introSounds = {};\n        \n        // Dialogue WAV files\n        this.dialogueWavs = [];\n        \n        this.skipButton = null;\n        this.lastTime = 0;\n        this.animationFrameId = null;\n        \n        console.log(\"Intro sequence initialized\");\n        \n        // Load dialogue WAV files\n        this.dialogueWavs = loadDialogueWavs() as HTMLAudioElement[];\n        \n        // Create custom Tone.js sound effects\n        this.introSounds = createIntroSoundEffects(this.audio) as IntroSoundMap;\n        \n        // Initialize dialogue system\n        this.dialogueSystem.initialize(this.dialogueWavs, this.audio);\n    }\n    \n    setupOverlay(): void {\n        // Create a DOM overlay for the flash effect\n        this.overlay = document.createElement('div');\n        this.overlay.id = 'intro-overlay';\n        this.overlay.style.position = 'fixed';\n        this.overlay.style.top = '0';\n        this.overlay.style.left = '0';\n        this.overlay.style.width = '100%';\n        this.overlay.style.height = '100%';\n        this.overlay.style.backgroundColor = '#aa33ff'; // Match portal color\n        this.overlay.style.opacity = '0';\n        this.overlay.style.transition = 'opacity 0.5s';\n        this.overlay.style.pointerEvents = 'none';\n        this.overlay.style.zIndex = '9999';\n        \n        // Add to DOM but hide initially\n        document.body.appendChild(this.overlay);\n    }\n    \n    startSequence(onComplete?: () => void): void {\n        if (this.isPlaying) return;\n        \n        console.log(\"Starting intro sequence...\");\n        this.isPlaying = true;\n        this.sequenceTime = 0;\n        this.onComplete = onComplete || null;\n\n        const camera = this.camera as THREE.Camera;\n        const scene = this.scene as THREE.Scene;\n        const portalEffect = this.portalEffect as PortalEffectLike;\n        const starDreadnought = this.starDreadnought as StarDreadnoughtLike;\n        \n        // Store initial camera state to restore player camera after sequence\n        this.initialCameraPosition = camera.position.clone();\n        this.initialCameraRotation = camera.rotation.clone();\n        \n        // Position camera for initial view of portal forming\n        camera.position.set(0, 6000, 12000);\n        camera.lookAt(30000, 5000, 0); // Look at where portal will appear\n        \n        // Hide player ship during sequence\n        if (this.spaceship && this.spaceship.mesh) {\n            this.spaceship.mesh.visible = false;\n            \n            // Disable ship thrusters to prevent any movement\n            if (this.spaceship.thrust) {\n                this.spaceship.thrust.forward = false;\n                this.spaceship.thrust.backward = false;\n                this.spaceship.thrust.left = false;\n                this.spaceship.thrust.right = false;\n                this.spaceship.thrust.boost = false;\n            }\n            \n            // Make sure velocity is zero\n            if (this.spaceship.velocity) {\n                this.spaceship.velocity.set(0, 0, 0);\n            }\n        }\n        \n        // Add portal to scene\n        scene.add(portalEffect.getPortalGroup());\n        \n        // Position the star dreadnought initially outside the scene\n        starDreadnought.ship.position.set(35000, 5000, 0); // Off-screen\n        starDreadnought.ship.rotation.y = Math.PI / 2; // Face toward center\n        starDreadnought.ship.visible = false;\n        \n        // Start sequence animation\n        this.animate = this.animate.bind(this);\n        this.lastTime = performance.now();\n        requestAnimationFrame(this.animate);\n        \n        // Setup skip functionality\n        this.setupSkipHandler();\n        \n        // Setup dialogue UI\n        this.dialogueSystem?.setupDialogueUI();\n        \n        // Start first dialogue line\n        setTimeout(() => {\n            this.dialogueSystem?.typeNextDialogue(this.sequenceTime, this.isPlaying);\n        }, 2000);\n        \n        // Play warp sound\n        if (this.introSounds.warp) {\n            this.introSounds.warp.play?.();\n        }\n    }\n    \n    animate(currentTime: number): void {\n        if (!this.isPlaying) return;\n        \n        // Slower pace for more sublime experience\n        const deltaTime = Math.min((currentTime - this.lastTime) / 1000, 0.1) * 0.4; // 60% slower\n        this.lastTime = currentTime;\n        \n        // Update sequence timer\n        this.sequenceTime += deltaTime;\n        \n        // Just TWO phases - arrival and departure\n        if (this.sequenceTime < 14.0) {\n            // Phase 1: Portal, ship arrival and player deployment (0-14s)\n            const context = this.createAnimationContext();\n            updateArrivalPhase(this.sequenceTime / 14.0, context);\n        } else if (this.sequenceTime < 24.0) {\n            // Phase 2: Ship departure (14-24s)\n            const context = this.createAnimationContext();\n            updateDeparturePhase((this.sequenceTime - 14.0) / 10.0, context);\n        } else {\n            // Sequence complete\n            this.completeSequence();\n            return;\n        }\n        \n        requestAnimationFrame(this.animate);\n    }\n    \n    /**\n     * Create context object for animation phases\n     * @returns Context containing all necessary references\n     */\n    createAnimationContext(): IntroSequenceAnimationContext {\n        return {\n            portalEffect: this.portalEffect as PortalEffectLike,\n            starDreadnought: this.starDreadnought as StarDreadnoughtLike,\n            camera: this.camera as THREE.Camera,\n            spaceship: this.spaceship,\n            introSounds: this.introSounds,\n            flashOverlay: this.flashOverlay.bind(this),\n            finalPlayerPosition: this.finalPlayerPosition,\n            playerShieldEffect: this.playerShieldEffect,\n            shieldPulseTime: this.shieldPulseTime\n        };\n    }\n    \n    flashOverlay(maxOpacity = 0.6): void {\n        if (!this.overlay) return;\n        \n        // Flash overlay effect\n        this.overlay.style.opacity = maxOpacity.toString();\n        \n        // Fade out after flash\n        setTimeout(() => {\n            if (this.overlay) {\n                this.overlay.style.opacity = '0';\n            }\n        }, 300);\n    }\n    \n    setupSkipHandler(): void {\n        // Add skip button\n        const skipButton = document.createElement('div');\n        skipButton.id = 'skip-intro-button';\n        skipButton.textContent = 'SKIP INTRO';\n        skipButton.style.position = 'fixed';\n        skipButton.style.bottom = '10px';\n        skipButton.style.left = '50%';\n        skipButton.style.transform = 'translateX(-50%)';\n        skipButton.style.padding = '10px 15px';\n        skipButton.style.backgroundColor = 'rgba(0, 0, 0, 0.7)';\n        skipButton.style.color = '#30f0c0';\n        skipButton.style.border = '1px solid #30f0c0';\n        skipButton.style.borderRadius = '5px';\n        skipButton.style.cursor = 'pointer';\n        skipButton.style.zIndex = '10000';\n        skipButton.style.fontFamily = 'Courier New, monospace';\n        skipButton.style.boxShadow = '0 0 10px rgba(48, 240, 192, 0.3)';\n        \n        skipButton.addEventListener('click', () => {\n            this.skipSequence();\n        });\n        \n        document.body.appendChild(skipButton);\n        this.skipButton = skipButton;\n    }\n    \n    skipSequence(): void {\n        console.log(\"Skipping intro sequence\");\n        \n        // Position ship exactly where the intro would have positioned it\n        if (this.spaceship && this.spaceship.mesh) {\n            // Position where the dreadnought would have deployed the ship\n            // Dreadnought ends at (22000, 5000, 0), ship is 2000 units below\n            this.spaceship.mesh.position.set(22000, 3000, 0);\n            this.spaceship.mesh.rotation.set(0, 0, 0);\n            \n            // Make sure ship is NOT docked\n            this.spaceship.isDocked = false;\n            this.spaceship.mesh.visible = true;\n            \n            // Ensure ship has proper health and fuel values\n            if (this.spaceship.hull !== undefined && this.spaceship.hull <= 0) {\n                console.log(\"Fixing spaceship hull from\", this.spaceship.hull, \"to 100\");\n                this.spaceship.hull = 100;\n            }\n            if (this.spaceship.shield !== undefined && this.spaceship.shield <= 0) {\n                console.log(\"Fixing spaceship shield from\", this.spaceship.shield, \"to 50\");\n                this.spaceship.shield = 50;\n            }\n            if (this.spaceship.fuel !== undefined && this.spaceship.fuel <= 0) {\n                console.log(\"Fixing spaceship fuel from\", this.spaceship.fuel, \"to 100\");\n                this.spaceship.fuel = 100;\n            }\n        }\n        \n        // End the sequence immediately\n        this.completeSequence();\n        \n        // Don't show stargate UI - player should be in space after skipping\n        // Just ensure the ship is properly set to undocked state\n        const gameWindow = window as GameWindowWithInstance;\n        if (gameWindow.gameInstance && gameWindow.gameInstance.spaceship) {\n            gameWindow.gameInstance.spaceship.isDocked = false;\n            console.log(\"Ship set to undocked state after skip\");\n            \n            // Double-check health values on the global instance too\n            if (gameWindow.gameInstance.spaceship.hull !== undefined && gameWindow.gameInstance.spaceship.hull <= 0) {\n                console.log(\"Fixing global spaceship hull to 100\");\n                gameWindow.gameInstance.spaceship.hull = 100;\n            }\n            if (gameWindow.gameInstance.spaceship.fuel !== undefined && gameWindow.gameInstance.spaceship.fuel <= 0) {\n                console.log(\"Fixing global spaceship fuel to 100\");\n                gameWindow.gameInstance.spaceship.fuel = 100;\n            }\n        }\n    }\n    \n    completeSequence(): void {\n        console.log(\"Intro sequence complete\");\n        this.isPlaying = false;\n\n        const scene = this.scene as THREE.Scene;\n        const portalEffect = this.portalEffect as PortalEffectLike;\n        const starDreadnought = this.starDreadnought as StarDreadnoughtLike;\n        \n        // Remove warp tunnel from scene\n        scene.remove(portalEffect.getPortalGroup());\n        \n        // Hide dreadnought\n        starDreadnought.ship.visible = false;\n        \n        // Enable skip button for next time\n        this.skipEnabled = true;\n        \n        // Remove shield effect from player\n        if (this.playerShieldEffect && this.spaceship?.mesh) {\n            this.spaceship.mesh.remove?.(this.playerShieldEffect);\n            this.playerShieldEffect = null;\n        }\n        \n        // Remove skip button if it exists\n        if (this.skipButton) {\n            document.body.removeChild(this.skipButton);\n            this.skipButton = null;\n        }\n        \n        // Remove overlay from DOM completely\n        if (this.overlay) {\n            document.body.removeChild(this.overlay);\n            this.overlay = null;\n        }\n        \n        // Clean up dialogue system\n        this.dialogueSystem?.cleanup();\n        \n        // Make sure player ship is visible but DO NOT reset position\n        if (this.spaceship && this.spaceship.mesh) {\n            this.spaceship.mesh.visible = true;\n            \n            // IMPORTANT: Make sure ship is properly undocked\n            if (this.spaceship.isDocked) {\n                console.log(\"Forcing ship to undocked state after intro sequence\");\n                this.spaceship.isDocked = false;\n            }\n            \n            // Log the final player position for debugging\n            console.log(\"Player final position:\", \n                this.spaceship.mesh.position.x, \n                this.spaceship.mesh.position.y, \n                this.spaceship.mesh.position.z\n            );\n        }\n        \n        // Call completion callback if provided\n        if (this.onComplete && typeof this.onComplete === 'function') {\n            // Use setTimeout to make sure this executes after the animation frame\n            setTimeout(() => {\n                console.log(\"Executing intro sequence completion callback\");\n                this.onComplete?.();\n            }, 100);\n        }\n    }\n\n    /**\n     * Clean up resources when intro sequence is no longer needed\n     */\n    destroy(): void {\n        // Cancel animation frame if running\n        if (this.animationFrameId) {\n            cancelAnimationFrame(this.animationFrameId);\n            this.animationFrameId = null;\n        }\n        \n        // Clean up dialogue system\n        this.dialogueSystem?.cleanup();\n        \n        if (this.overlay && this.overlay.parentNode) {\n            this.overlay.parentNode.removeChild(this.overlay);\n        }\n        \n        // Remove skip handler\n        document.removeEventListener('keydown', this.skipHandler as EventListener);\n        \n        // Clean up portal effect\n        if (this.portalEffect) {\n            this.portalEffect.dispose();\n        }\n        \n        // Dispose of star dreadnought resources\n        if (this.starDreadnought && typeof this.starDreadnought.destroy === 'function') {\n            this.starDreadnought.destroy();\n        }\n        \n        // Dispose of Tone.js sound effects\n        if (this.introSounds) {\n            Object.values(this.introSounds).forEach(sound => {\n                if (sound.dispose && typeof sound.dispose === 'function') {\n                    sound.dispose();\n                }\n            });\n            this.introSounds = {};\n        }\n        \n        // Clear references to help GC\n        this.scene = null;\n        this.camera = null;\n        this.spaceship = null;\n        this.audio = null;\n        this.starDreadnought = null;\n        this.portalEffect = null;\n        this.dialogueSystem = null;\n        this.dialogueWavs = [];\n    }\n}\n"],"names":["DreadnoughtHull","scale","ship","hullLength","hullWidth","hullHeight","taperFactor","hullGeometry","THREE.BufferGeometry","vertices","THREE.BufferAttribute","hullMaterial","THREE.MeshStandardMaterial","hull","THREE.Mesh","plateLength","plateWidth","plateHeight","plateY","i","plateZ","plateGeometry","THREE.BoxGeometry","plateMaterial","plate","DreadnoughtBridge","bridgeHeight","bridgeWidth","bridgeDepth","bridgeY","bridgeZ","bridgeMaterial","mainTowerGeometry","mainTower","secondaryTowerScale","secondaryTowerGeometry","leftTower","rightTower","windowSize","windowSpacing","windowRows","windowCols","windowsStartY","windowDepth","windowMaterial","row","col","windowGeometry","window","DreadnoughtEngines","__publicField","engineRadius","engineLength","engineZ","engineY","engineHousingWidth","engineHousingHeight","engineHousingLength","housingGeometry","housingMaterial","engineHousing","engineMaterial","glowMaterial","engineRows","enginesPerRow","verticalSpacing","rowY","posX","engineGeometry","THREE.CylinderGeometry","engine","glowGeometry","THREE.SphereGeometry","glow","outerGlowGeometry","outerGlowMaterial","outerGlow","width","particleGeometry","positions","colors","sizes","enginePositions","i3","engineIndex","engineX","offsetX","offsetY","trailLength","particleMaterial","THREE.ShaderMaterial","THREE.AdditiveBlending","THREE.Points","canvas","context","gradient","texture","THREE.Texture","power","index","isMainGlow","material","glowScale","baseSizes","DreadnoughtWeapons","turretRadius","turretHeight","baseRadius","baseHeight","turretMaterial","portPositions","z","pos","baseGeometry","base","turretGeometry","turret","starboardPositions","trenchWidth","trenchDepth","trenchLength","trenchMaterial","centerTrenchGeometry","centerTrench","sideTrenchGeometry","portTrench","starboardTrench","domeRadius","domeY","domeZ","domeMaterial","portDomeGeometry","portDome","starboardDomeGeometry","starboardDome","TeleportBeam","beamTopRadius","beamBottomRadius","beamHeight","beamMaterial","THREE.Color","THREE.DoubleSide","beamGeometry","teleportBeam","ringGeometry","THREE.RingGeometry","ringMaterial","impactRing","TeleportParticles","isInnerBeam","radius","theta","height","teleportParticles","TeleportController","progress","timeIncrement","intensity","ringScale","StarDreadnought","scene","THREE.Group","shipScale","_deltaTime","child","mesh","createIntroSoundEffects","audioManager","introSounds","createWarpSound","createShipArrivalSound","createTeleportSound","error","Tone","destination","warpFilter","warpReverb","warpSynth","noiseFilter","noiseGain","noise","now","volumeLevel","arrivalFilter","arrivalSynth","rumbleFilter","rumbleSynth","teleportFilter","teleportChorus","teleportSynth","beamFilter","beamSynth","loadDialogueWavs","dialogueWavs","audioPath","getAbsolutePath","audio","playDialogueWav","dialogueAudio","playPromise","err","PortalEffect","portalGeometry","portalMaterial","particleCount","particles","angle","THREE.PointsMaterial","opacity","position","rotation","visible","DialogueSystem","sequenceTime","isPlaying","line","charIndex","waitTime","updateArrivalPhase","portalEffect","starDreadnought","camera","spaceship","flashOverlay","THREE.Vector3","THREE.Euler","portalScale","_a","t","easeInOut","start","control","end","p0","p1","p2","enginePower","portalFade","shipPos","_b","dreadPos","createPlayerShieldEffect","lookY","geometry","THREE.MeshBasicMaterial","updateDeparturePhase","portalPos","portalProgress","rotateProgress","startRot","endRot","moveProgress","startPos","beyondPos","easeIn","collapseScale","lookPos","IntroSequence","onComplete","_c","currentTime","deltaTime","maxOpacity","skipButton","gameWindow","_d","sound"],"mappings":"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"}