{"version":3,"mappings":"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AA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AA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","names":["CopyShader","Pass","_camera","OrthographicCamera","FullscreenTriangleGeometry","BufferGeometry","Float32BufferAttribute","_geometry","FullScreenQuad","material","Mesh","renderer","value","ShaderPass","shader","textureID","ShaderMaterial","UniformsUtils","writeBuffer","readBuffer","MaskPass","scene","camera","context","state","writeValue","clearValue","ClearMaskPass","EffectComposer","renderTarget","size","Vector2","WebGLRenderTarget","HalfFloatType","NoBlending","Clock","tmp","pass","index","passIndex","i","deltaTime","currentRenderTarget","maskActive","il","stencil","width","height","effectiveWidth","effectiveHeight","pixelRatio","RenderPass","overrideMaterial","clearColor","clearAlpha","Color","oldAutoClear","oldClearAlpha","oldOverrideMaterial","LuminosityHighPassShader","UnrealBloomPass","resolution","strength","radius","threshold","resx","resy","renderTargetHorizontal","renderTargetVertical","highPassShader","kernelSizeArray","bloomFactors","Vector3","AdditiveBlending","MeshBasicMaterial","inputRenderTarget","kernelRadius","coefficients","nMips","FXAAShader","ColorCorrectionShader","FilmShader","VignetteShader","WebGL","canvas","colorSpace","ctx","version","names","contexts","message","element","Renderer","warning","THREE.Scene","THREE.PerspectiveCamera","THREE.WebGLRenderer","THREE.PCFSoftShadowMap","THREE.ACESFilmicToneMapping","THREE.SRGBColorSpace","renderPass","THREE.Vector2","error","fxaaPass","THREE.Vector3","ambientLight","THREE.AmbientLight","directionalLight","THREE.DirectionalLight","fillLight","hemisphereLight","THREE.HemisphereLight","ambientPointLight","THREE.PointLight","object","sun","sunWorldPos","screenVector","x","y","camToSunDistance","normalizedDistance","camDirection","sunDirection","dotProduct","key","geometry","maxCount","instancedMesh","THREE.InstancedMesh","THREE.Object3D","position","quaternion","scale","instance","idx","matrix","THREE.Matrix4","propertyName","property","godRayShader","THREE.Color","shaderPass","claudeRayShader","useClaudeRays","enabled","params","uniforms","intensity","exposure","weight","density","Spaceship","THREE.Euler","THREE.Group","bodyGroup","cylinderGeometry","THREE.CylinderGeometry","bodyMaterial","THREE.MeshPhongMaterial","bodyCylinder","THREE.Mesh","noseGeometry","THREE.ConeGeometry","noseCone","cockpitGeometry","THREE.SphereGeometry","cockpitMaterial","cockpit","cannonGeometry","cannonMaterial","emitterGeometry","emitterMaterial","createCurvedWing","isLeft","wingGroup","wingMaterial","wingBaseGeom","THREE.BoxGeometry","wingBase","wingCurveGeom","wingCurve","wingTipGeom","goldMaterial","wingTip","leftWing","rightWing","addGoldAccent","depth","z","rotX","rotY","rotZ","accentGeom","accent","thrusterGeometry","thrusterMaterial","mainThruster","reverseThruster","leftThruster","rightThruster","createParticleSystem","rotation","type","color","positions","i3","THREE.BufferGeometry","THREE.BufferAttribute","THREE.PointsMaterial","THREE.AdditiveBlending","particleSystem","THREE.Points","particles","velocities","colors","sizes","colorScheme","trailMaterial","THREE.ShaderMaterial","THREE.TextureLoader","ps","baseSize","speedFactor","stutter","temp","shieldBeforeUndock","stargatePosition","oldShield","players","health","oldHealthShield","e","oldHull","oldHealthHull","consumptionRate","thruster","child","part","isMoving","messageBus","entity","healthComponent","valuesForSync","oldHealth","_Physics","THREE.Raycaster","spaceship","hasFuel","thrustVector","isThrusting","shipForward","forwardVelocity","mainThrusterParticles","t","reverseThrusterParticles","leftThrusterParticles","rightThrusterParticles","forwardThrust","maxVelocity","intensityFactor","friction","positionDelta","maxY","euler","targetQuaternion","THREE.Quaternion","rotatedOffset","lookAtPoint","deltaX","deltaY","shipRadius","shipPosition","_a","asteroidMeshes","asteroidBelt","asteroids","a","_b","_c","distFromCenter","asteroid","distance","asteroidRadius","planetRadius","bounceDirection","explosionColor","explosionSize","explosionMessage","collisionType","explosionGeometry","explosionMaterial","THREE.MeshBasicMaterial","explosion","__vitePreload","module","MessageBus","err","resistance","recoveryChance","recoveryRoll","survived","shieldGeometry","shieldMaterial","THREE.DoubleSide","shield","expandSpeed","fadeSpeed","animateShield","animate","__publicField","Physics","Skybox","texturePath","adjustedTexturePath","starDensity","nebulaDensity","skyboxColor","brightness","skyboxTexture","skyMaterial","THREE.BackSide","skyboxGeometry","Sun","sunGeometry","sunMaterial","THREE.FrontSide","sunCoreMesh","coronaGeometry","coronaMaterial","coronaMesh","outerCoronaGeometry","outerCoronaMaterial","outerCoronaMesh","sunLight","sunDirectionalLight","flareTextures","textureLoader","flare","mainFlareTexture","mainFlare","THREE.Sprite","THREE.SpriteMaterial","flareCount","textureIndex","flareTexture","angle","smallFlareTexture","smallFlare","farRadius","farAngle","farX","farY","smallSize","lightIntensityMultiplier","temperature","activity","coronaColor","outerCoronaColor","flareColor","intensityMultiplier","baseIntensity","viewDependentMultiplier","viewVector","cameraNormal","angleToCam","cameraPos","lightPos","camDistanceToSun","shadowSize","time","pulseSpeed","pulseFactor","mainScale","originalSize","orbit","orbitSpeed","opacity","reducedOpacity","THREE.CameraHelper","planetTextures","proceduralTextures","texture","Planets","starSystemGenerator","solarSystemPlanets","systemId","generatedPlanets","customPlanets","planet","prefixes","suffixes","starClass","planetCount","planetData","sizeMultiplier","distanceMultiplier","colorPalette","prefix","suffix","name","sizeClass","baseDistance","distanceVariation","speed","rings","axialTilt","orbitalTilt","planetGeometry","planetMaterial","adjustedTextureUrl","customTexture","THREE.MeshStandardMaterial","planetMesh","ringGeometry","ringMaterial","ringMesh","THREE.RingGeometry","region","AsteroidBelt","THREE.IcosahedronGeometry","THREE.TetrahedronGeometry","THREE.OctahedronGeometry","j","vertex","resourceRoll","resourceType","mesh","heightVariation","orbitRadius","orbitTilt","baseResourceAmount","multipliers","densityMultiplier","shouldBeVisible","maxDistance","closestAsteroid","closestDistance","flatX","flatZ","tiltY","tiltZ","Stargate","stargateGroup","THREE.TorusGeometry","ring","createAccentRing","tubeRadius","accentRing","outerRing1","outerRing2","innerRing","detailsGroup","parentGroup","innerStructure","thinRingGeometry","thinRingMaterial","portalShaderMaterial","portalGeometry","THREE.CircleGeometry","portal","portalLight","createPortalWisps","wispGeometry","wispMaterial","wisp","createNeonAccent","accentGroup","beamGeometry","beamMaterial","beam","light","lightMesh","flicker","particle","pulse","StarSystemGenerator","solarSystem","count","id","classification","starColor","resourceMult","system","systemIds","solarConnections","targetId","extraConnectionCount","sourceId","targetSystemId","currentParams","targetParams","weights","total","sum","random","number","features","starDescriptions","classDescriptions","baseDistribution","classMultiplier","exceptId","selected","min","max","systemData","customSystem","_d","randomSystem","standardizedPlanets","dockingSystem","SystemTransition","theta","length","onComplete","elapsed","progress","warpSpeed","ApiClient","expiryTime","currentTime","fiveMinutesInMs","resolve","success","response","errorMessage","cb","data","expiryDate","errorData","systemName","description","planetName","relativeUrl","cleanPath","CustomSystemCreator","environment","style","button","firstPlanetDesc","textarea","maxChars","counter","updateCounter","remaining","closeBtn","modalContent","newIndex","planetDiv","removeBtn","slider","planetDesc","newPlanet","scrollPos","sizeSlider","sizeValue","distanceSlider","distanceValue","speedSlider","speedValue","planetInputs","planetHeader","skyboxDesc","skyboxResponse","planets","planetIndex","nameInput","descInput","sizeInput","distanceInput","speedInput","ringsInput","planetResponse","alertOverlay","alertBox","messageEl","okButton","stargateUI","VibeVersePortals","surfaceGeometry","surfaceMaterial","surface","particleCount","particleGeometry","particleMaterial","THREE.Box3","THREE.CanvasTexture","labelGeometry","THREE.PlaneGeometry","labelMaterial","label","shipBox","targetUrl","finalUrl","nextPage","url","SpaceAnomalies","availableTypes","anomaly","typeToSpawn","anomaliesToRemove","m","crystal","arc","frame","anomalyCountEl","playerPosition","playerNearby","anomalyGroup","ringCount","hue","orbRarity","orb","crystals","crystalCount","crystalType","THREE.DodecahedronGeometry","saturation","lightness","phi","ringRadius","ringHue","ringColor","crystalSize","crystalGeometry","crystalHue","crystalColor","crystalMaterial","coreRadius","coreGeometry","coreColor","coreMaterial","core","arcCount","arcs","curve","THREE.CubicBezierCurve3","points","arcGeometry","arcColor","arcMaterial","THREE.LineBasicMaterial","THREE.Line","frames","frameCount","innerGeometry","edges","THREE.EdgesGeometry","innerMaterial","THREE.LineSegments","innerBox","particlePositions","particleSizes","glowGeometry","glowMaterial","glow","rarity","orbGeometry","orbMaterial","glowSize","gradient","THREE.Texture","roll","closestAnomaly","orbData","floatOffset","rotationMatrix","crystalScale","controlPoint1","controlPoint2","pulseScale","maxDist","pos","corePulse","warpX","warpY","warpZ","initialPositions","phases","radialPulse","Environment","stargateRegion","resources","solarSystemParams","notification","asteroidBeltRegion","anomaliesRegion","anomalyType","orbStatus","nearbyAsteroids","sunRegion","InputHandler","physics","instructionsElement","movementX","movementY","MiningSystem","baseSpeed","efficiency","targetInfo","targetName","targetDistance","laserBeam","laserColor","glowColor","laserIntensity","miningProgressContainer","progressBar","miningStatusElement","secondsRequired","efficiencyText","asteroidPosition","shipOffset","tempVector","shipX","shipY","asteroidX","asteroidY","dx","dy","thickness","additionalBeam","particleSpeed","dir","bonusChance","amount","animateParticles","destroyedAsteroid","inRange","TargetingSystem","innerRingGeometry","innerRingMaterial","targetInfoElement","b","item","targetNameElement","targetResourcesElement","lookAtPos","game","pulseValue","targetDistanceElement","isOnScreen","screenPosition","targetDirection","target","margin","halfWidth","halfHeight","normalizedDir","edgeX","edgeY","slopeRatio","screenRatio","worldPosition","DockingSystem","stargate","ui","refuelBtn","repairShieldBtn","repairHullBtn","undockBtn","handleUndock","sellIronBtn","sellGoldBtn","sellPlatinumBtn","buttonId","costGetter","upgradeFunction","cost","miningSystem","stepFunction","stepName","container","loadingIndicator","newPosition","healthData","customSystemCreator","starMap","closeStarMapBtn","modal","TouchControls","controls","systemStatus","crosshair","reject","script","leftJoystickZone","rightJoystickZone","leftActionButtonsContainer","rightActionButtonsContainer","parent","text","evt","force","xMove","yMove","targetAsteroid","closestDist","dist","leftZone","rightZone","leftActionButtons","rightActionButtons","startHandler","endHandler","MobileDetector","userAgentCheck","touchCheck","screenCheck","viewportCheck","viewport","mobileFeatureCheck","motionCheck","isTablet","isIpad","isAndroidTablet","handler","prevOrientation","checkOrientation","currentOrientation","Controls","originalSpeed","rarityColor","capitalizedRarity","wasDocked","isDocked","now","MobileHUD","hudContainer","cargoContainer","cargoLabel","cargoValue","hordeContainer","hordeTimer","labelElement","barContainer","fuelValue","bar","anomalyContainer","anomalyLabel","anomalyCount","panel","topLeft","topRight","bottomLeft","bottomRight","shieldBar","shieldPercentage","hullBar","hullPercentage","fuelBar","fuelPercent","maxCargo","totalCargo","hordeIndicator","totalSeconds","minutes","seconds","styleEl","locationName","MiningDisplay","miningTime","ironAmount","goldAmount","platinumAmount","cargoCapacity","capacityBar","totalResources","maxCapacity","capacityPercentage","miningTimeElement","TargetingUI","lockOnDisplay","diagonalLines","targetIndicator","targetType","targetTypeElement","targetResourceElement","resourceColor","getAbsolutePath","relativePath","basePath","fullPath","GameOverScreen","gameOverContainer","gameOverTitle","gameOverMessage","resourcesSummary","restartButton","loadingStatus","displayMessage","wasHordeMode","hordeSurvivalTime","rawSurvivalTime","resourceData","iron","gold","platinum","hordeMessage","boinkSound","ControlsMenu","controlsMenu","controlsTitle","createControlRow","keyText","actionText","row","keySpan","actionSpan","showControlsButton","StarMap","stargateInterface","title","content","mapContainer","infoPanel","currentSystem","selectedSystem","closeButton","travelButton","travelHandler","event","rect","clickedSystem","systems","centerX","centerY","canvasX","canvasY","selectedCard","isConnected","isCurrentSystem","connections","connectedSystems","x1","y1","connectedId","connectedSystem","x2","y2","currentSystemData","isCurrent","isSelected","BlackjackGame","audio","scanlines","header","subtitle","gameArea","dealerArea","dealerHeader","dealerTitle","dealerScore","dealerCards","speechBubble","statusArea","gameStatus","playerArea","playerHeader","playerTitle","playerScore","playerCards","controlsArea","bettingControls","bettingTitle","resourceOptions","createResourceButton","resource","btn","resourceName","resourceAmount","addHoverEffect","removeHoverEffect","clickHandler","betAmountControls","betAmountDisplay","createControlButton","decreaseBtn","increaseBtn","gameActions","enableHoverEffects","disableHoverEffects","gameResources","suits","values","suit","card","hand","score","aces","faceDown","cardEl","backDesign","logo","topValue","topSuit","centerSymbol","bottomValue","bottomSuit","pattern","holoEffect","maxAmount","dealBtn","hitBtn","standBtn","doubleBtn","canDouble","canDeal","ironElement","goldElement","platinumElement","visibleScore","dealerPlayNextCard","faceDownEl","lastCard","winAmount","phrases","randomPhrase","Settings","savedSettings","parsedSettings","settingsContainer","backButton","applyButton","applyHandler","presetName","presetHandler","preset","THREE.PCFShadowMap","fpsElement","oldCap","performance","gl","debugInfo","rafCount","startTime","prevTimestamp","refreshRates","detectFrame","timestamp","interval","median","validRates","rate","avg","StartScreen","startScreen","playButton","howToPlayButton","howToPlayModal","closeHowToPlayButton","timeToStartScreen","typedArrayPools","FixedArray","callback","result","MemoryStats","report","UI","HUD","StargateInterface","mobileCSS","wasMobile","duration","fps","cap","fpsDisplay","notificationsArea","fallbackOverlay","messageText","mobileHudContainer","pointerLockInstructions","statsContainer","memoryStats","fpsCounter","AudioManager","node","loadPromises","sound","gameplaySounds","audioData","audioBuffer","directory","handleInteraction","forceAudioResume","attachToButtons","attempts","actionButtons","soundtrackFiles","dummyAudio","path","array","currentIndex","randomIndex","files","shuffledFiles","file","anyFilesExist","soundEffects","buffer","currentTrack","track","playPromise","sourceNode","gainNode","volumeMultiplier","nodes","thrustLevel","volume"],"ignoreList":[0,1,2,3,4,5,6,7,8,9,10,11,12],"sources":["../../node_modules/three/examples/jsm/shaders/CopyShader.js","../../node_modules/three/examples/jsm/postprocessing/Pass.js","../../node_modules/three/examples/jsm/postprocessing/ShaderPass.js","../../node_modules/three/examples/jsm/postprocessing/MaskPass.js","../../node_modules/three/examples/jsm/postprocessing/EffectComposer.js","../../node_modules/three/examples/jsm/postprocessing/RenderPass.js","../../node_modules/three/examples/jsm/shaders/LuminosityHighPassShader.js","../../node_modules/three/examples/jsm/postprocessing/UnrealBloomPass.js","../../node_modules/three/examples/jsm/shaders/FXAAShader.js","../../node_modules/three/examples/jsm/shaders/ColorCorrectionShader.js","../../node_modules/three/examples/jsm/shaders/FilmShader.js","../../node_modules/three/examples/jsm/shaders/VignetteShader.js","../../node_modules/three/examples/jsm/capabilities/WebGL.js","../../js/modules/renderer.js","../../js/modules/spaceship.js","../../js/modules/physics.js","../../js/modules/environment/skybox.js","../../js/modules/environment/sun.js","../../js/modules/environment/planets.js","../../js/modules/environment/asteroidBelt.js","../../js/modules/environment/stargate.js","../../js/modules/environment/starSystemGenerator.js","../../js/modules/environment/systemTransition.js","../../js/modules/utils/apiClient.js","../../js/modules/ui/customSystemCreator.js","../../js/modules/environment/vibeVersePortals.js","../../js/modules/environment/spaceAnomalies.js","../../js/modules/environment.js","../../js/modules/controls/inputHandler.js","../../js/modules/controls/miningSystem.js","../../js/modules/controls/targetingSystem.js","../../js/modules/controls/dockingSystem.js","../../js/modules/controls/touchControls.js","../../js/utils/mobileDetector.js","../../js/modules/controls.js","../../js/modules/ui/mobileHUD.js","../../js/modules/ui/miningDisplay.js","../../js/modules/ui/targetingUI.js","../../js/utils/pathUtils.js","../../js/modules/ui/gameOverScreen.js","../../js/modules/ui/controlsMenu.js","../../js/modules/ui/starMap.js","../../js/modules/ui/blackjackGame.js","../../js/modules/ui/settings.js","../../js/modules/ui/startScreen.js","../../js/utils/memoryManager.js","../../js/modules/ui.js","../../js/modules/audio.js"],"sourcesContent":["/** @module CopyShader */\n\n/**\n * Full-screen copy shader pass.\n *\n * @constant\n * @type {ShaderMaterial~Shader}\n */\nconst CopyShader = {\n\n\tname: 'CopyShader',\n\n\tuniforms: {\n\n\t\t'tDiffuse': { value: null },\n\t\t'opacity': { value: 1.0 }\n\n\t},\n\n\tvertexShader: /* glsl */`\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}`,\n\n\tfragmentShader: /* glsl */`\n\n\t\tuniform float opacity;\n\n\t\tuniform sampler2D tDiffuse;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 texel = texture2D( tDiffuse, vUv );\n\t\t\tgl_FragColor = opacity * texel;\n\n\n\t\t}`\n\n};\n\nexport { CopyShader };\n","import {\n\tBufferGeometry,\n\tFloat32BufferAttribute,\n\tOrthographicCamera,\n\tMesh\n} from 'three';\n\n/**\n * Abstract base class for all post processing passes.\n *\n * This module is only relevant for post processing with {@link WebGLRenderer}.\n *\n * @abstract\n */\nclass Pass {\n\n\t/**\n\t * Constructs a new pass.\n\t */\n\tconstructor() {\n\n\t\t/**\n\t\t * This flag can be used for type testing.\n\t\t *\n\t\t * @type {boolean}\n\t\t * @readonly\n\t\t * @default true\n\t\t */\n\t\tthis.isPass = true;\n\n\t\t/**\n\t\t * If set to `true`, the pass is processed by the composer.\n\t\t *\n\t\t * @type {boolean}\n\t\t * @default true\n\t\t */\n\t\tthis.enabled = true;\n\n\t\t/**\n\t\t * If set to `true`, the pass indicates to swap read and write buffer after rendering.\n\t\t *\n\t\t * @type {boolean}\n\t\t * @default true\n\t\t */\n\t\tthis.needsSwap = true;\n\n\t\t/**\n\t\t * If set to `true`, the pass clears its buffer before rendering\n\t\t *\n\t\t * @type {boolean}\n\t\t * @default false\n\t\t */\n\t\tthis.clear = false;\n\n\t\t/**\n\t\t * If set to `true`, the result of the pass is rendered to screen. The last pass in the composers\n\t\t * pass chain gets automatically rendered to screen, no matter how this property is configured.\n\t\t *\n\t\t * @type {boolean}\n\t\t * @default false\n\t\t */\n\t\tthis.renderToScreen = false;\n\n\t}\n\n\t/**\n\t * Sets the size of the pass.\n\t *\n\t * @abstract\n\t * @param {number} width - The width to set.\n\t * @param {number} height - The width to set.\n\t */\n\tsetSize( /* width, height */ ) {}\n\n\t/**\n\t * This method holds the render logic of a pass. It must be implemented in all derived classes.\n\t *\n\t * @abstract\n\t * @param {WebGLRenderer} renderer - The renderer.\n\t * @param {WebGLRenderTarget} writeBuffer - The write buffer. This buffer is intended as the rendering\n\t * destination for the pass.\n\t * @param {WebGLRenderTarget} readBuffer - The read buffer. The pass can access the result from the\n\t * previous pass from this buffer.\n\t * @param {number} deltaTime - The delta time in seconds.\n\t * @param {boolean} maskActive - Whether masking is active or not.\n\t */\n\trender( /* renderer, writeBuffer, readBuffer, deltaTime, maskActive */ ) {\n\n\t\tconsole.error( 'THREE.Pass: .render() must be implemented in derived pass.' );\n\n\t}\n\n\t/**\n\t * Frees the GPU-related resources allocated by this instance. Call this\n\t * method whenever the pass is no longer used in your app.\n\t *\n\t * @abstract\n\t */\n\tdispose() {}\n\n}\n\n// Helper for passes that need to fill the viewport with a single quad.\n\nconst _camera = new OrthographicCamera( - 1, 1, 1, - 1, 0, 1 );\n\n// https://github.com/mrdoob/three.js/pull/21358\n\nclass FullscreenTriangleGeometry extends BufferGeometry {\n\n\tconstructor() {\n\n\t\tsuper();\n\n\t\tthis.setAttribute( 'position', new Float32BufferAttribute( [ - 1, 3, 0, - 1, - 1, 0, 3, - 1, 0 ], 3 ) );\n\t\tthis.setAttribute( 'uv', new Float32BufferAttribute( [ 0, 2, 0, 0, 2, 0 ], 2 ) );\n\n\t}\n\n}\n\nconst _geometry = new FullscreenTriangleGeometry();\n\n\n/**\n * This module is a helper for passes which need to render a full\n * screen effect which is quite common in context of post processing.\n *\n * The intended usage is to reuse a single full screen quad for rendering\n * subsequent passes by just reassigning the `material` reference.\n *\n * This module can only be used with {@link WebGLRenderer}.\n *\n * @augments Mesh\n */\nclass FullScreenQuad {\n\n\t/**\n\t * Constructs a new full screen quad.\n\t *\n\t * @param {?Material} material - The material to render te full screen quad with.\n\t */\n\tconstructor( material ) {\n\n\t\tthis._mesh = new Mesh( _geometry, material );\n\n\t}\n\n\t/**\n\t * Frees the GPU-related resources allocated by this instance. Call this\n\t * method whenever the instance is no longer used in your app.\n\t */\n\tdispose() {\n\n\t\tthis._mesh.geometry.dispose();\n\n\t}\n\n\t/**\n\t * Renders the full screen quad.\n\t *\n\t * @param {WebGLRenderer} renderer - The renderer.\n\t */\n\trender( renderer ) {\n\n\t\trenderer.render( this._mesh, _camera );\n\n\t}\n\n\t/**\n\t * The quad's material.\n\t *\n\t * @type {?Material}\n\t */\n\tget material() {\n\n\t\treturn this._mesh.material;\n\n\t}\n\n\tset material( value ) {\n\n\t\tthis._mesh.material = value;\n\n\t}\n\n}\n\nexport { Pass, FullScreenQuad };\n","import {\n\tShaderMaterial,\n\tUniformsUtils\n} from 'three';\nimport { Pass, FullScreenQuad } from './Pass.js';\n\n/**\n * This pass can be used to create a post processing effect\n * with a raw GLSL shader object. Useful for implementing custom\n * effects.\n *\n * ```js\n * const fxaaPass = new ShaderPass( FXAAShader );\n * composer.addPass( fxaaPass );\n * ```\n *\n * @augments Pass\n */\nclass ShaderPass extends Pass {\n\n\t/**\n\t * Constructs a new shader pass.\n\t *\n\t * @param {Object|ShaderMaterial} [shader] - A shader object holding vertex and fragment shader as well as\n\t * defines and uniforms. It's also valid to pass a custom shader material.\n\t * @param {string} [textureID='tDiffuse'] - The name of the texture uniform that should sample\n\t * the read buffer.\n\t */\n\tconstructor( shader, textureID = 'tDiffuse' ) {\n\n\t\tsuper();\n\n\t\t/**\n\t\t * The name of the texture uniform that should sample the read buffer.\n\t\t *\n\t\t * @type {string}\n\t\t * @default 'tDiffuse'\n\t\t */\n\t\tthis.textureID = textureID;\n\n\t\t/**\n\t\t * The pass uniforms.\n\t\t *\n\t\t * @type {?Object}\n\t\t */\n\t\tthis.uniforms = null;\n\n\t\t/**\n\t\t * The pass material.\n\t\t *\n\t\t * @type {?ShaderMaterial}\n\t\t */\n\t\tthis.material = null;\n\n\t\tif ( shader instanceof ShaderMaterial ) {\n\n\t\t\tthis.uniforms = shader.uniforms;\n\n\t\t\tthis.material = shader;\n\n\t\t} else if ( shader ) {\n\n\t\t\tthis.uniforms = UniformsUtils.clone( shader.uniforms );\n\n\t\t\tthis.material = new ShaderMaterial( {\n\n\t\t\t\tname: ( shader.name !== undefined ) ? shader.name : 'unspecified',\n\t\t\t\tdefines: Object.assign( {}, shader.defines ),\n\t\t\t\tuniforms: this.uniforms,\n\t\t\t\tvertexShader: shader.vertexShader,\n\t\t\t\tfragmentShader: shader.fragmentShader\n\n\t\t\t} );\n\n\t\t}\n\n\t\t// internals\n\n\t\tthis._fsQuad = new FullScreenQuad( this.material );\n\n\t}\n\n\t/**\n\t * Performs the shader pass.\n\t *\n\t * @param {WebGLRenderer} renderer - The renderer.\n\t * @param {WebGLRenderTarget} writeBuffer - The write buffer. This buffer is intended as the rendering\n\t * destination for the pass.\n\t * @param {WebGLRenderTarget} readBuffer - The read buffer. The pass can access the result from the\n\t * previous pass from this buffer.\n\t * @param {number} deltaTime - The delta time in seconds.\n\t * @param {boolean} maskActive - Whether masking is active or not.\n\t */\n\trender( renderer, writeBuffer, readBuffer /*, deltaTime, maskActive */ ) {\n\n\t\tif ( this.uniforms[ this.textureID ] ) {\n\n\t\t\tthis.uniforms[ this.textureID ].value = readBuffer.texture;\n\n\t\t}\n\n\t\tthis._fsQuad.material = this.material;\n\n\t\tif ( this.renderToScreen ) {\n\n\t\t\trenderer.setRenderTarget( null );\n\t\t\tthis._fsQuad.render( renderer );\n\n\t\t} else {\n\n\t\t\trenderer.setRenderTarget( writeBuffer );\n\t\t\t// TODO: Avoid using autoClear properties, see https://github.com/mrdoob/three.js/pull/15571#issuecomment-465669600\n\t\t\tif ( this.clear ) renderer.clear( renderer.autoClearColor, renderer.autoClearDepth, renderer.autoClearStencil );\n\t\t\tthis._fsQuad.render( renderer );\n\n\t\t}\n\n\t}\n\n\t/**\n\t * Frees the GPU-related resources allocated by this instance. Call this\n\t * method whenever the pass is no longer used in your app.\n\t */\n\tdispose() {\n\n\t\tthis.material.dispose();\n\n\t\tthis._fsQuad.dispose();\n\n\t}\n\n}\n\nexport { ShaderPass };\n","import { Pass } from './Pass.js';\n\n/**\n * This pass can be used to define a mask during post processing.\n * Meaning only areas of subsequent post processing are affected\n * which lie in the masking area of this pass. Internally, the masking\n * is implemented with the stencil buffer.\n *\n * ```js\n * const maskPass = new MaskPass( scene, camera );\n * composer.addPass( maskPass );\n * ```\n *\n * @augments Pass\n */\nclass MaskPass extends Pass {\n\n\t/**\n\t * Constructs a new mask pass.\n\t *\n\t * @param {Scene} scene - The 3D objects in this scene will define the mask.\n\t * @param {Camera} camera - The camera.\n\t */\n\tconstructor( scene, camera ) {\n\n\t\tsuper();\n\n\t\t/**\n\t\t * The scene that defines the mask.\n\t\t *\n\t\t * @type {Scene}\n\t\t */\n\t\tthis.scene = scene;\n\n\t\t/**\n\t\t * The camera.\n\t\t *\n\t\t * @type {Camera}\n\t\t */\n\t\tthis.camera = camera;\n\n\t\t/**\n\t\t * Overwritten to perform a clear operation by default.\n\t\t *\n\t\t * @type {boolean}\n\t\t * @default true\n\t\t */\n\t\tthis.clear = true;\n\n\t\t/**\n\t\t * Overwritten to disable the swap.\n\t\t *\n\t\t * @type {boolean}\n\t\t * @default false\n\t\t */\n\t\tthis.needsSwap = false;\n\n\t\t/**\n\t\t * Whether to inverse the mask or not.\n\t\t *\n\t\t * @type {boolean}\n\t\t * @default false\n\t\t */\n\t\tthis.inverse = false;\n\n\t}\n\n\t/**\n\t * Performs a mask pass with the configured scene and camera.\n\t *\n\t * @param {WebGLRenderer} renderer - The renderer.\n\t * @param {WebGLRenderTarget} writeBuffer - The write buffer. This buffer is intended as the rendering\n\t * destination for the pass.\n\t * @param {WebGLRenderTarget} readBuffer - The read buffer. The pass can access the result from the\n\t * previous pass from this buffer.\n\t * @param {number} deltaTime - The delta time in seconds.\n\t * @param {boolean} maskActive - Whether masking is active or not.\n\t */\n\trender( renderer, writeBuffer, readBuffer /*, deltaTime, maskActive */ ) {\n\n\t\tconst context = renderer.getContext();\n\t\tconst state = renderer.state;\n\n\t\t// don't update color or depth\n\n\t\tstate.buffers.color.setMask( false );\n\t\tstate.buffers.depth.setMask( false );\n\n\t\t// lock buffers\n\n\t\tstate.buffers.color.setLocked( true );\n\t\tstate.buffers.depth.setLocked( true );\n\n\t\t// set up stencil\n\n\t\tlet writeValue, clearValue;\n\n\t\tif ( this.inverse ) {\n\n\t\t\twriteValue = 0;\n\t\t\tclearValue = 1;\n\n\t\t} else {\n\n\t\t\twriteValue = 1;\n\t\t\tclearValue = 0;\n\n\t\t}\n\n\t\tstate.buffers.stencil.setTest( true );\n\t\tstate.buffers.stencil.setOp( context.REPLACE, context.REPLACE, context.REPLACE );\n\t\tstate.buffers.stencil.setFunc( context.ALWAYS, writeValue, 0xffffffff );\n\t\tstate.buffers.stencil.setClear( clearValue );\n\t\tstate.buffers.stencil.setLocked( true );\n\n\t\t// draw into the stencil buffer\n\n\t\trenderer.setRenderTarget( readBuffer );\n\t\tif ( this.clear ) renderer.clear();\n\t\trenderer.render( this.scene, this.camera );\n\n\t\trenderer.setRenderTarget( writeBuffer );\n\t\tif ( this.clear ) renderer.clear();\n\t\trenderer.render( this.scene, this.camera );\n\n\t\t// unlock color and depth buffer and make them writable for subsequent rendering/clearing\n\n\t\tstate.buffers.color.setLocked( false );\n\t\tstate.buffers.depth.setLocked( false );\n\n\t\tstate.buffers.color.setMask( true );\n\t\tstate.buffers.depth.setMask( true );\n\n\t\t// only render where stencil is set to 1\n\n\t\tstate.buffers.stencil.setLocked( false );\n\t\tstate.buffers.stencil.setFunc( context.EQUAL, 1, 0xffffffff ); // draw if == 1\n\t\tstate.buffers.stencil.setOp( context.KEEP, context.KEEP, context.KEEP );\n\t\tstate.buffers.stencil.setLocked( true );\n\n\t}\n\n}\n\n/**\n * This pass can be used to clear a mask previously defined with {@link MaskPass}.\n *\n * ```js\n * const clearPass = new ClearMaskPass();\n * composer.addPass( clearPass );\n * ```\n *\n * @augments Pass\n */\nclass ClearMaskPass extends Pass {\n\n\t/**\n\t * Constructs a new clear mask pass.\n\t */\n\tconstructor() {\n\n\t\tsuper();\n\n\t\t/**\n\t\t * Overwritten to disable the swap.\n\t\t *\n\t\t * @type {boolean}\n\t\t * @default false\n\t\t */\n\t\tthis.needsSwap = false;\n\n\t}\n\n\t/**\n\t * Performs the clear of the currently defined mask.\n\t *\n\t * @param {WebGLRenderer} renderer - The renderer.\n\t * @param {WebGLRenderTarget} writeBuffer - The write buffer. This buffer is intended as the rendering\n\t * destination for the pass.\n\t * @param {WebGLRenderTarget} readBuffer - The read buffer. The pass can access the result from the\n\t * previous pass from this buffer.\n\t * @param {number} deltaTime - The delta time in seconds.\n\t * @param {boolean} maskActive - Whether masking is active or not.\n\t */\n\trender( renderer /*, writeBuffer, readBuffer, deltaTime, maskActive */ ) {\n\n\t\trenderer.state.buffers.stencil.setLocked( false );\n\t\trenderer.state.buffers.stencil.setTest( false );\n\n\t}\n\n}\n\nexport { MaskPass, ClearMaskPass };\n","import {\n\tClock,\n\tHalfFloatType,\n\tNoBlending,\n\tVector2,\n\tWebGLRenderTarget\n} from 'three';\nimport { CopyShader } from '../shaders/CopyShader.js';\nimport { ShaderPass } from './ShaderPass.js';\nimport { ClearMaskPass, MaskPass } from './MaskPass.js';\n\n/**\n * Used to implement post-processing effects in three.js.\n * The class manages a chain of post-processing passes to produce the final visual result.\n * Post-processing passes are executed in order of their addition/insertion.\n * The last pass is automatically rendered to screen.\n *\n * This module can only be used with {@link WebGLRenderer}.\n *\n * ```js\n * const composer = new EffectComposer( renderer );\n *\n * // adding some passes\n * const renderPass = new RenderPass( scene, camera );\n * composer.addPass( renderPass );\n *\n * const glitchPass = new GlitchPass();\n * composer.addPass( glitchPass );\n *\n * const outputPass = new OutputPass()\n * composer.addPass( outputPass );\n *\n * function animate() {\n *\n * \tcomposer.render(); // instead of renderer.render()\n *\n * }\n * ```\n */\nclass EffectComposer {\n\n\t/**\n\t * Constructs a new effect composer.\n\t *\n\t * @param {WebGLRenderer} renderer - The renderer.\n\t * @param {WebGLRenderTarget} [renderTarget] - This render target and a clone will\n\t * be used as the internal read and write buffers. If not given, the composer creates\n\t * the buffers automatically.\n\t */\n\tconstructor( renderer, renderTarget ) {\n\n\t\t/**\n\t\t * The renderer.\n\t\t *\n\t\t * @type {WebGLRenderer}\n\t\t */\n\t\tthis.renderer = renderer;\n\n\t\tthis._pixelRatio = renderer.getPixelRatio();\n\n\t\tif ( renderTarget === undefined ) {\n\n\t\t\tconst size = renderer.getSize( new Vector2() );\n\t\t\tthis._width = size.width;\n\t\t\tthis._height = size.height;\n\n\t\t\trenderTarget = new WebGLRenderTarget( this._width * this._pixelRatio, this._height * this._pixelRatio, { type: HalfFloatType } );\n\t\t\trenderTarget.texture.name = 'EffectComposer.rt1';\n\n\t\t} else {\n\n\t\t\tthis._width = renderTarget.width;\n\t\t\tthis._height = renderTarget.height;\n\n\t\t}\n\n\t\tthis.renderTarget1 = renderTarget;\n\t\tthis.renderTarget2 = renderTarget.clone();\n\t\tthis.renderTarget2.texture.name = 'EffectComposer.rt2';\n\n\t\t/**\n\t\t * A reference to the internal write buffer. Passes usually write\n\t\t * their result into this buffer.\n\t\t *\n\t\t * @type {WebGLRenderTarget}\n\t\t */\n\t\tthis.writeBuffer = this.renderTarget1;\n\n\t\t/**\n\t\t * A reference to the internal read buffer. Passes usually read\n\t\t * the previous render result from this buffer.\n\t\t *\n\t\t * @type {WebGLRenderTarget}\n\t\t */\n\t\tthis.readBuffer = this.renderTarget2;\n\n\t\t/**\n\t\t * Whether the final pass is rendered to the screen (default framebuffer) or not.\n\t\t *\n\t\t * @type {boolean}\n\t\t * @default true\n\t\t */\n\t\tthis.renderToScreen = true;\n\n\t\t/**\n\t\t * An array representing the (ordered) chain of post-processing passes.\n\t\t *\n\t\t * @type {Array<Pass>}\n\t\t */\n\t\tthis.passes = [];\n\n\t\t/**\n\t\t * A copy pass used for internal swap operations.\n\t\t *\n\t\t * @private\n\t\t * @type {ShaderPass}\n\t\t */\n\t\tthis.copyPass = new ShaderPass( CopyShader );\n\t\tthis.copyPass.material.blending = NoBlending;\n\n\t\t/**\n\t\t * The intenral clock for managing time data.\n\t\t *\n\t\t * @private\n\t\t * @type {Clock}\n\t\t */\n\t\tthis.clock = new Clock();\n\n\t}\n\n\t/**\n\t * Swaps the internal read/write buffers.\n\t */\n\tswapBuffers() {\n\n\t\tconst tmp = this.readBuffer;\n\t\tthis.readBuffer = this.writeBuffer;\n\t\tthis.writeBuffer = tmp;\n\n\t}\n\n\t/**\n\t * Adds the given pass to the pass chain.\n\t *\n\t * @param {Pass} pass - The pass to add.\n\t */\n\taddPass( pass ) {\n\n\t\tthis.passes.push( pass );\n\t\tpass.setSize( this._width * this._pixelRatio, this._height * this._pixelRatio );\n\n\t}\n\n\t/**\n\t * Inserts the given pass at a given index.\n\t *\n\t * @param {Pass} pass - The pass to insert.\n\t * @param {number} index - The index into the pass chain.\n\t */\n\tinsertPass( pass, index ) {\n\n\t\tthis.passes.splice( index, 0, pass );\n\t\tpass.setSize( this._width * this._pixelRatio, this._height * this._pixelRatio );\n\n\t}\n\n\t/**\n\t * Removes the given pass from the pass chain.\n\t *\n\t * @param {Pass} pass - The pass to remove.\n\t */\n\tremovePass( pass ) {\n\n\t\tconst index = this.passes.indexOf( pass );\n\n\t\tif ( index !== - 1 ) {\n\n\t\t\tthis.passes.splice( index, 1 );\n\n\t\t}\n\n\t}\n\n\t/**\n\t * Returns `true` if the pass for the given index is the last enabled pass in the pass chain.\n\t *\n\t * @param {number} passIndex - The pass index.\n\t * @return {boolean} Whether the the pass for the given index is the last pass in the pass chain.\n\t */\n\tisLastEnabledPass( passIndex ) {\n\n\t\tfor ( let i = passIndex + 1; i < this.passes.length; i ++ ) {\n\n\t\t\tif ( this.passes[ i ].enabled ) {\n\n\t\t\t\treturn false;\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn true;\n\n\t}\n\n\t/**\n\t * Executes all enabled post-processing passes in order to produce the final frame.\n\t *\n\t * @param {number} deltaTime - The delta time in seconds. If not given, the composer computes\n\t * its own time delta value.\n\t */\n\trender( deltaTime ) {\n\n\t\t// deltaTime value is in seconds\n\n\t\tif ( deltaTime === undefined ) {\n\n\t\t\tdeltaTime = this.clock.getDelta();\n\n\t\t}\n\n\t\tconst currentRenderTarget = this.renderer.getRenderTarget();\n\n\t\tlet maskActive = false;\n\n\t\tfor ( let i = 0, il = this.passes.length; i < il; i ++ ) {\n\n\t\t\tconst pass = this.passes[ i ];\n\n\t\t\tif ( pass.enabled === false ) continue;\n\n\t\t\tpass.renderToScreen = ( this.renderToScreen && this.isLastEnabledPass( i ) );\n\t\t\tpass.render( this.renderer, this.writeBuffer, this.readBuffer, deltaTime, maskActive );\n\n\t\t\tif ( pass.needsSwap ) {\n\n\t\t\t\tif ( maskActive ) {\n\n\t\t\t\t\tconst context = this.renderer.getContext();\n\t\t\t\t\tconst stencil = this.renderer.state.buffers.stencil;\n\n\t\t\t\t\t//context.stencilFunc( context.NOTEQUAL, 1, 0xffffffff );\n\t\t\t\t\tstencil.setFunc( context.NOTEQUAL, 1, 0xffffffff );\n\n\t\t\t\t\tthis.copyPass.render( this.renderer, this.writeBuffer, this.readBuffer, deltaTime );\n\n\t\t\t\t\t//context.stencilFunc( context.EQUAL, 1, 0xffffffff );\n\t\t\t\t\tstencil.setFunc( context.EQUAL, 1, 0xffffffff );\n\n\t\t\t\t}\n\n\t\t\t\tthis.swapBuffers();\n\n\t\t\t}\n\n\t\t\tif ( MaskPass !== undefined ) {\n\n\t\t\t\tif ( pass instanceof MaskPass ) {\n\n\t\t\t\t\tmaskActive = true;\n\n\t\t\t\t} else if ( pass instanceof ClearMaskPass ) {\n\n\t\t\t\t\tmaskActive = false;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tthis.renderer.setRenderTarget( currentRenderTarget );\n\n\t}\n\n\t/**\n\t * Resets the internal state of the EffectComposer.\n\t *\n\t * @param {WebGLRenderTarget} [renderTarget] - This render target has the same purpose like\n\t * the one from the constructor. If set, it is used to setup the read and write buffers.\n\t */\n\treset( renderTarget ) {\n\n\t\tif ( renderTarget === undefined ) {\n\n\t\t\tconst size = this.renderer.getSize( new Vector2() );\n\t\t\tthis._pixelRatio = this.renderer.getPixelRatio();\n\t\t\tthis._width = size.width;\n\t\t\tthis._height = size.height;\n\n\t\t\trenderTarget = this.renderTarget1.clone();\n\t\t\trenderTarget.setSize( this._width * this._pixelRatio, this._height * this._pixelRatio );\n\n\t\t}\n\n\t\tthis.renderTarget1.dispose();\n\t\tthis.renderTarget2.dispose();\n\t\tthis.renderTarget1 = renderTarget;\n\t\tthis.renderTarget2 = renderTarget.clone();\n\n\t\tthis.writeBuffer = this.renderTarget1;\n\t\tthis.readBuffer = this.renderTarget2;\n\n\t}\n\n\t/**\n\t * Resizes the internal read and write buffers as well as all passes. Similar to {@link WebGLRenderer#setSize},\n\t * this method honors the current pixel ration.\n\t *\n\t * @param {number} width - The width in logical pixels.\n\t * @param {number} height - The height in logical pixels.\n\t */\n\tsetSize( width, height ) {\n\n\t\tthis._width = width;\n\t\tthis._height = height;\n\n\t\tconst effectiveWidth = this._width * this._pixelRatio;\n\t\tconst effectiveHeight = this._height * this._pixelRatio;\n\n\t\tthis.renderTarget1.setSize( effectiveWidth, effectiveHeight );\n\t\tthis.renderTarget2.setSize( effectiveWidth, effectiveHeight );\n\n\t\tfor ( let i = 0; i < this.passes.length; i ++ ) {\n\n\t\t\tthis.passes[ i ].setSize( effectiveWidth, effectiveHeight );\n\n\t\t}\n\n\t}\n\n\t/**\n\t * Sets device pixel ratio. This is usually used for HiDPI device to prevent blurring output.\n\t * Setting the pixel ratio will automatically resize the composer.\n\t *\n\t * @param {number} pixelRatio - The pixel ratio to set.\n\t */\n\tsetPixelRatio( pixelRatio ) {\n\n\t\tthis._pixelRatio = pixelRatio;\n\n\t\tthis.setSize( this._width, this._height );\n\n\t}\n\n\t/**\n\t * Frees the GPU-related resources allocated by this instance. Call this\n\t * method whenever the composer is no longer used in your app.\n\t */\n\tdispose() {\n\n\t\tthis.renderTarget1.dispose();\n\t\tthis.renderTarget2.dispose();\n\n\t\tthis.copyPass.dispose();\n\n\t}\n\n}\n\nexport { EffectComposer };\n","import {\n\tColor\n} from 'three';\nimport { Pass } from './Pass.js';\n\n/**\n * This class represents a render pass. It takes a camera and a scene and produces\n * a beauty pass for subsequent post processing effects.\n *\n * ```js\n * const renderPass = new RenderPass( scene, camera );\n * composer.addPass( renderPass );\n * ```\n *\n * @augments Pass\n */\nclass RenderPass extends Pass {\n\n\t/**\n\t * Constructs a new render pass.\n\t *\n\t * @param {Scene} scene - The scene to render.\n\t * @param {Camera} camera - The camera.\n\t * @param {?Material} [overrideMaterial=null] - The override material. If set, this material is used\n\t * for all objects in the scene.\n\t * @param {?(number|Color|string)} [clearColor=null] - The clear color of the render pass.\n\t * @param {?number} [clearAlpha=null] - The clear alpha of the render pass.\n\t */\n\tconstructor( scene, camera, overrideMaterial = null, clearColor = null, clearAlpha = null ) {\n\n\t\tsuper();\n\n\t\t/**\n\t\t * The scene to render.\n\t\t *\n\t\t * @type {Scene}\n\t\t */\n\t\tthis.scene = scene;\n\n\t\t/**\n\t\t * The camera.\n\t\t *\n\t\t * @type {Camera}\n\t\t */\n\t\tthis.camera = camera;\n\n\t\t/**\n\t\t * The override material. If set, this material is used\n\t\t * for all objects in the scene.\n\t\t *\n\t\t * @type {?Material}\n\t\t * @default null\n\t\t */\n\t\tthis.overrideMaterial = overrideMaterial;\n\n\t\t/**\n\t\t * The clear color of the render pass.\n\t\t *\n\t\t * @type {?(number|Color|string)}\n\t\t * @default null\n\t\t */\n\t\tthis.clearColor = clearColor;\n\n\t\t/**\n\t\t * The clear alpha of the render pass.\n\t\t *\n\t\t * @type {?number}\n\t\t * @default null\n\t\t */\n\t\tthis.clearAlpha = clearAlpha;\n\n\t\t/**\n\t\t * Overwritten to perform a clear operation by default.\n\t\t *\n\t\t * @type {boolean}\n\t\t * @default true\n\t\t */\n\t\tthis.clear = true;\n\n\t\t/**\n\t\t * If set to `true`, only the depth can be cleared when `clear` is to `false`.\n\t\t *\n\t\t * @type {boolean}\n\t\t * @default false\n\t\t */\n\t\tthis.clearDepth = false;\n\n\t\t/**\n\t\t * Overwritten to disable the swap.\n\t\t *\n\t\t * @type {boolean}\n\t\t * @default false\n\t\t */\n\t\tthis.needsSwap = false;\n\t\tthis._oldClearColor = new Color();\n\n\t}\n\n\t/**\n\t * Performs a beauty pass with the configured scene and camera.\n\t *\n\t * @param {WebGLRenderer} renderer - The renderer.\n\t * @param {WebGLRenderTarget} writeBuffer - The write buffer. This buffer is intended as the rendering\n\t * destination for the pass.\n\t * @param {WebGLRenderTarget} readBuffer - The read buffer. The pass can access the result from the\n\t * previous pass from this buffer.\n\t * @param {number} deltaTime - The delta time in seconds.\n\t * @param {boolean} maskActive - Whether masking is active or not.\n\t */\n\trender( renderer, writeBuffer, readBuffer /*, deltaTime, maskActive */ ) {\n\n\t\tconst oldAutoClear = renderer.autoClear;\n\t\trenderer.autoClear = false;\n\n\t\tlet oldClearAlpha, oldOverrideMaterial;\n\n\t\tif ( this.overrideMaterial !== null ) {\n\n\t\t\toldOverrideMaterial = this.scene.overrideMaterial;\n\n\t\t\tthis.scene.overrideMaterial = this.overrideMaterial;\n\n\t\t}\n\n\t\tif ( this.clearColor !== null ) {\n\n\t\t\trenderer.getClearColor( this._oldClearColor );\n\t\t\trenderer.setClearColor( this.clearColor, renderer.getClearAlpha() );\n\n\t\t}\n\n\t\tif ( this.clearAlpha !== null ) {\n\n\t\t\toldClearAlpha = renderer.getClearAlpha();\n\t\t\trenderer.setClearAlpha( this.clearAlpha );\n\n\t\t}\n\n\t\tif ( this.clearDepth == true ) {\n\n\t\t\trenderer.clearDepth();\n\n\t\t}\n\n\t\trenderer.setRenderTarget( this.renderToScreen ? null : readBuffer );\n\n\t\tif ( this.clear === true ) {\n\n\t\t\t// TODO: Avoid using autoClear properties, see https://github.com/mrdoob/three.js/pull/15571#issuecomment-465669600\n\t\t\trenderer.clear( renderer.autoClearColor, renderer.autoClearDepth, renderer.autoClearStencil );\n\n\t\t}\n\n\t\trenderer.render( this.scene, this.camera );\n\n\t\t// restore\n\n\t\tif ( this.clearColor !== null ) {\n\n\t\t\trenderer.setClearColor( this._oldClearColor );\n\n\t\t}\n\n\t\tif ( this.clearAlpha !== null ) {\n\n\t\t\trenderer.setClearAlpha( oldClearAlpha );\n\n\t\t}\n\n\t\tif ( this.overrideMaterial !== null ) {\n\n\t\t\tthis.scene.overrideMaterial = oldOverrideMaterial;\n\n\t\t}\n\n\t\trenderer.autoClear = oldAutoClear;\n\n\t}\n\n}\n\nexport { RenderPass };\n","import {\n\tColor\n} from 'three';\n\n/** @module LuminosityHighPassShader */\n\n/**\n * Luminosity high pass shader.\n *\n * @constant\n * @type {ShaderMaterial~Shader}\n */\nconst LuminosityHighPassShader = {\n\n\tname: 'LuminosityHighPassShader',\n\n\tuniforms: {\n\n\t\t'tDiffuse': { value: null },\n\t\t'luminosityThreshold': { value: 1.0 },\n\t\t'smoothWidth': { value: 1.0 },\n\t\t'defaultColor': { value: new Color( 0x000000 ) },\n\t\t'defaultOpacity': { value: 0.0 }\n\n\t},\n\n\tvertexShader: /* glsl */`\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}`,\n\n\tfragmentShader: /* glsl */`\n\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform vec3 defaultColor;\n\t\tuniform float defaultOpacity;\n\t\tuniform float luminosityThreshold;\n\t\tuniform float smoothWidth;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 texel = texture2D( tDiffuse, vUv );\n\n\t\t\tfloat v = luminance( texel.xyz );\n\n\t\t\tvec4 outputColor = vec4( defaultColor.rgb, defaultOpacity );\n\n\t\t\tfloat alpha = smoothstep( luminosityThreshold, luminosityThreshold + smoothWidth, v );\n\n\t\t\tgl_FragColor = mix( outputColor, texel, alpha );\n\n\t\t}`\n\n};\n\nexport { LuminosityHighPassShader };\n","import {\n\tAdditiveBlending,\n\tColor,\n\tHalfFloatType,\n\tMeshBasicMaterial,\n\tShaderMaterial,\n\tUniformsUtils,\n\tVector2,\n\tVector3,\n\tWebGLRenderTarget\n} from 'three';\nimport { Pass, FullScreenQuad } from './Pass.js';\nimport { CopyShader } from '../shaders/CopyShader.js';\nimport { LuminosityHighPassShader } from '../shaders/LuminosityHighPassShader.js';\n\n/**\n * This pass is inspired by the bloom pass of Unreal Engine. It creates a\n * mip map chain of bloom textures and blurs them with different radii. Because\n * of the weighted combination of mips, and because larger blurs are done on\n * higher mips, this effect provides good quality and performance.\n *\n * When using this pass, tone mapping must be enabled in the renderer settings.\n *\n * Reference:\n * - [Bloom in Unreal Engine]{@link https://docs.unrealengine.com/latest/INT/Engine/Rendering/PostProcessEffects/Bloom/}\n *\n * ```js\n * const resolution = new THREE.Vector2( window.innerWidth, window.innerHeight );\n * const bloomPass = new UnrealBloomPass( resolution, 1.5, 0.4, 0.85 );\n * composer.addPass( bloomPass );\n * ```\n *\n * @augments Pass\n */\nclass UnrealBloomPass extends Pass {\n\n\t/**\n\t * Constructs a new Unreal Bloom pass.\n\t *\n\t * @param {Vector2} [resolution] - The effect's resolution.\n\t * @param {number} [strength=1] - The Bloom strength.\n\t * @param {number} radius - The Bloom radius.\n\t * @param {number} threshold - The luminance threshold limits which bright areas contribute to the Bloom effect.\n\t */\n\tconstructor( resolution, strength = 1, radius, threshold ) {\n\n\t\tsuper();\n\n\t\t/**\n\t\t * The Bloom strength.\n\t\t *\n\t\t * @type {number}\n\t\t * @default 1\n\t\t */\n\t\tthis.strength = strength;\n\n\t\t/**\n\t\t * The Bloom radius.\n\t\t *\n\t\t * @type {number}\n\t\t */\n\t\tthis.radius = radius;\n\n\t\t/**\n\t\t * The luminance threshold limits which bright areas contribute to the Bloom effect.\n\t\t *\n\t\t * @type {number}\n\t\t */\n\t\tthis.threshold = threshold;\n\n\t\t/**\n\t\t * The effect's resolution.\n\t\t *\n\t\t * @type {Vector2}\n\t\t * @default (256,256)\n\t\t */\n\t\tthis.resolution = ( resolution !== undefined ) ? new Vector2( resolution.x, resolution.y ) : new Vector2( 256, 256 );\n\n\t\t/**\n\t\t * The effect's clear color\n\t\t *\n\t\t * @type {Color}\n\t\t * @default (0,0,0)\n\t\t */\n\t\tthis.clearColor = new Color( 0, 0, 0 );\n\n\t\t/**\n\t\t * Overwritten to disable the swap.\n\t\t *\n\t\t * @type {boolean}\n\t\t * @default false\n\t\t */\n\t\tthis.needsSwap = false;\n\n\t\t// internals\n\n\t\t// render targets\n\t\tthis.renderTargetsHorizontal = [];\n\t\tthis.renderTargetsVertical = [];\n\t\tthis.nMips = 5;\n\t\tlet resx = Math.round( this.resolution.x / 2 );\n\t\tlet resy = Math.round( this.resolution.y / 2 );\n\n\t\tthis.renderTargetBright = new WebGLRenderTarget( resx, resy, { type: HalfFloatType } );\n\t\tthis.renderTargetBright.texture.name = 'UnrealBloomPass.bright';\n\t\tthis.renderTargetBright.texture.generateMipmaps = false;\n\n\t\tfor ( let i = 0; i < this.nMips; i ++ ) {\n\n\t\t\tconst renderTargetHorizontal = new WebGLRenderTarget( resx, resy, { type: HalfFloatType } );\n\n\t\t\trenderTargetHorizontal.texture.name = 'UnrealBloomPass.h' + i;\n\t\t\trenderTargetHorizontal.texture.generateMipmaps = false;\n\n\t\t\tthis.renderTargetsHorizontal.push( renderTargetHorizontal );\n\n\t\t\tconst renderTargetVertical = new WebGLRenderTarget( resx, resy, { type: HalfFloatType } );\n\n\t\t\trenderTargetVertical.texture.name = 'UnrealBloomPass.v' + i;\n\t\t\trenderTargetVertical.texture.generateMipmaps = false;\n\n\t\t\tthis.renderTargetsVertical.push( renderTargetVertical );\n\n\t\t\tresx = Math.round( resx / 2 );\n\n\t\t\tresy = Math.round( resy / 2 );\n\n\t\t}\n\n\t\t// luminosity high pass material\n\n\t\tconst highPassShader = LuminosityHighPassShader;\n\t\tthis.highPassUniforms = UniformsUtils.clone( highPassShader.uniforms );\n\n\t\tthis.highPassUniforms[ 'luminosityThreshold' ].value = threshold;\n\t\tthis.highPassUniforms[ 'smoothWidth' ].value = 0.01;\n\n\t\tthis.materialHighPassFilter = new ShaderMaterial( {\n\t\t\tuniforms: this.highPassUniforms,\n\t\t\tvertexShader: highPassShader.vertexShader,\n\t\t\tfragmentShader: highPassShader.fragmentShader\n\t\t} );\n\n\t\t// gaussian blur materials\n\n\t\tthis.separableBlurMaterials = [];\n\t\tconst kernelSizeArray = [ 3, 5, 7, 9, 11 ];\n\t\tresx = Math.round( this.resolution.x / 2 );\n\t\tresy = Math.round( this.resolution.y / 2 );\n\n\t\tfor ( let i = 0; i < this.nMips; i ++ ) {\n\n\t\t\tthis.separableBlurMaterials.push( this._getSeparableBlurMaterial( kernelSizeArray[ i ] ) );\n\n\t\t\tthis.separableBlurMaterials[ i ].uniforms[ 'invSize' ].value = new Vector2( 1 / resx, 1 / resy );\n\n\t\t\tresx = Math.round( resx / 2 );\n\n\t\t\tresy = Math.round( resy / 2 );\n\n\t\t}\n\n\t\t// composite material\n\n\t\tthis.compositeMaterial = this._getCompositeMaterial( this.nMips );\n\t\tthis.compositeMaterial.uniforms[ 'blurTexture1' ].value = this.renderTargetsVertical[ 0 ].texture;\n\t\tthis.compositeMaterial.uniforms[ 'blurTexture2' ].value = this.renderTargetsVertical[ 1 ].texture;\n\t\tthis.compositeMaterial.uniforms[ 'blurTexture3' ].value = this.renderTargetsVertical[ 2 ].texture;\n\t\tthis.compositeMaterial.uniforms[ 'blurTexture4' ].value = this.renderTargetsVertical[ 3 ].texture;\n\t\tthis.compositeMaterial.uniforms[ 'blurTexture5' ].value = this.renderTargetsVertical[ 4 ].texture;\n\t\tthis.compositeMaterial.uniforms[ 'bloomStrength' ].value = strength;\n\t\tthis.compositeMaterial.uniforms[ 'bloomRadius' ].value = 0.1;\n\n\t\tconst bloomFactors = [ 1.0, 0.8, 0.6, 0.4, 0.2 ];\n\t\tthis.compositeMaterial.uniforms[ 'bloomFactors' ].value = bloomFactors;\n\t\tthis.bloomTintColors = [ new Vector3( 1, 1, 1 ), new Vector3( 1, 1, 1 ), new Vector3( 1, 1, 1 ), new Vector3( 1, 1, 1 ), new Vector3( 1, 1, 1 ) ];\n\t\tthis.compositeMaterial.uniforms[ 'bloomTintColors' ].value = this.bloomTintColors;\n\n\t\t// blend material\n\n\t\tthis.copyUniforms = UniformsUtils.clone( CopyShader.uniforms );\n\n\t\tthis.blendMaterial = new ShaderMaterial( {\n\t\t\tuniforms: this.copyUniforms,\n\t\t\tvertexShader: CopyShader.vertexShader,\n\t\t\tfragmentShader: CopyShader.fragmentShader,\n\t\t\tblending: AdditiveBlending,\n\t\t\tdepthTest: false,\n\t\t\tdepthWrite: false,\n\t\t\ttransparent: true\n\t\t} );\n\n\t\tthis._oldClearColor = new Color();\n\t\tthis._oldClearAlpha = 1;\n\n\t\tthis._basic = new MeshBasicMaterial();\n\n\t\tthis._fsQuad = new FullScreenQuad( null );\n\n\t}\n\n\t/**\n\t * Frees the GPU-related resources allocated by this instance. Call this\n\t * method whenever the pass is no longer used in your app.\n\t */\n\tdispose() {\n\n\t\tfor ( let i = 0; i < this.renderTargetsHorizontal.length; i ++ ) {\n\n\t\t\tthis.renderTargetsHorizontal[ i ].dispose();\n\n\t\t}\n\n\t\tfor ( let i = 0; i < this.renderTargetsVertical.length; i ++ ) {\n\n\t\t\tthis.renderTargetsVertical[ i ].dispose();\n\n\t\t}\n\n\t\tthis.renderTargetBright.dispose();\n\n\t\t//\n\n\t\tfor ( let i = 0; i < this.separableBlurMaterials.length; i ++ ) {\n\n\t\t\tthis.separableBlurMaterials[ i ].dispose();\n\n\t\t}\n\n\t\tthis.compositeMaterial.dispose();\n\t\tthis.blendMaterial.dispose();\n\t\tthis._basic.dispose();\n\n\t\t//\n\n\t\tthis._fsQuad.dispose();\n\n\t}\n\n\t/**\n\t * Sets the size of the pass.\n\t *\n\t * @param {number} width - The width to set.\n\t * @param {number} height - The width to set.\n\t */\n\tsetSize( width, height ) {\n\n\t\tlet resx = Math.round( width / 2 );\n\t\tlet resy = Math.round( height / 2 );\n\n\t\tthis.renderTargetBright.setSize( resx, resy );\n\n\t\tfor ( let i = 0; i < this.nMips; i ++ ) {\n\n\t\t\tthis.renderTargetsHorizontal[ i ].setSize( resx, resy );\n\t\t\tthis.renderTargetsVertical[ i ].setSize( resx, resy );\n\n\t\t\tthis.separableBlurMaterials[ i ].uniforms[ 'invSize' ].value = new Vector2( 1 / resx, 1 / resy );\n\n\t\t\tresx = Math.round( resx / 2 );\n\t\t\tresy = Math.round( resy / 2 );\n\n\t\t}\n\n\t}\n\n\t/**\n\t * Performs the Bloom pass.\n\t *\n\t * @param {WebGLRenderer} renderer - The renderer.\n\t * @param {WebGLRenderTarget} writeBuffer - The write buffer. This buffer is intended as the rendering\n\t * destination for the pass.\n\t * @param {WebGLRenderTarget} readBuffer - The read buffer. The pass can access the result from the\n\t * previous pass from this buffer.\n\t * @param {number} deltaTime - The delta time in seconds.\n\t * @param {boolean} maskActive - Whether masking is active or not.\n\t */\n\trender( renderer, writeBuffer, readBuffer, deltaTime, maskActive ) {\n\n\t\trenderer.getClearColor( this._oldClearColor );\n\t\tthis._oldClearAlpha = renderer.getClearAlpha();\n\t\tconst oldAutoClear = renderer.autoClear;\n\t\trenderer.autoClear = false;\n\n\t\trenderer.setClearColor( this.clearColor, 0 );\n\n\t\tif ( maskActive ) renderer.state.buffers.stencil.setTest( false );\n\n\t\t// Render input to screen\n\n\t\tif ( this.renderToScreen ) {\n\n\t\t\tthis._fsQuad.material = this._basic;\n\t\t\tthis._basic.map = readBuffer.texture;\n\n\t\t\trenderer.setRenderTarget( null );\n\t\t\trenderer.clear();\n\t\t\tthis._fsQuad.render( renderer );\n\n\t\t}\n\n\t\t// 1. Extract Bright Areas\n\n\t\tthis.highPassUniforms[ 'tDiffuse' ].value = readBuffer.texture;\n\t\tthis.highPassUniforms[ 'luminosityThreshold' ].value = this.threshold;\n\t\tthis._fsQuad.material = this.materialHighPassFilter;\n\n\t\trenderer.setRenderTarget( this.renderTargetBright );\n\t\trenderer.clear();\n\t\tthis._fsQuad.render( renderer );\n\n\t\t// 2. Blur All the mips progressively\n\n\t\tlet inputRenderTarget = this.renderTargetBright;\n\n\t\tfor ( let i = 0; i < this.nMips; i ++ ) {\n\n\t\t\tthis._fsQuad.material = this.separableBlurMaterials[ i ];\n\n\t\t\tthis.separableBlurMaterials[ i ].uniforms[ 'colorTexture' ].value = inputRenderTarget.texture;\n\t\t\tthis.separableBlurMaterials[ i ].uniforms[ 'direction' ].value = UnrealBloomPass.BlurDirectionX;\n\t\t\trenderer.setRenderTarget( this.renderTargetsHorizontal[ i ] );\n\t\t\trenderer.clear();\n\t\t\tthis._fsQuad.render( renderer );\n\n\t\t\tthis.separableBlurMaterials[ i ].uniforms[ 'colorTexture' ].value = this.renderTargetsHorizontal[ i ].texture;\n\t\t\tthis.separableBlurMaterials[ i ].uniforms[ 'direction' ].value = UnrealBloomPass.BlurDirectionY;\n\t\t\trenderer.setRenderTarget( this.renderTargetsVertical[ i ] );\n\t\t\trenderer.clear();\n\t\t\tthis._fsQuad.render( renderer );\n\n\t\t\tinputRenderTarget = this.renderTargetsVertical[ i ];\n\n\t\t}\n\n\t\t// Composite All the mips\n\n\t\tthis._fsQuad.material = this.compositeMaterial;\n\t\tthis.compositeMaterial.uniforms[ 'bloomStrength' ].value = this.strength;\n\t\tthis.compositeMaterial.uniforms[ 'bloomRadius' ].value = this.radius;\n\t\tthis.compositeMaterial.uniforms[ 'bloomTintColors' ].value = this.bloomTintColors;\n\n\t\trenderer.setRenderTarget( this.renderTargetsHorizontal[ 0 ] );\n\t\trenderer.clear();\n\t\tthis._fsQuad.render( renderer );\n\n\t\t// Blend it additively over the input texture\n\n\t\tthis._fsQuad.material = this.blendMaterial;\n\t\tthis.copyUniforms[ 'tDiffuse' ].value = this.renderTargetsHorizontal[ 0 ].texture;\n\n\t\tif ( maskActive ) renderer.state.buffers.stencil.setTest( true );\n\n\t\tif ( this.renderToScreen ) {\n\n\t\t\trenderer.setRenderTarget( null );\n\t\t\tthis._fsQuad.render( renderer );\n\n\t\t} else {\n\n\t\t\trenderer.setRenderTarget( readBuffer );\n\t\t\tthis._fsQuad.render( renderer );\n\n\t\t}\n\n\t\t// Restore renderer settings\n\n\t\trenderer.setClearColor( this._oldClearColor, this._oldClearAlpha );\n\t\trenderer.autoClear = oldAutoClear;\n\n\t}\n\n\t// internals\n\n\t_getSeparableBlurMaterial( kernelRadius ) {\n\n\t\tconst coefficients = [];\n\n\t\tfor ( let i = 0; i < kernelRadius; i ++ ) {\n\n\t\t\tcoefficients.push( 0.39894 * Math.exp( - 0.5 * i * i / ( kernelRadius * kernelRadius ) ) / kernelRadius );\n\n\t\t}\n\n\t\treturn new ShaderMaterial( {\n\n\t\t\tdefines: {\n\t\t\t\t'KERNEL_RADIUS': kernelRadius\n\t\t\t},\n\n\t\t\tuniforms: {\n\t\t\t\t'colorTexture': { value: null },\n\t\t\t\t'invSize': { value: new Vector2( 0.5, 0.5 ) }, // inverse texture size\n\t\t\t\t'direction': { value: new Vector2( 0.5, 0.5 ) },\n\t\t\t\t'gaussianCoefficients': { value: coefficients } // precomputed Gaussian coefficients\n\t\t\t},\n\n\t\t\tvertexShader:\n\t\t\t\t`varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}`,\n\n\t\t\tfragmentShader:\n\t\t\t\t`#include <common>\n\t\t\t\tvarying vec2 vUv;\n\t\t\t\tuniform sampler2D colorTexture;\n\t\t\t\tuniform vec2 invSize;\n\t\t\t\tuniform vec2 direction;\n\t\t\t\tuniform float gaussianCoefficients[KERNEL_RADIUS];\n\n\t\t\t\tvoid main() {\n\t\t\t\t\tfloat weightSum = gaussianCoefficients[0];\n\t\t\t\t\tvec3 diffuseSum = texture2D( colorTexture, vUv ).rgb * weightSum;\n\t\t\t\t\tfor( int i = 1; i < KERNEL_RADIUS; i ++ ) {\n\t\t\t\t\t\tfloat x = float(i);\n\t\t\t\t\t\tfloat w = gaussianCoefficients[i];\n\t\t\t\t\t\tvec2 uvOffset = direction * invSize * x;\n\t\t\t\t\t\tvec3 sample1 = texture2D( colorTexture, vUv + uvOffset ).rgb;\n\t\t\t\t\t\tvec3 sample2 = texture2D( colorTexture, vUv - uvOffset ).rgb;\n\t\t\t\t\t\tdiffuseSum += (sample1 + sample2) * w;\n\t\t\t\t\t\tweightSum += 2.0 * w;\n\t\t\t\t\t}\n\t\t\t\t\tgl_FragColor = vec4(diffuseSum/weightSum, 1.0);\n\t\t\t\t}`\n\t\t} );\n\n\t}\n\n\t_getCompositeMaterial( nMips ) {\n\n\t\treturn new ShaderMaterial( {\n\n\t\t\tdefines: {\n\t\t\t\t'NUM_MIPS': nMips\n\t\t\t},\n\n\t\t\tuniforms: {\n\t\t\t\t'blurTexture1': { value: null },\n\t\t\t\t'blurTexture2': { value: null },\n\t\t\t\t'blurTexture3': { value: null },\n\t\t\t\t'blurTexture4': { value: null },\n\t\t\t\t'blurTexture5': { value: null },\n\t\t\t\t'bloomStrength': { value: 1.0 },\n\t\t\t\t'bloomFactors': { value: null },\n\t\t\t\t'bloomTintColors': { value: null },\n\t\t\t\t'bloomRadius': { value: 0.0 }\n\t\t\t},\n\n\t\t\tvertexShader:\n\t\t\t\t`varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}`,\n\n\t\t\tfragmentShader:\n\t\t\t\t`varying vec2 vUv;\n\t\t\t\tuniform sampler2D blurTexture1;\n\t\t\t\tuniform sampler2D blurTexture2;\n\t\t\t\tuniform sampler2D blurTexture3;\n\t\t\t\tuniform sampler2D blurTexture4;\n\t\t\t\tuniform sampler2D blurTexture5;\n\t\t\t\tuniform float bloomStrength;\n\t\t\t\tuniform float bloomRadius;\n\t\t\t\tuniform float bloomFactors[NUM_MIPS];\n\t\t\t\tuniform vec3 bloomTintColors[NUM_MIPS];\n\n\t\t\t\tfloat lerpBloomFactor(const in float factor) {\n\t\t\t\t\tfloat mirrorFactor = 1.2 - factor;\n\t\t\t\t\treturn mix(factor, mirrorFactor, bloomRadius);\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\t\t\t\t\tgl_FragColor = bloomStrength * ( lerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv) );\n\t\t\t\t}`\n\t\t} );\n\n\t}\n\n}\n\nUnrealBloomPass.BlurDirectionX = new Vector2( 1.0, 0.0 );\nUnrealBloomPass.BlurDirectionY = new Vector2( 0.0, 1.0 );\n\nexport { UnrealBloomPass };\n","import {\n\tVector2\n} from 'three';\n\n/** @module FXAAShader */\n\n/**\n * FXAA algorithm from NVIDIA, C# implementation by Jasper Flick, GLSL port by Dave Hoskins.\n *\n * References:\n * - {@link http://developer.download.nvidia.com/assets/gamedev/files/sdk/11/FXAA_WhitePaper.pdf}.\n * - {@link https://catlikecoding.com/unity/tutorials/advanced-rendering/fxaa/}.\n *\n * @constant\n * @type {ShaderMaterial~Shader}\n */\nconst FXAAShader = {\n\n\tname: 'FXAAShader',\n\n\tuniforms: {\n\n\t\t'tDiffuse': { value: null },\n\t\t'resolution': { value: new Vector2( 1 / 1024, 1 / 512 ) }\n\n\t},\n\n\tvertexShader: /* glsl */`\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}`,\n\n\tfragmentShader: /* glsl */`\n\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform vec2 resolution;\n\t\tvarying vec2 vUv;\n\n\t\t#define EDGE_STEP_COUNT 6\n\t\t#define EDGE_GUESS 8.0\n\t\t#define EDGE_STEPS 1.0, 1.5, 2.0, 2.0, 2.0, 4.0\n\t\tconst float edgeSteps[EDGE_STEP_COUNT] = float[EDGE_STEP_COUNT]( EDGE_STEPS );\n\n\t\tfloat _ContrastThreshold = 0.0312;\n\t\tfloat _RelativeThreshold = 0.063;\n\t\tfloat _SubpixelBlending = 1.0;\n\n\t\tvec4 Sample( sampler2D  tex2D, vec2 uv ) {\n\n\t\t\treturn texture( tex2D, uv );\n\n\t\t}\n\n\t\tfloat SampleLuminance( sampler2D tex2D, vec2 uv ) {\n\n\t\t\treturn dot( Sample( tex2D, uv ).rgb, vec3( 0.3, 0.59, 0.11 ) );\n\n\t\t}\n\n\t\tfloat SampleLuminance( sampler2D tex2D, vec2 texSize, vec2 uv, float uOffset, float vOffset ) {\n\n\t\t\tuv += texSize * vec2(uOffset, vOffset);\n\t\t\treturn SampleLuminance(tex2D, uv);\n\n\t\t}\n\n\t\tstruct LuminanceData {\n\n\t\t\tfloat m, n, e, s, w;\n\t\t\tfloat ne, nw, se, sw;\n\t\t\tfloat highest, lowest, contrast;\n\n\t\t};\n\n\t\tLuminanceData SampleLuminanceNeighborhood( sampler2D tex2D, vec2 texSize, vec2 uv ) {\n\n\t\t\tLuminanceData l;\n\t\t\tl.m = SampleLuminance( tex2D, uv );\n\t\t\tl.n = SampleLuminance( tex2D, texSize, uv,  0.0,  1.0 );\n\t\t\tl.e = SampleLuminance( tex2D, texSize, uv,  1.0,  0.0 );\n\t\t\tl.s = SampleLuminance( tex2D, texSize, uv,  0.0, -1.0 );\n\t\t\tl.w = SampleLuminance( tex2D, texSize, uv, -1.0,  0.0 );\n\n\t\t\tl.ne = SampleLuminance( tex2D, texSize, uv,  1.0,  1.0 );\n\t\t\tl.nw = SampleLuminance( tex2D, texSize, uv, -1.0,  1.0 );\n\t\t\tl.se = SampleLuminance( tex2D, texSize, uv,  1.0, -1.0 );\n\t\t\tl.sw = SampleLuminance( tex2D, texSize, uv, -1.0, -1.0 );\n\n\t\t\tl.highest = max( max( max( max( l.n, l.e ), l.s ), l.w ), l.m );\n\t\t\tl.lowest = min( min( min( min( l.n, l.e ), l.s ), l.w ), l.m );\n\t\t\tl.contrast = l.highest - l.lowest;\n\t\t\treturn l;\n\n\t\t}\n\n\t\tbool ShouldSkipPixel( LuminanceData l ) {\n\n\t\t\tfloat threshold = max( _ContrastThreshold, _RelativeThreshold * l.highest );\n\t\t\treturn l.contrast < threshold;\n\n\t\t}\n\n\t\tfloat DeterminePixelBlendFactor( LuminanceData l ) {\n\n\t\t\tfloat f = 2.0 * ( l.n + l.e + l.s + l.w );\n\t\t\tf += l.ne + l.nw + l.se + l.sw;\n\t\t\tf *= 1.0 / 12.0;\n\t\t\tf = abs( f - l.m );\n\t\t\tf = clamp( f / l.contrast, 0.0, 1.0 );\n\n\t\t\tfloat blendFactor = smoothstep( 0.0, 1.0, f );\n\t\t\treturn blendFactor * blendFactor * _SubpixelBlending;\n\n\t\t}\n\n\t\tstruct EdgeData {\n\n\t\t\tbool isHorizontal;\n\t\t\tfloat pixelStep;\n\t\t\tfloat oppositeLuminance, gradient;\n\n\t\t};\n\n\t\tEdgeData DetermineEdge( vec2 texSize, LuminanceData l ) {\n\n\t\t\tEdgeData e;\n\t\t\tfloat horizontal =\n\t\t\t\tabs( l.n + l.s - 2.0 * l.m ) * 2.0 +\n\t\t\t\tabs( l.ne + l.se - 2.0 * l.e ) +\n\t\t\t\tabs( l.nw + l.sw - 2.0 * l.w );\n\t\t\tfloat vertical =\n\t\t\t\tabs( l.e + l.w - 2.0 * l.m ) * 2.0 +\n\t\t\t\tabs( l.ne + l.nw - 2.0 * l.n ) +\n\t\t\t\tabs( l.se + l.sw - 2.0 * l.s );\n\t\t\te.isHorizontal = horizontal >= vertical;\n\n\t\t\tfloat pLuminance = e.isHorizontal ? l.n : l.e;\n\t\t\tfloat nLuminance = e.isHorizontal ? l.s : l.w;\n\t\t\tfloat pGradient = abs( pLuminance - l.m );\n\t\t\tfloat nGradient = abs( nLuminance - l.m );\n\n\t\t\te.pixelStep = e.isHorizontal ? texSize.y : texSize.x;\n\n\t\t\tif (pGradient < nGradient) {\n\n\t\t\t\te.pixelStep = -e.pixelStep;\n\t\t\t\te.oppositeLuminance = nLuminance;\n\t\t\t\te.gradient = nGradient;\n\n\t\t\t} else {\n\n\t\t\t\te.oppositeLuminance = pLuminance;\n\t\t\t\te.gradient = pGradient;\n\n\t\t\t}\n\n\t\t\treturn e;\n\n\t\t}\n\n\t\tfloat DetermineEdgeBlendFactor( sampler2D  tex2D, vec2 texSize, LuminanceData l, EdgeData e, vec2 uv ) {\n\n\t\t\tvec2 uvEdge = uv;\n\t\t\tvec2 edgeStep;\n\t\t\tif (e.isHorizontal) {\n\n\t\t\t\tuvEdge.y += e.pixelStep * 0.5;\n\t\t\t\tedgeStep = vec2( texSize.x, 0.0 );\n\n\t\t\t} else {\n\n\t\t\t\tuvEdge.x += e.pixelStep * 0.5;\n\t\t\t\tedgeStep = vec2( 0.0, texSize.y );\n\n\t\t\t}\n\n\t\t\tfloat edgeLuminance = ( l.m + e.oppositeLuminance ) * 0.5;\n\t\t\tfloat gradientThreshold = e.gradient * 0.25;\n\n\t\t\tvec2 puv = uvEdge + edgeStep * edgeSteps[0];\n\t\t\tfloat pLuminanceDelta = SampleLuminance( tex2D, puv ) - edgeLuminance;\n\t\t\tbool pAtEnd = abs( pLuminanceDelta ) >= gradientThreshold;\n\n\t\t\tfor ( int i = 1; i < EDGE_STEP_COUNT && !pAtEnd; i++ ) {\n\n\t\t\t\tpuv += edgeStep * edgeSteps[i];\n\t\t\t\tpLuminanceDelta = SampleLuminance( tex2D, puv ) - edgeLuminance;\n\t\t\t\tpAtEnd = abs( pLuminanceDelta ) >= gradientThreshold;\n\n\t\t\t}\n\n\t\t\tif ( !pAtEnd ) {\n\n\t\t\t\tpuv += edgeStep * EDGE_GUESS;\n\n\t\t\t}\n\n\t\t\tvec2 nuv = uvEdge - edgeStep * edgeSteps[0];\n\t\t\tfloat nLuminanceDelta = SampleLuminance( tex2D, nuv ) - edgeLuminance;\n\t\t\tbool nAtEnd = abs( nLuminanceDelta ) >= gradientThreshold;\n\n\t\t\tfor ( int i = 1; i < EDGE_STEP_COUNT && !nAtEnd; i++ ) {\n\n\t\t\t\tnuv -= edgeStep * edgeSteps[i];\n\t\t\t\tnLuminanceDelta = SampleLuminance( tex2D, nuv ) - edgeLuminance;\n\t\t\t\tnAtEnd = abs( nLuminanceDelta ) >= gradientThreshold;\n\n\t\t\t}\n\n\t\t\tif ( !nAtEnd ) {\n\n\t\t\t\tnuv -= edgeStep * EDGE_GUESS;\n\n\t\t\t}\n\n\t\t\tfloat pDistance, nDistance;\n\t\t\tif ( e.isHorizontal ) {\n\n\t\t\t\tpDistance = puv.x - uv.x;\n\t\t\t\tnDistance = uv.x - nuv.x;\n\n\t\t\t} else {\n\n\t\t\t\tpDistance = puv.y - uv.y;\n\t\t\t\tnDistance = uv.y - nuv.y;\n\n\t\t\t}\n\n\t\t\tfloat shortestDistance;\n\t\t\tbool deltaSign;\n\t\t\tif ( pDistance <= nDistance ) {\n\n\t\t\t\tshortestDistance = pDistance;\n\t\t\t\tdeltaSign = pLuminanceDelta >= 0.0;\n\n\t\t\t} else {\n\n\t\t\t\tshortestDistance = nDistance;\n\t\t\t\tdeltaSign = nLuminanceDelta >= 0.0;\n\n\t\t\t}\n\n\t\t\tif ( deltaSign == ( l.m - edgeLuminance >= 0.0 ) ) {\n\n\t\t\t\treturn 0.0;\n\n\t\t\t}\n\n\t\t\treturn 0.5 - shortestDistance / ( pDistance + nDistance );\n\n\t\t}\n\n\t\tvec4 ApplyFXAA( sampler2D  tex2D, vec2 texSize, vec2 uv ) {\n\n\t\t\tLuminanceData luminance = SampleLuminanceNeighborhood( tex2D, texSize, uv );\n\t\t\tif ( ShouldSkipPixel( luminance ) ) {\n\n\t\t\t\treturn Sample( tex2D, uv );\n\n\t\t\t}\n\n\t\t\tfloat pixelBlend = DeterminePixelBlendFactor( luminance );\n\t\t\tEdgeData edge = DetermineEdge( texSize, luminance );\n\t\t\tfloat edgeBlend = DetermineEdgeBlendFactor( tex2D, texSize, luminance, edge, uv );\n\t\t\tfloat finalBlend = max( pixelBlend, edgeBlend );\n\n\t\t\tif (edge.isHorizontal) {\n\n\t\t\t\tuv.y += edge.pixelStep * finalBlend;\n\n\t\t\t} else {\n\n\t\t\t\tuv.x += edge.pixelStep * finalBlend;\n\n\t\t\t}\n\n\t\t\treturn Sample( tex2D, uv );\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tgl_FragColor = ApplyFXAA( tDiffuse, resolution.xy, vUv );\n\n\t\t}`\n\n};\n\nexport { FXAAShader };\n","import {\n\tVector3\n} from 'three';\n\n/** @module ColorCorrectionShader */\n\n/**\n * Color correction shader.\n *\n * @constant\n * @type {ShaderMaterial~Shader}\n */\nconst ColorCorrectionShader = {\n\n\tname: 'ColorCorrectionShader',\n\n\tuniforms: {\n\n\t\t'tDiffuse': { value: null },\n\t\t'powRGB': { value: new Vector3( 2, 2, 2 ) },\n\t\t'mulRGB': { value: new Vector3( 1, 1, 1 ) },\n\t\t'addRGB': { value: new Vector3( 0, 0, 0 ) }\n\n\t},\n\n\tvertexShader: /* glsl */`\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}`,\n\n\tfragmentShader: /* glsl */`\n\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform vec3 powRGB;\n\t\tuniform vec3 mulRGB;\n\t\tuniform vec3 addRGB;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tgl_FragColor = texture2D( tDiffuse, vUv );\n\t\t\tgl_FragColor.rgb = mulRGB * pow( ( gl_FragColor.rgb + addRGB ), powRGB );\n\n\t\t}`\n\n};\n\nexport { ColorCorrectionShader };\n","/** @module FilmShader */\n\n/**\n * TODO\n *\n * Used by {@link FilmPass}.\n *\n * @constant\n * @type {ShaderMaterial~Shader}\n */\nconst FilmShader = {\n\n\tname: 'FilmShader',\n\n\tuniforms: {\n\n\t\t'tDiffuse': { value: null },\n\t\t'time': { value: 0.0 },\n\t\t'intensity': { value: 0.5 },\n\t\t'grayscale': { value: false }\n\n\t},\n\n\tvertexShader: /* glsl */`\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}`,\n\n\tfragmentShader: /* glsl */`\n\n\t\t#include <common>\n\n\t\tuniform float intensity;\n\t\tuniform bool grayscale;\n\t\tuniform float time;\n\n\t\tuniform sampler2D tDiffuse;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 base = texture2D( tDiffuse, vUv );\n\n\t\t\tfloat noise = rand( fract( vUv + time ) );\n\n\t\t\tvec3 color = base.rgb + base.rgb * clamp( 0.1 + noise, 0.0, 1.0 );\n\n\t\t\tcolor = mix( base.rgb, color, intensity );\n\n\t\t\tif ( grayscale ) {\n\n\t\t\t\tcolor = vec3( luminance( color ) ); // assuming linear-srgb\n\n\t\t\t}\n\n\t\t\tgl_FragColor = vec4( color, base.a );\n\n\t\t}`,\n\n};\n\nexport { FilmShader };\n","/** @module VignetteShader */\n\n/**\n * Based on [PaintEffect postprocess from ro.me]{@link http://code.google.com/p/3-dreams-of-black/source/browse/deploy/js/effects/PaintEffect.js}.\n *\n * @constant\n * @type {ShaderMaterial~Shader}\n */\nconst VignetteShader = {\n\n\tname: 'VignetteShader',\n\n\tuniforms: {\n\n\t\t'tDiffuse': { value: null },\n\t\t'offset': { value: 1.0 },\n\t\t'darkness': { value: 1.0 }\n\n\t},\n\n\tvertexShader: /* glsl */`\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}`,\n\n\tfragmentShader: /* glsl */`\n\n\t\tuniform float offset;\n\t\tuniform float darkness;\n\n\t\tuniform sampler2D tDiffuse;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\t// Eskil's vignette\n\n\t\t\tvec4 texel = texture2D( tDiffuse, vUv );\n\t\t\tvec2 uv = ( vUv - vec2( 0.5 ) ) * vec2( offset );\n\t\t\tgl_FragColor = vec4( mix( texel.rgb, vec3( 1.0 - darkness ), dot( uv, uv ) ), texel.a );\n\n\t\t}`\n\n};\n\nexport { VignetteShader };\n","/**\n * A utility module with basic WebGL 2 capability testing.\n *\n * @hideconstructor\n */\nclass WebGL {\n\n\t/**\n\t * Returns `true` if WebGL 2 is available.\n\t *\n\t * @return {boolean} Whether WebGL 2 is available or not.\n\t */\n\tstatic isWebGL2Available() {\n\n\t\ttry {\n\n\t\t\tconst canvas = document.createElement( 'canvas' );\n\t\t\treturn !! ( window.WebGL2RenderingContext && canvas.getContext( 'webgl2' ) );\n\n\t\t} catch ( e ) {\n\n\t\t\treturn false;\n\n\t\t}\n\n\t}\n\n\t/**\n\t * Returns `true` if the given color space is available. This method can only be used\n\t * if WebGL 2 is supported.\n\t *\n\t * @param {string} colorSpace - The color space to test.\n\t * @return {boolean} Whether the given color space is available or not.\n\t */\n\tstatic isColorSpaceAvailable( colorSpace ) {\n\n\t\ttry {\n\n\t\t\tconst canvas = document.createElement( 'canvas' );\n\t\t\tconst ctx = window.WebGL2RenderingContext && canvas.getContext( 'webgl2' );\n\t\t\tctx.drawingBufferColorSpace = colorSpace;\n\t\t\treturn ctx.drawingBufferColorSpace === colorSpace; // deepscan-disable-line SAME_OPERAND_VALUE\n\n\t\t} catch ( e ) {\n\n\t\t\treturn false;\n\n\t\t}\n\n\t}\n\n\t/**\n\t * Returns a `div` element representing a formatted error message that can be appended in\n\t * web sites if WebGL 2 isn't supported.\n\t *\n\t * @return {HTMLDivElement} A `div` element representing a formatted error message that WebGL 2 isn't supported.\n\t */\n\tstatic getWebGL2ErrorMessage() {\n\n\t\treturn this._getErrorMessage( 2 );\n\n\t}\n\n\t// private\n\n\tstatic _getErrorMessage( version ) {\n\n\t\tconst names = {\n\t\t\t1: 'WebGL',\n\t\t\t2: 'WebGL 2'\n\t\t};\n\n\t\tconst contexts = {\n\t\t\t1: window.WebGLRenderingContext,\n\t\t\t2: window.WebGL2RenderingContext\n\t\t};\n\n\t\tlet message = 'Your $0 does not seem to support <a href=\"http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation\" style=\"color:#000\">$1</a>';\n\n\t\tconst element = document.createElement( 'div' );\n\t\telement.id = 'webglmessage';\n\t\telement.style.fontFamily = 'monospace';\n\t\telement.style.fontSize = '13px';\n\t\telement.style.fontWeight = 'normal';\n\t\telement.style.textAlign = 'center';\n\t\telement.style.background = '#fff';\n\t\telement.style.color = '#000';\n\t\telement.style.padding = '1.5em';\n\t\telement.style.width = '400px';\n\t\telement.style.margin = '5em auto 0';\n\n\t\tif ( contexts[ version ] ) {\n\n\t\t\tmessage = message.replace( '$0', 'graphics card' );\n\n\t\t} else {\n\n\t\t\tmessage = message.replace( '$0', 'browser' );\n\n\t\t}\n\n\t\tmessage = message.replace( '$1', names[ version ] );\n\n\t\telement.innerHTML = message;\n\n\t\treturn element;\n\n\t}\n\n\t// @deprecated, r168\n\n\tstatic isWebGLAvailable() {\n\n\t\tconsole.warn( 'isWebGLAvailable() has been deprecated and will be removed in r178. Use isWebGL2Available() instead.' );\n\n\t\ttry {\n\n\t\t\tconst canvas = document.createElement( 'canvas' );\n\t\t\treturn !! ( window.WebGLRenderingContext && ( canvas.getContext( 'webgl' ) || canvas.getContext( 'experimental-webgl' ) ) );\n\n\t\t} catch ( e ) {\n\n\t\t\treturn false;\n\n\t\t}\n\n\t}\n\n\tstatic getWebGLErrorMessage() {\n\n\t\tconsole.warn( 'getWebGLErrorMessage() has been deprecated and will be removed in r178. Use getWebGL2ErrorMessage() instead.' );\n\n\t\treturn this._getErrorMessage( 1 );\n\n\t}\n\n}\n\nexport default WebGL;\n","// renderer.js - Handles the Three.js scene, camera, renderer setup and post-processing\n\nimport * as THREE from 'three';\nimport { EffectComposer } from 'three/addons/postprocessing/EffectComposer.js';\nimport { RenderPass } from 'three/addons/postprocessing/RenderPass.js';\nimport { UnrealBloomPass } from 'three/addons/postprocessing/UnrealBloomPass.js';\nimport { ShaderPass } from 'three/addons/postprocessing/ShaderPass.js';\nimport { FXAAShader } from 'three/addons/shaders/FXAAShader.js';\nimport { ColorCorrectionShader } from 'three/addons/shaders/ColorCorrectionShader.js';\nimport { FilmShader } from 'three/addons/shaders/FilmShader.js';\nimport { VignetteShader } from 'three/addons/shaders/VignetteShader.js';\nimport WebGL from 'three/addons/capabilities/WebGL.js';\n\nexport class Renderer {\n    constructor() {\n        console.log(\"Initializing enhanced renderer...\");\n        \n        // Check for WebGL 2 support\n        if (!WebGL.isWebGL2Available()) {\n            const warning = WebGL.getWebGL2ErrorMessage();\n            document.body.appendChild(warning);\n            console.error(\"WebGL 2 is required but not available.\");\n            throw new Error(\"WebGL 2 not available\");\n        } else {\n            console.log(\"WebGL 2 is available.\");\n        }\n        \n        this.scene = new THREE.Scene();\n        this.camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 0.1, 400000);\n        \n        // Create renderer with HDR support\n        this.renderer = new THREE.WebGLRenderer({ \n            antialias: true,\n            powerPreference: \"high-performance\",\n            logarithmicDepthBuffer: true, // Better for space scenes with huge distance ranges\n            stencil: true, // Explicitly enable stencil buffer (default changed to false in r163)\n        });\n        \n        // Enable shadow mapping\n        this.renderer.shadowMap.enabled = true;\n        this.renderer.shadowMap.type = THREE.PCFSoftShadowMap;\n        \n        // Use the new physically correct lighting system (default in r155+)\n        this.renderer.useLegacyLights = false;\n        \n        // Set tone mapping for HDR rendering\n        this.renderer.toneMapping = THREE.ACESFilmicToneMapping;\n        this.renderer.toneMappingExposure = 1.0;\n        \n        // Setup for instanced meshes\n        this.instancedMeshes = new Map();\n        \n        this.setupRenderer();\n        this.setupPostProcessing();\n        this.setupLighting();\n        this.setupResizeHandler();\n        console.log(\"Enhanced renderer initialized successfully\");\n    }\n    \n    setupRenderer() {\n        this.renderer.setSize(window.innerWidth, window.innerHeight);\n        this.renderer.setClearColor(0x000000);\n        document.body.appendChild(this.renderer.domElement);\n        \n        // Set the output color space to sRGB\n        this.renderer.outputColorSpace = THREE.SRGBColorSpace;\n        \n        // Position camera - brought closer for better visibility\n        this.camera.position.z = 10;\n        \n        // Make sure the camera can see far enough to show the skybox\n        this.camera.far = 400000;\n        this.camera.updateProjectionMatrix();\n\n        // Enhance shadow mapping for better quality eclipse effects\n        this.renderer.shadowMap.enabled = true;\n        this.renderer.shadowMap.type = THREE.PCFSoftShadowMap;\n        this.renderer.shadowMap.autoUpdate = true;\n    }\n    \n    setupPostProcessing() {\n        try {\n            // Create a composer for post-processing effects\n            this.composer = new EffectComposer(this.renderer);\n            \n            // Add the render pass\n            const renderPass = new RenderPass(this.scene, this.camera);\n            this.composer.addPass(renderPass);\n            \n            // Add godray effect based on settings\n            this.setupGodRayEffects();\n            \n            try {\n                // Add bloom effect for sun, engines, etc.\n                this.bloomPass = new UnrealBloomPass(\n                    new THREE.Vector2(window.innerWidth, window.innerHeight),\n                    0.2,    // strength (further reduced from 0.3)\n                    0.2,    // radius (further reduced from 0.3)\n                    0.95    // threshold (further increased from 0.9 to only affect the very brightest parts)\n                );\n                this.composer.addPass(this.bloomPass);\n            } catch (error) {\n                console.warn(\"Error setting up UnrealBloomPass:\", error);\n            }\n            \n            try {\n                // Add FXAA for edge aliasing\n                const fxaaPass = new ShaderPass(FXAAShader);\n                if (fxaaPass.material && fxaaPass.material.uniforms && fxaaPass.material.uniforms.resolution) {\n                    const pixelRatio = this.renderer.getPixelRatio();\n                    fxaaPass.material.uniforms.resolution.value.x = 1 / (window.innerWidth * pixelRatio);\n                    fxaaPass.material.uniforms.resolution.value.y = 1 / (window.innerHeight * pixelRatio);\n                    this.composer.addPass(fxaaPass);\n                } else {\n                    console.warn(\"FXAAShader uniforms not as expected, skipping pass\");\n                }\n            } catch (error) {\n                console.warn(\"Error setting up FXAAShader:\", error);\n            }\n            \n            try {\n                // Add color correction effects\n                this.colorCorrectionPass = new ShaderPass(ColorCorrectionShader);\n                if (this.colorCorrectionPass.uniforms && this.colorCorrectionPass.uniforms.powRGB && this.colorCorrectionPass.uniforms.mulRGB) {\n                    this.colorCorrectionPass.uniforms.powRGB.value = new THREE.Vector3(1.1, 1.1, 1.2); // Slightly blue tint\n                    this.colorCorrectionPass.uniforms.mulRGB.value = new THREE.Vector3(1.2, 1.1, 1.0); // Warmer highlights\n                    this.composer.addPass(this.colorCorrectionPass);\n                } else {\n                    console.warn(\"ColorCorrectionShader uniforms not as expected, skipping pass\");\n                }\n            } catch (error) {\n                console.warn(\"Error setting up ColorCorrectionShader:\", error);\n            }\n            \n            try {\n                // Add subtle film grain for more cinematic feel\n                this.filmPass = new ShaderPass(FilmShader);\n                if (this.filmPass.uniforms && this.filmPass.uniforms.nIntensity && \n                    this.filmPass.uniforms.sIntensity && this.filmPass.uniforms.grayscale) {\n                    this.filmPass.uniforms.nIntensity.value = 0.15; // Noise intensity\n                    this.filmPass.uniforms.sIntensity.value = 0.05; // Scanline intensity\n                    this.filmPass.uniforms.grayscale.value = 0; // Color\n                    this.composer.addPass(this.filmPass);\n                } else {\n                    console.warn(\"FilmShader uniforms not as expected, skipping pass\");\n                }\n            } catch (error) {\n                console.warn(\"Error setting up FilmShader:\", error);\n            }\n            \n            try {\n                // Add vignette effect\n                this.vignettePass = new ShaderPass(VignetteShader);\n                if (this.vignettePass.uniforms && this.vignettePass.uniforms.offset && this.vignettePass.uniforms.darkness) {\n                    this.vignettePass.uniforms.offset.value = 0.95;\n                    this.vignettePass.uniforms.darkness.value = 1.6;\n                    this.composer.addPass(this.vignettePass);\n                } else {\n                    console.warn(\"VignetteShader uniforms not as expected, skipping pass\");\n                }\n            } catch (error) {\n                console.warn(\"Error setting up VignetteShader:\", error);\n            }\n            \n            console.log(\"Post-processing setup complete\");\n        } catch (error) {\n            console.error(\"Error setting up post-processing:\", error);\n            console.log(\"Continuing with basic rendering without post-processing\");\n            // Set a flag to use basic rendering instead\n            this.useBasicRendering = true;\n        }\n    }\n    \n    /**\n     * Setup for volumetric lighting (god rays) effects\n     * Handles both the new realistic godray effect and the original \"Claude Rays\"\n     */\n    setupGodRayEffects() {\n        try {\n            // Initialize flags for volumetric lighting effects\n            this.volumetricLightEnabled = true;     // Master toggle for any god ray effect\n            this.useClaudeRays = false;             // Toggle between new godRays (false) and Claude Rays (true)\n            \n            // Create the original \"Claude Rays\" effect (disabled by default)\n            this.claudeRayPass = this.createClaudeRayShader();\n            this.claudeRayPass.enabled = this.volumetricLightEnabled && this.useClaudeRays;\n            this.composer.addPass(this.claudeRayPass);\n            console.log(\"Claude Rays effect created (disabled by default)\");\n            \n            // Create the new improved volumetric lighting effect\n            this.godRayPass = this.createVolumetricLightShader();\n            this.godRayPass.enabled = this.volumetricLightEnabled && !this.useClaudeRays;\n            this.composer.addPass(this.godRayPass);\n            console.log(\"New volumetric light ray effect added to post-processing chain\");\n        } catch (error) {\n            console.warn(\"Error setting up volumetric light shaders:\", error);\n        }\n    }\n    \n    setupLighting() {\n        // Ambient light - reduced for better shadow visibility\n        const ambientLight = new THREE.AmbientLight(0x404050, 1.0); // Reduced from 2.5\n        this.scene.add(ambientLight);\n        this.ambientLight = ambientLight; // Store reference to adjust later\n\n        // Directional light - kept the same\n        const directionalLight = new THREE.DirectionalLight(0xffffe0, 2.0);\n        directionalLight.position.set(1, 0.5, 1).normalize();\n        directionalLight.castShadow = true;\n        // Configure shadow properties\n        directionalLight.shadow.mapSize.width = 2048;\n        directionalLight.shadow.mapSize.height = 2048;\n        directionalLight.shadow.camera.near = 0.5;\n        directionalLight.shadow.camera.far = 500;\n        directionalLight.shadow.bias = -0.0005;\n        this.scene.add(directionalLight);\n        \n        // Fill light - reduced for better shadow definition\n        const fillLight = new THREE.DirectionalLight(0xaaccff, 0.3); // Reduced from 0.8\n        fillLight.position.set(-1, -0.3, -1).normalize();\n        this.scene.add(fillLight);\n        \n        // Hemisphere light - reduced for better contrast\n        const hemisphereLight = new THREE.HemisphereLight(0x606090, 0x101020, 0.4); // Reduced from 0.8\n        this.scene.add(hemisphereLight);\n        \n        // Ambient point light - reduced brightness\n        const ambientPointLight = new THREE.PointLight(0xffffff, 1.2, 1200, 2); // Reduced from 2.5\n        ambientPointLight.position.set(0, 500, 0); // Positioned high up\n        this.scene.add(ambientPointLight);\n    }\n    \n    setupResizeHandler() {\n        window.addEventListener('resize', () => {\n            this.handleResize();\n        });\n    }\n    \n    // Explicitly define getter methods for scene and camera\n    getScene() {\n        return this.scene;\n    }\n    \n    getCamera() {\n        return this.camera;\n    }\n    \n    // Resize handler method\n    handleResize() {\n        this.camera.aspect = window.innerWidth / window.innerHeight;\n        this.camera.updateProjectionMatrix();\n        this.renderer.setSize(window.innerWidth, window.innerHeight);\n        \n        // Update composer size if it exists\n        if (this.composer) {\n            this.composer.setSize(window.innerWidth, window.innerHeight);\n        \n            // Update FXAA resolution\n            try {\n                const pixelRatio = this.renderer.getPixelRatio();\n                const fxaaPass = this.composer.passes.find(pass => \n                    pass.material && \n                    pass.material.uniforms && \n                    pass.material.uniforms.resolution &&\n                    pass.material.uniforms.resolution.value\n                );\n                \n                if (fxaaPass) {\n                    fxaaPass.material.uniforms.resolution.value.x = 1 / (window.innerWidth * pixelRatio);\n                    fxaaPass.material.uniforms.resolution.value.y = 1 / (window.innerHeight * pixelRatio);\n                }\n            } catch (error) {\n                console.warn(\"Error updating FXAA resolution:\", error);\n            }\n        }\n    }\n    \n    // Add an object to the scene\n    add(object) {\n        this.scene.add(object);\n    }\n    \n    // Allow dynamic adjustment of post-processing settings\n    adjustBloom(strength, radius, threshold) {\n        if (this.bloomPass) {\n            this.bloomPass.strength = strength !== undefined ? strength : this.bloomPass.strength;\n            this.bloomPass.radius = radius !== undefined ? radius : this.bloomPass.radius;\n            this.bloomPass.threshold = threshold !== undefined ? threshold : this.bloomPass.threshold;\n        }\n    }\n    \n    // Update for dynamic visual effects\n    update(deltaTime) {\n        // Update film grain with time for animation\n        if (this.filmPass && this.filmPass.uniforms && this.filmPass.uniforms.time && this.filmPass.uniforms.time.value !== undefined) {\n            try {\n                this.filmPass.uniforms.time.value += deltaTime;\n            } catch (error) {\n                console.warn(\"Error updating film pass time:\", error);\n            }\n        }\n        \n        // Update volumetric light ray position if sun is present\n        if (this.volumetricLightEnabled) {\n            if (this.useClaudeRays) {\n                this.updateClaudeRayPosition();\n            } else {\n                this.updateVolumetricLightPosition();\n            }\n        }\n        \n        // Update instanced meshes\n        this.updateInstancedMeshes();\n    }\n    \n    /**\n     * Update the light position for Claude Rays\n     */\n    updateClaudeRayPosition() {\n        try {\n            // Ensure we have the required objects\n            if (!this.claudeRayPass || !this.claudeRayPass.uniforms || !this.claudeRayPass.uniforms.lightPosition) {\n                return;\n            }\n            \n            if (!this.camera || !this.scene) {\n                return;\n            }\n            \n            // Try to find the sun in the scene\n            let sun = this.findSunObject();\n            \n            if (sun) {\n                // Get sun world position\n                const sunWorldPos = new THREE.Vector3();\n                sun.getWorldPosition(sunWorldPos);\n                \n                // Create a vector to hold the screen position\n                const screenVector = sunWorldPos.clone();\n                \n                // Project to camera space\n                screenVector.project(this.camera);\n                \n                // Convert to normalized device coordinates (NDC)\n                const x = (screenVector.x + 1) / 2;\n                const y = (screenVector.y + 1) / 2;\n                \n                // Update the shader uniform with the new position\n                this.claudeRayPass.uniforms.lightPosition.value.set(x, y);\n            } else {\n                // Default to center if sun not found\n                this.claudeRayPass.uniforms.lightPosition.value.set(0.5, 0.5);\n            }\n        } catch (error) {\n            console.warn('Error updating Claude Ray position:', error);\n            \n            // Set a default position in case of error\n            if (this.claudeRayPass && this.claudeRayPass.uniforms && this.claudeRayPass.uniforms.lightPosition) {\n                this.claudeRayPass.uniforms.lightPosition.value.set(0.5, 0.5);\n            }\n        }\n    }\n    \n    /**\n     * Update the light position for volumetric rays\n     */\n    updateVolumetricLightPosition() {\n        try {\n            // Ensure we have the required objects\n            if (!this.godRayPass || !this.godRayPass.uniforms || !this.godRayPass.uniforms.lightPosition) {\n                return;\n            }\n            \n            if (!this.camera || !this.scene) {\n                return;\n            }\n            \n            // Try to find the sun in the scene\n            let sun = this.findSunObject();\n            \n            if (sun) {\n                // Get sun world position\n                const sunWorldPos = new THREE.Vector3();\n                sun.getWorldPosition(sunWorldPos);\n                \n                // Create a vector to hold the screen position\n                const screenVector = sunWorldPos.clone();\n                \n                // Project to camera space\n                screenVector.project(this.camera);\n                \n                // Convert to normalized device coordinates (NDC)\n                const x = (screenVector.x + 1) / 2;\n                const y = (screenVector.y + 1) / 2;\n                \n                // Calculate distance from camera to sun for attenuation\n                const camToSunDistance = this.camera.position.distanceTo(sunWorldPos);\n                \n                // Update the shader uniforms\n                this.godRayPass.uniforms.lightPosition.value.set(x, y);\n                \n                // Update distance - normalized to 0-1 range for shader\n                // Base the max distance on the sun's size and visibility range\n                const maxDistance = 130000; // Increased from 100000 for longer rays\n                const normalizedDistance = Math.min(1.0, camToSunDistance / maxDistance);\n                this.godRayPass.uniforms.sunDistance.value = normalizedDistance;\n                \n                // Calculate if sun is in front of camera (dot product with camera direction)\n                const camDirection = new THREE.Vector3(0, 0, -1).applyQuaternion(this.camera.quaternion);\n                const sunDirection = new THREE.Vector3().subVectors(sunWorldPos, this.camera.position).normalize();\n                const dotProduct = camDirection.dot(sunDirection);\n                \n                // Sun is visible when dot product is positive (sun is in front of camera)\n                this.godRayPass.uniforms.sunVisibility.value = Math.max(0, dotProduct);\n            } else {\n                // Default to center if sun not found\n                this.godRayPass.uniforms.lightPosition.value.set(0.5, 0.5);\n                this.godRayPass.uniforms.sunDistance.value = 1.0; // Far away\n                this.godRayPass.uniforms.sunVisibility.value = 0.0; // Not visible\n            }\n        } catch (error) {\n            console.warn('Error updating volumetric light position:', error);\n            \n            // Set default values in case of error\n            if (this.godRayPass && this.godRayPass.uniforms) {\n                if (this.godRayPass.uniforms.lightPosition) {\n                    this.godRayPass.uniforms.lightPosition.value.set(0.5, 0.5);\n                }\n                if (this.godRayPass.uniforms.sunDistance) {\n                    this.godRayPass.uniforms.sunDistance.value = 1.0;\n                }\n                if (this.godRayPass.uniforms.sunVisibility) {\n                    this.godRayPass.uniforms.sunVisibility.value = 0.0;\n                }\n            }\n        }\n    }\n    \n    /**\n     * Helper method to find the sun object in the scene\n     * @returns {THREE.Object3D|null} The sun object or null if not found\n     */\n    findSunObject() {\n        let sun = null;\n        \n        // First try by name\n        sun = this.scene.getObjectByName('sun');\n        \n        // If not found by name, try to find by traversing scene\n        if (!sun) {\n            this.scene.traverse(object => {\n                if (object.name === 'sun') {\n                    sun = object;\n                }\n            });\n        }\n        \n        return sun;\n    }\n    \n    // Override the render method to use the composer if available, otherwise fallback to basic rendering\n    render() {\n        if (this.composer && !this.useBasicRendering) {\n            this.composer.render();\n        } else {\n            this.renderer.render(this.scene, this.camera);\n        }\n    }\n    \n    /**\n     * Create an instanced mesh for efficient rendering of many similar objects\n     * @param {string} key Unique identifier for this instanced mesh type\n     * @param {THREE.BufferGeometry} geometry The geometry to instance\n     * @param {THREE.Material} material The material to use\n     * @param {number} maxCount Maximum number of instances\n     * @returns {THREE.InstancedMesh} The created instanced mesh\n     */\n    createInstancedMesh(key, geometry, material, maxCount) {\n        const instancedMesh = new THREE.InstancedMesh(geometry, material, maxCount);\n        instancedMesh.count = 0; // Start with 0 visible instances\n        instancedMesh.frustumCulled = true;\n        this.scene.add(instancedMesh);\n        \n        this.instancedMeshes.set(key, {\n            mesh: instancedMesh,\n            count: 0,\n            maxCount: maxCount,\n            dummy: new THREE.Object3D() // Reusable temporary Object3D for matrix calculations\n        });\n        \n        return instancedMesh;\n    }\n    \n    /**\n     * Add or update an instance in an instanced mesh\n     * @param {string} key The instanced mesh identifier\n     * @param {number} index Index of the instance to update (or next available)\n     * @param {THREE.Vector3} position Position of the instance\n     * @param {THREE.Quaternion} quaternion Rotation of the instance\n     * @param {THREE.Vector3} scale Scale of the instance\n     * @returns {number} The index of the instance\n     */\n    updateInstance(key, index, position, quaternion, scale) {\n        const instance = this.instancedMeshes.get(key);\n        if (!instance) return -1;\n        \n        // Determine index to use\n        const idx = (index !== undefined) ? index : instance.count;\n        \n        // If we're adding a new instance, increment the count\n        if (idx >= instance.count) {\n            if (idx >= instance.maxCount) return -1; // Can't exceed max count\n            instance.count = idx + 1;\n        }\n        \n        // Update matrix using dummy object\n        instance.dummy.position.copy(position);\n        if (quaternion) instance.dummy.quaternion.copy(quaternion);\n        if (scale) instance.dummy.scale.copy(scale);\n        instance.dummy.updateMatrix();\n        \n        // Apply to instanced mesh\n        instance.mesh.setMatrixAt(idx, instance.dummy.matrix);\n        instance.mesh.instanceMatrix.needsUpdate = true;\n        \n        return idx;\n    }\n    \n    /**\n     * Update instanced meshes\n     */\n    updateInstancedMeshes() {\n        for (const [key, instance] of this.instancedMeshes.entries()) {\n            if (instance.mesh.instanceMatrix.needsUpdate) {\n                instance.mesh.instanceMatrix.needsUpdate = false;\n            }\n        }\n    }\n    \n    /**\n     * Remove an instance from an instanced mesh\n     * @param {string} key The instanced mesh identifier\n     * @param {number} index Index of the instance to remove\n     */\n    removeInstance(key, index) {\n        const instance = this.instancedMeshes.get(key);\n        if (!instance || index >= instance.count) return;\n        \n        // Move the last instance to this slot if it's not the last one\n        if (index < instance.count - 1) {\n            // Get the matrix of the last instance\n            const matrix = new THREE.Matrix4();\n            instance.mesh.getMatrixAt(instance.count - 1, matrix);\n            \n            // Set it at the removed index\n            instance.mesh.setMatrixAt(index, matrix);\n        }\n        \n        // Decrease count\n        instance.count--;\n        instance.mesh.count = instance.count;\n        instance.mesh.instanceMatrix.needsUpdate = true;\n    }\n    \n    /**\n     * Properly dispose of Three.js resources to prevent memory leaks\n     */\n    dispose() {\n        console.log(\"Disposing renderer resources...\");\n        \n        // Remove event listener\n        window.removeEventListener('resize', this.handleResize);\n        \n        // Dispose of post-processing\n        if (this.composer) {\n            this.composer.passes.forEach(pass => {\n                if (pass.dispose) pass.dispose();\n                if (pass.material) {\n                    pass.material.dispose();\n                }\n            });\n        }\n        \n        // Dispose of instanced meshes\n        this.instancedMeshes.forEach(instance => {\n            if (instance.mesh) {\n                if (instance.mesh.geometry) instance.mesh.geometry.dispose();\n                if (instance.mesh.material) {\n                    if (Array.isArray(instance.mesh.material)) {\n                        instance.mesh.material.forEach(material => material.dispose());\n                    } else {\n                        instance.mesh.material.dispose();\n                    }\n                }\n                this.scene.remove(instance.mesh);\n            }\n        });\n        \n        // Dispose of scene objects\n        this.scene.traverse(object => {\n            if (object.geometry) object.geometry.dispose();\n            \n            if (object.material) {\n                if (Array.isArray(object.material)) {\n                    object.material.forEach(material => this.disposeMaterial(material));\n                } else {\n                    this.disposeMaterial(object.material);\n                }\n            }\n        });\n        \n        // Dispose of renderer\n        this.renderer.dispose();\n        \n        console.log(\"Renderer resources disposed\");\n    }\n    \n    /**\n     * Helper method to dispose of materials and their textures\n     * @param {THREE.Material} material The material to dispose\n     */\n    disposeMaterial(material) {\n        // Dispose textures\n        for (const propertyName in material) {\n            const property = material[propertyName];\n            if (property && property.isTexture) {\n                property.dispose();\n            }\n        }\n        \n        // Dispose the material itself\n        material.dispose();\n    }\n    \n    /**\n     * Create a volumetric light shader for realistic god ray effects\n     * @returns {ShaderPass} Shader pass for new volumetric lighting\n     */\n    createVolumetricLightShader() {\n        // New improved volumetric light ray shader\n        const godRayShader = {\n            uniforms: {\n                tDiffuse: { value: null },\n                lightPosition: { value: new THREE.Vector2(0.5, 0.5) },\n                intensity: { value: 0.45 },         // Increased from 0.3\n                decay: { value: 0.94 },             // Adjusted from 0.95 for better distance\n                density: { value: 0.6 },            // Increased from 0.5\n                weight: { value: 0.5 },             // Increased from 0.4\n                samples: { value: 100 },            // Sample count - higher = better quality but slower\n                sunColor: { value: new THREE.Color(0xFFFAF0) },   // Sun color\n                sunDistance: { value: 0.5 },        // Distance to sun (0-1 normalized)\n                sunVisibility: { value: 1.0 },      // Whether sun is in front of camera (0-1)\n                scattering: { value: 0.4 },         // Increased from 0.3\n                attenuationMultiplier: { value: 3.5 } // Reduced from 5.0 to allow rays to travel further\n            },\n            \n            vertexShader: `\n                varying vec2 vUv;\n                \n                void main() {\n                    vUv = uv;\n                    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n                }\n            `,\n            \n            fragmentShader: `\n                precision highp float;\n                \n                varying vec2 vUv;\n                uniform sampler2D tDiffuse;\n                uniform vec2 lightPosition;\n                uniform float intensity;\n                uniform float decay;\n                uniform float density;\n                uniform float weight;\n                uniform int samples;\n                uniform vec3 sunColor;\n                uniform float sunDistance;\n                uniform float sunVisibility;\n                uniform float scattering;\n                uniform float attenuationMultiplier;\n                \n                const int MAX_SAMPLES = 150;\n                \n                float illuminationDecay(float rayProgress, float dist) {\n                    // rayProgress: 0.0 to a1.0 (how far along the ray)\n                    // dist: normalized distance to sun (0 = close, 1 = far)\n                    \n                    // Base decay from exponential falloff\n                    float baseFalloff = pow(decay, rayProgress * 100.0);\n                    \n                    // More decay the further the sun is \n                    float distanceAttenuation = 1.0 - (dist * dist * attenuationMultiplier);\n                    distanceAttenuation = max(0.0, distanceAttenuation);\n                    \n                    // Apply visibility factor\n                    float visibilityFactor = sunVisibility;\n                    \n                    return baseFalloff * distanceAttenuation * visibilityFactor;\n                }\n                \n                void main() {\n                    // Get the texture color (original scene)\n                    vec4 sceneColor = texture2D(tDiffuse, vUv);\n                    \n                    // Calculate ray direction from pixel to light source\n                    vec2 rayVector = (vUv - lightPosition);\n                    float rayLength = length(rayVector);\n                    vec2 rayDirection = normalize(rayVector);\n                    \n                    // Skip calculation if ray is too long (reduces artifacts far from sun)\n                    if (rayLength > 1.0) {\n                        gl_FragColor = sceneColor;\n                        return;\n                    }\n                    \n                    // Angle factor (rays stronger when looking near sun)\n                    float angleFactor = 1.0 - rayLength;\n                    angleFactor = pow(angleFactor, 0.8); // Adjust the power for ray spread\n                    \n                    // Calculate ray sampling parameters\n                    vec2 sampleStep = -rayDirection * min(density, 1.0) / float(samples);\n                    \n                    // Use a tighter sampling box around the light source\n                    // This creates more defined rays and reduces artifacts\n                    float rayProgress = max(0.0, (1.0 - rayLength * 2.0)); // Start closer to light source\n                    vec2 samplePosition = vUv - sampleStep * rayProgress * 10.0; // Start closer to current position\n                    \n                    // Clamp sample count for performance\n                    int sampleCount = min(samples, MAX_SAMPLES);\n                    \n                    // Start with current scene color\n                    vec4 finalColor = sceneColor;\n                    \n                    // Calculate scattering factor based on distance and angle\n                    float scatterFactor = scattering * angleFactor * (1.0 - sunDistance * 0.5);\n                    \n                    // Sample the light path\n                    for (int i = 0; i < MAX_SAMPLES; i++) {\n                        if (i >= sampleCount) break;\n                        \n                        // Move along the ray\n                        samplePosition += sampleStep;\n                        \n                        // Sample at the current position\n                        vec4 sampledColor = texture2D(tDiffuse, samplePosition);\n                        \n                        // Calculate illumination decay factor\n                        float decayFactor = illuminationDecay(float(i) / float(sampleCount), sunDistance);\n                        \n                        // Create the ray sample with attenuation\n                        vec4 raySample = sampledColor * decayFactor * weight;\n                        \n                        // Apply sun color to the ray (tinted by scene color)\n                        raySample.rgb *= mix(sunColor, sampledColor.rgb, 0.3);\n                        \n                        // Apply scattering effect - brightens areas around sun\n                        if (i < sampleCount / 3) {\n                            raySample.rgb += sunColor * scatterFactor * decayFactor * 0.2 * (1.0 - float(i) / float(sampleCount / 3));\n                        }\n                        \n                        // Add to accumulated color\n                        finalColor += raySample;\n                    }\n                    \n                    // Apply master intensity factor\n                    finalColor *= mix(1.0, intensity, sunVisibility);\n                    \n                    // Preserve original scene color with a blend factor\n                    finalColor = mix(sceneColor, finalColor, min(0.95, intensity * sunVisibility));\n                    \n                    gl_FragColor = finalColor;\n                }\n            `\n        };\n        \n        // Create and return a shader pass\n        const shaderPass = new ShaderPass(godRayShader);\n        shaderPass.renderToScreen = false;\n        \n        return shaderPass;\n    }\n    \n    /**\n     * Create the original \"Claude Ray\" shader (the original implementation renamed)\n     * @returns {ShaderPass} Shader pass for the original effect\n     */\n    createClaudeRayShader() {\n        // Original volumetric light ray shader (renamed to Claude Rays)\n        const claudeRayShader = {\n            uniforms: {\n                tDiffuse: { value: null },\n                lightPosition: { value: new THREE.Vector2(0.5, 0.5) },\n                exposure: { value: 0.4 },    // Reduced from 0.6\n                decay: { value: 0.93 },\n                density: { value: 0.8 },     // Reduced from 0.96\n                weight: { value: 0.25 },     // Reduced from 0.4\n                lightColor: { value: new THREE.Color(0xFFFAF0) }  // Matches sun directional light\n            },\n            vertexShader: `\n                varying vec2 vUv;\n                void main() {\n                    vUv = uv;\n                    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n                }\n            `,\n            fragmentShader: `\n                precision highp float;\n                \n                varying vec2 vUv;\n                uniform sampler2D tDiffuse;\n                uniform vec2 lightPosition;\n                uniform float exposure;\n                uniform float decay;\n                uniform float density;\n                uniform float weight;\n                uniform vec3 lightColor;\n                \n                const int NUM_SAMPLES = 24; // Reduced from 30 for better balance of quality and performance\n                \n                void main() {\n                    // Get the texture color\n                    vec4 color = texture2D(tDiffuse, vUv);\n                    \n                    // Ray direction\n                    vec2 texCoord = vUv;\n                    vec2 deltaTextCoord = (texCoord - lightPosition) * density / float(NUM_SAMPLES);\n                    \n                    // Start illumination decay at 1.0\n                    float illuminationDecay = 1.0;\n                    \n                    // Sample the light path with a fixed number of steps\n                    for(int i = 0; i < NUM_SAMPLES; i++) {\n                        // Move along the ray\n                        texCoord -= deltaTextCoord;\n                        \n                        // Sample at the current position\n                        vec4 sampleColor = texture2D(tDiffuse, texCoord);\n                        \n                        // Apply decay and weight\n                        sampleColor *= illuminationDecay * weight;\n                        \n                        // Apply light color\n                        sampleColor.rgb *= lightColor;\n                        \n                        // Add to the final color\n                        color += sampleColor;\n                        \n                        // Reduce illumination for the next sample\n                        illuminationDecay *= decay;\n                    }\n                    \n                    // Apply exposure\n                    color *= exposure;\n                    \n                    // Output the final color\n                    gl_FragColor = color;\n                }\n            `\n        };\n        \n        // Create and return a shader pass\n        const shaderPass = new ShaderPass(claudeRayShader);\n        shaderPass.renderToScreen = false;\n        \n        return shaderPass;\n    }\n    \n    /**\n     * Toggle the type of volumetric lighting effect\n     * @param {boolean} useClaudeRays - If true, use original Claude Rays; if false, use new god rays\n     */\n    setRayType(useClaudeRays) {\n        this.useClaudeRays = useClaudeRays;\n        \n        // Enable/disable appropriate shader passes\n        if (this.claudeRayPass) {\n            this.claudeRayPass.enabled = this.volumetricLightEnabled && this.useClaudeRays;\n        }\n        \n        if (this.godRayPass) {\n            this.godRayPass.enabled = this.volumetricLightEnabled && !this.useClaudeRays;\n        }\n        \n        // Adjust ambient lighting based on ray type\n        this.adjustLightingForRayType();\n        \n        console.log(`Using ${this.useClaudeRays ? 'Claude Rays' : 'Volumetric God Rays'} effect`);\n    }\n    \n    /**\n     * Adjust scene lighting based on current ray type\n     * Standard god rays need more ambient light to prevent planets from being too dark\n     */\n    adjustLightingForRayType() {\n        if (!this.ambientLight) return;\n        \n        if (this.useClaudeRays) {\n            // For Claude Rays - use original darker ambient lighting\n            this.ambientLight.intensity = 1.0;\n        } else {\n            // For standard god rays - increase ambient lighting to better illuminate planets\n            this.ambientLight.intensity = 1.8; // Increased from 1.0\n        }\n    }\n    \n    /**\n     * Toggle volumetric light rays effect (master toggle)\n     * @param {boolean} enabled Whether to enable or disable all ray effects\n     */\n    setVolumetricLightEnabled(enabled) {\n        this.volumetricLightEnabled = enabled;\n        \n        // Update enabled state of current ray effect\n        if (this.useClaudeRays && this.claudeRayPass) {\n            this.claudeRayPass.enabled = enabled;\n        } else if (this.godRayPass) {\n            this.godRayPass.enabled = enabled;\n        }\n        \n        console.log(`Volumetric lighting ${enabled ? 'enabled' : 'disabled'}`);\n    }\n    \n    /**\n     * Update volumetric light parameters for the new god ray shader\n     * @param {Object} params Parameters to update\n     */\n    updateVolumetricLightParams(params = {}) {\n        if (!this.godRayPass || !this.godRayPass.uniforms) return;\n        \n        const uniforms = this.godRayPass.uniforms;\n        \n        if (params.intensity !== undefined) uniforms.intensity.value = params.intensity;\n        if (params.decay !== undefined) uniforms.decay.value = params.decay;\n        if (params.density !== undefined) uniforms.density.value = params.density;\n        if (params.weight !== undefined) uniforms.weight.value = params.weight;\n        if (params.samples !== undefined) uniforms.samples.value = params.samples;\n        if (params.sunColor !== undefined) uniforms.sunColor.value = new THREE.Color(params.sunColor);\n        if (params.scattering !== undefined) uniforms.scattering.value = params.scattering;\n        if (params.attenuationMultiplier !== undefined) uniforms.attenuationMultiplier.value = params.attenuationMultiplier;\n    }\n    \n    /**\n     * Update Claude Ray parameters\n     * @param {Object} params Parameters to update\n     */\n    updateClaudeRayParams(params = {}) {\n        if (!this.claudeRayPass || !this.claudeRayPass.uniforms) return;\n        \n        const uniforms = this.claudeRayPass.uniforms;\n        \n        if (params.exposure !== undefined) uniforms.exposure.value = params.exposure;\n        if (params.decay !== undefined) uniforms.decay.value = params.decay;\n        if (params.density !== undefined) uniforms.density.value = params.density;\n        if (params.weight !== undefined) uniforms.weight.value = params.weight;\n        if (params.lightColor !== undefined) uniforms.lightColor.value = new THREE.Color(params.lightColor);\n    }\n    \n    /**\n     * Set overall volumetric light ray intensity with a single parameter\n     * @param {number} intensity Value from 0-1 controlling overall ray intensity\n     */\n    setVolumetricLightIntensity(intensity) {\n        if (this.useClaudeRays) {\n            // For Claude Rays\n            if (!this.claudeRayPass || !this.claudeRayPass.uniforms) return;\n            \n            // Clamp intensity between 0 and 1\n            intensity = Math.max(0, Math.min(1, intensity));\n            \n            // Scale the intensity to reasonable parameter ranges\n            const exposure = 0.2 + (intensity * 0.4);  // Range: 0.2-0.6\n            const weight = 0.15 + (intensity * 0.25);  // Range: 0.15-0.4\n            const density = 0.7 + (intensity * 0.3);   // Range: 0.7-1.0\n            \n            // Update the shader parameters\n            this.updateClaudeRayParams({\n                exposure: exposure,\n                weight: weight,\n                density: density\n            });\n        } else {\n            // For new god rays\n            if (!this.godRayPass || !this.godRayPass.uniforms) return;\n            \n            // Clamp intensity between 0 and 1\n            intensity = Math.max(0, Math.min(1, intensity));\n            \n            // Scale intensity for new shader parameters with higher base values\n            this.updateVolumetricLightParams({\n                intensity: 0.3 + (intensity * 0.4),  // Increased base intensity\n                weight: 0.35 + (intensity * 0.3),    // Increased from 0.3 + intensity * 0.2\n                density: 0.45 + (intensity * 0.25),  // Increased from 0.4 + intensity * 0.2\n                scattering: 0.25 + (intensity * 0.25) // Increased from 0.2 + intensity * 0.2\n            });\n        }\n        \n        console.log(`Volumetric light intensity set to ${intensity.toFixed(2)}`);\n    }\n}","// spaceship.js - Handles spaceship creation and management\n\nimport * as THREE from 'three';\n\nexport class Spaceship {\n    constructor(scene) {\n        this.scene = scene;\n        this.mesh = null;\n        this.thrusters = [];\n        this.leftCannon = null;\n        this.rightCannon = null;\n        this.leftEmitter = null;\n        this.rightEmitter = null;\n        this.miningLaser = null; // Will point to leftEmitter during initialization\n        this.velocity = new THREE.Vector3(0, 0, 0);\n        this.rotation = new THREE.Euler(0, 0, 0);\n        this.thrust = {\n            forward: false,\n            backward: false,\n            left: false,\n            right: false,\n            boost: false\n        };\n        this.particleSystems = [];\n        this.trailParticles = null;\n        this.shipScale = 2.0; // New property to track ship scale\n        \n        // Combat properties\n        this.hull = 100; // Current hull health\n        this.maxHull = 100; // Maximum hull health\n        this.shield = 50; // Current shield value\n        this.maxShield = 50; // Maximum shield value\n        this.isDestroyed = false; // Track if ship is destroyed\n        \n        // Docking and fuel properties\n        this.fuel = 100; // Start with full fuel\n        this.maxFuel = 100;\n        this.fuelConsumptionRate = 0.01; // Fuel used per frame when thrusting\n        this.isDocked = true; // Start docked by default (CHANGED FROM FALSE TO TRUE)\n        this.credits = 1000; // Starting credits\n        \n        // Initialize cargo (empty by default)\n        this.cargo = {\n            iron: 0,\n            gold: 0,\n            platinum: 0\n        };\n        \n        // Track fuel tank upgrades\n        this.fuelTankLevel = 1;\n        this.fuelUpgradeCost = 1000; // Initial upgrade cost\n        \n        // New upgrade properties for enhanced ship systems\n        this.engineLevel = 1;\n        this.engineUpgradeCost = 800;\n        this.maxVelocity = 25.0; // Starting max velocity\n        \n        this.miningLevel = 1;\n        this.miningUpgradeCost = 1200;\n        this.miningEfficiency = 1.0; // Multiplier for mining speed\n        \n        this.hullLevel = 1;\n        this.hullUpgradeCost = 1500;\n        this.collisionResistance = 1.0; // Multiplier for collision damage resistance\n        \n        this.scannerLevel = 1;\n        this.scannerUpgradeCost = 600;\n        this.scanRange = 1000; // Base scanner range\n        \n        // Deployable lasers\n        this.deployableLaserCount = 0; // Number of deployable lasers\n        \n        // Position where ship should undock to - moved further away from the sun\n        this.undockLocation = new THREE.Vector3(0, 10000, 0); // Middle of the stargate\n        \n        console.log(\"Creating spaceship...\");\n        this.createSpaceship();\n        this.createTrailEffect();\n        \n        // Start the ship invisible since it's docked\n        if (this.mesh) {\n            this.mesh.visible = false;\n        }\n        \n        console.log(\"Spaceship created successfully (docked state)\");\n    }\n    \n    // Methods for updating spaceship state in game loop\n    update(deltaTime) {\n        // Update any continuous effects or animations\n        if (this.updateParticles && !this.isDocked) {\n            this.updateParticles();\n        }\n    }\n    \n    createSpaceship() {\n        // Create spaceship group\n        this.mesh = new THREE.Group();\n        \n        // Scale the entire ship\n        this.mesh.scale.set(this.shipScale, this.shipScale, this.shipScale);\n        \n        // Set initial position to a safe location far from the sun\n        this.mesh.position.set(0, 2000, 0); // Position near stargate initially\n        \n        // Create the main body of the ship - sleek aerodynamic design using basic geometries\n        // Use a cylinder with a cone at the front instead of CapsuleGeometry\n        const bodyGroup = new THREE.Group();\n        \n        // Main hull cylinder\n        const cylinderGeometry = new THREE.CylinderGeometry(0.4, 0.5, 1.8, 12);\n        const bodyMaterial = new THREE.MeshPhongMaterial({ \n            color: 0xFFFFFF, // White base\n            specular: 0xFFD700, // Gold specular highlights\n            shininess: 100,\n            emissive: 0x222222,\n            emissiveIntensity: 0.1\n        });\n        \n        const bodyCylinder = new THREE.Mesh(cylinderGeometry, bodyMaterial);\n        bodyCylinder.rotation.x = Math.PI / 2; // Rotate to point forward\n        bodyGroup.add(bodyCylinder);\n        \n        // Front nose cone\n        const noseGeometry = new THREE.ConeGeometry(0.4, 0.8, 12);\n        const noseCone = new THREE.Mesh(noseGeometry, bodyMaterial);\n        noseCone.position.set(0, 0, -1.2);\n        noseCone.rotation.x = -Math.PI / 2; // Point forward\n        bodyGroup.add(noseCone);\n        \n        // Add the complete body to the ship\n        this.mesh.add(bodyGroup);\n        \n        // Add cockpit - glass dome\n        const cockpitGeometry = new THREE.SphereGeometry(0.35, 16, 16, 0, Math.PI * 2, 0, Math.PI / 2);\n        const cockpitMaterial = new THREE.MeshPhongMaterial({ \n            color: 0x88CCFF,\n            specular: 0xFFFFFF,\n            shininess: 100,\n            transparent: true,\n            opacity: 0.7,\n            emissive: 0x0066FF,\n            emissiveIntensity: 0.1\n        });\n        const cockpit = new THREE.Mesh(cockpitGeometry, cockpitMaterial);\n        cockpit.position.set(0, 0.25, -0.2);\n        cockpit.rotation.x = -Math.PI / 2;\n        this.mesh.add(cockpit);\n        \n        // Add dual front cannons\n        const cannonGeometry = new THREE.CylinderGeometry(0.08, 0.06, 2.0, 8);\n        const cannonMaterial = new THREE.MeshPhongMaterial({ \n            color: 0xFFD700, // Gold\n            specular: 0xFFFFFF,\n            shininess: 80,\n            emissive: 0xFFD700,\n            emissiveIntensity: 0.2\n        });\n        \n        // Left cannon\n        this.leftCannon = new THREE.Mesh(cannonGeometry, cannonMaterial);\n        this.leftCannon.position.set(0.2, 0, -1.5); // Left side of cockpit\n        this.leftCannon.rotation.x = Math.PI / 2; // Point forward\n        this.mesh.add(this.leftCannon);\n        \n        // Right cannon\n        this.rightCannon = new THREE.Mesh(cannonGeometry, cannonMaterial);\n        this.rightCannon.position.set(-0.2, 0, -1.5); // Right side of cockpit\n        this.rightCannon.rotation.x = Math.PI / 2; // Point forward\n        this.mesh.add(this.rightCannon);\n        \n        // Add cannon emitters (glowing tips)\n        const emitterGeometry = new THREE.SphereGeometry(0.08, 16, 16);\n        const emitterMaterial = new THREE.MeshPhongMaterial({ \n            color: 0xFF6600,\n            emissive: 0xFF3300,\n            emissiveIntensity: 1\n        });\n        \n        // Left emitter\n        this.leftEmitter = new THREE.Mesh(emitterGeometry, emitterMaterial);\n        this.leftEmitter.position.set(0.2, 0, -2.5); // Front of left cannon\n        this.mesh.add(this.leftEmitter);\n        \n        // Right emitter\n        this.rightEmitter = new THREE.Mesh(emitterGeometry, emitterMaterial);\n        this.rightEmitter.position.set(-0.2, 0, -2.5); // Front of right cannon\n        this.mesh.add(this.rightEmitter);\n        \n        // Create mining laser emitter (use one of the cannons for mining)\n        this.miningLaser = this.leftEmitter;\n        \n        // Add curved wings - using custom shape for curves\n        const createCurvedWing = (isLeft) => {\n            const wingGroup = new THREE.Group();\n            \n            // Create curved wing shape using multiple segments\n            const wingMaterial = new THREE.MeshPhongMaterial({ \n                color: 0xFFFFFF, // White\n                specular: 0xFFD700, // Gold specular \n                shininess: 80,\n                emissive: 0xFFFFFF,\n                emissiveIntensity: 0.1\n            });\n            \n            // Wing base connecting to ship body\n            const wingBaseGeom = new THREE.BoxGeometry(0.1, 0.2, 0.6);\n            const wingBase = new THREE.Mesh(wingBaseGeom, wingMaterial);\n            wingBase.position.set(isLeft ? 0.55 : -0.55, 0, 0.2);\n            wingGroup.add(wingBase);\n            \n            // Curved part of wing - using custom curved mesh\n            const wingCurveGeom = new THREE.BoxGeometry(0.8, 0.1, 0.5);\n            const wingCurve = new THREE.Mesh(wingCurveGeom, wingMaterial);\n            \n            // Rotate and position to create curved wing effect\n            wingCurve.position.set(isLeft ? 1 : -1, 0, 0.2);\n            wingCurve.rotation.z = isLeft ? Math.PI / 8 : -Math.PI / 8;\n            wingGroup.add(wingCurve);\n            \n            // Wing tip with gold accent\n            const wingTipGeom = new THREE.BoxGeometry(0.3, 0.08, 0.3);\n            const goldMaterial = new THREE.MeshPhongMaterial({ \n                color: 0xFFD700, // Gold\n                specular: 0xFFFFFF, \n                shininess: 100,\n                emissive: 0xFFD700,\n                emissiveIntensity: 0.3\n            });\n            \n            const wingTip = new THREE.Mesh(wingTipGeom, goldMaterial);\n            wingTip.position.set(isLeft ? 1.4 : -1.4, 0, 0.2);\n            wingTip.rotation.z = isLeft ? Math.PI / 6 : -Math.PI / 6;\n            wingGroup.add(wingTip);\n            \n            return wingGroup;\n        };\n        \n        // Add wings to ship\n        const leftWing = createCurvedWing(true);\n        this.mesh.add(leftWing);\n        \n        const rightWing = createCurvedWing(false);\n        this.mesh.add(rightWing);\n        \n        // Add gold accents to body\n        const addGoldAccent = (width, height, depth, x, y, z, rotX = 0, rotY = 0, rotZ = 0) => {\n            const accentGeom = new THREE.BoxGeometry(width, height, depth);\n            const goldMaterial = new THREE.MeshPhongMaterial({ \n                color: 0xFFD700, // Gold\n                specular: 0xFFFFFF,\n                shininess: 100,\n                emissive: 0xFFD700,\n                emissiveIntensity: 0.3\n            });\n            \n            const accent = new THREE.Mesh(accentGeom, goldMaterial);\n            accent.position.set(x, y, z);\n            accent.rotation.set(rotX, rotY, rotZ);\n            this.mesh.add(accent);\n            return accent;\n        };\n        \n        // Add gold accents along the body\n        addGoldAccent(0.8, 0.05, 0.1, 0, -0.25, -0.3);\n        addGoldAccent(0.8, 0.05, 0.1, 0, -0.25, 0.3);\n        addGoldAccent(0.05, 0.05, 1.0, 0.3, -0.25, 0);\n        addGoldAccent(0.05, 0.05, 1.0, -0.3, -0.25, 0);\n        \n        // Add thrusters\n        const thrusterGeometry = new THREE.CylinderGeometry(0.2, 0.15, 0.5, 8);\n        const thrusterMaterial = new THREE.MeshPhongMaterial({ \n            color: 0xFFD700, // Gold\n            emissive: 0xFF5500,\n            emissiveIntensity: 0.5\n        });\n        \n        // Main thrusters (back)\n        const mainThruster = new THREE.Mesh(thrusterGeometry, thrusterMaterial);\n        mainThruster.position.z = 1.2; // Position at the back of the ship\n        mainThruster.rotation.x = Math.PI; // Point backward\n        this.mesh.add(mainThruster);\n        this.thrusters.push({ mesh: mainThruster, type: 'main' });\n        \n        // Front/Reverse thruster (new)\n        const reverseThruster = new THREE.Mesh(thrusterGeometry.clone(), thrusterMaterial.clone());\n        reverseThruster.position.z = -1.0; // Position at the front of the ship\n        reverseThruster.rotation.x = 0; // Point forward\n        reverseThruster.scale.set(0.6, 0.6, 0.6); // Make it slightly smaller than main thruster\n        this.mesh.add(reverseThruster);\n        this.thrusters.push({ mesh: reverseThruster, type: 'reverse' });\n        \n        // Side thrusters for lateral movement\n        const leftThruster = new THREE.Mesh(thrusterGeometry.clone(), thrusterMaterial.clone());\n        leftThruster.position.set(0.5, 0, 0.5);\n        leftThruster.rotation.z = Math.PI / 2; // Point to the right (for leftward thrust)\n        leftThruster.scale.set(0.5, 0.5, 0.5); // Make side thrusters smaller\n        this.mesh.add(leftThruster);\n        this.thrusters.push({ mesh: leftThruster, type: 'left' });\n        \n        const rightThruster = new THREE.Mesh(thrusterGeometry.clone(), thrusterMaterial.clone());\n        rightThruster.position.set(-0.5, 0, 0.5);\n        rightThruster.rotation.z = -Math.PI / 2; // Point to the left (for rightward thrust)\n        rightThruster.scale.set(0.5, 0.5, 0.5); // Make side thrusters smaller\n        this.mesh.add(rightThruster);\n        this.thrusters.push({ mesh: rightThruster, type: 'right' });\n        \n        // Add to scene\n        this.scene.add(this.mesh);\n        \n        // Create particle systems for thrusters\n        this.createThrusterParticles();\n    }\n    \n    // Create mining laser beam - the actual beam is handled by the Controls class\n    activateMiningLaser() {\n        // Activate both emitters for a more powerful effect\n        if (this.leftEmitter && this.rightEmitter) {\n            // Left emitter\n            this.leftEmitter.material.emissiveIntensity = 1.5;\n            this.leftEmitter.scale.set(1.2, 1.2, 1.2);\n            \n            // Right emitter\n            this.rightEmitter.material.emissiveIntensity = 1.5;\n            this.rightEmitter.scale.set(1.2, 1.2, 1.2);\n        }\n    }\n    \n    deactivateMiningLaser() {\n        // Deactivate both emitters\n        if (this.leftEmitter && this.rightEmitter) {\n            // Left emitter\n            this.leftEmitter.material.emissiveIntensity = 1;\n            this.leftEmitter.scale.set(1, 1, 1);\n            \n            // Right emitter\n            this.rightEmitter.material.emissiveIntensity = 1;\n            this.rightEmitter.scale.set(1, 1, 1);\n        }\n    }\n    \n    createThrusterParticles() {\n        // Main thruster particles\n        const particleCount = 150; // Reduced from 200\n        \n        // Function to create a particle system\n        const createParticleSystem = (position, rotation, size, type, color = 0xff5500) => {\n            const positions = new Float32Array(particleCount * 3);\n            \n            for (let i = 0; i < particleCount; i++) {\n                const i3 = i * 3;\n                positions[i3] = (Math.random() - 0.5) * size.x * 0.7; // Reduced spread by 30%\n                positions[i3 + 1] = (Math.random() - 0.5) * size.y * 0.7; // Reduced spread by 30%\n                positions[i3 + 2] = Math.random() * size.z * 0.7; // Reduced length by 30%\n            }\n            \n            const geometry = new THREE.BufferGeometry();\n            geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));\n            \n            const material = new THREE.PointsMaterial({\n                color: color,\n                size: 0.04, // Reduced from 0.06\n                transparent: true,\n                opacity: 0.6, // Reduced from 0.9\n                blending: THREE.AdditiveBlending\n            });\n            \n            const particleSystem = new THREE.Points(geometry, material);\n            particleSystem.visible = false; // Initially invisible\n            particleSystem.position.copy(position);\n            if (rotation) particleSystem.rotation.copy(rotation);\n            this.mesh.add(particleSystem);\n            \n            return {\n                system: particleSystem,\n                geometry: geometry,\n                positions: positions,\n                type: type,\n                baseSize: size\n            };\n        };\n        \n        // Main thruster (back)\n        this.particleSystems.push(\n            createParticleSystem(\n                new THREE.Vector3(0, 0, 1.1), // Position\n                new THREE.Euler(Math.PI, 0, 0), // Rotation\n                new THREE.Vector3(0.15, 0.15, 2), // Size - reduced from 0.2x0.2x3\n                'main',\n                0xff4400 // Darker color than before\n            )\n        );\n        \n        // Left thruster\n        this.particleSystems.push(\n            createParticleSystem(\n                new THREE.Vector3(0.5, 0, 0.5), // Position\n                new THREE.Euler(0, 0, Math.PI / 2), // Rotation\n                new THREE.Vector3(0.08, 0.08, 0.8), // Size - reduced from 0.1x0.1x1.2\n                'left',\n                0xff3300 // Darker color\n            )\n        );\n        \n        // Right thruster\n        this.particleSystems.push(\n            createParticleSystem(\n                new THREE.Vector3(-0.5, 0, 0.5), // Position\n                new THREE.Euler(0, 0, -Math.PI / 2), // Rotation\n                new THREE.Vector3(0.08, 0.08, 0.8), // Size - reduced from 0.1x0.1x1.2\n                'right',\n                0xff3300 // Darker color\n            )\n        );\n        \n        // Reverse thruster (front)\n        this.particleSystems.push(\n            createParticleSystem(\n                new THREE.Vector3(0, 0, -1.1), // Position\n                new THREE.Euler(0, 0, 0), // Rotation\n                new THREE.Vector3(0.15, 0.15, 1.4), // Size - reduced from 0.2x0.2x2\n                'reverse',\n                0x44ccff // Darker blue-cyan color\n            )\n        );\n    }\n    \n    createTrailEffect() {\n        // Create particle system for the ship's trail - cypherpunk style\n        const particleCount = 1800; // Reduced slightly\n        const particles = new THREE.BufferGeometry();\n        \n        // Create positions for particles\n        const positions = new Float32Array(particleCount * 3);\n        const velocities = new Float32Array(particleCount * 3);\n        const colors = new Float32Array(particleCount * 3);\n        const sizes = new Float32Array(particleCount);\n        \n        // Initial positions - cypherpunk style with more angular distribution\n        for (let i = 0; i < particleCount; i++) {\n            const i3 = i * 3;\n            \n            // Angular, grid-like positioning for cypherpunk aesthetic\n            positions[i3] = (Math.floor((Math.random() - 0.5) * 10) / 10) * 0.4; // Grid-like X distribution\n            positions[i3 + 1] = (Math.floor((Math.random() - 0.5) * 10) / 10) * 0.4; // Grid-like Y distribution\n            positions[i3 + 2] = 1.8 + (Math.random() * 0.4); // Z position with less randomness\n            \n            // More consistent velocities for straight, digital-looking trails\n            velocities[i3] = (Math.random() - 0.5) * 0.008; // Reduced randomness\n            velocities[i3 + 1] = (Math.random() - 0.5) * 0.008;\n            velocities[i3 + 2] = 0.12 + (Math.random() * 0.05); // More consistent speed\n            \n            // Cypherpunk colors - neon blues, purples, and teals\n            // Assign one of three color schemes randomly for variety\n            const colorScheme = Math.floor(Math.random() * 3);\n            if (colorScheme === 0) {\n                // Neon blue/cyan\n                colors[i3] = 0.0;\n                colors[i3 + 1] = 0.7 + Math.random() * 0.3;\n                colors[i3 + 2] = 0.8 + Math.random() * 0.2;\n            } else if (colorScheme === 1) {\n                // Neon purple/magenta\n                colors[i3] = 0.7 + Math.random() * 0.3;\n                colors[i3 + 1] = 0.0;\n                colors[i3 + 2] = 0.8 + Math.random() * 0.2;\n            } else {\n                // Electric green\n                colors[i3] = 0.0;\n                colors[i3 + 1] = 0.9 + Math.random() * 0.1;\n                colors[i3 + 2] = 0.4 + Math.random() * 0.2;\n            }\n            \n            // Random variation between small angular particles and larger ones\n            sizes[i] = Math.random() < 0.7 ? \n                0.8 + Math.random() * 0.4 : // Small particles\n                1.5 + Math.random() * 0.5;  // Occasional larger particles\n        }\n        \n        particles.setAttribute('position', new THREE.BufferAttribute(positions, 3));\n        particles.setAttribute('customColor', new THREE.BufferAttribute(colors, 3));\n        particles.setAttribute('size', new THREE.BufferAttribute(sizes, 1));\n        \n        // Trail particle shader material - cypherpunk style with angular particles\n        const trailMaterial = new THREE.ShaderMaterial({\n            uniforms: {\n                color: { value: new THREE.Color(0x00ffff) }, // Base cyan color\n                pointTexture: { value: new THREE.TextureLoader().load('https://threejs.org/examples/textures/sprites/spark1.png') } // Using spark texture instead of disc\n            },\n            vertexShader: `\n                attribute float size;\n                attribute vec3 customColor;\n                varying vec3 vColor;\n                void main() {\n                    vColor = customColor;\n                    vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n                    \n                    // Add slight \"digital jitter\" to the position for glitch effect\n                    if (mod(mvPosition.y * 10.0, 4.0) < 0.1) {\n                        mvPosition.x += sin(mvPosition.z) * 0.05;\n                    }\n                    \n                    gl_PointSize = size * (180.0 / -mvPosition.z); // Adjusted size calculation\n                    gl_Position = projectionMatrix * mvPosition;\n                }\n            `,\n            fragmentShader: `\n                uniform vec3 color;\n                uniform sampler2D pointTexture;\n                varying vec3 vColor;\n                void main() {\n                    // Create more angular particles by manipulating texture coordinates\n                    vec2 uv = gl_PointCoord;\n                    \n                    // Digital distortion effect - occasional \"glitch\" lines\n                    if (mod(gl_FragCoord.y, 16.0) < 0.5) {\n                        uv.x = mod(uv.x + sin(uv.y * 10.0) * 0.1, 1.0);\n                    }\n                    \n                    // Apply texture with the modified coordinates\n                    vec4 texColor = texture2D(pointTexture, uv);\n                    \n                    // Sharper edges for angular look\n                    texColor.a = step(0.2, texColor.r);\n                    \n                    // Combine with color\n                    gl_FragColor = vec4(color * vColor, 0.75) * texColor;\n                    \n                    // Hard cutoff for sharper particle edges\n                    if (gl_FragColor.a < 0.2) discard;\n                }\n            `,\n            blending: THREE.AdditiveBlending,\n            depthTest: false,\n            transparent: true\n        });\n        \n        // Add after creating the material\n        trailMaterial.uniforms.pointTexture.value.colorSpace = THREE.SRGBColorSpace;\n        \n        this.trailParticles = new THREE.Points(particles, trailMaterial);\n        this.trailParticles.visible = false; // Only visible when moving\n        this.mesh.add(this.trailParticles);\n        \n        // Store data for updating\n        this.trailParticles.userData = {\n            positions: positions,\n            velocities: velocities,\n            colors: colors\n        };\n    }\n    \n    updateParticles() {\n        if (!this.particleSystems) return;\n        \n        this.particleSystems.forEach(ps => {\n            if (ps.system.visible) {\n                const positions = ps.positions;\n                const baseSize = ps.baseSize;\n                \n                for (let i = 0; i < positions.length; i += 3) {\n                    // Move particle outward along z-axis of particle system\n                    positions[i] += (Math.random() - 0.5) * 0.02; // More randomness\n                    positions[i + 1] += (Math.random() - 0.5) * 0.02;\n                    positions[i + 2] += 0.15; // Faster speed outward for more dynamic effect\n                    \n                    // Add some randomness to particle movement\n                    positions[i] += (Math.random() - 0.5) * 0.01;\n                    positions[i + 1] += (Math.random() - 0.5) * 0.01;\n                    \n                    // Reset particles that go too far\n                    if (positions[i + 2] > baseSize.z) {\n                        positions[i] = (Math.random() - 0.5) * baseSize.x;\n                        positions[i + 1] = (Math.random() - 0.5) * baseSize.y;\n                        positions[i + 2] = 0;\n                    }\n                }\n                \n                // Update the geometry\n                ps.geometry.attributes.position.needsUpdate = true;\n            }\n        });\n        \n        // Update trail particles with cypherpunk effects\n        if (this.trailParticles && this.trailParticles.visible) {\n            const positions = this.trailParticles.userData.positions;\n            const velocities = this.trailParticles.userData.velocities;\n            const colors = this.trailParticles.userData.colors;\n            \n            // Calculate a trail speed factor based on current velocity\n            const speedFactor = this.velocity.length() / 8;\n            \n            for (let i = 0; i < positions.length; i += 3) {\n                // Add digital \"glitch\" effect occasionally\n                if (Math.random() < 0.01) {\n                    // Sudden position jump to simulate digital glitch\n                    positions[i] += (Math.random() - 0.5) * 0.2;\n                    positions[i + 1] += (Math.random() - 0.5) * 0.2;\n                }\n                \n                // Move particles based on velocity, with occasional \"stutter\" for digital effect\n                const stutter = Math.random() < 0.05 ? 0 : 1; // Occasionally freeze particle\n                positions[i] += velocities[i] * speedFactor * stutter;\n                positions[i + 1] += velocities[i + 1] * speedFactor * stutter;\n                positions[i + 2] += velocities[i + 2] * speedFactor * stutter;\n                \n                // Digital color shift - occasional color changes for glitch effect\n                if (Math.random() < 0.005) {\n                    // Sudden color swap\n                    const temp = colors[i];\n                    colors[i] = colors[i + 2];\n                    colors[i + 2] = temp;\n                }\n                \n                // Slower fade for digital persistence effect\n                colors[i] *= 0.99;\n                colors[i + 1] *= 0.99;\n                colors[i + 2] *= 0.99;\n                \n                // Reset particles that go too far or fade out\n                // Increased distance threshold for longer trails\n                const distance = Math.sqrt(\n                    positions[i] * positions[i] + \n                    positions[i + 1] * positions[i + 1] + \n                    positions[i + 2] * positions[i + 2]\n                );\n                \n                if (distance > 45 || colors[i] + colors[i+1] + colors[i+2] < 0.3) {\n                    // Reset position with grid-like distribution for cypherpunk aesthetic\n                    positions[i] = (Math.floor((Math.random() - 0.5) * 10) / 10) * 0.4;\n                    positions[i + 1] = (Math.floor((Math.random() - 0.5) * 10) / 10) * 0.4;\n                    positions[i + 2] = 1.8 + (Math.random() * 0.4);\n                    \n                    // Reset velocity - digital precision\n                    velocities[i] = (Math.random() - 0.5) * 0.008;\n                    velocities[i + 1] = (Math.random() - 0.5) * 0.008;\n                    velocities[i + 2] = 0.12 + (Math.random() * 0.05);\n                    \n                    // Reset with cypherpunk colors - rotating between schemes\n                    const colorScheme = Math.floor(Math.random() * 3);\n                    if (colorScheme === 0) {\n                        // Neon blue/cyan\n                        colors[i] = 0.0;\n                        colors[i + 1] = 0.7 + Math.random() * 0.3;\n                        colors[i + 2] = 0.8 + Math.random() * 0.2;\n                    } else if (colorScheme === 1) {\n                        // Neon purple/magenta\n                        colors[i] = 0.7 + Math.random() * 0.3;\n                        colors[i + 1] = 0.0;\n                        colors[i + 2] = 0.8 + Math.random() * 0.2;\n                    } else {\n                        // Electric green\n                        colors[i] = 0.0;\n                        colors[i + 1] = 0.9 + Math.random() * 0.1;\n                        colors[i + 2] = 0.4 + Math.random() * 0.2;\n                    }\n                }\n            }\n            \n            // Update the geometry\n            this.trailParticles.geometry.attributes.position.needsUpdate = true;\n            this.trailParticles.geometry.attributes.customColor.needsUpdate = true;\n        }\n    }\n\n    dock() {\n        console.log(\"Docking spaceship\");\n        console.log(\"Spaceship values before docking:\", {\n            shield: this.shield,\n            maxShield: this.maxShield,\n            hull: this.hull,\n            maxHull: this.maxHull,\n            isDocked: this.isDocked\n        });\n        \n        this.isDocked = true;\n        this.velocity.set(0, 0, 0);\n        this.mesh.visible = false;\n        \n        console.log(\"Spaceship values after docking:\", {\n            shield: this.shield,\n            maxShield: this.maxShield,\n            hull: this.hull,\n            maxHull: this.maxHull,\n            isDocked: this.isDocked\n        });\n    }\n\n    undock() {\n        console.log(\"Undocking spaceship\");\n        console.log(\"Spaceship values before undocking:\", {\n            shield: this.shield,\n            maxShield: this.maxShield,\n            hull: this.hull,\n            maxHull: this.maxHull,\n            isDocked: this.isDocked\n        });\n        \n        // Store shield value before undocking to diagnose reset issue\n        const shieldBeforeUndock = this.shield;\n        \n        this.isDocked = false;\n        this.mesh.visible = true;\n        \n        // Check if shield was reset and restore it\n        if (this.shield !== shieldBeforeUndock) {\n            console.log(`SHIELD RESET DETECTED during undock! Value changed from ${shieldBeforeUndock} to ${this.shield}`);\n            console.log(\"Restoring shield value to:\", shieldBeforeUndock);\n            this.shield = shieldBeforeUndock;\n        }\n        \n        console.log(\"Spaceship values after undocking:\", {\n            shield: this.shield,\n            maxShield: this.maxShield,\n            hull: this.hull,\n            maxHull: this.maxHull,\n            isDocked: this.isDocked\n        });\n        \n        // When undocking, attempt to sync shield and hull values to the HealthComponent\n        this.syncValuesToHealthComponent();\n        \n        // If an undock location is specified, use that instead\n        if (this.undockLocation) {\n            this.mesh.position.copy(this.undockLocation);\n            \n            // Point away from the stargate (down toward sun)\n            this.mesh.rotation.set(Math.PI/2, 0, 0);\n        } else {\n            // Original behavior - position just outside the docking bay\n            const stargatePosition = this.scene.getObjectByName('stargate').position.clone();\n            stargatePosition.z += 550; // Move in front of the docking bay\n            this.mesh.position.copy(stargatePosition);\n            \n            // Reset rotation to face away from the stargate\n            this.mesh.rotation.set(0, Math.PI, 0);\n        }\n        \n        this.velocity.set(0, 0, 0); // This line resets velocity, but it's fine since we're undocking\n        \n        return this.mesh.position.clone();\n    }\n\n    refuel() {\n        console.log(\"Refueling spaceship\");\n        this.fuel = this.maxFuel;\n        return 100; // Cost of refueling\n    }\n\n    repairShield() {\n        const oldShield = this.shield;\n        console.log(`===== SHIELD REPAIR INITIATED =====`);\n        console.log(`Repairing shield: ${oldShield} → ${this.maxShield}`);\n        \n        // CRITICAL FIX: Set and verify shield repair\n        this.shield = this.maxShield;\n        console.log(`Shield value is now: ${this.shield} (Expected: ${this.maxShield})`);\n        \n        // Log full spaceship state for debugging\n        console.log(\"Full spaceship state after shield repair:\", {\n            shield: this.shield,\n            maxShield: this.maxShield,\n            hull: this.hull,\n            maxHull: this.maxHull,\n            fuel: this.fuel,\n            maxFuel: this.maxFuel\n        });\n        console.log(`===== SHIELD REPAIR COMPLETED =====`);\n        \n        // Sync the updated shield value to the player entity's HealthComponent\n        // Use direct entity access for more reliable syncing\n        if (window.game && window.game.world) {\n            try {\n                const players = window.game.world.getEntitiesByTag('player');\n                if (players && players.length > 0) {\n                    const health = players[0].getComponent('HealthComponent');\n                    if (health) {\n                        // Update shield directly on the component\n                        const oldHealthShield = health.shield;\n                        health.shield = this.shield;\n                        console.log(`Direct shield update on HealthComponent: ${oldHealthShield} → ${health.shield}`);\n                    }\n                }\n            } catch (e) {\n                console.error(\"Error during direct HealthComponent update:\", e);\n            }\n        }\n        \n        // Also use the normal sync method\n        this.syncValuesToHealthComponent();\n        \n        return 150; // Cost of shield repair\n    }\n\n    repairHull() {\n        const oldHull = this.hull;\n        console.log(`===== HULL REPAIR INITIATED =====`);\n        console.log(`Repairing hull: ${oldHull} → ${this.maxHull}`);\n        \n        // CRITICAL FIX: Set and verify hull repair\n        this.hull = this.maxHull;\n        console.log(`Hull value is now: ${this.hull} (Expected: ${this.maxHull})`);\n        \n        // Log full spaceship state for debugging\n        console.log(\"Full spaceship state after hull repair:\", {\n            shield: this.shield,\n            maxShield: this.maxShield,\n            hull: this.hull,\n            maxHull: this.maxHull,\n            fuel: this.fuel,\n            maxFuel: this.maxFuel\n        });\n        console.log(`===== HULL REPAIR COMPLETED =====`);\n        \n        // Sync the updated hull value to the player entity's HealthComponent\n        // Use direct entity access for more reliable syncing\n        if (window.game && window.game.world) {\n            try {\n                const players = window.game.world.getEntitiesByTag('player');\n                if (players && players.length > 0) {\n                    const health = players[0].getComponent('HealthComponent');\n                    if (health) {\n                        // Update hull directly on the component\n                        const oldHealthHull = health.health;\n                        health.health = this.hull;\n                        console.log(`Direct hull update on HealthComponent: ${oldHealthHull} → ${health.health}`);\n                    }\n                }\n            } catch (e) {\n                console.error(\"Error during direct HealthComponent update:\", e);\n            }\n        }\n        \n        // Also use the normal sync method\n        this.syncValuesToHealthComponent();\n        \n        return 200; // Cost of hull repair\n    }\n\n    consumeFuel() {\n        // Consume fuel when thrusting\n        if (this.thrust.forward || this.thrust.backward || this.thrust.left || this.thrust.right) {\n            let consumptionRate = this.fuelConsumptionRate;\n            \n            // Extra consumption when boosting\n            if (this.thrust.boost) {\n                consumptionRate *= 3;\n            }\n            \n            this.fuel = Math.max(0, this.fuel - consumptionRate);\n        }\n        \n        // Return true if we have fuel, false if empty\n        return this.fuel > 0;\n    }\n\n    // Add a new method for upgrading the fuel tank\n    upgradeFuelTank() {\n        console.log(\"Upgrading fuel tank\");\n        \n        // Double the fuel capacity\n        this.maxFuel *= 2;\n        \n        // Increase the fuel level to match the new capacity\n        this.fuel = this.maxFuel;\n        \n        // Increase the upgrade level\n        this.fuelTankLevel++;\n        \n        // Calculate the new upgrade cost (4x the previous cost)\n        this.fuelUpgradeCost *= 4;\n        \n        return this.maxFuel;\n    }\n    \n    // New method for upgrading engines\n    upgradeEngine() {\n        console.log(\"Upgrading engines\");\n        \n        // Increase max velocity by 25%\n        this.maxVelocity *= 1.25;\n        \n        // Upgrade visual appearance of thrusters\n        this.thrusters.forEach(thruster => {\n            if (thruster.mesh && thruster.mesh.material) {\n                // Make thrusters more intense with each upgrade\n                thruster.mesh.material.emissiveIntensity += 0.2;\n                \n                // Change thruster color slightly with each upgrade to show progression\n                if (this.engineLevel % 2 === 0) { // Every even level\n                    thruster.mesh.material.emissive.setHex(0xff8800); // More orange\n                } else {\n                    thruster.mesh.material.emissive.setHex(0xffaa00); // More yellow\n                }\n            }\n        });\n        \n        // Increase the upgrade level\n        this.engineLevel++;\n        \n        // Calculate the new upgrade cost (2.5x the previous cost)\n        this.engineUpgradeCost = Math.floor(this.engineUpgradeCost * 2.5);\n        \n        return this.maxVelocity;\n    }\n    \n    // New method for upgrading mining laser\n    upgradeMiningLaser() {\n        console.log(\"Upgrading mining laser\");\n        \n        // Increase mining efficiency by 30%\n        this.miningEfficiency *= 1.3;\n        \n        // Upgrade visual appearance of mining laser emitters\n        if (this.leftEmitter && this.leftEmitter.material) {\n            // Increase the size of the left emitter\n            this.leftEmitter.scale.set(1.1, 1.1, 1.1);\n            \n            // Change the color based on level to show progression\n            const colors = [0xff0000, 0xff5500, 0xff9900, 0xffcc00, 0xffee00];\n            if (this.miningLevel < colors.length) {\n                this.leftEmitter.material.color.setHex(colors[this.miningLevel]);\n                this.leftEmitter.material.emissive.setHex(colors[this.miningLevel]);\n            }\n            \n            // Increase the emissive intensity\n            this.leftEmitter.material.emissiveIntensity += 0.2;\n        }\n        \n        // Also upgrade the right emitter to match\n        if (this.rightEmitter && this.rightEmitter.material) {\n            // Increase the size of the right emitter\n            this.rightEmitter.scale.set(1.1, 1.1, 1.1);\n            \n            // Change the color based on level to show progression\n            const colors = [0xff0000, 0xff5500, 0xff9900, 0xffcc00, 0xffee00];\n            if (this.miningLevel < colors.length) {\n                this.rightEmitter.material.color.setHex(colors[this.miningLevel]);\n                this.rightEmitter.material.emissive.setHex(colors[this.miningLevel]);\n            }\n            \n            // Increase the emissive intensity\n            this.rightEmitter.material.emissiveIntensity += 0.2;\n        }\n        \n        // Also update the cannons\n        if (this.leftCannon && this.leftCannon.material) {\n            // Make the cannons thicker with each upgrade\n            this.leftCannon.scale.x *= 1.1;\n            this.leftCannon.scale.y *= 1.1;\n        }\n        \n        if (this.rightCannon && this.rightCannon.material) {\n            // Make the cannons thicker with each upgrade\n            this.rightCannon.scale.x *= 1.1;\n            this.rightCannon.scale.y *= 1.1;\n        }\n        \n        // Increase the upgrade level\n        this.miningLevel++;\n        \n        // Calculate the new upgrade cost (3x the previous cost)\n        this.miningUpgradeCost = Math.floor(this.miningUpgradeCost * 3);\n        \n        return this.miningEfficiency;\n    }\n    \n    // New method for upgrading hull\n    upgradeHull() {\n        console.log(\"Upgrading hull\");\n        \n        // Increase collision resistance by 25%\n        this.collisionResistance *= 1.25;\n        \n        // Modify ship appearance to show hull upgrade\n        const bodyGroup = this.mesh.children.find(child => child instanceof THREE.Group);\n        \n        if (bodyGroup && bodyGroup.children) {\n            // Update both the cylinder and cone parts of the ship body\n            bodyGroup.children.forEach(part => {\n                if (part instanceof THREE.Mesh && part.material) {\n                    // Change the hull color slightly to indicate higher grade material\n                    if (this.hullLevel % 2 === 0) {\n                        // Even levels: more blue tint\n                        part.material.color.setHex(0x30c0d0);\n                    } else {\n                        // Odd levels: more green tint\n                        part.material.color.setHex(0x30d0c0);\n                    }\n                    \n                    // Increase shininess with each level to suggest better armor\n                    part.material.shininess += 10;\n                }\n            });\n        }\n        \n        // Increase the upgrade level\n        this.hullLevel++;\n        \n        // Calculate the new upgrade cost (2x the previous cost)\n        this.hullUpgradeCost = Math.floor(this.hullUpgradeCost * 2);\n        \n        return this.collisionResistance;\n    }\n    \n    // New method for upgrading scanner\n    upgradeScanner() {\n        console.log(\"Upgrading scanner\");\n        \n        // Increase scanner range by 20%\n        this.scanRange *= 1.2;\n        \n        // Add visual indicator for scanner upgrade (could add scan dish or antenna)\n        // This is a simplified version - in a real implementation, you'd want to\n        // add actual mesh components to the ship\n        \n        // Increase the upgrade level\n        this.scannerLevel++;\n        \n        // Calculate the new upgrade cost (1.8x the previous cost)\n        this.scannerUpgradeCost = Math.floor(this.scannerUpgradeCost * 1.8);\n        \n        return this.scanRange;\n    }\n\n    updateTrailVisibility(isMoving) {\n        // Show trail particles when the ship is moving, not just when thrusting forward\n        if (this.trailParticles) {\n            this.trailParticles.visible = isMoving;\n        }\n    }\n    \n    /**\n     * Subscribe to player entity destruction events\n     * @param {MessageBus} messageBus The game's message bus\n     */\n    subscribeToDestructionEvents(messageBus) {\n        if (!messageBus) return;\n        \n        messageBus.subscribe('entity.destroyed', (message) => {\n            const entity = message.data.entity;\n            \n            // Check if this is the player entity\n            if (entity && entity.hasTag && entity.hasTag('player')) {\n                console.log(\"Player entity destroyed - updating spaceship state\");\n                this.isDestroyed = true;\n                \n                // Update hull and shield values from the player entity if available\n                const healthComponent = entity.getComponent('HealthComponent');\n                if (healthComponent) {\n                    this.hull = healthComponent.health;\n                    this.shield = healthComponent.shield;\n                } else {\n                    // If no health component, just set to 0\n                    this.hull = 0;\n                    this.shield = 0;\n                }\n                \n                // Make visual changes to show destroyed state\n                this.handleDestruction();\n            }\n        });\n        \n        console.log(\"Spaceship subscribed to destruction events\");\n    }\n    \n    /**\n     * Handle ship destruction effects\n     */\n    handleDestruction() {\n        // Visual and behavioral changes for destroyed state\n        if (this.mesh) {\n            // Disable thrusters\n            this.particleSystems.forEach(ps => {\n                if (ps && ps.system) {\n                    ps.system.visible = false;\n                }\n            });\n            \n            // Disable trail\n            if (this.trailParticles) {\n                this.trailParticles.visible = false;\n            }\n            \n            // Could add explosion effect, damage texture, etc.\n        }\n    }\n\n    // Method to sync hull and shield values to the player entity's HealthComponent\n    syncValuesToHealthComponent() {\n        console.log(\"Beginning shield and hull sync to HealthComponent\");\n        \n        console.log(\"Current spaceship values:\", {\n            shield: this.shield,\n            maxShield: this.maxShield,\n            hull: this.hull,\n            maxHull: this.maxHull\n        });\n        \n        // Store the values that need to be synced to the HealthComponent\n        const valuesForSync = {\n            shield: this.shield,\n            maxShield: this.maxShield,\n            hull: this.hull,\n            maxHull: this.maxHull\n        };\n        \n        console.log(`Preparing to sync values to player HealthComponent: Shield=${this.shield}, Hull=${this.hull}`);\n        \n        // Try using the MessageBus to broadcast the sync event\n        try {\n            if (window.game && window.game.messageBus) {\n                // Use the message bus to publish a sync event for any interested components\n                window.game.messageBus.publish('player.syncHealth', valuesForSync);\n                console.log(\"Published player.syncHealth event to game.messageBus with values:\", valuesForSync);\n            } else if (window.mainMessageBus) {\n                // Try using the global message bus\n                window.mainMessageBus.publish('player.syncHealth', valuesForSync);\n                console.log(\"Published player.syncHealth event to mainMessageBus with values:\", valuesForSync);\n            } else {\n                console.warn(\"No message bus available to sync health values\");\n            }\n        } catch (e) {\n            console.error(\"Error publishing sync event:\", e);\n        }\n        \n        // Also try direct access as a fallback\n        try {\n            if (window.game && window.game.world) {\n                const players = window.game.world.getEntitiesByTag('player');\n                console.log(`Found ${players ? players.length : 0} player entities for direct sync`);\n                \n                if (players && players.length > 0) {\n                    const player = players[0];\n                    const health = player.getComponent('HealthComponent');\n                    \n                    if (health) {\n                        // Log pre-sync state\n                        console.log(\"DIRECT SYNC - HealthComponent before sync:\", {\n                            shield: health.shield,\n                            maxShield: health.maxShield,\n                            health: health.health,\n                            maxHealth: health.maxHealth\n                        });\n                        \n                        console.log(\"DIRECT SYNC - Spaceship values to sync:\", {\n                            shield: this.shield,\n                            maxShield: this.maxShield,\n                            hull: this.hull,\n                            maxHull: this.maxHull\n                        });\n                        \n                        // Sync shield value\n                        const oldShield = health.shield;\n                        health.shield = this.shield;\n                        health.maxShield = this.maxShield;\n                        \n                        // Sync hull value\n                        const oldHealth = health.health;\n                        health.health = this.hull;\n                        health.maxHealth = this.maxHull;\n                        \n                        console.log(`Directly synced values to HealthComponent: Shield ${oldShield} → ${health.shield}, Hull ${oldHealth} → ${health.health}`);\n                        \n                        // Verify sync was successful\n                        console.log(\"DIRECT SYNC - HealthComponent after sync:\", {\n                            shield: health.shield,\n                            maxShield: health.maxShield,\n                            health: health.health,\n                            maxHealth: health.maxHealth\n                        });\n                    } else {\n                        console.warn(\"Player entity found but has no HealthComponent\");\n                    }\n                } else {\n                    console.warn(\"No player entities found for direct sync\");\n                }\n            }\n        } catch (e) {\n            console.error(\"Error directly syncing values to HealthComponent:\", e);\n        }\n    }\n} ","// physics.js - Handles physics calculations and movement\n\nimport * as THREE from 'three';\n\nexport class Physics {\n    // Physics constants - significantly increased for super-fast movement\n    static THRUST_FORCE = 0.5;      // 5x increase from previous 0.1\n    static BOOST_MULTIPLIER = 4;    // Keep the same boost multiplier\n    static MAX_VELOCITY = 25.0;     // Default maximum velocity (will use spaceship's value if available)\n    static ROTATION_SPEED = 0.3;    // Increased for more responsive controls\n    static COLLISION_DISTANCE = 15; // Reduced from 70 to match actual ship size\n    static FRICTION = 0.01;         // Small friction to help with control (new)\n    \n    constructor(scene) {\n        this.scene = scene;\n        this.spaceship = null; // Will be set later\n        this.camera = null; // Will be set later\n        \n        // Virtual rotation state for pointer lock\n        this.rotationState = {\n            x: 0,\n            y: 0\n        };\n        \n        // Collision state\n        this.collided = false;\n        \n        // For collision detection\n        this.raycaster = new THREE.Raycaster();\n        this.direction = new THREE.Vector3(0, 0, -1);\n        this.collisionDistance = Physics.COLLISION_DISTANCE; // Use the class constant for consistency\n    }\n    \n    // Set spaceship reference\n    setSpaceship(spaceship) {\n        this.spaceship = spaceship;\n    }\n    \n    // Set camera reference\n    setCamera(camera) {\n        this.camera = camera;\n    }\n    \n    update(deltaTime) {\n        if (!this.spaceship || this.spaceship.isDestroyed) return;\n        \n        // Check if ship is docked - skip physics if docked\n        if (this.spaceship.isDocked) return;\n        \n        // Skip physics updates if intro sequence is active\n        if (window.game && window.game.introSequenceActive) {\n            return;\n        }\n        \n        // Use a normalized deltaTime to standardize physics at 60 FPS feel\n        // This is the key to frame rate independence\n        this.normalizedDeltaTime = deltaTime * 60;\n        \n        // Check if we have fuel\n        const hasFuel = this.spaceship.consumeFuel();\n        \n        // Apply thrust based on controls - only if we have fuel\n        let thrustVector = new THREE.Vector3(0, 0, 0);\n        let isThrusting = false;\n        \n        // Get the ship's forward direction\n        const shipForward = new THREE.Vector3(0, 0, -1);\n        shipForward.applyQuaternion(this.spaceship.mesh.quaternion);\n        \n        // Calculate dot product to determine how much we're moving forward\n        const forwardVelocity = shipForward.dot(this.spaceship.velocity);\n        \n        // Define thruster references outside the if blocks so they're in scope throughout\n        const mainThrusterParticles = this.spaceship.particleSystems.find(ps => ps.type === 'main');\n        const mainThruster = this.spaceship.thrusters.find(t => t.type === 'main');\n        const reverseThrusterParticles = this.spaceship.particleSystems.find(ps => ps.type === 'reverse');\n        const reverseThruster = this.spaceship.thrusters.find(t => t.type === 'reverse');\n        const leftThrusterParticles = this.spaceship.particleSystems.find(ps => ps.type === 'left');\n        const leftThruster = this.spaceship.thrusters.find(t => t.type === 'left');\n        const rightThrusterParticles = this.spaceship.particleSystems.find(ps => ps.type === 'right');\n        const rightThruster = this.spaceship.thrusters.find(t => t.type === 'right');\n        \n        if (hasFuel) {\n            // Forward thrust handling\n            if (this.spaceship.thrust.forward) {\n                isThrusting = true;\n                const forwardThrust = new THREE.Vector3(0, 0, -Physics.THRUST_FORCE);\n                if (this.spaceship.thrust.boost) forwardThrust.multiplyScalar(Physics.BOOST_MULTIPLIER);\n                thrustVector.add(forwardThrust);\n                \n                // Show main thruster particles based on actual forward motion\n                if (mainThrusterParticles) {\n                    mainThrusterParticles.system.visible = true;\n                    \n                    // Increase emissive intensity of thruster when active\n                    if (mainThruster) {\n                        mainThruster.mesh.material.emissiveIntensity = \n                            this.spaceship.thrust.boost ? 1.5 : 1.0;\n                        // Make the thruster glow more in boost mode\n                        if (this.spaceship.thrust.boost) {\n                            mainThruster.mesh.material.emissive.setHex(0xff8800);\n                        } else {\n                            mainThruster.mesh.material.emissive.setHex(0xff5500);\n                        }\n                    }\n                }\n            } else {\n                // If not thrusting forward but still moving forward, show the thruster with reduced intensity\n                if (forwardVelocity > 5.0 && mainThrusterParticles) {\n                    // Show thruster with intensity based on speed\n                    const maxVelocity = this.getMaxVelocity();\n                    const intensityFactor = Math.min(forwardVelocity / maxVelocity, 0.8);\n                    mainThrusterParticles.system.visible = true;\n                    \n                    if (mainThruster) {\n                        mainThruster.mesh.material.emissiveIntensity = intensityFactor * 0.8;\n                        mainThruster.mesh.material.emissive.setHex(0xff3300);\n                    }\n                } else {\n                    // Deactivate main thruster particles\n                    if (mainThrusterParticles) {\n                        mainThrusterParticles.system.visible = false;\n                        \n                        // Reset emissive intensity when inactive\n                        if (mainThruster) {\n                            mainThruster.mesh.material.emissiveIntensity = 0.5;\n                            mainThruster.mesh.material.emissive.setHex(0xff5500);\n                        }\n                    }\n                }\n            }\n            \n            // Backward thrust handling\n            if (this.spaceship.thrust.backward) {\n                isThrusting = true;\n                thrustVector.add(new THREE.Vector3(0, 0, Physics.THRUST_FORCE));\n                \n                // Activate reverse thruster particles\n                if (reverseThrusterParticles) {\n                    reverseThrusterParticles.system.visible = true;\n                    // Increase emissive intensity of reverse thruster when active\n                    if (reverseThruster) {\n                        reverseThruster.mesh.material.emissiveIntensity = 1.0;\n                        reverseThruster.mesh.material.emissive.setHex(0x33ccff);\n                    }\n                }\n            } else {\n                // If moving backward significantly, show reverse thrusters\n                if (forwardVelocity < -5.0) {\n                    if (reverseThrusterParticles) {\n                        reverseThrusterParticles.system.visible = true;\n                        \n                        if (reverseThruster) {\n                            const maxVelocity = this.getMaxVelocity();\n                            const intensityFactor = Math.min(Math.abs(forwardVelocity) / maxVelocity, 0.8);\n                            reverseThruster.mesh.material.emissiveIntensity = intensityFactor * 0.8;\n                        }\n                    }\n                } else {\n                    // Deactivate reverse thruster particles\n                    if (reverseThrusterParticles) {\n                        reverseThrusterParticles.system.visible = false;\n                        // Reset emissive intensity when inactive\n                        if (reverseThruster) {\n                            reverseThruster.mesh.material.emissiveIntensity = 0.5;\n                            reverseThruster.mesh.material.emissive.setHex(0x33ccff);\n                        }\n                    }\n                }\n            }\n            \n            // Left thrust handling - only activate when left key is pressed\n            if (this.spaceship.thrust.left) {\n                isThrusting = true;\n                thrustVector.add(new THREE.Vector3(Physics.THRUST_FORCE, 0, 0));\n                \n                // Activate right thruster particles (for leftward movement)\n                if (rightThrusterParticles) {\n                    rightThrusterParticles.system.visible = true;\n                    // Increase emissive intensity when active\n                    if (rightThruster) {\n                        rightThruster.mesh.material.emissiveIntensity = 0.8;\n                    }\n                }\n            } else {\n                // Always turn off right thrusters when not pressing left\n                if (rightThrusterParticles) {\n                    rightThrusterParticles.system.visible = false;\n                    if (rightThruster) {\n                        rightThruster.mesh.material.emissiveIntensity = 0.5;\n                    }\n                }\n            }\n            \n            // Right thrust handling - only activate when right key is pressed\n            if (this.spaceship.thrust.right) {\n                isThrusting = true;\n                thrustVector.add(new THREE.Vector3(-Physics.THRUST_FORCE, 0, 0));\n                \n                // Activate left thruster particles (for rightward movement)\n                if (leftThrusterParticles) {\n                    leftThrusterParticles.system.visible = true;\n                    // Increase emissive intensity when active\n                    if (leftThruster) {\n                        leftThruster.mesh.material.emissiveIntensity = 0.8;\n                    }\n                }\n            } else {\n                // Always turn off left thrusters when not pressing right\n                if (leftThrusterParticles) {\n                    leftThrusterParticles.system.visible = false;\n                    if (leftThruster) {\n                        leftThruster.mesh.material.emissiveIntensity = 0.5;\n                    }\n                }\n            }\n            \n            if (isThrusting) {\n                // Apply thrust in world space (only if actively thrusting)\n                thrustVector.applyQuaternion(this.spaceship.mesh.quaternion);\n                \n                // Apply thrust scaled by normalized delta time\n                thrustVector.multiplyScalar(this.normalizedDeltaTime);\n                this.spaceship.velocity.add(thrustVector);\n                \n                // Get the current max velocity from the spaceship\n                const maxVelocity = this.getMaxVelocity();\n                \n                // Cap velocity at maximum speed\n                if (this.spaceship.velocity.length() > maxVelocity) {\n                    this.spaceship.velocity.normalize().multiplyScalar(maxVelocity);\n                }\n            }\n        }\n        \n        // Add a small amount of \"space friction\" to make controls more manageable\n        // This isn't realistic physics but makes the game more enjoyable to play\n        if (!isThrusting && this.spaceship.velocity.length() > 0) {\n            const friction = Physics.FRICTION * this.normalizedDeltaTime;\n            if (this.spaceship.velocity.length() > friction) {\n                this.spaceship.velocity.multiplyScalar(1 - friction);\n            } else {\n                this.spaceship.velocity.set(0, 0, 0);\n            }\n        }\n        \n        // CRITICAL: Always update position based on current velocity (Newton's first law)\n        // Objects in motion stay in motion unless acted upon by a force\n        // Scale position update by normalized delta time\n        const positionDelta = this.spaceship.velocity.clone().multiplyScalar(this.normalizedDeltaTime);\n        this.spaceship.mesh.position.add(positionDelta);\n        \n        // Apply rotation based on rotationState\n        this.updateShipRotation();\n        \n        // Update camera position\n        this.updateCamera();\n        \n        // Update trail particles based on ship's current velocity\n        // Only show trail when actively thrusting forward (W key pressed)\n        if (this.spaceship.updateParticles) {\n            // Enable trail visibility only when actively thrusting forward \n            const isThrusting = this.spaceship.thrust.forward;\n            this.spaceship.updateTrailVisibility(isThrusting);\n            this.spaceship.updateParticles();\n        }\n        \n        // Check for collisions with asteroids and planets\n        this.checkCollisions();\n    }\n    \n    // Helper method to get the max velocity from the spaceship or use the default\n    getMaxVelocity() {\n        return this.spaceship && this.spaceship.maxVelocity \n            ? this.spaceship.maxVelocity \n            : Physics.MAX_VELOCITY;\n    }\n    \n    updateShipRotation() {\n        if (!this.spaceship) return;\n        \n        // Cap y rotation to prevent flipping over (optional, can be adjusted or removed)\n        const maxY = Math.PI * 0.45; // Limit to ~45 degrees up/down\n        this.rotationState.y = Math.max(Math.min(this.rotationState.y, maxY), -maxY);\n        \n        // Create a quaternion for rotation\n        const euler = new THREE.Euler(this.rotationState.y, this.rotationState.x, 0, 'YXZ');\n        const targetQuaternion = new THREE.Quaternion().setFromEuler(euler);\n        \n        // Smoothly interpolate current rotation to target rotation\n        // Use rotation speed scaled by normalized delta time\n        this.spaceship.mesh.quaternion.slerp(targetQuaternion, Physics.ROTATION_SPEED * this.normalizedDeltaTime);\n    }\n    \n    updateCamera() {\n        if (!this.spaceship || !this.camera) return;\n        \n        // Skip camera updates if intro sequence is active\n        if (window.game && window.game.introSequenceActive) {\n            console.log(\"Skipping camera update - intro sequence active\");\n            return;\n        }\n        \n        // Update the camera to follow the spaceship with offset\n        // Camera moved much closer to ship for a zoomed-in view\n        const cameraOffset = new THREE.Vector3(0, 5, 25); // Brought much closer (was 0, 15, 75)\n        \n        // Apply spaceship rotation to camera offset\n        const rotatedOffset = cameraOffset.clone();\n        rotatedOffset.applyQuaternion(this.spaceship.mesh.quaternion);\n        \n        // Position camera behind and slightly above the spaceship\n        this.camera.position.copy(this.spaceship.mesh.position).add(rotatedOffset);\n        \n        // Look ahead of the spaceship\n        const lookAtPoint = new THREE.Vector3(0, 0, -60); // Adjusted lookAt point (was -200)\n        lookAtPoint.applyQuaternion(this.spaceship.mesh.quaternion);\n        lookAtPoint.add(this.spaceship.mesh.position);\n        \n        this.camera.lookAt(lookAtPoint);\n        \n        // Force visible frustum (debugging purposes)\n        this.camera.far = 400000; // Ensure far clip plane is beyond skybox\n        this.camera.updateProjectionMatrix();\n    }\n    \n    // Update rotation based on mouse movement deltas\n    updateRotation(deltaX, deltaY) {\n        // Update the rotation directly\n        this.rotationState.x -= deltaX;\n        this.rotationState.y -= deltaY;\n    }\n    \n    // Check for collisions with asteroids and planets\n    checkCollisions() {\n        if (!this.scene || !this.spaceship) return;\n        \n        // Set a smaller collision radius based on actual ship size\n        // This was previously Physics.COLLISION_DISTANCE (70) which was too large\n        const shipRadius = 15; // Reduced from 70 to match actual ship size\n        const shipPosition = this.spaceship.mesh.position.clone();\n        \n        // First check if we're colliding with our own projectiles and skip those\n        this.scene.traverse(object => {\n            if (object.type === 'Mesh' && \n                object.geometry.type?.includes('SphereGeometry') && \n                object.userData.isPlayerProjectile &&\n                object.userData.sourceId === 'player') {\n                \n                // Skip our own projectiles - don't even process them\n                return;\n            }\n        });\n        \n        // 1. Check collisions with asteroids\n        const asteroidMeshes = [];\n        \n        // Direct access to the asteroid belt if possible\n        const asteroidBelt = this.scene.children.find(child => child.name === 'asteroidBelt');\n        let asteroids = [];\n        \n        // If we can get direct access to asteroid belt object, use that for better performance\n        if (asteroidBelt && asteroidBelt.userData && asteroidBelt.userData.asteroids) {\n            asteroids = asteroidBelt.userData.asteroids;\n            asteroidMeshes.push(...asteroids.map(a => a.mesh));\n        } else {\n            // Otherwise do the more expensive scene traversal\n            this.scene.traverse(object => {\n                // Check for asteroids using geometry type\n                if (object.type === 'Mesh' && \n                    (object.geometry.type?.includes('IcosahedronGeometry') || \n                     object.geometry.type?.includes('TetrahedronGeometry') || \n                     object.geometry.type?.includes('OctahedronGeometry'))) {\n                    \n                    // Only consider objects within the asteroid belt range to avoid false positives\n                    const distFromCenter = Math.sqrt(\n                        object.position.x * object.position.x + \n                        object.position.z * object.position.z\n                    );\n                    \n                    // Only include objects in the appropriate distance range from the center\n                    // This helps avoid mistaking other geometric objects for asteroids\n                    if (distFromCenter > 16000 && distFromCenter < 32000) {\n                        asteroidMeshes.push(object);\n                    }\n                }\n            });\n        }\n        \n        // Check distance to each asteroid - precise collision detection\n        for (const asteroid of asteroidMeshes) {\n            // Skip null items or invisible asteroids\n            if (!asteroid || !asteroid.visible) continue;\n            \n            const distance = shipPosition.distanceTo(asteroid.position);\n            \n            // Use actual size from geometry if available - no artificial inflation\n            let asteroidRadius = 0;\n            \n            if (asteroid.geometry && asteroid.geometry.parameters && asteroid.geometry.parameters.radius) {\n                // Use the exact geometry radius without multiplication\n                asteroidRadius = asteroid.geometry.parameters.radius;\n            } else {\n                // Fallback size - more accurate estimation\n                asteroidRadius = 60; // 4x original value to match larger asteroids\n            }\n            \n            // If collision detected - uses the sum of actual ship and asteroid radii\n            if (distance < (shipRadius + asteroidRadius)) {\n                // Only log collision in debug mode\n                if (window.DEBUG_MODE) {\n                    console.log(\"Asteroid collision detected!\", \n                        \"Ship position:\", shipPosition,\n                        \"Asteroid position:\", asteroid.position,\n                        \"Distance:\", distance, \n                        \"Detection threshold:\", (shipRadius + asteroidRadius));\n                }\n                \n                this.handleCollision(asteroid, \"asteroid\");\n                return; // Exit after first collision\n            }\n        }\n        \n        // 2. Check collisions with planets\n        this.scene.traverse(object => {\n            // Check if this is a planet - they typically have larger scale\n            if (object.type === 'Mesh' && \n                object.geometry.type.includes('SphereGeometry') && \n                object.scale.x >= 1 && // To filter out particles and small objects\n                !object.userData.id?.startsWith('asteroid-') && // Not an asteroid\n                !object.userData.isPlayerProjectile && // Not a player projectile\n                object !== this.spaceship.mesh) { // Not the spaceship itself\n                \n                const distance = shipPosition.distanceTo(object.position);\n                \n                // For planets, we use the actual geometry radius without artificial inflation\n                const planetRadius = object.geometry.parameters.radius * object.scale.x;\n                \n                // If the object is the sun\n                if (object.material.emissive && \n                    object.material.emissive.r > 0.5 && \n                    object.material.emissive.g > 0.5) {\n                    // Sun collision: if we're within the exact combined radius\n                    if (distance < planetRadius + shipRadius) {\n                        this.handleCollision(object, \"sun\");\n                        return;\n                    }\n                } \n                // Regular planet collision\n                else if (distance < planetRadius + shipRadius) {\n                    this.handleCollision(object, \"planet\");\n                    return;\n                }\n            }\n        });\n    }\n    \n    handleCollision(object, type) {\n        if (this.collided || !this.scene) return; // Only handle the first collision\n        \n        this.collided = true;\n        \n        // Enhanced logging for collision diagnostics (only in debug mode)\n        if (window.DEBUG_MODE) {\n            console.log(\"=== COLLISION DETECTED ===\");\n            console.log(`Collision type: ${type}`);\n            console.log(`Ship velocity at impact: ${this.spaceship.velocity.length().toFixed(2)} units/frame`);\n            console.log(`Ship position: x=${this.spaceship.mesh.position.x.toFixed(0)}, y=${this.spaceship.mesh.position.y.toFixed(0)}, z=${this.spaceship.mesh.position.z.toFixed(0)}`);\n            console.log(`${type} position: x=${object.position.x.toFixed(0)}, y=${object.position.y.toFixed(0)}, z=${object.position.z.toFixed(0)}`);\n            console.log(`Hull resistance: ${this.spaceship.collisionResistance}`);\n        }\n        \n        // Apply hull resistance to see if we survive the collision\n        if (this.attemptCollisionRecovery(type)) {\n            if (window.DEBUG_MODE) console.log(\"Hull absorbed collision damage!\");\n            this.createRecoveryEffect();\n            \n            // Bounce away from the collision point\n            if (object && object.position) {\n                const bounceDirection = new THREE.Vector3()\n                    .subVectors(this.spaceship.mesh.position, object.position)\n                    .normalize();\n                \n                // Apply a bounce force\n                this.spaceship.velocity.copy(bounceDirection.multiplyScalar(5));\n            }\n            \n            // Play the \"boink\" sound for minor collisions\n            if (window.game && window.game.audio) {\n                window.game.audio.playSound('boink');\n            }\n            \n            // Reset collision state after a short delay\n            setTimeout(() => {\n                this.collided = false;\n                if (window.DEBUG_MODE) console.log(\"Collision state reset - ship ready for new collisions\");\n            }, 1000);\n            \n            return;\n        }\n        \n        // If we didn't recover, publish game over event instead of handling directly\n        // Stop the ship\n        this.spaceship.velocity.set(0, 0, 0);\n        \n        // Different explosion effects based on collision type\n        let explosionColor, explosionSize, explosionMessage, collisionType;\n        \n        if (type === \"sun\") {\n            // Solar collision - big, bright yellow explosion\n            explosionColor = 0xffff00;\n            explosionSize = 60; // 4x original size (was 15)\n            explosionMessage = \"Your ship was incinerated by the sun!\";\n            collisionType = \"SUN_DEATH\";\n        } else if (type === \"planet\") {\n            // Planet collision - large blue-tinted explosion\n            explosionColor = 0x33ccff;\n            explosionSize = 40; // 4x original size (was 10)\n            explosionMessage = \"Your ship crashed into a planet!\";\n            collisionType = \"COLLISION_PLANET\";\n        } else {\n            // Default asteroid collision - smaller orange explosion\n            explosionColor = 0xff6600;\n            explosionSize = 20; // 4x original size (was 5)\n            explosionMessage = \"Your ship was destroyed by an asteroid!\";\n            collisionType = \"COLLISION_ASTEROID\";\n        }\n        \n        // Create visual effect for the collision\n        const explosionGeometry = new THREE.SphereGeometry(explosionSize, 32, 32);\n        const explosionMaterial = new THREE.MeshBasicMaterial({\n            color: explosionColor,\n            transparent: true,\n            opacity: 0.8\n        });\n        const explosion = new THREE.Mesh(explosionGeometry, explosionMaterial);\n        explosion.position.copy(this.spaceship.mesh.position);\n        this.scene.add(explosion);\n        \n        // Animate the explosion\n        this.animateExplosion(explosion);\n        \n        // Mark the ship as destroyed internally\n        if (this.spaceship) {\n            this.spaceship.isDestroyed = true;\n        }\n        \n        \n        console.log(\"Physics: Initiating game over sequence for collision with\", type);\n        \n        // Use window.mainMessageBus if available\n        if (window.mainMessageBus) {\n            console.log(\"Physics: Using window.mainMessageBus\");\n            window.mainMessageBus.publish('game.over', {\n                reason: explosionMessage,\n                source: \"physics\",\n                collisionType: type,\n                type: collisionType\n            });\n        } else if (window.game && window.game.messageBus) {\n            // Use game message bus if main message bus not available\n            console.log(\"Physics: Using window.game.messageBus\");\n            window.game.messageBus.publish('game.over', {\n                reason: explosionMessage,\n                source: \"physics\",\n                collisionType: type,\n                type: collisionType\n            });\n        } else {\n            // Only use MessageBus.triggerGameOver if no direct access\n            import('../core/messageBus.js').then(module => {\n                const MessageBus = module.MessageBus;\n                console.log(\"Physics: Using MessageBus.triggerGameOver\");\n                \n                MessageBus.triggerGameOver(explosionMessage, \"physics\");\n            }).catch(err => {\n                console.error(\"Physics: Error importing MessageBus:\", err);\n            });\n        }\n    }\n    \n    // Method to attempt to recover from a collision based on hull resistance\n    attemptCollisionRecovery(collisionType) {\n        if (!this.spaceship || !this.spaceship.collisionResistance) \n            return false;\n        \n        // Get the hull resistance value\n        const resistance = this.spaceship.collisionResistance;\n        \n        // Different collision types have different chances of recovery\n        // Higher resistance increases chances\n        let recoveryChance = 0;\n        \n        switch (collisionType) {\n            case \"asteroid\":\n                // 50% base chance + 8% per hull level as requested\n                recoveryChance = 0.50 + (resistance - 1) * 0.08;\n                if (window.DEBUG_MODE) console.log(`Asteroid collision recovery chance: ${(recoveryChance * 100).toFixed(1)}%`);\n                break;\n            case \"planet\":\n                // Start with 10% chance, increased by hull resistance\n                recoveryChance = 0.1 + (resistance - 1) * 0.2;\n                if (window.DEBUG_MODE) console.log(`Planet collision recovery chance: ${(recoveryChance * 100).toFixed(1)}%`);\n                break;\n            case \"sun\":\n                // Almost no chance to survive sun collision\n                recoveryChance = (resistance - 1) * 0.05;\n                if (window.DEBUG_MODE) console.log(`Sun collision recovery chance: ${(recoveryChance * 100).toFixed(1)}%`);\n                break;\n            default:\n                recoveryChance = 0.2 + (resistance - 1) * 0.3;\n                if (window.DEBUG_MODE) console.log(`Generic collision recovery chance: ${(recoveryChance * 100).toFixed(1)}%`);\n        }\n        \n        // Random chance based on recovery probability\n        const recoveryRoll = Math.random();\n        const survived = recoveryRoll < recoveryChance;\n        \n        if (window.DEBUG_MODE) console.log(`Recovery roll: ${recoveryRoll.toFixed(3)}, needed ${recoveryChance.toFixed(3)} or lower to survive`);\n        \n        return survived;\n    }\n    \n    // Create a visual effect when the ship survives a collision\n    createRecoveryEffect() {\n        if (!this.spaceship || !this.scene) return;\n        \n        // Create a shield-like effect around the ship\n        const shieldGeometry = new THREE.SphereGeometry(60, 32, 32); // 4x original size (was 15)\n        const shieldMaterial = new THREE.MeshBasicMaterial({\n            color: 0x30cfd0,\n            transparent: true,\n            opacity: 0.6,\n            side: THREE.DoubleSide\n        });\n        \n        const shield = new THREE.Mesh(shieldGeometry, shieldMaterial);\n        shield.position.copy(this.spaceship.mesh.position);\n        this.scene.add(shield);\n        \n        // Animate the shield (expand and fade out)\n        let scale = 1;\n        const expandSpeed = 0.05;\n        const fadeSpeed = 0.02;\n        \n        const animateShield = () => {\n            if (scale > 2 || shield.material.opacity <= 0) {\n                this.scene.remove(shield);\n                return;\n            }\n            \n            scale += expandSpeed;\n            shield.scale.set(scale, scale, scale);\n            shield.material.opacity -= fadeSpeed;\n            \n            // Update shield position to follow ship\n            if (this.spaceship && this.spaceship.mesh) {\n                shield.position.copy(this.spaceship.mesh.position);\n            }\n            \n            requestAnimationFrame(animateShield);\n        };\n        \n        animateShield();\n    }\n    \n    animateExplosion(explosion) {\n        let scale = 1;\n        const expandSpeed = 0.5;\n        const fadeSpeed = 0.02;\n        \n        const animate = () => {\n            if (scale > 20 || explosion.material.opacity <= 0) {\n                this.scene.remove(explosion);\n                return;\n            }\n            \n            scale += expandSpeed;\n            explosion.scale.set(scale, scale, scale);\n            explosion.material.opacity -= fadeSpeed;\n            \n            requestAnimationFrame(animate);\n        };\n        \n        animate();\n    }\n}","// skybox.js - Creates and manages advanced procedural skybox with volumetric effects\n\nimport * as THREE from 'three';\n\nexport class Skybox {\n    constructor(scene) {\n        this.scene = scene;\n        this.skybox = null;\n        this.time = 0;\n        \n        // Create texture loader\n        this.textureLoader = new THREE.TextureLoader();\n        \n        // Load the Milky Way texture\n        this.milkyWayTexture = this.textureLoader.load('./assets/2k_stars_milky_way.jpg');\n        this.milkyWayTexture.colorSpace = THREE.SRGBColorSpace;\n        \n        // Store additional skybox textures\n        this.skyboxTextures = {};\n        \n        // Store initial parameters for the Solar System\n        this.solarSystemParams = {\n            starDensity: 1.0,\n            nebulaDensity: 0.5,\n            color: 0xFFFFFF,\n            texturePath: './assets/2k_stars_milky_way.jpg',\n            brightness: 1.0 // Default brightness for Solar System\n        };\n        \n        this.createProceduralSkybox(this.solarSystemParams);\n    }\n    \n    // Update skybox based on star system parameters\n    updateForSystem(params) {\n        if (!params) return;\n        \n        console.log(\"Updating skybox with parameters:\", params);\n        \n        // Special case for Solar System - ensure consistent appearance\n        if (params.isSolarSystem || \n            (params.color === 0xFFFFFF && params.starDensity === 1.0 && params.nebulaDensity === 0.5)) {\n            console.log(\"Detected Solar System skybox parameters, using stored solar system configuration\");\n            params = this.solarSystemParams;\n        }\n        \n        // Remove existing skybox\n        if (this.skybox) {\n            console.log(\"Removing existing skybox\");\n            this.scene.remove(this.skybox);\n        }\n        \n        // Reset time for consistent star pattern\n        if (params.resetTime) {\n            this.time = 0;\n        }\n        \n        // Create new skybox with system parameters\n        this.createProceduralSkybox(params);\n    }\n    \n    // Load texture if needed and return it\n    getTexture(texturePath) {\n        // Use default Milky Way texture if none specified\n        if (!texturePath) {\n            return this.milkyWayTexture;\n        }\n        \n        // Return Milky Way texture for the default Solar System texture\n        if (texturePath === './assets/2k_stars_milky_way.jpg') {\n            return this.milkyWayTexture;\n        }\n        \n        // Fix texture path for API server images\n        let adjustedTexturePath = texturePath;\n        \n        // Check if this is an image from our API server\n        if (texturePath.startsWith('/images/')) {\n            // If running on port 8000, adjust URL to point to port 8001\n            if (window.location.port === '8000') {\n                const serverHost = window.location.hostname;\n                adjustedTexturePath = `http://${serverHost}:8001${texturePath}`;\n                console.log(`Adjusted texture path to API server: ${adjustedTexturePath}`);\n            }\n        }\n        \n        // Load the texture if not already loaded\n        if (!this.skyboxTextures[texturePath]) {\n            console.log(`Loading new skybox texture: ${adjustedTexturePath}`);\n            this.skyboxTextures[texturePath] = this.textureLoader.load(adjustedTexturePath);\n            this.skyboxTextures[texturePath].colorSpace = THREE.SRGBColorSpace;\n        }\n        \n        return this.skyboxTextures[texturePath];\n    }\n    \n    createProceduralSkybox(params = {}) {\n        // Apply system parameters if provided\n        let starDensity = params?.starDensity || 1.0;\n        let nebulaDensity = params?.nebulaDensity || 0.5;\n        let skyboxColor = params?.color || 0x000000;\n        let brightness = params?.brightness !== undefined ? params.brightness : 1.0;\n        const size = 320000; // Very large size to contain entire game world (4x original)\n        const texturePath = params?.texturePath || './assets/2k_stars_milky_way.jpg';\n        \n        console.log(`Creating enhanced skybox with star density: ${starDensity}, nebula density: ${nebulaDensity}, color: 0x${skyboxColor.toString(16)}, texture: ${texturePath}, brightness: ${brightness}`);\n        \n        // Get the appropriate texture\n        const skyboxTexture = this.getTexture(texturePath);\n        \n        // Create advanced shader material for skybox with texture\n        const skyMaterial = new THREE.ShaderMaterial({\n            uniforms: {\n                time: { value: this.time || 0 },\n                milkyWayTexture: { value: skyboxTexture },\n                starDensity: { value: starDensity },\n                nebulaDensity: { value: nebulaDensity },\n                skyColor: { value: new THREE.Color(skyboxColor) },\n                brightness: { value: brightness }\n            },\n            vertexShader: `\n                varying vec2 vUv;\n                varying vec3 vPosition;\n                \n                void main() {\n                    vUv = uv;\n                    vPosition = position;\n                    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n                }\n            `,\n            fragmentShader: `\n                uniform sampler2D milkyWayTexture;\n                uniform float time;\n                uniform float starDensity;\n                uniform float nebulaDensity;\n                uniform vec3 skyColor;\n                uniform float brightness;\n                \n                varying vec2 vUv;\n                varying vec3 vPosition;\n                \n                void main() {\n                    // Sample the Milky Way texture with adjusted brightness\n                    vec4 milkyWay = texture2D(milkyWayTexture, vUv);\n                    milkyWay.rgb *= 1.5 * brightness; // Apply brightness factor\n                    \n                    // Use only the Milky Way texture without procedural stars\n                    vec3 finalColor = milkyWay.rgb * nebulaDensity * 1.2 * brightness;\n                    \n                    // Reduced ambient light\n                    finalColor += vec3(0.05);\n                    \n                    // Subtle color tint\n                    finalColor = mix(finalColor, skyColor * 1.2 * brightness, 0.1);\n                    \n                    // Apply gamma correction for more natural brightness\n                    finalColor = pow(finalColor, vec3(0.9));\n                    \n                    gl_FragColor = vec4(finalColor, 1.0);\n                }\n            `,\n            side: THREE.BackSide\n        });\n        \n        // Create the skybox mesh\n        const skyboxGeometry = new THREE.BoxGeometry(size, size, size);\n        this.skybox = new THREE.Mesh(skyboxGeometry, skyMaterial);\n        \n        // Rotate the skybox to align the Milky Way with the galactic plane\n        this.skybox.rotation.x = Math.PI / 4;\n        this.skybox.rotation.y = Math.PI / 6;\n        \n        this.scene.add(this.skybox);\n        \n        // Store material for updates\n        this.skyMaterial = skyMaterial;\n        \n        console.log(\"Enhanced skybox created with texture\");\n    }\n    \n    update(deltaTime = 0.016, camera) {\n        // Update skybox animation\n        if (this.skyMaterial) {\n            this.time += deltaTime * 0.1; // Slower star movement\n            this.skyMaterial.uniforms.time.value = this.time;\n        }\n        \n        // Keep skybox centered on camera if it exists\n        if (this.skybox && camera) {\n            this.skybox.position.copy(camera.position);\n        }\n    }\n}","// sun.js - Creates and manages the sun object (central star) with volumetric rendering\n\nimport * as THREE from 'three';\n\nexport class Sun {\n    constructor(scene) {\n        this.scene = scene;\n        this.sun = null;\n        this.sunFlickerIntensity = 1.0;\n        this.sunFlickerDirection = 0.02;\n        this.time = 0;\n        this.sunType = 'G'; // Default sun type (G-type like our Sun)\n        this.lensFlares = []; // Store multiple flare elements\n        this.createSun();\n    }\n    \n    createSun() {\n        // Create a group to hold all sun-related elements\n        this.sun = new THREE.Group();\n        this.sun.name = 'sun'; // Add name for easier identification\n        this.scene.add(this.sun);\n        \n        // Create the core sun sphere with increased size\n        const sunGeometry = new THREE.SphereGeometry(1000, 64, 64); // Reduced from 1200\n        \n        // Use advanced shader material for the sun surface\n        const sunMaterial = new THREE.ShaderMaterial({\n            uniforms: {\n                time: { value: 0 },\n                sunColor: { value: new THREE.Color(0xff7700) },\n                surfaceDetail: { value: 1.2 }, // Increased detail\n                surfaceDistortion: { value: 0.3 }, // Increased distortion\n                sunActivity: { value: 0.8 } // Increased activity\n            },\n            vertexShader: `\n                varying vec3 vNormal;\n                varying vec2 vUv;\n                varying vec3 vPosition;\n                \n                void main() {\n                    vUv = uv;\n                    vNormal = normalize(normalMatrix * normal);\n                    vPosition = position;\n                    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n                }\n            `,\n            fragmentShader: `\n                uniform float time;\n                uniform vec3 sunColor;\n                uniform float surfaceDetail;\n                uniform float surfaceDistortion;\n                uniform float sunActivity;\n                \n                varying vec3 vNormal;\n                varying vec2 vUv;\n                varying vec3 vPosition;\n                \n                // Noise functions for surface detail\n                float hash(float n) { return fract(sin(n) * 43758.5453123); }\n                float hash(vec2 p) { return fract(sin(dot(p, vec2(127.1, 311.7))) * 43758.5453); }\n                \n                float noise(vec3 x) {\n                    vec3 p = floor(x);\n                    vec3 f = fract(x);\n                    f = f * f * (3.0 - 2.0 * f);\n                    \n                    float n = p.x + p.y * 157.0 + 113.0 * p.z;\n                    return mix(\n                        mix(mix(hash(n + 0.0), hash(n + 1.0), f.x),\n                            mix(hash(n + 157.0), hash(n + 158.0), f.x), f.y),\n                        mix(mix(hash(n + 113.0), hash(n + 114.0), f.x),\n                            mix(hash(n + 270.0), hash(n + 271.0), f.x), f.y),\n                        f.z);\n                }\n                \n                // Fractional Brownian Motion for layered detail\n                float fbm(vec3 x) {\n                    float v = 0.0;\n                    float a = 0.5;\n                    vec3 shift = vec3(100);\n                    \n                    for (int i = 0; i < 7; ++i) { // Increased iterations for more detail\n                        v += a * noise(x);\n                        x = x * 2.0 + shift;\n                        a *= 0.5;\n                    }\n                    \n                    return v;\n                }\n                \n                void main() {\n                    // Calculate dynamic granulation based on noise\n                    vec3 surfacePos = vPosition * surfaceDetail * 0.01;\n                    float granulation = fbm(surfacePos + time * 0.15); // Increased speed\n                    \n                    // Calculate solar prominences and flares with more dynamic movement\n                    float flareBase = fbm(surfacePos * 2.5 + time * 0.3); // Increased detail and speed\n                    float flares = pow(flareBase, 1.8) * sunActivity;\n                    flares = smoothstep(0.65, 0.9, flares); // Lower threshold for more flares\n                    \n                    // Create dynamic hotspots that move across the surface\n                    float hotspots = fbm(surfacePos * 3.0 + time * 0.2) * fbm(surfacePos * 1.5 - time * 0.1);\n                    hotspots = pow(hotspots, 3.0) * 1.5;\n                    \n                    // Calculate normal distortion for surface waves with more turbulence\n                    vec3 distortedNormal = vNormal;\n                    distortedNormal.x += noise(surfacePos * 6.0 + time * 0.15) * surfaceDistortion;\n                    distortedNormal.y += noise(surfacePos * 6.0 + time * 0.2) * surfaceDistortion;\n                    distortedNormal.z += noise(surfacePos * 6.0 + time * 0.17) * surfaceDistortion;\n                    distortedNormal = normalize(distortedNormal);\n                    \n                    // Edge brightness (limb darkening inverse - brighter at the edges)\n                    float edgeBrightness = 1.0 - dot(distortedNormal, vec3(0.0, 0.0, 1.0));\n                    edgeBrightness = pow(edgeBrightness, 2.5) * 0.4; // Reduced power and multiplier\n                    \n                    // Create fire-like color variations\n                    vec3 baseColor = sunColor;\n                    vec3 hotColor = vec3(1.0, 0.8, 0.4); // Yellow-white hot spots\n                    vec3 flareColor = vec3(1.0, 0.6, 0.3); // Orange-red flares\n                    \n                    // Combine effects for a more dynamic fireball look\n                    vec3 finalColor = baseColor * (1.0 + granulation * 0.4);\n                    finalColor = mix(finalColor, hotColor, hotspots);\n                    finalColor += flareColor * flares;\n                    finalColor += vec3(1.0, 0.9, 0.7) * edgeBrightness;\n                    \n                    // Output with HDR values\n                    gl_FragColor = vec4(finalColor, 1.0);\n                }\n            `,\n            side: THREE.FrontSide\n        });\n        \n        const sunCoreMesh = new THREE.Mesh(sunGeometry, sunMaterial);\n        this.sun.add(sunCoreMesh);\n        \n        // Add corona layer (volumetric glow effect)\n        const coronaGeometry = new THREE.SphereGeometry(2000, 64, 64); // Reduced from 2400\n        const coronaMaterial = new THREE.ShaderMaterial({\n            uniforms: {\n                time: { value: 0 },\n                coronaColor: { value: new THREE.Color(0xff9940) },\n                viewVector: { value: new THREE.Vector3(0, 0, 1) },\n                turbulence: { value: 0.6 } // Medium turbulence\n            },\n            vertexShader: `\n                uniform vec3 viewVector;\n                varying vec3 vNormal;\n                varying vec3 vPosition;\n                varying float vIntensity;\n                \n                void main() {\n                    vNormal = normalize(normalMatrix * normal);\n                    vPosition = position;\n                    \n                    // Calculate view-dependent intensity with less view dependency\n                    vec3 viewDir = normalize(viewVector);\n                    // Use a lower exponent and add a base intensity to ensure visibility from all angles\n                    vIntensity = pow(1.15 - dot(vNormal, viewDir), 1.5) * 0.8 + 0.2;\n                    \n                    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n                }\n            `,\n            fragmentShader: `\n                uniform float time;\n                uniform vec3 coronaColor;\n                uniform float turbulence;\n                \n                varying vec3 vNormal;\n                varying vec3 vPosition;\n                varying float vIntensity;\n                \n                // Noise functions\n                float hash(vec3 p) {\n                    p = fract(p * vec3(443.897, 441.423, 437.195));\n                    p += dot(p, p.yzx + 19.19);\n                    return fract((p.x + p.y) * p.z);\n                }\n                \n                float noise(vec3 p) {\n                    vec3 i = floor(p);\n                    vec3 f = fract(p);\n                    f = f*f*(3.0-2.0*f);\n                    \n                    return mix(\n                        mix(mix(hash(i), hash(i + vec3(1,0,0)), f.x),\n                            mix(hash(i + vec3(0,1,0)), hash(i + vec3(1,1,0)), f.x), f.y),\n                        mix(mix(hash(i + vec3(0,0,1)), hash(i + vec3(1,0,1)), f.x),\n                            mix(hash(i + vec3(0,1,1)), hash(i + vec3(1,1,1)), f.x), f.y), f.z);\n                }\n                \n                float fbm(vec3 p) {\n                    float f = 0.0;\n                    float weight = 0.5;\n                    for (int i = 0; i < 5; i++) {\n                        f += weight * noise(p);\n                        weight *= 0.5;\n                        p *= 2.0;\n                    }\n                    return f;\n                }\n                \n                void main() {\n                    // Add turbulence to the corona intensity based on position\n                    float turbulenceFactor = fbm(vPosition * 0.005 + time * 0.15) * turbulence;\n                    float finalIntensity = vIntensity * (1.0 + turbulenceFactor);\n                    \n                    // Create dynamic wisps in the corona for a fire-like effect\n                    float wisps = fbm(vPosition * 0.01 - time * 0.05) * fbm(vPosition * 0.02 + time * 0.1);\n                    wisps = pow(wisps, 2.0) * 0.5;\n                    \n                    // HDR color with variation\n                    vec3 finalColor = coronaColor * (finalIntensity + wisps);\n                    \n                    // Add color variation based on intensity\n                    if (finalIntensity > 0.7) {\n                        finalColor = mix(finalColor, vec3(1.0, 0.9, 0.7), (finalIntensity - 0.7) * 3.0);\n                    }\n                    \n                    // Add transparency at the edges for volumetric feel\n                    float alpha = smoothstep(0.0, 0.15, finalIntensity + wisps * 0.5);\n                    \n                    gl_FragColor = vec4(finalColor, alpha * 0.9); // Slightly more transparent\n                }\n            `,\n            transparent: true,\n            blending: THREE.AdditiveBlending,\n            depthWrite: false,\n            side: THREE.BackSide\n        });\n        \n        const coronaMesh = new THREE.Mesh(coronaGeometry, coronaMaterial);\n        this.sun.add(coronaMesh);\n        \n        // Add outer corona for extended glow\n        const outerCoronaGeometry = new THREE.SphereGeometry(3000, 32, 32); // Reduced from 3600\n        const outerCoronaMaterial = new THREE.ShaderMaterial({\n            uniforms: {\n                time: { value: 0 },\n                coronaColor: { value: new THREE.Color(0xff8800) },\n                viewVector: { value: new THREE.Vector3(0, 0, 1) }\n            },\n            vertexShader: `\n                uniform vec3 viewVector;\n                varying float vIntensity;\n                varying vec3 vPosition;\n                \n                void main() {\n                    vec3 vNormal = normalize(normalMatrix * normal);\n                    vec3 vNormel = normalize(viewVector);\n                    // Less extreme view dependency to ensure more consistent appearance\n                    vIntensity = pow(1.05 - dot(vNormal, vNormel), 2.0) * 0.7 + 0.3;\n                    vPosition = position;\n                    \n                    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n                }\n            `,\n            fragmentShader: `\n                uniform float time;\n                uniform vec3 coronaColor;\n                varying float vIntensity;\n                varying vec3 vPosition;\n                \n                // Simple noise for variation\n                float hash(vec3 p) {\n                    p = fract(p * vec3(443.897, 441.423, 437.195));\n                    p += dot(p, p.yzx + 19.19);\n                    return fract((p.x + p.y) * p.z);\n                }\n                \n                float noise(vec3 p) {\n                    vec3 i = floor(p);\n                    vec3 f = fract(p);\n                    f = f*f*(3.0-2.0*f);\n                    \n                    return mix(\n                        mix(mix(hash(i), hash(i + vec3(1,0,0)), f.x),\n                            mix(hash(i + vec3(0,1,0)), hash(i + vec3(1,1,0)), f.x), f.y),\n                        mix(mix(hash(i + vec3(0,0,1)), hash(i + vec3(1,0,1)), f.x),\n                            mix(hash(i + vec3(0,1,1)), hash(i + vec3(1,1,1)), f.x), f.y), f.z);\n                }\n                \n                void main() {\n                    // Apply time-based pulsing with noise variation\n                    float noiseVal = noise(vPosition * 0.002 + time * 0.1);\n                    float pulseIntensity = vIntensity * (1.0 + 0.2 * sin(time + noiseVal * 5.0));\n                    \n                    // Add subtle fire-like variations\n                    pulseIntensity += noiseVal * 0.2;\n                    \n                    vec3 glow = coronaColor * pulseIntensity;\n                    gl_FragColor = vec4(glow, pulseIntensity * 0.4); // Reduced from 0.6\n                }\n            `,\n            transparent: true,\n            blending: THREE.AdditiveBlending,\n            depthWrite: false,\n            side: THREE.BackSide\n        });\n        \n        const outerCoronaMesh = new THREE.Mesh(outerCoronaGeometry, outerCoronaMaterial);\n        this.sun.add(outerCoronaMesh);\n        \n        // Add sun light with increased intensity but focused on a smaller range\n        const sunLight = new THREE.PointLight(0xFFFAF0, 200000, 100000, 2); // Using pure white with a hint of warmth\n        this.sun.add(sunLight);\n        \n        // Create multiple lens flare elements distributed around the sun\n        this.createFireballFlares();\n        \n        // Store material references for updates\n        this.sunMaterial = sunMaterial;\n        this.coronaMaterial = coronaMaterial;\n        this.outerCoronaMaterial = outerCoronaMaterial;\n        this.sunLight = sunLight;\n\n        // Store base light intensity for balancing\n        this.baseLightIntensity = 200000; // Increased from 100000\n        \n        // Add a directional light for casting shadows across the solar system\n        const sunDirectionalLight = new THREE.DirectionalLight(0xFFFAF0, 1.5);\n        sunDirectionalLight.position.set(0, 0, 0);\n        sunDirectionalLight.castShadow = true;\n        \n        // Configure shadow mapping for large-scale space scene\n        sunDirectionalLight.shadow.mapSize.width = 4096;\n        sunDirectionalLight.shadow.mapSize.height = 4096;\n        sunDirectionalLight.shadow.camera.near = 1000;\n        sunDirectionalLight.shadow.camera.far = 100000;\n        sunDirectionalLight.shadow.camera.left = -50000;\n        sunDirectionalLight.shadow.camera.right = 50000;\n        sunDirectionalLight.shadow.camera.top = 50000;\n        sunDirectionalLight.shadow.camera.bottom = -50000;\n        sunDirectionalLight.shadow.bias = -0.00005;\n        sunDirectionalLight.shadow.normalBias = 0.02;\n        sunDirectionalLight.shadow.radius = 2; // For softer shadows\n\n        // Use PCFSoftShadowMap for better shadow quality\n        if (this.scene && this.scene.renderer) {\n            this.scene.renderer.shadowMap.type = THREE.PCFSoftShadowMap;\n        }\n        \n        this.sun.add(sunDirectionalLight);\n        this.sunDirectionalLight = sunDirectionalLight;\n    }\n    \n    // New method to create multiple flare elements\n    createFireballFlares() {\n        // Load different flare textures\n        const flareTextures = [\n            'https://cdn.jsdelivr.net/gh/mrdoob/three.js@r128/examples/textures/lensflare/lensflare0.png',\n            'https://cdn.jsdelivr.net/gh/mrdoob/three.js@r128/examples/textures/lensflare/lensflare2.png',\n            'https://cdn.jsdelivr.net/gh/mrdoob/three.js@r128/examples/textures/lensflare/lensflare3.png'\n        ];\n        \n        const textureLoader = new THREE.TextureLoader();\n        \n        // Clear any existing flares\n        this.lensFlares.forEach(flare => {\n            if (flare.parent) flare.parent.remove(flare);\n        });\n        this.lensFlares = [];\n        \n        // Create main central flare\n        const mainFlareTexture = textureLoader.load(flareTextures[0]);\n        mainFlareTexture.colorSpace = THREE.SRGBColorSpace;\n        const mainFlare = new THREE.Sprite(new THREE.SpriteMaterial({\n            map: mainFlareTexture,\n            color: 0xffaa55,\n            transparent: true,\n            blending: THREE.AdditiveBlending,\n            depthTest: false\n        }));\n        mainFlare.scale.set(700, 700, 1.0);\n        this.sun.add(mainFlare);\n        this.lensFlares.push(mainFlare);\n        \n        // Create smaller surrounding flares\n        const flareCount = 8;\n        const radius = 300; // Distance from center\n        \n        for (let i = 0; i < flareCount; i++) {\n            // Alternate between flare textures\n            const textureIndex = 1 + (i % 2);\n            const flareTexture = textureLoader.load(flareTextures[textureIndex]);\n            flareTexture.colorSpace = THREE.SRGBColorSpace;\n            \n            // Create flare with varying colors\n            const flare = new THREE.Sprite(new THREE.SpriteMaterial({\n                map: flareTexture,\n                color: i % 3 === 0 ? 0xffcc77 : (i % 3 === 1 ? 0xff8855 : 0xff6622),\n                transparent: true,\n                blending: THREE.AdditiveBlending,\n                depthTest: false\n            }));\n            \n            // Position around the sun at different angles\n            const angle = (i / flareCount) * Math.PI * 2;\n            const x = Math.cos(angle) * radius;\n            const y = Math.sin(angle) * radius;\n            flare.position.set(x, y, 0);\n            \n            // Random size variations\n            const size = 200 + Math.random() * 200;\n            flare.scale.set(size, size, 1.0);\n            \n            // Store in array and add to sun\n            this.sun.add(flare);\n            this.lensFlares.push(flare);\n            \n            // Create an additional layer of smaller flares\n            if (i % 2 === 0) {\n                const smallFlareTexture = textureLoader.load(flareTextures[i % 3]);\n                smallFlareTexture.colorSpace = THREE.SRGBColorSpace;\n                \n                const smallFlare = new THREE.Sprite(new THREE.SpriteMaterial({\n                    map: smallFlareTexture,\n                    color: 0xffaa22,\n                    transparent: true,\n                    blending: THREE.AdditiveBlending,\n                    depthTest: false\n                }));\n                \n                // Position at twice the radius\n                const farRadius = radius * 2;\n                const farAngle = angle + (Math.random() * 0.2 - 0.1);\n                const farX = Math.cos(farAngle) * farRadius;\n                const farY = Math.sin(farAngle) * farRadius;\n                smallFlare.position.set(farX, farY, 0);\n                \n                // Smaller size\n                const smallSize = 100 + Math.random() * 150;\n                smallFlare.scale.set(smallSize, smallSize, 1.0);\n                \n                this.sun.add(smallFlare);\n                this.lensFlares.push(smallFlare);\n            }\n        }\n    }\n    \n    // Update sun based on star type (O, B, A, F, G, K, M)\n    updateSunType(type, lightIntensityMultiplier = 1.0) {\n        this.sunType = type || 'G';\n        let color, temperature, activity;\n        \n        // Set sun properties based on star classification\n        switch(this.sunType) {\n            case 'O': // Hot blue stars\n                color = 0x9db4ff;\n                temperature = 30000;\n                activity = 0.8;\n                break;\n            case 'B': // Blue-white\n                color = 0xaabfff;\n                temperature = 20000;\n                activity = 0.75;\n                break;\n            case 'A': // White\n                color = 0xcad7ff;\n                temperature = 10000;\n                activity = 0.7;\n                break;\n            case 'F': // Yellow-white\n                color = 0xf8f7ff;\n                temperature = 7000;\n                activity = 0.65;\n                break;\n            case 'G': // Yellow (like our Sun)\n                color = 0xfff4ea;\n                temperature = 5500;\n                activity = 0.6;\n                break;\n            case 'K': // Orange\n                color = 0xffd2a1;\n                temperature = 4000;\n                activity = 0.5;\n                break;\n            case 'M': // Red\n                color = 0xffcc6f;\n                temperature = 3000;\n                activity = 0.4;\n                break;\n            default: // Default to G-type\n                color = 0xfff4ea;\n                temperature = 5500;\n                activity = 0.6;\n        }\n        \n        // Update material colors and parameters\n        if (this.sunMaterial) {\n            this.sunMaterial.uniforms.sunColor.value.setHex(color);\n            this.sunMaterial.uniforms.sunActivity.value = activity;\n        }\n        \n        if (this.coronaMaterial) {\n            // Adjust corona color to be slightly lighter\n            const coronaColor = new THREE.Color(color);\n            coronaColor.r = Math.min(1.0, coronaColor.r * 1.2);\n            coronaColor.g = Math.min(1.0, coronaColor.g * 1.1);\n            coronaColor.b = Math.min(1.0, coronaColor.b * 1.0);\n            this.coronaMaterial.uniforms.coronaColor.value = coronaColor;\n        }\n        \n        if (this.outerCoronaMaterial) {\n            // Adjust outer corona color\n            const outerCoronaColor = new THREE.Color(color);\n            outerCoronaColor.r = Math.min(1.0, outerCoronaColor.r * 1.3);\n            outerCoronaColor.g = Math.min(1.0, outerCoronaColor.g * 1.2);\n            outerCoronaColor.b = Math.min(1.0, outerCoronaColor.b * 1.1);\n            this.outerCoronaMaterial.uniforms.coronaColor.value = outerCoronaColor;\n        }\n        \n        // Update light color\n        if (this.sunLight) {\n            this.sunLight.color.setHex(color);\n            // Adjust light intensity based on temperature and physical units\n            this.sunLight.intensity = (200000 + (temperature / 10000) * 200000) * lightIntensityMultiplier;\n        }\n        \n        // Update lens flare colors\n        this.lensFlares.forEach((flare, index) => {\n            if (flare && flare.material) {\n                const flareColor = new THREE.Color(color);\n                // Add variations to the flare colors\n                if (index % 3 === 0) {\n                    flareColor.r = Math.min(1.0, flareColor.r * 1.2);\n                } else if (index % 3 === 1) {\n                    flareColor.g = Math.min(1.0, flareColor.g * 1.1);\n                }\n                flare.material.color = flareColor;\n            }\n        });\n        \n        console.log(`Updated sun to type ${this.sunType}, color: ${color.toString(16)}, intensity multiplier: ${lightIntensityMultiplier}`);\n    }\n    \n    getRadius() {\n        return 3000; // Return the radius of the sun's boundary (reduced from 3600)\n    }\n    \n    getPosition() {\n        return new THREE.Vector3(0, 0, 0); // Sun is at the center\n    }\n    \n    update(deltaTime = 0.016) {\n        if (!this.sun) return;\n        \n        // Update time for all shaders\n        this.time += deltaTime * 0.4; // Slow down the animation slightly\n        \n        if (this.sunMaterial && this.sunMaterial.uniforms.time) {\n            this.sunMaterial.uniforms.time.value = this.time;\n        }\n        \n        if (this.coronaMaterial && this.coronaMaterial.uniforms.time) {\n            this.coronaMaterial.uniforms.time.value = this.time;\n        }\n        \n        if (this.outerCoronaMaterial && this.outerCoronaMaterial.uniforms.time) {\n            this.outerCoronaMaterial.uniforms.time.value = this.time;\n        }\n        \n        // Add flickering effect to simulate solar activity\n        this.sunFlickerIntensity += this.sunFlickerDirection;\n        if (this.sunFlickerIntensity > 1.2) {\n            this.sunFlickerIntensity = 1.2;\n            this.sunFlickerDirection = -Math.random() * 0.03;\n        } else if (this.sunFlickerIntensity < 0.9) {\n            this.sunFlickerIntensity = 0.9;\n            this.sunFlickerDirection = Math.random() * 0.03;\n        }\n        \n        // Apply flickering to light intensity - preserve any multiplier that was applied\n        if (this.sunLight) {\n            const intensityMultiplier = this.sunLight._intensityMultiplier || 1.0;\n            const baseIntensity = this.baseLightIntensity + (this.sunType === 'G' ? 30000 : \n                                         (this.sunType === 'O' || this.sunType === 'B') ? 100000 : \n                                         (this.sunType === 'M') ? 10000 : 50000);\n            \n            // Apply view-dependent intensity adjustment\n            let viewDependentMultiplier = 1.0;\n            if (this.scene && this.scene.camera) {\n                // Calculate angle between camera and sun\n                const viewVector = new THREE.Vector3().subVectors(\n                    this.scene.camera.position,\n                    this.sun.position\n                ).normalize();\n                \n                const cameraNormal = new THREE.Vector3(0, 0, -1).applyQuaternion(this.scene.camera.quaternion);\n                const angleToCam = viewVector.dot(cameraNormal);\n                \n                // Reduce intensity when looking directly at sun to prevent overwhelming brightness\n                if (angleToCam > 0.8) {\n                    viewDependentMultiplier = 0.5 + (1.0 - angleToCam) * 0.5;\n                }\n            }\n            \n            this.sunLight.intensity = baseIntensity * this.sunFlickerIntensity * intensityMultiplier * viewDependentMultiplier;\n        }\n        \n        // Update directional light for shadow casting\n        if (this.sunDirectionalLight && this.scene && this.scene.camera) {\n            // Get camera position\n            const cameraPos = this.scene.camera.position.clone();\n            \n            // Calculate vector from sun to camera\n            const sunToCam = cameraPos.clone().sub(this.sun.position).normalize();\n            \n            // Set the directional light to point toward the camera\n            // This ensures shadows are cast in the correct direction relative to the viewer\n            const distanceFactor = 15000; // Large distance to ensure the light covers the scene\n            const lightPos = sunToCam.clone().multiplyScalar(-distanceFactor).add(this.sun.position);\n            \n            // Update light position\n            this.sunDirectionalLight.position.copy(lightPos);\n            this.sunDirectionalLight.target.position.copy(this.sun.position);\n            \n            // Ensure the target is in the scene\n            if (!this.sunDirectionalLight.target.parent) {\n                this.scene.add(this.sunDirectionalLight.target);\n            }\n            \n            // Adjust shadow camera frustum based on camera distance from sun\n            const camDistanceToSun = cameraPos.distanceTo(this.sun.position);\n            const shadowSize = Math.max(50000, camDistanceToSun * 2);\n            \n            this.sunDirectionalLight.shadow.camera.left = -shadowSize;\n            this.sunDirectionalLight.shadow.camera.right = shadowSize;\n            this.sunDirectionalLight.shadow.camera.top = shadowSize;\n            this.sunDirectionalLight.shadow.camera.bottom = -shadowSize;\n            this.sunDirectionalLight.shadow.camera.updateProjectionMatrix();\n            \n            // Apply flickering to directional light intensity as well\n            this.sunDirectionalLight.intensity = 1.5 * this.sunFlickerIntensity;\n        }\n        \n        // Update camera-relative uniforms if available\n        if (this.scene && this.scene.camera) {\n            const viewVector = new THREE.Vector3().subVectors(\n                this.scene.camera.position,\n                this.sun.position\n            ).normalize();\n            \n            if (this.coronaMaterial && this.coronaMaterial.uniforms.viewVector) {\n                this.coronaMaterial.uniforms.viewVector.value = viewVector;\n            }\n            \n            if (this.outerCoronaMaterial && this.outerCoronaMaterial.uniforms.viewVector) {\n                this.outerCoronaMaterial.uniforms.viewVector.value = viewVector;\n            }\n            \n            // Animate the flares for a more dynamic fireball effect\n            const time = this.time;\n            this.lensFlares.forEach((flare, index) => {\n                if (!flare) return;\n                \n                // Scale flares with slight pulsing\n                const pulseSpeed = 0.5 + (index % 3) * 0.3;\n                const pulseFactor = 0.9 + Math.sin(time * pulseSpeed + index) * 0.1;\n                \n                // Different behavior for the main flare vs the surrounding flares\n                if (index === 0) {\n                    // Main flare - just pulse\n                    const mainScale = 700 * pulseFactor;\n                    flare.scale.set(mainScale, mainScale, 1.0);\n                } else {\n                    // Surrounding flares - move slightly and pulse\n                    const originalSize = 200 + (index % 3) * 100;\n                    const size = originalSize * pulseFactor;\n                    flare.scale.set(size, size, 1.0);\n                    \n                    // Slightly move position in circular pattern for surrounding flares\n                    if (flare.userData.originalPos) {\n                        const orbit = 0.1 + (index % 5) * 0.05;\n                        const orbitSpeed = 0.3 + (index % 4) * 0.1;\n                        flare.position.x = flare.userData.originalPos.x + Math.sin(time * orbitSpeed) * orbit * originalSize;\n                        flare.position.y = flare.userData.originalPos.y + Math.cos(time * orbitSpeed) * orbit * originalSize;\n                    } else {\n                        // Store original position on first update\n                        flare.userData.originalPos = flare.position.clone();\n                    }\n                }\n                \n                // Adjust opacity based on camera angle \n                const angleToCam = viewVector.dot(new THREE.Vector3(0, 0, -1).applyQuaternion(this.scene.camera.quaternion));\n                \n                // More balanced opacity calculations to maintain visibility across viewing angles\n                if (angleToCam > 0.5) {\n                    // Gentler falloff when looking more directly at the sun\n                    const opacity = Math.min(1.0, (angleToCam - 0.5) / 0.3 + 0.3);\n                    flare.material.opacity = opacity;\n                    flare.visible = true;\n                } else {\n                    // Still show flares at wider angles, with less extreme falloff\n                    const reducedOpacity = Math.max(0.1, (angleToCam + 0.5) / 1.0) * 0.5;\n                    flare.material.opacity = reducedOpacity;\n                    flare.visible = true; // Always keep visible for more consistency\n                }\n            });\n        }\n    }\n    \n    // New method to toggle shadow camera helper for debugging\n    toggleShadowHelper(enabled) {\n        // Remove existing helper if any\n        if (this.shadowHelper && this.shadowHelper.parent) {\n            this.shadowHelper.parent.remove(this.shadowHelper);\n            this.shadowHelper = null;\n        }\n        \n        if (enabled && this.sunDirectionalLight && this.scene) {\n            // Create and add shadow camera helper\n            this.shadowHelper = new THREE.CameraHelper(this.sunDirectionalLight.shadow.camera);\n            this.scene.add(this.shadowHelper);\n            console.log(\"Shadow camera helper enabled - showing sun shadow frustum\");\n        }\n    }\n}","// planets.js - Creates and manages the planets in the solar system\n\nimport * as THREE from 'three';\n\n// Import TextureLoader if not already imported at the top\nconst textureLoader = new THREE.TextureLoader();\n\n// Load all planet textures\nconst planetTextures = {\n    mercury: textureLoader.load('./assets/2k_mercury.jpg'),\n    venus: {\n        surface: textureLoader.load('./assets/2k_venus_surface.jpg'),\n        atmosphere: textureLoader.load('./assets/2k_venus_atmosphere.jpg')\n    },\n    earth: textureLoader.load('./assets/2k_earth_daymap.jpg'),\n    mars: textureLoader.load('./assets/2k_mars.jpg'),\n    jupiter: textureLoader.load('./assets/2k_jupiter.jpg'),\n    saturn: {\n        surface: textureLoader.load('./assets/2k_saturn.jpg'),\n        rings: textureLoader.load('./assets/2k_saturn_ring_alpha.png')\n    },\n    uranus: textureLoader.load('./assets/2k_uranus.jpg'),\n    neptune: textureLoader.load('./assets/2k_neptune.jpg')\n};\n\n// Set the correct color space for all planet textures\nplanetTextures.mercury.colorSpace = THREE.SRGBColorSpace;\nplanetTextures.venus.surface.colorSpace = THREE.SRGBColorSpace;\nplanetTextures.venus.atmosphere.colorSpace = THREE.SRGBColorSpace;\nplanetTextures.earth.colorSpace = THREE.SRGBColorSpace;\nplanetTextures.mars.colorSpace = THREE.SRGBColorSpace;\nplanetTextures.jupiter.colorSpace = THREE.SRGBColorSpace;\nplanetTextures.saturn.surface.colorSpace = THREE.SRGBColorSpace;\nplanetTextures.saturn.rings.colorSpace = THREE.SRGBColorSpace;\nplanetTextures.uranus.colorSpace = THREE.SRGBColorSpace;\nplanetTextures.neptune.colorSpace = THREE.SRGBColorSpace;\n\n// Load the custom procedural textures (p1-p22)\nconst proceduralTextures = [];\nfor (let i = 1; i <= 22; i++) {\n    const texture = textureLoader.load(`./assets/p${i}.jpeg`);\n    texture.colorSpace = THREE.SRGBColorSpace;\n    proceduralTextures.push(texture);\n}\n\nexport class Planets {\n    constructor(scene, starSystemGenerator) {\n        this.scene = scene;\n        this.starSystemGenerator = starSystemGenerator;\n        this.planets = [];\n        this.planetRegions = {};\n        this.currentSystemId = 'Solar System'; // Default to our Solar System\n        this.systemPlanets = {};\n        \n        // Initialize our solar system planets\n        this.createHomeSolarSystem();\n    }\n    \n    // Create our home solar system (the only non-procedural system)\n    createHomeSolarSystem() {\n        // Planet data for our Solar System: name, size, distance from sun, orbit speed, color, rings\n        const solarSystemPlanets = [\n            { name: \"Mercury\", size: 220, distance: 4800, speed: 0.0016, color: 0xaaaaaa, rings: false },\n            { name: \"Venus\", size: 400, distance: 8000, speed: 0.0013, color: 0xe6cc9c, rings: false },\n            { name: \"Earth\", size: 420, distance: 12000, speed: 0.0010, color: 0x4169e1, rings: false },\n            { name: \"Mars\", size: 320, distance: 16800, speed: 0.0008, color: 0xc65d45, rings: false },\n            // Wider asteroid belt\n            { name: \"Jupiter\", size: 1000, distance: 30000, speed: 0.0004, color: 0xd6b27e, rings: true },\n            { name: \"Saturn\", size: 880, distance: 40000, speed: 0.0003, color: 0xf0e5c9, rings: true },\n            { name: \"Uranus\", size: 720, distance: 56000, speed: 0.0002, color: 0xcaecf1, rings: true },\n            { name: \"Neptune\", size: 700, distance: 72000, speed: 0.00016, color: 0x5fa3db, rings: false },\n        ];\n        \n        // Store our solar system planets for future reference\n        this.systemPlanets['Solar System'] = solarSystemPlanets;\n        \n        // Create the actual planet objects\n        this.createPlanetsForSystem('Solar System');\n    }\n    \n    // Create planet objects for the current system\n    createPlanetsForSystem(systemId) {\n        // Clear existing planets\n        this.clearPlanets();\n        \n        // Update current system\n        this.currentSystemId = systemId;\n        \n        // If we already have planet data for this system, use it\n        if (this.systemPlanets[systemId]) {\n            this.createPlanetsFromData(this.systemPlanets[systemId]);\n            return;\n        }\n        \n        // Otherwise, we need to generate planets for this system\n        const generatedPlanets = this.generatePlanetsForSystem(systemId);\n        this.systemPlanets[systemId] = generatedPlanets;\n        this.createPlanetsFromData(generatedPlanets);\n    }\n    \n    // Generate procedural planets for a new star system\n    generatePlanetsForSystem(systemId) {\n        console.log(`Generating new planets for system: ${systemId}`);\n        \n        // Check if this is a custom system with predefined planets\n        if (this.starSystemGenerator && this.starSystemGenerator.customPlanetData && this.starSystemGenerator.customPlanetData[systemId]) {\n            const customPlanets = this.starSystemGenerator.customPlanetData[systemId];\n            console.log(`Using ${customPlanets.length} custom planets for system: ${systemId}`);\n            \n            // Log the texture URLs for debugging\n            customPlanets.forEach(planet => {\n                if (planet.textureUrl) {\n                    console.log(`Custom planet ${planet.name} has texture URL: ${planet.textureUrl}`);\n                } else {\n                    console.log(`Custom planet ${planet.name} does not have a texture URL`);\n                }\n            });\n            \n            // Return the custom planet data directly\n            return this.starSystemGenerator.customPlanetData[systemId];\n        }\n        \n        // Planet name word banks for procedural generation\n        const prefixes = [\n            'New', 'Alpha', 'Beta', 'Gamma', 'Delta', 'Nova', 'Proxima', 'Ultima',\n            'Astro', 'Cosmo', 'Stella', 'Terra', 'Astra', 'Prime', 'Orb'\n        ];\n        \n        const suffixes = [\n            'sphere', 'world', 'orb', 'terra', 'oid', 'globus', 'ium', 'ian',\n            'aria', 'anth', 'urus', 'alos', 'onos', 'era', 'ax', 'is', 'os'\n        ];\n        \n        // Get a random star system data (assuming there's a starSystemGenerator with this info)\n        // This is a fallback if we don't have access to real system data\n        const starClass = systemId.includes('System-') ? systemId.split('-')[1][0] : 'M';\n        \n        // Generate between 1-8 planets for this system\n        const planetCount = 2 + Math.floor(Math.random() * 7); // 2-8 planets\n        const planetData = [];\n        \n        // Determine system characteristics based on star class\n        let sizeMultiplier = 1.0;\n        let distanceMultiplier = 1.0;\n        let colorPalette = [];\n        \n        // Adjust planet parameters based on star class\n        switch (starClass) {\n            case 'O': // Blue giants - larger planets, further apart\n                sizeMultiplier = 1.8;\n                distanceMultiplier = 1.6;\n                colorPalette = [0x6666ff, 0x9999ff, 0xccccff, 0xaaaaff, 0x8888dd];\n                break;\n            case 'B': // Blue-white stars - larger planets, varying colors\n                sizeMultiplier = 1.5;\n                distanceMultiplier = 1.3;\n                colorPalette = [0x99aaff, 0xaabbff, 0xccccff, 0xddddff, 0xbbaacc];\n                break;\n            case 'A': // White stars - medium planets\n                sizeMultiplier = 1.3;\n                distanceMultiplier = 1.1;\n                colorPalette = [0xccccff, 0xddddff, 0xeeeeff, 0xffffff, 0xddccdd];\n                break;\n            case 'F': // Yellow-white stars - Earth-like\n                sizeMultiplier = 1.1;\n                distanceMultiplier = 1.0;\n                colorPalette = [0x99aaff, 0xaaccaa, 0xccddcc, 0xffccaa, 0xeeeecc];\n                break;\n            case 'G': // Yellow stars (like our sun) - Earth-like\n                sizeMultiplier = 1.0;\n                distanceMultiplier = 1.0;\n                colorPalette = [0xaaaaaa, 0x4169e1, 0xc65d45, 0xd6b27e, 0xf0e5c9];\n                break;\n            case 'K': // Orange stars - smaller planets\n                sizeMultiplier = 0.8;\n                distanceMultiplier = 0.9;\n                colorPalette = [0xe6cc9c, 0xccaa88, 0xddbb99, 0xbb9977, 0xcc8866];\n                break;\n            case 'M': // Red dwarfs - small planets, close together\n                sizeMultiplier = 0.6;\n                distanceMultiplier = 0.7;\n                colorPalette = [0xcc6644, 0xdd7755, 0xee8866, 0xff9977, 0xbb5533];\n                break;\n            default:\n                colorPalette = [0xaaaaaa, 0x4169e1, 0xc65d45, 0xd6b27e, 0xf0e5c9];\n        }\n        \n        // Generate each planet\n        for (let i = 0; i < planetCount; i++) {\n            // Generate a random name\n            const prefix = prefixes[Math.floor(Math.random() * prefixes.length)];\n            const suffix = suffixes[Math.floor(Math.random() * suffixes.length)];\n            const name = `${prefix}${suffix}`;\n            \n            // Determine planet size (smaller planets more common)\n            const sizeClass = Math.random();\n            let size;\n            if (sizeClass < 0.5) {\n                // Small planet (50% chance)\n                size = (240 + Math.random() * 200) * sizeMultiplier; // 4x bigger: (60 + random*50) * 4\n            } else if (sizeClass < 0.8) {\n                // Medium planet (30% chance)\n                size = (440 + Math.random() * 280) * sizeMultiplier; // 4x bigger: (110 + random*70) * 4\n            } else {\n                // Large planet (20% chance)\n                size = (720 + Math.random() * 360) * sizeMultiplier; // 4x bigger: (180 + random*90) * 4\n            }\n            \n            // Distance increases with each planet, with some randomness\n            const baseDistance = 4800 + (i * 8000); // 4x bigger: (1200 + i*2000) * 4\n            const distanceVariation = baseDistance * 0.2; // 20% variation\n            const distance = (baseDistance + (Math.random() * distanceVariation - distanceVariation/2)) * distanceMultiplier;\n            \n            // Orbit speed (inversely proportional to distance)\n            const speed = 0.002 / (distance / 1000);\n            \n            // Random color from palette\n            const color = colorPalette[Math.floor(Math.random() * colorPalette.length)];\n            \n            // Chance of rings based on size (larger planets more likely to have rings)\n            const rings = size > 600 ? Math.random() < 0.4 : false; // 4x bigger threshold: 150 * 4 = 600\n            \n            // Add axial and orbital tilt\n            const axialTilt = Math.random() * Math.PI * 0.5; // Up to 90 degrees axial tilt\n            const orbitalTilt = Math.random() * Math.PI * 0.2; // Up to ~35 degrees orbital tilt\n            \n            planetData.push({\n                name,\n                size: Math.floor(size),\n                distance: Math.floor(distance),\n                speed,\n                color,\n                rings,\n                axialTilt,\n                orbitalTilt\n            });\n        }\n        \n        return planetData;\n    }\n    \n    // Create planet objects from data array\n    createPlanetsFromData(planetData) {\n        // Clear existing planets first\n        this.clearPlanets();\n        \n        planetData.forEach(planet => {\n            // Create planet\n            const planetGeometry = new THREE.SphereGeometry(planet.size, 32, 32);\n            let planetMaterial;\n            \n            // Check if this is a custom planet with its own texture\n            if (planet.textureUrl) {\n                console.log(`Creating planet ${planet.name} with custom texture: ${planet.textureUrl}`);\n                \n                // Fix texture path for API server images\n                let adjustedTextureUrl = planet.textureUrl;\n                \n                // Check if this is an image from our API server\n                if (planet.textureUrl.startsWith('/images/')) {\n                    // If running on port 8000, adjust URL to point to port 8001\n                    if (window.location.port === '8000') {\n                        const serverHost = window.location.hostname;\n                        adjustedTextureUrl = `http://${serverHost}:8001${planet.textureUrl}`;\n                        console.log(`Adjusted planet texture path to API server: ${adjustedTextureUrl}`);\n                    }\n                }\n                \n                // Load the custom texture\n                const customTexture = textureLoader.load(adjustedTextureUrl);\n                customTexture.colorSpace = THREE.SRGBColorSpace;\n                \n                // Create material with custom texture\n                planetMaterial = new THREE.MeshStandardMaterial({\n                    map: customTexture,\n                    roughness: 0.7,\n                    metalness: 0.2,\n                    flatShading: false,\n                    emissive: new THREE.Color(planet.color || 0xffffff),\n                    emissiveIntensity: 0.2,\n                    emissiveMap: customTexture\n                });\n            } else {\n                // Use standard planet textures based on planet name\n                switch(planet.name) {\n                    case \"Mercury\":\n                        planetMaterial = new THREE.MeshStandardMaterial({\n                            map: planetTextures.mercury,\n                            roughness: 0.7,\n                            metalness: 0.2,\n                            flatShading: false,\n                            emissive: new THREE.Color(0x555555),\n                            emissiveIntensity: 0.2,\n                            emissiveMap: planetTextures.mercury\n                        });\n                        break;\n                        \n                    case \"Venus\":\n                        // Create Venus with surface and atmosphere\n                        planetMaterial = new THREE.MeshStandardMaterial({\n                            map: planetTextures.venus.surface,\n                            roughness: 0.6,\n                            metalness: 0.1,\n                            flatShading: false,\n                            emissive: new THREE.Color(0xe6cc9c),\n                            emissiveIntensity: 0.25,\n                            emissiveMap: planetTextures.venus.surface\n                        });\n                        break;\n                        \n                    case \"Earth\":\n                        planetMaterial = new THREE.MeshStandardMaterial({\n                            map: planetTextures.earth,\n                            roughness: 0.5,\n                            metalness: 0.1,\n                            flatShading: false,\n                            emissive: new THREE.Color(0x4169e1),\n                            emissiveIntensity: 0.2,\n                            emissiveMap: planetTextures.earth\n                        });\n                        break;\n                        \n                    case \"Mars\":\n                        planetMaterial = new THREE.MeshStandardMaterial({\n                            map: planetTextures.mars,\n                            roughness: 0.7,\n                            metalness: 0.1,\n                            flatShading: false,\n                            emissive: new THREE.Color(0xc65d45),\n                            emissiveIntensity: 0.25,\n                            emissiveMap: planetTextures.mars\n                        });\n                        break;\n                        \n                    case \"Jupiter\":\n                        planetMaterial = new THREE.MeshStandardMaterial({\n                            map: planetTextures.jupiter,\n                            roughness: 0.5,\n                            metalness: 0.0,\n                            flatShading: false,\n                            emissive: new THREE.Color(0xd6b27e),\n                            emissiveIntensity: 0.2,\n                            emissiveMap: planetTextures.jupiter\n                        });\n                        break;\n                        \n                    case \"Saturn\":\n                        planetMaterial = new THREE.MeshStandardMaterial({\n                            map: planetTextures.saturn.surface,\n                            roughness: 0.6,\n                            metalness: 0.1,\n                            flatShading: false,\n                            emissive: new THREE.Color(0xf0e5c9),\n                            emissiveIntensity: 0.2,\n                            emissiveMap: planetTextures.saturn.surface\n                        });\n                        break;\n                        \n                    case \"Uranus\":\n                        planetMaterial = new THREE.MeshStandardMaterial({\n                            map: planetTextures.uranus,\n                            roughness: 0.5,\n                            metalness: 0.0,\n                            flatShading: false,\n                            emissive: new THREE.Color(0x88bbcc),\n                            emissiveIntensity: 0.25,\n                            emissiveMap: planetTextures.uranus\n                        });\n                        break;\n                        \n                    case \"Neptune\":\n                        planetMaterial = new THREE.MeshStandardMaterial({\n                            map: planetTextures.neptune,\n                            roughness: 0.5,\n                            metalness: 0.0,\n                            flatShading: false,\n                            emissive: new THREE.Color(0x5fa3db),\n                            emissiveIntensity: 0.25,\n                            emissiveMap: planetTextures.neptune\n                        });\n                        break;\n                        \n                    default:\n                        // For other planets, use a procedural texture from the collection\n                        const textureIndex = Math.floor(Math.random() * proceduralTextures.length);\n                        planetMaterial = new THREE.MeshStandardMaterial({\n                            map: proceduralTextures[textureIndex],\n                            roughness: 0.6,\n                            metalness: 0.2,\n                            color: new THREE.Color(planet.color),\n                            flatShading: false,\n                            emissive: new THREE.Color(planet.color),\n                            emissiveIntensity: 0.3,\n                            emissiveMap: proceduralTextures[textureIndex]\n                        });\n                        break;\n                }\n            }\n            \n            // Create the planet mesh\n            const planetMesh = new THREE.Mesh(planetGeometry, planetMaterial);\n            \n            // Position the planet at its orbital distance\n            const angle = Math.random() * Math.PI * 2;\n            \n            // Apply orbital tilt if specified\n            let orbitalTilt = planet.orbitalTilt || 0;\n            let axialTilt = planet.axialTilt || 0;\n            \n            // Position planet with orbital tilt\n            planetMesh.position.x = Math.cos(angle) * planet.distance;\n            planetMesh.position.y = Math.sin(orbitalTilt) * planet.distance;\n            planetMesh.position.z = Math.sin(angle) * Math.cos(orbitalTilt) * planet.distance;\n            \n            // Apply axial tilt to planet rotation\n            planetMesh.rotation.x = axialTilt;\n            \n            // Enable shadows for eclipse effects\n            planetMesh.castShadow = true;\n            planetMesh.receiveShadow = true;\n            \n            // Add the planet to the scene\n            this.scene.add(planetMesh);\n            \n            // Create planet rings if specified\n            if (planet.rings) {\n                let ringGeometry, ringMaterial, ringMesh;\n                \n                // Special case for Saturn\n                if (planet.name === \"Saturn\") {\n                    // Create ring geometry\n                    ringGeometry = new THREE.RingGeometry(planet.size * 1.4, planet.size * 2.0, 32);\n                    \n                    // Create custom material for Saturn with transparency\n                    ringMaterial = new THREE.MeshStandardMaterial({\n                        map: planetTextures.saturn.rings,\n                        side: THREE.DoubleSide,\n                        transparent: true,\n                        opacity: 0.8,\n                        roughness: 0.8,\n                        metalness: 0.1,\n                        emissive: new THREE.Color(0xf0e5c9),\n                        emissiveIntensity: 0.2,\n                        emissiveMap: planetTextures.saturn.rings\n                    });\n                } else {\n                    // Generic rings for other planets\n                    ringGeometry = new THREE.RingGeometry(planet.size * 1.3, planet.size * 1.8, 32);\n                    ringMaterial = new THREE.MeshStandardMaterial({\n                        color: planet.color,\n                        side: THREE.DoubleSide,\n                        transparent: true,\n                        opacity: 0.4,\n                        roughness: 0.7,\n                        metalness: 0.2,\n                        emissive: new THREE.Color(planet.color),\n                        emissiveIntensity: 0.3\n                    });\n                }\n                \n                ringMesh = new THREE.Mesh(ringGeometry, ringMaterial);\n                \n                // Rotate rings to be flat (perpendicular to y-axis)\n                ringMesh.rotation.x = Math.PI / 2;\n                \n                // Enable shadows for rings\n                ringMesh.castShadow = true;\n                ringMesh.receiveShadow = true;\n                \n                // Add rings to planet\n                planetMesh.add(ringMesh);\n            }\n            \n            // Store planet data for orbiting\n            this.planets.push({\n                mesh: planetMesh,\n                distance: planet.distance,\n                speed: planet.speed,\n                angle: angle,\n                orbitalTilt: orbitalTilt\n            });\n            \n            // Store planet regions for game mechanics\n            this.planetRegions[planet.name] = {\n                name: planet.name,\n                position: planetMesh.position.clone(),\n                radius: planet.size * 2\n            };\n        });\n    }\n    \n    // Clear all existing planets\n    clearPlanets() {\n        // Remove planets from scene and clear arrays\n        this.planets.forEach(planet => {\n            this.scene.remove(planet.mesh);\n        });\n        \n        this.planets = [];\n        this.planetRegions = {};\n    }\n    \n    // Set up planet system for specified star system\n    updateForSystem(systemId) {\n        console.log(`Updating planets for system: ${systemId}`);\n        \n        // Generate and create planets for this system if we haven't already\n        this.createPlanetsForSystem(systemId);\n        \n        // Return true to indicate success\n        return true;\n    }\n    \n    getPlanetRegions() {\n        return this.planetRegions;\n    }\n    \n    getPlanets() {\n        return this.planets;\n    }\n    \n    update(deltaTime) {\n        // Update planet orbits\n        this.planets.forEach(planet => {\n            // Update orbit angle based on speed\n            planet.angle += planet.speed * deltaTime;\n            \n            // Calculate new position\n            planet.mesh.position.x = Math.cos(planet.angle) * planet.distance;\n            planet.mesh.position.z = Math.sin(planet.angle) * Math.cos(planet.orbitalTilt) * planet.distance;\n            planet.mesh.position.y = Math.sin(planet.angle) * Math.sin(planet.orbitalTilt) * planet.distance;\n            \n            // Rotate the planet\n            planet.mesh.rotation.y += deltaTime * 0.1;\n            \n            // FIXED: Update planet region for location tracking\n            // Use the planet mesh's position directly to find the matching planet region\n            // since the planet object doesn't contain the name property\n            if (planet.mesh) {\n                // Iterate through planet regions and find the one with a position matching this planet\n                Object.values(this.planetRegions).forEach(region => {\n                    if (region && region.position) {\n                        // Check if this region position is close to the planet position\n                        // If it's very close, it's likely the same planet\n                        const distance = region.position.distanceTo(planet.mesh.position);\n                        if (distance < 5000) { // A reasonable threshold\n                            region.position.copy(planet.mesh.position);\n                        }\n                    }\n                });\n            }\n        });\n    }\n}","// asteroidBelt.js - Creates and manages the asteroid belt\n\nimport * as THREE from 'three';\n\nexport class AsteroidBelt {\n    constructor(scene) {\n        this.scene = scene;\n        this.asteroids = [];\n        this.innerRadius = 20000;\n        this.outerRadius = 28000;\n        this.width = 1800;\n        this.resourceMultipliers = { iron: 1.0, gold: 1.0, platinum: 1.0 };\n        \n        this.createAsteroidBelt();\n    }\n    \n    createAsteroidBelt() {\n        const asteroidCount = 1000;\n        \n        for (let i = 0; i < asteroidCount; i++) {\n            // Random asteroid size - Much larger for better visibility\n            const size = Math.random() * 120 + 120; // Dramatically increased size for visibility\n            \n            // Use different geometries for variety\n            let geometry;\n            const type = Math.floor(Math.random() * 3);\n            if (type === 0) {\n                geometry = new THREE.IcosahedronGeometry(size, 0);\n            } else if (type === 1) {\n                geometry = new THREE.TetrahedronGeometry(size, 0);\n            } else {\n                geometry = new THREE.OctahedronGeometry(size, 0);\n            }\n            \n            // Deform the geometry to make it look more like an asteroid\n            const positions = geometry.attributes.position;\n            for (let j = 0; j < positions.count; j++) {\n                const vertex = new THREE.Vector3();\n                vertex.fromBufferAttribute(positions, j);\n                \n                // Add some random bumps\n                vertex.x += (Math.random() - 0.5) * 0.4 * size;\n                vertex.y += (Math.random() - 0.5) * 0.4 * size;\n                vertex.z += (Math.random() - 0.5) * 0.4 * size;\n                \n                positions.setXYZ(j, vertex.x, vertex.y, vertex.z);\n            }\n            \n            // Update geometry\n            geometry.computeVertexNormals();\n            \n            // Material with different color variations - brighter for better visibility\n            const color = new THREE.Color();\n            const resourceRoll = Math.random();\n            let resourceType = null;\n            \n            // Determine resource type based on probability\n            if (resourceRoll < 0.7) {\n                // 70% iron asteroids (common) - brightened\n                color.setHSL(0.02, 0.30, 0.35 + Math.random() * 0.2); // Much brighter\n                resourceType = 'iron';\n            } else if (resourceRoll < 0.93) {\n                // 23% gold asteroids (uncommon) - brightened\n                color.setHSL(0.12, 0.7, 0.5 + Math.random() * 0.2); // Much brighter\n                resourceType = 'gold';\n            } else {\n                // 7% platinum asteroids (rare) - brightened\n                color.setHSL(0.1, 0.3, 0.7 + Math.random() * 0.15); // Much brighter\n                resourceType = 'platinum';\n            }\n            \n            // Enhanced material with higher emissive properties for better visibility\n            const material = new THREE.MeshStandardMaterial({\n                color: color,\n                roughness: 0.6 + Math.random() * 0.2, // Reduced roughness\n                metalness: 0.4 + Math.random() * 0.4, // Increased metalness\n                flatShading: true,\n                emissive: color.clone().multiplyScalar(0.3), // Add emissive glow\n                emissiveIntensity: 0.2 // Subtle glow for better visibility\n            });\n            \n            // Create the mesh\n            const mesh = new THREE.Mesh(geometry, material);\n            \n            // Position in asteroid belt with variation using torus pattern\n            const angle = Math.random() * Math.PI * 2;\n            const radius = this.innerRadius + Math.random() * (this.outerRadius - this.innerRadius);\n            const heightVariation = (Math.random() - 0.5) * this.width;\n            \n            mesh.position.set(\n                Math.cos(angle) * radius,\n                heightVariation,\n                Math.sin(angle) * radius\n            );\n            \n            // Apply random axial tilt (rotation on local axis)\n            mesh.rotation.set(\n                Math.random() * Math.PI,\n                Math.random() * Math.PI,\n                Math.random() * Math.PI\n            );\n            \n            // Setup orbital parameters\n            const orbitSpeed = 0.0001 + Math.random() * 0.0001; // Slow orbit\n            const orbitRadius = radius; // Use initial radius\n            \n            // Add random orbital tilt\n            const orbitTilt = Math.random() * Math.PI * 0.15; // Reduced to ~27 degrees max tilt\n            \n            // Add to scene\n            this.scene.add(mesh);\n            \n            // Add to asteroids array with metadata\n            const baseResourceAmount = 50 + Math.random() * 50; // Base amount before multipliers\n            this.asteroids.push({\n                mesh: mesh,\n                size: size,\n                orbitSpeed: orbitSpeed,\n                orbitRadius: orbitRadius,\n                orbitAngle: angle,\n                orbitTilt: orbitTilt,\n                initialHeight: heightVariation, // Store initial height variation\n                rotationSpeed: {\n                    x: (Math.random() - 0.5) * 0.005,\n                    y: (Math.random() - 0.5) * 0.005,\n                    z: (Math.random() - 0.5) * 0.005\n                },\n                resourceType: resourceType,\n                baseResourceAmount: baseResourceAmount, // Base amount\n                resourceAmount: baseResourceAmount, // Current amount\n                maxResourceAmount: baseResourceAmount, // Max capacity\n                minable: true\n            });\n        }\n    }\n    \n    getRegionInfo() {\n        return {\n            center: new THREE.Vector3(0, 0, 0),\n            innerRadius: this.innerRadius,\n            outerRadius: this.outerRadius\n        };\n    }\n    \n    getAsteroids() {\n        return this.asteroids;\n    }\n    \n    // Set resource multipliers based on the current star system\n    setResourceMultipliers(multipliers) {\n        if (!multipliers) return;\n        this.resourceMultipliers = multipliers;\n        \n        // Update existing asteroids with new resource distributions\n        this.updateAsteroidResources();\n        console.log(\"Updated asteroid belt with resource multipliers:\", multipliers);\n    }\n    \n    // Update asteroid resources based on current system\n    updateAsteroidResources() {\n        this.asteroids.forEach(asteroid => {\n            if (asteroid.resourceType) {\n                // Apply system-specific multipliers to resource amounts\n                switch (asteroid.resourceType) {\n                    case 'iron':\n                        asteroid.resourceAmount = asteroid.baseResourceAmount * this.resourceMultipliers.iron;\n                        break;\n                    case 'gold':\n                        asteroid.resourceAmount = asteroid.baseResourceAmount * this.resourceMultipliers.gold;\n                        break;\n                    case 'platinum':\n                        asteroid.resourceAmount = asteroid.baseResourceAmount * this.resourceMultipliers.platinum;\n                        break;\n                }\n            }\n        });\n    }\n    \n    // Update asteroid density based on system characteristics\n    updateForSystem(params) {\n        if (!params) return;\n        \n        // Update density if provided\n        if (params.asteroidDensity) {\n            this.updateDensity(params.asteroidDensity);\n        }\n        \n        // Update resource distribution if provided\n        if (params.resourceMultipliers) {\n            this.setResourceMultipliers(params.resourceMultipliers);\n        }\n    }\n    \n    // Update asteroid density\n    updateDensity(densityMultiplier = 1.0) {\n        if (densityMultiplier < 0.5) densityMultiplier = 0.5; // Minimum density\n        if (densityMultiplier > 3.0) densityMultiplier = 3.0; // Maximum density\n        \n        // Adjust asteroid visibility based on density\n        this.asteroids.forEach((asteroid, index) => {\n            // Use index to ensure consistent visibility\n            const shouldBeVisible = (index % 10) < (densityMultiplier * 5);\n            asteroid.mesh.visible = shouldBeVisible;\n        });\n    }\n    \n    // Helper function to find the closest asteroid to a point (for mining)\n    findClosestAsteroid(position, maxDistance = 1600) {\n        let closestAsteroid = null;\n        let closestDistance = maxDistance;\n        \n        this.asteroids.forEach(asteroid => {\n            // Skip asteroids that aren't minable or visible\n            if (!asteroid.minable || !asteroid.mesh.visible) return;\n            \n            const distance = position.distanceTo(asteroid.mesh.position);\n            if (distance < closestDistance) {\n                closestDistance = distance;\n                closestAsteroid = asteroid;\n            }\n        });\n        \n        return closestAsteroid;\n    }\n    \n    removeAsteroid(asteroid) {\n        // Remove the asteroid from the scene\n        this.scene.remove(asteroid.mesh);\n        \n        // Remove from asteroid array\n        const index = this.asteroids.findIndex(a => a === asteroid);\n        if (index !== -1) {\n            this.asteroids.splice(index, 1);\n        }\n    }\n    \n    update() {\n        // Update asteroid positions and rotations with orbital tilt\n        this.asteroids.forEach(asteroid => {\n            // Rotate the asteroid (axial rotation)\n            asteroid.mesh.rotation.x += asteroid.rotationSpeed.x;\n            asteroid.mesh.rotation.y += asteroid.rotationSpeed.y;\n            asteroid.mesh.rotation.z += asteroid.rotationSpeed.z;\n            \n            // Orbit around sun with tilt\n            asteroid.orbitAngle += asteroid.orbitSpeed;\n            \n            // Calculate orbit position with tilt\n            const flatX = Math.cos(asteroid.orbitAngle) * asteroid.orbitRadius;\n            const flatZ = Math.sin(asteroid.orbitAngle) * asteroid.orbitRadius;\n            \n            // Apply orbit tilt if it exists\n            if (asteroid.orbitTilt) {\n                // Apply orbital tilt by rotating the position around the X axis\n                const tiltY = flatZ * Math.sin(asteroid.orbitTilt);\n                const tiltZ = flatZ * Math.cos(asteroid.orbitTilt);\n                \n                asteroid.mesh.position.x = flatX;\n                asteroid.mesh.position.z = tiltZ;\n                asteroid.mesh.position.y = tiltY + asteroid.initialHeight; // Use stored initial height variation\n            } else {\n                // Regular orbit\n                asteroid.mesh.position.x = flatX;\n                asteroid.mesh.position.z = flatZ;\n                asteroid.mesh.position.y = asteroid.initialHeight;\n            }\n        });\n    }\n}","// stargate.js - Creates and manages the stargate\n\nimport * as THREE from 'three';\n\nexport class Stargate {\n    constructor(scene) {\n        this.scene = scene;\n        this.stargate = null;\n        this.navLights = [];\n        this.portalParticles = [];\n        this.createStargate();\n    }\n    \n    createStargate() {\n        // Create a stargate group\n        const stargateGroup = new THREE.Group();\n        stargateGroup.name = 'stargate';\n        \n        // Main ring - matte black\n        const ringGeometry = new THREE.TorusGeometry(1000, 200, 32, 100);\n        const ringMaterial = new THREE.MeshStandardMaterial({\n          color: 0x111111,\n          roughness: 0.9,\n          metalness: 0.1,\n          emissive: 0x000000\n        });\n        const ring = new THREE.Mesh(ringGeometry, ringMaterial);\n        stargateGroup.add(ring);\n        \n        // Neon turquoise accent rings\n        const createAccentRing = (radius, tubeRadius, position = {x: 0, y: 0, z: 0}, rotation = {x: 0, y: 0, z: 0}) => {\n          const geometry = new THREE.TorusGeometry(radius, tubeRadius, 16, 100);\n          const material = new THREE.MeshStandardMaterial({\n            color: 0x00ffff,\n            emissive: 0x00ffff,\n            emissiveIntensity: 1.5,\n            roughness: 0.2,\n            metalness: 0.8\n          });\n          const accentRing = new THREE.Mesh(geometry, material);\n          accentRing.position.set(position.x, position.y, position.z);\n          accentRing.rotation.set(rotation.x, rotation.y, rotation.z);\n          return accentRing;\n        };\n        \n        // Add accent rings on outer edges - make them brighter\n        const outerRing1 = createAccentRing(1060, 10);\n        const outerRing2 = createAccentRing(940, 10);\n        // Add an inner ring to enhance portal effect\n        const innerRing = createAccentRing(850, 5);\n        stargateGroup.add(outerRing1);\n        stargateGroup.add(outerRing2);\n        stargateGroup.add(innerRing);\n        \n        // Create enhanced turquoise portal in the center\n        this.createPortalEffect(stargateGroup);\n        \n        // Add neon accent details\n        const detailsGroup = this.createNeonDetails();\n        stargateGroup.add(detailsGroup);\n        \n        // Position the stargate at 2x height from the original position\n        stargateGroup.position.set(0, 10000, 0);\n        stargateGroup.rotation.x = Math.PI / 2; // Horizontal orientation\n        \n        // Add to scene\n        this.scene.add(stargateGroup);\n        this.stargate = stargateGroup;\n        \n        // Create a counter-rotating inner ring for additional portal effect\n        this.createCounterRotatingRing(stargateGroup);\n    }\n    \n    createCounterRotatingRing(parentGroup) {\n        // Create a separate rotating group for the inner portal structure\n        const innerStructure = new THREE.Group();\n        \n        // Add a thin ring that rotates opposite to the main stargate\n        const thinRingGeometry = new THREE.TorusGeometry(820, 3, 16, 100);\n        const thinRingMaterial = new THREE.MeshStandardMaterial({\n            color: 0x00ffff,\n            emissive: 0x00ffff,\n            emissiveIntensity: 2,\n            roughness: 0.1,\n            metalness: 0.9,\n            transparent: true,\n            opacity: 0.7\n        });\n        \n        // Create 3 counter-rotating rings\n        for (let i = 0; i < 3; i++) {\n            const ring = new THREE.Mesh(thinRingGeometry, thinRingMaterial.clone());\n            ring.rotation.x = Math.PI * i / 3;\n            ring.rotation.y = Math.PI * i / 3;\n            innerStructure.add(ring);\n        }\n        \n        parentGroup.add(innerStructure);\n        this.counterRotatingRing = innerStructure;\n    }\n    \n    createPortalEffect(parentGroup) {\n        // Enhanced custom shader material for the portal\n        const portalShaderMaterial = new THREE.ShaderMaterial({\n          uniforms: {\n            time: { value: 0 },\n            resolution: { value: new THREE.Vector2(1024, 1024) },\n            baseColor: { value: new THREE.Color(0x00ffff) }\n          },\n          vertexShader: `\n            varying vec2 vUv;\n            \n            void main() {\n              vUv = uv;\n              gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n            }\n          `,\n          fragmentShader: `\n            uniform float time;\n            uniform vec2 resolution;\n            uniform vec3 baseColor;\n            varying vec2 vUv;\n            \n            // Simple noise function\n            float noise(vec2 p) {\n              return fract(sin(dot(p, vec2(12.9898, 78.233))) * 43758.5453);\n            }\n            \n            // Smoothed noise\n            float smoothNoise(vec2 p) {\n              vec2 ip = floor(p);\n              vec2 fp = fract(p);\n              \n              vec2 u = fp * fp * (3.0 - 2.0 * fp);\n              \n              float a = noise(ip);\n              float b = noise(ip + vec2(1.0, 0.0));\n              float c = noise(ip + vec2(0.0, 1.0));\n              float d = noise(ip + vec2(1.0, 1.0));\n              \n              return mix(mix(a, b, u.x), mix(c, d, u.x), u.y);\n            }\n            \n            // Fractal Brownian Motion\n            float fbm(vec2 p) {\n              float value = 0.0;\n              float amplitude = 0.5;\n              float frequency = 3.0;\n              \n              for (int i = 0; i < 6; i++) {\n                value += amplitude * smoothNoise(p * frequency);\n                amplitude *= 0.5;\n                frequency *= 2.0;\n              }\n              \n              return value;\n            }\n            \n            void main() {\n              // Convert uv to be centered at (0.5, 0.5) with range -1 to 1\n              vec2 centeredUV = (vUv - 0.5) * 2.0;\n              float dist = length(centeredUV);\n              \n              // Create angle for rotation\n              float angle = atan(centeredUV.y, centeredUV.x);\n              \n              // Enhanced swirling effect parameters - more aggressive\n              float swirl = sin(angle * 6.0 + time * 2.0) * 0.5 + 0.5;\n              float pulse = sin(time * 0.8) * 0.5 + 0.5;\n              \n              // Create more distorted coordinates for noise - enhances warp feel\n              vec2 distortedUV = vec2(\n                centeredUV.x + sin(time * 0.7 + centeredUV.y * 5.0) * 0.2,\n                centeredUV.y + cos(time * 0.6 + centeredUV.x * 5.0) * 0.2\n              );\n              \n              // Create noise patterns - more contrast\n              float noiseValue = fbm(distortedUV * 3.0 + time * 0.3);\n              float ripple = sin(dist * 20.0 - time * 3.0) * 0.5 + 0.5;\n              \n              // Combine effects with more intensity\n              float alpha = smoothstep(0.9, 0.0, dist);\n              float intensity = mix(noiseValue, ripple, 0.7) * swirl * pulse;\n              \n              // Enhanced portal colors - bright cyan to deep blue\n              vec3 darkColor = vec3(0.0, 0.1, 0.3);\n              vec3 brightColor = vec3(0.0, 1.0, 1.0) * 2.0;\n              vec3 accentColor = vec3(0.3, 0.8, 1.0);\n              \n              // More complex color mixing\n              vec3 finalColor = mix(darkColor, brightColor, intensity);\n              finalColor = mix(finalColor, accentColor, ripple * swirl);\n              \n              // Enhanced edge glow for portal effect\n              float edgeGlow = smoothstep(0.8, 0.4, dist) * smoothstep(0.0, 0.6, dist);\n              finalColor = mix(finalColor, brightColor, edgeGlow * pulse);\n              \n              // Add portal event horizon effect\n              float eventHorizon = smoothstep(0.8, 0.78, dist) * 2.0;\n              finalColor += vec3(0.0, 1.0, 1.0) * eventHorizon;\n              \n              gl_FragColor = vec4(finalColor, alpha);\n            }\n          `,\n          transparent: true,\n          side: THREE.DoubleSide\n        });\n        \n        // Create portal disc using the shader material\n        const portalGeometry = new THREE.CircleGeometry(800, 128);\n        const portal = new THREE.Mesh(portalGeometry, portalShaderMaterial);\n        parentGroup.add(portal);\n        \n        // Enhanced portal glow light\n        const portalLight = new THREE.PointLight(0x00ffff, 400, 2000, 2);\n        portalLight.position.set(0, 0, 0);\n        parentGroup.add(portalLight);\n        \n        // Add some more volumetric effects around the portal\n        const createPortalWisps = () => {\n          const wispGeometry = new THREE.TorusGeometry(650, 10, 8, 100);\n          const wispMaterial = new THREE.MeshStandardMaterial({\n            color: 0x00ffff,\n            emissive: 0x00ffff,\n            emissiveIntensity: 2,\n            transparent: true,\n            opacity: 0.3,\n            side: THREE.DoubleSide\n          });\n        \n          const wisp = new THREE.Mesh(wispGeometry, wispMaterial);\n          wisp.rotation.x = Math.random() * Math.PI;\n          wisp.rotation.y = Math.random() * Math.PI;\n          \n          // Store animation parameters - more dramatic for enhanced effect\n          wisp.userData = {\n            rotationSpeed: {\n              x: (Math.random() - 0.5) * 0.02,  // 10x faster rotation\n              y: (Math.random() - 0.5) * 0.02,\n              z: (Math.random() - 0.5) * 0.02\n            },\n            pulseSpeed: 0.5 + Math.random() * 0.3\n          };\n          \n          this.portalParticles.push(wisp);\n          return wisp;\n        };\n        \n        // Add more wisps for enhanced effect\n        for (let i = 0; i < 8; i++) {\n          parentGroup.add(createPortalWisps());\n        }\n        \n        // Store the shader material for animation updates\n        this.portalShaderMaterial = portalShaderMaterial;\n        this.portalLight = portalLight;\n    }\n  \n    createNeonDetails() {\n        const detailsGroup = new THREE.Group();\n        \n        // Create evenly spaced neon accents around the ring\n        const createNeonAccent = (angle) => {\n          const accentGroup = new THREE.Group();\n          \n          // Neon light beam\n          const beamGeometry = new THREE.CylinderGeometry(10, 10, 300, 8);\n          const beamMaterial = new THREE.MeshStandardMaterial({\n            color: 0x00ffff,\n            emissive: 0x00ffff,\n            emissiveIntensity: 1,\n            transparent: true,\n            opacity: 0.8\n          });\n          const beam = new THREE.Mesh(beamGeometry, beamMaterial);\n          beam.rotation.x = Math.PI / 2; // Align with ring\n          \n          // Light source for glow\n          const light = new THREE.PointLight(0x00ffff, 100, 400, 2);\n          light.position.set(0, 0, 0);\n          \n          accentGroup.add(beam);\n          accentGroup.add(light);\n          \n          // Position on the ring\n          accentGroup.position.x = Math.cos(angle) * 1000;\n          accentGroup.position.y = Math.sin(angle) * 1000;\n          accentGroup.rotation.z = angle - Math.PI / 2; // Orient toward center\n          \n          // Store for animation\n          light.userData = {\n            originalIntensity: light.intensity,\n            phase: Math.random() * Math.PI * 2\n          };\n          \n          this.navLights.push({ light, lightMesh: beam });\n          \n          return accentGroup;\n        };\n        \n        // Add 8 neon accents evenly around the ring\n        for (let i = 0; i < 8; i++) {\n          const angle = (i / 8) * Math.PI * 2;\n          detailsGroup.add(createNeonAccent(angle));\n        }\n        \n        return detailsGroup;\n    }\n    \n    getPosition() {\n        // Updated to 2x height from the sun\n        return new THREE.Vector3(0, 10000, 0);\n    }\n    \n    getRegionInfo() {\n        // Updated center position to match new height\n        return {\n            center: new THREE.Vector3(0, 10000, 0),\n            radius: 2000\n        };\n    }\n    \n    update() {\n        // Animate navigation lights with pulsing effect\n        if (this.navLights) {\n          this.navLights.forEach(({ light, lightMesh }) => {\n                const time = Date.now() * 0.001;\n                const flicker = 0.7 + 0.3 * Math.sin(time * 2 + light.userData.phase);\n                \n                light.intensity = light.userData.originalIntensity * flicker;\n                \n            // Also update the light beam material\n            if (lightMesh.material) {\n              lightMesh.material.emissiveIntensity = flicker;\n              lightMesh.material.opacity = 0.5 + (flicker * 0.5);\n            }\n          });\n        }\n        \n        // Update shader time for the portal effect\n        if (this.portalShaderMaterial) {\n          this.portalShaderMaterial.uniforms.time.value = Date.now() * 0.001;\n          \n          // Make portal light pulse with time\n          if (this.portalLight) {\n            const time = Date.now() * 0.001;\n            this.portalLight.intensity = 400 + Math.sin(time * 2.0) * 150;\n          }\n        }\n        \n        // Animate the portal wisp effects\n        if (this.portalParticles) {\n          this.portalParticles.forEach(particle => {\n            const time = Date.now() * 0.001;\n            \n            // Apply rotation based on stored rotation speeds\n            if (particle.userData.rotationSpeed) {\n              particle.rotation.x += particle.userData.rotationSpeed.x;\n              particle.rotation.y += particle.userData.rotationSpeed.y;\n              particle.rotation.z += particle.userData.rotationSpeed.z;\n            }\n            \n            // Apply subtle scale pulsing if present\n            if (particle.userData.pulseSpeed) {\n              const pulse = 0.9 + 0.2 * Math.sin(time * particle.userData.pulseSpeed);\n              particle.scale.set(pulse, pulse, pulse);\n            }\n          });\n        }\n        \n        // Update counter-rotating ring\n        if (this.counterRotatingRing) {\n          this.counterRotatingRing.rotation.x += 0.006; // Counter rotate\n          this.counterRotatingRing.rotation.y += 0.009;\n          this.counterRotatingRing.rotation.z -= 0.003;\n        }\n        \n        // Rotate the stargate on all three axes for a more dynamic spinning effect (30x faster)\n        if (this.stargate) {\n          this.stargate.rotation.x += 0.003;   // 30x faster rotation on X axis (was 0.0001)\n          this.stargate.rotation.y += 0.0045;  // 30x faster rotation on Y axis (was 0.00015)\n          this.stargate.rotation.z += 0.006;   // 30x faster rotation on Z axis (was 0.0002)\n        }\n    }\n} ","// starSystemGenerator.js - Procedural generation of star systems\n\nimport * as THREE from 'three';\n\nexport class StarSystemGenerator {\n    constructor(scene) {\n        this.scene = scene;\n        this.systems = {}; // Stores all generated star systems\n        this.currentSystem = null; // Currently active system\n        this.warpGates = {}; // Map of connections between systems\n        this.starClasses = ['O', 'B', 'A', 'F', 'G', 'K', 'M']; // Star classification\n        this.systemClassifications = [\n            'Resource-Rich', \n            'Ancient', \n            'Unstable', \n            'Barren', \n            'Hazardous', \n            'Peaceful'\n        ];\n        \n        // Available skybox textures for non-Solar systems\n        this.skyboxTextures = [\n            './assets/s1.jpg',\n            './assets/s2.jpg',\n            './assets/s3.jpg',\n            './assets/s4.jpg',\n            './assets/s5.jpg',\n            './assets/s6.jpg',\n            './assets/s7.jpg',\n            './assets/s8.jpg',\n            './assets/s9.jpg'\n        ];\n        \n        // Resource distribution by star type\n        this.resourceDistribution = {\n            'O': { iron: 0.3, gold: 0.4, platinum: 0.3 }, // Hot blue stars - balanced\n            'B': { iron: 0.2, gold: 0.3, platinum: 0.5 }, // Blue-white - platinum rich\n            'A': { iron: 0.2, gold: 0.5, platinum: 0.3 }, // White - gold rich\n            'F': { iron: 0.3, gold: 0.4, platinum: 0.3 }, // Yellow-white - balanced\n            'G': { iron: 0.4, gold: 0.3, platinum: 0.3 }, // Yellow (like our sun) - iron rich\n            'K': { iron: 0.5, gold: 0.3, platinum: 0.2 }, // Orange - iron rich\n            'M': { iron: 0.6, gold: 0.2, platinum: 0.2 }  // Red dwarfs - iron rich\n        };\n        \n        // Resource multipliers by system classification\n        this.classificationMultipliers = {\n            'Resource-Rich': { iron: 2.0, gold: 2.0, platinum: 2.0 },\n            'Ancient': { iron: 1.0, gold: 1.5, platinum: 2.5 },\n            'Unstable': { iron: 1.0, gold: 1.0, platinum: 3.0 },\n            'Barren': { iron: 0.5, gold: 0.5, platinum: 0.5 },\n            'Hazardous': { iron: 1.5, gold: 1.5, platinum: 1.5 },\n            'Peaceful': { iron: 1.0, gold: 1.0, platinum: 1.0 },\n            'Home System': { iron: 1.0, gold: 1.0, platinum: 1.0 }\n        };\n        \n        // Initialize the system\n        this.initializeSystems();\n    }\n    \n    // Initialize star systems with Solar System as default\n    initializeSystems() {\n        console.log(\"Initializing star systems...\");\n        \n        // First create our Solar System as the starting point\n        this.createSolarSystem();\n        \n        // Generate a few more star systems\n        this.generateRandomSystems(5);\n        \n        // Create connections between systems via warp gates\n        this.createSystemConnections();\n        \n        // Set Solar System as current system\n        this.setCurrentSystem('Solar System');\n        \n        console.log(\"Star systems initialized\");\n    }\n    \n    // Create our Solar System\n    createSolarSystem() {\n        // Add solar system with predefined properties and Earth as special planet\n        const solarSystem = {\n            id: 'Solar System',\n            name: 'Solar System',\n            starClass: 'G',\n            classification: 'Home System',\n            starColor: 0xFFFF00, // Yellow sun\n            planetCount: 8,\n            asteroidDensity: 1.0,\n            specialFeatures: ['Earth'],\n            description: 'Our home system, with Earth as the starting location.',\n            connections: [], // Will be populated later\n            position: new THREE.Vector3(0, 0, 0), // Center point for the star map\n            skyboxParams: {\n                starDensity: 1.0,\n                nebulaDensity: 0.5,\n                color: 0xFFFFFF,\n                texturePath: './assets/2k_stars_milky_way.jpg', // Default Milky Way texture\n                brightness: 1.0 // Full brightness for Solar System\n            },\n            resourceMultipliers: {\n                iron: 1.0, \n                gold: 1.0, \n                platinum: 1.0\n            }\n        };\n        \n        this.systems['Solar System'] = solarSystem;\n    }\n    \n    // Generate random star systems\n    generateRandomSystems(count) {\n        for (let i = 0; i < count; i++) {\n            const id = `System-${i+1}`;\n            const starClass = this.getRandomStarClass();\n            const classification = this.getRandomClassification();\n            \n            // Determine color based on star class\n            const starColor = this.getStarColorFromClass(starClass);\n            \n            // Calculate resource distribution based on star class and classification\n            const resourceMult = this.calculateResourceMultipliers(starClass, classification);\n            \n            // Select a random skybox texture\n            const skyboxTexture = this.getRandomSkyboxTexture();\n            \n            // Create the system\n            const system = {\n                id: id,\n                name: this.generateSystemName(starClass),\n                starClass: starClass,\n                classification: classification,\n                starColor: starColor,\n                planetCount: this.getRandomInt(2, 10),\n                asteroidDensity: this.getRandomFloat(0.5, 2.5),\n                specialFeatures: this.generateSpecialFeatures(classification),\n                description: this.generateDescription(starClass, classification),\n                connections: [], // Will be populated later\n                position: this.generateMapPosition(), // Position in the star map\n                skyboxParams: {\n                    starDensity: this.getRandomFloat(0.7, 1.5),\n                    nebulaDensity: this.getRandomFloat(0.3, 1.2),\n                    color: this.getSkyboxColorFromClass(starClass),\n                    texturePath: skyboxTexture,\n                    brightness: 0.8 // Changed from 0.5 to 0.8\n                },\n                resourceMultipliers: resourceMult\n            };\n            \n            this.systems[id] = system;\n        }\n    }\n    \n    // Get a random skybox texture for non-Solar systems\n    getRandomSkyboxTexture() {\n        return this.skyboxTextures[this.getRandomInt(0, this.skyboxTextures.length - 1)];\n    }\n    \n    // Create connections between systems\n    createSystemConnections() {\n        // Map all systems to ensure each has at least one connection\n        const systemIds = Object.keys(this.systems);\n        \n        // Connect Solar System to at least two random systems\n        const solarSystem = this.systems['Solar System'];\n        const solarConnections = this.getRandomSystemsExcept('Solar System', 2);\n        \n        for (const targetId of solarConnections) {\n            this.createConnection('Solar System', targetId);\n        }\n        \n        // Ensure each system has at least one connection\n        for (const systemId of systemIds) {\n            const system = this.systems[systemId];\n            \n            // If no connections yet, create one\n            if (system.connections.length === 0) {\n                // Find a random system to connect to (that is not itself)\n                const targetId = this.getRandomSystemExcept(systemId);\n                this.createConnection(systemId, targetId);\n            }\n        }\n        \n        // Add some additional random connections for more interesting network\n        const extraConnectionCount = Math.floor(systemIds.length / 2);\n        for (let i = 0; i < extraConnectionCount; i++) {\n            const sourceId = systemIds[this.getRandomInt(0, systemIds.length - 1)];\n            const targetId = this.getRandomSystemExcept(sourceId);\n            \n            // Ensure we're not creating a duplicate connection\n            if (!this.systems[sourceId].connections.includes(targetId)) {\n                this.createConnection(sourceId, targetId);\n            }\n        }\n    }\n    \n    // Create a connection between two systems\n    createConnection(sourceId, targetId) {\n        // Add to connections list of both systems\n        this.systems[sourceId].connections.push(targetId);\n        this.systems[targetId].connections.push(sourceId);\n        \n        // Register in warp gates map\n        if (!this.warpGates[sourceId]) {\n            this.warpGates[sourceId] = [];\n        }\n        if (!this.warpGates[targetId]) {\n            this.warpGates[targetId] = [];\n        }\n        \n        this.warpGates[sourceId].push(targetId);\n        this.warpGates[targetId].push(sourceId);\n        \n        console.log(`Created connection between ${sourceId} and ${targetId}`);\n    }\n    \n    // Get list of connections for current system\n    getCurrentSystemConnections() {\n        if (!this.currentSystem) return [];\n        return this.systems[this.currentSystem].connections;\n    }\n    \n    // Get resource distribution for current system\n    getCurrentSystemResources() {\n        if (!this.currentSystem) return { iron: 1, gold: 1, platinum: 1 };\n        \n        const system = this.systems[this.currentSystem];\n        return system.resourceMultipliers;\n    }\n    \n    // Set the current active system\n    setCurrentSystem(systemId) {\n        if (this.systems[systemId]) {\n            this.currentSystem = systemId;\n            console.log(`Traveled to system: ${systemId}`);\n            return true;\n        }\n        return false;\n    }\n    \n    // Travel to a connected system\n    travelToSystem(targetSystemId) {\n        // Verify the target system exists\n        if (!this.systems[targetSystemId]) {\n            console.error(`System ${targetSystemId} does not exist`);\n            return false;\n        }\n        \n        // Verify there is a connection from current to target\n        const connections = this.getCurrentSystemConnections();\n        if (!connections.includes(targetSystemId)) {\n            console.error(`No connection from ${this.currentSystem} to ${targetSystemId}`);\n            return false;\n        }\n        \n        // Check if the ship is docked\n        if (window.game && window.game.spaceship && window.game.spaceship.isDocked) {\n            console.log(\"Player is docked during interstellar travel\");\n        }\n        \n        // Log current system params\n        if (this.systems[this.currentSystem]) {\n            const currentParams = this.systems[this.currentSystem].skyboxParams;\n            console.log(`${this.currentSystem} skybox params before travel: \n                         color=${currentParams.color.toString(16)}, \n                         starDensity=${currentParams.starDensity}, \n                         nebulaDensity=${currentParams.nebulaDensity}, \n                         texture=${currentParams.texturePath}`);\n        }\n        \n        // Log target system params\n        if (this.systems[targetSystemId]) {\n            const targetParams = this.systems[targetSystemId].skyboxParams;\n            console.log(`Traveling to ${targetSystemId} with skybox params: \n                         color=${targetParams.color.toString(16)}, \n                         starDensity=${targetParams.starDensity}, \n                         nebulaDensity=${targetParams.nebulaDensity}, \n                         texture=${targetParams.texturePath}`);\n        }\n        \n        // Set the new current system\n        this.setCurrentSystem(targetSystemId);\n        return true;\n    }\n    \n    // Get all star systems for the map\n    getAllSystems() {\n        return this.systems;\n    }\n    \n    // Get current system data\n    getCurrentSystemData() {\n        if (!this.currentSystem) return null;\n        return this.systems[this.currentSystem];\n    }\n    \n    // Helper methods\n    getRandomStarClass() {\n        const weights = [1, 2, 5, 10, 15, 20, 50]; // More common to have M class stars, rarer to have O class\n        const total = weights.reduce((sum, weight) => sum + weight, 0);\n        let random = Math.random() * total;\n        \n        for (let i = 0; i < weights.length; i++) {\n            if (random < weights[i]) {\n                return this.starClasses[i];\n            }\n            random -= weights[i];\n        }\n        \n        return this.starClasses[this.getRandomInt(0, this.starClasses.length - 1)];\n    }\n    \n    getRandomClassification() {\n        return this.systemClassifications[this.getRandomInt(0, this.systemClassifications.length - 1)];\n    }\n    \n    getStarColorFromClass(starClass) {\n        // Star colors based on spectral classification\n        const colors = {\n            'O': 0x9bb0ff, // Blue\n            'B': 0xaabfff, // Blue-white\n            'A': 0xcad7ff, // White\n            'F': 0xf8f7ff, // Yellow-white\n            'G': 0xfff4ea, // Yellow (like our sun)\n            'K': 0xffd2a1, // Orange\n            'M': 0xffcc6f  // Red\n        };\n        \n        return colors[starClass] || 0xffffff;\n    }\n    \n    getSkyboxColorFromClass(starClass) {\n        // Skybox colors based on spectral classification\n        const colors = {\n            'O': 0x0000ff, // Blue tint\n            'B': 0x4444ff, // Blue-white tint\n            'A': 0x8888ff, // White-blue tint\n            'F': 0xddddff, // Yellow-white tint\n            'G': 0xffffdd, // Yellow tint\n            'K': 0xffddaa, // Orange tint\n            'M': 0xff8866  // Red tint\n        };\n        \n        return colors[starClass] || 0xffffff;\n    }\n    \n    generateSystemName(starClass) {\n        const prefixes = [\n            'Alpha', 'Beta', 'Gamma', 'Delta', 'Epsilon', 'Zeta', 'Eta', 'Theta',\n            'Proxima', 'Nova', 'Sirius', 'Vega', 'Rigel', 'Antares', 'Arcturus'\n        ];\n        \n        const suffixes = [\n            'Prime', 'Major', 'Minor', 'A', 'B', 'I', 'II', 'III', 'IV', 'V'\n        ];\n        \n        const prefix = prefixes[this.getRandomInt(0, prefixes.length - 1)];\n        const suffix = this.getRandomInt(0, 10) > 7 ? ` ${suffixes[this.getRandomInt(0, suffixes.length - 1)]}` : '';\n        const number = this.getRandomInt(1, 999);\n        \n        return `${prefix} ${starClass}${number}${suffix}`;\n    }\n    \n    generateSpecialFeatures(classification) {\n        const features = [];\n        \n        // Add classification-specific features\n        switch (classification) {\n            case 'Resource-Rich':\n                features.push('Dense Asteroid Fields', 'Rich Mineral Veins');\n                break;\n            case 'Ancient':\n                features.push('Abandoned Structures', 'Ancient Artifacts');\n                break;\n            case 'Unstable':\n                features.push('Solar Flares', 'Radiation Bursts');\n                break;\n            case 'Barren':\n                features.push('Minimal Resources', 'Few Planets');\n                break;\n            case 'Hazardous':\n                features.push('Asteroid Storms', 'Energy Anomalies');\n                break;\n            case 'Peaceful':\n                features.push('Stable Environment', 'Optimal Mining Conditions');\n                break;\n        }\n        \n        return features;\n    }\n    \n    generateDescription(starClass, classification) {\n        // Base descriptions by star class\n        const starDescriptions = {\n            'O': \"A rare, hot blue star system with intense radiation.\",\n            'B': \"A blue-white star system with high energy output.\",\n            'A': \"A white star system with moderate radiation levels.\",\n            'F': \"A yellow-white star system with mild conditions.\",\n            'G': \"A yellow star system similar to our Solar System.\",\n            'K': \"An orange star system with reduced energy output.\",\n            'M': \"A common red dwarf system with low energy output.\"\n        };\n        \n        // Additional descriptions by classification\n        const classDescriptions = {\n            'Resource-Rich': \"The system is known for its abundant resources and dense asteroid fields.\",\n            'Ancient': \"This ancient system contains remnants of long-lost civilizations.\",\n            'Unstable': \"Be cautious as unpredictable stellar activity occurs in this system.\",\n            'Barren': \"Resources are scarce in this mostly empty star system.\",\n            'Hazardous': \"Environmental hazards make mining operations difficult but rewarding.\",\n            'Peaceful': \"This system offers stable and optimal conditions for mining operations.\",\n            'Home System': \"Our home system, containing Earth and the origin of humanity.\"\n        };\n        \n        return `${starDescriptions[starClass]} ${classDescriptions[classification]}`;\n    }\n    \n    calculateResourceMultipliers(starClass, classification) {\n        const baseDistribution = this.resourceDistribution[starClass];\n        const classMultiplier = this.classificationMultipliers[classification];\n        \n        return {\n            iron: baseDistribution.iron * classMultiplier.iron,\n            gold: baseDistribution.gold * classMultiplier.gold, \n            platinum: baseDistribution.platinum * classMultiplier.platinum\n        };\n    }\n    \n    generateMapPosition() {\n        // Generate a position for the star map UI\n        // This is in abstract coordinates for the 2D map, not the 3D world\n        const radius = 150 + Math.random() * 100; // Distance from center\n        const angle = Math.random() * Math.PI * 2; // Random angle\n        \n        const x = Math.cos(angle) * radius;\n        const y = Math.sin(angle) * radius;\n        \n        return new THREE.Vector3(x, y, 0);\n    }\n    \n    getRandomSystemsExcept(exceptId, count) {\n        const systemIds = Object.keys(this.systems).filter(id => id !== exceptId);\n        const selected = [];\n        \n        // Select random systems up to count\n        for (let i = 0; i < Math.min(count, systemIds.length); i++) {\n            const index = this.getRandomInt(0, systemIds.length - 1);\n            selected.push(systemIds[index]);\n            systemIds.splice(index, 1); // Remove to avoid duplicates\n        }\n        \n        return selected;\n    }\n    \n    getRandomSystemExcept(exceptId) {\n        const systemIds = Object.keys(this.systems).filter(id => id !== exceptId);\n        const index = this.getRandomInt(0, systemIds.length - 1);\n        return systemIds[index];\n    }\n    \n    // Utility methods\n    getRandomInt(min, max) {\n        return Math.floor(Math.random() * (max - min + 1)) + min;\n    }\n    \n    getRandomFloat(min, max) {\n        return Math.random() * (max - min) + min;\n    }\n    \n    // Add this method to the StarSystemGenerator class\n    addCustomSystem(systemData) {\n        if (!systemData || !systemData.id || !systemData.name) {\n            console.error('Invalid system data', systemData);\n            return false;\n        }\n        \n        // Check if a system with this ID already exists\n        if (this.systems[systemData.id]) {\n            console.warn(`System with ID ${systemData.id} already exists, overwriting`);\n        }\n        \n        console.log(`Adding custom system: ${systemData.name} (${systemData.id})`);\n        \n        // Create or update the custom system\n        const customSystem = {\n            id: systemData.id,\n            name: systemData.name,\n            starClass: systemData.starClass || this.getRandomStarClass(),\n            classification: systemData.classification || 'Custom',\n            starColor: systemData.starColor || this.getStarColorFromClass(systemData.starClass || 'G'),\n            planetCount: systemData.planetData ? systemData.planetData.length : 0,\n            asteroidDensity: systemData.asteroidDensity || 1.0,\n            specialFeatures: systemData.specialFeatures || ['User Created'],\n            description: systemData.description || 'A custom star system created by the user',\n            connections: [], // Will be populated by createConnection\n            position: systemData.position || this.generateMapPosition(),\n            skyboxParams: {\n                starDensity: systemData.skyboxParams?.starDensity || 1.0,\n                nebulaDensity: systemData.skyboxParams?.nebulaDensity || 0.8,\n                color: systemData.skyboxParams?.color || this.getSkyboxColorFromClass(systemData.starClass || 'G'),\n                texturePath: systemData.skyboxUrl || this.getRandomSkyboxTexture(),\n                brightness: systemData.skyboxParams?.brightness || 0.8,\n                isCustomTexture: !!systemData.skyboxUrl // Flag to indicate custom texture\n            },\n            resourceMultipliers: systemData.resourceMultipliers || {\n                iron: 1.0,\n                gold: 1.0,\n                platinum: 1.0\n            },\n            isCustomSystem: true // Flag to mark as custom\n        };\n        \n        // Store custom planet data if provided\n        if (systemData.planetData && Array.isArray(systemData.planetData)) {\n            this.storePlanetData(systemData.id, systemData.planetData);\n        }\n        \n        // Add the system to our collection\n        this.systems[systemData.id] = customSystem;\n        \n        // Create a connection to Solar System or another random system\n        this.createConnection('Solar System', systemData.id);\n        \n        // Create an additional random connection\n        const randomSystem = this.getRandomSystemExcept(systemData.id, 'Solar System');\n        if (randomSystem) {\n            this.createConnection(systemData.id, randomSystem);\n        }\n        \n        console.log(`Custom system ${systemData.name} added successfully with connections to Solar System and ${randomSystem || 'no other system'}`);\n        \n        return true;\n    }\n    \n    // Add this method to store custom planet data\n    storePlanetData(systemId, planetData) {\n        if (!Array.isArray(planetData)) {\n            console.error('Planet data must be an array');\n            return;\n        }\n        \n        // Create a new array to store standardized planet data\n        const standardizedPlanets = [];\n        \n        // Process each planet\n        for (let i = 0; i < planetData.length; i++) {\n            const planet = planetData[i];\n            \n            standardizedPlanets.push({\n                name: planet.name || `Planet-${i+1}`,\n                size: planet.size || (300 + Math.random() * 500),\n                distance: planet.distance || (4800 + (i * 8000) + (Math.random() * 2000)),\n                speed: planet.speed || (0.001 + (Math.random() * 0.001)),\n                color: planet.color || this.getRandomColor(),\n                rings: planet.rings !== undefined ? planet.rings : Math.random() > 0.7,\n                textureUrl: planet.textureUrl || null, // Custom texture URL\n                axialTilt: planet.axialTilt || (Math.random() * Math.PI * 0.5),\n                orbitalTilt: planet.orbitalTilt || (Math.random() * Math.PI * 0.2)\n            });\n        }\n        \n        // Store the planet data for this system\n        if (!this.customPlanetData) {\n            this.customPlanetData = {};\n        }\n        \n        this.customPlanetData[systemId] = standardizedPlanets;\n        console.log(`Stored ${standardizedPlanets.length} planets for system ${systemId}`);\n    }\n    \n    // Helper method to generate a random color\n    getRandomColor() {\n        return Math.floor(Math.random() * 0xFFFFFF);\n    }\n\n    /**\n     * Returns player to stargate after interstellar travel\n     * Should be called after travel to ensure proper docking state\n     */\n    returnFromTravel() {\n        console.log(\"StarSystemGenerator: Handling return from interstellar travel\");\n        \n        // Check if game and spaceship are available\n        if (!window.game || !window.game.spaceship) {\n            console.error(\"StarSystemGenerator: Cannot return from travel - game or spaceship not found\");\n            return false;\n        }\n        \n        // Ensure the player is docked after travel\n        if (!window.game.spaceship.isDocked) {\n            console.log(\"StarSystemGenerator: Setting ship to docked state after travel\");\n            window.game.spaceship.dock();\n        }\n        \n        // Reposition ship near stargate\n        const dockingSystem = window.game.controls?.dockingSystem;\n        if (dockingSystem) {\n            console.log(\"StarSystemGenerator: Repositioning ship near stargate\");\n            dockingSystem.positionNearStargate();\n            \n            // Show stargate UI\n            if (typeof dockingSystem.showStargateUI === 'function') {\n                console.log(\"StarSystemGenerator: Showing stargate UI via docking system\");\n                dockingSystem.showStargateUI();\n                return true;\n            }\n        }\n        \n        // Fallback - try to find UI or stargate interface directly\n        if (window.game.ui?.stargateInterface?.showStargateUI) {\n            console.log(\"StarSystemGenerator: Showing stargate UI via game.ui.stargateInterface\");\n            window.game.ui.stargateInterface.showStargateUI();\n            return true;\n        }\n        \n        console.warn(\"StarSystemGenerator: Could not fully complete return from travel\");\n        return false;\n    }\n}","// systemTransition.js - Handles the visual transition between star systems\n\nimport * as THREE from 'three';\n\nexport class SystemTransition {\n    constructor(scene, camera) {\n        this.scene = scene;\n        this.camera = camera;\n        this.isTransitioning = false;\n        this.transitionDuration = 3000; // milliseconds\n        this.onTransitionComplete = null;\n        \n        // Create transition elements\n        this.setupTransitionElements();\n    }\n    \n    setupTransitionElements() {\n        // Warp tunnel effect\n        this.warpTunnel = new THREE.Points(\n            new THREE.BufferGeometry(),\n            new THREE.PointsMaterial({\n                color: 0x30cfd0,\n                size: 2,\n                blending: THREE.AdditiveBlending,\n                transparent: true,\n                sizeAttenuation: true\n            })\n        );\n        \n        // Create particles for warp effect\n        this.createWarpParticles();\n        \n        // Flash overlay for transition effect\n        this.createOverlay();\n    }\n    \n    createWarpParticles() {\n        // Number of particles\n        const particleCount = 2000;\n        \n        // Create position array\n        const positions = new Float32Array(particleCount * 3);\n        \n        // Initialize particle positions in a tunnel shape\n        for (let i = 0; i < particleCount; i++) {\n            const i3 = i * 3;\n            \n            // Polar coordinates for tunnel shape\n            const radius = 50 + Math.random() * 50;\n            const theta = Math.random() * Math.PI * 2;\n            const length = -500 - Math.random() * 3000; // Negative z is forward\n            \n            // Convert to Cartesian\n            positions[i3] = radius * Math.cos(theta);     // x\n            positions[i3 + 1] = radius * Math.sin(theta); // y\n            positions[i3 + 2] = length;                   // z\n        }\n        \n        // Add to buffer geometry\n        this.warpTunnel.geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));\n        \n        // Store original positions for resetting\n        this.originalPositions = new Float32Array(positions);\n    }\n    \n    createOverlay() {\n        // Create a DOM overlay for the flash effect\n        this.overlay = document.createElement('div');\n        this.overlay.id = 'warp-overlay';\n        this.overlay.style.position = 'fixed';\n        this.overlay.style.top = '0';\n        this.overlay.style.left = '0';\n        this.overlay.style.width = '100%';\n        this.overlay.style.height = '100%';\n        this.overlay.style.backgroundColor = '#30cfd0';\n        this.overlay.style.opacity = '0';\n        this.overlay.style.transition = 'opacity 0.5s';\n        this.overlay.style.pointerEvents = 'none';\n        this.overlay.style.zIndex = '9999';\n        \n        // Add to DOM but hide initially\n        document.body.appendChild(this.overlay);\n    }\n    \n    // Start a transition between systems\n    startTransition(onComplete) {\n        if (this.isTransitioning) return;\n        \n        console.log(\"Starting system transition...\");\n        this.isTransitioning = true;\n        \n        // Store callback\n        this.onTransitionComplete = onComplete;\n        \n        // Add warp tunnel to scene\n        this.scene.add(this.warpTunnel);\n        \n        // Position the camera for the transition\n        this.initialCameraPosition = this.camera.position.clone();\n        this.initialCameraRotation = this.camera.rotation.clone();\n        \n        // Start transition animation\n        this.startTime = Date.now();\n        \n        // Show overlay\n        this.showOverlay();\n        \n        // Start animation\n        this.animate();\n    }\n    \n    // Animation loop for transition\n    animate() {\n        if (!this.isTransitioning) return;\n        \n        const currentTime = Date.now();\n        const elapsed = currentTime - this.startTime;\n        const progress = Math.min(elapsed / this.transitionDuration, 1.0);\n        \n        // Update warp effect\n        this.updateWarpEffect(progress);\n        \n        // Check if transition is complete\n        if (progress >= 1.0) {\n            this.completeTransition();\n            return;\n        }\n        \n        // Continue animation\n        requestAnimationFrame(this.animate.bind(this));\n    }\n    \n    // Update warp tunnel effect\n    updateWarpEffect(progress) {\n        // Get positions\n        const positions = this.warpTunnel.geometry.attributes.position.array;\n        \n        // Adjust warp speed based on progress\n        const warpSpeed = 3 + progress * 20;\n        \n        // Update particle positions\n        for (let i = 0; i < positions.length; i += 3) {\n            // Move particles toward camera\n            positions[i + 2] += warpSpeed; // z value\n            \n            // Reset particles that go past the camera\n            if (positions[i + 2] > 100) {\n                // Reset to original position with an offset to create continuous tunnel\n                positions[i] = this.originalPositions[i];\n                positions[i + 1] = this.originalPositions[i + 1];\n                positions[i + 2] = this.originalPositions[i + 2] - 500; // Return to end of tunnel\n            }\n        }\n        \n        // Update buffer geometry\n        this.warpTunnel.geometry.attributes.position.needsUpdate = true;\n        \n        // Update camera animation - slight movement to enhance effect\n        if (this.camera) {\n            this.camera.rotation.z += 0.0005 * Math.sin(progress * Math.PI);\n        }\n    }\n    \n    // Show overlay with flash effect\n    showOverlay() {\n        if (!this.overlay) return;\n        \n        // Start with low opacity\n        this.overlay.style.opacity = '0.2';\n        \n        // Schedule flash toward end of transition\n        setTimeout(() => {\n            this.overlay.style.opacity = '1';\n            \n            // Fade out after flash\n            setTimeout(() => {\n                this.overlay.style.opacity = '0';\n            }, 500);\n        }, this.transitionDuration - 1000);\n    }\n    \n    // Complete the transition\n    completeTransition() {\n        console.log(\"System transition complete\");\n        this.isTransitioning = false;\n        \n        // Remove warp tunnel from scene\n        this.scene.remove(this.warpTunnel);\n        \n        // Reset camera position and rotation\n        if (this.camera && this.initialCameraPosition && this.initialCameraRotation) {\n            this.camera.position.copy(this.initialCameraPosition);\n            this.camera.rotation.copy(this.initialCameraRotation);\n        }\n        \n        // Call completion callback if provided\n        if (this.onTransitionComplete && typeof this.onTransitionComplete === 'function') {\n            // Use setTimeout to make sure this executes after the animation frame\n            setTimeout(() => {\n                console.log(\"Executing transition completion callback\");\n                this.onTransitionComplete();\n            }, 100);\n        }\n    }\n}","// apiClient.js - Client for interacting with the skybox generation API\n\nexport class ApiClient {\n    constructor() {\n        // API configuration\n        this.apiBaseUrl = this.getApiBaseUrl();\n        \n        // In-memory token storage (no localStorage)\n        this.token = null;\n        this.tokenExpiry = null;\n        \n        // Default client ID\n        this.clientId = 'game_client';\n        \n        // For token refresh\n        this.isRefreshing = false;\n        this.refreshCallbacks = [];\n        \n        console.log(`API Client initialized with base URL: ${this.apiBaseUrl}`);\n    }\n    \n    // Get base URL from environment or use default\n    getApiBaseUrl() {\n        // For local development\n        if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {\n            return 'http://localhost:8001';\n        }\n        \n        // For production - Use the Heroku app URL\n        return 'https://aminer-skybox-generator-833fe937a945.herokuapp.com';\n    }\n    \n    // Check if token is valid and not expired\n    hasValidToken() {\n        if (!this.token || !this.tokenExpiry) {\n            return false;\n        }\n        \n        const expiryTime = new Date(this.tokenExpiry).getTime();\n        const currentTime = new Date().getTime();\n        \n        // Consider token expired if less than 5 minutes remain\n        const fiveMinutesInMs = 5 * 60 * 1000;\n        return (expiryTime - currentTime) > fiveMinutesInMs;\n    }\n    \n    // Clear token from memory\n    clearToken() {\n        this.token = null;\n        this.tokenExpiry = null;\n    }\n    \n    // Get a new token from the API\n    async getToken() {\n        // Prevent multiple simultaneous refresh attempts\n        if (this.isRefreshing) {\n            return new Promise((resolve) => {\n                this.refreshCallbacks.push((success) => resolve(success));\n            });\n        }\n        \n        this.isRefreshing = true;\n        \n        try {\n            const response = await fetch(`${this.apiBaseUrl}/token`, {\n                method: 'POST',\n                headers: {\n                    'Content-Type': 'application/json'\n                },\n                body: JSON.stringify({ client_id: this.clientId })\n            });\n            \n            if (!response.ok) {\n                const errorData = await response.json();\n                const errorMessage = errorData.detail || 'Failed to get token';\n                console.error(`Token error (${response.status}): ${errorMessage}`);\n                \n                // Execute callbacks with failure\n                this.refreshCallbacks.forEach(cb => cb(false));\n                this.refreshCallbacks = [];\n                this.isRefreshing = false;\n                \n                throw new Error(errorMessage);\n            }\n            \n            const data = await response.json();\n            \n            // Save token in memory\n            this.token = data.access_token;\n            \n            // Set expiry (tokens are valid for 1 hour)\n            const expiryDate = new Date();\n            expiryDate.setHours(expiryDate.getHours() + 1);\n            this.tokenExpiry = expiryDate.toISOString();\n            \n            // Execute callbacks with success\n            this.refreshCallbacks.forEach(cb => cb(true));\n            this.refreshCallbacks = [];\n            this.isRefreshing = false;\n            \n            return true;\n        } catch (error) {\n            console.error('Error getting token:', error);\n            \n            // Execute callbacks with failure\n            this.refreshCallbacks.forEach(cb => cb(false));\n            this.refreshCallbacks = [];\n            this.isRefreshing = false;\n            \n            return false;\n        }\n    }\n    \n    // Handle API response errors\n    async handleApiResponse(response) {\n        if (response.status === 401) {\n            // Token has expired or is invalid\n            this.clearToken();\n            \n            // Try to get a new token and retry the request\n            const success = await this.getToken();\n            if (!success) {\n                throw new Error('Authentication failed. Please reload the application.');\n            }\n            \n            // Return false to indicate a retry is needed\n            return false;\n        }\n        \n        if (response.status === 429) {\n            // Rate limit exceeded\n            throw new Error('Rate limit exceeded. Please try again later.');\n        }\n        \n        if (!response.ok) {\n            const errorData = await response.json();\n            throw new Error(errorData.message || errorData.detail || `Error: ${response.status} ${response.statusText}`);\n        }\n        \n        // Return true to indicate success\n        return true;\n    }\n    \n    // Generate a skybox based on the system name and description\n    async generateSkybox(systemName, description) {\n        // Get a new token if current one is invalid\n        if (!this.hasValidToken()) {\n            const success = await this.getToken();\n            if (!success) {\n                throw new Error('Failed to authenticate with the API');\n            }\n        }\n        \n        // Make request to generate skybox\n        const response = await fetch(`${this.apiBaseUrl}/generate-skybox`, {\n            method: 'POST',\n            headers: {\n                'Content-Type': 'application/json',\n                'Authorization': `Bearer ${this.token}`\n            },\n            body: JSON.stringify({\n                system_name: systemName,\n                skybox_description: description\n            })\n        });\n        \n        // Handle response errors\n        const isValid = await this.handleApiResponse(response);\n        if (!isValid) {\n            // Retry the request with the new token\n            return this.generateSkybox(systemName, description);\n        }\n        \n        return await response.json();\n    }\n    \n    // Generate a planet texture based on the planet name and description\n    async generatePlanet(planetName, description) {\n        // Get a new token if current one is invalid\n        if (!this.hasValidToken()) {\n            const success = await this.getToken();\n            if (!success) {\n                throw new Error('Failed to authenticate with the API');\n            }\n        }\n        \n        // Make request to generate planet\n        const response = await fetch(`${this.apiBaseUrl}/generate-planet`, {\n            method: 'POST',\n            headers: {\n                'Content-Type': 'application/json',\n                'Authorization': `Bearer ${this.token}`\n            },\n            body: JSON.stringify({\n                planet_name: planetName,\n                planet_description: description\n            })\n        });\n        \n        // Handle response errors\n        const isValid = await this.handleApiResponse(response);\n        if (!isValid) {\n            // Retry the request with the new token\n            return this.generatePlanet(planetName, description);\n        }\n        \n        return await response.json();\n    }\n    \n    // Convert a relative image path to a full URL\n    getFullImageUrl(relativeUrl) {\n        // If it's already a full URL, return as is\n        if (relativeUrl.startsWith('http')) {\n            return relativeUrl;\n        }\n        \n        // Remove leading slash if present\n        const cleanPath = relativeUrl.startsWith('/') ? relativeUrl.substring(1) : relativeUrl;\n        \n        // Get the API base URL\n        const baseUrl = this.apiBaseUrl;\n        \n        // Join with API base URL\n        return `${baseUrl}/${cleanPath}`;\n    }\n} ","// customSystemCreator.js - UI for creating custom star systems with AI-generated assets\n\nimport { ApiClient } from '../utils/apiClient.js';\n\nexport class CustomSystemCreator {\n    constructor(starSystemGenerator, environment) {\n        this.starSystemGenerator = starSystemGenerator;\n        this.environment = environment;\n        this.apiClient = new ApiClient();\n        this.isVisible = false;\n        this.isGenerating = false;\n        this.generatedSkyboxUrl = null;\n        this.generatedPlanetUrls = [];\n        this.systemData = null;\n        this.isMobile = this.detectMobile();\n        \n        // Initialize UI\n        this.createUI();\n        this.setupEventHandlers();\n        \n        // Setup the sliders for the first planet\n        this.setupSliderListeners(1);\n    }\n    \n    detectMobile() {\n        return ('ontouchstart' in window) || \n               (navigator.maxTouchPoints > 0) || \n               (navigator.msMaxTouchPoints > 0) ||\n               (window.innerWidth < 900);\n    }\n    \n    createUI() {\n        // Create main container\n        this.container = document.createElement('div');\n        this.container.id = 'custom-system-creator';\n        this.container.className = 'modal-container';\n        this.container.style.display = 'none';\n        \n        // Create modal content with mobile optimizations\n        this.container.innerHTML = `\n            <div class=\"modal-content\" style=\"${this.isMobile ? 'width: 94%; max-height: 85vh; overflow-y: auto; -webkit-overflow-scrolling: touch; padding-bottom: 100px; overscroll-behavior: contain;' : ''}\">\n                <div class=\"modal-header\">\n                    <h2>Create New Star System</h2>\n                    <button id=\"close-system-creator\" class=\"close-btn\" style=\"${this.isMobile ? 'font-size: 28px; padding: 12px; min-height: 48px; min-width: 48px;' : ''}\">&times;</button>\n                </div>\n                <div class=\"modal-body\" style=\"${this.isMobile ? 'padding-bottom: 150px;' : ''}\">\n                    <div id=\"system-creator-form\">\n                        <div class=\"form-group\">\n                            <label for=\"system-name\">System Name:</label>\n                            <input type=\"text\" id=\"system-name\" placeholder=\"Enter a name for your star system\" style=\"${this.isMobile ? 'font-size: 16px; padding: 14px; height: 48px;' : ''}\">\n                        </div>\n                        \n                        <div class=\"form-group\">\n                            <label for=\"skybox-description\">Skybox Description:</label>\n                            <textarea id=\"skybox-description\" rows=\"${this.isMobile ? '3' : '4'}\" placeholder=\"Describe the skybox/space environment (e.g., 'A vibrant nebula with blue and purple clouds, dotted with bright stars')\" style=\"${this.isMobile ? 'font-size: 16px; padding: 14px;' : ''}\"></textarea>\n                        </div>\n                        \n                        <div class=\"form-group\">\n                            <label for=\"star-class\">Star Class:</label>\n                            <select id=\"star-class\" class=\"form-control\" style=\"${this.isMobile ? 'font-size: 16px; padding: 14px; height: 48px;' : ''}\">\n                                <option value=\"O\">O - Blue Giant (Hot, Blue)</option>\n                                <option value=\"B\">B - Blue-White</option>\n                                <option value=\"A\">A - White</option>\n                                <option value=\"F\">F - Yellow-White</option>\n                                <option value=\"G\" selected>G - Yellow (Sun-like)</option>\n                                <option value=\"K\">K - Orange</option>\n                                <option value=\"M\">M - Red Dwarf</option>\n                            </select>\n                            <p class=\"help-text\">Different star classes affect the lighting and appearance of your system.</p>\n                        </div>\n                        \n                        <div id=\"planet-descriptions\">\n                            <div class=\"form-group planet-input\">\n                                <h3>Planet 1</h3>\n                                <label for=\"planet-name-1\">Planet Name:</label>\n                                <input type=\"text\" id=\"planet-name-1\" placeholder=\"Enter a name for this planet\" style=\"${this.isMobile ? 'font-size: 16px; padding: 14px; height: 48px;' : ''}\">\n                                \n                                <label for=\"planet-description-1\">Planet Description:</label>\n                                <textarea id=\"planet-description-1\" rows=\"${this.isMobile ? '2' : '3'}\" placeholder=\"Describe the planet (e.g., 'A rocky planet with large oceans and ice caps')\" style=\"${this.isMobile ? 'font-size: 16px; padding: 14px;' : ''}\"></textarea>\n                                \n                                <div class=\"planet-properties\">\n                                    <div class=\"property-row\">\n                                        <label for=\"planet-size-1\">Size:</label>\n                                        <input type=\"range\" id=\"planet-size-1\" min=\"300\" max=\"1000\" value=\"450\" class=\"slider\" style=\"${this.isMobile ? 'height: 30px; margin: 10px 0;' : ''}\">\n                                        <span class=\"slider-value\" id=\"planet-size-value-1\">450</span>\n                                    </div>\n                                    \n                                    <div class=\"property-row\">\n                                        <label for=\"planet-distance-1\">Distance from Star:</label>\n                                        <input type=\"range\" id=\"planet-distance-1\" min=\"4000\" max=\"60000\" value=\"8000\" class=\"slider\" style=\"${this.isMobile ? 'height: 30px; margin: 10px 0;' : ''}\">\n                                        <span class=\"slider-value\" id=\"planet-distance-value-1\">8000</span>\n                                    </div>\n                                    \n                                    <div class=\"property-row\">\n                                        <label for=\"planet-speed-1\">Orbit Speed:</label>\n                                        <input type=\"range\" id=\"planet-speed-1\" min=\"1\" max=\"10\" value=\"5\" class=\"slider\" style=\"${this.isMobile ? 'height: 30px; margin: 10px 0;' : ''}\">\n                                        <span class=\"slider-value\" id=\"planet-speed-value-1\">0.0015</span>\n                                    </div>\n                                    \n                                    <div class=\"property-row\" style=\"${this.isMobile ? 'margin-top: 15px;' : ''}\">\n                                        <label for=\"planet-rings-1\">Has Rings:</label>\n                                        <input type=\"checkbox\" id=\"planet-rings-1\" style=\"${this.isMobile ? 'transform: scale(1.7); margin: 0 15px; min-height: 24px; min-width: 24px;' : ''}\">\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                        \n                        <button id=\"add-planet-btn\" class=\"secondary-btn\" style=\"${this.isMobile ? 'min-height: 50px; padding: 14px; font-size: 16px; width: 100%; margin: 15px 0;' : ''}\">+ Add Another Planet</button>\n                        \n                        <div class=\"form-actions\">\n                            <button id=\"generate-system-btn\" class=\"primary-btn\" style=\"${this.isMobile ? 'min-height: 54px; padding: 16px; font-size: 18px; margin-top: 20px; width: 100%;' : ''}\">Generate System</button>\n                        </div>\n                    </div>\n                    \n                    <div id=\"generation-progress\" style=\"display: none;\">\n                        <h3>Generating your star system...</h3>\n                        <div class=\"progress-bar\">\n                            <div class=\"progress-fill\"></div>\n                        </div>\n                        <p id=\"generation-status\">Initializing...</p>\n                    </div>\n                    \n                    <div id=\"system-preview\" style=\"display: none;\">\n                        <h3>Preview</h3>\n                        <div class=\"preview-container\" style=\"${this.isMobile ? 'flex-direction: column;' : ''}\">\n                            <div class=\"skybox-preview\" style=\"${this.isMobile ? 'width: 100%; margin-bottom: 20px;' : ''}\">\n                                <h4>Skybox</h4>\n                                <img id=\"skybox-preview-img\" src=\"\" alt=\"Skybox Preview\">\n                            </div>\n                            <div class=\"planets-preview\" id=\"planets-preview\" style=\"${this.isMobile ? 'width: 100%;' : ''}\">\n                                <!-- Planet previews will be added here dynamically -->\n                            </div>\n                        </div>\n                        <div class=\"form-actions\" style=\"${this.isMobile ? 'padding-bottom: 30px;' : ''}\">\n                            <button id=\"travel-to-system-btn\" class=\"primary-btn\" style=\"${this.isMobile ? 'min-height: 54px; padding: 16px; font-size: 18px; width: 100%; margin-top: 20px;' : ''}\">Travel to System</button>\n                            <button id=\"regenerate-system-btn\" class=\"secondary-btn\" style=\"${this.isMobile ? 'min-height: 48px; padding: 14px; font-size: 16px; width: 100%; margin-top: 15px;' : ''}\">Regenerate</button>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n        \n        // Add to document\n        document.body.appendChild(this.container);\n        \n        // Capture references to elements\n        this.systemNameInput = document.getElementById('system-name');\n        this.skyboxDescription = document.getElementById('skybox-description');\n        this.planetDescriptions = document.getElementById('planet-descriptions');\n        this.addPlanetBtn = document.getElementById('add-planet-btn');\n        this.generateSystemBtn = document.getElementById('generate-system-btn');\n        this.generationProgress = document.getElementById('generation-progress');\n        this.generationStatus = document.getElementById('generation-status');\n        this.systemForm = document.getElementById('system-creator-form');\n        this.systemPreview = document.getElementById('system-preview');\n        this.skyboxPreviewImg = document.getElementById('skybox-preview-img');\n        this.planetsPreview = document.getElementById('planets-preview');\n        this.travelToSystemBtn = document.getElementById('travel-to-system-btn');\n        this.regenerateSystemBtn = document.getElementById('regenerate-system-btn');\n        \n        // Add mobile styles\n        if (this.isMobile) {\n            this.addMobileStyles();\n        }\n    }\n    \n    addMobileStyles() {\n        // Add CSS for better mobile experience if not already present\n        if (!document.getElementById('custom-system-creator-mobile-styles')) {\n            const style = document.createElement('style');\n            style.id = 'custom-system-creator-mobile-styles';\n            style.innerHTML = `\n                @media (max-width: 900px) {\n                    /* Mobile-specific styles for CustomSystemCreator */\n                    #custom-system-creator .modal-content {\n                        border-radius: 10px;\n                        padding-bottom: 120px;\n                    }\n                    \n                    #custom-system-creator .form-group {\n                        margin-bottom: 24px;\n                    }\n                    \n                    #custom-system-creator label {\n                        font-size: 16px;\n                        margin-bottom: 10px;\n                        display: block;\n                    }\n                    \n                    #custom-system-creator .property-row {\n                        flex-direction: column;\n                        align-items: flex-start;\n                        margin-bottom: 20px;\n                    }\n                    \n                    #custom-system-creator .property-row label {\n                        margin-bottom: 10px;\n                        width: 100%;\n                    }\n                    \n                    #custom-system-creator .slider {\n                        width: 100%;\n                        margin: 10px 0;\n                    }\n                    \n                    #custom-system-creator .slider-value {\n                        margin-top: 5px;\n                        align-self: flex-end;\n                    }\n                    \n                    #custom-system-creator .planet-input {\n                        padding: 20px;\n                        margin-bottom: 30px;\n                    }\n                    \n                    #custom-system-creator input[type=\"text\"],\n                    #custom-system-creator textarea,\n                    #custom-system-creator select {\n                        font-size: 16px !important;\n                        padding: 14px !important;\n                    }\n                    \n                    #custom-system-creator .planet-preview {\n                        flex: 0 0 100%;\n                        margin-bottom: 15px;\n                    }\n                    \n                    #custom-system-creator .form-actions {\n                        text-align: center;\n                    }\n                    \n                    /* Better slider for touch */\n                    #custom-system-creator input[type=\"range\"] {\n                        -webkit-appearance: none;\n                        height: 30px;\n                        background: #0d1e2f;\n                        border-radius: 15px;\n                        padding: 0;\n                        outline: none;\n                    }\n                    \n                    #custom-system-creator input[type=\"range\"]::-webkit-slider-thumb {\n                        -webkit-appearance: none;\n                        width: 30px;\n                        height: 30px;\n                        border-radius: 50%;\n                        background: #4a9dff;\n                        cursor: pointer;\n                    }\n                    \n                    #custom-system-creator input[type=\"range\"]::-moz-range-thumb {\n                        width: 30px;\n                        height: 30px;\n                        border-radius: 50%;\n                        background: #4a9dff;\n                        cursor: pointer;\n                        border: none;\n                    }\n                    \n                    /* Touch ripple effect for buttons */\n                    .ripple {\n                        position: relative;\n                        overflow: hidden;\n                        transform: translate3d(0, 0, 0);\n                    }\n                    \n                    .ripple:after {\n                        content: \"\";\n                        display: block;\n                        position: absolute;\n                        width: 100%;\n                        height: 100%;\n                        top: 0;\n                        left: 0;\n                        pointer-events: none;\n                        background-image: radial-gradient(circle, #fff 10%, transparent 10.01%);\n                        background-repeat: no-repeat;\n                        background-position: 50%;\n                        transform: scale(10, 10);\n                        opacity: 0;\n                        transition: transform .5s, opacity 1s;\n                    }\n                    \n                    .ripple:active:after {\n                        transform: scale(0, 0);\n                        opacity: .3;\n                        transition: 0s;\n                    }\n                    \n                    /* Character counter for text areas */\n                    .char-counter {\n                        font-size: 12px;\n                        color: #aaa;\n                        text-align: right;\n                        margin-top: 5px;\n                    }\n                    \n                    .char-counter.warning {\n                        color: #ff9900;\n                    }\n                    \n                    .char-counter.error {\n                        color: #ff3030;\n                    }\n                }\n            `;\n            document.head.appendChild(style);\n        }\n        \n        // Add ripple effect to all buttons\n        this.addRippleEffect();\n        \n        // Add character counters to textareas\n        this.addCharacterCounters();\n    }\n    \n    // Add ripple effect to buttons for better touch feedback\n    addRippleEffect() {\n        if (!this.isMobile) return;\n        \n        const buttons = this.container.querySelectorAll('button');\n        buttons.forEach(button => {\n            if (!button.classList.contains('ripple')) {\n                button.classList.add('ripple');\n            }\n        });\n    }\n    \n    // Add character counters to textareas\n    addCharacterCounters() {\n        if (!this.isMobile) return;\n        \n        // Skybox description\n        this.addCharacterCounter(this.skyboxDescription, 250);\n        \n        // Add counter to first planet and set up event listener for future planets\n        const firstPlanetDesc = document.getElementById('planet-description-1');\n        if (firstPlanetDesc) {\n            this.addCharacterCounter(firstPlanetDesc, 150);\n        }\n    }\n    \n    // Helper function to add character counter to a text area\n    addCharacterCounter(textarea, maxChars) {\n        if (!textarea) return;\n        \n        // Create counter element\n        const counter = document.createElement('div');\n        counter.className = 'char-counter';\n        \n        // Update counter text\n        const updateCounter = () => {\n            const remaining = maxChars - textarea.value.length;\n            counter.textContent = `${remaining} characters remaining`;\n            \n            // Change color based on remaining characters\n            counter.className = 'char-counter';\n            if (remaining < 30) {\n                counter.classList.add('warning');\n            }\n            if (remaining < 10) {\n                counter.classList.add('error');\n            }\n            \n            // Enforce character limit\n            if (remaining < 0) {\n                textarea.value = textarea.value.substring(0, maxChars);\n                counter.textContent = \"0 characters remaining\";\n            }\n        };\n        \n        // Add event listeners\n        textarea.addEventListener('input', updateCounter);\n        textarea.addEventListener('keydown', (e) => {\n            // Allow deletion even at max characters\n            if (textarea.value.length >= maxChars && \n                e.key !== 'Backspace' && \n                e.key !== 'Delete' && \n                e.key !== 'ArrowLeft' && \n                e.key !== 'ArrowRight' &&\n                !e.ctrlKey && \n                !e.metaKey) {\n                e.preventDefault();\n            }\n        });\n        \n        // Set initial counter\n        updateCounter();\n        \n        // Add counter after textarea\n        textarea.parentNode.insertBefore(counter, textarea.nextSibling);\n        \n        // Set maxlength attribute (fallback)\n        textarea.setAttribute('maxlength', maxChars.toString());\n    }\n    \n    setupEventHandlers() {\n        // Close button\n        const closeBtn = document.getElementById('close-system-creator');\n        closeBtn.addEventListener('click', () => {\n            this.hide();\n            this.playUISound();\n        });\n        \n        // For mobile, add touch event listener with sound\n        if (this.isMobile) {\n            closeBtn.addEventListener('touchend', (e) => {\n                e.preventDefault();\n                this.hide();\n                this.playUISound();\n            });\n            \n            // Ensure scrolling works by fixing container event handling\n            this.container.addEventListener('touchmove', (e) => {\n                // Allow default touchmove behavior (scrolling)\n                e.stopPropagation();\n            }, { passive: true });\n            \n            // Improve scroll performance\n            const modalContent = this.container.querySelector('.modal-content');\n            if (modalContent) {\n                modalContent.addEventListener('touchstart', () => {}, { passive: true });\n                modalContent.addEventListener('touchmove', () => {}, { passive: true });\n            }\n        }\n        \n        // Add Planet button\n        this.addPlanetBtn.addEventListener('click', () => {\n            this.addPlanetInput();\n            this.playUISound();\n        });\n        \n        if (this.isMobile) {\n            this.addPlanetBtn.addEventListener('touchend', (e) => {\n                e.preventDefault();\n                this.addPlanetInput();\n                this.playUISound();\n            });\n        }\n        \n        // Generate System button\n        this.generateSystemBtn.addEventListener('click', () => {\n            this.generateSystem();\n            this.playUISound();\n        });\n        \n        if (this.isMobile) {\n            this.generateSystemBtn.addEventListener('touchend', (e) => {\n                e.preventDefault();\n                this.generateSystem();\n                this.playUISound();\n            });\n        }\n        \n        // Travel to System button\n        this.travelToSystemBtn.addEventListener('click', () => {\n            this.travelToSystem();\n            this.playUISound();\n        });\n        \n        if (this.isMobile) {\n            this.travelToSystemBtn.addEventListener('touchend', (e) => {\n                e.preventDefault();\n                this.travelToSystem();\n                this.playUISound();\n            });\n        }\n        \n        // Regenerate button\n        this.regenerateSystemBtn.addEventListener('click', () => {\n            this.systemPreview.style.display = 'none';\n            this.systemForm.style.display = 'block';\n            this.playUISound();\n        });\n        \n        if (this.isMobile) {\n            this.regenerateSystemBtn.addEventListener('touchend', (e) => {\n                e.preventDefault();\n                this.systemPreview.style.display = 'none';\n                this.systemForm.style.display = 'block';\n                this.playUISound();\n            });\n        }\n        \n        // ESC key to close\n        document.addEventListener('keydown', (e) => {\n            if (e.key === 'Escape' && this.isVisible) {\n                this.hide();\n            }\n        });\n        \n        // Click outside to close\n        this.container.addEventListener('click', (e) => {\n            if (e.target === this.container) {\n                this.hide();\n            }\n        });\n        \n        // Handle mobile touch start on container to properly manage touch events\n        if (this.isMobile) {\n            this.container.addEventListener('touchstart', (e) => {\n                // Only close if the touch is directly on the container background\n                if (e.target === this.container) {\n                    e.preventDefault();\n                    this.hide();\n                }\n            }, { passive: false });\n        }\n    }\n    \n    addPlanetInput() {\n        const planetInputs = this.planetDescriptions.getElementsByClassName('planet-input');\n        const newIndex = planetInputs.length + 1;\n        \n        const planetDiv = document.createElement('div');\n        planetDiv.className = 'form-group planet-input';\n        planetDiv.innerHTML = `\n            <h3>Planet ${newIndex}</h3>\n            <label for=\"planet-name-${newIndex}\">Planet Name:</label>\n            <input type=\"text\" id=\"planet-name-${newIndex}\" placeholder=\"Enter a name for this planet\" style=\"${this.isMobile ? 'font-size: 16px; padding: 14px; height: 48px;' : ''}\">\n            \n            <label for=\"planet-description-${newIndex}\">Planet Description:</label>\n            <textarea id=\"planet-description-${newIndex}\" rows=\"${this.isMobile ? '2' : '3'}\" placeholder=\"Describe the planet (e.g., 'A rocky planet with large oceans and ice caps')\" style=\"${this.isMobile ? 'font-size: 16px; padding: 14px;' : ''}\" maxlength=\"150\"></textarea>\n            \n            <div class=\"planet-properties\">\n                <div class=\"property-row\">\n                    <label for=\"planet-size-${newIndex}\">Size:</label>\n                    <input type=\"range\" id=\"planet-size-${newIndex}\" min=\"300\" max=\"1000\" value=\"450\" class=\"slider\" style=\"${this.isMobile ? 'height: 30px; margin: 10px 0;' : ''}\">\n                    <span class=\"slider-value\" id=\"planet-size-value-${newIndex}\">450</span>\n                </div>\n                \n                <div class=\"property-row\">\n                    <label for=\"planet-distance-${newIndex}\">Distance from Star:</label>\n                    <input type=\"range\" id=\"planet-distance-${newIndex}\" min=\"4000\" max=\"60000\" value=\"${4000 + newIndex * 6000}\" class=\"slider\" style=\"${this.isMobile ? 'height: 30px; margin: 10px 0;' : ''}\">\n                    <span class=\"slider-value\" id=\"planet-distance-value-${newIndex}\">${4000 + newIndex * 6000}</span>\n                </div>\n                \n                <div class=\"property-row\">\n                    <label for=\"planet-speed-${newIndex}\">Orbit Speed:</label>\n                    <input type=\"range\" id=\"planet-speed-${newIndex}\" min=\"1\" max=\"10\" value=\"5\" class=\"slider\" style=\"${this.isMobile ? 'height: 30px; margin: 10px 0;' : ''}\">\n                    <span class=\"slider-value\" id=\"planet-speed-value-${newIndex}\">0.0015</span>\n                </div>\n                \n                <div class=\"property-row\" style=\"${this.isMobile ? 'margin-top: 15px;' : ''}\">\n                    <label for=\"planet-rings-${newIndex}\">Has Rings:</label>\n                    <input type=\"checkbox\" id=\"planet-rings-${newIndex}\" style=\"${this.isMobile ? 'transform: scale(1.7); margin: 0 15px; min-height: 24px; min-width: 24px;' : ''}\">\n                </div>\n            </div>\n            \n            <button class=\"remove-planet-btn danger-btn ${this.isMobile ? 'ripple' : ''}\" style=\"${this.isMobile ? 'min-height: 50px; padding: 14px; font-size: 16px; right: 15px; top: 15px;' : ''}\">Remove</button>\n        `;\n        \n        this.planetDescriptions.appendChild(planetDiv);\n        \n        // Set up event listeners for the sliders\n        this.setupSliderListeners(newIndex);\n        \n        // Add event listener to remove button\n        const removeBtn = planetDiv.querySelector('.remove-planet-btn');\n        removeBtn.addEventListener('click', () => {\n            planetDiv.remove();\n            this.updatePlanetNumbers();\n            this.playUISound();\n        });\n        \n        // Add touch-specific event handlers for mobile\n        if (this.isMobile) {\n            removeBtn.addEventListener('touchend', (e) => {\n                e.preventDefault();\n                planetDiv.remove();\n                this.updatePlanetNumbers();\n                this.playUISound();\n            });\n            \n            // Also add touch events to sliders for better mobile interaction\n            const sliders = planetDiv.querySelectorAll('input[type=\"range\"]');\n            sliders.forEach(slider => {\n                slider.addEventListener('touchstart', () => {\n                    // Add active class for visual feedback\n                    slider.classList.add('slider-active');\n                });\n                \n                slider.addEventListener('touchend', () => {\n                    // Remove active class when touch ends\n                    slider.classList.remove('slider-active');\n                });\n            });\n            \n            // Add character counter to the new planet's description\n            const planetDesc = planetDiv.querySelector(`textarea[id^=\"planet-description-\"]`);\n            if (planetDesc) {\n                this.addCharacterCounter(planetDesc, 150);\n            }\n        }\n        \n        // If on mobile, scroll to the new planet section with improved handling\n        if (this.isMobile) {\n            // Clear any existing scroll timeout\n            if (this.scrollTimeout) {\n                clearTimeout(this.scrollTimeout);\n            }\n            \n            // Use a safer scrolling approach that won't freeze the UI\n            this.scrollTimeout = setTimeout(() => {\n                try {\n                    const modalContent = this.container.querySelector('.modal-content');\n                    const newPlanet = this.planetDescriptions.lastElementChild;\n                    \n                    if (modalContent && newPlanet) {\n                        // Calculate scroll position\n                        const planetPos = newPlanet.offsetTop;\n                        const scrollPos = planetPos - (modalContent.clientHeight / 4);\n                        \n                        // Use manual scrolling instead of scrollIntoView for better control\n                        modalContent.scrollTo({\n                            top: scrollPos,\n                            behavior: 'smooth'\n                        });\n                    }\n                } catch (err) {\n                    console.warn(\"Error during scroll:\", err);\n                }\n            }, 100);\n        }\n    }\n    \n    setupSliderListeners(index) {\n        // Size slider\n        const sizeSlider = document.getElementById(`planet-size-${index}`);\n        const sizeValue = document.getElementById(`planet-size-value-${index}`);\n        \n        sizeSlider.addEventListener('input', () => {\n            sizeValue.textContent = sizeSlider.value;\n        });\n        \n        // Distance slider\n        const distanceSlider = document.getElementById(`planet-distance-${index}`);\n        const distanceValue = document.getElementById(`planet-distance-value-${index}`);\n        \n        distanceSlider.addEventListener('input', () => {\n            distanceValue.textContent = distanceSlider.value;\n        });\n        \n        // Speed slider\n        const speedSlider = document.getElementById(`planet-speed-${index}`);\n        const speedValue = document.getElementById(`planet-speed-value-${index}`);\n        \n        speedSlider.addEventListener('input', () => {\n            // Convert 1-10 range to 0.001-0.002 range\n            const speed = 0.001 + (speedSlider.value - 1) * (0.001 / 9);\n            speedValue.textContent = speed.toFixed(4);\n        });\n        \n        // For mobile, add visual feedback\n        if (this.isMobile) {\n            const sliders = [sizeSlider, distanceSlider, speedSlider];\n            sliders.forEach(slider => {\n                slider.addEventListener('touchstart', () => {\n                    // Add active class for visual feedback\n                    slider.classList.add('slider-active');\n                });\n                \n                slider.addEventListener('touchend', () => {\n                    // Remove active class when touch ends\n                    slider.classList.remove('slider-active');\n                });\n            });\n        }\n    }\n    \n    updatePlanetNumbers() {\n        const planetInputs = this.planetDescriptions.getElementsByClassName('planet-input');\n        for (let i = 0; i < planetInputs.length; i++) {\n            const planetDiv = planetInputs[i];\n            const planetHeader = planetDiv.querySelector('h3');\n            planetHeader.textContent = `Planet ${i + 1}`;\n        }\n    }\n    \n    async generateSystem() {\n        // Validate inputs\n        const systemName = this.systemNameInput.value.trim();\n        const skyboxDesc = this.skyboxDescription.value.trim();\n        const starClass = document.getElementById('star-class').value;\n        \n        if (!systemName || !skyboxDesc) {\n            this.showMobileAlert('Please enter a system name and skybox description.');\n            return;\n        }\n        \n        // Show progress UI\n        this.systemForm.style.display = 'none';\n        this.generationProgress.style.display = 'block';\n        this.isGenerating = true;\n        \n        try {\n            // Check for auth token or get one\n            if (!this.apiClient.hasValidToken()) {\n                this.updateGenerationStatus('Authenticating...');\n                await this.apiClient.getToken();\n            }\n            \n            // Generate skybox\n            this.updateGenerationStatus('Generating skybox...');\n            const skyboxResponse = await this.apiClient.generateSkybox(systemName, skyboxDesc);\n            \n            if (!skyboxResponse.success) {\n                throw new Error(skyboxResponse.message || 'Failed to generate skybox');\n            }\n            \n            if (!skyboxResponse.image_paths || skyboxResponse.image_paths.length === 0) {\n                throw new Error('No skybox images were generated');\n            }\n            \n            this.generatedSkyboxUrl = skyboxResponse.image_paths[0];\n            \n            // Collect planet data\n            const planets = [];\n            const planetInputs = this.planetDescriptions.getElementsByClassName('planet-input');\n            \n            for (let i = 0; i < planetInputs.length; i++) {\n                const planetDiv = planetInputs[i];\n                const planetIndex = i + 1;\n                \n                const nameInput = planetDiv.querySelector(`input[id^=\"planet-name-\"]`);\n                const descInput = planetDiv.querySelector(`textarea[id^=\"planet-description-\"]`);\n                const sizeInput = planetDiv.querySelector(`input[id^=\"planet-size-\"]`);\n                const distanceInput = planetDiv.querySelector(`input[id^=\"planet-distance-\"]`);\n                const speedInput = planetDiv.querySelector(`input[id^=\"planet-speed-\"]`);\n                const ringsInput = planetDiv.querySelector(`input[id^=\"planet-rings-\"]`);\n                \n                const planetName = nameInput.value.trim();\n                const planetDesc = descInput.value.trim();\n                \n                if (planetName && planetDesc) {\n                    // Calculate speed from slider (1-10 to 0.001-0.002)\n                    const speedValue = parseFloat(speedInput.value);\n                    const orbitSpeed = 0.001 + (speedValue - 1) * (0.001 / 9);\n                    \n                    planets.push({ \n                        name: planetName, \n                        description: planetDesc,\n                        size: parseInt(sizeInput.value),\n                        distance: parseInt(distanceInput.value),\n                        speed: orbitSpeed,\n                        rings: ringsInput.checked\n                    });\n                }\n            }\n            \n            // Generate planets\n            this.generatedPlanetUrls = [];\n            for (let i = 0; i < planets.length; i++) {\n                const planet = planets[i];\n                this.updateGenerationStatus(`Generating planet ${i+1} of ${planets.length}: ${planet.name}...`);\n                \n                const planetResponse = await this.apiClient.generatePlanet(planet.name, planet.description);\n                \n                if (planetResponse.success && planetResponse.image_paths && planetResponse.image_paths.length > 0) {\n                    this.generatedPlanetUrls.push({\n                        name: planet.name,\n                        url: planetResponse.image_paths[0]\n                    });\n                }\n            }\n            \n            // Create system data\n            this.systemData = {\n                id: `Custom-${Date.now()}`,\n                name: systemName,\n                starClass: starClass,\n                classification: 'Custom',\n                description: `Custom star system with ${planets.length} planets`,\n                skyboxUrl: this.generatedSkyboxUrl,\n                // Add light intensity multiplier to reduce brightness by 20%\n                lightIntensityMultiplier: 0.8,\n                planetData: planets.map((planet, i) => {\n                    return {\n                        name: planet.name,\n                        textureUrl: this.generatedPlanetUrls[i]?.url || null,\n                        // Use the custom planet properties\n                        size: planet.size,\n                        distance: planet.distance,\n                        speed: planet.speed,\n                        color: this.getStarColorForClass(starClass),\n                        rings: planet.rings\n                    };\n                })\n            };\n            \n            // Show preview\n            this.showSystemPreview();\n            \n        } catch (error) {\n            console.error('Error generating system:', error);\n            this.showMobileAlert(`Failed to generate system: ${error.message}`);\n            this.generationProgress.style.display = 'none';\n            this.systemForm.style.display = 'block';\n        }\n        \n        this.isGenerating = false;\n    }\n    \n    showSystemPreview() {\n        // Update skybox preview\n        if (this.generatedSkyboxUrl) {\n            this.skyboxPreviewImg.src = this.apiClient.getFullImageUrl(this.generatedSkyboxUrl);\n        }\n        \n        // Update planet previews\n        this.planetsPreview.innerHTML = '';\n        this.generatedPlanetUrls.forEach(planet => {\n            const planetDiv = document.createElement('div');\n            planetDiv.className = 'planet-preview';\n            planetDiv.innerHTML = `\n                <h4>${planet.name}</h4>\n                <img src=\"${this.apiClient.getFullImageUrl(planet.url)}\" alt=\"${planet.name}\">\n            `;\n            this.planetsPreview.appendChild(planetDiv);\n        });\n        \n        // Show preview UI\n        this.generationProgress.style.display = 'none';\n        this.systemPreview.style.display = 'block';\n        \n        // If on mobile, scroll to top of preview\n        if (this.isMobile) {\n            setTimeout(() => {\n                this.systemPreview.scrollIntoView({ behavior: 'smooth', block: 'start' });\n            }, 50);\n        }\n    }\n    \n    travelToSystem() {\n        if (!this.systemData) {\n            this.showMobileAlert('No system data available. Please generate a system first.');\n            return;\n        }\n        \n        try {\n            // Add the custom system to the star system generator\n            const success = this.starSystemGenerator.addCustomSystem(this.systemData);\n            \n            if (!success) {\n                throw new Error('Failed to add custom system');\n            }\n            \n            // Hide UI\n            this.hide();\n            \n            // Travel to the new system\n            if (this.environment && this.environment.travelToSystem) {\n                this.environment.travelToSystem(this.systemData.id);\n            } else {\n                console.error('Environment or travelToSystem method not available');\n            }\n            \n        } catch (error) {\n            console.error('Error traveling to custom system:', error);\n            this.showMobileAlert(`Failed to travel to custom system: ${error.message}`);\n        }\n    }\n    \n    updateGenerationStatus(message) {\n        if (this.generationStatus) {\n            this.generationStatus.textContent = message;\n            console.log('Generation status:', message);\n        }\n    }\n    \n    getStarColorForClass(starClass) {\n        // Star colors based on spectral classification\n        const colors = {\n            'O': 0x9bb0ff, // Blue\n            'B': 0xaabfff, // Blue-white\n            'A': 0xcad7ff, // White\n            'F': 0xf8f7ff, // Yellow-white\n            'G': 0xfff4ea, // Yellow (like our sun)\n            'K': 0xffd2a1, // Orange\n            'M': 0xffcc6f  // Red\n        };\n        \n        return colors[starClass] || 0xfff4ea; // Default to G-class if undefined\n    }\n    \n    // Mobile-friendly alert that doesn't block UI thread\n    showMobileAlert(message) {\n        if (this.isMobile) {\n            // Create a custom alert overlay for mobile\n            const alertOverlay = document.createElement('div');\n            alertOverlay.style.position = 'fixed';\n            alertOverlay.style.top = '0';\n            alertOverlay.style.left = '0';\n            alertOverlay.style.width = '100%';\n            alertOverlay.style.height = '100%';\n            alertOverlay.style.backgroundColor = 'rgba(0, 0, 0, 0.7)';\n            alertOverlay.style.display = 'flex';\n            alertOverlay.style.justifyContent = 'center';\n            alertOverlay.style.alignItems = 'center';\n            alertOverlay.style.zIndex = '10000';\n            \n            const alertBox = document.createElement('div');\n            alertBox.style.backgroundColor = '#0a1a2a';\n            alertBox.style.color = '#c5d8f1';\n            alertBox.style.padding = '20px';\n            alertBox.style.borderRadius = '10px';\n            alertBox.style.maxWidth = '80%';\n            alertBox.style.textAlign = 'center';\n            alertBox.style.border = '2px solid #2c5a8c';\n            \n            const messageEl = document.createElement('p');\n            messageEl.textContent = message;\n            messageEl.style.marginBottom = '20px';\n            messageEl.style.fontSize = '16px';\n            \n            const okButton = document.createElement('button');\n            okButton.textContent = 'OK';\n            okButton.style.padding = '12px 30px';\n            okButton.style.fontSize = '16px';\n            okButton.style.backgroundColor = '#2c5a8c';\n            okButton.style.color = 'white';\n            okButton.style.border = 'none';\n            okButton.style.borderRadius = '5px';\n            okButton.style.minHeight = '48px';\n            okButton.style.minWidth = '120px';\n            \n            alertBox.appendChild(messageEl);\n            alertBox.appendChild(okButton);\n            alertOverlay.appendChild(alertBox);\n            document.body.appendChild(alertOverlay);\n            \n            // Play sound if available\n            this.playUISound();\n            \n            // Handle button click and touch\n            okButton.addEventListener('click', () => {\n                document.body.removeChild(alertOverlay);\n            });\n            \n            okButton.addEventListener('touchend', (e) => {\n                e.preventDefault();\n                document.body.removeChild(alertOverlay);\n                this.playUISound();\n            });\n            \n        } else {\n            // Fall back to regular alert for desktop\n            alert(message);\n        }\n    }\n    \n    playUISound() {\n        // Play UI sound if audio is available\n        if (window.game && window.game.audio) {\n            window.game.audio.playSound('boink');\n        }\n    }\n    \n    show() {\n        if (this.container) {\n            // Reset any previous state\n            this.cleanupBeforeHiding();\n            \n            this.container.style.display = 'flex';\n            this.isVisible = true;\n            \n            // Reset UI state\n            this.systemForm.style.display = 'block';\n            this.generationProgress.style.display = 'none';\n            this.systemPreview.style.display = 'none';\n            \n            // Play sound if available\n            this.playUISound();\n            \n            // For mobile, ensure scrolling works properly\n            if (this.isMobile) {\n                // Enable proper scrolling\n                const modalContent = this.container.querySelector('.modal-content');\n                if (modalContent) {\n                    // Reset scroll position to top\n                    modalContent.scrollTop = 0;\n                    \n                    // Ensure overflow settings are correct\n                    modalContent.style.overflowY = 'auto';\n                    modalContent.style.webkitOverflowScrolling = 'touch';\n                    modalContent.style.overscrollBehavior = 'contain';\n                }\n                \n                // Add body class to prevent background scrolling\n                document.body.classList.add('modal-open');\n                \n                // Delayed focus to avoid iOS keyboard issues\n                this.scrollTimeout = setTimeout(() => {\n                    if (this.systemNameInput) {\n                        this.systemNameInput.focus();\n                    }\n                }, 300);\n            } else {\n                // Focus on system name input\n                setTimeout(() => {\n                    if (this.systemNameInput) {\n                        this.systemNameInput.focus();\n                    }\n                }, 300);\n            }\n            \n            // Add CSS for the modal-open class if it doesn't exist\n            if (!document.getElementById('modal-open-style') && this.isMobile) {\n                const style = document.createElement('style');\n                style.id = 'modal-open-style';\n                style.textContent = `\n                    .modal-open {\n                        overflow: hidden;\n                        position: fixed;\n                        width: 100%;\n                        height: 100%;\n                    }\n                `;\n                document.head.appendChild(style);\n            }\n            \n            // Restore custom styles which were removed in previous edit\n            if (!document.getElementById('custom-system-creator-styles')) {\n                const style = document.createElement('style');\n                style.id = 'custom-system-creator-styles';\n                style.textContent = `\n                    .property-row {\n                        display: flex;\n                        align-items: center;\n                        margin-bottom: 10px;\n                    }\n                    \n                    .property-row label {\n                        flex: 0 0 150px;\n                        margin-right: 10px;\n                    }\n                    \n                    .property-row .slider {\n                        flex: 1;\n                        height: 10px;\n                        background: #2a2a2a;\n                        outline: none;\n                        border-radius: 5px;\n                    }\n                    \n                    .property-row .slider-value {\n                        flex: 0 0 60px;\n                        margin-left: 10px;\n                        text-align: right;\n                    }\n                    \n                    .planet-properties {\n                        background: rgba(0, 0, 0, 0.2);\n                        padding: 15px;\n                        border-radius: 5px;\n                        margin-top: 10px;\n                        margin-bottom: 15px;\n                    }\n                    \n                    .help-text {\n                        font-size: 12px;\n                        color: #aaa;\n                        margin-top: 5px;\n                    }\n                    \n                    select.form-control {\n                        width: 100%;\n                        padding: 8px;\n                        border-radius: 4px;\n                        background: #25303e;\n                        color: white;\n                        border: 1px solid #3a5472;\n                    }\n                    \n                    /* Active slider styles */\n                    .slider-active {\n                        background: #3a5472 !important;\n                    }\n                    \n                    /* Add smooth transitions */\n                    #custom-system-creator button {\n                        transition: all 0.2s ease;\n                    }\n                    \n                    #custom-system-creator button:active {\n                        transform: scale(0.95);\n                    }\n                `;\n                document.head.appendChild(style);\n            }\n        }\n    }\n    \n    hide() {\n        if (this.container && !this.isGenerating) {\n            // Stop any ongoing processes\n            this.cleanupBeforeHiding();\n            \n            this.container.style.display = 'none';\n            this.isVisible = false;\n            \n            // Play sound if available\n            this.playUISound();\n            \n            // Show the stargate UI when closing the custom system creator\n            // Similar to how StarMap does it\n            setTimeout(() => {\n                if (window.game && window.game.ui && window.game.ui.stargateInterface) {\n                    console.log(\"CustomSystemCreator: Returning to stargate UI\");\n                    window.game.ui.stargateInterface.showStargateUI();\n                } else {\n                    // Direct DOM access as last resort\n                    const stargateUI = document.getElementById('stargate-ui');\n                    if (stargateUI) {\n                        stargateUI.style.display = 'block';\n                        console.log(\"CustomSystemCreator: Showed stargate UI via direct DOM access\");\n                    } else {\n                        console.warn(\"CustomSystemCreator: Could not find stargate UI to return to\");\n                    }\n                }\n            }, 100); // Short delay to ensure state is settled\n        }\n    }\n    \n    toggle() {\n        if (this.isVisible) {\n            this.hide();\n        } else {\n            this.show();\n        }\n    }\n    \n    // Add a new method to handle cleanup before hiding\n    cleanupBeforeHiding() {\n        // Reset form state if needed\n        if (this.isGenerating) {\n            this.isGenerating = false;\n            this.generationProgress.style.display = 'none';\n            this.systemForm.style.display = 'block';\n        }\n        \n        // Cancel any pending animations/scrolls\n        if (this.scrollTimeout) {\n            clearTimeout(this.scrollTimeout);\n            this.scrollTimeout = null;\n        }\n        \n        // Ensure we're not in transition state\n        document.body.style.pointerEvents = 'auto';\n        \n        // Force release any touch captures (helps with freezing issues)\n        if (this.isMobile) {\n            document.body.style.touchAction = 'auto';\n            \n            // Force redraw to clear any pending UI states\n            this.container.style.display = 'none';\n            void this.container.offsetHeight; // Force reflow\n        }\n    }\n    \n    // Add method to clean up when component is destroyed\n    destroy() {\n        // Clean up any event listeners or resources\n        this.cleanupBeforeHiding();\n        \n        // Remove modal-open class if it was added\n        document.body.classList.remove('modal-open');\n        \n        // Remove from DOM\n        if (this.container && this.container.parentNode) {\n            this.container.parentNode.removeChild(this.container);\n        }\n    }\n} ","// vibeVersePortals.js - Implements VibeVerse portal entrance and exit\r\n\r\nimport * as THREE from 'three';\r\n\r\nexport class VibeVersePortals {\r\n    constructor(scene, spaceship) {\r\n        this.scene = scene;\r\n        this.spaceship = spaceship;\r\n        this.startPortalGroup = null;\r\n        this.exitPortalGroup = null;\r\n        this.startPortalBox = null;\r\n        this.exitPortalBox = null;\r\n        this.startPortalParticleSystem = null;\r\n        this.exitPortalParticleSystem = null;\r\n        \r\n        // Check if we should create a start portal\r\n        this.shouldCreateStartPortal = new URLSearchParams(window.location.search).has('portal');\r\n        \r\n        // Get reference URL if it exists\r\n        this.refUrl = new URLSearchParams(window.location.search).get('ref') || '';\r\n        \r\n        // Initialize portals\r\n        this.init();\r\n    }\r\n    \r\n    init() {\r\n        // Create start portal if needed (based on URL parameter)\r\n        if (this.shouldCreateStartPortal) {\r\n            this.createStartPortal();\r\n        }\r\n        \r\n        // Always create exit portal\r\n        this.createExitPortal();\r\n    }\r\n    \r\n    createStartPortal() {\r\n        // Create a portal group\r\n        this.startPortalGroup = new THREE.Group();\r\n        this.startPortalGroup.name = 'startPortal';\r\n        \r\n        // Create portal ring - INCREASED SIZE\r\n        const ringGeometry = new THREE.TorusGeometry(150, 15, 32, 100);\r\n        const ringMaterial = new THREE.MeshStandardMaterial({\r\n            color: 0xff0000,\r\n            emissive: 0xff0000,\r\n            emissiveIntensity: 0.5,\r\n            roughness: 0.3,\r\n            metalness: 0.7\r\n        });\r\n        const ring = new THREE.Mesh(ringGeometry, ringMaterial);\r\n        this.startPortalGroup.add(ring);\r\n        \r\n        // Create portal surface (semi-transparent) - INCREASED SIZE\r\n        const surfaceGeometry = new THREE.CircleGeometry(135, 32);\r\n        const surfaceMaterial = new THREE.MeshBasicMaterial({\r\n            color: 0xff0000,\r\n            transparent: true,\r\n            opacity: 0.3,\r\n            side: THREE.DoubleSide\r\n        });\r\n        const surface = new THREE.Mesh(surfaceGeometry, surfaceMaterial);\r\n        surface.position.z = 0.1; // Slight offset to avoid z-fighting\r\n        this.startPortalGroup.add(surface);\r\n        \r\n        // Create particle system\r\n        const particleCount = 500;\r\n        const particleGeometry = new THREE.BufferGeometry();\r\n        const positions = new Float32Array(particleCount * 3);\r\n        \r\n        // Position particles in a ring pattern - ADJUSTED FOR LARGER SIZE\r\n        for (let i = 0; i < particleCount; i++) {\r\n            const angle = (i / particleCount) * Math.PI * 2;\r\n            const radius = 135 + (Math.random() * 30 - 15); // Random variation around the ring\r\n            \r\n            positions[i * 3] = Math.cos(angle) * radius;\r\n            positions[i * 3 + 1] = Math.sin(angle) * radius;\r\n            positions[i * 3 + 2] = (Math.random() - 0.5) * 15; // Small variation in z\r\n        }\r\n        \r\n        particleGeometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));\r\n        \r\n        const particleMaterial = new THREE.PointsMaterial({\r\n            color: 0xff5555,\r\n            size: 3.5, // Increased particle size\r\n            blending: THREE.AdditiveBlending,\r\n            transparent: true\r\n        });\r\n        \r\n        this.startPortalParticleSystem = new THREE.Points(particleGeometry, particleMaterial);\r\n        this.startPortalGroup.add(this.startPortalParticleSystem);\r\n        \r\n        // Position the portal higher above the stargate and centered on y-axis\r\n        this.startPortalGroup.position.set(0, 15000, 0); // Centered above stargate\r\n        this.startPortalGroup.rotation.x = Math.PI / 2; // Face straight down\r\n        \r\n        // Add to scene\r\n        this.scene.add(this.startPortalGroup);\r\n        \r\n        // Create collision box\r\n        this.startPortalBox = new THREE.Box3().setFromObject(this.startPortalGroup);\r\n        \r\n        console.log(\"Start portal created at position:\", this.startPortalGroup.position);\r\n    }\r\n    \r\n    createExitPortal() {\r\n        // Create a portal group\r\n        this.exitPortalGroup = new THREE.Group();\r\n        this.exitPortalGroup.name = 'exitPortal';\r\n        \r\n        // Create portal ring - INCREASED SIZE\r\n        const ringGeometry = new THREE.TorusGeometry(150, 15, 32, 100);\r\n        const ringMaterial = new THREE.MeshStandardMaterial({\r\n            color: 0x00ff00,\r\n            emissive: 0x00ff00,\r\n            emissiveIntensity: 0.5,\r\n            roughness: 0.3,\r\n            metalness: 0.7\r\n        });\r\n        const ring = new THREE.Mesh(ringGeometry, ringMaterial);\r\n        this.exitPortalGroup.add(ring);\r\n        \r\n        // Create portal surface (semi-transparent) - INCREASED SIZE\r\n        const surfaceGeometry = new THREE.CircleGeometry(135, 32);\r\n        const surfaceMaterial = new THREE.MeshBasicMaterial({\r\n            color: 0x00ff00,\r\n            transparent: true,\r\n            opacity: 0.3,\r\n            side: THREE.DoubleSide\r\n        });\r\n        const surface = new THREE.Mesh(surfaceGeometry, surfaceMaterial);\r\n        surface.position.z = 0.1; // Slight offset to avoid z-fighting\r\n        this.exitPortalGroup.add(surface);\r\n        \r\n        // Create particle system\r\n        const particleCount = 500;\r\n        const particleGeometry = new THREE.BufferGeometry();\r\n        const positions = new Float32Array(particleCount * 3);\r\n        \r\n        // Position particles in a ring pattern - ADJUSTED FOR LARGER SIZE\r\n        for (let i = 0; i < particleCount; i++) {\r\n            const angle = (i / particleCount) * Math.PI * 2;\r\n            const radius = 135 + (Math.random() * 30 - 15); // Random variation around the ring\r\n            \r\n            positions[i * 3] = Math.cos(angle) * radius;\r\n            positions[i * 3 + 1] = Math.sin(angle) * radius;\r\n            positions[i * 3 + 2] = (Math.random() - 0.5) * 15; // Small variation in z\r\n        }\r\n        \r\n        particleGeometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));\r\n        \r\n        const particleMaterial = new THREE.PointsMaterial({\r\n            color: 0x55ff55,\r\n            size: 3.5, // Increased particle size\r\n            blending: THREE.AdditiveBlending,\r\n            transparent: true\r\n        });\r\n        \r\n        this.exitPortalParticleSystem = new THREE.Points(particleGeometry, particleMaterial);\r\n        this.exitPortalGroup.add(this.exitPortalParticleSystem);\r\n        \r\n        // Create text label for the portal - INCREASED SIZE\r\n        const canvas = document.createElement('canvas');\r\n        canvas.width = 1024; // Increased size\r\n        canvas.height = 256; // Increased size\r\n        const ctx = canvas.getContext('2d');\r\n        ctx.fillStyle = 'black';\r\n        ctx.fillRect(0, 0, canvas.width, canvas.height);\r\n        ctx.font = '72px Arial'; // Increased font size\r\n        ctx.fillStyle = '#00ff00';\r\n        ctx.textAlign = 'center';\r\n        ctx.textBaseline = 'middle';\r\n        ctx.fillText('VIBEVERSE PORTAL', canvas.width / 2, canvas.height / 2);\r\n        \r\n        const texture = new THREE.CanvasTexture(canvas);\r\n        const labelGeometry = new THREE.PlaneGeometry(200, 50); // Increased size\r\n        const labelMaterial = new THREE.MeshBasicMaterial({\r\n            map: texture,\r\n            transparent: true,\r\n            side: THREE.DoubleSide\r\n        });\r\n        \r\n        const label = new THREE.Mesh(labelGeometry, labelMaterial);\r\n        label.position.set(0, 200, 0); // Position above the portal (increased)\r\n        this.exitPortalGroup.add(label);\r\n        \r\n        // Position the portal higher above the stargate and centered on y-axis\r\n        this.exitPortalGroup.position.set(0, 16000, 0); // Centered above stargate, bit higher than start portal\r\n        this.exitPortalGroup.rotation.x = Math.PI / 2; // Face straight down\r\n        \r\n        // Add to scene\r\n        this.scene.add(this.exitPortalGroup);\r\n        \r\n        // Create collision box\r\n        this.exitPortalBox = new THREE.Box3().setFromObject(this.exitPortalGroup);\r\n        \r\n        console.log(\"Exit portal created at position:\", this.exitPortalGroup.position);\r\n    }\r\n    \r\n    animateStartPortal(deltaTime) {\r\n        if (!this.startPortalGroup || !this.startPortalParticleSystem) return;\r\n        \r\n        // Rotate particle system\r\n        this.startPortalParticleSystem.rotation.z += deltaTime * 0.5;\r\n        \r\n        // Update collision box (only periodically to save performance)\r\n        if (Math.random() < 0.05) {\r\n            this.startPortalBox.setFromObject(this.startPortalGroup);\r\n        }\r\n    }\r\n    \r\n    animateExitPortal(deltaTime) {\r\n        if (!this.exitPortalGroup || !this.exitPortalParticleSystem) return;\r\n        \r\n        // Rotate particle system\r\n        this.exitPortalParticleSystem.rotation.z += deltaTime * 0.5;\r\n        \r\n        // Update collision box (only periodically to save performance)\r\n        if (Math.random() < 0.05) {\r\n            this.exitPortalBox.setFromObject(this.exitPortalGroup);\r\n        }\r\n    }\r\n    \r\n    checkPortalInteractions(deltaTime) {\r\n        if (!this.spaceship || !this.spaceship.mesh) return;\r\n        \r\n        // Create a box for the spaceship (used for collision detection)\r\n        const shipBox = new THREE.Box3().setFromObject(this.spaceship.mesh);\r\n        \r\n        // Check start portal interaction (if it exists)\r\n        if (this.startPortalGroup && this.startPortalBox) {\r\n            const distance = this.spaceship.mesh.position.distanceTo(this.startPortalGroup.position);\r\n            \r\n            // If player is close to the start portal - INCREASED DETECTION RANGE\r\n            if (distance < 400) { // Increased from 200 to match much larger portal size\r\n                // Check for collision\r\n                if (shipBox.intersectsBox(this.startPortalBox)) {\r\n                    this.handleStartPortalEntry();\r\n                }\r\n            }\r\n        }\r\n        \r\n        // Check exit portal interaction\r\n        if (this.exitPortalGroup && this.exitPortalBox) {\r\n            const distance = this.spaceship.mesh.position.distanceTo(this.exitPortalGroup.position);\r\n            \r\n            // If player is close to the exit portal - INCREASED DETECTION RANGE\r\n            if (distance < 400) { // Increased from 200 to match much larger portal size\r\n                // Check for collision\r\n                if (shipBox.intersectsBox(this.exitPortalBox)) {\r\n                    this.handleExitPortalEntry();\r\n                }\r\n            }\r\n        }\r\n    }\r\n    \r\n    handleStartPortalEntry() {\r\n        // Prevent multiple redirects\r\n        if (this._isRedirecting) return;\r\n        this._isRedirecting = true;\r\n        \r\n        console.log(\"Player entered start portal\");\r\n        \r\n        // Get the reference URL from the query parameter\r\n        let targetUrl = this.refUrl;\r\n        \r\n        // Make sure the URL has the https:// prefix\r\n        if (targetUrl && !targetUrl.startsWith('http')) {\r\n            targetUrl = 'https://' + targetUrl;\r\n        }\r\n        \r\n        // If no target URL, do nothing\r\n        if (!targetUrl) {\r\n            console.error(\"No target URL specified for portal\");\r\n            this._isRedirecting = false;\r\n            return;\r\n        }\r\n        \r\n        // Parse current URL parameters (excluding 'ref')\r\n        const currentParams = new URLSearchParams(window.location.search);\r\n        currentParams.delete('ref');\r\n        currentParams.delete('portal');\r\n        \r\n        // Create a URL object for the target\r\n        let finalUrl;\r\n        try {\r\n            finalUrl = new URL(targetUrl);\r\n            \r\n            // Append any other current parameters to the target URL\r\n            for (const [key, value] of currentParams.entries()) {\r\n                finalUrl.searchParams.append(key, value);\r\n            }\r\n        } catch (e) {\r\n            console.error(\"Invalid target URL:\", targetUrl);\r\n            this._isRedirecting = false;\r\n            return;\r\n        }\r\n        \r\n        console.log(\"Redirecting to:\", finalUrl.toString());\r\n        \r\n        // Short delay before redirecting\r\n        setTimeout(() => {\r\n            window.location.href = finalUrl.toString();\r\n        }, 100);\r\n    }\r\n    \r\n    handleExitPortalEntry() {\r\n        // Prevent multiple redirects\r\n        if (this._isRedirecting) return;\r\n        this._isRedirecting = true;\r\n        \r\n        console.log(\"Player entered exit portal\");\r\n        \r\n        // Construct next page URL\r\n        let nextPage = 'https://portal.pieter.com';\r\n        \r\n        // Get current parameters\r\n        const currentParams = new URLSearchParams(window.location.search);\r\n        \r\n        // Create URL object\r\n        const url = new URL(nextPage);\r\n        \r\n        // Add required parameters\r\n        url.searchParams.append('portal', 'true');\r\n        url.searchParams.append('username', this.getUsername());\r\n        url.searchParams.append('color', 'white'); // Default color\r\n        url.searchParams.append('speed', this.getPlayerSpeed());\r\n        \r\n        // Copy other parameters from current URL\r\n        for (const [key, value] of currentParams.entries()) {\r\n            if (!['portal', 'username', 'color', 'speed'].includes(key)) {\r\n                url.searchParams.append(key, value);\r\n            }\r\n        }\r\n        \r\n        console.log(\"Redirecting to:\", url.toString());\r\n        \r\n        // Short delay before redirecting\r\n        setTimeout(() => {\r\n            window.location.href = url.toString();\r\n        }, 100);\r\n    }\r\n    \r\n    getUsername() {\r\n        // Get username from game state if available\r\n        if (window.game && window.game.selfUsername) {\r\n            return window.game.selfUsername;\r\n        }\r\n        \r\n        // Fallback: generate a random username\r\n        return `Miner${Math.floor(Math.random() * 10000)}`;\r\n    }\r\n    \r\n    getPlayerSpeed() {\r\n        // Get current speed from game state if available\r\n        if (window.game && window.game.currentSpeed) {\r\n            return window.game.currentSpeed.toString();\r\n        }\r\n        \r\n        // Try to get speed from spaceship if available\r\n        if (this.spaceship && this.spaceship.velocity) {\r\n            return this.spaceship.velocity.length().toString();\r\n        }\r\n        \r\n        // Fallback: default speed\r\n        return '10';\r\n    }\r\n    \r\n    update(deltaTime) {\r\n        // Animate both portals\r\n        this.animateStartPortal(deltaTime);\r\n        this.animateExitPortal(deltaTime);\r\n        \r\n        // Check for portal interactions\r\n        this.checkPortalInteractions(deltaTime);\r\n    }\r\n    \r\n    dispose() {\r\n        // Clean up resources\r\n        if (this.startPortalGroup) {\r\n            this.scene.remove(this.startPortalGroup);\r\n        }\r\n        \r\n        if (this.exitPortalGroup) {\r\n            this.scene.remove(this.exitPortalGroup);\r\n        }\r\n        \r\n        // Clear references\r\n        this.startPortalGroup = null;\r\n        this.exitPortalGroup = null;\r\n        this.startPortalBox = null;\r\n        this.exitPortalBox = null;\r\n        this.startPortalParticleSystem = null;\r\n        this.exitPortalParticleSystem = null;\r\n    }\r\n} ","// spaceAnomalies.js - Creates and manages space anomalies with collectible energy orbs\n\nimport * as THREE from 'three';\n\nexport class SpaceAnomalies {\n    constructor(scene) {\n        this.scene = scene;\n        this.anomalies = [];\n        \n        // Anomalies are outside the asteroid belt\n        this.minRadius = 32000; // Beyond asteroid belt\n        this.maxRadius = 45000; // Not too far into deep space\n        this.width = 3000; // Height variation\n        \n        // Scale factors for size\n        this.anomalyScale = 4; // Make anomalies 4x bigger\n        this.orbScale = 4;     // Make orbs 4x bigger\n        \n        // Orb rarity and values\n        this.orbValues = {\n            common: 100,    // Green orb - 100 credits\n            uncommon: 500,  // Blue orb - 500 credits\n            rare: 1500,     // Purple orb - 1500 credits\n            epic: 5000,     // Orange orb - 5000 credits\n            legendary: 15000 // Red orb - 15000 credits\n        };\n        \n        // Initialize timer system for dynamic anomaly spawning\n        this.spawnTimer = 0;\n        this.checkInterval = 60; // Check every 60 seconds (1 minute)\n        this.spawnChance = 0.5; // 50% chance to spawn a new anomaly\n        this.despawnChance = 0.3; // 30% chance for an anomaly to despawn\n        \n        // Available anomaly types\n        this.anomalyTypes = [\n            'vortex',\n            'crystalCluster',\n            'nebulaNexus',\n            'quantumFlux',\n            'darkMatter'\n        ];\n        \n        // Maximum number of anomalies that can exist simultaneously\n        this.maxAnomalies = 5;\n        \n        // Notify about active anomalies\n        this.updateAnomalyCountDisplay();\n    }\n    \n    // Method to check and potentially spawn/despawn anomalies\n    checkAnomalySpawning(deltaTime) {\n        // Increment timer\n        this.spawnTimer += deltaTime;\n        \n        // Check if it's time to evaluate spawn/despawn\n        if (this.spawnTimer >= this.checkInterval) {\n            // Reset timer\n            this.spawnTimer -= this.checkInterval;\n            \n            // Check for potential new anomaly spawn\n            if (this.anomalies.length < this.maxAnomalies && Math.random() < this.spawnChance) {\n                // Determine which anomaly type to spawn\n                const availableTypes = this.anomalyTypes.filter(type => \n                    !this.anomalies.some(anomaly => anomaly.type === type)\n                );\n                \n                if (availableTypes.length > 0) {\n                    const typeToSpawn = availableTypes[Math.floor(Math.random() * availableTypes.length)];\n                    this.spawnAnomaly(typeToSpawn);\n                    \n                    // Update HUD with new count\n                    this.updateAnomalyCountDisplay();\n                }\n            }\n            \n            // Check each existing anomaly for potential despawn\n            const anomaliesToRemove = [];\n            this.anomalies.forEach(anomaly => {\n                if (Math.random() < this.despawnChance) {\n                    anomaliesToRemove.push(anomaly);\n                }\n            });\n            \n            // Remove marked anomalies\n            if (anomaliesToRemove.length > 0) {\n                anomaliesToRemove.forEach(anomaly => {\n                    this.despawnAnomaly(anomaly);\n                });\n                \n                // Update HUD with new count\n                this.updateAnomalyCountDisplay();\n            }\n        }\n    }\n    \n    // Spawn a specific type of anomaly\n    spawnAnomaly(type) {\n        console.log(`Spawning ${type} anomaly`);\n        \n        switch(type) {\n            case 'vortex':\n                this.createVortexAnomaly();\n                break;\n            case 'crystalCluster':\n                this.createCrystalClusterAnomaly();\n                break;\n            case 'nebulaNexus':\n                this.createNebulaNexusAnomaly();\n                break;\n            case 'quantumFlux':\n                this.createQuantumFluxAnomaly();\n                break;\n            case 'darkMatter':\n                this.createDarkMatterAnomaly();\n                break;\n        }\n    }\n    \n    // Despawn and cleanup a specific anomaly\n    despawnAnomaly(anomaly) {\n        console.log(`Despawning ${anomaly.type} anomaly`);\n        \n        // Remove from scene\n        this.scene.remove(anomaly.mesh);\n        \n        // Perform specific cleanup based on anomaly type\n        switch (anomaly.type) {\n            case 'vortex':\n                // Clean up rings\n                if (anomaly.rings) {\n                    anomaly.rings.forEach(ring => {\n                        if (ring.mesh && ring.mesh.geometry) {\n                            ring.mesh.geometry.dispose();\n                        }\n                        if (ring.mesh && ring.mesh.material) {\n                            if (Array.isArray(ring.mesh.material)) {\n                                ring.mesh.material.forEach(m => m.dispose());\n                            } else {\n                                ring.mesh.material.dispose();\n                            }\n                        }\n                    });\n                }\n                break;\n                \n            case 'crystalCluster':\n                // Clean up crystals\n                if (anomaly.crystals) {\n                    anomaly.crystals.forEach(crystal => {\n                        if (crystal.mesh && crystal.mesh.geometry) {\n                            crystal.mesh.geometry.dispose();\n                        }\n                        if (crystal.mesh && crystal.mesh.material) {\n                            if (Array.isArray(crystal.mesh.material)) {\n                                crystal.mesh.material.forEach(m => m.dispose());\n                            } else {\n                                crystal.mesh.material.dispose();\n                            }\n                        }\n                    });\n                }\n                break;\n                \n            case 'nebulaNexus':\n                // Clean up rings, core, and arcs\n                if (anomaly.rings) {\n                    anomaly.rings.forEach(ring => {\n                        if (ring.mesh && ring.mesh.geometry) {\n                            ring.mesh.geometry.dispose();\n                        }\n                        if (ring.mesh && ring.mesh.material) {\n                            if (Array.isArray(ring.mesh.material)) {\n                                ring.mesh.material.forEach(m => m.dispose());\n                            } else {\n                                ring.mesh.material.dispose();\n                            }\n                        }\n                    });\n                }\n                if (anomaly.core && anomaly.core.mesh) {\n                    if (anomaly.core.mesh.geometry) anomaly.core.mesh.geometry.dispose();\n                    if (anomaly.core.mesh.material) {\n                        if (Array.isArray(anomaly.core.mesh.material)) {\n                            anomaly.core.mesh.material.forEach(m => m.dispose());\n                        } else {\n                            anomaly.core.mesh.material.dispose();\n                        }\n                    }\n                }\n                if (anomaly.arcs) {\n                    anomaly.arcs.forEach(arc => {\n                        if (arc.mesh && arc.mesh.geometry) {\n                            arc.mesh.geometry.dispose();\n                        }\n                        if (arc.mesh && arc.mesh.material) {\n                            if (Array.isArray(arc.mesh.material)) {\n                                arc.mesh.material.forEach(m => m.dispose());\n                            } else {\n                                arc.mesh.material.dispose();\n                            }\n                        }\n                    });\n                }\n                break;\n                \n            case 'quantumFlux':\n                // Clean up frames and particles\n                if (anomaly.frames) {\n                    anomaly.frames.forEach(frame => {\n                        if (frame.mesh && frame.mesh.geometry) {\n                            frame.mesh.geometry.dispose();\n                        }\n                        if (frame.mesh && frame.mesh.material) {\n                            if (Array.isArray(frame.mesh.material)) {\n                                frame.mesh.material.forEach(m => m.dispose());\n                            } else {\n                                frame.mesh.material.dispose();\n                            }\n                        }\n                        if (frame.innerBox) {\n                            if (frame.innerBox.geometry) frame.innerBox.geometry.dispose();\n                            if (frame.innerBox.material) {\n                                if (Array.isArray(frame.innerBox.material)) {\n                                    frame.innerBox.material.forEach(m => m.dispose());\n                                } else {\n                                    frame.innerBox.material.dispose();\n                                }\n                            }\n                        }\n                    });\n                }\n                if (anomaly.particles && anomaly.particles.mesh) {\n                    if (anomaly.particles.mesh.geometry) anomaly.particles.mesh.geometry.dispose();\n                    if (anomaly.particles.mesh.material) {\n                        if (Array.isArray(anomaly.particles.mesh.material)) {\n                            anomaly.particles.mesh.material.forEach(m => m.dispose());\n                        } else {\n                            anomaly.particles.mesh.material.dispose();\n                        }\n                    }\n                }\n                break;\n                \n            case 'darkMatter':\n                // Clean up core, rings, and particles\n                if (anomaly.core && anomaly.core.mesh) {\n                    if (anomaly.core.mesh.geometry) anomaly.core.mesh.geometry.dispose();\n                    if (anomaly.core.mesh.material) {\n                        if (Array.isArray(anomaly.core.mesh.material)) {\n                            anomaly.core.mesh.material.forEach(m => m.dispose());\n                        } else {\n                            anomaly.core.mesh.material.dispose();\n                        }\n                    }\n                }\n                if (anomaly.rings) {\n                    anomaly.rings.forEach(ring => {\n                        if (ring.mesh && ring.mesh.geometry) {\n                            ring.mesh.geometry.dispose();\n                        }\n                        if (ring.mesh && ring.mesh.material) {\n                            if (Array.isArray(ring.mesh.material)) {\n                                ring.mesh.material.forEach(m => m.dispose());\n                            } else {\n                                ring.mesh.material.dispose();\n                            }\n                        }\n                    });\n                }\n                if (anomaly.particles && anomaly.particles.mesh) {\n                    if (anomaly.particles.mesh.geometry) anomaly.particles.mesh.geometry.dispose();\n                    if (anomaly.particles.mesh.material) {\n                        if (Array.isArray(anomaly.particles.mesh.material)) {\n                            anomaly.particles.mesh.material.forEach(m => m.dispose());\n                        } else {\n                            anomaly.particles.mesh.material.dispose();\n                        }\n                    }\n                }\n                break;\n        }\n        \n        // Clean up the orb\n        if (anomaly.orb && anomaly.orb.mesh) {\n            if (anomaly.orb.mesh.geometry) anomaly.orb.mesh.geometry.dispose();\n            if (anomaly.orb.mesh.material) {\n                if (Array.isArray(anomaly.orb.mesh.material)) {\n                    anomaly.orb.mesh.material.forEach(m => m.dispose());\n                } else {\n                    anomaly.orb.mesh.material.dispose();\n                }\n            }\n        }\n        \n        // Remove from anomalies array\n        const index = this.anomalies.indexOf(anomaly);\n        if (index !== -1) {\n            this.anomalies.splice(index, 1);\n        }\n    }\n    \n    // Update HUD to show active anomaly count\n    updateAnomalyCountDisplay() {\n        // Find the anomaly count element in the HUD\n        const anomalyCountEl = document.getElementById('anomaly-count');\n        if (anomalyCountEl) {\n            anomalyCountEl.textContent = this.anomalies.length.toString();\n        }\n    }\n    \n    // Get the number of active anomalies\n    getActiveAnomalyCount() {\n        return this.anomalies.length;\n    }\n    \n    // Modified update method to include anomaly spawning/despawning checks\n    update(deltaTime) {\n        // Check for spawning/despawning anomalies\n        this.checkAnomalySpawning(deltaTime);\n        \n        // Get player position if available (from global reference)\n        let playerPosition = null;\n        if (window.game && window.game.spaceship && window.game.spaceship.mesh) {\n            playerPosition = window.game.spaceship.mesh.position;\n        }\n        \n        // Update existing anomalies\n        for (let i = 0; i < this.anomalies.length; i++) {\n            const anomaly = this.anomalies[i];\n            \n            // Skip if orb is already collected\n            if (anomaly.orbCollected) {\n                // Simple rotation for collected anomalies\n                if (anomaly.mesh && anomaly.rotationSpeed) {\n                    anomaly.mesh.rotation.x += anomaly.rotationSpeed.x * deltaTime;\n                    anomaly.mesh.rotation.y += anomaly.rotationSpeed.y * deltaTime;\n                    anomaly.mesh.rotation.z += anomaly.rotationSpeed.z * deltaTime;\n                }\n                continue;\n            }\n            \n            // Check if player is nearby to enhance effects\n            let playerNearby = false;\n            if (playerPosition) {\n                const distance = playerPosition.distanceTo(anomaly.position);\n                playerNearby = distance < (anomaly.orb.size * 3) * this.orbScale; // Only enhance effects based on orb distance\n            }\n            \n            // Rotate the entire anomaly slowly\n            if (anomaly.mesh && anomaly.rotationSpeed) {\n                anomaly.mesh.rotation.x += anomaly.rotationSpeed.x * deltaTime;\n                anomaly.mesh.rotation.y += anomaly.rotationSpeed.y * deltaTime;\n                anomaly.mesh.rotation.z += anomaly.rotationSpeed.z * deltaTime;\n            }\n            \n            // Animate specific anomaly types\n            switch (anomaly.type) {\n                case 'vortex':\n                    this.updateVortexAnomaly(anomaly, deltaTime);\n                    break;\n                case 'crystalCluster':\n                    this.updateCrystalClusterAnomaly(anomaly, deltaTime);\n                    break;\n                case 'nebulaNexus':\n                    this.updateNebulaNexusAnomaly(anomaly, deltaTime);\n                    break;\n                case 'quantumFlux':\n                    this.updateQuantumFluxAnomaly(anomaly, deltaTime);\n                    break;\n                case 'darkMatter':\n                    this.updateDarkMatterAnomaly(anomaly, deltaTime);\n                    break;\n            }\n            \n            // Update orb effects based on player proximity\n            this.updateOrbEffects(anomaly, playerNearby);\n        }\n    }\n    \n    createVortexAnomaly() {\n        // Create a spiraling vortex structure with central orb\n        \n        // Determine position outside asteroid belt\n        const position = this.getRandomAnomalyPosition();\n        const anomalyGroup = new THREE.Group();\n        anomalyGroup.position.copy(position);\n        \n        // Apply scale to make anomaly 4x bigger\n        anomalyGroup.scale.set(this.anomalyScale, this.anomalyScale, this.anomalyScale);\n        \n        // Create the structural elements - spiral rings\n        const ringCount = 6;\n        const rings = [];\n        \n        // Create multiple rings with decreasing radius\n        for (let i = 0; i < ringCount; i++) {\n            const radius = 400 - (i * 50);\n            const geometry = new THREE.TorusGeometry(radius, 15, 16, 100); // Increased tube radius from 10 to 15\n            \n            // Bright blue-cyan color scheme for better visibility\n            const hue = 0.5 + (i * 0.05); // Blue to cyan gradient\n            const color = new THREE.Color().setHSL(hue, 0.9, 0.6); // Increased saturation and lightness\n            \n            const material = new THREE.MeshStandardMaterial({\n                color: color,\n                emissive: color.clone().multiplyScalar(0.5),\n                emissiveIntensity: 1.0,\n                metalness: 0.8,\n                roughness: 0.2,\n                transparent: true,\n                opacity: 0.95\n            });\n            \n            const ring = new THREE.Mesh(geometry, material);\n            \n            // Rotate each ring at different angles to create spiral effect\n            ring.rotation.x = Math.PI / 2 + (i * 0.2);\n            ring.rotation.y = i * 0.3;\n            \n            anomalyGroup.add(ring);\n            rings.push({\n                mesh: ring,\n                rotationSpeed: {\n                    x: 0.005 + (i * 0.002),\n                    y: 0.003 + (i * 0.001),\n                    z: 0.001 + (i * 0.0005)\n                }\n            });\n        }\n        \n        // Create energy orb in the center\n        const orbRarity = this.getRandomOrbRarity();\n        const orb = this.createEnergyOrb(orbRarity);\n        anomalyGroup.add(orb.mesh);\n        \n        // Add to scene\n        this.scene.add(anomalyGroup);\n        \n        // Save anomaly data\n        this.anomalies.push({\n            type: 'vortex',\n            mesh: anomalyGroup,\n            position: position.clone(),\n            rings: rings,\n            orb: orb,\n            collisionRadius: 350, // Overall collision size\n            orbCollected: false,\n            rotationSpeed: new THREE.Vector3(0.001, 0.002, 0.0015)\n        });\n    }\n    \n    createCrystalClusterAnomaly() {\n        // Create a crystalline structure with floating crystals and central orb\n        \n        // Determine position outside asteroid belt\n        const position = this.getRandomAnomalyPosition();\n        const anomalyGroup = new THREE.Group();\n        anomalyGroup.position.copy(position);\n        \n        // Apply scale to make anomaly 4x bigger\n        anomalyGroup.scale.set(this.anomalyScale, this.anomalyScale, this.anomalyScale);\n        \n        // Create main crystal structure using multiple crystal forms\n        const crystals = [];\n        const crystalCount = 20;\n        \n        for (let i = 0; i < crystalCount; i++) {\n            // Random crystal size\n            const size = 50 + Math.random() * 100; // Increased from 30+80 to 50+100\n            \n            // Create crystal geometry - mix of different polyhedra\n            let geometry;\n            const crystalType = Math.floor(Math.random() * 3);\n            \n            if (crystalType === 0) {\n                // Octahedron - diamond-like crystal\n                geometry = new THREE.OctahedronGeometry(size, 0);\n            } else if (crystalType === 1) {\n                // Dodecahedron - more complex crystal\n                geometry = new THREE.DodecahedronGeometry(size, 0);\n            } else {\n                // Prism-like crystal using stretched tetrahedron\n                geometry = new THREE.TetrahedronGeometry(size, 0);\n                \n                // Stretch it to make it more crystal-like\n                const positions = geometry.attributes.position;\n                for (let j = 0; j < positions.count; j++) {\n                    const vertex = new THREE.Vector3();\n                    vertex.fromBufferAttribute(positions, j);\n                    \n                    // Stretch along one axis\n                    vertex.y *= 2.5;\n                    \n                    positions.setXYZ(j, vertex.x, vertex.y, vertex.z);\n                }\n                geometry.computeVertexNormals();\n            }\n            \n            // Create a semi-transparent crystalline material with bright teal colors\n            const hue = 0.45 + Math.random() * 0.1; // Teal/aqua/green color palette\n            const saturation = 0.9 + Math.random() * 0.1; // Increased saturation\n            const lightness = 0.6 + Math.random() * 0.2; // Increased lightness\n            \n            const color = new THREE.Color().setHSL(hue, saturation, lightness);\n            \n            const material = new THREE.MeshStandardMaterial({\n                color: color,\n                metalness: 0.9,\n                roughness: 0.1,\n                transparent: true,\n                opacity: 0.9,\n                emissive: color.clone(),\n                emissiveIntensity: 0.5\n            });\n            \n            const crystal = new THREE.Mesh(geometry, material);\n            \n            // Position crystal in a spherical arrangement\n            const radius = 200 + Math.random() * 100;\n            const theta = Math.random() * Math.PI * 2;\n            const phi = Math.random() * Math.PI;\n            \n            crystal.position.set(\n                radius * Math.sin(phi) * Math.cos(theta),\n                radius * Math.sin(phi) * Math.sin(theta),\n                radius * Math.cos(phi)\n            );\n            \n            // Random rotation\n            crystal.rotation.set(\n                Math.random() * Math.PI * 2,\n                Math.random() * Math.PI * 2,\n                Math.random() * Math.PI * 2\n            );\n            \n            anomalyGroup.add(crystal);\n            \n            // Store crystal data for animation\n            crystals.push({\n                mesh: crystal,\n                initialPosition: crystal.position.clone(),\n                floatPhase: Math.random() * Math.PI * 2,\n                floatSpeed: 0.3 + Math.random() * 0.3,\n                floatAmplitude: 5 + Math.random() * 10,\n                rotationSpeed: {\n                    x: (Math.random() - 0.5) * 0.01,\n                    y: (Math.random() - 0.5) * 0.01,\n                    z: (Math.random() - 0.5) * 0.01\n                }\n            });\n        }\n        \n        // Create energy orb in the center\n        const orbRarity = this.getRandomOrbRarity();\n        const orb = this.createEnergyOrb(orbRarity);\n        anomalyGroup.add(orb.mesh);\n        \n        // Add to scene\n        this.scene.add(anomalyGroup);\n        \n        // Save anomaly data\n        this.anomalies.push({\n            type: 'crystalCluster',\n            mesh: anomalyGroup,\n            position: position.clone(),\n            crystals: crystals,\n            orb: orb,\n            collisionRadius: 300, // Overall collision size\n            orbCollected: false,\n            rotationSpeed: new THREE.Vector3(0.0005, 0.001, 0.0005)\n        });\n    }\n    \n    createNebulaNexusAnomaly() {\n        // Create a crystalline ring structure with central orb\n        // Completely redesigned from particle-based nebula to solid structure\n        \n        // Determine position outside asteroid belt\n        const position = this.getRandomAnomalyPosition();\n        const anomalyGroup = new THREE.Group();\n        anomalyGroup.position.copy(position);\n        \n        // Apply scale to make anomaly 4x bigger\n        anomalyGroup.scale.set(this.anomalyScale, this.anomalyScale, this.anomalyScale);\n        \n        // Create a series of rotating rings with crystal formations\n        const ringCount = 3;\n        const rings = [];\n        \n        // Create multiple crystal-studded rings\n        for (let i = 0; i < ringCount; i++) {\n            // Create a ring\n            const ringRadius = 200 + i * 60;\n            const ringGeometry = new THREE.TorusGeometry(ringRadius, 8, 16, 50);\n            \n            // Create a vibrant material for the ring\n            const ringHue = 0.6 + i * 0.1; // Blue to purple gradient\n            const ringColor = new THREE.Color().setHSL(ringHue, 1.0, 0.6);\n            \n            const ringMaterial = new THREE.MeshStandardMaterial({\n                color: ringColor,\n                emissive: ringColor.clone().multiplyScalar(0.5),\n                emissiveIntensity: 1.0,\n                metalness: 0.9,\n                roughness: 0.1,\n                transparent: false,\n                opacity: 1.0\n            });\n            \n            const ring = new THREE.Mesh(ringGeometry, ringMaterial);\n            \n            // Position ring with different orientation\n            ring.rotation.x = Math.PI/2 + (i * Math.PI/3);\n            ring.rotation.y = i * Math.PI/4;\n            \n            anomalyGroup.add(ring);\n            \n            // Add crystals along the ring\n            const crystalCount = 10 + i * 5;\n            const crystals = [];\n            \n            for (let j = 0; j < crystalCount; j++) {\n                // Crystal position along the ring\n                const angle = (j / crystalCount) * Math.PI * 2;\n                \n                // Create crystal geometry\n                const crystalSize = 15 + Math.random() * 10;\n                const crystalGeometry = new THREE.OctahedronGeometry(crystalSize, 0);\n                \n                // Create crystal material with complementary color\n                const crystalHue = (ringHue + 0.5) % 1.0; // Complementary color\n                const crystalColor = new THREE.Color().setHSL(crystalHue, 1.0, 0.7);\n                \n                const crystalMaterial = new THREE.MeshStandardMaterial({\n                    color: crystalColor,\n                    emissive: crystalColor.clone(),\n                    emissiveIntensity: 0.8,\n                    metalness: 0.9,\n                    roughness: 0.1,\n                    transparent: false,\n                    opacity: 1.0\n                });\n                \n                const crystal = new THREE.Mesh(crystalGeometry, crystalMaterial);\n                \n                // Position crystal on the ring\n                crystal.position.x = ringRadius * Math.cos(angle);\n                crystal.position.y = 0;\n                crystal.position.z = ringRadius * Math.sin(angle);\n                \n                // Random rotation\n                crystal.rotation.x = Math.random() * Math.PI;\n                crystal.rotation.y = Math.random() * Math.PI;\n                crystal.rotation.z = Math.random() * Math.PI;\n                \n                ring.add(crystal);\n                \n                crystals.push({\n                    mesh: crystal,\n                    initialPosition: crystal.position.clone(),\n                    pulsePhase: Math.random() * Math.PI * 2,\n                    pulseSpeed: 0.5 + Math.random() * 0.5\n                });\n            }\n            \n            rings.push({\n                mesh: ring,\n                crystals: crystals,\n                rotationSpeed: 0.1 - (i * 0.03), // Outer rings rotate slower\n                rotationAxis: new THREE.Vector3(\n                    Math.random() - 0.5,\n                    Math.random() - 0.5,\n                    Math.random() - 0.5\n                ).normalize()\n            });\n        }\n        \n        // Create an inner sphere with energy effect\n        const coreRadius = 80;\n        const coreGeometry = new THREE.SphereGeometry(coreRadius, 32, 32);\n        const coreColor = new THREE.Color().setHSL(0.15, 1.0, 0.6); // Gold color\n        \n        const coreMaterial = new THREE.MeshStandardMaterial({\n            color: coreColor,\n            emissive: coreColor,\n            emissiveIntensity: 1.0,\n            metalness: 1.0,\n            roughness: 0.3,\n                transparent: true,\n            opacity: 0.9\n        });\n        \n        const core = new THREE.Mesh(coreGeometry, coreMaterial);\n        anomalyGroup.add(core);\n        \n        // Add energy arcs from core to rings\n        const arcCount = 8;\n        const arcs = [];\n        \n        for (let i = 0; i < arcCount; i++) {\n            const curve = new THREE.CubicBezierCurve3(\n                new THREE.Vector3(0, 0, 0),\n                new THREE.Vector3(\n                    (Math.random() - 0.5) * 200,\n                    (Math.random() - 0.5) * 200,\n                    (Math.random() - 0.5) * 200\n                ),\n                new THREE.Vector3(\n                    (Math.random() - 0.5) * 300,\n                    (Math.random() - 0.5) * 300,\n                    (Math.random() - 0.5) * 300\n                ),\n                new THREE.Vector3(\n                    (Math.random() - 0.5) * 400,\n                    (Math.random() - 0.5) * 400,\n                    (Math.random() - 0.5) * 400\n                )\n            );\n            \n            const points = curve.getPoints(20);\n            const arcGeometry = new THREE.BufferGeometry().setFromPoints(points);\n            \n            const arcColor = new THREE.Color().setHSL(0.15, 1.0, 0.6); // Gold color\n            const arcMaterial = new THREE.LineBasicMaterial({\n                color: arcColor,\n                linewidth: 3,\n                transparent: true,\n                opacity: 0.8\n            });\n            \n            const arc = new THREE.Line(arcGeometry, arcMaterial);\n            anomalyGroup.add(arc);\n            \n            arcs.push({\n                mesh: arc,\n                curve: curve,\n                updatePhase: Math.random() * Math.PI * 2,\n                updateSpeed: 0.2 + Math.random() * 0.3\n            });\n        }\n        \n        // Create energy orb in the center\n        const orbRarity = this.getRandomOrbRarity();\n        const orb = this.createEnergyOrb(orbRarity);\n        anomalyGroup.add(orb.mesh);\n        \n        // Add to scene\n        this.scene.add(anomalyGroup);\n        \n        // Save anomaly data\n        this.anomalies.push({\n            type: 'nebulaNexus',\n            mesh: anomalyGroup,\n            position: position.clone(),\n            rings: rings,\n            core: {\n                mesh: core,\n                pulsePhase: 0,\n                pulseSpeed: 0.5\n            },\n            arcs: arcs,\n            orb: orb,\n            collisionRadius: 250,\n            orbCollected: false,\n            rotationSpeed: new THREE.Vector3(0.0003, 0.0004, 0.0002)\n        });\n    }\n    \n    createQuantumFluxAnomaly() {\n        // Create a quantum flux anomaly with rotating cube frames\n        \n        // Determine position outside asteroid belt\n        const position = this.getRandomAnomalyPosition();\n        const anomalyGroup = new THREE.Group();\n        anomalyGroup.position.copy(position);\n        \n        // Apply scale to make anomaly 4x bigger\n        anomalyGroup.scale.set(this.anomalyScale, this.anomalyScale, this.anomalyScale);\n        \n        // Create rotating cubic frames\n        const frames = [];\n        const frameCount = 5;\n        \n        for (let i = 0; i < frameCount; i++) {\n            // Create cubic wireframe box\n            const size = 250 - i * 40;\n            const geometry = new THREE.BoxGeometry(size, size, size);\n            \n            // Add a solid but transparent box inside the wireframe for better visibility\n            const innerGeometry = new THREE.BoxGeometry(size * 0.98, size * 0.98, size * 0.98);\n            \n            // Extract only edges to create wireframe\n            const edges = new THREE.EdgesGeometry(geometry);\n            \n            // Use extremely vibrant electric colors\n            const hue = 0.3 + i * 0.1; // Shift from green to blue\n            const color = new THREE.Color().setHSL(hue, 1.0, 0.6);\n            \n            const material = new THREE.LineBasicMaterial({ \n                color: color,\n                linewidth: 2,\n                transparent: false, // Changed to non-transparent for better visibility\n                opacity: 1.0\n            });\n            \n            // Inner box with semi-transparent material\n            const innerMaterial = new THREE.MeshBasicMaterial({\n                color: color,\n                transparent: true,\n                opacity: 0.1,\n                side: THREE.DoubleSide\n            });\n            \n            const frame = new THREE.LineSegments(edges, material);\n            const innerBox = new THREE.Mesh(innerGeometry, innerMaterial);\n            \n            // Add both to group and store for animation\n            anomalyGroup.add(frame);\n            anomalyGroup.add(innerBox);\n            \n            frames.push({\n                mesh: frame,\n                innerBox: innerBox,\n                rotationAxis: new THREE.Vector3(\n                    Math.random() - 0.5,\n                    Math.random() - 0.5,\n                    Math.random() - 0.5\n                ).normalize(),\n                rotationSpeed: 0.01 + i * 0.005,\n                pulsePhase: Math.random() * Math.PI * 2\n            });\n        }\n        \n        // Add energy particles inside\n        const particleCount = 200;\n        const particleGeometry = new THREE.BufferGeometry();\n        const particlePositions = new Float32Array(particleCount * 3);\n        const particleSizes = new Float32Array(particleCount);\n        \n        for (let i = 0; i < particleCount; i++) {\n            const i3 = i * 3;\n            \n            // Position particles within the inner cube\n            const radius = 100 * Math.random();\n            const theta = Math.random() * Math.PI * 2;\n            const phi = Math.random() * Math.PI;\n            \n            particlePositions[i3] = radius * Math.sin(phi) * Math.cos(theta);\n            particlePositions[i3 + 1] = radius * Math.sin(phi) * Math.sin(theta);\n            particlePositions[i3 + 2] = radius * Math.cos(phi);\n            \n            // Vary particle sizes\n            particleSizes[i] = 2 + Math.random() * 3;\n        }\n        \n        particleGeometry.setAttribute('position', new THREE.BufferAttribute(particlePositions, 3));\n        particleGeometry.setAttribute('size', new THREE.BufferAttribute(particleSizes, 1));\n        \n        const particleMaterial = new THREE.PointsMaterial({\n            color: 0xff00ff, // Magenta\n            size: 6,\n            blending: THREE.AdditiveBlending,\n            transparent: true,\n            opacity: 0.9\n        });\n        \n        const particles = new THREE.Points(particleGeometry, particleMaterial);\n        anomalyGroup.add(particles);\n        \n        // Create energy orb in the center\n        const orbRarity = this.getRandomOrbRarity();\n        const orb = this.createEnergyOrb(orbRarity);\n        anomalyGroup.add(orb.mesh);\n        \n        // Add to scene\n        this.scene.add(anomalyGroup);\n        \n        // Save anomaly data\n        this.anomalies.push({\n            type: 'quantumFlux',\n            mesh: anomalyGroup,\n            position: position.clone(),\n            frames: frames,\n            particles: {\n                mesh: particles,\n                positions: particlePositions,\n                initialPositions: particlePositions.slice(), // Clone for reference\n                velocities: Array(particleCount).fill().map(() => new THREE.Vector3(\n                    (Math.random() - 0.5) * 0.5,\n                    (Math.random() - 0.5) * 0.5,\n                    (Math.random() - 0.5) * 0.5\n                ))\n            },\n            orb: orb,\n            collisionRadius: 230, // Overall collision size\n            orbCollected: false,\n            rotationSpeed: new THREE.Vector3(0.0001, 0.0002, 0.0001)\n        });\n    }\n    \n    createDarkMatterAnomaly() {\n        // Create a dark matter anomaly with gravitational lensing effects\n        \n        // Determine position outside asteroid belt\n        const position = this.getRandomAnomalyPosition();\n        const anomalyGroup = new THREE.Group();\n        anomalyGroup.position.copy(position);\n        \n        // Apply scale to make anomaly 4x bigger\n        anomalyGroup.scale.set(this.anomalyScale, this.anomalyScale, this.anomalyScale);\n        \n        // Create the dark matter core - a sphere with dark, distortion-like material\n        const coreRadius = 100;\n        const coreGeometry = new THREE.SphereGeometry(coreRadius, 32, 32);\n        const coreMaterial = new THREE.MeshStandardMaterial({\n            color: 0x330033,\n            emissive: 0x880088,\n            emissiveIntensity: 1.5,\n            metalness: 1.0,\n            roughness: 0.0,\n            transparent: true,\n            opacity: 0.95\n        });\n        \n        const core = new THREE.Mesh(coreGeometry, coreMaterial);\n        \n        // Add a glow effect around the core\n        const glowGeometry = new THREE.SphereGeometry(coreRadius * 1.2, 32, 32);\n        const glowMaterial = new THREE.MeshBasicMaterial({\n            color: 0x9900ff,\n            transparent: true,\n            opacity: 0.3,\n            side: THREE.BackSide\n        });\n        \n        const glow = new THREE.Mesh(glowGeometry, glowMaterial);\n        core.add(glow);\n        \n        anomalyGroup.add(core);\n        \n        // Create gravitational distortion rings\n        const rings = [];\n        const ringCount = 4;\n        \n        for (let i = 0; i < ringCount; i++) {\n            const radius = 150 + i * 60;\n            const tubeRadius = 4 + i * 2;\n            const geometry = new THREE.TorusGeometry(radius, tubeRadius, 16, 100);\n            \n            // Use dark/purple color scheme with increasing brightness outward\n            const color = new THREE.Color().setHSL(0.75, 0.9, 0.1 + i * 0.15);\n            \n            const material = new THREE.MeshStandardMaterial({\n                color: color,\n                emissive: color.clone().multiplyScalar(0.7),\n                emissiveIntensity: 0.5 + i * 0.2,\n                metalness: 0.8,\n                roughness: 0.2,\n                transparent: true,\n                opacity: 0.85\n            });\n            \n            const ring = new THREE.Mesh(geometry, material);\n            \n            // Position with random orientation\n            ring.rotation.x = Math.random() * Math.PI;\n            ring.rotation.y = Math.random() * Math.PI;\n            ring.rotation.z = Math.random() * Math.PI;\n            \n            anomalyGroup.add(ring);\n            rings.push({\n                mesh: ring,\n                rotationAxis: new THREE.Vector3(\n                    Math.random() - 0.5,\n                    Math.random() - 0.5,\n                    Math.random() - 0.5\n                ).normalize(),\n                rotationSpeed: 0.002 + i * 0.001,\n                warpPhase: Math.random() * Math.PI * 2,\n                warpSpeed: 0.5 + Math.random() * 0.5\n            });\n        }\n        \n        // Create distortion particles\n        const particleCount = 300;\n        const particleGeometry = new THREE.BufferGeometry();\n        const particlePositions = new Float32Array(particleCount * 3);\n        const particleSizes = new Float32Array(particleCount);\n        \n        for (let i = 0; i < particleCount; i++) {\n            const i3 = i * 3;\n            \n            // Distribute particles in a spherical shell\n            const radius = 120 + Math.random() * 250;\n            const theta = Math.random() * Math.PI * 2;\n            const phi = Math.random() * Math.PI;\n            \n            particlePositions[i3] = radius * Math.sin(phi) * Math.cos(theta);\n            particlePositions[i3 + 1] = radius * Math.sin(phi) * Math.sin(theta);\n            particlePositions[i3 + 2] = radius * Math.cos(phi);\n            \n            // Vary particle sizes\n            particleSizes[i] = 1 + Math.random() * 3;\n        }\n        \n        particleGeometry.setAttribute('position', new THREE.BufferAttribute(particlePositions, 3));\n        particleGeometry.setAttribute('size', new THREE.BufferAttribute(particleSizes, 1));\n        \n        const particleMaterial = new THREE.PointsMaterial({\n            color: 0x8800ff,\n            size: 5,\n            blending: THREE.AdditiveBlending,\n            transparent: true,\n            opacity: 0.8\n        });\n        \n        const particles = new THREE.Points(particleGeometry, particleMaterial);\n        anomalyGroup.add(particles);\n        \n        // Create energy orb in the center\n        const orbRarity = this.getRandomOrbRarity();\n        const orb = this.createEnergyOrb(orbRarity);\n        anomalyGroup.add(orb.mesh);\n        \n        // Add to scene\n        this.scene.add(anomalyGroup);\n        \n        // Save anomaly data\n        this.anomalies.push({\n            type: 'darkMatter',\n            mesh: anomalyGroup,\n            position: position.clone(),\n            core: {\n                mesh: core,\n                pulsePhase: 0\n            },\n            rings: rings,\n            particles: {\n                mesh: particles,\n                positions: particlePositions,\n                initialPositions: particlePositions.slice(),\n                phases: Array(particleCount).fill().map(() => Math.random() * Math.PI * 2)\n            },\n            orb: orb,\n            collisionRadius: 200, // Overall collision size\n            orbCollected: false,\n            rotationSpeed: new THREE.Vector3(0.0002, 0.0003, 0.0001)\n        });\n    }\n    \n    createEnergyOrb(rarity) {\n        // Create an energy orb with glow effects based on rarity\n        \n        // Determine orb color and properties based on rarity\n        let color, size, intensity, pulseSpeed;\n        \n        switch(rarity) {\n            case 'legendary':\n                color = new THREE.Color(0xff0000); // Red\n                size = 30 * this.orbScale;  // 4x bigger\n                intensity = 0.9;\n                pulseSpeed = 2.0;\n                break;\n            case 'epic':\n                color = new THREE.Color(0xff6600); // Orange\n                size = 25 * this.orbScale;  // 4x bigger\n                intensity = 0.8;\n                pulseSpeed = 1.8;\n                break;\n            case 'rare':\n                color = new THREE.Color(0x9900ff); // Purple\n                size = 22 * this.orbScale;  // 4x bigger\n                intensity = 0.7;\n                pulseSpeed = 1.5;\n                break;\n            case 'uncommon':\n                color = new THREE.Color(0x0066ff); // Blue\n                size = 20 * this.orbScale;  // 4x bigger\n                intensity = 0.6;\n                pulseSpeed = 1.2;\n                break;\n            default: // common\n                color = new THREE.Color(0x00ff66); // Green\n                size = 18 * this.orbScale;  // 4x bigger\n                intensity = 0.5;\n                pulseSpeed = 1.0;\n                break;\n        }\n        \n        // Create the core orb\n        const orbGeometry = new THREE.SphereGeometry(size, 32, 32);\n        const orbMaterial = new THREE.MeshStandardMaterial({\n            color: color,\n            emissive: color,\n            emissiveIntensity: intensity,\n            metalness: 0.8,\n            roughness: 0.2,\n            transparent: true,\n            opacity: 0.9\n        });\n        \n        const orb = new THREE.Mesh(orbGeometry, orbMaterial);\n        \n        // Create outer glow\n        const glowSize = size * 1.5;\n        const glowGeometry = new THREE.SphereGeometry(glowSize, 32, 32);\n        const glowMaterial = new THREE.MeshBasicMaterial({\n            color: color,\n            transparent: true,\n            opacity: 0.3,\n            side: THREE.BackSide,\n            blending: THREE.AdditiveBlending\n        });\n        \n        const glow = new THREE.Mesh(glowGeometry, glowMaterial);\n        orb.add(glow);\n        \n        // Return orb data\n        return {\n            mesh: orb,\n            rarity: rarity,\n            value: this.orbValues[rarity],\n            size: size,\n            color: color,\n            pulsePhase: 0,\n            pulseSpeed: pulseSpeed,\n            glow: glow\n        };\n    }\n    \n    createParticleTexture() {\n        // Create a particle texture for better-looking nebula particles\n        const canvas = document.createElement('canvas');\n        canvas.width = 64;\n        canvas.height = 64;\n        \n        const context = canvas.getContext('2d');\n        const gradient = context.createRadialGradient(\n            32, 32, 0,\n            32, 32, 32\n        );\n        \n        gradient.addColorStop(0, 'rgba(255,255,255,1)');\n        gradient.addColorStop(0.3, 'rgba(255,255,255,0.8)');\n        gradient.addColorStop(0.7, 'rgba(200,200,200,0.3)');\n        gradient.addColorStop(1, 'rgba(100,100,100,0)');\n        \n        context.fillStyle = gradient;\n        context.fillRect(0, 0, 64, 64);\n        \n        const texture = new THREE.Texture(canvas);\n        texture.needsUpdate = true;\n        return texture;\n    }\n    \n    getRandomAnomalyPosition() {\n        // Get random position outside asteroid belt\n        const angle = Math.random() * Math.PI * 2;\n        const radius = this.minRadius + Math.random() * (this.maxRadius - this.minRadius);\n        const heightVariation = (Math.random() - 0.5) * this.width;\n        \n        return new THREE.Vector3(\n            Math.cos(angle) * radius,\n            heightVariation,\n            Math.sin(angle) * radius\n        );\n    }\n    \n    getRandomOrbRarity() {\n        // Determine orb rarity based on probabilities\n        const roll = Math.random();\n        \n        if (roll < 0.005) {\n            return 'legendary'; // 0.5% chance\n        } else if (roll < 0.025) {\n            return 'epic'; // 2% chance\n        } else if (roll < 0.1) {\n            return 'rare'; // 7.5% chance\n        } else if (roll < 0.3) {\n            return 'uncommon'; // 20% chance\n        } else {\n            return 'common'; // 70% chance\n        }\n    }\n    \n    getRegionInfo() {\n        return {\n            center: new THREE.Vector3(0, 0, 0),\n            innerRadius: this.minRadius,\n            outerRadius: this.maxRadius\n        };\n    }\n    \n    findClosestAnomaly(position, maxDistance = 8000) {\n        let closestAnomaly = null;\n        let closestDistance = maxDistance;\n        \n        this.anomalies.forEach(anomaly => {\n            // Calculate distance to this anomaly\n            const distance = position.distanceTo(anomaly.position);\n            \n            if (distance < closestDistance) {\n                closestDistance = distance;\n                closestAnomaly = anomaly;\n            }\n        });\n        \n        return closestAnomaly;\n    }\n    \n    collectOrb(anomaly) {\n        if (!anomaly || anomaly.orbCollected) {\n            return null; // Already collected or invalid anomaly\n        }\n        \n        // Get orb data before marking as collected\n        const orbData = {\n            rarity: anomaly.orb.rarity,\n            value: this.orbValues[anomaly.orb.rarity] || 100 // Default to 100 if rarity not found\n        };\n        \n        // Mark as collected and update visuals\n        anomaly.orbCollected = true;\n        \n        // Hide the orb\n        if (anomaly.orb && anomaly.orb.mesh) {\n            anomaly.orb.mesh.visible = false;\n            \n            // Also hide glow if present\n            if (anomaly.orb.glow) {\n                anomaly.orb.glow.visible = false;\n            }\n        }\n        \n        return orbData; // Return data for player inventory and notification\n    }\n    \n    checkCollision(position, anomaly) {\n        if (!position || !anomaly || !anomaly.position) return false;\n        \n        // Calculate distance from player to anomaly center\n        const distance = position.distanceTo(anomaly.position);\n        \n        // Check if within orb collection radius - we only want orb collisions, not anomaly collision\n        // Use the original collision radius for orb collection, scaled by orbScale\n        // This ensures we're only checking for the orb and not the anomaly itself\n        return distance < (anomaly.orb.size * 2) * this.orbScale;\n    }\n    \n    updateOrbEffects(anomaly, playerNearby) {\n        if (!anomaly || !anomaly.orb || anomaly.orbCollected) return;\n        \n        // Enhance orb effects when player is nearby to make collection more obvious\n        if (playerNearby) {\n            // If player is nearby, make the orb pulse more dramatically\n            const scale = 1.5 + Math.sin(performance.now() * 0.005) * 0.5;\n            anomaly.orb.mesh.scale.set(scale, scale, scale);\n            \n            // Increase emission intensity\n            if (anomaly.orb.mesh.material) {\n                anomaly.orb.mesh.material.emissiveIntensity = 2.0;\n            }\n        } else {\n            // Reset to normal effects when player is not nearby\n            const scale = 1.0 + Math.sin(performance.now() * 0.002) * 0.2;\n            anomaly.orb.mesh.scale.set(scale, scale, scale);\n            \n            // Normal emission intensity\n            if (anomaly.orb.mesh.material) {\n                anomaly.orb.mesh.material.emissiveIntensity = 0.8;\n            }\n        }\n    }\n    \n    updateVortexAnomaly(anomaly, deltaTime) {\n        // Rotate each ring\n        anomaly.rings.forEach(ring => {\n            ring.mesh.rotation.x += ring.rotationSpeed.x * deltaTime;\n            ring.mesh.rotation.y += ring.rotationSpeed.y * deltaTime;\n            ring.mesh.rotation.z += ring.rotationSpeed.z * deltaTime;\n        });\n    }\n    \n    updateCrystalClusterAnomaly(anomaly, deltaTime) {\n        // Animate floating crystals\n        anomaly.crystals.forEach(crystal => {\n            // Update float phase\n            crystal.floatPhase += deltaTime * crystal.floatSpeed;\n            \n            // Create floating motion\n            const floatOffset = Math.sin(crystal.floatPhase) * crystal.floatAmplitude;\n            crystal.mesh.position.y = crystal.initialPosition.y + floatOffset;\n            \n            // Rotate the crystal\n            crystal.mesh.rotation.x += crystal.rotationSpeed.x;\n            crystal.mesh.rotation.y += crystal.rotationSpeed.y;\n            crystal.mesh.rotation.z += crystal.rotationSpeed.z;\n        });\n    }\n    \n    updateNebulaNexusAnomaly(anomaly, deltaTime) {\n        // Animate core\n        anomaly.core.pulsePhase += deltaTime * anomaly.core.pulseSpeed;\n        const scale = 1.0 + 0.2 * Math.sin(anomaly.core.pulsePhase);\n        anomaly.core.mesh.scale.set(scale, scale, scale);\n        \n        // Animate rings and crystals\n        anomaly.rings.forEach(ring => {\n            // Rotate each ring\n            const rotationMatrix = new THREE.Matrix4().makeRotationAxis(\n                ring.rotationAxis,\n                ring.rotationSpeed * deltaTime\n            );\n            ring.mesh.applyMatrix4(rotationMatrix);\n            \n            // Animate crystals on the ring\n            ring.crystals.forEach(crystal => {\n                crystal.pulsePhase += deltaTime * crystal.pulseSpeed;\n                const crystalScale = 1.0 + 0.3 * Math.sin(crystal.pulsePhase);\n                crystal.mesh.scale.set(crystalScale, crystalScale, crystalScale);\n            });\n        });\n        \n        // Animate energy arcs\n        anomaly.arcs.forEach(arc => {\n            arc.updatePhase += deltaTime * arc.updateSpeed;\n            \n            // Update arc control points for dynamic movement\n            const controlPoint1 = arc.curve.v1;\n            const controlPoint2 = arc.curve.v2;\n            \n            controlPoint1.x = Math.sin(arc.updatePhase) * 200;\n            controlPoint1.y = Math.cos(arc.updatePhase * 0.7) * 200;\n            controlPoint1.z = Math.sin(arc.updatePhase * 1.3) * 200;\n            \n            controlPoint2.x = Math.sin(arc.updatePhase * 0.8 + 1) * 300;\n            controlPoint2.y = Math.cos(arc.updatePhase * 1.2 + 2) * 300;\n            controlPoint2.z = Math.sin(arc.updatePhase * 0.9 + 3) * 300;\n            \n            // Update arc geometry\n            const points = arc.curve.getPoints(20);\n            arc.mesh.geometry.setFromPoints(points);\n            arc.mesh.geometry.attributes.position.needsUpdate = true;\n        });\n    }\n    \n    updateQuantumFluxAnomaly(anomaly, deltaTime) {\n        // Animate rotating frames\n        anomaly.frames.forEach(frame => {\n            // Rotate around custom axis\n            const rotationMatrix = new THREE.Matrix4().makeRotationAxis(\n                frame.rotationAxis,\n                frame.rotationSpeed * deltaTime\n            );\n            frame.mesh.applyMatrix4(rotationMatrix);\n            \n            // Also rotate the inner box if it exists\n            if (frame.innerBox) {\n                frame.innerBox.applyMatrix4(rotationMatrix);\n            }\n            \n            // Pulse effect\n            frame.pulsePhase += deltaTime;\n            const pulseScale = 1.0 + 0.05 * Math.sin(frame.pulsePhase);\n            frame.mesh.scale.set(pulseScale, pulseScale, pulseScale);\n            \n            // Also pulse the inner box if it exists\n            if (frame.innerBox) {\n                frame.innerBox.scale.set(pulseScale, pulseScale, pulseScale);\n            }\n        });\n        \n        // Animate particles\n        const positions = anomaly.particles.positions;\n        const velocities = anomaly.particles.velocities;\n        \n        for (let i = 0; i < positions.length / 3; i++) {\n            const i3 = i * 3;\n            \n            // Update position based on velocity\n            positions[i3] += velocities[i].x;\n            positions[i3 + 1] += velocities[i].y;\n            positions[i3 + 2] += velocities[i].z;\n            \n            // Contain particles within the inner cube\n            const maxDist = 120;\n            const pos = new THREE.Vector3(positions[i3], positions[i3 + 1], positions[i3 + 2]);\n            \n            if (pos.length() > maxDist) {\n                // Reflect particles at boundary\n                pos.normalize().multiplyScalar(maxDist);\n                positions[i3] = pos.x;\n                positions[i3 + 1] = pos.y;\n                positions[i3 + 2] = pos.z;\n                \n                // Reflect velocity\n                velocities[i].reflect(pos.normalize());\n            }\n        }\n        \n        // Update the geometry\n        anomaly.particles.mesh.geometry.attributes.position.needsUpdate = true;\n    }\n    \n    updateDarkMatterAnomaly(anomaly, deltaTime) {\n        // Animate core\n        anomaly.core.pulsePhase += deltaTime * 0.5;\n        const corePulse = 1.0 + 0.1 * Math.sin(anomaly.core.pulsePhase);\n        anomaly.core.mesh.scale.set(corePulse, corePulse, corePulse);\n        \n        // Animate rings\n        anomaly.rings.forEach(ring => {\n            // Rotate along custom axis\n            const rotationMatrix = new THREE.Matrix4().makeRotationAxis(\n                ring.rotationAxis,\n                ring.rotationSpeed * deltaTime\n            );\n            ring.mesh.applyMatrix4(rotationMatrix);\n            \n            // Warp effect\n            ring.warpPhase += deltaTime * ring.warpSpeed;\n            const warpX = 1.0 + 0.1 * Math.sin(ring.warpPhase);\n            const warpY = 1.0 + 0.1 * Math.sin(ring.warpPhase + Math.PI/3);\n            const warpZ = 1.0 + 0.1 * Math.sin(ring.warpPhase + Math.PI*2/3);\n            ring.mesh.scale.set(warpX, warpY, warpZ);\n        });\n        \n        // Animate particles\n        const positions = anomaly.particles.positions;\n        const initialPositions = anomaly.particles.initialPositions;\n        const phases = anomaly.particles.phases;\n        \n        for (let i = 0; i < positions.length / 3; i++) {\n            const i3 = i * 3;\n            \n            // Update phase\n            phases[i] += deltaTime;\n            \n            // Create gravitational distortion effect\n            const dist = Math.sqrt(\n                initialPositions[i3] * initialPositions[i3] +\n                initialPositions[i3 + 1] * initialPositions[i3 + 1] +\n                initialPositions[i3 + 2] * initialPositions[i3 + 2]\n            );\n            \n            const orbitSpeed = 0.5 + (300 / (dist + 10)); // Faster closer to center\n            phases[i] += deltaTime * orbitSpeed;\n            \n            // Create orbiting motion with radial oscillation\n            const radialPulse = 1.0 + 0.2 * Math.sin(phases[i] * 0.5);\n            \n            // Apply the distortion\n            const pos = new THREE.Vector3(\n                initialPositions[i3],\n                initialPositions[i3 + 1],\n                initialPositions[i3 + 2]\n            );\n            \n            // Rotate based on phase\n            const rotY = phases[i] * 0.2;\n            const rotZ = phases[i] * 0.1;\n            \n            pos.applyAxisAngle(new THREE.Vector3(0, 1, 0), rotY);\n            pos.applyAxisAngle(new THREE.Vector3(0, 0, 1), rotZ);\n            \n            // Apply radial pulse\n            pos.multiplyScalar(radialPulse);\n            \n            positions[i3] = pos.x;\n            positions[i3 + 1] = pos.y;\n            positions[i3 + 2] = pos.z;\n        }\n        \n        // Update the geometry\n        anomaly.particles.mesh.geometry.attributes.position.needsUpdate = true;\n    }\n    \n    updateForSystem(systemData) {\n        console.log(\"Updating space anomalies for new star system\");\n        \n        // Clear any existing anomalies\n        this.clearAllAnomalies();\n        \n        // Reset the timer to immediately check for spawning in the new system\n        this.spawnTimer = this.checkInterval;\n        \n        // Update HUD\n        this.updateAnomalyCountDisplay();\n    }\n    \n    clearAllAnomalies() {\n        // Clone the array to avoid modification during iteration\n        const anomaliesToRemove = [...this.anomalies];\n        \n        // Remove each anomaly\n        anomaliesToRemove.forEach(anomaly => {\n            this.despawnAnomaly(anomaly);\n        });\n        \n        // Ensure the array is empty\n        this.anomalies = [];\n        \n        // Update HUD\n        this.updateAnomalyCountDisplay();\n    }\n} ","// environment.js - Main environment class that integrates all environment components\n\nimport { Skybox } from './environment/skybox.js';\nimport { Sun } from './environment/sun.js';\nimport { Planets } from './environment/planets.js';\nimport { AsteroidBelt } from './environment/asteroidBelt.js';\nimport { Stargate } from './environment/stargate.js';\nimport { StarSystemGenerator } from './environment/starSystemGenerator.js';\nimport { SystemTransition } from './environment/systemTransition.js';\nimport { CustomSystemCreator } from './ui/customSystemCreator.js';\nimport { VibeVersePortals } from './environment/vibeVersePortals.js';\nimport { SpaceAnomalies } from './environment/spaceAnomalies.js';\n\nexport class Environment {\n    constructor(scene) {\n        this.scene = scene;\n        this.planetRegions = {};\n        this.currentSystemId = 'Solar System'; // Default starting system\n        this.componentsLoaded = false;\n        \n        console.log(\"Initializing essential environment components...\");\n        \n        // Initialize only essential components first\n        this.skybox = new Skybox(scene);\n        this.sun = new Sun(scene);\n        \n        // Initialize star system generator\n        this.starSystemGenerator = new StarSystemGenerator(scene);\n        \n        // Initialize planets with reference to starSystemGenerator - needed for basic gameplay\n        this.planets = new Planets(scene, this.starSystemGenerator);\n        \n        // Initialize stargate - needed for docking UI\n        this.stargate = new Stargate(scene);\n        \n        // Store references for easier access\n        this.asteroids = [];\n        \n        // Setup initial regions for location tracking (minimal setup)\n        this.setupInitialRegions();\n        \n        console.log(\"Essential environment components initialized\");\n        \n        // Schedule loading of remaining components after a short delay to not block startup\n        setTimeout(() => {\n            this.loadRemainingComponents();\n        }, 500);\n    }\n    \n    // Load remaining non-essential components asynchronously\n    loadRemainingComponents() {\n        console.log(\"Loading remaining environment components...\");\n        \n        // Initialize asteroid belt - slightly defer to prioritize UI loading\n        this.asteroidBelt = new AsteroidBelt(this.scene);\n        this.asteroids = this.asteroidBelt.getAsteroids();\n        \n        // Initialize space anomalies\n        this.spaceAnomalies = new SpaceAnomalies(this.scene);\n        \n        // Initialize system transition effects\n        this.systemTransition = new SystemTransition(this.scene, this.scene.camera);\n        \n        // Initialize the custom system creator\n        this.customSystemCreator = new CustomSystemCreator(this.starSystemGenerator, this);\n        console.log(\"Custom system creator initialized:\", this.customSystemCreator);\n        \n        // Setup complete regions now that all components are loaded\n        this.setupRegions();\n        \n        // Setup event handlers for star system transitions\n        this.setupSystemTransitionHandlers();\n        \n        this.componentsLoaded = true;\n        console.log(\"All environment components initialized\");\n    }\n    \n    // Basic region setup for essential components only\n    setupInitialRegions() {\n        console.log(\"Setting up essential environment regions\");\n        \n        // Initialize the planetRegions object\n        this.planetRegions = {};\n        \n        // Safely get planet regions if the method exists\n        if (this.planets && typeof this.planets.getPlanetRegions === 'function') {\n            try {\n                this.planetRegions = this.planets.getPlanetRegions();\n            } catch (error) {\n                console.warn(\"Error getting planet regions:\", error);\n            }\n        } else {\n            console.warn(\"planets.getPlanetRegions is not available, using empty object instead\");\n        }\n        \n        // Add sun region\n        this.planetRegions[\"Sun\"] = {\n            center: this.sun.getPosition(),\n            radius: this.sun.getRadius()\n        };\n        \n        // Add stargate region\n        const stargateRegion = this.stargate.getRegionInfo();\n        this.planetRegions[\"Stargate\"] = {\n            center: stargateRegion.center,\n            radius: stargateRegion.radius\n        };\n    }\n    \n    // Called after spaceship is created - we need this to initialize portals\n    setSpaceship(spaceship) {\n        this.spaceship = spaceship;\n        \n        // Initialize VibeVerse portals\n        this.vibeVersePortals = new VibeVersePortals(this.scene, spaceship);\n        console.log(\"VibeVerse portals initialized\");\n    }\n    \n    // Set up handlers for star system transitions\n    setupSystemTransitionHandlers() {\n        // Apply resource multipliers from current system to asteroid belt\n        if (this.starSystemGenerator && this.asteroidBelt) {\n            const resources = this.starSystemGenerator.getCurrentSystemResources();\n            this.asteroidBelt.setResourceMultipliers(resources);\n        }\n    }\n    \n    // Travel to a new star system\n    travelToSystem(systemId) {\n        if (!this.starSystemGenerator || !this.systemTransition) return false;\n        \n        // Check if the system exists and is connected to the current one\n        if (!this.starSystemGenerator.travelToSystem(systemId)) {\n            console.error(`Cannot travel to system ${systemId}`);\n            return false;\n        }\n        \n        console.log(`Starting transition to system: ${systemId}`);\n        \n        // Start the transition effect\n        this.systemTransition.startTransition(() => {\n            // This callback is called when transition is complete\n            console.log(`Transition complete, updating environment for: ${systemId}`);\n            \n            // Update the environment based on the new system\n            this.updateEnvironmentForSystem(systemId);\n            \n            // Display welcome notification\n            this.showSystemWelcomeNotification(systemId);\n            \n            // If player is docked, make sure the stargate interface is correctly displayed\n            if (window.game && window.game.spaceship && window.game.spaceship.isDocked) {\n                console.log(\"Player is docked after arriving in new system, showing interface\");\n                \n                // Handle docking system to enforce proper dock state\n                if (window.game.controls && window.game.controls.dockingSystem) {\n                    setTimeout(() => {\n                        // Trigger the docking system's docking method directly\n                        window.game.controls.dockingSystem.dockWithStargate();\n                    }, 500); // Small delay to ensure everything is ready\n                }\n            }\n        });\n        \n        return true;\n    }\n    \n    // Update environment visuals and properties for the new system\n    updateEnvironmentForSystem(systemId) {\n        const systemData = this.starSystemGenerator.getAllSystems()[systemId];\n        if (!systemData) {\n            console.error(`No system data found for ${systemId}`);\n            return;\n        }\n        \n        console.log(`Updating environment for system: ${systemId}`, systemData);\n        \n        // Update current system ID\n        this.currentSystemId = systemId;\n        \n        // Update skybox based on system properties\n        if (this.skybox && this.skybox.updateForSystem) {\n            // Special case for Solar System - always enforce white skybox\n            if (systemId === 'Solar System') {\n                const solarSystemParams = {\n                    starDensity: 1.0,\n                    nebulaDensity: 0.5,\n                    color: 0xFFFFFF,  // Ensure white color for Solar System\n                    isSolarSystem: true,  // Flag this as Solar System\n                    resetTime: true  // Reset the time for consistent appearance\n                };\n                console.log(`Updating skybox for Solar System with enforced white color`);\n                this.skybox.updateForSystem(solarSystemParams);\n            } else {\n                console.log(`Updating skybox for ${systemId} with params:`, systemData.skyboxParams);\n                this.skybox.updateForSystem(systemData.skyboxParams);\n            }\n        } else {\n            console.warn(\"Skybox or updateForSystem method not available\");\n        }\n        \n        // Update star (sun) color and properties\n        if (this.sun) {\n            // First check if it's a custom system with an intensity multiplier\n            const lightIntensityMultiplier = systemData.lightIntensityMultiplier || 1.0;\n            \n            // Check which update method to use\n            if (this.sun.updateSunType && systemData.starClass) {\n                console.log(`Updating sun type for ${systemId} to ${systemData.starClass} with intensity multiplier: ${lightIntensityMultiplier}`);\n                this.sun.updateSunType(systemData.starClass, lightIntensityMultiplier);\n            } else if (this.sun.updateColor) {\n                console.log(`Updating sun color for ${systemId} to:`, systemData.starColor.toString(16));\n                this.sun.updateColor(systemData.starColor);\n                \n                // Store the multiplier for use in the update method\n                if (this.sun.sunLight) {\n                    this.sun.sunLight._intensityMultiplier = lightIntensityMultiplier;\n                }\n            } else {\n                console.warn(\"Sun update methods not available\");\n            }\n        } else {\n            console.warn(\"Sun not available\");\n        }\n        \n        // Update planets for this system\n        if (this.planets && this.planets.updateForSystem) {\n            console.log(`Updating planets for ${systemId}`);\n            this.planets.updateForSystem(systemId);\n            \n            // Safely update planet regions if the method exists\n            if (typeof this.planets.getPlanetRegions === 'function') {\n                try {\n                    this.planetRegions = this.planets.getPlanetRegions();\n                } catch (error) {\n                    console.warn(`Error getting planet regions for system ${systemId}:`, error);\n                }\n            } else {\n                console.warn(`planets.getPlanetRegions is not available for system ${systemId}`);\n            }\n        } else {\n            console.warn(\"Planets or updateForSystem method not available\");\n        }\n        \n        // Update asteroid belt based on system properties\n        if (this.asteroidBelt && this.asteroidBelt.setResourceMultipliers) {\n            // Apply resource multipliers from system\n            console.log(`Updating asteroid resources for ${systemId}:`, systemData.resourceMultipliers);\n            this.asteroidBelt.setResourceMultipliers(systemData.resourceMultipliers);\n            \n            // Update asteroid density if the method exists\n            if (this.asteroidBelt.updateDensity) {\n                console.log(`Updating asteroid density for ${systemId}:`, systemData.asteroidDensity);\n                this.asteroidBelt.updateDensity(systemData.asteroidDensity);\n            }\n        } else {\n            console.warn(\"AsteroidBelt or update methods not available\");\n        }\n        \n        // Update space anomalies for this system\n        if (this.spaceAnomalies && this.spaceAnomalies.updateForSystem) {\n            console.log(`Updating space anomalies for ${systemId}`);\n            this.spaceAnomalies.updateForSystem(systemData);\n        } else {\n            console.warn(\"SpaceAnomalies or updateForSystem method not available\");\n        }\n        \n        console.log(`Environment updated for ${systemId}`);\n    }\n    \n    // Show welcome notification when arriving at a new system\n    showSystemWelcomeNotification(systemId) {\n        const system = this.starSystemGenerator.getAllSystems()[systemId];\n        if (!system) return;\n        \n        // Create welcome notification\n        const notification = document.createElement('div');\n        notification.style.position = 'fixed';\n        notification.style.top = '25%';\n        notification.style.left = '50%';\n        notification.style.transform = 'translate(-50%, -50%)';\n        notification.style.backgroundColor = 'rgba(0, 0, 0, 0.8)';\n        notification.style.color = '#fff';\n        notification.style.padding = '20px 40px';\n        notification.style.borderRadius = '10px';\n        notification.style.border = `2px solid #${system.starColor.toString(16).padStart(6, '0')}`;\n        notification.style.boxShadow = `0 0 30px #${system.starColor.toString(16).padStart(6, '0')}`;\n        notification.style.fontFamily = 'Courier New, monospace';\n        notification.style.fontSize = '18px';\n        notification.style.zIndex = '9999';\n        notification.style.textAlign = 'center';\n        \n        // Special welcome for Earth/Solar System\n        if (systemId === 'Solar System') {\n            notification.innerHTML = `\n                <h2 style=\"color: #30cfd0; margin-top: 0;\">Welcome to the Solar System</h2>\n                <p>Your home system, with Earth as your starting location.</p>\n                <p style=\"font-size: 14px; margin-bottom: 0; color: #aaa;\">Safe travels, commander.</p>\n            `;\n        } else {\n            notification.innerHTML = `\n                <h2 style=\"color: #${system.starColor.toString(16).padStart(6, '0')}; margin-top: 0;\">Welcome to ${system.name}</h2>\n                <p>${system.description}</p>\n                <p style=\"font-size: 14px; margin-bottom: 0; color: #aaa;\">Classification: ${system.classification} - Star Class: ${system.starClass}</p>\n            `;\n        }\n        \n        // Add to DOM\n        document.body.appendChild(notification);\n        \n        // Remove after a few seconds\n        setTimeout(() => {\n            notification.style.opacity = '0';\n            notification.style.transition = 'opacity 1s';\n            \n            setTimeout(() => {\n                notification.remove();\n            }, 1000);\n        }, 5000);\n    }\n    \n    setupRegions() {\n        console.log(\"Setting up environment regions\");\n        \n        // Initialize or reset the planetRegions object\n        this.planetRegions = {};\n        \n        // Safely get planet regions if the method exists\n        if (this.planets && typeof this.planets.getPlanetRegions === 'function') {\n            try {\n                this.planetRegions = this.planets.getPlanetRegions();\n            } catch (error) {\n                console.warn(\"Error getting planet regions in setupRegions:\", error);\n            }\n        } else {\n            console.warn(\"planets.getPlanetRegions is not available in setupRegions, using empty object\");\n        }\n        \n        // Add sun region\n        this.planetRegions[\"Sun\"] = {\n            center: this.sun.getPosition(),\n            radius: this.sun.getRadius()\n        };\n        \n        // Add asteroid belt region\n        const asteroidBeltRegion = this.asteroidBelt.getRegionInfo();\n        this.planetRegions[\"Asteroid Belt\"] = {\n            center: asteroidBeltRegion.center,\n            minRadius: asteroidBeltRegion.innerRadius,\n            maxRadius: asteroidBeltRegion.outerRadius\n        };\n        \n        // Add stargate region\n        const stargateRegion = this.stargate.getRegionInfo();\n        this.planetRegions[\"Stargate\"] = {\n            center: stargateRegion.center,\n            radius: stargateRegion.radius\n        };\n        \n        // Add space anomalies region\n        const anomaliesRegion = this.spaceAnomalies.getRegionInfo();\n        this.planetRegions[\"Space Anomalies\"] = {\n            center: anomaliesRegion.center,\n            minRadius: anomaliesRegion.innerRadius,\n            maxRadius: anomaliesRegion.outerRadius\n        };\n    }\n    \n    // Get the player's current location based on position\n    getPlayerLocation(playerPosition) {\n        if (!playerPosition) {\n            return \"Unknown Location\";\n        }\n        \n        // Check if near stargate\n        const stargateRegion = this.planetRegions[\"Stargate\"];\n        if (stargateRegion) {\n            const distanceToStargate = playerPosition.distanceTo(stargateRegion.center);\n            if (distanceToStargate <= stargateRegion.radius) {\n                return \"Stargate\";\n            }\n        }\n        \n        // Check if near an anomaly - only if spaceAnomalies is loaded\n        if (this.componentsLoaded && this.spaceAnomalies) {\n            const closestAnomaly = this.spaceAnomalies.findClosestAnomaly(playerPosition, 2000);\n            if (closestAnomaly) {\n                const distance = playerPosition.distanceTo(closestAnomaly.position);\n                if (distance < 800) {\n                    let anomalyType = '';\n                    switch (closestAnomaly.type) {\n                        case 'vortex':\n                            anomalyType = 'Vortex';\n                            break;\n                        case 'crystalCluster':\n                            anomalyType = 'Crystal Cluster';\n                            break;\n                        case 'nebulaNexus':\n                            anomalyType = 'Nebula Nexus';\n                            break;\n                        case 'quantumFlux':\n                            anomalyType = 'Quantum Flux';\n                            break;\n                        case 'darkMatter':\n                            anomalyType = 'Dark Matter';\n                            break;\n                    }\n                    \n                    // Indicate if orb is still available\n                    const orbStatus = closestAnomaly.orbCollected ? 'Depleted' : 'Active';\n                    return `${anomalyType} Anomaly (${orbStatus})`;\n                }\n            }\n        }\n        \n        // Check planets\n        for (const [name, region] of Object.entries(this.planetRegions)) {\n            if (name === \"Asteroid Belt\" && this.componentsLoaded && this.asteroidBelt) {\n                // Special case for asteroid belt - only if loaded\n                const distance = playerPosition.distanceTo(region.center);\n                if (region.minRadius && region.maxRadius && \n                    distance >= region.minRadius && \n                    distance <= region.maxRadius) {\n                    // Count nearby asteroids (useful for mining)\n                    const nearbyAsteroids = this.asteroids.filter(asteroid => {\n                        return playerPosition.distanceTo(asteroid.mesh.position) < 500;\n                    });\n                    \n                    if (nearbyAsteroids.length > 0) {\n                        return `Asteroid Field (${nearbyAsteroids.length} nearby)`;\n                    }\n                    return \"Asteroid Belt\";\n                }\n            } else if (name === \"Space Anomalies\" && this.componentsLoaded) {\n                // Special case for space anomalies region - only if loaded\n                const distance = playerPosition.distanceTo(region.center);\n                if (region.minRadius && region.maxRadius && \n                    distance >= region.minRadius && \n                    distance <= region.maxRadius) {\n                    return \"Space Anomaly Field\";\n                }\n            } else if (name !== \"Sun\" && name !== \"Stargate\" && region.center && region.radius) {\n                const distance = playerPosition.distanceTo(region.center);\n                if (distance <= region.radius) {\n                    return `Near ${name}`;\n                }\n            }\n        }\n        \n        // Check sun\n        const sunRegion = this.planetRegions[\"Sun\"];\n        if (sunRegion) {\n            const distanceToSun = playerPosition.distanceTo(sunRegion.center);\n            if (distanceToSun <= sunRegion.radius) {\n            return \"Near Sun\";\n            }\n        }\n        \n        // Deep space\n        return \"Deep Space\";\n    }\n    \n    // Find the closest asteroid to a position\n    findClosestAsteroid(position, maxDistance) {\n        if (this.componentsLoaded && this.asteroidBelt && this.asteroidBelt.findClosestAsteroid) {\n            return this.asteroidBelt.findClosestAsteroid(position, maxDistance);\n        }\n        return null;\n    }\n    \n    // Find the closest space anomaly\n    findClosestAnomaly(position, maxDistance) {\n        if (this.componentsLoaded && this.spaceAnomalies && this.spaceAnomalies.findClosestAnomaly) {\n            return this.spaceAnomalies.findClosestAnomaly(position, maxDistance);\n        }\n        return null;\n    }\n    \n    // Check if position collides with any anomaly\n    checkAnomalyCollision(position) {\n        if (!this.componentsLoaded || !this.spaceAnomalies) return null;\n        \n        const closestAnomaly = this.spaceAnomalies.findClosestAnomaly(position, 8000);\n        if (closestAnomaly && this.spaceAnomalies.checkCollision(position, closestAnomaly)) {\n            return closestAnomaly;\n        }\n        \n        return null;\n    }\n    \n    // Collect energy orb from anomaly\n    collectAnomalyOrb(anomaly) {\n        if (this.componentsLoaded && this.spaceAnomalies && this.spaceAnomalies.collectOrb) {\n            return this.spaceAnomalies.collectOrb(anomaly);\n        }\n    }\n    \n    update(deltaTime = 0.016, camera) {\n        // Update skybox if it has an update method\n        if (this.skybox && typeof this.skybox.update === 'function') {\n            this.skybox.update(deltaTime);\n        }\n        \n        // Update sun if it has an update method\n        if (this.sun && typeof this.sun.update === 'function') {\n            this.sun.update(deltaTime);\n        }\n        \n        // Update planets if they have an update method\n        if (this.planets && typeof this.planets.update === 'function') {\n            this.planets.update(deltaTime);\n        }\n        \n        // Update system transition effects if active - this needs to run regardless of componentsLoaded\n        if (this.systemTransition && typeof this.systemTransition.update === 'function') {\n            this.systemTransition.update(deltaTime);\n        }\n        \n        // Only update non-essential components if they're loaded\n        if (this.componentsLoaded) {\n            // Update asteroids\n            if (this.asteroidBelt && typeof this.asteroidBelt.update === 'function') {\n                this.asteroidBelt.update(deltaTime);\n            }\n            \n            // Update stargate\n            if (this.stargate && typeof this.stargate.update === 'function') {\n                this.stargate.update(deltaTime);\n            }\n            \n            // Update space anomalies\n            if (this.spaceAnomalies && typeof this.spaceAnomalies.update === 'function') {\n                this.spaceAnomalies.update(deltaTime, camera);\n            }\n            \n            // Update vibe verse portals\n            if (this.vibeVersePortals && typeof this.vibeVersePortals.update === 'function') {\n                this.vibeVersePortals.update(deltaTime);\n            }\n        }\n    }\n    \n    dispose() {\n        // Dispose all environment components\n        if (this.skybox) {\n            this.skybox.dispose();\n        }\n        \n        if (this.sun) {\n            this.sun.dispose();\n        }\n        \n        if (this.planets) {\n            this.planets.dispose();\n        }\n        \n        if (this.asteroidBelt) {\n            this.asteroidBelt.dispose();\n        }\n        \n        if (this.stargate) {\n            this.stargate.dispose();\n        }\n        \n        if (this.spaceAnomalies) {\n            this.spaceAnomalies.clearAllAnomalies();\n        }\n        \n        if (this.vibeVersePortals) {\n            this.vibeVersePortals.dispose();\n        }\n    }\n} ","// inputHandler.js - Handles keyboard and mouse input\n\nexport class InputHandler {\n    constructor(spaceship, physics) {\n        this.spaceship = spaceship;\n        this.physics = physics;\n        this.isPointerLocked = false;\n        this.mouseSensitivity = 0.001; // Lower sensitivity for more precise control\n        \n        this.setupKeyboardControls();\n        this.setupPointerLock();\n    }\n    \n    setupKeyboardControls() {\n        // Keyboard controls\n        document.addEventListener('keydown', e => {\n            // Ignore inputs when docked or intro sequence is active\n            if (this.spaceship.isDocked || (window.game && window.game.introSequenceActive)) return;\n            \n            switch (e.key.toLowerCase()) {\n                case 'w': \n                    this.spaceship.thrust.forward = true;\n                    break;\n                case 's': \n                    this.spaceship.thrust.backward = true; \n                    break;\n                case 'a': \n                    this.spaceship.thrust.right = true; \n                    break;\n                case 'd': \n                    this.spaceship.thrust.left = true; \n                    break;\n                case 'shift': \n                    this.spaceship.thrust.boost = true; \n                    break;\n            }\n        });\n        \n        document.addEventListener('keyup', e => {\n            // Still process key up events when intro is active to prevent stuck keys\n            if (window.game && window.game.introSequenceActive) {\n                // Force reset all thrusters during intro sequence\n                this.spaceship.thrust.forward = false;\n                this.spaceship.thrust.backward = false;\n                this.spaceship.thrust.right = false;\n                this.spaceship.thrust.left = false;\n                this.spaceship.thrust.boost = false;\n                return;\n            }\n            \n            switch (e.key.toLowerCase()) {\n                case 'w': this.spaceship.thrust.forward = false; break;\n                case 's': this.spaceship.thrust.backward = false; break;\n                case 'a': this.spaceship.thrust.right = false; break; // A fires right thruster (moves left)\n                case 'd': this.spaceship.thrust.left = false; break;  // D fires left thruster (moves right)\n                case 'shift': this.spaceship.thrust.boost = false; break;\n            }\n        });\n    }\n    \n    setupPointerLock() {\n        // Get the canvas element (it's the first canvas in the document)\n        const canvas = document.querySelector('canvas');\n        \n        // Request pointer lock when clicking on the canvas\n        canvas.addEventListener('pointerdown', (e) => {\n            e.preventDefault(); // Prevent default to avoid unwanted behavior\n            if (!this.isPointerLocked && !this.spaceship.isDocked) {\n                canvas.requestPointerLock();\n            }\n        });\n        \n        // Set up pointer lock change event\n        document.addEventListener('pointerlockchange', () => {\n            if (document.pointerLockElement === canvas) {\n                // Pointer is locked\n                this.isPointerLocked = true;\n                document.addEventListener('pointermove', this.handlePointerMove.bind(this));\n            } else {\n                // Pointer is unlocked\n                this.isPointerLocked = false;\n                document.removeEventListener('pointermove', this.handlePointerMove.bind(this));\n            }\n        });\n        \n        // Add instructions for pointer lock\n        const instructionsElement = document.createElement('div');\n        instructionsElement.id = 'pointer-lock-instructions';\n        instructionsElement.innerHTML = `\n            Click on the game to enable mouse rotation\n        `;\n        instructionsElement.style.position = 'absolute';\n        instructionsElement.style.top = '60px';\n        instructionsElement.style.left = '50%';\n        instructionsElement.style.transform = 'translateX(-50%)';\n        instructionsElement.style.backgroundColor = 'rgba(0, 0, 0, 0.5)';\n        instructionsElement.style.padding = '10px 20px';\n        instructionsElement.style.borderRadius = '20px';\n        instructionsElement.style.border = '1px solid #30cfd0';\n        instructionsElement.style.boxShadow = '0 0 10px #30cfd0';\n        instructionsElement.style.color = '#fff';\n        instructionsElement.style.fontFamily = 'Courier New, monospace';\n        instructionsElement.style.zIndex = '999';\n        instructionsElement.style.textAlign = 'center';\n        document.body.appendChild(instructionsElement);\n        \n        // Hide instructions when pointer is locked\n        document.addEventListener('pointerlockchange', () => {\n            instructionsElement.style.display = document.pointerLockElement ? 'none' : 'block';\n        });\n    }\n    \n    handlePointerMove(e) {\n        // Skip mouse movement handling during intro sequence\n        if (window.game && window.game.introSequenceActive) return;\n        \n        if (!this.isPointerLocked) return;\n        \n        // Use movementX and movementY for rotation\n        // These values represent the mouse movement since the last event\n        const movementX = e.movementX || 0;\n        const movementY = e.movementY || 0;\n        \n        // Update the physics rotation based on these movements\n        this.physics.updateRotation(\n            movementX * this.mouseSensitivity, \n            movementY * this.mouseSensitivity\n        );\n    }\n    \n    isLocked() {\n        return this.isPointerLocked;\n    }\n    \n    exitPointerLock() {\n        if (document.exitPointerLock) {\n            document.exitPointerLock();\n        }\n    }\n}","// miningSystem.js - Handles asteroid mining functionality\n\nimport * as THREE from 'three';\n\nexport class MiningSystem {\n    constructor(spaceship, scene) {\n        this.spaceship = spaceship;\n        this.scene = scene;\n        this.isMining = false;\n        this.targetAsteroid = null;\n        this.miningProgress = 0;\n        this.lastDestroyedAsteroid = null;\n        \n        // Mining speeds for single-action mining that takes 7.5, 22.5, and 45 seconds respectively\n        // Values are in progress per second (1 / seconds_required)\n        this.miningSpeedByType = {\n            iron: 0.133,     // 1/7.5 seconds to complete\n            gold: 0.044,     // 1/22.5 seconds to complete\n            platinum: 0.022  // 1/45 seconds to complete\n        };\n        this.miningSpeed = 0.133; // Default speed, will be set based on asteroid type\n        this.miningDistance = 6000; // Maximum mining distance (reduced from 24000 to 12000)\n        this.miningCooldown = 0;\n        \n        // Resources collected\n        this.resources = {\n            iron: 0,\n            gold: 0,\n            platinum: 0\n        };\n        \n        this.setupMiningLaser();\n    }\n    \n    // Helper method to get the mining efficiency from the spaceship\n    getMiningEfficiency() {\n        return this.spaceship && this.spaceship.miningEfficiency \n            ? this.spaceship.miningEfficiency \n            : 1.0; // Default value if spaceship property not available\n    }\n    \n    setupMiningLaser() {\n        // Create particle effect for mining impact\n        const particleCount = 100;\n        const particles = new THREE.BufferGeometry();\n        const particleMaterial = new THREE.PointsMaterial({\n            color: 0xff5500,\n            size: 1.5, // Increased for visibility\n            blending: THREE.AdditiveBlending,\n            transparent: true,\n            opacity: 0.8\n        });\n        \n        const positions = new Float32Array(particleCount * 3);\n        for (let i = 0; i < particleCount; i++) {\n            positions[i * 3] = 0;\n            positions[i * 3 + 1] = 0;\n            positions[i * 3 + 2] = 0;\n        }\n        \n        particles.setAttribute('position', new THREE.BufferAttribute(positions, 3));\n        this.miningParticles = new THREE.Points(particles, particleMaterial);\n        this.miningParticles.visible = false;\n        this.scene.add(this.miningParticles);\n    }\n    \n    setTargetAsteroid(asteroid) {\n        try {\n            console.log(\"MiningSystem: setTargetAsteroid called\", asteroid);\n            \n            // Validate asteroid before setting it as the target\n            if (!asteroid || !asteroid.mesh || !asteroid.mesh.position) {\n                console.error(\"MiningSystem: Invalid asteroid provided to setTargetAsteroid\");\n                return false;\n            }\n            \n            this.targetAsteroid = asteroid;\n            \n            // Set mining speed based on asteroid resource type and apply efficiency modifier\n            if (asteroid && asteroid.resourceType) {\n                const resourceType = asteroid.resourceType.toLowerCase();\n                const baseSpeed = this.miningSpeedByType[resourceType] || this.miningSpeedByType.iron;\n                const efficiency = this.getMiningEfficiency();\n                \n                this.miningSpeed = baseSpeed * efficiency;\n                console.log(`Mining ${resourceType} asteroid with speed: ${this.miningSpeed} (efficiency: ${efficiency}x)`);\n                \n                // Update UI to show targeting info\n                const targetInfo = document.getElementById('target-info');\n                if (targetInfo) {\n                    targetInfo.style.display = 'block';\n                    targetInfo.style.color = '#30cfd0';\n                    \n                    // Update target name/type\n                    const targetName = document.getElementById('target-name');\n                    if (targetName) {\n                        targetName.textContent = `${resourceType.toUpperCase()} Asteroid`;\n                    }\n                    \n                    // Update distance to target\n                    const distance = Math.round(this.spaceship.mesh.position.distanceTo(asteroid.mesh.position));\n                    const targetDistance = document.getElementById('target-distance');\n                    if (targetDistance) {\n                        targetDistance.textContent = `Distance: ${distance} units`;\n                    }\n                }\n            } else {\n                // Default to iron speed if no resource type is specified\n                this.miningSpeed = this.miningSpeedByType.iron * this.getMiningEfficiency();\n            }\n            \n            return true;\n        } catch (error) {\n            console.error(\"MiningSystem: Error in setTargetAsteroid:\", error);\n            return false;\n        }\n    }\n    \n    startMining() {\n        try {\n            console.log(\"MiningSystem: startMining called\");\n            \n            // Don't allow mining if no asteroid is targeted\n            if (!this.targetAsteroid) {\n                console.error(\"MiningSystem: Cannot start mining - no target asteroid set\");\n                return;\n            }\n\n            // Validate asteroid has required properties\n            if (!this.targetAsteroid.mesh || !this.targetAsteroid.mesh.position) {\n                console.error(\"MiningSystem: Target asteroid is missing mesh or position\", this.targetAsteroid);\n                return;\n            }\n\n            // Validate spaceship has required properties\n            if (!this.spaceship || !this.spaceship.mesh || !this.spaceship.mesh.position) {\n                console.error(\"MiningSystem: Spaceship is missing mesh or position\");\n                return;\n            }\n            \n            // Check if asteroid is in mining range\n            const distance = this.spaceship.mesh.position.distanceTo(this.targetAsteroid.mesh.position);\n            console.log(`MiningSystem: Distance to asteroid: ${distance}, max range: ${this.miningDistance}`);\n            \n            if (distance > this.miningDistance) {\n                // Show a message that target is out of range\n                const targetInfo = document.getElementById('target-info');\n                if (targetInfo) {\n                    targetInfo.textContent = 'TARGET OUT OF RANGE';\n                    targetInfo.style.color = '#ff4400';\n                    targetInfo.style.display = 'block';\n                    \n                    // Hide after 2 seconds\n                    setTimeout(() => {\n                        targetInfo.style.display = 'none';\n                    }, 2000);\n                }\n                console.log(\"MiningSystem: Target out of range\");\n                return;\n            }\n            \n            // Set mining state to active\n            this.isMining = true;\n            this.miningProgress = 0;\n            console.log(\"MiningSystem: Mining state activated\");\n            \n            // Get or create laser beam element\n            let laserBeam = document.getElementById('laser-beam');\n            \n            // If laser beam element doesn't exist, create it\n            if (!laserBeam) {\n                console.log(\"MiningSystem: Creating laser beam element\");\n                laserBeam = document.createElement('div');\n                laserBeam.id = 'laser-beam';\n                laserBeam.style.position = 'absolute';\n                laserBeam.style.height = '2px';\n                laserBeam.style.backgroundColor = '#ff3030';\n                laserBeam.style.transformOrigin = '0 0';\n                laserBeam.style.zIndex = '100';\n                laserBeam.style.pointerEvents = 'none';\n                document.body.appendChild(laserBeam);\n            }\n            \n            // Show mining laser beam\n            if (laserBeam) {\n                laserBeam.style.display = 'block';\n                \n                // Adjust laser color based on resource type and mining level\n                if (this.targetAsteroid.resourceType) {\n                    const resourceType = this.targetAsteroid.resourceType.toLowerCase();\n                    let laserColor = '#ff3030'; // Default red for iron\n                    let glowColor = '#ff0000';\n                    \n                    if (resourceType === 'gold') {\n                        laserColor = '#ffcc00'; // Gold color\n                        glowColor = '#ffaa00';\n                    } else if (resourceType === 'platinum') {\n                        laserColor = '#66ffff'; // Cyan color for platinum\n                        glowColor = '#00ffff';\n                    }\n                    \n                    // Adjust intensity based on mining efficiency - brighter for higher efficiency\n                    const efficiency = this.getMiningEfficiency();\n                    if (efficiency > 1.0) {\n                        // Make the laser more intense as mining level increases\n                        const laserIntensity = Math.min(1.0 + (efficiency - 1.0) * 0.5, 3.0);\n                        laserBeam.style.boxShadow = `0 0 ${10 * laserIntensity}px ${glowColor}, 0 0 ${20 * laserIntensity}px ${glowColor}`;\n                    } else {\n                        laserBeam.style.boxShadow = `0 0 10px ${glowColor}, 0 0 20px ${glowColor}`;\n                    }\n                    \n                    laserBeam.style.backgroundColor = laserColor;\n                } else {\n                    // Default red laser\n                    laserBeam.style.backgroundColor = '#ff3030'; \n                    laserBeam.style.boxShadow = '0 0 10px #ff0000, 0 0 20px #ff0000';\n                }\n            }\n            \n            // Show mining particles\n            if (this.miningParticles) {\n                this.miningParticles.visible = true;\n                \n                // Adjust particle color based on resource type\n                if (this.targetAsteroid.resourceType && this.miningParticles.material) {\n                    const resourceType = this.targetAsteroid.resourceType.toLowerCase();\n                    \n                    if (resourceType === 'iron') {\n                        this.miningParticles.material.color.set(0xff5500); // Orange\n                    } else if (resourceType === 'gold') {\n                        this.miningParticles.material.color.set(0xffcc00); // Yellow\n                    } else if (resourceType === 'platinum') {\n                        this.miningParticles.material.color.set(0x66ffff); // Light blue\n                    }\n                    \n                    // Adjust particle size based on mining efficiency\n                    const efficiency = this.getMiningEfficiency();\n                    if (efficiency > 1.0) {\n                        this.miningParticles.material.size = 1.5 * Math.sqrt(efficiency);\n                    }\n                }\n            }\n            \n            // Create or update mining progress bar\n            let miningProgressContainer = document.getElementById('mining-progress-container');\n            if (!miningProgressContainer) {\n                console.log(\"MiningSystem: Creating mining progress container\");\n                miningProgressContainer = document.createElement('div');\n                miningProgressContainer.id = 'mining-progress-container';\n                miningProgressContainer.style.position = 'absolute';\n                miningProgressContainer.style.bottom = '20px';\n                miningProgressContainer.style.left = '50%';\n                miningProgressContainer.style.transform = 'translateX(-50%)';\n                miningProgressContainer.style.width = '200px';\n                miningProgressContainer.style.height = '10px';\n                miningProgressContainer.style.backgroundColor = 'rgba(0, 0, 0, 0.5)';\n                miningProgressContainer.style.border = '1px solid #30cfd0';\n                miningProgressContainer.style.zIndex = '1000';\n                document.body.appendChild(miningProgressContainer);\n                \n                const progressBar = document.createElement('div');\n                progressBar.id = 'mining-progress-bar';\n                progressBar.style.width = '0%';\n                progressBar.style.height = '100%';\n                progressBar.style.backgroundColor = '#30cfd0';\n                miningProgressContainer.appendChild(progressBar);\n            } else {\n                miningProgressContainer.style.display = 'block';\n                const progressBar = document.getElementById('mining-progress-bar');\n                if (progressBar) {\n                    progressBar.style.width = '0%';\n                }\n            }\n            \n            // Activate the spaceship's laser emitter\n            if (this.spaceship && typeof this.spaceship.activateMiningLaser === 'function') {\n                this.spaceship.activateMiningLaser();\n            }\n            \n            // Update mining status display with timing info\n            this.updateMiningStatusWithTime();\n            \n            // Trigger laser sound\n            if (window.game && window.game.audio) {\n                window.game.audio.playSound('mining-laser');\n            } else if (window.game && window.game.audio) {\n                window.game.audio.playSound('laser');\n            }\n            \n            console.log(\"MiningSystem: Mining successfully started\");\n        } catch (error) {\n            console.error(\"MiningSystem: Error in startMining:\", error);\n            this.isMining = false;\n        }\n    }\n    \n    // Update the mining status with time estimate\n    updateMiningStatusWithTime() {\n        const miningStatusElement = document.getElementById('mining-status');\n        if (!miningStatusElement || !this.targetAsteroid || !this.targetAsteroid.resourceType) return;\n        \n        // Calculate approximate time to mine based on resource type\n        const resourceType = this.targetAsteroid.resourceType.toLowerCase();\n        const secondsRequired = Math.round(1 / this.miningSpeed);\n        const efficiency = this.getMiningEfficiency();\n        \n        let efficiencyText = \"\";\n        if (efficiency > 1.0) {\n            efficiencyText = ` [${Math.round(efficiency * 100)}% efficiency]`;\n        }\n        \n        miningStatusElement.textContent = `MINING ${resourceType.toUpperCase()} (${secondsRequired}s)${efficiencyText}`;\n        miningStatusElement.style.color = '#ff4400';\n    }\n    \n    stopMining() {\n        if (!this.isMining) return;\n        \n        this.isMining = false;\n        this.miningProgress = 0;\n        \n        // Hide laser beam\n        const laserBeam = document.getElementById('laser-beam');\n        if (laserBeam) {\n            laserBeam.style.display = 'none';\n        }\n        \n        // Hide mining particles\n        if (this.miningParticles) {\n            this.miningParticles.visible = false;\n        }\n        \n        // Hide mining progress bar\n        const miningProgressContainer = document.getElementById('mining-progress-container');\n        if (miningProgressContainer) {\n            miningProgressContainer.style.display = 'none';\n        }\n        \n        // Deactivate the spaceship's laser emitter\n        this.spaceship.deactivateMiningLaser();\n        \n        // Reset mining status display\n        const miningStatusElement = document.getElementById('mining-status');\n        if (miningStatusElement) {\n            miningStatusElement.textContent = 'INACTIVE';\n            miningStatusElement.style.color = '#30cfd0';\n        }\n        \n        // Stop laser sound\n        if (window.game && window.game.audio) {\n            window.game.audio.stopSound('mining-laser');\n        }\n    }\n    \n    update(deltaTime = 1/60) {\n        // Update mining cooldown\n        if (this.miningCooldown > 0) {\n            this.miningCooldown--;\n        }\n        \n        // Update mining if active\n        if (this.isMining) {\n            this.updateMining(deltaTime);\n        }\n        \n        // Update mining particles if visible\n        if (this.miningParticles && this.miningParticles.visible) {\n            this.updateMiningParticles();\n        }\n        \n        // Update target info if we have a target but aren't mining\n        if (this.targetAsteroid && !this.isMining) {\n            this.updateTargetInfo();\n        }\n    }\n    \n    updateMining(deltaTime = 1/60) {\n        // Make sure we have a target asteroid\n        if (!this.targetAsteroid || !this.isMining) {\n            this.stopMining();\n            return;\n        }\n        \n        // Check if asteroid is in range - if not, stop mining and require new click\n        const distance = this.spaceship.mesh.position.distanceTo(this.targetAsteroid.mesh.position);\n        if (distance > this.miningDistance) {\n            this.stopMining();\n            return;\n        }\n        \n        // Update mining progress using deltaTime for frame-rate independence\n        this.miningProgress += this.miningSpeed * deltaTime;\n        \n        // Update laser beam position\n        this.updateLaserBeam();\n        \n        // Update mining particles position\n        if (this.miningParticles && this.miningParticles.visible) {\n            this.miningParticles.position.copy(this.targetAsteroid.mesh.position);\n        }\n        \n        // Complete mining when progress reaches 1.0\n        if (this.miningProgress >= 1.0) {\n            // Add resources from asteroid in one batch\n            this.addAsteroidResources();\n            \n            // Create asteroid break effect\n            this.createAsteroidBreakEffect(this.targetAsteroid.mesh.position);\n            \n            // Store reference to the destroyed asteroid\n            this.lastDestroyedAsteroid = this.targetAsteroid;\n            \n            // Remove asteroid from scene\n            this.scene.remove(this.targetAsteroid.mesh);\n            \n            // Stop mining\n            this.stopMining();\n            this.targetAsteroid = null;\n        }\n        \n        // Update the progress bar\n        const progressBar = document.getElementById('mining-progress-bar');\n        if (progressBar) {\n            progressBar.style.width = `${this.miningProgress * 100}%`;\n        }\n    }\n    \n    updateLaserBeam() {\n        const laserBeam = document.getElementById('laser-beam');\n        if (!laserBeam || !this.targetAsteroid || !this.isMining) return;\n        \n        // Create a vector pointing from the ship to the asteroid\n        const shipPosition = this.spaceship.mesh.position.clone();\n        const asteroidPosition = this.targetAsteroid.mesh.position.clone();\n        \n        // Add a small offset to the ship position to start from the FRONT of the mining laser\n        // The ship's coordinate system has -Z as the forward direction, so use negative Z\n        const shipOffset = new THREE.Vector3(0, 0, -60); // 4x the original offset (-15)\n        shipOffset.applyQuaternion(this.spaceship.mesh.quaternion);\n        shipPosition.add(shipOffset);\n        \n        // Convert 3D positions to screen coordinates\n        const tempVector = new THREE.Vector3();\n        \n        // Get the camera\n        const camera = this.scene.camera;\n        if (!camera) return;\n        \n        // Convert ship position to screen space\n        tempVector.copy(shipPosition);\n        tempVector.project(camera);\n        const shipX = (tempVector.x * 0.5 + 0.5) * window.innerWidth;\n        const shipY = (-(tempVector.y * 0.5) + 0.5) * window.innerHeight;\n        \n        // Convert asteroid position to screen space\n        tempVector.copy(asteroidPosition);\n        tempVector.project(camera);\n        const asteroidX = (tempVector.x * 0.5 + 0.5) * window.innerWidth;\n        const asteroidY = (-(tempVector.y * 0.5) + 0.5) * window.innerHeight;\n        \n        // Calculate distance and angle\n        const dx = asteroidX - shipX;\n        const dy = asteroidY - shipY;\n        const distance = Math.sqrt(dx * dx + dy * dy);\n        const angle = Math.atan2(dy, dx);\n        \n        // Update laser beam style\n        laserBeam.style.width = `${distance}px`;\n        laserBeam.style.left = `${shipX}px`;\n        laserBeam.style.top = `${shipY}px`;\n        laserBeam.style.transform = `rotate(${angle}rad)`;\n        \n        // Animate the laser beam for a more dynamic effect\n        const intensity = 0.8 + Math.sin(Date.now() * 0.01) * 0.2;\n        laserBeam.style.opacity = intensity.toString();\n        \n        // Make laser thickness vary with mining efficiency\n        const efficiency = this.getMiningEfficiency();\n        const thickness = Math.max(2, Math.ceil(2 * Math.sqrt(efficiency)));\n        laserBeam.style.height = `${thickness}px`;\n        \n        // Create multiple beams for a more powerful effect\n        if (!laserBeam.hasChildNodes()) {\n            // Create 2 additional beams for a thicker laser effect\n            for (let i = 0; i < 2; i++) {\n                const additionalBeam = document.createElement('div');\n                additionalBeam.style.position = 'absolute';\n                additionalBeam.style.left = '0';\n                additionalBeam.style.top = `${i === 0 ? -1 : 1}px`;\n                additionalBeam.style.width = '100%';\n                additionalBeam.style.height = '1px';\n                additionalBeam.style.backgroundColor = '#ff6060';\n                additionalBeam.style.opacity = '0.7';\n                laserBeam.appendChild(additionalBeam);\n            }\n        }\n    }\n    \n    updateMiningParticles() {\n        const positions = this.miningParticles.geometry.attributes.position.array;\n        \n        // Get mining efficiency to adjust particle behavior\n        const efficiency = this.getMiningEfficiency();\n        // Particles move faster with higher efficiency\n        const particleSpeed = 0.3 * efficiency;\n        \n        for (let i = 0; i < positions.length; i += 3) {\n            // Move particles outward slightly\n            const dir = new THREE.Vector3(positions[i], positions[i+1], positions[i+2]);\n            dir.normalize().multiplyScalar(particleSpeed);\n            \n            positions[i] += dir.x;\n            positions[i+1] += dir.y;\n            positions[i+2] += dir.z;\n            \n            // Reset particles that move too far\n            const dist = Math.sqrt(\n                positions[i] * positions[i] + \n                positions[i+1] * positions[i+1] + \n                positions[i+2] * positions[i+2]\n            );\n            \n            if (dist > 36) { // 4x original reset distance (was 9)\n                positions[i] = (Math.random() - 0.5) * 24; // 4x original spread (was 6)\n                positions[i+1] = (Math.random() - 0.5) * 24;\n                positions[i+2] = (Math.random() - 0.5) * 24;\n            }\n        }\n        this.miningParticles.geometry.attributes.position.needsUpdate = true;\n    }\n    \n    /**\n     * Add all resources from the mined asteroid to the player's inventory at once\n     */\n    addAsteroidResources() {\n        if (!this.targetAsteroid) return;\n        \n        // Get the resource type from the asteroid\n        const resourceType = this.targetAsteroid.resourceType || 'iron'; // Default to iron if no type specified\n        \n        // Get mining efficiency for resource extraction bonus\n        const efficiency = this.getMiningEfficiency();\n        const bonusChance = (efficiency - 1.0) * 0.5; // Chance for bonus resources based on efficiency\n        \n        // Calculate base amount based on asteroid type\n        let amount = 0;\n        switch (resourceType.toLowerCase()) {\n            case 'iron':\n                amount = Math.floor(Math.random() * 5) + 10; // 10-14 iron\n                break;\n            case 'gold':\n                amount = Math.floor(Math.random() * 3) + 5; // 5-7 gold\n                break;\n            case 'platinum':\n                amount = Math.floor(Math.random() * 2) + 2; // 2-3 platinum\n                break;\n            default:\n                amount = 10; // Default to 10 iron\n        }\n        \n        // Apply bonus resources based on mining efficiency\n        if (efficiency > 1.0 && Math.random() < bonusChance) {\n            amount = Math.ceil(amount * 1.2); // 20% bonus\n        }\n        \n        // Update resource counts\n        switch (resourceType.toLowerCase()) {\n            case 'iron':\n                this.resources.iron += amount;\n                break;\n            case 'gold':\n                this.resources.gold += amount;\n                break;\n            case 'platinum':\n                this.resources.platinum += amount;\n                break;\n            default:\n                this.resources.iron += amount;\n        }\n        \n        console.log(`MiningSystem: Added ${amount} ${resourceType} from asteroid`);\n        \n        // Show resource gain notification\n        this.showResourceGainNotification(amount, resourceType);\n        \n        return true;\n    }\n    \n    /**\n     * Show a notification for resources gained\n     */\n    showResourceGainNotification(amount, resourceType) {\n        // Get color based on resource type\n        let color = '#a0a0a0'; // Default gray for iron\n        if (resourceType === 'gold') {\n            color = '#ffcc00';\n        } else if (resourceType === 'platinum') {\n            color = '#66ffff';\n        }\n        \n        // Create notification element\n        const notification = document.createElement('div');\n        notification.textContent = `+${amount} ${resourceType.toUpperCase()}`;\n        notification.style.position = 'absolute';\n        notification.style.top = '40%';\n        notification.style.left = '50%';\n        notification.style.transform = 'translate(-50%, -50%)';\n        notification.style.color = color;\n        notification.style.fontSize = '24px';\n        notification.style.fontWeight = 'bold';\n        notification.style.textShadow = '0 0 8px black';\n        notification.style.zIndex = '1000';\n        notification.style.opacity = '1';\n        notification.style.transition = 'all 1.5s ease-out';\n        \n        document.body.appendChild(notification);\n        \n        // Animate the notification\n        setTimeout(() => {\n            notification.style.opacity = '0';\n            notification.style.top = '30%';\n            \n            // Remove after animation\n            setTimeout(() => {\n                if (document.body.contains(notification)) {\n                    document.body.removeChild(notification);\n                }\n            }, 1500);\n        }, 100);\n    }\n    \n    createAsteroidBreakEffect(position) {\n        // Create particle effect for asteroid breaking\n        const particleCount = 50;\n        const particles = new THREE.BufferGeometry();\n        const particleMaterial = new THREE.PointsMaterial({\n            color: 0xaaaaaa,\n            size: 12, // 4x original size (was 3)\n            blending: THREE.AdditiveBlending,\n            transparent: true,\n            opacity: 0.8\n        });\n        \n        const positions = new Float32Array(particleCount * 3);\n        const velocities = [];\n        \n        for (let i = 0; i < particleCount; i++) {\n            // Start at asteroid position\n            positions[i * 3] = position.x;\n            positions[i * 3 + 1] = position.y;\n            positions[i * 3 + 2] = position.z;\n            \n            // Random velocity in all directions - 4x faster to match scale\n            velocities.push({\n                x: (Math.random() - 0.5) * 8,  // 4x original speed (was 2)\n                y: (Math.random() - 0.5) * 8,  // 4x original speed\n                z: (Math.random() - 0.5) * 8   // 4x original speed\n            });\n        }\n        \n        particles.setAttribute('position', new THREE.BufferAttribute(positions, 3));\n        const particleSystem = new THREE.Points(particles, particleMaterial);\n        this.scene.add(particleSystem);\n        \n        // Animate particles\n        let frameCount = 0;\n        const animateParticles = () => {\n            frameCount++;\n            \n            // Update particle positions\n            const positions = particleSystem.geometry.attributes.position.array;\n            \n            for (let i = 0; i < particleCount; i++) {\n                positions[i * 3] += velocities[i].x;\n                positions[i * 3 + 1] += velocities[i].y;\n                positions[i * 3 + 2] += velocities[i].z;\n            }\n            \n            particleSystem.geometry.attributes.position.needsUpdate = true;\n            \n            // Fade out over time\n            particleSystem.material.opacity = Math.max(0, 0.8 - frameCount * 0.02);\n            \n            // Remove after 40 frames\n            if (frameCount < 40) {\n                requestAnimationFrame(animateParticles);\n            } else {\n                this.scene.remove(particleSystem);\n            }\n        };\n        \n        animateParticles();\n    }\n    \n    // New method to retrieve the last destroyed asteroid and reset the property\n    getLastDestroyedAsteroid() {\n        const destroyedAsteroid = this.lastDestroyedAsteroid;\n        this.lastDestroyedAsteroid = null; // Reset after getting it\n        return destroyedAsteroid;\n    }\n    \n    // Add a new method to update target info in the UI\n    updateTargetInfo() {\n        if (!this.targetAsteroid || !this.targetAsteroid.mesh) return;\n        \n        try {\n            // Update distance calculation\n            const distance = this.spaceship.mesh.position.distanceTo(this.targetAsteroid.mesh.position);\n            \n            // Update UI elements if they exist\n            const targetDistance = document.getElementById('target-distance');\n            if (targetDistance) {\n                targetDistance.textContent = `Distance: ${Math.round(distance)} units`;\n            }\n            \n            // Check if target is still in range and update UI accordingly\n            const inRange = distance <= this.miningDistance;\n            const targetInfo = document.getElementById('target-info');\n            if (targetInfo) {\n                if (inRange) {\n                    targetInfo.style.color = '#30cfd0'; // Blue for in range\n                } else {\n                    targetInfo.style.color = '#ff4400'; // Red for out of range\n                }\n            }\n        } catch (error) {\n            console.error(\"MiningSystem: Error updating target info:\", error);\n        }\n    }\n} ","// targetingSystem.js - Handles asteroid targeting and lock-on\n\nimport * as THREE from 'three';\n\nexport class TargetingSystem {\n    constructor(spaceship, scene, environment) {\n        this.spaceship = spaceship;\n        this.scene = scene;\n        this.environment = environment;\n        \n        this.lockOnEnabled = false;\n        this.nearbyAsteroids = [];\n        this.currentLockOnIndex = -1;\n        this.targetAsteroid = null;\n        this.scanRadius = this.getScanRadius(); // Get initial scan radius from spaceship\n        \n        this.createTargetReticle();\n        // Create off-screen indicators\n        this.createOffScreenIndicators();\n    }\n    \n    createTargetReticle() {\n        // Create the target indicator geometry (outer ring)\n        const ringGeometry = new THREE.RingGeometry(150, 180, 32);\n        const ringMaterial = new THREE.MeshBasicMaterial({\n            color: 0xff3030,\n            side: THREE.DoubleSide,\n            transparent: true,\n            opacity: 0.7\n        });\n        \n        this.targetReticle = new THREE.Mesh(ringGeometry, ringMaterial);\n        this.targetReticle.visible = false;\n        this.scene.add(this.targetReticle);\n        \n        // Add inner ring for additional visual interest\n        const innerRingGeometry = new THREE.RingGeometry(75, 90, 32);\n        const innerRingMaterial = new THREE.MeshBasicMaterial({\n            color: 0xff6060,\n            side: THREE.DoubleSide,\n            transparent: true,\n            opacity: 0.5\n        });\n        \n        const innerRing = new THREE.Mesh(innerRingGeometry, innerRingMaterial);\n        this.targetReticle.add(innerRing);\n    }\n    \n    // Helper method to get the current scan radius from the spaceship\n    getScanRadius() {\n        // Increase default scan radius by 5x (from 1000 to 5000)\n        return this.spaceship && this.spaceship.scanRange \n            ? this.spaceship.scanRange * 5 \n            : 5000; // Default value increased by 5x\n    }\n    \n    toggleLockOn() {\n        this.lockOnEnabled = !this.lockOnEnabled;\n        \n        if (this.lockOnEnabled) {\n            // Update scan radius before scanning\n            this.scanRadius = this.getScanRadius();\n            \n            // Scan for nearby asteroids\n            this.scanForAsteroids();\n            \n            // Show targeting UI\n            const targetInfoElement = document.getElementById('target-info');\n            if (targetInfoElement) {\n                targetInfoElement.textContent = 'Lock-On Targeting: ACTIVE';\n                targetInfoElement.style.display = 'block';\n                targetInfoElement.style.color = '#30cfd0';\n            }\n            \n            // Automatically select the closest target\n            if (this.nearbyAsteroids.length > 0) {\n                this.findNearestTarget();\n            }\n        } else {\n            // Clear target and hide UI\n            this.nearbyAsteroids = [];\n            this.currentLockOnIndex = -1;\n            this.targetAsteroid = null;\n            this.targetReticle.visible = false;\n            \n            // Hide off-screen indicators\n            this.hideOffScreenIndicators();\n            \n            // Hide targeting UI\n            const targetInfoElement = document.getElementById('target-info');\n            if (targetInfoElement) {\n                targetInfoElement.style.display = 'none';\n            }\n        }\n        \n        return this.lockOnEnabled;\n    }\n    \n    scanForAsteroids() {\n        this.nearbyAsteroids = [];\n        const shipPosition = this.spaceship.mesh.position;\n        \n        // Find all asteroids within scan radius\n        const asteroids = this.environment.asteroids;\n        asteroids.forEach(asteroid => {\n            // Skip asteroids that aren't minable or visible\n            if (!asteroid.minable || !asteroid.mesh.visible) return;\n            \n            const distance = shipPosition.distanceTo(asteroid.mesh.position);\n            if (distance <= this.scanRadius) {\n                this.nearbyAsteroids.push({\n                    asteroid: asteroid,\n                    distance: distance\n                });\n            }\n        });\n        \n        // Sort by distance\n        this.nearbyAsteroids.sort((a, b) => a.distance - b.distance);\n        \n        // Extract just the asteroid objects after sorting\n        this.nearbyAsteroids = this.nearbyAsteroids.map(item => item.asteroid);\n        \n        // Set current target if we found asteroids\n        if (this.nearbyAsteroids.length > 0) {\n            this.currentLockOnIndex = 0;\n            this.updateLockedOnTarget();\n            \n            // Update UI to show number of detected asteroids\n            const targetNameElement = document.getElementById('target-name');\n            if (targetNameElement) {\n                targetNameElement.textContent = \n                    `Target 1/${this.nearbyAsteroids.length} (${Math.round(this.nearbyAsteroids[0].mesh.position.distanceTo(shipPosition))} units)`;\n            }\n            \n            return true;\n        } else {\n            // No targets found\n            const targetNameElement = document.getElementById('target-name');\n            if (targetNameElement) {\n                targetNameElement.textContent = 'No targets in range';\n            }\n            this.targetReticle.visible = false;\n            this.targetAsteroid = null;\n            \n            return false;\n        }\n    }\n    \n    cycleLockOnTarget() {\n        if (!this.lockOnEnabled || this.nearbyAsteroids.length === 0) return null;\n        \n        // Move to next target\n        this.currentLockOnIndex = (this.currentLockOnIndex + 1) % this.nearbyAsteroids.length;\n        return this.updateLockedOnTarget();\n    }\n    \n    updateLockedOnTarget() {\n        this.targetAsteroid = this.nearbyAsteroids[this.currentLockOnIndex];\n        \n        if (this.targetAsteroid) {\n            // Update target info\n            const targetNameElement = document.getElementById('target-name');\n            if (targetNameElement) {\n                targetNameElement.textContent = \n                    `Asteroid (${this.targetAsteroid.resourceType}) - ${this.currentLockOnIndex + 1}/${this.nearbyAsteroids.length}`;\n            }\n            \n            const targetResourcesElement = document.getElementById('target-resources');\n            if (targetResourcesElement) {\n                targetResourcesElement.textContent = \n                    `Health: ${this.targetAsteroid.mesh.userData.health}`;\n            }\n            \n            // Position the targeting indicator\n            this.targetReticle.position.copy(this.targetAsteroid.mesh.position);\n            this.targetReticle.visible = true;\n            \n            // Make the indicator look at the camera\n            const lookAtPos = new THREE.Vector3().copy(this.scene.camera.position);\n            this.targetReticle.lookAt(lookAtPos);\n            \n            // Ensure proper scale and visibility\n            this.targetReticle.scale.set(1, 1, 1);\n            this.targetReticle.material.opacity = 0.8;\n            if (this.targetReticle.children.length > 0) {\n                this.targetReticle.children[0].material.opacity = 0.8;\n            }\n        }\n        \n        return this.targetAsteroid;\n    }\n    \n    getCurrentTarget() {\n        try {\n            console.log(\"TargetingSystem: getCurrentTarget called\");\n            \n            // Check if we have a valid target\n            if (!this.targetAsteroid) {\n                console.log(\"TargetingSystem: No current target\");\n                return null;\n            }\n            \n            // Validate the target is still valid\n            if (!this.targetAsteroid.mesh || !this.targetAsteroid.mesh.position) {\n                console.error(\"TargetingSystem: Current target is invalid, clearing target\");\n                this.targetAsteroid = null;\n                return null;\n            }\n            \n            console.log(\"TargetingSystem: Returning current target:\", this.targetAsteroid);\n            return this.targetAsteroid;\n        } catch (error) {\n            console.error(\"TargetingSystem: Error in getCurrentTarget:\", error);\n            return null;\n        }\n    }\n    \n    isLockOnEnabled() {\n        return this.lockOnEnabled === true;\n    }\n    \n    findNearestTarget() {\n        try {\n            console.log(\"TargetingSystem: findNearestTarget called\");\n            \n            if (!this.spaceship || !this.spaceship.mesh || !this.spaceship.mesh.position) {\n                console.error(\"TargetingSystem: Cannot find nearest target - spaceship missing or invalid\");\n                return null;\n            }\n            \n            // Get all asteroids\n            let asteroids = [];\n            \n            // Try to get asteroids from the game environment\n            const game = window.gameInstance || window.game;\n            if (game && game.environment && Array.isArray(game.environment.asteroids)) {\n                console.log(`TargetingSystem: Found ${game.environment.asteroids.length} asteroids in environment`);\n                asteroids = game.environment.asteroids;\n            } else {\n                console.error(\"TargetingSystem: Could not access asteroids from game environment\");\n                return null;\n            }\n            \n            if (asteroids.length === 0) {\n                console.log(\"TargetingSystem: No asteroids found in environment\");\n                return null;\n            }\n            \n            // Find the closest asteroid with proper validation\n            let closestAsteroid = null;\n            let closestDistance = Infinity;\n            \n            for (const asteroid of asteroids) {\n                // Validate asteroid has required properties and is visible\n                if (!asteroid || !asteroid.mesh || !asteroid.mesh.position || !asteroid.mesh.visible) {\n                    console.log(\"TargetingSystem: Skipping invalid or invisible asteroid\", asteroid);\n                    continue;\n                }\n                \n                const distance = this.spaceship.mesh.position.distanceTo(asteroid.mesh.position);\n                \n                if (distance < closestDistance) {\n                    closestDistance = distance;\n                    closestAsteroid = asteroid;\n                }\n            }\n            \n            if (closestAsteroid) {\n                console.log(\"TargetingSystem: Found nearest target:\", closestAsteroid);\n                \n                // Select this target\n                this.setTarget(closestAsteroid);\n                \n                return closestAsteroid;\n            } else {\n                console.log(\"TargetingSystem: No valid asteroid found after checking all asteroids\");\n                return null;\n            }\n        } catch (error) {\n            console.error(\"TargetingSystem: Error in findNearestTarget:\", error);\n            return null;\n        }\n    }\n    \n    update() {\n        // Update scan radius in case it has changed (from upgrades)\n        this.scanRadius = this.getScanRadius();\n        \n        // Update lock-on targeting visuals\n        if (this.lockOnEnabled && this.targetAsteroid) {\n            // Update target indicator position\n            this.targetReticle.position.copy(this.targetAsteroid.mesh.position);\n            \n            // Make indicator face the camera\n            const lookAtPos = new THREE.Vector3().copy(this.scene.camera.position);\n            this.targetReticle.lookAt(lookAtPos);\n            \n            // Rotate the inner rings in opposite directions for dynamic effect\n            this.targetReticle.rotation.z += 0.01;\n            if (this.targetReticle.children.length > 0) {\n                this.targetReticle.children[0].rotation.z -= 0.02;\n            }\n            \n            // Pulse the opacity and size for visual effect\n            const pulseValue = Math.sin(Date.now() * 0.005);\n            const opacity = 0.6 + 0.4 * pulseValue;\n            const scale = 1 + 0.1 * pulseValue;\n            \n            this.targetReticle.material.opacity = opacity;\n            this.targetReticle.scale.set(scale, scale, scale);\n            \n            // Update distance in UI\n            const targetDistanceElement = document.getElementById('target-distance');\n            if (targetDistanceElement) {\n                const distance = Math.round(this.spaceship.mesh.position.distanceTo(this.targetAsteroid.mesh.position));\n                targetDistanceElement.textContent = `Distance: ${distance} units`;\n            }\n            \n            // Check if target is on screen or not\n            const isOnScreen = this.isTargetOnScreen();\n            \n            // ALWAYS show the reticle when targeting, regardless of whether it's on screen\n            this.targetReticle.visible = true;\n            \n            // Update off-screen indicator if target is off-screen\n            if (!isOnScreen) {\n                const screenPosition = this.getScreenPosition(this.targetAsteroid.mesh.position);\n                const targetDirection = this.getTargetDirection();\n                this.showOffScreenIndicator(screenPosition, targetDirection);\n            } else {\n                this.hideOffScreenIndicators();\n            }\n            \n            // If target is destroyed or too far away, find a new one\n            if (!this.targetAsteroid.mesh.parent || \n                this.spaceship.mesh.position.distanceTo(this.targetAsteroid.mesh.position) > this.scanRadius) {\n                this.scanForAsteroids();\n            }\n        }\n        \n        // Rescan for asteroids periodically in lock-on mode\n        if (this.lockOnEnabled && Date.now() % 50 === 0) {\n            this.scanForAsteroids();\n        }\n    }\n    \n    setTarget(target) {\n        try {\n            console.log(\"TargetingSystem: setTarget called\", target);\n            \n            // Validate the target\n            if (!target) {\n                console.error(\"TargetingSystem: Cannot set null target\");\n                return;\n            }\n            \n            if (!target.mesh || !target.mesh.position) {\n                console.error(\"TargetingSystem: Target is missing mesh or position properties\", target);\n                return;\n            }\n            \n            // Set the target\n            this.targetAsteroid = target;\n            \n            // Update UI elements\n            if (this.targetDisplay) {\n                this.targetDisplay.style.display = 'block';\n            }\n            \n            if (this.targetInfoElement) {\n                // Format target info\n                const distance = this.calculateDistanceToTarget();\n                let resourceType = target.resourceType || 'Unknown';\n                \n                // Capitalize first letter\n                resourceType = resourceType.charAt(0).toUpperCase() + resourceType.slice(1);\n                \n                // Update target info text\n                this.targetInfoElement.textContent = `${resourceType} Asteroid - ${distance.toFixed(0)}m`;\n                this.targetInfoElement.style.color = '#30cfd0';\n                this.targetInfoElement.style.display = 'block';\n            }\n            \n            console.log(\"TargetingSystem: Target successfully set\", this.targetAsteroid);\n            \n            // Enable lock-on\n            this.lockOnEnabled = true;\n            \n            return true;\n        } catch (error) {\n            console.error(\"TargetingSystem: Error in setTarget:\", error);\n            return false;\n        }\n    }\n    \n    calculateDistanceToTarget() {\n        try {\n            if (!this.targetAsteroid || !this.targetAsteroid.mesh || !this.targetAsteroid.mesh.position) {\n                console.error(\"TargetingSystem: Cannot calculate distance - invalid target asteroid\");\n                return Infinity;\n            }\n            \n            if (!this.spaceship || !this.spaceship.mesh || !this.spaceship.mesh.position) {\n                console.error(\"TargetingSystem: Cannot calculate distance - invalid spaceship\");\n                return Infinity;\n            }\n            \n            const distance = this.spaceship.mesh.position.distanceTo(this.targetAsteroid.mesh.position);\n            return distance;\n        } catch (error) {\n            console.error(\"TargetingSystem: Error calculating distance to target:\", error);\n            return Infinity;\n        }\n    }\n    \n    // Add methods for off-screen indicators\n    createOffScreenIndicators() {\n        // Create container for off-screen indicators\n        this.offScreenContainer = document.createElement('div');\n        this.offScreenContainer.id = 'off-screen-indicators';\n        this.offScreenContainer.style.position = 'absolute';\n        this.offScreenContainer.style.top = '0';\n        this.offScreenContainer.style.left = '0';\n        this.offScreenContainer.style.width = '100%';\n        this.offScreenContainer.style.height = '100%';\n        this.offScreenContainer.style.pointerEvents = 'none';\n        this.offScreenContainer.style.display = 'none';\n        document.body.appendChild(this.offScreenContainer);\n        \n        // Create the arrow indicator\n        this.offScreenIndicator = document.createElement('div');\n        this.offScreenIndicator.style.position = 'absolute';\n        this.offScreenIndicator.style.width = '30px';\n        this.offScreenIndicator.style.height = '30px';\n        this.offScreenIndicator.innerHTML = `\n            <svg width=\"30\" height=\"30\" viewBox=\"0 0 30 30\">\n                <polygon points=\"15,0 30,30 15,22 0,30\" fill=\"#ff3030\" />\n            </svg>\n        `;\n        this.offScreenIndicator.style.transformOrigin = 'center center';\n        this.offScreenIndicator.style.display = 'none';\n        this.offScreenContainer.appendChild(this.offScreenIndicator);\n    }\n    \n    hideOffScreenIndicators() {\n        if (this.offScreenContainer) {\n            this.offScreenContainer.style.display = 'none';\n        }\n        if (this.offScreenIndicator) {\n            this.offScreenIndicator.style.display = 'none';\n        }\n    }\n    \n    showOffScreenIndicator(screenPosition, targetDirection) {\n        if (!this.offScreenContainer || !this.offScreenIndicator) return;\n        \n        // Show container\n        this.offScreenContainer.style.display = 'block';\n        this.offScreenIndicator.style.display = 'block';\n        \n        // Calculate angle for the arrow to point at target\n        const angle = Math.atan2(targetDirection.y, targetDirection.x) * (180 / Math.PI);\n        \n        // Position at the edge of screen\n        const margin = 50; // Margin from the screen edge\n        const halfWidth = window.innerWidth / 2;\n        const halfHeight = window.innerHeight / 2;\n        \n        // Normalize direction vector\n        const normalizedDir = new THREE.Vector2(targetDirection.x, targetDirection.y).normalize();\n        \n        // Calculate intersection with screen edge\n        let edgeX, edgeY;\n        \n        // Check if we're intersecting with the vertical or horizontal edge\n        const slopeRatio = Math.abs(normalizedDir.y / normalizedDir.x);\n        const screenRatio = halfHeight / halfWidth;\n        \n        if (slopeRatio > screenRatio) {\n            // Intersect with top/bottom edge\n            edgeY = normalizedDir.y > 0 ? halfHeight - margin : -halfHeight + margin;\n            edgeX = edgeY / normalizedDir.y * normalizedDir.x;\n        } else {\n            // Intersect with left/right edge\n            edgeX = normalizedDir.x > 0 ? halfWidth - margin : -halfWidth + margin;\n            edgeY = edgeX / normalizedDir.x * normalizedDir.y;\n        }\n        \n        // Position the indicator at the edge of the screen\n        this.offScreenIndicator.style.left = (halfWidth + edgeX) + 'px';\n        this.offScreenIndicator.style.top = (halfHeight + edgeY) + 'px';\n        this.offScreenIndicator.style.transform = `rotate(${angle}deg)`;\n    }\n    \n    // Helper methods for screen position calculations\n    isTargetOnScreen() {\n        if (!this.targetAsteroid || !this.targetAsteroid.mesh) return false;\n        \n        const screenPosition = this.getScreenPosition(this.targetAsteroid.mesh.position);\n        \n        // Check if position is within screen bounds with some margin\n        const margin = 0.1; // 10% margin\n        return screenPosition.x >= -1 + margin && \n               screenPosition.x <= 1 - margin && \n               screenPosition.y >= -1 + margin && \n               screenPosition.y <= 1 - margin;\n    }\n    \n    getScreenPosition(worldPosition) {\n        // Create a copy of the position\n        const tempVector = new THREE.Vector3().copy(worldPosition);\n        \n        // Project to screen space\n        tempVector.project(this.scene.camera);\n        \n        return new THREE.Vector2(tempVector.x, tempVector.y);\n    }\n    \n    getTargetDirection() {\n        // Get normalized direction vector from screen center to target\n        const screenPosition = this.getScreenPosition(this.targetAsteroid.mesh.position);\n        \n        // Create a direction vector from screen center to target position\n        return new THREE.Vector2(screenPosition.x, screenPosition.y);\n    }\n} ","// dockingSystem.js - Handles stargate docking and trading\n\nexport class DockingSystem {\n    constructor(spaceship, stargate, ui) {\n        this.spaceship = spaceship;\n        this.stargate = stargate;\n        this.ui = ui;\n        \n        this.nearStargate = false;\n        this.isDocked = this.spaceship.isDocked; // Initialize with spaceship's docked state\n        \n        // Preemptively set a safe undocking position\n        if (this.spaceship && this.spaceship.undockLocation && this.stargate) {\n            // Position in the middle of the stargate\n            this.spaceship.undockLocation.set(0, 10000, 0);\n        }\n        \n        console.log(\"Initializing docking system, ship is \" + (this.isDocked ? \"docked\" : \"undocked\"));\n        this.setupDockingControls();\n        \n        // If we're starting docked, publish the player.docked event immediately\n        if (this.isDocked && this.spaceship.world && this.spaceship.world.messageBus) {\n            this.spaceship.world.messageBus.publish('player.docked', {\n                playerPosition: this.spaceship.mesh ? this.spaceship.mesh.position.clone() : null,\n                stargate: this.stargate\n            });\n            console.log(\"Published initial player.docked event\");\n        }\n    }\n    \n    setupDockingControls() {\n        // Add docking key handler (Q key)\n        document.addEventListener('keydown', e => {\n            if (e.key.toLowerCase() === 'q') {\n                if (this.nearStargate && !this.spaceship.isDocked) {\n                    console.log(\"Q key pressed: Docking with stargate\");\n                    this.dockWithStargate();\n                } else if (this.spaceship.isDocked) {\n                    console.log(\"Q key pressed while docked: No action (use Undock button)\");\n                } else if (!this.nearStargate) {\n                    console.log(\"Q key pressed but not near stargate\");\n                }\n            }\n        });\n        \n        // Set up stargate UI button handlers\n        this.setupStargateUIControls();\n    }\n    \n    setupStargateUIControls() {\n        // Set up refuel button\n        const refuelBtn = document.getElementById('refuel-btn');\n        if (refuelBtn) {\n            refuelBtn.addEventListener('click', () => {\n                if (this.spaceship.credits >= 100) {\n                    this.spaceship.credits -= this.spaceship.refuel();\n                    this.updateStargateUI();\n                }\n            });\n        }\n        \n        // Set up shield repair button\n        const repairShieldBtn = document.getElementById('repair-shield-btn');\n        if (repairShieldBtn) {\n            repairShieldBtn.addEventListener('click', () => {\n                if (this.spaceship.credits >= 150) {\n                    this.spaceship.credits -= this.spaceship.repairShield();\n                    this.updateStargateUI();\n                }\n            });\n        }\n        \n        // Set up hull repair button\n        const repairHullBtn = document.getElementById('repair-hull-btn');\n        if (repairHullBtn) {\n            repairHullBtn.addEventListener('click', () => {\n                if (this.spaceship.credits >= 200) {\n                    this.spaceship.credits -= this.spaceship.repairHull();\n                    this.updateStargateUI();\n                }\n            });\n        }\n        \n        // Set up undock button\n        const undockBtn = document.getElementById('undock-btn');\n        if (undockBtn) {\n            // Use both click and touchend events for better Android compatibility\n            const handleUndock = (e) => {\n                // Prevent any default action that might interfere\n                e.preventDefault();\n                e.stopPropagation();\n                \n                // Log which event triggered the undock\n                console.log(`Undock button ${e.type} event triggered`);\n\n                // Add a small delay to ensure the event completes on Android\n                if (this.isMobileDevice()) {\n                    // For Android, remove the overlay classes immediately\n                    document.body.classList.remove('undocking', 'modal-open');\n                    // Set a brief timeout to allow touch event to complete\n                    setTimeout(() => {\n                        this.undockFromStargate();\n                    }, 50);\n                } else {\n                    this.undockFromStargate();\n                }\n            };\n            \n            // Add both event listeners for better compatibility\n            undockBtn.addEventListener('click', handleUndock);\n            undockBtn.addEventListener('touchend', handleUndock);\n            \n            // Prevent any touch events from being captured or blocked\n            undockBtn.addEventListener('touchstart', (e) => {\n                console.log(\"Touch started on undock button\");\n                e.stopPropagation();\n            }, { passive: false });\n        }\n        \n        // Set up resource selling buttons\n        this.setupSellingButtons();\n        \n        // Set up upgrade buttons\n        this.setupUpgradeButtons();\n    }\n    \n    setupSellingButtons() {\n        const sellIronBtn = document.getElementById('sell-iron');\n        if (sellIronBtn) {\n            sellIronBtn.addEventListener('click', () => {\n                if (this.resources.iron > 0) {\n                    this.spaceship.credits += this.resources.iron * 10;\n                    this.resources.iron = 0;\n                    this.updateStargateUI();\n                }\n            });\n        }\n        \n        const sellGoldBtn = document.getElementById('sell-gold');\n        if (sellGoldBtn) {\n            sellGoldBtn.addEventListener('click', () => {\n                if (this.resources.gold > 0) {\n                    this.spaceship.credits += this.resources.gold * 50;\n                    this.resources.gold = 0;\n                    this.updateStargateUI();\n                }\n            });\n        }\n        \n        const sellPlatinumBtn = document.getElementById('sell-platinum');\n        if (sellPlatinumBtn) {\n            sellPlatinumBtn.addEventListener('click', () => {\n                if (this.resources.platinum > 0) {\n                    this.spaceship.credits += this.resources.platinum * 200;\n                    this.resources.platinum = 0;\n                    this.updateStargateUI();\n                }\n            });\n        }\n    }\n    \n    setupUpgradeButtons() {\n        // Fuel tank upgrade button handler\n        this.setupUpgradeButton('upgrade-fuel-tank', \n            () => this.spaceship.fuelUpgradeCost,\n            () => this.spaceship.upgradeFuelTank());\n        \n        // Engine upgrade button handler\n        this.setupUpgradeButton('upgrade-engine', \n            () => this.spaceship.engineUpgradeCost,\n            () => this.spaceship.upgradeEngine());\n        \n        // Mining laser upgrade button handler\n        this.setupUpgradeButton('upgrade-mining', \n            () => this.spaceship.miningUpgradeCost,\n            () => this.spaceship.upgradeMiningLaser());\n        \n        // Hull upgrade button handler\n        this.setupUpgradeButton('upgrade-hull', \n            () => this.spaceship.hullUpgradeCost,\n            () => this.spaceship.upgradeHull());\n        \n        // Scanner upgrade button handler\n        this.setupUpgradeButton('upgrade-scanner', \n            () => this.spaceship.scannerUpgradeCost,\n            () => this.spaceship.upgradeScanner());\n    }\n    \n    // Helper method to set up an upgrade button with a given cost getter and upgrade function\n    setupUpgradeButton(buttonId, costGetter, upgradeFunction) {\n        const button = document.getElementById(buttonId);\n        if (button) {\n            button.addEventListener('click', () => {\n                const cost = costGetter();\n                if (this.spaceship.credits >= cost) {\n                    this.spaceship.credits -= cost;\n                    upgradeFunction();\n                    \n                    // Update the mining system's efficiency if we upgraded the mining laser\n                    if (buttonId === 'upgrade-mining' && this.updateMiningSystem) {\n                        this.updateMiningSystem();\n                    }\n                    \n                    // Update UI\n                    this.updateStargateUI();\n                }\n            });\n        }\n    }\n    \n    // Method to update the mining system when mining efficiency is upgraded\n    updateMiningSystem() {\n        // Find the mining system through the Controls object to pass the new efficiency\n        if (this.ui && this.ui.controls && this.ui.controls.miningSystem) {\n            // Apply the mining efficiency to the mining speed\n            const miningSystem = this.ui.controls.miningSystem;\n            \n            // Update mining speeds for each resource type based on the new efficiency\n            Object.keys(miningSystem.miningSpeedByType).forEach(resourceType => {\n                const baseSpeed = miningSystem.miningSpeedByType[resourceType];\n                miningSystem.miningSpeedByType[resourceType] = \n                    baseSpeed * this.spaceship.miningEfficiency;\n            });\n            \n            console.log(\"Mining system updated with new efficiency:\", this.spaceship.miningEfficiency);\n        }\n    }\n    \n    dockWithStargate() {\n        console.log(\"Docking with stargate\");\n        \n        // Only update ship state if it's not already docked\n        if (!this.spaceship.isDocked) {\n            // Dock the ship\n            this.spaceship.dock();\n            this.isDocked = true;\n            \n            // Publish the player.docked event for enemy system and other systems to respond\n            if (this.spaceship.world && this.spaceship.world.messageBus) {\n                this.spaceship.world.messageBus.publish('player.docked', {\n                    playerPosition: this.spaceship.mesh.position.clone(),\n                    stargate: this.stargate\n                });\n                console.log(\"Published player.docked event\");\n            }\n        } else {\n            console.log(\"Ship is already docked, just showing UI\");\n        }\n        \n        // Mobile-specific preparation - ensure all classes that might block UI visibility are removed\n        if (this.isMobileDevice()) {\n            console.log(\"Mobile device detected - preparing for stargate UI\");\n            document.body.classList.remove('undocking', 'modal-open');\n            \n            // Reset any problematic styles that might prevent UI from showing\n            document.body.style.position = 'static';\n            document.body.style.touchAction = 'auto';\n            document.body.style.pointerEvents = 'auto';\n            document.body.style.overflow = 'auto';\n        }\n        \n        // Show the stargate UI\n        if (this.ui && this.ui.stargateInterface) {\n            console.log(\"Showing stargate UI...\");\n            this.ui.stargateInterface.showStargateUI();\n            \n            // Double-check visibility on mobile with a small delay\n            if (this.isMobileDevice()) {\n                setTimeout(() => {\n                    const stargateUI = document.getElementById('stargate-ui');\n                    if (stargateUI && stargateUI.style.display !== 'block') {\n                        console.log(\"Forcing stargate UI display\");\n                        stargateUI.style.display = 'block';\n                    }\n                }, 100);\n            }\n        }\n        \n        // Hide game UI elements\n        if (this.ui) {\n            this.ui.hideUI();\n        }\n        \n        // Exit pointer lock so cursor is visible for UI interactions\n        if (document.pointerLockElement) {\n            document.exitPointerLock();\n            console.log(\"Exited pointer lock for UI interaction\");\n        }\n        \n        // Update the stargate UI with current values\n        this.updateStargateUI();\n    }\n    \n    // Helper to wrap steps in requestAnimationFrame for smoother UI updates\n    async performStep(stepFunction, stepName) {\n        return new Promise(resolve => {\n            requestAnimationFrame(() => {\n                try {\n                    stepFunction();\n                    console.log(`Completed step: ${stepName}`);\n                } catch (err) {\n                    console.error(`Error during step ${stepName}:`, err);\n                }\n                resolve();\n            });\n        });\n    }\n\n    // Helper to yield control to the browser\n    async yieldToBrowser() {\n        return new Promise(resolve => requestAnimationFrame(resolve));\n    }\n\n    // Optimized method to hide UI elements using a single reflow\n    hideStargateUI() {\n        if (this.ui && this.ui.stargateInterface) {\n            // Use CSS class for better performance\n            document.body.classList.add('undocking');\n            this.ui.stargateInterface.hideStargateUI();\n            console.log(\"Hiding stargate interface\");\n        }\n    }\n\n    // Optimized method to show game UI elements using a single reflow\n    showGameUI() {\n        if (this.ui) {\n            // Use CSS class for better performance\n            document.body.classList.remove('undocking');\n            this.ui.showUI();\n            console.log(\"Showing game UI\");\n        }\n    }\n\n    // Optimized method to reset mobile styles\n    resetMobileStyles() {\n        // Immediately remove problematic classes for Android\n        if (this.isMobileDevice()) {\n            document.body.classList.remove('undocking', 'modal-open');\n        }\n        \n        // Batch style changes to minimize reflows\n        requestAnimationFrame(() => {\n            // FIX: More aggressive style clearing for Android\n            document.body.style.cssText = '';\n            document.body.style.overflow = 'auto';\n            document.body.style.position = 'static';\n            document.body.style.height = 'auto';\n            document.body.style.width = 'auto';\n            document.body.style.touchAction = 'auto';\n            document.body.style.pointerEvents = 'auto';\n            document.body.style.webkitOverflowScrolling = 'touch';\n            \n            // FIX: Ensure all restrictive classes are removed to prevent touch event issues\n            document.body.classList.remove('modal-open', 'undocking');\n            \n            // Reset scrollable containers in a single pass\n            document.querySelectorAll('.modal-content, #stargate-ui, #star-map').forEach(container => {\n                if (container && container.style) {\n                    container.style.cssText = 'overflow: auto; -webkit-overflow-scrolling: touch;';\n                    container.scrollTop = 0;\n                }\n            });\n        });\n    }\n\n    async undockFromStargate() {\n        if (!this.spaceship.isDocked) {\n            console.log(\"Not docked, can't undock\");\n            return;\n        }\n\n        // FIX: For Android, immediately remove any classes that might block touch events\n        if (this.isMobileDevice()) {\n            document.body.classList.remove('undocking');\n            this.resetMobileStyles();\n        }\n\n        // Show loading indicator\n        const loadingIndicator = document.createElement('div');\n        loadingIndicator.className = 'undocking-indicator';\n        loadingIndicator.textContent = 'Undocking...';\n        document.body.appendChild(loadingIndicator);\n\n        try {\n            console.log(\"Starting undock sequence...\");\n            \n            // Store shield value before any changes\n            this.preUndockShieldValue = this.spaceship.shield;\n            console.log(`Storing pre-undock shield value: ${this.preUndockShieldValue}`);\n\n            // Step 1: Close all modals\n            await this.performStep(() => this.closeAllModals(), \"Closing modals\");\n            await this.yieldToBrowser();\n\n            // Step 2: Handle mobile-specific cleanup\n            if (this.isMobileDevice()) {\n                await this.performStep(() => this.resetMobileStyles(), \"Resetting mobile styles\");\n                await this.yieldToBrowser();\n            }\n\n            // Step 3: Hide stargate UI and show game UI\n            await this.performStep(() => this.hideStargateUI(), \"Hiding stargate UI\");\n            await this.yieldToBrowser();\n            \n            await this.performStep(() => this.showGameUI(), \"Showing game UI\");\n            await this.yieldToBrowser();\n\n            // Step 4: Perform core undock logic\n            console.log(\"Performing core undock...\");\n            const newPosition = this.spaceship.undock();\n            \n            // Step 5: Sync health values immediately\n            console.log(\"Syncing health values...\");\n            \n            // Check for shield reset issue\n            if (this.spaceship.shield === 0 && this.preUndockShieldValue > 0) {\n                console.log(`Fixing shield reset: Restoring to ${this.preUndockShieldValue}`);\n                this.spaceship.shield = this.preUndockShieldValue;\n            }\n\n            // Sync values immediately without setTimeout\n            this.spaceship.syncValuesToHealthComponent();\n\n            // Publish undocked event with correct state\n            const healthData = {\n                shield: this.spaceship.shield,\n                maxShield: this.spaceship.maxShield,\n                hull: this.spaceship.hull,\n                maxHull: this.spaceship.maxHull\n            };\n\n            // Publish to appropriate message bus\n            const messageBus = window.game?.messageBus || window.mainMessageBus;\n            if (messageBus) {\n                messageBus.publish('player.undocked', healthData);\n                console.log(\"Published player.undocked event with health values:\", healthData);\n            }\n\n            // Reset docking status\n            this.dockingAvailable = false;\n\n            // Request pointer lock if needed (non-mobile only)\n            if (this.autoPointerLockOnUndock && !this.isMobileDevice()) {\n                await this.performStep(() => this.requestPointerLock(), \"Requesting pointer lock\");\n            }\n\n            console.log(\"Undock sequence complete\");\n            \n        } catch (error) {\n            console.error(\"Error during undocking:\", error);\n        } finally {\n            // Clean up loading indicator\n            if (document.body.contains(loadingIndicator)) {\n                document.body.removeChild(loadingIndicator);\n            }\n            \n            // FIX: More aggressive cleanup for Android devices\n            if (this.isMobileDevice()) {\n                // Clear all restrictive classes\n                document.body.classList.remove('undocking', 'modal-open');\n                \n                // Force resetMobileStyles again to ensure all touch restrictions are removed\n                this.resetMobileStyles();\n                \n                // Ensure specific problematic styles are cleared\n                document.body.style.pointerEvents = '';\n                document.body.style.touchAction = '';\n                document.body.style.overflowY = '';\n                document.body.style.position = '';\n            } else {\n                document.body.classList.remove('undocking');\n            }\n        }\n    }\n    \n    // Method to detect mobile devices\n    isMobileDevice() {\n        return ('ontouchstart' in window) || \n               (navigator.maxTouchPoints > 0) || \n               (navigator.msMaxTouchPoints > 0) ||\n               (window.innerWidth < 900);\n    }\n    \n    // Method to close any open modal UI that might conflict with undocking\n    closeAllModals() {\n        try {\n            // Close custom system creator if it's open\n            const customSystemCreator = document.getElementById('custom-system-creator');\n            if (customSystemCreator && window.getComputedStyle(customSystemCreator).display !== 'none') {\n                console.log(\"Closing custom system creator before undocking\");\n                // See if we can find the close button and simulate a click\n                const closeBtn = customSystemCreator.querySelector('#close-system-creator');\n                if (closeBtn) {\n                    closeBtn.click();\n                } else {\n                    // Otherwise just hide it directly\n                    customSystemCreator.style.display = 'none';\n                }\n                \n                // Force game objects to clean up their modal state\n                if (window.game && window.game.ui) {\n                    // Check for star map\n                    if (window.game.ui.starMap && typeof window.game.ui.starMap.hide === 'function') {\n                        window.game.ui.starMap.hide();\n                    }\n                    \n                    // Check for custom system creator\n                    if (window.game.ui.customSystemCreator && typeof window.game.ui.customSystemCreator.hide === 'function') {\n                        window.game.ui.customSystemCreator.hide();\n                    }\n                    \n                    // Cleanup any modal state on the body\n                    document.body.classList.remove('modal-open');\n                }\n            }\n            \n            // Close star map if open\n            const starMap = document.getElementById('star-map');\n            if (starMap && window.getComputedStyle(starMap).display !== 'none') {\n                console.log(\"Closing star map before undocking\");\n                const closeStarMapBtn = starMap.querySelector('#close-star-map');\n                if (closeStarMapBtn) {\n                    closeStarMapBtn.click();\n                } else {\n                    starMap.style.display = 'none';\n                }\n            }\n            \n            // Close any other modals\n            const allModals = document.querySelectorAll('.modal-container');\n            allModals.forEach(modal => {\n                if (window.getComputedStyle(modal).display !== 'none') {\n                    console.log(\"Closing modal before undocking:\", modal.id || 'unnamed modal');\n                    modal.style.display = 'none';\n                }\n            });\n        } catch (err) {\n            console.warn(\"Error while closing modals:\", err);\n        }\n    }\n    \n    // Helper method to request pointer lock\n    requestPointerLock() {\n        // Find the canvas element (it should be the first one in the document)\n        const canvas = document.querySelector('canvas');\n        if (canvas && !document.pointerLockElement) {\n            // Request pointer lock with a slight delay to ensure UI transitions are complete\n            setTimeout(() => {\n                canvas.requestPointerLock();\n                console.log(\"Requested pointer lock for ship control\");\n            }, 200);\n        }\n    }\n    \n    updateStargateUI() {\n        if (this.ui && this.ui.stargateInterface) {\n            this.ui.stargateInterface.updateStargateUI(this.spaceship, this.resources);\n        }\n    }\n    \n    checkStargateProximity() {\n        if (this.spaceship.isDocked) return;\n        \n        if (!this.stargate || !this.spaceship || !this.spaceship.mesh) return;\n        \n        const stargatePosition = this.stargate.getPosition();\n        if (!stargatePosition) return;\n        \n        const distance = this.spaceship.mesh.position.distanceTo(stargatePosition);\n        \n        if (distance < 2000) { // Within docking range (4x the original 500)\n            this.nearStargate = true;\n            if (this.ui && this.ui.stargateInterface) {\n                this.ui.stargateInterface.showDockingPrompt();\n            }\n            // Also show the dock button in touch controls for mobile\n            if (this.ui && this.ui.controls && this.ui.controls.isMobile && \n                this.ui.controls.touchControls) {\n                this.ui.controls.touchControls.showDockButton();\n            }\n        } else {\n            this.nearStargate = false;\n            if (this.ui && this.ui.stargateInterface) {\n                this.ui.stargateInterface.hideDockingPrompt();\n            }\n            // Also hide the dock button in touch controls for mobile\n            if (this.ui && this.ui.controls && this.ui.controls.isMobile && \n                this.ui.controls.touchControls) {\n                this.ui.controls.touchControls.hideDockButton();\n            }\n        }\n    }\n    \n    update() {\n        // Check if near stargate for docking\n        this.checkStargateProximity();\n    }\n    \n    // Setter for resources to allow dependency injection\n    setResources(resources) {\n        this.resources = resources;\n    }\n}","// touchControls.js - Touch controls for mobile devices using nipple.js\n\nexport class TouchControls {\n    constructor(spaceship, physics) {\n        this.spaceship = spaceship;\n        this.physics = physics;\n        this.leftJoystick = null;\n        this.rightJoystick = null;\n        this.dockButton = null;\n        this.mineButton = null;\n        this.fireButton = null;\n        this.targetButton = null;\n        this.isInitialized = false;\n        \n        // Store references to systems we need to interact with\n        this.miningSystem = null;\n        this.targetingSystem = null;\n        this.dockingSystem = null;\n        this.weaponSystem = null;\n        \n        // Thresholds for joystick input\n        this.threshold = 0.1;\n        \n        // Add crosshair\n        this.createCrosshair();\n        \n        // Load nipple.js script\n        this.loadNippleJS().then(() => {\n            this.setupTouchControls();\n        }).catch(err => {\n            console.error('Failed to load nipple.js:', err);\n        });\n    }\n    \n    // Method to set the systems we need to interact with\n    setControlSystems(controls) {\n        console.log(\"TouchControls: Setting control systems\");\n        \n        if (!controls) {\n            console.error(\"TouchControls: Controls object is null or undefined\");\n            return;\n        }\n        \n        // Store references to systems\n        this.miningSystem = controls.miningSystem;\n        this.targetingSystem = controls.targetingSystem;\n        this.dockingSystem = controls.dockingSystem;\n        this.weaponSystem = controls.weaponSystem;\n        \n        // Extra check for weapon system that might be Combat instance\n        if (this.weaponSystem && !this.weaponSystem.setFiring && this.weaponSystem.isFiring !== undefined) {\n            console.log(\"TouchControls: weaponSystem is likely a Combat instance, adapting interface\");\n            // Create adapter functions if needed\n        }\n        \n        // Log all connections with details\n        const systemStatus = {\n            hasMiningSystem: !!this.miningSystem,\n            miningSystemType: this.miningSystem ? this.miningSystem.constructor.name : \"Not set\",\n            hasTargetingSystem: !!this.targetingSystem,\n            targetingSystemType: this.targetingSystem ? this.targetingSystem.constructor.name : \"Not set\",\n            hasDockingSystem: !!this.dockingSystem,\n            dockingSystemType: this.dockingSystem ? this.dockingSystem.constructor.name : \"Not set\",\n            hasWeaponSystem: !!this.weaponSystem,\n            weaponSystemType: this.weaponSystem ? this.weaponSystem.constructor.name : \"Not set\"\n        };\n        \n        console.log(\"TouchControls: Systems connected\", systemStatus);\n        \n        if (!this.miningSystem) {\n            console.error(\"TouchControls: Mining system is not connected - mining won't work!\");\n        }\n        \n        if (!this.targetingSystem) {\n            console.error(\"TouchControls: Targeting system is not connected - targeting won't work!\");\n        }\n        \n        // Store reference to spaceship from controls if not already set\n        if (!this.spaceship && controls.spaceship) {\n            this.spaceship = controls.spaceship;\n            console.log(\"TouchControls: Spaceship reference set from controls\");\n        }\n        \n        return this; // For method chaining\n    }\n    \n    createCrosshair() {\n        // Create a small crosshair in the center of the screen\n        const crosshair = document.createElement('div');\n        crosshair.id = 'mobile-crosshair';\n        crosshair.style.position = 'absolute';\n        crosshair.style.top = '50%';\n        crosshair.style.left = '50%';\n        crosshair.style.transform = 'translate(-50%, -50%)';\n        crosshair.style.width = '10px';\n        crosshair.style.height = '10px';\n        crosshair.style.pointerEvents = 'none';\n        crosshair.style.zIndex = '999';\n        \n        // Create crosshair shape with a plus sign\n        crosshair.innerHTML = `\n            <div style=\"position: absolute; top: 50%; left: 0; width: 100%; height: 1px; background-color: rgba(120, 220, 232, 0.8);\"></div>\n            <div style=\"position: absolute; top: 0; left: 50%; width: 1px; height: 100%; background-color: rgba(120, 220, 232, 0.8);\"></div>\n            <div style=\"position: absolute; top: 50%; left: 50%; width: 3px; height: 3px; background-color: rgba(120, 220, 232, 0.8); border-radius: 50%; transform: translate(-50%, -50%);\"></div>\n        `;\n        \n        document.body.appendChild(crosshair);\n    }\n    \n    loadNippleJS() {\n        return new Promise((resolve, reject) => {\n            // Check if nipple.js is already loaded\n            if (window.nipplejs) {\n                resolve();\n                return;\n            }\n            \n            // Create script element\n            const script = document.createElement('script');\n            script.src = 'https://cdnjs.cloudflare.com/ajax/libs/nipplejs/0.10.1/nipplejs.min.js';\n            script.async = true;\n            \n            // Set up event handlers\n            script.onload = () => resolve();\n            script.onerror = () => reject(new Error('Failed to load nipple.js'));\n            \n            // Add script to document\n            document.head.appendChild(script);\n        });\n    }\n    \n    setupTouchControls() {\n        // Create container elements for joysticks\n        this.createJoystickZones();\n        \n        // Create action buttons\n        this.createActionButtons();\n        \n        // Initialize joysticks after a short delay to ensure DOM is ready\n        setTimeout(() => {\n            this.initializeJoysticks();\n            this.isInitialized = true;\n        }, 100);\n    }\n    \n    createJoystickZones() {\n        // Create left joystick zone (thrust control)\n        const leftJoystickZone = document.createElement('div');\n        leftJoystickZone.id = 'leftJoystickZone';\n        leftJoystickZone.style.position = 'absolute';\n        leftJoystickZone.style.bottom = '50px';\n        leftJoystickZone.style.left = '50px';\n        leftJoystickZone.style.width = '100px';\n        leftJoystickZone.style.height = '100px';\n        leftJoystickZone.style.zIndex = '1000';\n        \n        // Prevent default browser behavior to avoid scrolling when using joysticks\n        leftJoystickZone.addEventListener('touchstart', (e) => e.preventDefault(), { passive: false });\n        leftJoystickZone.addEventListener('touchmove', (e) => e.preventDefault(), { passive: false });\n        leftJoystickZone.addEventListener('touchend', (e) => e.preventDefault(), { passive: false });\n        \n        document.body.appendChild(leftJoystickZone);\n        \n        // Create right joystick zone (rotation control)\n        const rightJoystickZone = document.createElement('div');\n        rightJoystickZone.id = 'rightJoystickZone';\n        rightJoystickZone.style.position = 'absolute';\n        rightJoystickZone.style.bottom = '50px';\n        rightJoystickZone.style.right = '50px';\n        rightJoystickZone.style.width = '100px';\n        rightJoystickZone.style.height = '100px';\n        rightJoystickZone.style.zIndex = '1000';\n        \n        // Prevent default browser behavior to avoid scrolling when using joysticks\n        rightJoystickZone.addEventListener('touchstart', (e) => e.preventDefault(), { passive: false });\n        rightJoystickZone.addEventListener('touchmove', (e) => e.preventDefault(), { passive: false });\n        rightJoystickZone.addEventListener('touchend', (e) => e.preventDefault(), { passive: false });\n        \n        document.body.appendChild(rightJoystickZone);\n    }\n    \n    createActionButtons() {\n        // Create a container for left side action buttons\n        const leftActionButtonsContainer = document.createElement('div');\n        leftActionButtonsContainer.id = 'mobile-action-buttons-left';\n        leftActionButtonsContainer.style.position = 'absolute';\n        leftActionButtonsContainer.style.bottom = '170px';\n        leftActionButtonsContainer.style.left = '20px';\n        leftActionButtonsContainer.style.display = 'flex';\n        leftActionButtonsContainer.style.flexDirection = 'column';\n        leftActionButtonsContainer.style.gap = '15px';\n        leftActionButtonsContainer.style.zIndex = '1000';\n        document.body.appendChild(leftActionButtonsContainer);\n        \n        // Create a container for right side action buttons\n        const rightActionButtonsContainer = document.createElement('div');\n        rightActionButtonsContainer.id = 'mobile-action-buttons-right';\n        rightActionButtonsContainer.style.position = 'absolute';\n        rightActionButtonsContainer.style.bottom = '170px';\n        rightActionButtonsContainer.style.right = '20px';\n        rightActionButtonsContainer.style.display = 'flex';\n        rightActionButtonsContainer.style.flexDirection = 'column';\n        rightActionButtonsContainer.style.gap = '15px';\n        rightActionButtonsContainer.style.zIndex = '1000';\n        document.body.appendChild(rightActionButtonsContainer);\n        \n        // Create fire button (on left side)\n        this.fireButton = this.createActionButton(leftActionButtonsContainer, 'FIRE', 'rgba(255, 80, 80, 0.8)');\n        this.addButtonEvents(this.fireButton, this.handleFiringStart.bind(this), this.handleFiringEnd.bind(this));\n        \n        // Create mine button (on left side)\n        this.mineButton = this.createActionButton(leftActionButtonsContainer, 'MINE', 'rgba(120, 220, 232, 0.8)');\n        this.addButtonEvents(this.mineButton, this.handleMiningStart.bind(this), this.handleMiningEnd.bind(this));\n        \n        // Create target button (on right side)\n        this.targetButton = this.createActionButton(rightActionButtonsContainer, 'TARGET', 'rgba(255, 215, 0, 0.8)');\n        this.addButtonEvents(this.targetButton, this.handleTargeting.bind(this));\n        \n        // Create dock button (only shown when near stargate)\n        this.dockButton = this.createActionButton(null, 'DOCK', 'rgba(51, 153, 255, 0.8)');\n        this.dockButton.style.position = 'absolute';\n        this.dockButton.style.top = '50%';\n        this.dockButton.style.left = '50%';\n        this.dockButton.style.transform = 'translate(-50%, -50%)';\n        this.dockButton.style.width = '100px';  // Make dock button larger\n        this.dockButton.style.height = '100px'; // Make dock button larger\n        this.dockButton.style.fontSize = '20px'; // Larger text\n        this.dockButton.style.boxShadow = '0 0 25px rgba(51, 153, 255, 0.8)'; // Stronger glow\n        this.dockButton.style.zIndex = '10000'; \n        this.dockButton.style.display = 'none';\n        this.addButtonEvents(this.dockButton, this.handleDocking.bind(this));\n        document.body.appendChild(this.dockButton);\n        \n        // Create deploy laser button (on right side)\n        this.deployLaserButton = this.createActionButton(rightActionButtonsContainer, 'DEPLOY', 'rgba(255, 100, 100, 0.8)');\n        this.addButtonEvents(this.deployLaserButton, this.handleDeployLaser.bind(this));\n    }\n    \n    createActionButton(parent, text, color) {\n        const button = document.createElement('div');\n        button.className = 'mobile-action-button';\n        button.textContent = text;\n        button.style.width = '60px';\n        button.style.height = '60px'; \n        button.style.borderRadius = '50%';\n        button.style.backgroundColor = 'rgba(10, 20, 30, 0.7)';\n        button.style.border = `2px solid ${color}`;\n        button.style.color = color;\n        button.style.display = 'flex';\n        button.style.justifyContent = 'center';\n        button.style.alignItems = 'center';\n        button.style.fontFamily = '\"Rajdhani\", sans-serif';\n        button.style.fontSize = '16px';\n        button.style.fontWeight = 'bold';\n        button.style.boxShadow = `0 0 10px ${color}`;\n        button.style.userSelect = 'none';\n        button.style.touchAction = 'manipulation';\n        button.style.cursor = 'pointer';\n        \n        // Add hardware acceleration for better performance on mobile\n        button.style.transform = 'translateZ(0)';\n        button.style.webkitTapHighlightColor = 'transparent';\n        button.style.backfaceVisibility = 'hidden';\n        \n        if (parent) {\n            parent.appendChild(button);\n        }\n        \n        return button;\n    }\n    \n    initializeJoysticks() {\n        if (!window.nipplejs) {\n            console.error('nipplejs is not loaded');\n            return;\n        }\n        \n        // Initialize left joystick (thrust control)\n        this.leftJoystick = window.nipplejs.create({\n            zone: document.getElementById('leftJoystickZone'),\n            mode: 'static',\n            position: { left: '50%', top: '50%' },\n            color: 'rgba(120, 220, 232, 0.8)',\n            size: 100,\n            threshold: this.threshold,\n            dynamicPage: true, // Better performance for scrolling\n            fadeTime: 100, // Faster fade for better performance\n            lockX: false, // Allow X-axis movement\n            lockY: false  // Allow Y-axis movement\n        });\n        \n        // Initialize right joystick (rotation control)\n        this.rightJoystick = window.nipplejs.create({\n            zone: document.getElementById('rightJoystickZone'),\n            mode: 'static',\n            position: { left: '50%', top: '50%' },\n            color: 'rgba(120, 220, 232, 0.8)',\n            size: 100,\n            threshold: this.threshold,\n            dynamicPage: true, // Better performance for scrolling\n            fadeTime: 100, // Faster fade for better performance\n            lockX: false, // Allow X-axis movement\n            lockY: false  // Allow Y-axis movement\n        });\n        \n        // Set up event handlers for joysticks\n        this.setupJoystickEvents();\n    }\n    \n    setupJoystickEvents() {\n        // Left joystick events (thrust)\n        this.leftJoystick.on('move', (evt, data) => {\n            this.handleThrustJoystick(data);\n        }).on('end', () => {\n            this.resetThrust();\n        });\n        \n        // Right joystick events (rotation)\n        this.rightJoystick.on('move', (evt, data) => {\n            this.handleRotationJoystick(data);\n        }).on('end', () => {\n            // Do nothing on end - rotation is not continuous\n        });\n    }\n    \n    handleThrustJoystick(data) {\n        if (this.spaceship.isDocked) return;\n        \n        // Reset thrust directions\n        this.resetThrust();\n        \n        const force = data.force > 2 ? 2 : data.force; // Normalize force between 0-2\n        const angle = data.angle.radian;\n        \n        // Correct direction mapping based on standard joystick angles:\n        // In nipple.js, 0 radians = right, π/2 = up, π = left, 3π/2 = down\n        \n        // Up/North - Forward (around π/2 or 1.57 radians)\n        if (angle > 1.0 && angle < 2.0) {\n            this.spaceship.thrust.forward = true;\n        }\n        // Down/South - Backward (around 3π/2 or 4.71 radians)\n        else if (angle > 4.0 && angle < 5.5) {\n            this.spaceship.thrust.backward = true;\n        }\n        \n        // Left/West - Left (around π or 3.14 radians)\n        if (angle > 2.5 && angle < 4.0) {\n            this.spaceship.thrust.right = true;\n        }\n        // Right/East - Right (around 0 or 2π radians)\n        else if ((angle >= 0 && angle < 1.0) || angle > 5.5) {\n            this.spaceship.thrust.left = true;\n        }\n        \n        // Enable boost if force is high\n        this.spaceship.thrust.boost = force > 1.5;\n    }\n    \n    handleRotationJoystick(data) {\n        if (this.spaceship.isDocked) return;\n        \n        // Extract the X and Y components of the joystick vector\n        // Reduce sensitivity by lowering the multiplier from 0.05 to 0.015\n        const xMove = data.vector.x * data.force * 0.015;\n        // Invert the Y value to fix up/down control direction\n        const yMove = -data.vector.y * data.force * 0.015;\n        \n        // Update rotation via physics\n        this.physics.updateRotation(xMove, yMove);\n    }\n    \n    resetThrust() {\n        if (!this.spaceship) return;\n        \n        this.spaceship.thrust.forward = false;\n        this.spaceship.thrust.backward = false;\n        this.spaceship.thrust.left = false;\n        this.spaceship.thrust.right = false;\n        this.spaceship.thrust.boost = false;\n    }\n    \n    handleMiningStart() {\n        try {\n            console.log(\"TouchControls: handleMiningStart called\");\n            \n            // First ensure we have targeting and mining systems\n            if (!this.targetingSystem) {\n                console.error(\"TouchControls: Targeting system not available\");\n                return;\n            }\n            \n            if (!this.miningSystem) {\n                console.error(\"TouchControls: Mining system not available\");\n                return;\n            }\n            \n            // First, get the current target\n            let targetAsteroid = this.targetingSystem.getCurrentTarget();\n            console.log(\"TouchControls: Initial target:\", targetAsteroid);\n            \n            // If no target is selected, enable targeting and find nearest\n            if (!targetAsteroid) {\n                console.log(\"TouchControls: No target selected, enabling targeting and finding nearest target\");\n                \n                // Enable targeting if not already enabled\n                if (!this.targetingSystem.isLockOnEnabled()) {\n                    this.targetingSystem.toggleLockOn();\n                }\n                \n                // Find nearest target\n                targetAsteroid = this.targetingSystem.findNearestTarget();\n                console.log(\"TouchControls: Found nearest target:\", targetAsteroid);\n                \n                if (!targetAsteroid) {\n                    console.log(\"TouchControls: No targets in range after scan\");\n                    return;\n                }\n            }\n            \n            // Essential validation: make sure we have a valid target asteroid with required properties\n            if (!targetAsteroid || !targetAsteroid.mesh || !targetAsteroid.mesh.position) {\n                console.error(\"TouchControls: Target asteroid is missing required properties\", targetAsteroid);\n                \n                // Try a different approach - get all asteroids from environment\n                const game = window.gameInstance || window.game;\n                if (game && game.environment && game.environment.asteroids && game.environment.asteroids.length > 0) {\n                    console.log(\"TouchControls: Attempting to get asteroid directly from environment\");\n                    // Find closest asteroid\n                    let closestDist = Infinity;\n                    let closestAsteroid = null;\n                    \n                    for (const asteroid of game.environment.asteroids) {\n                        if (asteroid && asteroid.mesh && asteroid.mesh.position && this.spaceship && this.spaceship.mesh) {\n                            const dist = asteroid.mesh.position.distanceTo(this.spaceship.mesh.position);\n                            if (dist < closestDist) {\n                                closestDist = dist;\n                                closestAsteroid = asteroid;\n                            }\n                        }\n                    }\n                    \n                    if (closestAsteroid) {\n                        console.log(\"TouchControls: Found closest asteroid from environment:\", closestAsteroid);\n                        targetAsteroid = closestAsteroid;\n                    } else {\n                        console.error(\"TouchControls: Could not find any valid asteroids in environment\");\n                        return;\n                    }\n                } else {\n                    console.error(\"TouchControls: Could not access environment to find asteroids\");\n                    return;\n                }\n            }\n            \n            console.log(\"TouchControls: Target asteroid found:\", targetAsteroid);\n            \n            // Extra validation to make absolutely sure we have a valid targetAsteroid\n            if (!targetAsteroid || !targetAsteroid.mesh || !targetAsteroid.mesh.position) {\n                console.error(\"TouchControls: Target asteroid is still invalid after fallback attempts\");\n                return;\n            }\n            \n            // Explicitly set the target asteroid for mining\n            this.miningSystem.setTargetAsteroid(targetAsteroid);\n            \n            // Log asteroid details\n            console.log(\"TouchControls: Target set for mining:\", {\n                resourceType: targetAsteroid.resourceType || \"unknown\",\n                position: targetAsteroid.mesh ? targetAsteroid.mesh.position.toArray() : \"no mesh\",\n                distance: targetAsteroid.mesh && this.spaceship && this.spaceship.mesh ? \n                    targetAsteroid.mesh.position.distanceTo(this.spaceship.mesh.position) : \"unknown\"\n            });\n            \n            // Start mining\n            console.log(\"TouchControls: Starting mining operation\");\n            this.miningSystem.startMining();\n            \n            // Check if mining actually started\n            console.log(\"TouchControls: Mining started:\", this.miningSystem.isMining);\n            \n        } catch (error) {\n            console.error(\"TouchControls: Error in handleMiningStart:\", error);\n        }\n    }\n    \n    handleMiningEnd() {\n        try {\n            console.log(\"TouchControls: handleMiningEnd called\");\n            \n            // Make sure we have the mining system\n            if (!this.miningSystem) {\n                console.error(\"TouchControls: Mining system not available for stopping\");\n                return;\n            }\n            \n            // Stop mining\n            this.miningSystem.stopMining();\n            console.log(\"TouchControls: Mining stopped\");\n            \n        } catch (e) {\n            console.error(\"TouchControls: Error stopping mining:\", e);\n        }\n    }\n    \n    handleFiringStart() {\n        try {\n            // First try local reference to weapon system (which is actually the Combat class)\n            if (this.weaponSystem) {\n                // Attempt to use the setFiring method from the Combat class\n                if (typeof this.weaponSystem.setFiring === 'function') {\n                    this.weaponSystem.setFiring(true);\n                } else {\n                    // Fallback to the older isWeaponActive property\n                    this.weaponSystem.isWeaponActive = true;\n                }\n                \n                // Try to play sound if available\n                const game = window.gameInstance || window.game;\n                if (game && game.audio) {\n                    game.audio.playSound('laser');\n                }\n                return;\n            }\n            \n            // Fallback to global game reference\n            const game = window.gameInstance || window.game;\n            if (!game) {\n                console.error(\"No game reference found\");\n                return;\n            }\n            \n            // Try direct combat object on game first (preferred)\n            if (game.combat) {\n                game.combat.setFiring(true);\n                \n                // Play laser sound if available\n                if (game.audio) {\n                    game.audio.playSound('laser');\n                }\n                return;\n            }\n            \n            // Legacy fallbacks\n            if (game.weaponSystem) {\n                if (typeof game.weaponSystem.setFiring === 'function') {\n                    game.weaponSystem.setFiring(true);\n                } else {\n                    game.weaponSystem.isWeaponActive = true;\n                }\n                \n                // Play laser sound if available\n                if (game.audio) {\n                    game.audio.playSound('laser');\n                }\n                return;\n            }\n            \n            // Try through controls\n            if (game.controls && game.controls.weaponSystem) {\n                if (typeof game.controls.weaponSystem.setFiring === 'function') {\n                    game.controls.weaponSystem.setFiring(true);\n                } else {\n                    game.controls.weaponSystem.isWeaponActive = true;\n                }\n                \n                // Play laser sound if available\n                if (game.audio) {\n                    game.audio.playSound('laser');\n                }\n                return;\n            }\n            \n            console.error(\"No weapon system or combat system found\");\n        } catch (e) {\n            console.error(\"Error in handleFiringStart:\", e);\n        }\n    }\n    \n    handleFiringEnd() {\n        try {\n            // First try local reference to weapon system (which is actually the Combat class)\n            if (this.weaponSystem) {\n                // Attempt to use the setFiring method from the Combat class\n                if (typeof this.weaponSystem.setFiring === 'function') {\n                    this.weaponSystem.setFiring(false);\n                } else {\n                    // Fallback to the older isWeaponActive property\n                    this.weaponSystem.isWeaponActive = false;\n                }\n                \n                // Try to stop sound if available\n                const game = window.gameInstance || window.game;\n                if (game && game.audio) {\n                    game.audio.stopSound('laser');\n                }\n                return;\n            }\n            \n            // Fallback to global game reference\n            const game = window.gameInstance || window.game;\n            if (!game) {\n                console.error(\"No game reference found\");\n                return;\n            }\n            \n            // Try direct combat object on game first (preferred)\n            if (game.combat) {\n                game.combat.setFiring(false);\n                \n                // Stop laser sound if available\n                if (game.audio) {\n                    game.audio.stopSound('laser');\n                }\n                return;\n            }\n            \n            // Legacy fallbacks\n            if (game.weaponSystem) {\n                if (typeof game.weaponSystem.setFiring === 'function') {\n                    game.weaponSystem.setFiring(false);\n                } else {\n                    game.weaponSystem.isWeaponActive = false;\n                }\n                \n                // Stop laser sound if available\n                if (game.audio) {\n                    game.audio.stopSound('laser');\n                }\n                return;\n            }\n            \n            // Try through controls\n            if (game.controls && game.controls.weaponSystem) {\n                if (typeof game.controls.weaponSystem.setFiring === 'function') {\n                    game.controls.weaponSystem.setFiring(false);\n                } else {\n                    game.controls.weaponSystem.isWeaponActive = false;\n                }\n                \n                // Stop laser sound if available\n                if (game.audio) {\n                    game.audio.stopSound('laser');\n                }\n                return;\n            }\n            \n            console.error(\"No weapon system or combat system found\");\n        } catch (e) {\n            console.error(\"Error in handleFiringEnd:\", e);\n        }\n    }\n    \n    handleDocking() {\n        if (!this.dockingSystem) {\n            console.error(\"Docking system not available\");\n            return;\n        }\n        \n        console.log(\"TouchControls: Dock button pressed, attempting to dock with stargate\");\n        \n        // Call docking method\n        this.dockingSystem.dockWithStargate();\n        \n        // Hide the dock button after pressing it\n        this.hideDockButton();\n    }\n    \n    handleTargeting() {\n        if (!this.targetingSystem) {\n            console.error(\"Targeting system not available\");\n            return;\n        }\n        \n        // Toggle targeting system\n        this.targetingSystem.toggleLockOn();\n    }\n    \n    showDockButton() {\n        if (this.dockButton) {\n            // FIX: Make sure display is set before other properties\n            this.dockButton.style.display = 'flex';\n            \n            // FIX: Ensure critical styles are explicitly set\n            this.dockButton.style.zIndex = '10000'; // Very high z-index\n            this.dockButton.style.position = 'absolute';\n            this.dockButton.style.top = '50%';\n            this.dockButton.style.left = '50%';\n            \n            console.log(\"Showing dock button - near stargate\");\n            \n            // Add pulsing animation to make it more noticeable\n            if (!this.dockButton.style.animation) {\n                this.dockButton.style.animation = 'pulse 1.5s infinite';\n                \n                // Add the pulse keyframes if they don't exist\n                if (!document.getElementById('mobile-pulse-animation')) {\n                    const style = document.createElement('style');\n                    style.id = 'mobile-pulse-animation';\n                    style.textContent = `\n                        @keyframes pulse {\n                            0% { transform: translate(-50%, -50%) scale(1); }\n                            50% { transform: translate(-50%, -50%) scale(1.1); }\n                            100% { transform: translate(-50%, -50%) scale(1); }\n                        }\n                    `;\n                    document.head.appendChild(style);\n                }\n            }\n            \n            // FIX: Log dock button visibility for debugging\n            console.log(\"Dock button shown with styles:\", {\n                display: this.dockButton.style.display,\n                zIndex: this.dockButton.style.zIndex,\n                position: this.dockButton.style.position,\n                width: this.dockButton.style.width,\n                height: this.dockButton.style.height\n            });\n        }\n    }\n    \n    hideDockButton() {\n        if (this.dockButton) {\n            this.dockButton.style.display = 'none';\n        }\n    }\n    \n    hide() {\n        // Hide joystick zones\n        const leftZone = document.getElementById('leftJoystickZone');\n        const rightZone = document.getElementById('rightJoystickZone');\n        if (leftZone) leftZone.style.display = 'none';\n        if (rightZone) rightZone.style.display = 'none';\n        \n        // Hide action buttons\n        const leftActionButtons = document.getElementById('mobile-action-buttons-left');\n        const rightActionButtons = document.getElementById('mobile-action-buttons-right');\n        if (leftActionButtons) leftActionButtons.style.display = 'none';\n        if (rightActionButtons) rightActionButtons.style.display = 'none';\n        \n        // Hide dock button\n        this.hideDockButton();\n        \n        // Keep crosshair visible\n    }\n    \n    show() {\n        // Only show controls when not docked and not in intro sequence\n        if ((this.spaceship && this.spaceship.isDocked) || \n            (window.game && window.game.introSequenceActive)) {\n            console.log(\"TouchControls: Not showing controls during docked state or intro sequence\");\n            return;\n        }\n        \n        // Show joystick zones\n        const leftZone = document.getElementById('leftJoystickZone');\n        const rightZone = document.getElementById('rightJoystickZone');\n        if (leftZone) leftZone.style.display = 'block';\n        if (rightZone) rightZone.style.display = 'block';\n        \n        // Show action buttons\n        const leftActionButtons = document.getElementById('mobile-action-buttons-left');\n        const rightActionButtons = document.getElementById('mobile-action-buttons-right');\n        if (leftActionButtons) leftActionButtons.style.display = 'flex';\n        if (rightActionButtons) rightActionButtons.style.display = 'flex';\n    }\n    \n    update() {\n        // Update dock button visibility based on proximity to stargate\n        if (this.dockingSystem && this.spaceship) {\n            if (this.dockingSystem.nearStargate && !this.spaceship.isDocked) {\n                this.showDockButton();\n            } else {\n                this.hideDockButton();\n            }\n        } else {\n            // Fallback to window.game if the direct reference isn't set yet\n            const game = window.gameInstance || window.game;\n            if (game && game.controls && game.controls.dockingSystem) {\n                const dockingSystem = game.controls.dockingSystem;\n                \n                if (dockingSystem.nearStargate && !this.spaceship.isDocked) {\n                    this.showDockButton();\n                } else {\n                    this.hideDockButton();\n                }\n            }\n        }\n    }\n    \n    // Helper method to add events to buttons\n    addButtonEvents(button, startHandler, endHandler = null) {\n        if (!button) {\n            console.error(\"TouchControls: Cannot add events to null button\");\n            return;\n        }\n        \n        // For continuous actions (like firing and mining)\n        if (endHandler) {\n            // Touch events with passive: false to allow preventDefault\n            button.addEventListener('touchstart', (e) => {\n                e.preventDefault();\n                button.style.transform = 'scale(0.95) translateZ(0)';\n                startHandler();\n            }, { passive: false });\n            \n            button.addEventListener('touchend', (e) => {\n                e.preventDefault();\n                button.style.transform = 'scale(1) translateZ(0)';\n                endHandler();\n            }, { passive: false });\n            \n            // Add pointer events\n            button.addEventListener('pointerdown', (e) => {\n                e.preventDefault();\n                if (e.pointerType === 'touch') return; // Skip if touch (handled by touch events)\n                button.style.transform = 'scale(0.95) translateZ(0)';\n                startHandler();\n            });\n            \n            button.addEventListener('pointerup', (e) => {\n                e.preventDefault();\n                if (e.pointerType === 'touch') return; // Skip if touch (handled by touch events)\n                button.style.transform = 'scale(1) translateZ(0)';\n                endHandler();\n            });\n            \n            // Keep mouse events for backward compatibility\n            button.addEventListener('mousedown', (e) => {\n                button.style.transform = 'scale(0.95) translateZ(0)';\n                startHandler();\n            });\n            \n            button.addEventListener('mouseup', (e) => {\n                button.style.transform = 'scale(1) translateZ(0)';\n                endHandler();\n            });\n        }\n        // For single actions (like targeting and docking)\n        else {\n            // Touch events\n            button.addEventListener('touchstart', (e) => {\n                e.preventDefault();\n                button.style.transform = 'scale(0.95) translateZ(0)';\n                \n                // For dock button specifically, add debug logging\n                if (button === this.dockButton) {\n                    console.log(\"Dock button touchstart event fired\");\n                }\n            }, { passive: false });\n            \n            button.addEventListener('touchend', (e) => {\n                e.preventDefault();\n                button.style.transform = 'scale(1) translateZ(0)';\n                \n                // For dock button specifically, add debug logging\n                if (button === this.dockButton) {\n                    console.log(\"Dock button touchend event fired, calling handler\");\n                }\n                \n                startHandler();\n            }, { passive: false });\n            \n            // Add pointer events\n            button.addEventListener('pointerdown', (e) => {\n                e.preventDefault();\n                if (e.pointerType === 'touch') return; // Skip if touch (handled by touch events)\n                button.style.transform = 'scale(0.95) translateZ(0)';\n                \n                // For dock button specifically, add debug logging\n                if (button === this.dockButton) {\n                    console.log(\"Dock button pointerdown event fired\");\n                }\n            });\n            \n            button.addEventListener('pointerup', (e) => {\n                e.preventDefault();\n                if (e.pointerType === 'touch') return; // Skip if touch (handled by touch events)\n                button.style.transform = 'scale(1) translateZ(0)';\n                \n                // For dock button specifically, add debug logging\n                if (button === this.dockButton) {\n                    console.log(\"Dock button pointerup event fired, calling handler\");\n                }\n                \n                startHandler();\n            });\n            \n            // Keep mouse events for backward compatibility\n            button.addEventListener('mousedown', (e) => {\n                button.style.transform = 'scale(0.95) translateZ(0)';\n            });\n            \n            button.addEventListener('mouseup', (e) => {\n                button.style.transform = 'scale(1) translateZ(0)';\n                startHandler();\n            });\n        }\n    }\n    \n    /**\n     * Handle deploying a laser turret\n     */\n    handleDeployLaser() {\n        console.log(\"TouchControls: Deploying laser turret\");\n        \n        // Publish deploy laser event\n        if (window.mainMessageBus) {\n            window.mainMessageBus.publish('input.deployLaser', {});\n        }\n    }\n} ","/**\n * mobileDetector.js - Utility for detecting mobile devices and touch capabilities\n */\n\nexport class MobileDetector {\n    /**\n     * Check if the current device is a mobile device\n     * @returns {boolean} True if the device is mobile\n     */\n    static isMobile() {\n        // Store result in cache to avoid recalculation\n        if (this._isMobileCache !== undefined) {\n            return this._isMobileCache;\n        }\n        \n        // Check for mobile user agent\n        const userAgentCheck = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|Mobile|Tablet|Android|iP(ad|hone|od)/i.test(navigator.userAgent);\n        \n        // Check for touch capabilities - more comprehensive check\n        const touchCheck = (\n            'ontouchstart' in window || \n            navigator.maxTouchPoints > 0 || \n            navigator.msMaxTouchPoints > 0 ||\n            (window.DocumentTouch && document instanceof DocumentTouch)\n        );\n        \n        // Check screen width and orientation\n        const screenCheck = window.innerWidth < 900; // More generous width threshold\n        \n        // Check if viewport meta tag has mobile-optimized settings\n        const viewportCheck = (() => {\n            const viewport = document.querySelector('meta[name=viewport]');\n            if (viewport) {\n                return viewport.content.includes('width=device-width');\n            }\n            return false;\n        })();\n        \n        // Check for specific mobile browser features\n        const mobileFeatureCheck = 'orientation' in window || 'onorientationchange' in window;\n        \n        // Check if device motion/orientation events are supported (typically mobile)\n        const motionCheck = 'DeviceMotionEvent' in window || 'DeviceOrientationEvent' in window;\n        \n        // Improve detection of tablets - they are also considered mobile for our purposes\n        const isTablet = (() => {\n            // iPads now report as desktop in newer iOS, so we need specific checks\n            const isIpad = navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1;\n            // Android tablets often have larger screens\n            const isAndroidTablet = /android/i.test(navigator.userAgent) && !/mobile/i.test(navigator.userAgent);\n            \n            return isIpad || isAndroidTablet;\n        })();\n        \n        // More comprehensive detection logic - a device is mobile if:\n        // 1. It matches mobile user agent patterns, OR\n        // 2. It has touch capabilities AND either:\n        //    a. Has a small-to-medium screen size, OR\n        //    b. Has mobile browser features, OR\n        //    c. Supports device motion/orientation, OR\n        //    d. Is detected as a tablet\n        this._isMobileCache = userAgentCheck || \n            (touchCheck && (screenCheck || mobileFeatureCheck || motionCheck || viewportCheck || isTablet));\n        \n        console.log(`MobileDetector: Device detected as ${this._isMobileCache ? 'mobile' : 'desktop'}`);\n        console.log(`- UA: ${userAgentCheck}, touch: ${touchCheck}, screen: ${screenCheck}`);\n        console.log(`- features: ${mobileFeatureCheck}, motion: ${motionCheck}, tablet: ${isTablet}`);\n        \n        return this._isMobileCache;\n    }\n    \n    /**\n     * Reset the mobile detection cache (useful after device orientation changes)\n     */\n    static resetCache() {\n        this._isMobileCache = undefined;\n    }\n    \n    /**\n     * Check if the device supports touch events\n     * @returns {boolean} True if touch is supported\n     */\n    static hasTouch() {\n        return ('ontouchstart' in window) || \n               (navigator.maxTouchPoints > 0) || \n               (navigator.msMaxTouchPoints > 0) ||\n               (window.DocumentTouch && document instanceof DocumentTouch);\n    }\n    \n    /**\n     * Get device orientation\n     * @returns {string} 'portrait' or 'landscape'\n     */\n    static getOrientation() {\n        return window.innerHeight > window.innerWidth ? 'portrait' : 'landscape';\n    }\n    \n    /**\n     * Add handler for orientation changes\n     * @param {Function} handler Function to call when orientation changes\n     */\n    static addOrientationChangeHandler(handler) {\n        // Track previous orientation\n        let prevOrientation = this.getOrientation();\n        \n        // Use both resize and orientationchange for better compatibility\n        const checkOrientation = () => {\n            const currentOrientation = this.getOrientation();\n            if (currentOrientation !== prevOrientation) {\n                prevOrientation = currentOrientation;\n                // Reset mobile detection cache\n                this.resetCache();\n                // Call handler with new orientation\n                handler(currentOrientation);\n            }\n        };\n        \n        window.addEventListener('resize', checkOrientation);\n        \n        // Add orientationchange listener if available\n        if ('onorientationchange' in window) {\n            window.addEventListener('orientationchange', checkOrientation);\n        }\n    }\n} ","// controls.js - Main controls module that integrates all control components\n\nimport { InputHandler } from './controls/inputHandler.js';\nimport { MiningSystem } from './controls/miningSystem.js';\nimport { TargetingSystem } from './controls/targetingSystem.js';\nimport { DockingSystem } from './controls/dockingSystem.js';\nimport { TouchControls } from './controls/touchControls.js';\nimport { MobileDetector } from '../utils/mobileDetector.js';\n\nexport class Controls {\n    constructor(spaceship, physics, environment, ui) {\n        console.log(\"Initializing controls systems...\");\n        \n        this.spaceship = spaceship;\n        this.physics = physics;\n        this.environment = environment;\n        this.ui = ui;\n        this.isMobile = MobileDetector.isMobile();\n        this._wasDocked = spaceship ? spaceship.isDocked : false;\n        this.weaponSystem = null; // Initialize weaponSystem reference\n        \n        // Set scene reference for components that need it\n        this.scene = physics.scene;\n        \n        // Initialize controls components\n        if (!this.isMobile) {\n            console.log(\"Initializing keyboard/mouse controls\");\n            this.inputHandler = new InputHandler(spaceship, physics);\n        } else {\n            console.log(\"Initializing touch controls for mobile\");\n            this.touchControls = new TouchControls(spaceship, physics);\n            // Create a placeholder input handler with minimal functionality\n            // This prevents errors where other systems expect inputHandler to exist\n            this.inputHandler = {\n                isLocked: () => false,\n                exitPointerLock: () => {}\n            };\n        }\n        \n        this.miningSystem = new MiningSystem(spaceship, this.scene);\n        this.targetingSystem = new TargetingSystem(spaceship, this.scene, environment);\n        \n        // Initialize docking system with all needed references\n        this.dockingSystem = new DockingSystem(spaceship, environment.stargate, ui);\n        \n        // Share the resources reference between components\n        this.resources = this.miningSystem.resources;\n        this.dockingSystem.setResources(this.resources);\n        \n        // Initialize orb inventory\n        if (!this.resources.orbs) {\n            this.resources.orbs = {\n                common: 0,\n                uncommon: 0,\n                rare: 0,\n                epic: 0,\n                legendary: 0\n            };\n        }\n        \n        // Pass control systems to touch controls if on mobile\n        if (this.isMobile && this.touchControls) {\n            this.touchControls.setControlSystems(this);\n        }\n        \n        // Connect upgrade systems - share references for easier updates\n        this.connectUpgradeEffects();\n        \n        // Set up event handlers - different for mobile vs desktop\n        this.setupEventHandlers();\n        \n        // Initialize anomaly orb collection state\n        this.lastAnomalyCheck = 0;\n        this.currentAnomaly = null;\n        this.showingAnomalyNotification = false;\n        \n        console.log(\"Control systems initialized\");\n    }\n    \n    // New method to connect upgrade effects between systems\n    connectUpgradeEffects() {\n        // Give the docking system a way to update the mining system\n        this.dockingSystem.updateMiningSystem = () => {\n            // Update mining speeds based on spaceship's mining efficiency\n            if (this.miningSystem && this.spaceship) {\n                const efficiency = this.spaceship.miningEfficiency;\n                \n                // Update base mining speeds for each resource type\n                Object.keys(this.miningSystem.miningSpeedByType).forEach(resourceType => {\n                    // Store original base speeds if not already stored\n                    if (!this.miningSystem._originalMiningSpeedByType) {\n                        this.miningSystem._originalMiningSpeedByType = { ...this.miningSystem.miningSpeedByType };\n                    }\n                    \n                    // Apply efficiency to the original base speed\n                    const originalSpeed = this.miningSystem._originalMiningSpeedByType[resourceType];\n                    this.miningSystem.miningSpeedByType[resourceType] = originalSpeed * efficiency;\n                });\n                \n                console.log(\"Mining speeds updated with efficiency:\", efficiency);\n                \n                // Update current mining speed if mining is in progress\n                if (this.miningSystem.targetAsteroid) {\n                    this.miningSystem.setTargetAsteroid(this.miningSystem.targetAsteroid);\n                }\n            }\n        };\n    }\n    \n    setupEventHandlers() {\n        // Skip adding keyboard controls if on mobile\n        if (this.isMobile) {\n            console.log(\"Mobile device detected, touch handlers are set in TouchControls class\");\n            return;\n        }\n        \n        // Add key event handlers for targeting and mining\n        document.addEventListener('keydown', e => {\n            switch (e.key.toLowerCase()) {\n                case 'e': \n                    // Toggle targeting system (changed from 't' to 'e')\n                    this.targetingSystem.toggleLockOn();\n                    break;\n                case 'tab': \n                    // Cycle through targets if targeting is enabled\n                    if (this.targetingSystem.isLockOnEnabled()) {\n                        const target = this.targetingSystem.cycleLockOnTarget();\n                        if (target) {\n                            this.miningSystem.setTargetAsteroid(target);\n                        }\n                    }\n                    e.preventDefault(); // Prevent tab from changing focus\n                    break;\n                case 'r': // Changed from 'e' to 'r' (an unused key)\n                    // Toggle mining if targeting is enabled and we have a target\n                    if (this.targetingSystem.isLockOnEnabled()) {\n                        const target = this.targetingSystem.getCurrentTarget();\n                        if (target) {\n                            this.miningSystem.setTargetAsteroid(target);\n                            if (this.miningSystem.isMining) {\n                                this.miningSystem.stopMining();\n                            } else {\n                                this.miningSystem.startMining();\n                            }\n                        }\n                    }\n                    break;\n                case 't': \n                    // Deploy a laser turret\n                    console.log(\"Deploying laser turret\");\n                    if (window.mainMessageBus) {\n                        window.mainMessageBus.publish('input.deployLaser', {});\n                    }\n                    break;\n                case 'g': \n                    // Pick up an item\n                    console.log(\"Attempting to pick up an item\");\n                    if (window.mainMessageBus) {\n                        window.mainMessageBus.publish('input.pickupInteract', {});\n                    }\n                    break;\n            }\n        });\n        \n        // Add mouse click for mining\n        document.addEventListener('mousedown', e => {\n            if (e.button === 0 && this.inputHandler.isLocked()) { // Left mouse button\n                // Fire particle cannon\n                if (window.game && window.game.combat) {\n                    window.game.combat.setFiring(true);\n                }\n            }\n        });\n        \n        // Add mouseup to stop mining when button is released\n        document.addEventListener('mouseup', e => {\n            if (e.button === 0) { // Left mouse button\n                // Stop firing\n                if (window.game && window.game.combat) {\n                    window.game.combat.setFiring(false);\n                }\n            }\n        });\n    }\n    \n    setupStargateUIControls() {\n        if (this.dockingSystem) {\n            this.dockingSystem.setupStargateUIControls();\n        }\n    }\n    \n    // Method to dock with stargate (called from main.js on game start)\n    dockWithStargate() {\n        if (this.dockingSystem) {\n            this.dockingSystem.dockWithStargate();\n            \n            // Hide touch controls when docked\n            if (this.isMobile && this.touchControls) {\n                this.touchControls.hide();\n            }\n        } else {\n            console.error(\"Docking system not initialized\");\n        }\n    }\n    \n    // Collect energy orb from space anomaly\n    collectEnergyOrb() {\n        if (!this.environment || !this.spaceship) return;\n        \n        // Check if player is near an anomaly with an active orb\n        const anomaly = this.environment.checkAnomalyCollision(this.spaceship.mesh.position);\n        if (!anomaly) {\n            return; // No anomaly in range, silently return\n        }\n        \n        // Try to collect the orb\n        const orbData = this.environment.collectAnomalyOrb(anomaly);\n        if (!orbData) {\n            // Orb already collected, notification handled in checkForAnomalyOrbs\n            return;\n        }\n        \n        // Initialize orbs inventory if needed\n        if (!this.resources.orbs) {\n            this.resources.orbs = {\n                common: 0,\n                uncommon: 0,\n                rare: 0,\n                epic: 0,\n                legendary: 0\n            };\n        }\n        \n        // Add orb to inventory\n        this.resources.orbs[orbData.rarity]++;\n        \n        // Show notification with value and rarity\n        let rarityColor;\n        switch(orbData.rarity) {\n            case 'legendary':\n                rarityColor = \"#ff0000\"; // Red\n                break;\n            case 'epic':\n                rarityColor = \"#ff6600\"; // Orange\n                break;\n            case 'rare':\n                rarityColor = \"#9900ff\"; // Purple\n                break;\n            case 'uncommon':\n                rarityColor = \"#0066ff\"; // Blue\n                break;\n            default: // common\n                rarityColor = \"#00ff66\"; // Green\n                break;\n        }\n        \n        const capitalizedRarity = orbData.rarity.charAt(0).toUpperCase() + orbData.rarity.slice(1);\n        \n        // Show message with appropriate styling\n        this.showAnomalyMessage(\n            `Collected ${capitalizedRarity} Energy Orb (${orbData.value} CR)`,\n            rarityColor\n        );\n        \n        // Trigger collection effect\n        this.triggerOrbCollectionEffect(anomaly);\n        \n        // Play sound if audio manager is available\n        if (window.game && window.game.audio) {\n            // Play different sounds based on rarity\n            switch(orbData.rarity) {\n                case 'legendary':\n                    window.game.audio.playSoundEffect('powerup_legendary', 0.8);\n                    break;\n                case 'epic':\n                    window.game.audio.playSoundEffect('powerup_epic', 0.7);\n                    break;\n                case 'rare':\n                    window.game.audio.playSoundEffect('powerup_rare', 0.6);\n                    break;\n                case 'uncommon':\n                    window.game.audio.playSoundEffect('powerup_uncommon', 0.5);\n                    break;\n                default: // common\n                    window.game.audio.playSoundEffect('powerup_common', 0.4);\n                    break;\n            }\n        }\n    }\n    \n    // Create a visual effect when collecting an orb\n    triggerOrbCollectionEffect(anomaly) {\n        // Check if we have access to the scene and visual effects\n        if (!this.scene || !anomaly) return;\n        \n        // Create an explosion effect at the anomaly orb position\n        if (window.game && window.game.combat) {\n            const position = anomaly.position.clone();\n            \n            // Use explosion effect from combat system\n            window.game.combat.createExplosionEffect(position, 2000, true);\n            \n            // Also publish an event for additional effects\n            if (window.mainMessageBus) {\n                window.mainMessageBus.publish('vfx.explosion', {\n                    position: position,\n                    color: anomaly.orb.color,\n                    size: anomaly.orb.size * 2,\n                    duration: 2000\n                });\n            }\n        }\n    }\n    \n    // Show a notification when anomaly is found or orb is collected\n    showAnomalyMessage(message, color) {\n        if (this.showingAnomalyNotification) return; // Don't stack notifications\n        \n        this.showingAnomalyNotification = true;\n        \n        // Create notification element\n        const notification = document.createElement('div');\n        notification.style.position = 'fixed';\n        notification.style.top = '30%';\n        notification.style.left = '50%';\n        notification.style.transform = 'translate(-50%, -50%)';\n        notification.style.backgroundColor = 'rgba(0, 0, 0, 0.8)';\n        notification.style.color = color || '#ffffff';\n        notification.style.padding = '15px 30px';\n        notification.style.borderRadius = '10px';\n        notification.style.border = `2px solid ${color || '#ffffff'}`;\n        notification.style.boxShadow = `0 0 15px ${color || '#ffffff'}`;\n        notification.style.fontFamily = 'Courier New, monospace';\n        notification.style.fontSize = '18px';\n        notification.style.zIndex = '1000';\n        notification.style.textAlign = 'center';\n        notification.style.pointerEvents = 'none'; // Don't block mouse events\n        \n        // Set notification text\n        notification.textContent = message;\n        \n        // Add to DOM\n        document.body.appendChild(notification);\n        \n        // Remove after a few seconds\n        setTimeout(() => {\n            notification.style.opacity = '0';\n            notification.style.transition = 'opacity 0.8s';\n            \n            setTimeout(() => {\n                notification.remove();\n                this.showingAnomalyNotification = false;\n            }, 800);\n        }, 3000);\n    }\n    \n    /**\n     * Update control systems\n     * @param {number} deltaTime Time since last update in seconds\n     */\n    update(deltaTime = 1/60) {\n        // Skip ALL updates if intro sequence is active\n        if (window.game && window.game.introSequenceActive) {\n            return;\n        }\n        \n        // Check if docking status changed\n        if (this.spaceship) {\n            const wasDocked = this._wasDocked;\n            const isDocked = this.spaceship.isDocked;\n            \n            // If docking status changed, update touch controls visibility\n            if (this.isMobile && this.touchControls && wasDocked !== isDocked) {\n                if (isDocked) {\n                    this.touchControls.hide();\n                } else {\n                    this.touchControls.show();\n                }\n                this._wasDocked = isDocked;\n            }\n        }\n        \n        // Skip updates if docked\n        if (this.spaceship && this.spaceship.isDocked) {\n            // Only update the docking system when docked\n            if (this.dockingSystem) {\n                this.dockingSystem.update();\n            }\n            return;\n        }\n        \n        // Update all control systems\n        if (this.targetingSystem) {\n            this.targetingSystem.update();\n        }\n        \n        if (this.miningSystem) {\n            // Pass deltaTime to ensure frame-rate independent mining\n            this.miningSystem.update(deltaTime);\n            \n            // Check if mining has destroyed an asteroid\n            const destroyedAsteroid = this.miningSystem.getLastDestroyedAsteroid();\n            if (destroyedAsteroid && this.environment && this.environment.asteroidBelt) {\n                // Remove the asteroid from the environment\n                this.environment.asteroidBelt.removeAsteroid(destroyedAsteroid);\n            }\n        }\n        \n        if (this.dockingSystem) {\n            this.dockingSystem.update();\n        }\n        \n        // Update touch controls if on mobile\n        if (this.isMobile && this.touchControls) {\n            this.touchControls.update();\n        }\n        \n        if (this.deploymentSystem) {\n            this.deploymentSystem.update();\n        }\n        \n        // Check for and automatically collect anomaly orbs\n        this.checkForAnomalyOrbs();\n    }\n    \n    // Check if the player is near an anomaly orb and collect it if close enough\n    checkForAnomalyOrbs() {\n        if (!this.environment || !this.spaceship) return;\n        \n        // Limit check frequency to avoid performance impact\n        const now = performance.now();\n        if (now - this.lastAnomalyCheck < 500) return; // Check every 500ms\n        this.lastAnomalyCheck = now;\n        \n        // Check if player is within an anomaly's orb collection radius\n        const anomaly = this.environment.checkAnomalyCollision(this.spaceship.mesh.position);\n        \n        // If player is within collection radius of an anomaly with an uncollected orb\n        if (anomaly && !anomaly.orbCollected) {\n            // Automatically collect the orb\n            this.collectEnergyOrb();\n            \n            // Reset current anomaly when orb is collected\n            this.currentAnomaly = null;\n        } else if (anomaly && anomaly !== this.currentAnomaly && anomaly.orbCollected) {\n            // If player enters a depleted anomaly, show notification\n            this.currentAnomaly = anomaly;\n            this.showAnomalyMessage(\"Energy orb already collected\", \"#ff3333\");\n        } else if (!anomaly) {\n            // Reset current anomaly when player leaves the collection radius\n            this.currentAnomaly = null;\n        }\n    }\n    \n    // Getter for isMining status (used by UI)\n    get isMining() {\n        return this.miningSystem ? this.miningSystem.isMining : false;\n    }\n    \n    // Getter for mining progress (used by UI)\n    get miningProgress() {\n        return this.miningSystem ? this.miningSystem.miningProgress : 0;\n    }\n} ","// mobileHUD.js - Simplified HUD for mobile devices\n\nexport class MobileHUD {\n    constructor(spaceship) {\n        this.spaceship = spaceship;\n        this.controls = null; // Will be set from UI class\n        this.setupMobileHUD();\n    }\n    \n    setupMobileHUD() {\n        // Add CSS for animations\n        const style = document.createElement('style');\n        style.textContent = `\n            @keyframes pulse-horde-mobile {\n                0% { box-shadow: 0 0 5px rgba(255, 30, 30, 0.5); }\n                50% { box-shadow: 0 0 10px rgba(255, 30, 30, 0.8); }\n                100% { box-shadow: 0 0 5px rgba(255, 30, 30, 0.5); }\n            }\n        `;\n        document.head.appendChild(style);\n        \n        // Create main container for mobile HUD\n        const hudContainer = document.createElement('div');\n        hudContainer.id = 'mobile-hud-container';\n        hudContainer.style.position = 'absolute';\n        hudContainer.style.top = '10px';\n        hudContainer.style.right = '10px';\n        hudContainer.style.width = 'min(140px, 25vw)'; // Responsive width with minimum\n        hudContainer.style.backgroundColor = 'rgba(6, 22, 31, 0.8)';\n        hudContainer.style.backdropFilter = 'blur(5px)';\n        hudContainer.style.webkitBackdropFilter = 'blur(5px)'; // For Safari\n        hudContainer.style.borderRadius = '8px';\n        hudContainer.style.border = '1px solid rgba(120, 220, 232, 0.3)';\n        hudContainer.style.padding = '10px';\n        hudContainer.style.color = 'rgba(120, 220, 232, 0.9)';\n        hudContainer.style.fontFamily = '\"Rajdhani\", \"Electrolize\", sans-serif';\n        hudContainer.style.fontSize = '14px';\n        hudContainer.style.boxShadow = '0 0 10px rgba(120, 220, 232, 0.2)';\n        hudContainer.style.zIndex = '1000';\n        // Add hardware acceleration to improve performance\n        hudContainer.style.transform = 'translateZ(0)';\n        hudContainer.style.backfaceVisibility = 'hidden';\n        document.body.appendChild(hudContainer);\n\n        // Create status bars with labels\n        this.createStatusBar(hudContainer, 'S', 'shield-bar-mobile', 'rgba(51, 153, 255, 0.8)');\n        this.createStatusBar(hudContainer, 'H', 'hull-bar-mobile', 'rgba(120, 220, 232, 0.8)');\n        this.createStatusBar(hudContainer, 'F', 'fuel-bar-mobile', 'rgba(120, 220, 232, 0.8)');\n        \n        // Add anomaly count display\n        this.createAnomalyDisplay(hudContainer);\n        \n        // Create cargo display\n        const cargoContainer = document.createElement('div');\n        cargoContainer.style.display = 'flex';\n        cargoContainer.style.justifyContent = 'space-between';\n        cargoContainer.style.alignItems = 'center';\n        cargoContainer.style.marginTop = '10px';\n        \n        const cargoLabel = document.createElement('div');\n        cargoLabel.textContent = 'C';\n        cargoLabel.style.marginRight = '10px';\n        cargoLabel.style.fontSize = '14px';\n        \n        const cargoValue = document.createElement('div');\n        cargoValue.id = 'cargo-value-mobile';\n        cargoValue.textContent = '0 / 1000';\n        cargoValue.style.textAlign = 'right';\n        cargoValue.style.flexGrow = '1';\n        cargoValue.style.fontSize = '14px';\n        \n        cargoContainer.appendChild(cargoLabel);\n        cargoContainer.appendChild(cargoValue);\n        hudContainer.appendChild(cargoContainer);\n        \n        // Add horde mode indicator (hidden by default)\n        const hordeContainer = document.createElement('div');\n        hordeContainer.id = 'mobile-horde-indicator';\n        hordeContainer.style.display = 'none';\n        hordeContainer.style.marginTop = '10px';\n        hordeContainer.style.padding = '5px';\n        hordeContainer.style.backgroundColor = 'rgba(255, 30, 30, 0.2)';\n        hordeContainer.style.borderRadius = '4px';\n        hordeContainer.style.border = '1px solid #ff3030';\n        hordeContainer.style.animation = 'pulse-horde-mobile 2s infinite';\n        hordeContainer.style.fontSize = '12px';\n        \n        const hordeTimer = document.createElement('div');\n        hordeTimer.id = 'mobile-horde-timer';\n        hordeTimer.textContent = '00:00';\n        hordeTimer.style.textAlign = 'center';\n        hordeTimer.style.fontWeight = 'bold';\n        hordeTimer.style.color = '#ff3030';\n        \n        hordeContainer.appendChild(hordeTimer);\n        hudContainer.appendChild(hordeContainer);\n        \n        // Add decorative corner elements\n        this.addCornerElements(hudContainer);\n    }\n    \n    createStatusBar(parent, label, id, color) {\n        const container = document.createElement('div');\n        container.style.display = 'flex';\n        container.style.alignItems = 'center';\n        container.style.marginBottom = '8px';\n        \n        const labelElement = document.createElement('div');\n        labelElement.textContent = label;\n        labelElement.style.marginRight = '8px';\n        labelElement.style.width = '16px';\n        labelElement.style.textAlign = 'center';\n        labelElement.style.fontSize = '14px';\n        \n        const barContainer = document.createElement('div');\n        barContainer.style.flexGrow = '1';\n        barContainer.style.height = '8px';\n        barContainer.style.backgroundColor = 'rgba(10, 30, 40, 0.5)';\n        barContainer.style.borderRadius = '4px';\n        barContainer.style.overflow = 'hidden';\n        barContainer.style.position = 'relative';\n        \n        // Add fuel value text if this is the fuel bar\n        if (id === 'fuel-bar-mobile') {\n            const fuelValue = document.createElement('div');\n            fuelValue.id = 'fuel-value-mobile';\n            fuelValue.style.position = 'absolute';\n            fuelValue.style.right = '0';\n            fuelValue.style.top = '-14px';\n            fuelValue.style.fontSize = '10px';\n            fuelValue.style.color = 'rgba(120, 220, 232, 0.9)';\n            fuelValue.textContent = '100 / 100';\n            barContainer.appendChild(fuelValue);\n        }\n        \n        const bar = document.createElement('div');\n        bar.id = id;\n        bar.style.width = '100%';\n        bar.style.height = '100%';\n        bar.style.backgroundColor = color;\n        bar.style.transition = 'width 0.2s ease';\n        \n        barContainer.appendChild(bar);\n        container.appendChild(labelElement);\n        container.appendChild(barContainer);\n        parent.appendChild(container);\n    }\n    \n    createAnomalyDisplay(parent) {\n        const anomalyContainer = document.createElement('div');\n        anomalyContainer.style.display = 'flex';\n        anomalyContainer.style.justifyContent = 'space-between';\n        anomalyContainer.style.alignItems = 'center';\n        anomalyContainer.style.marginBottom = '8px';\n        \n        const anomalyLabel = document.createElement('div');\n        anomalyLabel.textContent = 'A';\n        anomalyLabel.style.marginRight = '8px';\n        anomalyLabel.style.width = '16px';\n        anomalyLabel.style.textAlign = 'center';\n        anomalyLabel.style.fontSize = '14px';\n        \n        const anomalyCount = document.createElement('div');\n        anomalyCount.id = 'anomaly-count-mobile';\n        anomalyCount.textContent = '0';\n        anomalyCount.style.textAlign = 'right';\n        anomalyCount.style.flexGrow = '1';\n        anomalyCount.style.fontSize = '14px';\n        anomalyCount.style.fontWeight = 'bold';\n        anomalyCount.style.color = 'rgba(120, 220, 232, 0.9)';\n        \n        anomalyContainer.appendChild(anomalyLabel);\n        anomalyContainer.appendChild(anomalyCount);\n        parent.appendChild(anomalyContainer);\n    }\n    \n    addCornerElements(panel) {\n        // Top left corner\n        const topLeft = document.createElement('div');\n        topLeft.style.position = 'absolute';\n        topLeft.style.top = '0';\n        topLeft.style.left = '0';\n        topLeft.style.width = '6px';\n        topLeft.style.height = '6px';\n        topLeft.style.borderTop = '1px solid rgba(120, 220, 232, 0.8)';\n        topLeft.style.borderLeft = '1px solid rgba(120, 220, 232, 0.8)';\n        panel.appendChild(topLeft);\n        \n        // Top right corner\n        const topRight = document.createElement('div');\n        topRight.style.position = 'absolute';\n        topRight.style.top = '0';\n        topRight.style.right = '0';\n        topRight.style.width = '6px';\n        topRight.style.height = '6px';\n        topRight.style.borderTop = '1px solid rgba(120, 220, 232, 0.8)';\n        topRight.style.borderRight = '1px solid rgba(120, 220, 232, 0.8)';\n        panel.appendChild(topRight);\n        \n        // Bottom left corner\n        const bottomLeft = document.createElement('div');\n        bottomLeft.style.position = 'absolute';\n        bottomLeft.style.bottom = '0';\n        bottomLeft.style.left = '0';\n        bottomLeft.style.width = '6px';\n        bottomLeft.style.height = '6px';\n        bottomLeft.style.borderBottom = '1px solid rgba(120, 220, 232, 0.8)';\n        bottomLeft.style.borderLeft = '1px solid rgba(120, 220, 232, 0.8)';\n        panel.appendChild(bottomLeft);\n        \n        // Bottom right corner\n        const bottomRight = document.createElement('div');\n        bottomRight.style.position = 'absolute';\n        bottomRight.style.bottom = '0';\n        bottomRight.style.right = '0';\n        bottomRight.style.width = '6px';\n        bottomRight.style.height = '6px';\n        bottomRight.style.borderBottom = '1px solid rgba(120, 220, 232, 0.8)';\n        bottomRight.style.borderRight = '1px solid rgba(120, 220, 232, 0.8)';\n        panel.appendChild(bottomRight);\n    }\n    \n    update() {\n        // Update shield display\n        this.updateShieldDisplay();\n        \n        // Update hull display\n        this.updateHullDisplay();\n        \n        // Update fuel display\n        this.updateFuelDisplay();\n        \n        // Update cargo display\n        this.updateCargoDisplay();\n        \n        // Update anomaly count\n        this.updateAnomalyCount();\n        \n        // Update horde mode display\n        this.updateHordeModeDisplay();\n    }\n    \n    updateShieldDisplay() {\n        const shieldBar = document.getElementById('shield-bar-mobile');\n        if (!shieldBar) return;\n        \n        let shieldPercentage = 100;\n        \n        // Get shield data from spaceship\n        if (this.spaceship && typeof this.spaceship.shield !== 'undefined') {\n            shieldPercentage = (this.spaceship.shield / this.spaceship.maxShield) * 100;\n        }\n        \n        // Update the shield bar\n        shieldBar.style.width = `${shieldPercentage}%`;\n        \n        // Change color based on shield status\n        if (shieldPercentage < 25) {\n            shieldBar.style.backgroundColor = 'rgba(255, 80, 80, 0.8)'; // Red for low shields\n        } else if (shieldPercentage < 50) {\n            shieldBar.style.backgroundColor = 'rgba(255, 204, 0, 0.8)'; // Yellow for medium shields\n        } else {\n            shieldBar.style.backgroundColor = 'rgba(51, 153, 255, 0.8)'; // Blue for healthy shields\n        }\n    }\n    \n    updateHullDisplay() {\n        const hullBar = document.getElementById('hull-bar-mobile');\n        if (!hullBar) return;\n        \n        let hullPercentage = 100;\n        \n        // Get hull data from spaceship\n        if (this.spaceship && typeof this.spaceship.hull !== 'undefined') {\n            hullPercentage = (this.spaceship.hull / this.spaceship.maxHull) * 100;\n        }\n        \n        // Update the hull bar\n        hullBar.style.width = `${hullPercentage}%`;\n        \n        // Change color based on hull status\n        if (hullPercentage < 30) {\n            hullBar.style.backgroundColor = 'rgba(255, 80, 80, 0.8)';\n        } else if (hullPercentage < 60) {\n            hullBar.style.backgroundColor = 'rgba(255, 204, 0, 0.8)';\n        } else {\n            hullBar.style.backgroundColor = 'rgba(120, 220, 232, 0.8)';\n        }\n    }\n    \n    updateFuelDisplay() {\n        const fuelBar = document.getElementById('fuel-bar-mobile');\n        const fuelValue = document.getElementById('fuel-value-mobile');\n        if (!fuelBar || !this.spaceship) return;\n        \n        // Correctly calculate fuel percentage based on maxFuel\n        const fuelPercent = this.spaceship.maxFuel > 0 ? \n            (this.spaceship.fuel / this.spaceship.maxFuel) * 100 : 0;\n        \n        fuelBar.style.width = `${fuelPercent}%`;\n        \n        // Change color when low based on percentage, not absolute value\n        if (fuelPercent < 20) {\n            fuelBar.style.backgroundColor = 'rgba(255, 80, 80, 0.8)';\n        } else if (fuelPercent < 40) {\n            fuelBar.style.backgroundColor = 'rgba(255, 204, 0, 0.8)';\n        } else {\n            fuelBar.style.backgroundColor = 'rgba(120, 220, 232, 0.8)';\n        }\n        \n        // Update the fuel value text display\n        if (fuelValue) {\n            fuelValue.textContent = `${Math.round(this.spaceship.fuel)} / ${Math.round(this.spaceship.maxFuel)}`;\n        }\n    }\n    \n    updateCargoDisplay() {\n        const cargoValue = document.getElementById('cargo-value-mobile');\n        if (!cargoValue) return;\n        \n        // Try to get resources from different possible sources\n        let resources = null;\n        let maxCargo = 1000; // Default max\n        \n        // First try to get from controls\n        if (this.controls && this.controls.resources) {\n            resources = this.controls.resources;\n            // Get max capacity from spaceship if available\n            if (this.spaceship && typeof this.spaceship.maxCargoCapacity !== 'undefined') {\n                maxCargo = this.spaceship.maxCargoCapacity;\n            }\n        } \n        // Fall back to cargo component if available\n        else if (this.spaceship && this.spaceship.cargoComponent && this.spaceship.cargoComponent.resources) {\n            resources = this.spaceship.cargoComponent.resources;\n            maxCargo = this.spaceship.cargoComponent.maxCapacity;\n        }\n        // Last resort - use previously defined resources structure\n        else if (this.spaceship && this.spaceship.resources) {\n            resources = this.spaceship.resources;\n        }\n        \n        // If no resources found, exit\n        if (!resources) return;\n        \n        // Calculate total cargo - ensure we're dealing with numbers\n        let totalCargo = 0;\n        \n        // Properly iterate through the resources object and sum numeric values\n        for (const key in resources) {\n            if (resources.hasOwnProperty(key)) {\n                // Get the resource amount, ensure it's a number\n                const amount = parseFloat(resources[key]) || 0;\n                totalCargo += amount;\n            }\n        }\n        \n        // Format to integer for display\n        totalCargo = Math.round(totalCargo);\n        \n        cargoValue.textContent = `${totalCargo} / ${maxCargo}`;\n        \n        // Change color when cargo is almost full\n        if (totalCargo >= maxCargo * 0.9) {\n            cargoValue.style.color = 'rgba(255, 80, 80, 0.9)';\n        } else if (totalCargo >= maxCargo * 0.7) {\n            cargoValue.style.color = 'rgba(255, 204, 0, 0.9)';\n        } else {\n            cargoValue.style.color = 'rgba(120, 220, 232, 0.9)';\n        }\n    }\n    \n    updateAnomalyCount() {\n        const anomalyCount = document.getElementById('anomaly-count-mobile');\n        if (!anomalyCount) return;\n        \n        // Get anomaly count from game object if available\n        let count = 0;\n        if (window.game && window.game.environment && window.game.environment.anomalyCount) {\n            count = window.game.environment.anomalyCount;\n        }\n        \n        // Update the anomaly counter\n        anomalyCount.textContent = count.toString();\n        \n        // Highlight if anomalies are present\n        if (count > 0) {\n            anomalyCount.style.color = 'rgba(255, 204, 0, 0.9)';\n            anomalyCount.style.textShadow = '0 0 5px rgba(255, 204, 0, 0.5)';\n        } else {\n            anomalyCount.style.color = 'rgba(120, 220, 232, 0.9)';\n            anomalyCount.style.textShadow = 'none';\n        }\n    }\n    \n    /**\n     * Update the horde mode indicator and timer in the mobile HUD\n     */\n    updateHordeModeDisplay() {\n        const hordeIndicator = document.getElementById('mobile-horde-indicator');\n        const hordeTimer = document.getElementById('mobile-horde-timer');\n        \n        if (!hordeIndicator || !hordeTimer) return;\n        \n        // Check if horde mode is active\n        if (window.game && window.game.isHordeActive) {\n            // Show the indicator if not already visible\n            if (hordeIndicator.style.display === 'none') {\n                hordeIndicator.style.display = 'block';\n                hordeIndicator.innerHTML = '<div style=\"text-align:center; color:#ff3030; font-weight:bold; margin-bottom:2px;\">HORDE MODE</div>';\n                hordeIndicator.appendChild(hordeTimer);\n            }\n            \n            // Update the timer\n            if (window.game.getFormattedHordeSurvivalTime) {\n                hordeTimer.textContent = window.game.getFormattedHordeSurvivalTime();\n            } else {\n                // Fallback calculation\n                const totalSeconds = Math.floor(window.game.hordeSurvivalTime / 1000);\n                const minutes = Math.floor(totalSeconds / 60);\n                const seconds = totalSeconds % 60;\n                hordeTimer.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;\n            }\n            \n            // Increase pulsing intensity after 3 minutes\n            if (window.game.hordeSurvivalTime > 3 * 60 * 1000) {\n                const styleEl = document.createElement('style');\n                styleEl.textContent = `\n                    @keyframes pulse-horde-mobile {\n                        0% { box-shadow: 0 0 5px rgba(255, 30, 30, 0.7); }\n                        50% { box-shadow: 0 0 10px rgba(255, 30, 30, 1); }\n                        100% { box-shadow: 0 0 5px rgba(255, 30, 30, 0.7); }\n                    }\n                `;\n                document.head.appendChild(styleEl);\n                \n                // Make animation faster\n                hordeIndicator.style.animation = 'pulse-horde-mobile 0.8s infinite';\n                hordeIndicator.style.backgroundColor = 'rgba(255, 30, 30, 0.3)';\n            }\n        } else {\n            // Hide the indicator\n            hordeIndicator.style.display = 'none';\n        }\n    }\n    \n    hide() {\n        const container = document.getElementById('mobile-hud-container');\n        if (container) {\n            container.style.display = 'none';\n        }\n    }\n    \n    show() {\n        // Check if intro sequence is active\n        if (window.game && window.game.introSequenceActive) {\n            console.log(\"MobileHUD: Not showing HUD during intro sequence\");\n            return; // Don't show during intro\n        }\n        \n        const container = document.getElementById('mobile-hud-container');\n        if (container) {\n            container.style.display = 'block';\n        }\n    }\n    \n    // Add method to set controls reference\n    setControls(controls) {\n        console.log(\"MobileHUD: Setting controls reference\");\n        this.controls = controls;\n    }\n\n    // Update to handle system name and anomaly count in a simpler way\n    updateLocation(locationName, systemName = 'Unknown System') {\n        // Since we no longer show system name, we just need to update anomaly count\n        this.updateAnomalyCount();\n    }\n} ","// miningDisplay.js - Handles the mining UI and resource display\r\n\r\nexport class MiningDisplay {\r\n    constructor() {\r\n        this.controls = null; // Will be set later\r\n        this.setupMiningDisplay();\r\n    }\r\n    \r\n    setControls(controls) {\r\n        this.controls = controls;\r\n    }\r\n    \r\n    setupMiningDisplay() {\r\n        // Create only the target info display for when targeting asteroids\r\n        const targetInfo = document.createElement('div');\r\n        targetInfo.id = 'target-info';\r\n        targetInfo.style.position = 'absolute';\r\n        targetInfo.style.bottom = '120px';\r\n        targetInfo.style.left = '50%';\r\n        targetInfo.style.transform = 'translateX(-50%)';\r\n        targetInfo.style.backgroundColor = 'rgba(0, 0, 0, 0.5)';\r\n        targetInfo.style.padding = '10px 20px';\r\n        targetInfo.style.borderRadius = '20px';\r\n        targetInfo.style.border = '1px solid #30cfd0';\r\n        targetInfo.style.boxShadow = '0 0 10px #30cfd0';\r\n        targetInfo.style.display = 'none';\r\n        targetInfo.style.textAlign = 'center';\r\n        document.body.appendChild(targetInfo);\r\n        \r\n        // Target name\r\n        const targetName = document.createElement('div');\r\n        targetName.id = 'target-name';\r\n        targetName.textContent = 'Asteroid';\r\n        targetInfo.appendChild(targetName);\r\n        \r\n        // Target distance\r\n        const targetDistance = document.createElement('div');\r\n        targetDistance.id = 'target-distance';\r\n        targetDistance.textContent = 'Distance: 0 units';\r\n        targetInfo.appendChild(targetDistance);\r\n        \r\n        // Add estimated mining time display\r\n        const miningTime = document.createElement('div');\r\n        miningTime.id = 'mining-time';\r\n        miningTime.textContent = 'Mining time: calculating...';\r\n        miningTime.style.color = '#ffcc00';\r\n        targetInfo.appendChild(miningTime);\r\n    }\r\n    \r\n    update() {\r\n        // Update the HUD resource counters in the top right with our resource values\r\n        if (this.controls && this.controls.resources) {\r\n            const ironAmount = document.getElementById('iron-amount');\r\n            const goldAmount = document.getElementById('gold-amount');\r\n            const platinumAmount = document.getElementById('platinum-amount');\r\n            const cargoCapacity = document.getElementById('cargo-capacity');\r\n            const capacityBar = document.getElementById('capacity-bar');\r\n            \r\n            if (ironAmount) ironAmount.textContent = this.controls.resources.iron || 0;\r\n            if (goldAmount) goldAmount.textContent = this.controls.resources.gold || 0;\r\n            if (platinumAmount) platinumAmount.textContent = this.controls.resources.platinum || 0;\r\n            \r\n            // Update cargo capacity\r\n            if (cargoCapacity && capacityBar && this.controls.spaceship) {\r\n                const totalResources = \r\n                    (this.controls.resources.iron || 0) + \r\n                    (this.controls.resources.gold || 0) + \r\n                    (this.controls.resources.platinum || 0);\r\n                const maxCapacity = this.controls.spaceship.maxCargoCapacity || 1000;\r\n                const capacityPercentage = (totalResources / maxCapacity) * 100;\r\n                \r\n                cargoCapacity.textContent = `${totalResources} / ${maxCapacity}`;\r\n                capacityBar.style.width = `${capacityPercentage}%`;\r\n                \r\n                // Change color when near capacity\r\n                if (capacityPercentage > 90) {\r\n                    capacityBar.style.backgroundColor = 'rgba(255, 80, 80, 0.8)';\r\n                } else if (capacityPercentage > 75) {\r\n                    capacityBar.style.backgroundColor = 'rgba(255, 204, 0, 0.8)';\r\n                } else {\r\n                    capacityBar.style.backgroundColor = 'rgba(120, 220, 232, 0.8)';\r\n                }\r\n            }\r\n            \r\n            // Update mining time estimate if targeting an asteroid\r\n            this.updateMiningTimeEstimate();\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Update the mining time estimate based on the targeted asteroid type and mining efficiency\r\n     */\r\n    updateMiningTimeEstimate() {\r\n        const miningTimeElement = document.getElementById('mining-time');\r\n        if (!miningTimeElement || !this.controls || !this.controls.miningSystem) return;\r\n        \r\n        const miningSystem = this.controls.miningSystem;\r\n        if (miningSystem.targetAsteroid && miningSystem.targetAsteroid.resourceType) {\r\n            const resourceType = miningSystem.targetAsteroid.resourceType.toLowerCase();\r\n            const efficiency = miningSystem.getMiningEfficiency();\r\n            const secondsRequired = Math.round(1 / (miningSystem.miningSpeedByType[resourceType] * efficiency));\r\n            \r\n            miningTimeElement.textContent = `Mining time: ${secondsRequired} seconds`;\r\n            miningTimeElement.style.display = 'block';\r\n            \r\n            // Color based on resource value\r\n            if (resourceType === 'platinum') {\r\n                miningTimeElement.style.color = '#66ffff';\r\n            } else if (resourceType === 'gold') {\r\n                miningTimeElement.style.color = '#ffcc00';\r\n            } else {\r\n                miningTimeElement.style.color = '#a0a0a0';\r\n            }\r\n        } else {\r\n            miningTimeElement.style.display = 'none';\r\n        }\r\n    }\r\n    \r\n    hide() {\r\n        // Hide target info\r\n        const targetInfo = document.getElementById('target-info');\r\n        if (targetInfo) {\r\n            targetInfo.style.display = 'none';\r\n        }\r\n    }\r\n    \r\n    show() {\r\n        // Show target info if needed\r\n        // In this implementation, the target info is shown directly by the targeting system\r\n    }\r\n}","// targetingUI.js - Handles the targeting UI components\r\n\r\nexport class TargetingUI {\r\n    constructor() {\r\n        this.setupTargetingUI();\r\n    }\r\n    \r\n    setupTargetingUI() {\r\n        // Create lock-on display\r\n        const lockOnDisplay = document.createElement('div');\r\n        lockOnDisplay.id = 'lock-on-display';\r\n        lockOnDisplay.style.position = 'absolute';\r\n        lockOnDisplay.style.top = '50%';\r\n        lockOnDisplay.style.left = '50%';\r\n        lockOnDisplay.style.width = '150px';\r\n        lockOnDisplay.style.height = '150px';\r\n        lockOnDisplay.style.transform = 'translate(-50%, -50%)';\r\n        lockOnDisplay.style.border = '2px dashed #ff0000';\r\n        lockOnDisplay.style.borderRadius = '50%';\r\n        lockOnDisplay.style.boxSizing = 'border-box';\r\n        lockOnDisplay.style.display = 'none';\r\n        lockOnDisplay.style.zIndex = '997';\r\n        lockOnDisplay.style.pointerEvents = 'none';\r\n        document.body.appendChild(lockOnDisplay);\r\n        \r\n        // Add diagonal lines for better targeting visual\r\n        const diagonalLines = document.createElement('div');\r\n        diagonalLines.style.position = 'absolute';\r\n        diagonalLines.style.width = '100%';\r\n        diagonalLines.style.height = '100%';\r\n        diagonalLines.style.top = '0';\r\n        diagonalLines.style.left = '0';\r\n        diagonalLines.innerHTML = `\r\n            <div style=\"position: absolute; width: 2px; height: 30px; background-color: #ff0000; top: 0; left: 50%; transform: translateX(-50%);\"></div>\r\n            <div style=\"position: absolute; width: 2px; height: 30px; background-color: #ff0000; bottom: 0; left: 50%; transform: translateX(-50%);\"></div>\r\n            <div style=\"position: absolute; width: 30px; height: 2px; background-color: #ff0000; left: 0; top: 50%; transform: translateY(-50%);\"></div>\r\n            <div style=\"position: absolute; width: 30px; height: 2px; background-color: #ff0000; right: 0; top: 50%; transform: translateY(-50%);\"></div>\r\n        `;\r\n        lockOnDisplay.appendChild(diagonalLines);\r\n        \r\n        // Create target indicator for lock-on \r\n        const targetIndicator = document.createElement('div');\r\n        targetIndicator.id = 'target-indicator';\r\n        targetIndicator.style.position = 'absolute';\r\n        targetIndicator.style.bottom = '120px';\r\n        targetIndicator.style.left = '50%';\r\n        targetIndicator.style.transform = 'translateX(-50%)';\r\n        targetIndicator.style.width = '200px';\r\n        targetIndicator.style.textAlign = 'center';\r\n        targetIndicator.style.backgroundColor = 'rgba(255, 50, 50, 0.4)';\r\n        targetIndicator.style.border = '1px solid #ff3030';\r\n        targetIndicator.style.borderRadius = '10px';\r\n        targetIndicator.style.padding = '8px';\r\n        targetIndicator.style.color = '#ffffff';\r\n        targetIndicator.style.fontFamily = 'monospace';\r\n        targetIndicator.style.zIndex = '100';\r\n        targetIndicator.style.display = 'none';\r\n        targetIndicator.style.boxShadow = '0 0 10px #ff3030';\r\n        \r\n        // Add targeting information\r\n        targetIndicator.innerHTML = `\r\n            <div style=\"font-weight: bold; margin-bottom: 5px;\">◎ TARGET LOCKED ◎</div>\r\n            <div id=\"target-type\">Asteroid</div>\r\n            <div id=\"target-distance\">Distance: 0 units</div>\r\n            <div id=\"target-resource\" style=\"color: #ffcc00;\">Resource: Unknown</div>\r\n        `;\r\n        \r\n        document.body.appendChild(targetIndicator);\r\n    }\r\n    \r\n    showLockOn() {\r\n        const lockOnDisplay = document.getElementById('lock-on-display');\r\n        if (lockOnDisplay) {\r\n            lockOnDisplay.style.display = 'block';\r\n        }\r\n    }\r\n    \r\n    hideLockOn() {\r\n        const lockOnDisplay = document.getElementById('lock-on-display');\r\n        if (lockOnDisplay) {\r\n            lockOnDisplay.style.display = 'none';\r\n        }\r\n    }\r\n    \r\n    updateTargetInfo(targetType, distance, resourceType) {\r\n        const targetIndicator = document.getElementById('target-indicator');\r\n        const targetTypeElement = document.getElementById('target-type');\r\n        const targetDistanceElement = document.getElementById('target-distance');\r\n        const targetResourceElement = document.getElementById('target-resource');\r\n        \r\n        if (targetIndicator && targetTypeElement && targetDistanceElement) {\r\n            // Show the target indicator\r\n            targetIndicator.style.display = 'block';\r\n            \r\n            // Update the target information\r\n            targetTypeElement.textContent = `${targetType}`;\r\n            targetDistanceElement.textContent = `Distance: ${Math.round(distance)} units`;\r\n            \r\n            // Set resource info with proper coloring based on type\r\n            if (targetResourceElement && resourceType) {\r\n                let resourceColor = '#cccccc'; // Default color\r\n                \r\n                // Set color based on resource type\r\n                if (resourceType.toLowerCase() === 'iron') {\r\n                    resourceColor = '#cccccc';\r\n                } else if (resourceType.toLowerCase() === 'gold') {\r\n                    resourceColor = '#ffcc00';\r\n                } else if (resourceType.toLowerCase() === 'platinum') {\r\n                    resourceColor = '#66ffff';\r\n                }\r\n                \r\n                targetResourceElement.textContent = `Resource: ${resourceType}`;\r\n                targetResourceElement.style.color = resourceColor;\r\n            }\r\n            \r\n            // Add pulse animation effect\r\n            this.addPulseEffect(targetIndicator);\r\n        }\r\n    }\r\n    \r\n    // Add a subtle pulse animation to the target indicator\r\n    addPulseEffect(element) {\r\n        // Remove any existing animation\r\n        element.style.animation = 'none';\r\n        \r\n        // Force reflow\r\n        void element.offsetWidth;\r\n        \r\n        // Add pulse animation\r\n        element.style.animation = 'targetPulse 2s infinite';\r\n        \r\n        // Add CSS keyframes if not already present\r\n        if (!document.getElementById('targeting-keyframes')) {\r\n            const style = document.createElement('style');\r\n            style.id = 'targeting-keyframes';\r\n            style.textContent = `\r\n                @keyframes targetPulse {\r\n                    0% { box-shadow: 0 0 10px #ff3030; }\r\n                    50% { box-shadow: 0 0 20px #ff3030; }\r\n                    100% { box-shadow: 0 0 10px #ff3030; }\r\n                }\r\n            `;\r\n            document.head.appendChild(style);\r\n        }\r\n    }\r\n    \r\n    hideTargetInfo() {\r\n        const targetIndicator = document.getElementById('target-indicator');\r\n        if (targetIndicator) {\r\n            targetIndicator.style.display = 'none';\r\n        }\r\n    }\r\n} ","/**\n * Utility functions for handling file paths, especially for GitHub Pages deployment\n */\n\n/**\n * Converts a relative path to an absolute path that works both locally and on GitHub Pages\n * @param {string} relativePath - The relative path to convert\n * @returns {string} - The absolute path adjusted for the current environment\n */\nexport function getAbsolutePath(relativePath) {\n    // Log for debugging\n    console.log(`Original path: ${relativePath}`);\n    \n    // For GitHub Pages or any hosted environment\n    if (window.location.hostname !== 'localhost' && window.location.hostname !== '127.0.0.1') {\n        // Get the base path from the current URL\n        const basePath = window.location.pathname.split('/').slice(0, -1).join('/');\n        \n        // Remove leading slash from relative path if it exists\n        const cleanPath = relativePath.startsWith('/') ? relativePath.substring(1) : relativePath;\n        \n        // Construct the full path\n        const fullPath = `${basePath}/${cleanPath}`;\n        \n        console.log(`Adjusted path for hosted environment: ${fullPath}`);\n        return fullPath;\n    }\n    \n    // For local development\n    console.log(`Using original path for local environment: ${relativePath}`);\n    return relativePath;\n} ","// gameOverScreen.js - Handles the game over UI\n\nimport { getAbsolutePath } from '../../utils/pathUtils.js';\n\nexport class GameOverScreen {\n    constructor() {\n        this.isVisible = false;\n        this.setupGameOverScreen();\n    }\n    \n    // Helper method to handle paths for GitHub Pages and local development\n    getPath(relativePath) {\n        return getAbsolutePath(relativePath);\n    }\n    \n    setupGameOverScreen() {\n        // Add game over container (hidden initially)\n        const gameOverContainer = document.createElement('div');\n        gameOverContainer.id = 'game-over-container';\n        gameOverContainer.style.position = 'absolute';\n        gameOverContainer.style.top = '0';\n        gameOverContainer.style.left = '0';\n        gameOverContainer.style.width = '100%';\n        gameOverContainer.style.height = '100%';\n        gameOverContainer.style.backgroundColor = 'rgba(0, 0, 0, 0.8)';\n        gameOverContainer.style.display = 'flex';\n        gameOverContainer.style.flexDirection = 'column';\n        gameOverContainer.style.alignItems = 'center';\n        gameOverContainer.style.justifyContent = 'center';\n        gameOverContainer.style.color = '#fff';\n        gameOverContainer.style.fontFamily = 'Courier New, monospace';\n        gameOverContainer.style.zIndex = '1000';\n        gameOverContainer.style.display = 'none';\n        document.body.appendChild(gameOverContainer);\n        \n        // Game over title\n        const gameOverTitle = document.createElement('h1');\n        gameOverTitle.textContent = 'GAME OVER';\n        gameOverTitle.style.fontSize = '50px';\n        gameOverTitle.style.color = '#ff0000';\n        gameOverTitle.style.textShadow = '0 0 10px #ff0000';\n        gameOverTitle.style.marginBottom = '20px';\n        gameOverContainer.appendChild(gameOverTitle);\n        \n        // Game over message\n        const gameOverMessage = document.createElement('p');\n        gameOverMessage.id = 'game-over-message';\n        gameOverMessage.textContent = 'Your ship was destroyed by asteroid collision';\n        gameOverMessage.style.fontSize = '18px';\n        gameOverMessage.style.marginBottom = '40px';\n        gameOverContainer.appendChild(gameOverMessage);\n        \n        // Restart button\n        this.setupRestartButton(gameOverContainer);\n        \n        // Resources collected summary (for game over screen)\n        const resourcesSummary = document.createElement('div');\n        resourcesSummary.id = 'resources-summary';\n        resourcesSummary.style.marginTop = '30px';\n        resourcesSummary.style.fontSize = '16px';\n        resourcesSummary.style.textAlign = 'center';\n        gameOverContainer.appendChild(resourcesSummary);\n    }\n    \n    setupRestartButton(container) {\n        const restartButton = document.createElement('button');\n        restartButton.id = 'restart-game-button';\n        restartButton.textContent = 'RESTART MISSION';\n        restartButton.style.backgroundColor = 'rgba(120, 220, 232, 0.2)';\n        restartButton.style.color = '#fff';\n        restartButton.style.border = '1px solid rgba(120, 220, 232, 0.5)';\n        restartButton.style.borderRadius = '5px';\n        restartButton.style.padding = '15px 30px';\n        restartButton.style.fontSize = '20px';\n        restartButton.style.fontFamily = '\"Rajdhani\", sans-serif';\n        restartButton.style.cursor = 'pointer';\n        restartButton.style.marginTop = '30px';\n        restartButton.style.transition = 'all 0.2s ease';\n        \n        restartButton.addEventListener('mouseover', () => {\n            restartButton.style.backgroundColor = 'rgba(120, 220, 232, 0.4)';\n            restartButton.style.boxShadow = '0 0 15px rgba(120, 220, 232, 0.5)';\n        });\n        \n        restartButton.addEventListener('mouseout', () => {\n            restartButton.style.backgroundColor = 'rgba(120, 220, 232, 0.2)';\n            restartButton.style.boxShadow = 'none';\n        });\n        \n        restartButton.addEventListener('click', () => {\n            // Play the click sound\n            if (this.audio) {\n                this.audio.playSound('uiClick');\n            }\n            \n            // Show loading status\n            const loadingStatus = document.createElement('div');\n            loadingStatus.textContent = 'Restarting mission...';\n            loadingStatus.style.color = 'rgba(120, 220, 232, 0.9)';\n            loadingStatus.style.marginTop = '10px';\n            container.appendChild(loadingStatus);\n            \n            // Disable the button during reload\n            restartButton.disabled = true;\n            restartButton.style.opacity = '0.5';\n            restartButton.style.cursor = 'default';\n            \n            // Reset game state before reloading\n            // This is critical to ensure difficulty level resets properly\n            if (window.game) {\n                // Reset time-based difficulty scaling\n                if (window.game.difficultyManager) {\n                    window.game.difficultyManager.gameTime = 0;\n                    window.game.difficultyManager.currentLevel = 1;\n                    console.log(\"Reset difficulty level to 1\");\n                }\n                \n                // Reset game time counter\n                window.game.gameTime = 0;\n            }\n            \n            // Reload the page with a small delay to allow the UI update to be seen\n            setTimeout(() => {\n                location.reload();\n            }, 500);\n        });\n        \n        container.appendChild(restartButton);\n    }\n    \n    show(resources, message) {\n        console.log(\"GameOverScreen: Showing game over screen\");\n        \n        // Show game over screen\n        const gameOverContainer = document.getElementById('game-over-container');\n        gameOverContainer.style.display = 'flex';\n        \n        // Set message based on reason\n        const gameOverMessage = document.getElementById('game-over-message');\n        if (gameOverMessage) {\n            // Default message\n            let displayMessage = 'Your journey has ended.';\n            \n            // Check if we received a reason type or just a string message\n            if (typeof message === 'object' && message.data && message.data.type) {\n                // Use the type field for more reliable message categorization\n                const reasonType = message.data.type;\n                \n                switch (reasonType) {\n                    case 'FUEL_DEPLETED':\n                        displayMessage = 'Your ship drifted into the void after running out of fuel.';\n                        break;\n                    case 'COLLISION_ASTEROID':\n                        displayMessage = 'Your ship was destroyed by an asteroid collision.';\n                        break;\n                    case 'COLLISION_PLANET':\n                        displayMessage = 'Your ship crashed into a planet!';\n                        break;\n                    case 'COMBAT_DEATH':\n                        displayMessage = 'Your ship was destroyed in combat.';\n                        break;\n                    case 'SUN_DEATH':\n                        displayMessage = \"Your ship was incinerated by the sun's heat!\";\n                        break;\n                    default:\n                        // If we have a reason string but don't recognize the type\n                        if (message.data.reason) {\n                            displayMessage = message.data.reason;\n                        }\n                }\n            } else if (message) {\n                // Fallback to string content checking for backward compatibility\n                if (message.includes(\"fuel\")) {\n                    displayMessage = 'Your ship drifted into the void after running out of fuel.';\n                } else if (message.includes(\"asteroid\")) {\n                    displayMessage = 'Your ship was destroyed by an asteroid collision.';\n                } else if (message.includes(\"combat\")) {\n                    displayMessage = 'Your ship was destroyed in combat.';\n                } else if (message.includes(\"sun\")) {\n                    displayMessage = \"Your ship was incinerated by the sun's heat!\";\n                } else if (message.includes(\"planet\")) {\n                    displayMessage = \"Your ship crashed into a planet!\";\n                } else {\n                    // Use the provided message if none of our standardized reasons match\n                    displayMessage = message;\n                }\n            }\n            \n            gameOverMessage.textContent = displayMessage;\n        }\n        \n        // Check if game was in horde mode\n        let wasHordeMode = false;\n        let hordeSurvivalTime = \"00:00\";\n        let rawSurvivalTime = 0;\n        \n        if (resources && resources.hordeMode) {\n            wasHordeMode = resources.hordeMode.active;\n            hordeSurvivalTime = resources.hordeMode.survivalTime || \"00:00\";\n            rawSurvivalTime = resources.hordeMode.rawSurvivalTime || 0;\n        }\n        \n        // Handle different resource data formats\n        // It might be wrapped in a gameStats structure or come directly\n        let resourceData = resources;\n        \n        // Check if resources has a nested resources property (from gameOver method in game.js)\n        if (resources && resources.resources) {\n            console.log(\"GameOverScreen: Using nested resources data structure\");\n            resourceData = resources.resources;\n        }\n        \n        // Ensure we have valid resource values with defaults\n        const iron = resourceData && resourceData.iron ? resourceData.iron : 0;\n        const gold = resourceData && resourceData.gold ? resourceData.gold : 0;\n        const platinum = resourceData && resourceData.platinum ? resourceData.platinum : 0;\n        \n        // Update resources summary with guaranteed safe values\n        const resourcesSummary = document.getElementById('resources-summary');\n        if (resourcesSummary) {\n            // Create horde mode section if applicable\n            if (wasHordeMode) {\n                // Get minutes for special messages\n                const minutes = Math.floor(rawSurvivalTime / 1000 / 60);\n                \n                // Determine message based on survival time\n                let hordeMessage = \"You fought valiantly against overwhelming odds.\";\n                if (minutes >= 10) {\n                    hordeMessage = \"LEGENDARY! Few have survived the horde this long!\";\n                } else if (minutes >= 5) {\n                    hordeMessage = \"IMPRESSIVE! You showed exceptional combat skills!\";\n                } else if (minutes >= 3) {\n                    hordeMessage = \"Well done! You held back the horde longer than most!\";\n                }\n                \n                resourcesSummary.innerHTML = `\n                    <div style=\"margin-bottom:20px; padding:15px; background-color:rgba(255,48,48,0.2); border:1px solid #ff3030; border-radius:5px;\">\n                        <h3 style=\"color:#ff3030; margin-top:0; text-shadow:0 0 5px rgba(255,48,48,0.5);\">HORDE MODE</h3>\n                        <p style=\"font-size:18px; font-weight:bold;\">SURVIVED: <span style=\"color:#ff9999; text-shadow:0 0 5px rgba(255,48,48,0.3);\">${hordeSurvivalTime}</span></p>\n                        <p>${hordeMessage}</p>\n                    </div>\n                    <p>Resources collected:</p>\n                    <p>IRON: ${iron} | GOLD: ${gold} | PLATINUM: ${platinum}</p>\n                `;\n            } else {\n                resourcesSummary.innerHTML = `\n                    <p>Resources collected:</p>\n                    <p>IRON: ${iron} | GOLD: ${gold} | PLATINUM: ${platinum}</p>\n                `;\n            }\n        }\n        \n        // Simpler approach to play explosion sound as a backup\n        try {\n            console.log(\"GameOverScreen: Attempting simple audio playback\");\n            \n            // Create a direct audio element without attaching to DOM\n            const boinkSound = new Audio(this.getPath('sounds/effects/boink.wav'));\n            boinkSound.volume = 0.8;\n            \n            // Play with a slight delay to avoid conflict with other sounds\n            setTimeout(() => {\n                boinkSound.play().catch(err => {\n                    console.warn(\"GameOverScreen: Simple sound failed:\", err);\n                });\n            }, 100);\n            \n        } catch (err) {\n            console.error(\"GameOverScreen: Error with simple sound approach:\", err);\n        }\n        \n        // Lock pointer to prevent camera movement after game over\n        if (document.exitPointerLock) {\n            document.exitPointerLock();\n        }\n    }\n} ","// controlsMenu.js - Handles the controls menu UI\n\nexport class ControlsMenu {\n    constructor() {\n        this.setupControlsMenu();\n    }\n    \n    setupControlsMenu() {\n        // Create controls menu\n        const controlsMenu = document.createElement('div');\n        controlsMenu.id = 'controls-menu';\n        controlsMenu.style.position = 'absolute';\n        controlsMenu.style.top = '50%';\n        controlsMenu.style.left = '50%';\n        controlsMenu.style.transform = 'translate(-50%, -50%)';\n        controlsMenu.style.backgroundColor = 'rgba(0, 0, 0, 0.8)';\n        controlsMenu.style.padding = '15px';\n        controlsMenu.style.borderRadius = '10px';\n        controlsMenu.style.border = '1px solid #30cfd0';\n        controlsMenu.style.boxShadow = '0 0 10px #30cfd0';\n        controlsMenu.style.zIndex = '1000';\n        controlsMenu.style.display = 'none';\n        document.body.appendChild(controlsMenu);\n        \n        // Controls menu header\n        const controlsTitle = document.createElement('div');\n        controlsTitle.className = 'help-title';\n        controlsTitle.innerHTML = 'CONTROLS <span id=\"close-controls\" style=\"float: right; cursor: pointer; font-weight: bold;\">X</span>';\n        controlsMenu.appendChild(controlsTitle);\n        \n        // Control rows\n        const createControlRow = (keyText, actionText) => {\n            const row = document.createElement('div');\n            row.className = 'control-row';\n            row.style.display = 'flex';\n            row.style.justifyContent = 'space-between';\n            row.style.marginBottom = '5px';\n            \n            const keySpan = document.createElement('span');\n            if (keyText !== 'Mouse') {\n                keySpan.className = 'key';\n                keySpan.style.backgroundColor = 'rgba(48, 207, 208, 0.2)';\n                keySpan.style.border = '1px solid #30cfd0';\n                keySpan.style.borderRadius = '4px';\n                keySpan.style.padding = '0 5px';\n                keySpan.style.minWidth = '20px';\n                keySpan.style.textAlign = 'center';\n            }\n            keySpan.textContent = keyText;\n            row.appendChild(keySpan);\n            \n            const actionSpan = document.createElement('span');\n            actionSpan.textContent = actionText;\n            row.appendChild(actionSpan);\n            \n            return row;\n        };\n        \n        // Add all control rows\n        controlsMenu.appendChild(createControlRow('W', 'Forward Thrust'));\n        controlsMenu.appendChild(createControlRow('S', 'Backward Thrust'));\n        controlsMenu.appendChild(createControlRow('A', 'Left Thrust'));\n        controlsMenu.appendChild(createControlRow('D', 'Right Thrust'));\n        controlsMenu.appendChild(createControlRow('SHIFT', 'Boost'));\n        controlsMenu.appendChild(createControlRow('Mouse', 'Ship Rotation'));\n        controlsMenu.appendChild(createControlRow('Click', 'Fire Particle Cannon'));\n        controlsMenu.appendChild(createControlRow('E', 'Target Lock-On'));\n        controlsMenu.appendChild(createControlRow('TAB', 'Cycle Targets'));\n        controlsMenu.appendChild(createControlRow('R', 'Toggle Mining'));\n        controlsMenu.appendChild(createControlRow('T', 'Deploy Laser Turret'));\n        controlsMenu.appendChild(createControlRow('Q', 'Dock with Stargate'));\n        \n        // Set up event listeners for the controls menu\n        document.getElementById('close-controls').addEventListener('click', () => {\n            this.hide();\n        });\n\n        // Close menu when clicking outside of it\n        document.addEventListener('click', (e) => {\n            const controlsMenu = document.getElementById('controls-menu');\n            const showControlsButton = document.getElementById('show-controls');\n            \n            if (controlsMenu.style.display === 'block' && \n                !controlsMenu.contains(e.target) && \n                e.target !== showControlsButton) {\n                this.hide();\n            }\n        });\n    }\n    \n    show() {\n        const controlsMenu = document.getElementById('controls-menu');\n        if (controlsMenu) {\n            controlsMenu.style.display = 'block';\n        }\n    }\n    \n    hide() {\n        const controlsMenu = document.getElementById('controls-menu');\n        if (controlsMenu) {\n            controlsMenu.style.display = 'none';\n        }\n    }\n    \n    setupButtonHandler() {\n        // Add click handler for the show controls button\n        const showControlsButton = document.getElementById('show-controls');\n        if (showControlsButton) {\n            showControlsButton.addEventListener('click', (e) => {\n                this.show();\n                e.stopPropagation(); // Prevent click from passing through\n            });\n        }\n    }\n} ","// starMap.js - Handles the star map UI for interstellar travel\n\nimport { MobileDetector } from '../../utils/mobileDetector.js';\n\nexport class StarMap {\n    constructor(starSystemGenerator, dockingSystem, stargateInterface) {\n        this.starSystemGenerator = starSystemGenerator;\n        this.dockingSystem = dockingSystem;\n        this.stargateInterface = stargateInterface;\n        this.isVisible = false;\n        this.selectedSystem = null;\n        this.isTraveling = false;\n        this.isMobile = MobileDetector.isMobile();\n        \n        console.log(\"StarMap constructor - isMobile:\", this.isMobile);\n        \n        // Create star map UI\n        this.setupStarMapUI();\n        \n        // Set event handlers\n        this.setupEventHandlers();\n    }\n    \n    setupStarMapUI() {\n        // Create starmap container\n        const starMap = document.createElement('div');\n        starMap.id = 'star-map';\n        starMap.style.position = 'absolute';\n        starMap.style.top = '50%';\n        starMap.style.left = '50%';\n        starMap.style.transform = 'translate(-50%, -50%)';\n        \n        // Adjust size for mobile devices\n        if (this.isMobile) {\n            starMap.style.width = '95%';\n            starMap.style.height = '85vh'; // Reduced to ensure the button is visible\n            starMap.style.maxHeight = '700px';\n        } else {\n            starMap.style.width = '900px';\n            starMap.style.height = '700px';\n        }\n        \n        starMap.style.backgroundColor = 'rgba(10, 15, 30, 0.95)';\n        starMap.style.color = '#fff';\n        starMap.style.padding = this.isMobile ? '15px' : '30px';\n        starMap.style.borderRadius = '10px';\n        starMap.style.border = '2px solid #30cfd0';\n        starMap.style.boxShadow = '0 0 30px #30cfd0';\n        starMap.style.fontFamily = 'Courier New, monospace';\n        starMap.style.zIndex = '1500';\n        starMap.style.display = 'none';\n        starMap.style.overflow = 'hidden';\n        \n        // Create title\n        const title = document.createElement('h2');\n        title.textContent = 'STAR MAP';\n        title.style.textAlign = 'center';\n        title.style.color = '#30cfd0';\n        title.style.margin = '0 0 20px 0';\n        title.style.fontSize = this.isMobile ? '24px' : '28px';\n        starMap.appendChild(title);\n        \n        // Create map content container with flexible layout\n        const content = document.createElement('div');\n        content.style.display = 'flex';\n        content.style.flexDirection = this.isMobile ? 'column' : 'row';\n        content.style.height = this.isMobile ? 'calc(100% - 120px)' : 'calc(100% - 100px)';\n        content.style.gap = this.isMobile ? '15px' : '0';\n        \n        // Left column - System Map (stars and connections)\n        const mapContainer = document.createElement('div');\n        mapContainer.id = 'star-map-visual';\n        mapContainer.style.flex = '1';\n        mapContainer.style.background = 'rgba(0, 0, 0, 0.7)';\n        mapContainer.style.borderRadius = '10px';\n        mapContainer.style.border = '1px solid #30cfd0';\n        mapContainer.style.position = 'relative';\n        mapContainer.style.overflow = 'hidden';\n        mapContainer.style.height = this.isMobile ? '40%' : '100%';\n        mapContainer.style.minHeight = this.isMobile ? '250px' : 'auto';\n        \n        // Create canvas for map visualization\n        const canvas = document.createElement('canvas');\n        canvas.id = 'star-map-canvas';\n        canvas.width = 500;\n        canvas.height = 500;\n        canvas.style.width = '100%';\n        canvas.style.height = '100%';\n        mapContainer.appendChild(canvas);\n        \n        // Right column - System Information\n        const infoPanel = document.createElement('div');\n        infoPanel.id = 'system-info-panel';\n        infoPanel.style.width = this.isMobile ? '100%' : '350px';\n        infoPanel.style.marginLeft = this.isMobile ? '0' : '20px';\n        infoPanel.style.overflowY = 'auto';\n        infoPanel.style.height = this.isMobile ? '60%' : '100%';\n        infoPanel.style.webkitOverflowScrolling = 'touch'; // For smooth scrolling on iOS\n        \n        // Current system section\n        const currentSystem = document.createElement('div');\n        currentSystem.id = 'current-system-info';\n        currentSystem.innerHTML = `\n            <h3 style=\"color: #30cfd0; margin-top: 0; font-size: ${this.isMobile ? '16px' : '18px'};\">CURRENT SYSTEM</h3>\n            <div class=\"system-card\" style=\"background: rgba(0, 0, 0, 0.7); padding: 15px; border-radius: 5px; border: 1px solid #30cfd0; margin-bottom: 20px;\">\n                <div id=\"current-system-name\" style=\"font-size: ${this.isMobile ? '16px' : '18px'}; font-weight: bold; color: #fff; margin-bottom: 5px;\">Solar System</div>\n                <div id=\"current-system-class\" style=\"font-size: ${this.isMobile ? '12px' : '14px'}; color: #aaa; margin-bottom: 10px;\">Class G - Home System</div>\n                <div id=\"current-system-resources\" style=\"margin-bottom: 10px;\">\n                    <div style=\"display: flex; justify-content: space-between; margin-bottom: 5px;\">\n                        <span>Iron:</span>\n                        <div class=\"resource-indicator\" style=\"width: 100px; height: 8px; background: #333; border-radius: 4px; overflow: hidden;\">\n                            <div id=\"current-iron-indicator\" style=\"height: 100%; width: 50%; background: #aaa;\"></div>\n                        </div>\n                    </div>\n                    <div style=\"display: flex; justify-content: space-between; margin-bottom: 5px;\">\n                        <span>Gold:</span>\n                        <div class=\"resource-indicator\" style=\"width: 100px; height: 8px; background: #333; border-radius: 4px; overflow: hidden;\">\n                            <div id=\"current-gold-indicator\" style=\"height: 100%; width: 50%; background: #FFD700;\"></div>\n                        </div>\n                    </div>\n                    <div style=\"display: flex; justify-content: space-between;\">\n                        <span>Platinum:</span>\n                        <div class=\"resource-indicator\" style=\"width: 100px; height: 8px; background: #333; border-radius: 4px; overflow: hidden;\">\n                            <div id=\"current-platinum-indicator\" style=\"height: 100%; width: 50%; background: #E5E4E2;\"></div>\n                        </div>\n                    </div>\n                </div>\n                <div id=\"current-system-description\" style=\"font-size: ${this.isMobile ? '11px' : '12px'}; color: #ccc; margin-bottom: 10px;\">\n                    Our home system, with Earth as the starting location.\n                </div>\n                <div id=\"current-system-features\" style=\"font-size: ${this.isMobile ? '11px' : '12px'}; color: #30cfd0;\">\n                    Special Features: Earth\n                </div>\n            </div>\n        `;\n        infoPanel.appendChild(currentSystem);\n        \n        // Selected system section\n        const selectedSystem = document.createElement('div');\n        selectedSystem.id = 'selected-system-info';\n        selectedSystem.innerHTML = `\n            <h3 style=\"color: #30cfd0; font-size: ${this.isMobile ? '16px' : '18px'};\">SELECTED SYSTEM</h3>\n            <div id=\"selected-system-card\" class=\"system-card\" style=\"background: rgba(0, 0, 0, 0.7); padding: 15px; border-radius: 5px; border: 1px solid #555; margin-bottom: 20px;\">\n                <div class=\"empty-selection\" style=\"color: #777; text-align: center; padding: 20px;\">\n                    No system selected.<br>\n                    ${this.isMobile ? 'Tap' : 'Click'} on a star system in the map to select it.\n                </div>\n            </div>\n            <button id=\"travel-button\" disabled style=\"width: 100%; padding: ${this.isMobile ? '15px' : '12px'}; background-color: #30cfd0; color: #000; border: none; border-radius: 5px; cursor: not-allowed; font-family: 'Courier New', monospace; font-weight: bold; font-size: ${this.isMobile ? '18px' : '16px'}; opacity: 0.5;\">\n                TRAVEL TO SYSTEM\n            </button>\n        `;\n        infoPanel.appendChild(selectedSystem);\n        \n        // Add all elements to the map\n        content.appendChild(mapContainer);\n        content.appendChild(infoPanel);\n        starMap.appendChild(content);\n        \n        // Close button\n        const closeButton = document.createElement('button');\n        closeButton.id = 'close-star-map';\n        closeButton.textContent = 'RETURN TO STARGATE';\n        closeButton.style.width = '100%';\n        closeButton.style.padding = this.isMobile ? '15px' : '12px';\n        closeButton.style.marginTop = '20px';\n        closeButton.style.backgroundColor = '#555';\n        closeButton.style.color = '#fff';\n        closeButton.style.border = 'none';\n        closeButton.style.borderRadius = '5px';\n        closeButton.style.cursor = 'pointer';\n        closeButton.style.fontFamily = 'Courier New, monospace';\n        closeButton.style.fontWeight = 'bold';\n        closeButton.style.fontSize = this.isMobile ? '18px' : '16px';\n        \n        // Make the button more prominent on mobile\n        if (this.isMobile) {\n            closeButton.style.backgroundColor = '#30cfd0';\n            closeButton.style.color = '#000';\n            closeButton.style.boxShadow = '0 0 15px rgba(48, 207, 208, 0.7)';\n        }\n        \n        starMap.appendChild(closeButton);\n        \n        // Add to DOM\n        document.body.appendChild(starMap);\n    }\n    \n    setupEventHandlers() {\n        // Close button\n        const closeButton = document.getElementById('close-star-map');\n        if (closeButton) {\n            closeButton.addEventListener('click', () => {\n                if (window.game && window.game.audio) {\n                    window.game.audio.playSound('boink');\n                }\n                this.hide();\n            });\n            \n            // Add touch event for mobile\n            if (this.isMobile) {\n                closeButton.addEventListener('touchend', (e) => {\n                    e.preventDefault();\n                    if (window.game && window.game.audio) {\n                        console.log(\"Mobile: Playing sound on star map close button\");\n                        window.game.audio.playSound('boink');\n                        // Give time for the sound to start before hiding\n                        setTimeout(() => this.hide(), 50);\n                    } else {\n                        this.hide();\n                    }\n                });\n            }\n        }\n        \n        // Canvas click/touch handler for selecting systems\n        const canvas = document.getElementById('star-map-canvas');\n        if (canvas) {\n            // Mouse events\n            canvas.addEventListener('click', (e) => {\n                this.handleMapInteraction(e);\n            });\n            \n            // Touch events for mobile\n            if (this.isMobile) {\n                canvas.addEventListener('touchend', (e) => {\n                    e.preventDefault();\n                    this.handleMapInteraction(e.changedTouches[0]);\n                });\n            }\n        }\n        \n        // Travel button\n        const travelButton = document.getElementById('travel-button');\n        if (travelButton) {\n            const travelHandler = () => {\n                if (this.selectedSystem && this.selectedSystem !== this.starSystemGenerator.currentSystem) {\n                    console.log(`Initiating travel to system: ${this.selectedSystem}`);\n                    \n                    // Set traveling flag before hiding the star map\n                    this.isTraveling = true;\n                    \n                    // Close the star map first\n                    this.hide();\n                    \n                    // Find the environment object to properly handle transition\n                    const environment = window.game.environment;\n                    if (environment && environment.travelToSystem) {\n                        const success = environment.travelToSystem(this.selectedSystem);\n                        console.log(`Travel to ${this.selectedSystem} initiated: ${success}`);\n                        \n                        // Reset traveling flag after travel is complete\n                        setTimeout(() => {\n                            this.isTraveling = false;\n                        }, 5000); // Wait for transition to complete\n                    } else {\n                        // Fallback to direct use of starSystemGenerator\n                        const success = this.starSystemGenerator.travelToSystem(this.selectedSystem);\n                        \n                        if (success) {\n                            // Update UI\n                            this.updateCurrentSystemInfo();\n                            this.updateCanvas();\n                            \n                            // Reset selection\n                            this.selectSystem(null);\n                            \n                            // Notify the user\n                            this.showTravelNotification(this.starSystemGenerator.getCurrentSystemData().name);\n                            \n                            // Reset traveling flag\n                            this.isTraveling = false;\n                        }\n                    }\n                }\n            };\n            \n            // Click event\n            travelButton.addEventListener('click', travelHandler);\n            \n            // Touch event for mobile\n            if (this.isMobile) {\n                travelButton.addEventListener('touchend', (e) => {\n                    e.preventDefault();\n                    travelHandler();\n                });\n            }\n        }\n    }\n    \n    // Handler for map interactions (click or touch)\n    handleMapInteraction(event) {\n        // Convert click/touch position to canvas coordinates\n        const canvas = document.getElementById('star-map-canvas');\n        const rect = canvas.getBoundingClientRect();\n        const x = (event.clientX - rect.left) * (canvas.width / rect.width);\n        const y = (event.clientY - rect.top) * (canvas.height / rect.height);\n        \n        // Check if a star system was clicked/tapped\n        const clickedSystem = this.findSystemAtPosition(x, y);\n        if (clickedSystem) {\n            this.selectSystem(clickedSystem);\n            this.updateCanvas(); // Redraw to show selection\n        }\n    }\n    \n    // Find which system was clicked (if any)\n    findSystemAtPosition(x, y) {\n        const systems = this.starSystemGenerator.getAllSystems();\n        const currentSystem = this.starSystemGenerator.currentSystem;\n        \n        // Define the center of the canvas\n        const centerX = 250;\n        const centerY = 250;\n        \n        // Check each system\n        for (const [systemId, system] of Object.entries(systems)) {\n            // Convert system position to canvas position\n            const canvasX = centerX + system.position.x;\n            const canvasY = centerY + system.position.y;\n            \n            // Calculate distance from click to star\n            const dx = x - canvasX;\n            const dy = y - canvasY;\n            const distance = Math.sqrt(dx * dx + dy * dy);\n            \n            // If click is within the star's radius (make current system bigger)\n            // Use larger tap area for mobile\n            const radius = systemId === currentSystem ? \n                          (this.isMobile ? 20 : 15) : \n                          (this.isMobile ? 15 : 10);\n            if (distance <= radius) {\n                return systemId;\n            }\n        }\n        \n        return null;\n    }\n    \n    // Select a system and update the UI\n    selectSystem(systemId) {\n        console.log(`Selecting system: ${systemId}`);\n        this.selectedSystem = systemId;\n        \n        if (!systemId) {\n            // Clear selection\n            const selectedCard = document.getElementById('selected-system-card');\n            if (selectedCard) {\n                selectedCard.innerHTML = `\n                    <div class=\"empty-selection\" style=\"color: #777; text-align: center; padding: 20px;\">\n                        No system selected.<br>${this.isMobile ? 'Tap' : 'Click'} on a star system in the map to select it.\n                    </div>\n                `;\n            }\n            \n            // Disable travel button\n            const travelButton = document.getElementById('travel-button');\n            if (travelButton) {\n                travelButton.disabled = true;\n                travelButton.style.cursor = 'not-allowed';\n                travelButton.style.opacity = '0.5';\n            }\n            \n            return;\n        }\n        \n        // Get system data\n        const system = this.starSystemGenerator.getAllSystems()[systemId];\n        const currentSystem = this.starSystemGenerator.currentSystem;\n        \n        // Update selected system info card\n        const selectedCard = document.getElementById('selected-system-card');\n        if (selectedCard && system) {\n            selectedCard.innerHTML = `\n                <div id=\"selected-system-name\" style=\"font-size: ${this.isMobile ? '16px' : '18px'}; font-weight: bold; color: #fff; margin-bottom: 5px;\">${system.name}</div>\n                <div id=\"selected-system-class\" style=\"font-size: ${this.isMobile ? '12px' : '14px'}; color: #aaa; margin-bottom: 10px;\">Class ${system.starClass} - ${system.classification}</div>\n                <div id=\"selected-system-resources\" style=\"margin-bottom: 10px;\">\n                    <div style=\"display: flex; justify-content: space-between; margin-bottom: 5px;\">\n                        <span>Iron:</span>\n                        <div class=\"resource-indicator\" style=\"width: 100px; height: 8px; background: #333; border-radius: 4px; overflow: hidden;\">\n                            <div style=\"height: 100%; width: ${system.resourceMultipliers.iron * 50}%; background: #aaa;\"></div>\n                        </div>\n                    </div>\n                    <div style=\"display: flex; justify-content: space-between; margin-bottom: 5px;\">\n                        <span>Gold:</span>\n                        <div class=\"resource-indicator\" style=\"width: 100px; height: 8px; background: #333; border-radius: 4px; overflow: hidden;\">\n                            <div style=\"height: 100%; width: ${system.resourceMultipliers.gold * 50}%; background: #FFD700;\"></div>\n                        </div>\n                    </div>\n                    <div style=\"display: flex; justify-content: space-between;\">\n                        <span>Platinum:</span>\n                        <div class=\"resource-indicator\" style=\"width: 100px; height: 8px; background: #333; border-radius: 4px; overflow: hidden;\">\n                            <div style=\"height: 100%; width: ${system.resourceMultipliers.platinum * 50}%; background: #E5E4E2;\"></div>\n                        </div>\n                    </div>\n                </div>\n                <div style=\"font-size: ${this.isMobile ? '11px' : '12px'}; color: #ccc; margin-bottom: 10px;\">\n                    ${system.description}\n                </div>\n                <div style=\"font-size: ${this.isMobile ? '11px' : '12px'}; color: #30cfd0;\">\n                    Special Features: ${system.specialFeatures.join(', ')}\n                </div>\n            `;\n            \n            // Scroll to make selected system info visible on mobile\n            if (this.isMobile) {\n                const infoPanel = document.getElementById('system-info-panel');\n                if (infoPanel) {\n                    infoPanel.scrollTop = selectedCard.offsetTop - infoPanel.offsetTop;\n                }\n            }\n        }\n        \n        // Enable/disable travel button\n        const travelButton = document.getElementById('travel-button');\n        if (travelButton) {\n            // Only enable if not current system and is connected to current\n            const isConnected = this.starSystemGenerator.getCurrentSystemConnections().includes(systemId);\n            const isCurrentSystem = systemId === currentSystem;\n            \n            travelButton.disabled = isCurrentSystem || !isConnected;\n            travelButton.style.cursor = isCurrentSystem || !isConnected ? 'not-allowed' : 'pointer';\n            travelButton.style.opacity = isCurrentSystem || !isConnected ? '0.5' : '1';\n            \n            // Update button text\n            travelButton.textContent = isCurrentSystem ? 'CURRENT LOCATION' : \n                                      !isConnected ? 'NO DIRECT ROUTE' : 'TRAVEL TO SYSTEM';\n        }\n    }\n    \n    // Draw the star map on the canvas\n    updateCanvas() {\n        const canvas = document.getElementById('star-map-canvas');\n        if (!canvas) return;\n        \n        const ctx = canvas.getContext('2d');\n        ctx.clearRect(0, 0, canvas.width, canvas.height);\n        \n        // Define the center of the canvas\n        const centerX = canvas.width / 2;\n        const centerY = canvas.height / 2;\n        \n        // Get systems data\n        const systems = this.starSystemGenerator.getAllSystems();\n        const currentSystem = this.starSystemGenerator.currentSystem;\n        const connections = this.starSystemGenerator.warpGates;\n        \n        // First draw connections\n        ctx.lineWidth = 1;\n        ctx.strokeStyle = 'rgba(48, 207, 208, 0.4)';\n        \n        for (const [systemId, connectedSystems] of Object.entries(connections)) {\n            const system = systems[systemId];\n            if (!system) continue;\n            \n            // Convert system position to canvas position\n            const x1 = centerX + system.position.x;\n            const y1 = centerY + system.position.y;\n            \n            for (const connectedId of connectedSystems) {\n                const connectedSystem = systems[connectedId];\n                if (!connectedSystem) continue;\n                \n                // Convert connected system position to canvas position\n                const x2 = centerX + connectedSystem.position.x;\n                const y2 = centerY + connectedSystem.position.y;\n                \n                // Draw the connection\n                ctx.beginPath();\n                ctx.moveTo(x1, y1);\n                ctx.lineTo(x2, y2);\n                ctx.stroke();\n            }\n        }\n        \n        // Highlight connections from current system\n        if (currentSystem && systems[currentSystem]) {\n            const currentSystemData = systems[currentSystem];\n            const x1 = centerX + currentSystemData.position.x;\n            const y1 = centerY + currentSystemData.position.y;\n            \n            ctx.lineWidth = this.isMobile ? 3 : 2;\n            ctx.strokeStyle = 'rgba(48, 207, 208, 0.8)';\n            \n            for (const connectedId of currentSystemData.connections) {\n                const connectedSystem = systems[connectedId];\n                if (!connectedSystem) continue;\n                \n                // Convert connected system position to canvas position\n                const x2 = centerX + connectedSystem.position.x;\n                const y2 = centerY + connectedSystem.position.y;\n                \n                // Draw the connection\n                ctx.beginPath();\n                ctx.moveTo(x1, y1);\n                ctx.lineTo(x2, y2);\n                ctx.stroke();\n            }\n        }\n        \n        // Now draw systems\n        for (const [systemId, system] of Object.entries(systems)) {\n            // Convert system position to canvas position\n            const x = centerX + system.position.x;\n            const y = centerY + system.position.y;\n            \n            // Determine if it's the current system, selected system, or regular\n            const isCurrent = systemId === currentSystem;\n            const isSelected = systemId === this.selectedSystem;\n            const isConnected = currentSystem && systems[currentSystem] && \n                                systems[currentSystem].connections.includes(systemId);\n            \n            // Draw a circle for the system\n            ctx.beginPath();\n            \n            // Size based on status and device\n            let radius;\n            if (this.isMobile) {\n                radius = isCurrent ? 18 : isSelected ? 15 : 10;\n            } else {\n                radius = isCurrent ? 15 : isSelected ? 12 : 8;\n            }\n            \n            // Fill color based on star class\n            ctx.fillStyle = system.starColor ? `#${system.starColor.toString(16).padStart(6, '0')}` : '#ffffff';\n            \n            // Add glow for current and selected\n            if (isCurrent || isSelected) {\n                ctx.shadowBlur = this.isMobile ? 20 : 15;\n                ctx.shadowColor = isCurrent ? '#30cfd0' : '#ffffff';\n            } else {\n                ctx.shadowBlur = 0;\n            }\n            \n            // Draw the star\n            ctx.arc(x, y, radius, 0, Math.PI * 2);\n            ctx.fill();\n            \n            // Reset shadow\n            ctx.shadowBlur = 0;\n            \n            // Draw border for connected systems\n            if (isConnected && !isCurrent) {\n                ctx.strokeStyle = '#30cfd0';\n                ctx.lineWidth = this.isMobile ? 3 : 2;\n                ctx.beginPath();\n                ctx.arc(x, y, radius + 3, 0, Math.PI * 2);\n                ctx.stroke();\n            }\n            \n            // Draw name label\n            ctx.fillStyle = isCurrent ? '#30cfd0' : isSelected ? '#ffffff' : '#aaaaaa';\n            ctx.font = isCurrent ? \n                      (this.isMobile ? 'bold 14px Courier New' : 'bold 12px Courier New') : \n                      (this.isMobile ? '12px Courier New' : '10px Courier New');\n            ctx.textAlign = 'center';\n            ctx.fillText(system.name, x, y + radius + (this.isMobile ? 18 : 15));\n        }\n    }\n    \n    // Show travel notification\n    showTravelNotification(systemName) {\n        // Create notification element\n        const notification = document.createElement('div');\n        notification.style.position = 'fixed';\n        notification.style.top = this.isMobile ? '30%' : '20%';\n        notification.style.left = '50%';\n        notification.style.transform = 'translate(-50%, -50%)';\n        notification.style.backgroundColor = 'rgba(0, 0, 0, 0.8)';\n        notification.style.color = '#30cfd0';\n        notification.style.padding = this.isMobile ? '15px 30px' : '20px 40px';\n        notification.style.borderRadius = '10px';\n        notification.style.border = '2px solid #30cfd0';\n        notification.style.boxShadow = '0 0 30px #30cfd0';\n        notification.style.fontFamily = 'Courier New, monospace';\n        notification.style.fontSize = this.isMobile ? '18px' : '20px';\n        notification.style.fontWeight = 'bold';\n        notification.style.zIndex = '9999';\n        notification.style.textAlign = 'center';\n        notification.textContent = `ARRIVED AT ${systemName}`;\n        \n        // Add to DOM\n        document.body.appendChild(notification);\n        \n        // Remove after a few seconds\n        setTimeout(() => {\n            notification.style.opacity = '0';\n            notification.style.transition = 'opacity 1s';\n            \n            setTimeout(() => {\n                notification.remove();\n            }, 1000);\n        }, 3000);\n    }\n    \n    // Update the current system information\n    updateCurrentSystemInfo() {\n        const system = this.starSystemGenerator.getCurrentSystemData();\n        if (!system) return;\n        \n        // Update system name and class\n        document.getElementById('current-system-name').textContent = system.name;\n        document.getElementById('current-system-class').textContent = `Class ${system.starClass} - ${system.classification}`;\n        \n        // Update resource indicators\n        document.getElementById('current-iron-indicator').style.width = `${system.resourceMultipliers.iron * 50}%`;\n        document.getElementById('current-gold-indicator').style.width = `${system.resourceMultipliers.gold * 50}%`;\n        document.getElementById('current-platinum-indicator').style.width = `${system.resourceMultipliers.platinum * 50}%`;\n        \n        // Update description and features\n        document.getElementById('current-system-description').textContent = system.description;\n        document.getElementById('current-system-features').textContent = `Special Features: ${system.specialFeatures.join(', ')}`;\n    }\n    \n    // Show the star map\n    show() {\n        // Update the map with current data\n        this.updateCurrentSystemInfo();\n        this.updateCanvas();\n        \n        // Reset selection\n        this.selectSystem(null);\n        \n        // Force audio context resumption for mobile\n        if (this.isMobile && window.game && window.game.audio) {\n            // Play a sound to kickstart the audio context\n            setTimeout(() => {\n                console.log(\"Mobile: Attempting to play initial sound in StarMap\");\n                window.game.audio.playSound('boink');\n            }, 100);\n        }\n        \n        // Show the map\n        const starMap = document.getElementById('star-map');\n        if (starMap) {\n            starMap.style.display = 'block';\n            this.isVisible = true;\n        }\n    }\n    \n    // Hide the star map\n    hide() {\n        const starMap = document.getElementById('star-map');\n        if (starMap) {\n            starMap.style.display = 'none';\n            this.isVisible = false;\n            \n            // Show the stargate UI when returning from star map\n            if (this.stargateInterface) {\n                this.stargateInterface.showStargateUI();\n            } else if (window.game && window.game.ui && window.game.ui.stargateInterface) {\n                // Try to find stargate UI via game instance if direct reference fails\n                window.game.ui.stargateInterface.showStargateUI();\n            } else {\n                // Direct DOM access as last resort\n                const stargateUI = document.getElementById('stargate-ui');\n                if (stargateUI) {\n                    stargateUI.style.display = 'block';\n                }\n            }\n        }\n    }\n    \n    // Toggle map visibility\n    toggle() {\n        if (this.isVisible) {\n            this.hide();\n        } else {\n            this.show();\n        }\n    }\n}","/**\n * Blackjack Minigame - A futuristic card game for the stargate terminal\n * \n * Features:\n * - Space-themed card designs with futuristic symbols\n * - Wager ship resources (Iron, Gold, Platinum)\n * - Play against an AI dealer with pirate personality\n * - Holographic UI with neon effects\n */\n\nimport { MobileDetector } from '../../utils/mobileDetector.js';\n\nexport class BlackjackGame {\n    constructor(scene, spaceship, audio) {\n        this.scene = scene;\n        this.spaceship = spaceship;\n        this.audio = audio;\n        this.isMobile = MobileDetector.isMobile();\n\n        console.log(\"BlackjackGame constructor - spaceship:\", this.spaceship);\n        console.log(\"BlackjackGame constructor - cargo:\", this.spaceship ? this.spaceship.cargo : null);\n        console.log(\"BlackjackGame constructor - isMobile:\", this.isMobile);\n        \n        // Game state\n        this.gameActive = false;\n        this.currentBet = {\n            resource: null,\n            amount: 0\n        };\n        this.playerHand = [];\n        this.dealerHand = [];\n        this.deck = [];\n        this.gameResult = null;\n        \n        // Card symbols\n        this.cardSymbols = {\n            spades: '♠', // Asteroid symbol\n            hearts: '♥', // Planet symbol\n            clubs: '♣', // Star symbol\n            diamonds: '♦' // Nebula symbol\n        };\n        \n        // Dealer personality phrases\n        this.dealerPhrases = {\n            win: [\n                \"Yarr! The cosmos favors ye today!\",\n                \"By the stars! Ye've bested me!\",\n                \"Void take me! Ye've got luck in yer tanks!\",\n                \"Stellar victory, spacer!\",\n                \"Blast me thrusters! Ye win this round!\"\n            ],\n            lose: [\n                \"The black hole claims another victim!\",\n                \"Better luck in the next galaxy, rookie!\",\n                \"Space is cold, and so is defeat!\",\n                \"Yarr! The dealer always wins, spacer!\",\n                \"Back to the asteroid mines with ye!\"\n            ],\n            blackjack: [\n                \"SUPERNOVA! A cosmic blackjack!\",\n                \"By the void! A perfect 21!\",\n                \"The stars aligned for ye today!\",\n                \"Quantum perfection! A blackjack!\"\n            ],\n            push: [\n                \"A cosmic stalemate, eh?\",\n                \"The universe remains in balance.\",\n                \"Neither winner nor loser in the void.\",\n                \"We split the cosmic dust this time.\"\n            ]\n        };\n        \n        // UI elements\n        this.gameUI = null;\n    }\n    \n    /**\n     * Initialize the game UI\n     */\n    init() {\n        // Create game UI if it doesn't exist\n        if (!this.gameUI) {\n            this.createGameUI();\n        }\n    }\n    \n    /**\n     * Create the game UI elements\n     */\n    createGameUI() {\n        // Create main container\n        this.gameUI = document.createElement('div');\n        this.gameUI.id = 'blackjack-game';\n        this.gameUI.style.position = 'absolute';\n        this.gameUI.style.top = '50%';\n        this.gameUI.style.left = '50%';\n        this.gameUI.style.transform = 'translate(-50%, -50%)';\n        \n        // Adjust width for mobile\n        if (this.isMobile) {\n            this.gameUI.style.width = '95%';\n            this.gameUI.style.maxWidth = '600px';\n            this.gameUI.style.height = 'auto';\n            this.gameUI.style.maxHeight = '85vh'; // Slightly reduced to ensure buttons are visible\n        } else {\n            this.gameUI.style.width = '900px';\n            this.gameUI.style.height = '650px';\n        }\n        \n        this.gameUI.style.backgroundColor = 'rgba(6, 22, 31, 0.85)';\n        this.gameUI.style.backdropFilter = 'blur(10px)';\n        this.gameUI.style.border = '2px solid #33aaff';\n        this.gameUI.style.borderRadius = '15px';\n        this.gameUI.style.boxShadow = '0 0 30px rgba(51, 170, 255, 0.5)';\n        this.gameUI.style.padding = this.isMobile ? '15px' : '25px';\n        this.gameUI.style.zIndex = '1000';\n        this.gameUI.style.display = 'none';\n        this.gameUI.style.fontFamily = 'Courier New, monospace';\n        this.gameUI.style.color = '#fff';\n        this.gameUI.style.userSelect = 'none';\n        this.gameUI.style.overflowY = this.isMobile ? 'auto' : 'hidden';\n        \n        // Add mobile scroll handling\n        if (this.isMobile) {\n            this.gameUI.style.webkitOverflowScrolling = 'touch';\n            this.gameUI.style.touchAction = 'pan-y';\n            this.gameUI.style.overscrollBehavior = 'contain';\n        }\n        \n        // Add scanline effect\n        const scanlines = document.createElement('div');\n        scanlines.style.position = 'absolute';\n        scanlines.style.top = '0';\n        scanlines.style.left = '0';\n        scanlines.style.width = '100%';\n        scanlines.style.height = '100%';\n        scanlines.style.backgroundImage = 'linear-gradient(transparent 50%, rgba(0, 0, 0, 0.1) 50%)';\n        scanlines.style.backgroundSize = '100% 4px';\n        scanlines.style.pointerEvents = 'none';\n        scanlines.style.zIndex = '1001';\n        scanlines.style.opacity = '0.15';\n        this.gameUI.appendChild(scanlines);\n        \n        // Header\n        const header = document.createElement('div');\n        header.style.textAlign = 'center';\n        header.style.marginBottom = '20px';\n        header.style.position = 'relative';\n        \n        const title = document.createElement('h2');\n        title.textContent = 'STELLAR BLACKJACK';\n        title.style.color = '#30cfd0';\n        title.style.textShadow = '0 0 10px rgba(48, 207, 208, 0.7)';\n        title.style.margin = '0 0 5px 0';\n        title.style.fontSize = this.isMobile ? '24px' : '32px';\n        header.appendChild(title);\n        \n        const subtitle = document.createElement('div');\n        subtitle.textContent = 'WAGER RESOURCES • WIN BIG • BEAT THE DEALER';\n        subtitle.style.color = 'rgba(255, 255, 255, 0.6)';\n        subtitle.style.fontSize = this.isMobile ? '12px' : '14px';\n        subtitle.style.letterSpacing = '2px';\n        header.appendChild(subtitle);\n        \n        // Close button\n        const closeBtn = document.createElement('button');\n        closeBtn.textContent = '×';\n        closeBtn.style.position = 'absolute';\n        closeBtn.style.top = '0';\n        closeBtn.style.right = '0';\n        closeBtn.style.backgroundColor = 'transparent';\n        closeBtn.style.border = 'none';\n        closeBtn.style.color = '#33aaff';\n        closeBtn.style.fontSize = '32px';\n        closeBtn.style.cursor = 'pointer';\n        closeBtn.style.outline = 'none';\n        closeBtn.style.padding = '0 10px';\n        closeBtn.style.lineHeight = '1';\n        closeBtn.onclick = () => this.hide();\n        \n        // Make close button larger and more visible for touch on mobile\n        if (this.isMobile) {\n            closeBtn.style.fontSize = '42px';\n            closeBtn.style.padding = '5px 15px';\n            closeBtn.style.backgroundColor = 'rgba(0, 0, 0, 0.3)';\n            closeBtn.style.borderRadius = '50%';\n            closeBtn.style.width = '50px';\n            closeBtn.style.height = '50px';\n            closeBtn.style.display = 'flex';\n            closeBtn.style.justifyContent = 'center';\n            closeBtn.style.alignItems = 'center';\n            closeBtn.style.boxShadow = '0 0 10px rgba(51, 170, 255, 0.5)';\n            closeBtn.style.right = '5px';\n            closeBtn.style.top = '5px';\n        }\n        \n        header.appendChild(closeBtn);\n        \n        this.gameUI.appendChild(header);\n        \n        // Game area container\n        const gameArea = document.createElement('div');\n        gameArea.style.display = 'flex';\n        gameArea.style.flexDirection = 'column';\n        gameArea.style.height = this.isMobile ? 'auto' : 'calc(100% - 80px)';\n        \n        // Dealer area\n        const dealerArea = document.createElement('div');\n        dealerArea.style.flex = '1';\n        dealerArea.style.border = '1px solid rgba(51, 170, 255, 0.3)';\n        dealerArea.style.borderRadius = '8px';\n        dealerArea.style.padding = '15px';\n        dealerArea.style.marginBottom = '15px';\n        dealerArea.style.position = 'relative';\n        dealerArea.style.background = 'linear-gradient(to bottom, rgba(9, 30, 42, 0.6), rgba(9, 30, 42, 0.4))';\n        \n        // Dealer header\n        const dealerHeader = document.createElement('div');\n        dealerHeader.className = 'dealer-header';\n        dealerHeader.style.display = 'flex';\n        dealerHeader.style.justifyContent = 'space-between';\n        dealerHeader.style.marginBottom = '10px';\n        \n        const dealerTitle = document.createElement('div');\n        dealerTitle.textContent = 'DEALER';\n        dealerTitle.style.color = '#33aaff';\n        dealerTitle.style.fontWeight = 'bold';\n        dealerHeader.appendChild(dealerTitle);\n        \n        const dealerScore = document.createElement('div');\n        dealerScore.id = 'dealer-score';\n        dealerScore.textContent = '0';\n        dealerScore.style.color = '#fff';\n        dealerScore.style.fontWeight = 'bold';\n        dealerScore.style.backgroundColor = 'rgba(51, 170, 255, 0.2)';\n        dealerScore.style.padding = '0 10px';\n        dealerScore.style.borderRadius = '4px';\n        dealerHeader.appendChild(dealerScore);\n        \n        dealerArea.appendChild(dealerHeader);\n        \n        // Dealer cards container\n        const dealerCards = document.createElement('div');\n        dealerCards.id = 'dealer-cards';\n        dealerCards.style.display = 'flex';\n        dealerCards.style.gap = '15px';\n        dealerCards.style.flexWrap = 'wrap';\n        dealerCards.style.height = this.isMobile ? 'auto' : '130px';\n        dealerCards.style.minHeight = this.isMobile ? '120px' : '130px';\n        dealerArea.appendChild(dealerCards);\n        \n        // Dealer speech bubble\n        const speechBubble = document.createElement('div');\n        speechBubble.id = 'dealer-speech';\n        speechBubble.style.position = this.isMobile ? 'relative' : 'absolute';\n        speechBubble.style.bottom = this.isMobile ? 'auto' : '15px';\n        speechBubble.style.right = this.isMobile ? 'auto' : '15px';\n        speechBubble.style.marginTop = this.isMobile ? '10px' : '0';\n        speechBubble.style.backgroundColor = 'rgba(15, 40, 55, 0.9)';\n        speechBubble.style.border = '1px solid #33aaff';\n        speechBubble.style.borderRadius = '8px';\n        speechBubble.style.padding = '10px 15px';\n        speechBubble.style.maxWidth = this.isMobile ? '100%' : '300px';\n        speechBubble.style.fontStyle = 'italic';\n        speechBubble.style.color = '#fff';\n        speechBubble.style.boxShadow = '0 0 10px rgba(51, 170, 255, 0.3)';\n        speechBubble.style.display = 'none';\n        dealerArea.appendChild(speechBubble);\n        \n        gameArea.appendChild(dealerArea);\n        \n        // Middle area - Game status\n        const statusArea = document.createElement('div');\n        statusArea.style.height = '60px';\n        statusArea.style.display = 'flex';\n        statusArea.style.justifyContent = 'center';\n        statusArea.style.alignItems = 'center';\n        statusArea.style.marginBottom = '15px';\n        \n        const gameStatus = document.createElement('div');\n        gameStatus.id = 'game-status';\n        gameStatus.style.padding = '8px 20px';\n        gameStatus.style.borderRadius = '20px';\n        gameStatus.style.backgroundColor = 'rgba(51, 170, 255, 0.2)';\n        gameStatus.style.border = '1px solid rgba(51, 170, 255, 0.4)';\n        gameStatus.style.color = '#fff';\n        gameStatus.style.textAlign = 'center';\n        gameStatus.style.fontWeight = 'bold';\n        gameStatus.style.letterSpacing = '1px';\n        gameStatus.style.fontSize = this.isMobile ? '12px' : '14px';\n        gameStatus.style.width = this.isMobile ? '100%' : 'auto';\n        gameStatus.textContent = 'PLACE YOUR BET TO BEGIN';\n        statusArea.appendChild(gameStatus);\n        \n        gameArea.appendChild(statusArea);\n        \n        // Player area\n        const playerArea = document.createElement('div');\n        playerArea.style.flex = '1';\n        playerArea.style.border = '1px solid rgba(51, 170, 255, 0.3)';\n        playerArea.style.borderRadius = '8px';\n        playerArea.style.padding = '15px';\n        playerArea.style.marginBottom = '15px';\n        playerArea.style.background = 'linear-gradient(to bottom, rgba(9, 30, 42, 0.4), rgba(9, 30, 42, 0.6))';\n        \n        // Player header\n        const playerHeader = document.createElement('div');\n        playerHeader.className = 'player-header';\n        playerHeader.style.display = 'flex';\n        playerHeader.style.justifyContent = 'space-between';\n        playerHeader.style.marginBottom = '10px';\n        \n        const playerTitle = document.createElement('div');\n        playerTitle.textContent = 'YOUR HAND';\n        playerTitle.style.color = '#30cfd0';\n        playerTitle.style.fontWeight = 'bold';\n        playerHeader.appendChild(playerTitle);\n        \n        const playerScore = document.createElement('div');\n        playerScore.id = 'player-score';\n        playerScore.textContent = '0';\n        playerScore.style.color = '#fff';\n        playerScore.style.fontWeight = 'bold';\n        playerScore.style.backgroundColor = 'rgba(48, 207, 208, 0.2)';\n        playerScore.style.padding = '0 10px';\n        playerScore.style.borderRadius = '4px';\n        playerHeader.appendChild(playerScore);\n        \n        playerArea.appendChild(playerHeader);\n        \n        // Player cards container\n        const playerCards = document.createElement('div');\n        playerCards.id = 'player-cards';\n        playerCards.style.display = 'flex';\n        playerCards.style.gap = '15px';\n        playerCards.style.flexWrap = 'wrap';\n        playerCards.style.height = this.isMobile ? 'auto' : '130px';\n        playerCards.style.minHeight = this.isMobile ? '120px' : '130px';\n        playerArea.appendChild(playerCards);\n        \n        gameArea.appendChild(playerArea);\n        \n        // Controls area\n        const controlsArea = document.createElement('div');\n        controlsArea.style.display = 'flex';\n        controlsArea.style.justifyContent = 'space-between';\n        controlsArea.style.alignItems = 'center';\n        controlsArea.style.height = 'auto';\n        controlsArea.style.flexDirection = this.isMobile ? 'column' : 'row';\n        controlsArea.style.gap = this.isMobile ? '15px' : '0';\n        \n        // Betting controls\n        const bettingControls = document.createElement('div');\n        bettingControls.id = 'betting-controls';\n        bettingControls.style.display = 'flex';\n        bettingControls.style.flexDirection = 'column';\n        bettingControls.style.width = this.isMobile ? '100%' : '250px';\n        \n        const bettingTitle = document.createElement('div');\n        bettingTitle.textContent = 'PLACE YOUR BET';\n        bettingTitle.style.marginBottom = '10px';\n        bettingTitle.style.color = 'rgba(255, 255, 255, 0.8)';\n        bettingTitle.style.fontWeight = 'bold';\n        bettingControls.appendChild(bettingTitle);\n        \n        const resourceOptions = document.createElement('div');\n        resourceOptions.style.display = 'flex';\n        resourceOptions.style.gap = '10px';\n        \n        const createResourceButton = (resource, color) => {\n            const btn = document.createElement('button');\n            btn.className = 'resource-btn';\n            btn.dataset.resource = resource;\n            btn.style.flex = '1';\n            btn.style.padding = this.isMobile ? '10px 5px' : '8px 5px';\n            btn.style.backgroundColor = 'rgba(15, 40, 55, 0.8)';\n            btn.style.border = `1px solid ${color}`;\n            btn.style.borderRadius = '5px';\n            btn.style.color = '#fff';\n            btn.style.boxShadow = `0 0 10px rgba(${color.split('(')[1].split(')')[0]}, 0.3)`;\n            btn.style.cursor = 'pointer';\n            btn.style.display = 'flex';\n            btn.style.flexDirection = 'column';\n            btn.style.alignItems = 'center';\n            btn.style.transition = 'background-color 0.2s, box-shadow 0.2s';\n            \n            const resourceName = document.createElement('span');\n            resourceName.textContent = resource.toUpperCase();\n            resourceName.style.fontWeight = 'bold';\n            resourceName.style.fontSize = '12px';\n            btn.appendChild(resourceName);\n            \n            const resourceAmount = document.createElement('span');\n            resourceAmount.className = `${resource}-amount`;\n            resourceAmount.textContent = `0 UNITS`;\n            resourceAmount.style.fontSize = '10px';\n            resourceAmount.style.marginTop = '3px';\n            resourceAmount.style.opacity = '0.7';\n            btn.appendChild(resourceAmount);\n            \n            // Add event handlers for both mouse and touch\n            const addHoverEffect = () => {\n                btn.style.backgroundColor = 'rgba(25, 60, 80, 0.8)';\n                btn.style.boxShadow = `0 0 15px ${color}`;\n            };\n            \n            const removeHoverEffect = () => {\n                btn.style.backgroundColor = 'rgba(15, 40, 55, 0.8)';\n                btn.style.boxShadow = `0 0 10px rgba(${color.split('(')[1].split(')')[0]}, 0.3)`;\n            };\n            \n            // Mouse events\n            btn.addEventListener('mouseover', addHoverEffect);\n            btn.addEventListener('mouseout', removeHoverEffect);\n            \n            // Touch events\n            btn.addEventListener('touchstart', addHoverEffect, {passive: true});\n            btn.addEventListener('touchend', removeHoverEffect, {passive: true});\n            \n            // Click/tap handler\n            const clickHandler = () => {\n                if (!this.gameActive) {\n                    this.selectBetResource(resource);\n                    this.audio.playSound('boink');\n                    \n                    // Update button styling\n                    document.querySelectorAll('.resource-btn').forEach(button => {\n                        button.style.borderWidth = '1px';\n                        button.style.transform = 'scale(1)';\n                    });\n                    \n                    btn.style.borderWidth = '2px';\n                    btn.style.transform = 'scale(1.05)';\n                }\n            };\n            \n            btn.addEventListener('click', clickHandler);\n            btn.addEventListener('touchend', (e) => {\n                e.preventDefault();\n                clickHandler();\n            });\n            \n            return btn;\n        };\n        \n        resourceOptions.appendChild(createResourceButton('iron', 'rgba(150, 150, 150, 1)'));\n        resourceOptions.appendChild(createResourceButton('gold', 'rgba(255, 215, 0, 1)'));\n        resourceOptions.appendChild(createResourceButton('platinum', 'rgba(229, 228, 226, 1)'));\n        \n        bettingControls.appendChild(resourceOptions);\n        \n        // Bet amount controls\n        const betAmountControls = document.createElement('div');\n        betAmountControls.style.display = 'flex';\n        betAmountControls.style.marginTop = '10px';\n        betAmountControls.style.gap = '10px';\n        \n        const betAmountDisplay = document.createElement('div');\n        betAmountDisplay.id = 'bet-amount';\n        betAmountDisplay.textContent = '0';\n        betAmountDisplay.style.flex = '1';\n        betAmountDisplay.style.backgroundColor = 'rgba(15, 40, 55, 0.8)';\n        betAmountDisplay.style.border = '1px solid rgba(51, 170, 255, 0.5)';\n        betAmountDisplay.style.borderRadius = '5px';\n        betAmountDisplay.style.padding = '8px 10px';\n        betAmountDisplay.style.textAlign = 'center';\n        betAmountDisplay.style.fontWeight = 'bold';\n        betAmountControls.appendChild(betAmountDisplay);\n        \n        // Create a button with both mouse and touch support\n        const createControlButton = (text, handler) => {\n            const btn = document.createElement('button');\n            btn.textContent = text;\n            btn.style.width = this.isMobile ? '50px' : '40px';\n            btn.style.height = this.isMobile ? '40px' : 'auto';\n            btn.style.backgroundColor = 'rgba(15, 40, 55, 0.8)';\n            btn.style.border = '1px solid rgba(51, 170, 255, 0.5)';\n            btn.style.borderRadius = '5px';\n            btn.style.color = '#fff';\n            btn.style.cursor = 'pointer';\n            btn.style.fontSize = this.isMobile ? '20px' : '16px';\n            \n            // Hover effects\n            const addHoverEffect = () => {\n                btn.style.backgroundColor = 'rgba(25, 60, 80, 0.8)';\n                btn.style.boxShadow = '0 0 10px rgba(51, 170, 255, 0.3)';\n            };\n            \n            const removeHoverEffect = () => {\n                btn.style.backgroundColor = 'rgba(15, 40, 55, 0.8)';\n                btn.style.boxShadow = 'none';\n            };\n            \n            // Mouse events\n            btn.addEventListener('mouseover', addHoverEffect);\n            btn.addEventListener('mouseout', removeHoverEffect);\n            \n            // Touch events\n            btn.addEventListener('touchstart', addHoverEffect, {passive: true});\n            btn.addEventListener('touchend', removeHoverEffect, {passive: true});\n            \n            // Click handler\n            btn.addEventListener('click', handler);\n            \n            // Separate touch handler to prevent click delay\n            btn.addEventListener('touchend', (e) => {\n                e.preventDefault();\n                handler();\n            });\n            \n            return btn;\n        };\n        \n        const decreaseBtn = createControlButton('-', () => {\n            if (!this.gameActive && this.currentBet.resource) {\n                this.decreaseBet();\n                this.audio.playSound('boink');\n            }\n        });\n        betAmountControls.appendChild(decreaseBtn);\n        \n        const increaseBtn = createControlButton('+', () => {\n            if (!this.gameActive && this.currentBet.resource) {\n                this.increaseBet();\n                this.audio.playSound('boink');\n            }\n        });\n        betAmountControls.appendChild(increaseBtn);\n        \n        bettingControls.appendChild(betAmountControls);\n        controlsArea.appendChild(bettingControls);\n        \n        // Game actions\n        const gameActions = document.createElement('div');\n        gameActions.style.display = 'flex';\n        gameActions.style.gap = '15px';\n        gameActions.style.flexWrap = this.isMobile ? 'wrap' : 'nowrap';\n        gameActions.style.justifyContent = this.isMobile ? 'center' : 'flex-end';\n        gameActions.style.width = this.isMobile ? '100%' : 'auto';\n        \n        const actionButtons = [\n            { id: 'deal-btn', text: 'DEAL', color: '#30cfd0', handler: () => this.startGame() },\n            { id: 'hit-btn', text: 'HIT', color: '#ff9e3d', handler: () => this.hit() },\n            { id: 'stand-btn', text: 'STAND', color: '#e55c8a', handler: () => this.stand() },\n            { id: 'double-btn', text: 'DOUBLE', color: '#a281ff', handler: () => this.doubleDown() }\n        ];\n        \n        actionButtons.forEach(btn => {\n            const button = document.createElement('button');\n            button.id = btn.id;\n            button.textContent = btn.text;\n            button.style.padding = this.isMobile ? '15px 20px' : '12px 18px';\n            button.style.backgroundColor = 'rgba(15, 40, 55, 0.8)';\n            button.style.border = `2px solid ${btn.color}`;\n            button.style.borderRadius = '5px';\n            button.style.color = '#fff';\n            button.style.fontWeight = 'bold';\n            button.style.cursor = 'pointer';\n            button.style.boxShadow = `0 0 10px ${btn.color}`;\n            button.style.transition = 'all 0.2s';\n            button.style.minWidth = this.isMobile ? '80px' : 'auto';\n            button.style.flex = this.isMobile ? '1' : 'none';\n            button.disabled = true;\n            button.style.opacity = '0.5';\n            \n            // Hover/touch effects\n            const enableHoverEffects = () => {\n                if (!button.disabled) {\n                    button.style.backgroundColor = 'rgba(25, 60, 80, 0.8)';\n                    button.style.boxShadow = `0 0 15px ${btn.color}`;\n                }\n            };\n            \n            const disableHoverEffects = () => {\n                if (!button.disabled) {\n                    button.style.backgroundColor = 'rgba(15, 40, 55, 0.8)';\n                    button.style.boxShadow = `0 0 10px ${btn.color}`;\n                }\n            };\n            \n            // Mouse events\n            button.addEventListener('mouseover', enableHoverEffects);\n            button.addEventListener('mouseout', disableHoverEffects);\n            \n            // Touch events\n            button.addEventListener('touchstart', enableHoverEffects, {passive: true});\n            button.addEventListener('touchend', disableHoverEffects, {passive: true});\n            \n            // Click handler\n            button.addEventListener('click', () => {\n                if (!button.disabled) {\n                    btn.handler();\n                    this.audio.playSound('boink');\n                }\n            });\n            \n            // Touch handler to prevent delay\n            button.addEventListener('touchend', (e) => {\n                if (!button.disabled) {\n                    e.preventDefault();\n                    btn.handler();\n                    this.audio.playSound('boink');\n                }\n            });\n            \n            gameActions.appendChild(button);\n        });\n        \n        controlsArea.appendChild(gameActions);\n        gameArea.appendChild(controlsArea);\n        \n        this.gameUI.appendChild(gameArea);\n        \n        document.body.appendChild(this.gameUI);\n        \n        // Set initial button states\n        this.updateControls();\n    }\n    \n    /**\n     * Show the game UI and sync with current game resources\n     */\n    show() {\n        // Don't show during intro sequence\n        if (window.game && window.game.introSequenceActive) {\n            console.log(\"BlackjackGame: Not showing game UI during intro sequence\");\n            return;\n        }\n        \n        if (this.gameUI) {\n            this.gameUI.style.display = 'block';\n            this.reset();\n            \n            // Force audio context resumption for mobile\n            if (this.audio && this.isMobile) {\n                // Play a sound to kickstart the audio context\n                setTimeout(() => {\n                    console.log(\"Mobile: Attempting to play initial sound in BlackjackGame\");\n                    this.audio.playSound('boink');\n                }, 100);\n            }\n            \n            // Check if we need to synchronize with the game's resource system\n            if (window.game && window.game.controls && window.game.controls.resources) {\n                // Sync with the real game resources\n                console.log(\"Syncing blackjack with game resources\");\n                const gameResources = window.game.controls.resources;\n                \n                if (!this.spaceship.cargo) {\n                    this.spaceship.cargo = {};\n                }\n                \n                // Update cargo with current game resources\n                this.spaceship.cargo.iron = gameResources.iron || 0;\n                this.spaceship.cargo.gold = gameResources.gold || 0;\n                this.spaceship.cargo.platinum = gameResources.platinum || 0;\n                \n                console.log(\"Synced resources:\", this.spaceship.cargo);\n            } else {\n                console.log(\"Game resources not available, using stored values\");\n            }\n            \n            // Update display with current resources\n            this.updateResourceDisplay();\n            this.audio.playSound('boink');\n        } else {\n            this.init();\n            this.show();\n        }\n    }\n    \n    /**\n     * Hide the game UI and return to the stargate interface\n     */\n    hide() {\n        if (this.gameUI) {\n            this.gameUI.style.display = 'none';\n            this.audio.playSound('boink');\n            // Show the stargate interface when exiting blackjack\n            const stargateUI = document.getElementById('stargate-ui');\n            if (stargateUI) {\n                stargateUI.style.display = 'block';\n            }\n        }\n    }\n    \n    /**\n     * Reset the game state\n     */\n    reset() {\n        this.gameActive = false;\n        this.playerHand = [];\n        this.dealerHand = [];\n        this.currentBet = {\n            resource: null,\n            amount: 0\n        };\n        this.gameResult = null;\n        \n        // Reset UI elements\n        document.getElementById('player-cards').innerHTML = '';\n        document.getElementById('dealer-cards').innerHTML = '';\n        document.getElementById('player-score').textContent = '0';\n        document.getElementById('dealer-score').textContent = '0';\n        document.getElementById('game-status').textContent = 'PLACE YOUR BET TO BEGIN';\n        document.getElementById('dealer-speech').style.display = 'none';\n        document.getElementById('bet-amount').textContent = '0';\n        \n        // Reset resource selection\n        document.querySelectorAll('.resource-btn').forEach(btn => {\n            btn.style.borderWidth = '1px';\n            btn.style.transform = 'scale(1)';\n        });\n        \n        this.updateControls();\n    }\n    \n    /**\n     * Create a fresh deck of cards\n     */\n    createDeck() {\n        const suits = ['hearts', 'diamonds', 'clubs', 'spades'];\n        const values = ['A', '2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K'];\n        \n        this.deck = [];\n        \n        for (let suit of suits) {\n            for (let value of values) {\n                this.deck.push({\n                    suit: suit,\n                    value: value\n                });\n            }\n        }\n        \n        // Shuffle deck\n        for (let i = this.deck.length - 1; i > 0; i--) {\n            const j = Math.floor(Math.random() * (i + 1));\n            [this.deck[i], this.deck[j]] = [this.deck[j], this.deck[i]];\n        }\n    }\n    \n    /**\n     * Get the value of a card\n     * @param {Object} card - The card object\n     * @returns {number} The value of the card in Blackjack\n     */\n    getCardValue(card) {\n        if (card.value === 'A') {\n            return 11;\n        } else if (['J', 'Q', 'K'].includes(card.value)) {\n            return 10;\n        } else {\n            return parseInt(card.value);\n        }\n    }\n    \n    /**\n     * Calculate the score of a hand, adjusting for aces\n     * @param {Array} hand - Array of card objects\n     * @returns {number} The total score of the hand\n     */\n    calculateScore(hand) {\n        let score = 0;\n        let aces = 0;\n        \n        for (let card of hand) {\n            if (card.value === 'A') {\n                aces++;\n                score += 11;\n            } else if (['J', 'Q', 'K'].includes(card.value)) {\n                score += 10;\n            } else {\n                score += parseInt(card.value);\n            }\n        }\n        \n        // Adjust for aces if over 21\n        while (score > 21 && aces > 0) {\n            score -= 10;\n            aces--;\n        }\n        \n        return score;\n    }\n    \n    /**\n     * Draw a card from the deck\n     * @returns {Object} A card object\n     */\n    drawCard() {\n        if (this.deck.length === 0) {\n            this.createDeck();\n        }\n        return this.deck.pop();\n    }\n    \n    /**\n     * Create a visual card element\n     * @param {Object} card - The card object\n     * @param {boolean} faceDown - Whether the card is face down\n     * @returns {HTMLElement} The card element\n     */\n    createCardElement(card, faceDown = false) {\n        const cardEl = document.createElement('div');\n        cardEl.className = 'card';\n        \n        // Adjust card size for mobile\n        if (this.isMobile) {\n            cardEl.style.width = '70px';\n            cardEl.style.height = '105px';\n            cardEl.style.fontSize = '80%';\n        } else {\n            cardEl.style.width = '100px';\n            cardEl.style.height = '150px';\n        }\n        \n        cardEl.style.backgroundColor = faceDown ? 'rgba(9, 30, 42, 0.8)' : 'rgba(15, 35, 50, 0.9)';\n        cardEl.style.border = faceDown ? \n            '2px solid rgba(51, 170, 255, 0.3)' : \n            '2px solid rgba(51, 170, 255, 0.7)';\n        cardEl.style.borderRadius = '10px';\n        cardEl.style.boxShadow = faceDown ?\n            '0 0 5px rgba(51, 170, 255, 0.3)' :\n            '0 0 10px rgba(51, 170, 255, 0.5)';\n        cardEl.style.position = 'relative';\n        cardEl.style.display = 'flex';\n        cardEl.style.justifyContent = 'center';\n        cardEl.style.alignItems = 'center';\n        cardEl.style.overflow = 'hidden';\n        cardEl.style.transition = 'transform 0.3s ease';\n        \n        if (!faceDown) {\n            // Card value at top-left\n            const topValue = document.createElement('div');\n            topValue.style.position = 'absolute';\n            topValue.style.top = '8px';\n            topValue.style.left = '8px';\n            topValue.style.fontSize = this.isMobile ? '14px' : '20px';\n            topValue.style.fontWeight = 'bold';\n            topValue.textContent = card.value;\n            topValue.style.color = ['hearts', 'diamonds'].includes(card.suit) ? '#e55c8a' : '#30cfd0';\n            cardEl.appendChild(topValue);\n            \n            // Suit at top-right\n            const topSuit = document.createElement('div');\n            topSuit.style.position = 'absolute';\n            topSuit.style.top = '8px';\n            topSuit.style.right = '8px';\n            topSuit.style.fontSize = this.isMobile ? '12px' : '16px';\n            topSuit.textContent = this.cardSymbols[card.suit];\n            topSuit.style.color = ['hearts', 'diamonds'].includes(card.suit) ? '#e55c8a' : '#30cfd0';\n            cardEl.appendChild(topSuit);\n            \n            // Center symbol\n            const centerSymbol = document.createElement('div');\n            centerSymbol.style.fontSize = this.isMobile ? '28px' : '40px';\n            centerSymbol.style.lineHeight = '1';\n            centerSymbol.style.opacity = '0.9';\n            centerSymbol.textContent = this.cardSymbols[card.suit];\n            centerSymbol.style.color = ['hearts', 'diamonds'].includes(card.suit) ? '#e55c8a' : '#30cfd0';\n            cardEl.appendChild(centerSymbol);\n            \n            // Value at bottom-right (rotated)\n            const bottomValue = document.createElement('div');\n            bottomValue.style.position = 'absolute';\n            bottomValue.style.bottom = '8px';\n            bottomValue.style.right = '8px';\n            bottomValue.style.fontSize = this.isMobile ? '14px' : '20px';\n            bottomValue.style.fontWeight = 'bold';\n            bottomValue.style.transform = 'rotate(180deg)';\n            bottomValue.textContent = card.value;\n            bottomValue.style.color = ['hearts', 'diamonds'].includes(card.suit) ? '#e55c8a' : '#30cfd0';\n            cardEl.appendChild(bottomValue);\n            \n            // Suit at bottom-left (rotated)\n            const bottomSuit = document.createElement('div');\n            bottomSuit.style.position = 'absolute';\n            bottomSuit.style.bottom = '8px';\n            bottomSuit.style.left = '8px';\n            bottomSuit.style.fontSize = this.isMobile ? '12px' : '16px';\n            bottomSuit.style.transform = 'rotate(180deg)';\n            bottomSuit.textContent = this.cardSymbols[card.suit];\n            bottomSuit.style.color = ['hearts', 'diamonds'].includes(card.suit) ? '#e55c8a' : '#30cfd0';\n            cardEl.appendChild(bottomSuit);\n            \n            // Card background pattern\n            const pattern = document.createElement('div');\n            pattern.style.position = 'absolute';\n            pattern.style.inset = '0';\n            pattern.style.opacity = '0.05';\n            pattern.style.backgroundImage = 'radial-gradient(circle, #fff 1px, transparent 1px)';\n            pattern.style.backgroundSize = '10px 10px';\n            pattern.style.pointerEvents = 'none';\n            cardEl.appendChild(pattern);\n            \n            // Holographic effect\n            const holoEffect = document.createElement('div');\n            holoEffect.style.position = 'absolute';\n            holoEffect.style.inset = '0';\n            holoEffect.style.background = 'linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 50%, rgba(255,255,255,0.1) 100%)';\n            holoEffect.style.pointerEvents = 'none';\n            cardEl.appendChild(holoEffect);\n        } else {\n            // Back design for face-down card\n            const backDesign = document.createElement('div');\n            backDesign.style.width = '80%';\n            backDesign.style.height = '80%';\n            backDesign.style.border = '2px solid rgba(51, 170, 255, 0.4)';\n            backDesign.style.borderRadius = '5px';\n            backDesign.style.backgroundImage = 'radial-gradient(circle, rgba(51, 170, 255, 0.2) 10%, transparent 10%)';\n            backDesign.style.backgroundSize = '10px 10px';\n            cardEl.appendChild(backDesign);\n            \n            // Logo in center of back\n            const logo = document.createElement('div');\n            logo.style.position = 'absolute';\n            logo.style.fontWeight = 'bold';\n            logo.style.fontSize = this.isMobile ? '12px' : '14px';\n            logo.style.color = 'rgba(51, 170, 255, 0.7)';\n            logo.textContent = 'BJ';\n            cardEl.appendChild(logo);\n        }\n        \n        return cardEl;\n    }\n    \n    /**\n     * Select a resource for betting\n     * @param {string} resource - The resource type\n     */\n    selectBetResource(resource) {\n        this.currentBet.resource = resource;\n        this.currentBet.amount = 1;\n        document.getElementById('bet-amount').textContent = this.currentBet.amount;\n        this.updateControls();\n    }\n    \n    /**\n     * Increase the bet amount\n     */\n    increaseBet() {\n        const maxAmount = this.getMaxBet();\n        if (this.currentBet.amount < maxAmount) {\n            this.currentBet.amount++;\n            document.getElementById('bet-amount').textContent = this.currentBet.amount;\n        }\n    }\n    \n    /**\n     * Decrease the bet amount\n     */\n    decreaseBet() {\n        if (this.currentBet.amount > 1) {\n            this.currentBet.amount--;\n            document.getElementById('bet-amount').textContent = this.currentBet.amount;\n        }\n    }\n    \n    /**\n     * Get the maximum possible bet amount for the selected resource\n     * @returns {number} The maximum bet amount\n     */\n    getMaxBet() {\n        if (!this.currentBet.resource || !this.spaceship.cargo) {\n            return 0;\n        }\n        \n        return this.spaceship.cargo[this.currentBet.resource] || 0;\n    }\n    \n    /**\n     * Update the game controls based on the current state\n     */\n    updateControls() {\n        const dealBtn = document.getElementById('deal-btn');\n        const hitBtn = document.getElementById('hit-btn');\n        const standBtn = document.getElementById('stand-btn');\n        const doubleBtn = document.getElementById('double-btn');\n        \n        // Reset all buttons to disabled state\n        [dealBtn, hitBtn, standBtn, doubleBtn].forEach(btn => {\n            btn.disabled = true;\n            btn.style.opacity = '0.5';\n            btn.style.cursor = 'default';\n        });\n        \n        if (!this.gameActive) {\n            // Before game starts, only deal button may be active\n            const canDeal = this.currentBet.resource && this.currentBet.amount > 0;\n            dealBtn.disabled = !canDeal;\n            dealBtn.style.opacity = canDeal ? '1' : '0.5';\n            dealBtn.style.cursor = canDeal ? 'pointer' : 'default';\n        } else {\n            // During game, hit/stand buttons are active\n            hitBtn.disabled = false;\n            hitBtn.style.opacity = '1';\n            hitBtn.style.cursor = 'pointer';\n            \n            standBtn.disabled = false;\n            standBtn.style.opacity = '1';\n            standBtn.style.cursor = 'pointer';\n            \n            // Double down only available on first move with 2 cards\n            const canDouble = this.playerHand.length === 2 && \n                            this.currentBet.amount * 2 <= this.getMaxBet();\n            doubleBtn.disabled = !canDouble;\n            doubleBtn.style.opacity = canDouble ? '1' : '0.5';\n            doubleBtn.style.cursor = canDouble ? 'pointer' : 'default';\n        }\n    }\n    \n    /**\n     * Update the resource display\n     */\n    updateResourceDisplay() {\n        console.log(\"Updating resource display, spaceship:\", this.spaceship);\n        console.log(\"Cargo:\", this.spaceship ? this.spaceship.cargo : null);\n        \n        if (this.spaceship && this.spaceship.cargo) {\n            // Ensure cargo has all resources initialized\n            if (this.spaceship.cargo.iron === undefined) this.spaceship.cargo.iron = 0;\n            if (this.spaceship.cargo.gold === undefined) this.spaceship.cargo.gold = 0;\n            if (this.spaceship.cargo.platinum === undefined) this.spaceship.cargo.platinum = 0;\n            \n            // Update resource amounts\n            const ironElement = document.querySelector('.iron-amount');\n            if (ironElement) {\n                ironElement.textContent = `${this.spaceship.cargo.iron} UNITS`;\n            }\n            \n            const goldElement = document.querySelector('.gold-amount');\n            if (goldElement) {\n                goldElement.textContent = `${this.spaceship.cargo.gold} UNITS`;\n            }\n            \n            const platinumElement = document.querySelector('.platinum-amount');\n            if (platinumElement) {\n                platinumElement.textContent = `${this.spaceship.cargo.platinum} UNITS`;\n            }\n        } else {\n            console.error(\"Cannot update resource display: spaceship or cargo is undefined\");\n        }\n    }\n    \n    /**\n     * Start a new game\n     */\n    startGame() {\n        console.log(\"Starting game with bet:\", this.currentBet);\n        console.log(\"Spaceship:\", this.spaceship);\n        console.log(\"Cargo:\", this.spaceship ? this.spaceship.cargo : null);\n        \n        if (!this.currentBet.resource || this.currentBet.amount <= 0) {\n            console.log(\"No bet resource or amount selected\");\n            return;\n        }\n        \n        // Initialize cargo if needed\n        if (!this.spaceship) {\n            console.error(\"No spaceship object available\");\n            document.getElementById('game-status').textContent = 'ERROR: GAME DATA MISSING';\n            return;\n        }\n        \n        if (!this.spaceship.cargo) {\n            console.warn(\"Creating cargo object for spaceship\");\n            this.spaceship.cargo = { iron: 0, gold: 0, platinum: 0 };\n        }\n        \n        // Make sure the resource exists in cargo\n        if (this.spaceship.cargo[this.currentBet.resource] === undefined) {\n            this.spaceship.cargo[this.currentBet.resource] = 0;\n        }\n        \n        // Check if player has enough resources\n        if (this.spaceship.cargo[this.currentBet.resource] < this.currentBet.amount) {\n            document.getElementById('game-status').textContent = 'NOT ENOUGH RESOURCES';\n            return;\n        }\n        \n        // Deduct bet from player's resources\n        this.spaceship.cargo[this.currentBet.resource] -= this.currentBet.amount;\n        this.updateResourceDisplay();\n        \n        // Sync with the game's resource system if available\n        if (window.game && window.game.controls && window.game.controls.resources) {\n            window.game.controls.resources[this.currentBet.resource] = this.spaceship.cargo[this.currentBet.resource];\n            console.log(\"Updated game resources after bet:\", window.game.controls.resources);\n        }\n        \n        // Create and shuffle deck\n        this.createDeck();\n        \n        // Clear previous hands\n        this.playerHand = [];\n        this.dealerHand = [];\n        document.getElementById('player-cards').innerHTML = '';\n        document.getElementById('dealer-cards').innerHTML = '';\n        \n        // Deal initial cards\n        this.gameActive = true;\n        \n        // Deal two cards to player\n        this.dealCardToPlayer();\n        this.dealCardToPlayer();\n        \n        // Deal one face up card to dealer\n        this.dealCardToDealer();\n        \n        // Deal one face down card to dealer\n        this.dealCardToDealer(true);\n        \n        // Check for natural blackjack\n        this.checkForNaturalBlackjack();\n        \n        // Update game state\n        document.getElementById('game-status').textContent = 'YOUR MOVE';\n        \n        // Update controls\n        this.updateControls();\n        \n        // Play deal sound\n        this.playCardSound('deal');\n    }\n    \n    /**\n     * Deal a card to the player\n     */\n    dealCardToPlayer() {\n        const card = this.drawCard();\n        this.playerHand.push(card);\n        \n        // Create and add card element\n        const cardEl = this.createCardElement(card);\n        document.getElementById('player-cards').appendChild(cardEl);\n        \n        // Add a slight animation delay\n        setTimeout(() => {\n            cardEl.style.transform = 'translateY(-5px)';\n        }, 50);\n        \n        // Update score\n        const score = this.calculateScore(this.playerHand);\n        document.getElementById('player-score').textContent = score;\n        \n        // Check for bust\n        if (score > 21) {\n            this.playerBust();\n        }\n    }\n    \n    /**\n     * Deal a card to the dealer\n     * @param {boolean} faceDown - Whether the card should be face down\n     */\n    dealCardToDealer(faceDown = false) {\n        const card = this.drawCard();\n        this.dealerHand.push(card);\n        \n        // Create and add card element\n        const cardEl = this.createCardElement(card, faceDown);\n        cardEl.id = faceDown ? 'face-down-card' : '';\n        document.getElementById('dealer-cards').appendChild(cardEl);\n        \n        // Add a slight animation delay\n        setTimeout(() => {\n            cardEl.style.transform = 'translateY(-5px)';\n        }, 50);\n        \n        // Update score (only counting face-up cards)\n        if (!faceDown) {\n            const visibleScore = this.calculateVisibleDealerScore();\n            document.getElementById('dealer-score').textContent = visibleScore;\n        }\n    }\n    \n    /**\n     * Calculate the dealer's visible score (excluding face-down card)\n     * @returns {number} The visible score\n     */\n    calculateVisibleDealerScore() {\n        if (this.dealerHand.length <= 1) {\n            return this.dealerHand.length ? this.getCardValue(this.dealerHand[0]) : 0;\n        }\n        \n        // Calculate score excluding the last card (which is face down)\n        return this.calculateScore(this.dealerHand.slice(0, -1));\n    }\n    \n    /**\n     * Check for natural blackjack\n     */\n    checkForNaturalBlackjack() {\n        const playerScore = this.calculateScore(this.playerHand);\n        const dealerScore = this.calculateScore(this.dealerHand);\n        \n        if (playerScore === 21 || dealerScore === 21) {\n            // Reveal dealer's face-down card\n            this.revealDealerCard();\n            \n            if (playerScore === 21 && dealerScore === 21) {\n                // Both have blackjack - push\n                this.push();\n            } else if (playerScore === 21) {\n                // Player has blackjack - win with 3:2 payout\n                this.blackjackWin();\n            } else {\n                // Dealer has blackjack - player loses\n                this.playerLose();\n            }\n        }\n    }\n    \n    /**\n     * Player action: Hit (take another card)\n     */\n    hit() {\n        if (this.gameActive) {\n            this.dealCardToPlayer();\n            this.playCardSound('hit');\n            this.updateControls();\n        }\n    }\n    \n    /**\n     * Player action: Stand (end turn)\n     */\n    stand() {\n        if (this.gameActive) {\n            this.playCardSound('stand');\n            this.dealerPlay();\n        }\n    }\n    \n    /**\n     * Player action: Double Down (double bet, take one card, then stand)\n     */\n    doubleDown() {\n        if (this.gameActive && this.playerHand.length === 2) {\n            // Check if player has enough resources\n            if (this.spaceship.cargo[this.currentBet.resource] < this.currentBet.amount) {\n                document.getElementById('game-status').textContent = 'NOT ENOUGH RESOURCES FOR DOUBLE DOWN';\n                return;\n            }\n            \n            // Double the bet\n            this.spaceship.cargo[this.currentBet.resource] -= this.currentBet.amount;\n            this.currentBet.amount *= 2;\n            this.updateResourceDisplay();\n            \n            // Sync with the game's resource system if available\n            if (window.game && window.game.controls && window.game.controls.resources) {\n                window.game.controls.resources[this.currentBet.resource] = this.spaceship.cargo[this.currentBet.resource];\n                console.log(\"Updated game resources after double down:\", window.game.controls.resources);\n            }\n            \n            // Deal one more card\n            this.dealCardToPlayer();\n            \n            // If not bust, dealer plays\n            if (this.calculateScore(this.playerHand) <= 21) {\n                this.dealerPlay();\n            }\n            \n            this.playCardSound('double');\n        }\n    }\n    \n    /**\n     * Dealer's turn to play\n     */\n    dealerPlay() {\n        // Reveal dealer's face-down card\n        this.revealDealerCard();\n        \n        // Dealer hits until score is 17 or higher\n        let dealerScore = this.calculateScore(this.dealerHand);\n        \n        const dealerPlayNextCard = () => {\n            if (dealerScore < 17) {\n                // Deal a new card to dealer\n                this.dealCardToDealer();\n                \n                // Update dealer score\n                dealerScore = this.calculateScore(this.dealerHand);\n                \n                // Play sound\n                this.playCardSound('hit');\n                \n                // Continue with a small delay\n                setTimeout(() => {\n                    dealerPlayNextCard();\n                }, 800);\n            } else {\n                // Dealer is done - determine outcome\n                this.determineOutcome();\n            }\n        };\n        \n        // Start dealer's play with a delay\n        setTimeout(dealerPlayNextCard, 800);\n    }\n    \n    /**\n     * Reveal the dealer's face-down card\n     */\n    revealDealerCard() {\n        // Remove the face-down card element\n        const faceDownEl = document.getElementById('face-down-card');\n        if (faceDownEl) {\n            faceDownEl.remove();\n            \n            // Create and add the face-up version of the last card\n            const lastCard = this.dealerHand[this.dealerHand.length - 1];\n            const cardEl = this.createCardElement(lastCard);\n            document.getElementById('dealer-cards').appendChild(cardEl);\n            \n            // Add a slight animation delay\n            setTimeout(() => {\n                cardEl.style.transform = 'translateY(-5px)';\n            }, 50);\n            \n            // Update dealer score\n            const dealerScore = this.calculateScore(this.dealerHand);\n            document.getElementById('dealer-score').textContent = dealerScore;\n            \n            // Play flip sound\n            this.playCardSound('flip');\n        }\n    }\n    \n    /**\n     * Determine the outcome of the game\n     */\n    determineOutcome() {\n        const playerScore = this.calculateScore(this.playerHand);\n        const dealerScore = this.calculateScore(this.dealerHand);\n        \n        if (dealerScore > 21) {\n            // Dealer busts - player wins\n            this.playerWin();\n        } else if (playerScore > dealerScore) {\n            // Player score higher - player wins\n            this.playerWin();\n        } else if (dealerScore > playerScore) {\n            // Dealer score higher - player loses\n            this.playerLose();\n        } else {\n            // Scores are equal - push\n            this.push();\n        }\n    }\n    \n    /**\n     * Player busts (score over 21)\n     */\n    playerBust() {\n        this.gameActive = false;\n        this.gameResult = 'bust';\n        \n        document.getElementById('game-status').textContent = 'BUST! YOU LOSE';\n        this.showDealerSpeech('lose');\n        \n        // Play bust sound\n        this.playCardSound('bust');\n        \n        // Update controls\n        this.updateControls();\n    }\n    \n    /**\n     * Player wins\n     */\n    playerWin() {\n        this.gameActive = false;\n        this.gameResult = 'win';\n        \n        document.getElementById('game-status').textContent = 'YOU WIN!';\n        this.showDealerSpeech('win');\n        \n        // Calculate winnings (2x bet)\n        const winAmount = this.currentBet.amount * 2;\n        this.spaceship.cargo[this.currentBet.resource] += winAmount;\n        this.updateResourceDisplay();\n        \n        // Sync with the game's resource system if available\n        if (window.game && window.game.controls && window.game.controls.resources) {\n            window.game.controls.resources[this.currentBet.resource] = this.spaceship.cargo[this.currentBet.resource];\n            console.log(\"Updated game resources after win:\", window.game.controls.resources);\n        }\n        \n        // Play win sound\n        this.playCardSound('win');\n        \n        // Update controls\n        this.updateControls();\n    }\n    \n    /**\n     * Player gets a blackjack (natural 21)\n     */\n    blackjackWin() {\n        this.gameActive = false;\n        this.gameResult = 'blackjack';\n        \n        document.getElementById('game-status').textContent = 'BLACKJACK! TRIPLE PAYOUT!';\n        this.showDealerSpeech('blackjack');\n        \n        // Calculate winnings (3x bet)\n        const winAmount = this.currentBet.amount * 3;\n        this.spaceship.cargo[this.currentBet.resource] += winAmount;\n        this.updateResourceDisplay();\n        \n        // Sync with the game's resource system if available\n        if (window.game && window.game.controls && window.game.controls.resources) {\n            window.game.controls.resources[this.currentBet.resource] = this.spaceship.cargo[this.currentBet.resource];\n            console.log(\"Updated game resources after blackjack:\", window.game.controls.resources);\n        }\n        \n        // Play win sound\n        this.playCardSound('blackjack');\n        \n        // Update controls\n        this.updateControls();\n    }\n    \n    /**\n     * Player loses\n     */\n    playerLose() {\n        this.gameActive = false;\n        this.gameResult = 'lose';\n        \n        document.getElementById('game-status').textContent = 'DEALER WINS';\n        this.showDealerSpeech('lose');\n        \n        // Play lose sound\n        this.playCardSound('lose');\n        \n        // Update controls\n        this.updateControls();\n    }\n    \n    /**\n     * Push (tie)\n     */\n    push() {\n        this.gameActive = false;\n        this.gameResult = 'push';\n        \n        document.getElementById('game-status').textContent = 'PUSH - BETS RETURNED';\n        this.showDealerSpeech('push');\n        \n        // Return bet to player\n        this.spaceship.cargo[this.currentBet.resource] += this.currentBet.amount;\n        this.updateResourceDisplay();\n        \n        // Sync with the game's resource system if available\n        if (window.game && window.game.controls && window.game.controls.resources) {\n            window.game.controls.resources[this.currentBet.resource] = this.spaceship.cargo[this.currentBet.resource];\n            console.log(\"Updated game resources after push:\", window.game.controls.resources);\n        }\n        \n        // Play push sound\n        this.playCardSound('push');\n        \n        // Update controls\n        this.updateControls();\n    }\n    \n    /**\n     * Show dealer speech bubble with a random phrase\n     * @param {string} type - The type of phrase to show\n     */\n    showDealerSpeech(type) {\n        const speechBubble = document.getElementById('dealer-speech');\n        const phrases = this.dealerPhrases[type];\n        \n        if (phrases && phrases.length > 0) {\n            const randomPhrase = phrases[Math.floor(Math.random() * phrases.length)];\n            speechBubble.textContent = randomPhrase;\n            speechBubble.style.display = 'block';\n            \n            // Remove after a few seconds\n            setTimeout(() => {\n                speechBubble.style.display = 'none';\n            }, 4000);\n        }\n    }\n    \n    /**\n     * Play a card game sound\n     * @param {string} type - The type of sound to play\n     */\n    playCardSound(type) {\n        if (!this.audio) return;\n        \n        switch (type) {\n            case 'deal':\n                this.audio.playSound('boink');\n                break;\n            case 'hit':\n                this.audio.playSound('boink');\n                break;\n            case 'stand':\n                this.audio.playSound('boink');\n                break;\n            case 'double':\n                // Play two sounds in quick succession\n                this.audio.playSound('boink');\n                setTimeout(() => this.audio.playSound('boink'), 150);\n                break;\n            case 'flip':\n                this.audio.playSound('boink');\n                break;\n            case 'win':\n                this.audio.playSound('phaserUp');\n                break;\n            case 'blackjack':\n                // Play multiple sounds for celebration\n                this.audio.playSound('phaserUp');\n                setTimeout(() => this.audio.playSound('phaserUp'), 300);\n                break;\n            case 'lose':\n                this.audio.playSound('phaserDown');\n                break;\n            case 'bust':\n                this.audio.playSound('phaserDown');\n                break;\n            case 'push':\n                this.audio.playSound('boink');\n                break;\n        }\n    }\n}","// settings.js - Handles game settings and performance options\n\nimport { MobileDetector } from '../../utils/mobileDetector.js';\nimport * as THREE from 'three';\n\nexport class Settings {\n    constructor(game) {\n        this.game = game;\n        this.stargateInterface = null;\n        this.isVisible = false;\n        this.isMobile = MobileDetector.isMobile();\n        \n        console.log(\"Settings constructor - isMobile:\", this.isMobile);\n        \n        // Detect monitor refresh rate\n        this.detectMonitorRefreshRate();\n        \n        // Default settings\n        this.settings = {\n            graphicalQuality: 'medium',    // low, medium, high\n            postProcessing: true,          // true, false\n            asteroidDetail: 'medium',      // low, medium, high\n            lightingQuality: 'medium',     // low, medium, high\n            particleEffects: 'medium',     // low, medium, high\n            resolutionScale: 'medium',     // low, medium, high\n            frameRateCap: 'auto',          // 30, 60, auto (monitor refresh rate), 0 (unlimited)\n            showFPS: false,                // Show FPS counter\n            spatialAudio: true,            // Enable spatial audio\n            autoQuality: true,             // Automatically adjust quality based on performance\n            godRaysEnabled: false,          // Enable/disable volumetric lighting effects\n            godRaysType: 'standard'        // 'standard' (new god rays) or 'claude' (Claude Rays)\n        };\n        \n        // Load settings from localStorage if available\n        this.loadSettings();\n        \n        // Create settings UI\n        this.setupSettingsUI();\n        \n        // Apply initial settings\n        this.applyAllSettings();\n        \n        // Apply initial FPS display visibility\n        setTimeout(() => this.applyUISettings(), 100);\n    }\n    \n    setStargateInterface(stargateInterface) {\n        this.stargateInterface = stargateInterface;\n    }\n    \n    loadSettings() {\n        try {\n            const savedSettings = localStorage.getItem('asteroidMinerSettings');\n            if (savedSettings) {\n                const parsedSettings = JSON.parse(savedSettings);\n                // Merge saved settings with defaults\n                this.settings = {...this.settings, ...parsedSettings};\n                console.log(\"Settings loaded from localStorage:\", this.settings);\n            }\n        } catch (error) {\n            console.error(\"Error loading settings:\", error);\n        }\n    }\n    \n    saveSettings() {\n        try {\n            localStorage.setItem('asteroidMinerSettings', JSON.stringify(this.settings));\n            console.log(\"Settings saved to localStorage\");\n        } catch (error) {\n            console.error(\"Error saving settings:\", error);\n        }\n    }\n    \n    setupSettingsUI() {\n        // Create settings container\n        const settingsContainer = document.createElement('div');\n        settingsContainer.id = 'settings-container';\n        settingsContainer.style.position = 'absolute';\n        settingsContainer.style.top = '50%';\n        settingsContainer.style.left = '50%';\n        settingsContainer.style.transform = 'translate(-50%, -50%)';\n        \n        // Adjust size for mobile\n        if (this.isMobile) {\n            settingsContainer.style.width = '95%';\n            settingsContainer.style.maxWidth = '600px';\n            settingsContainer.style.height = '90vh';\n        } else {\n            settingsContainer.style.width = '700px';\n            settingsContainer.style.maxHeight = '90vh';\n        }\n        \n        settingsContainer.style.overflowY = 'auto';\n        settingsContainer.style.backgroundColor = 'rgba(20, 30, 50, 0.9)';\n        settingsContainer.style.color = '#fff';\n        settingsContainer.style.padding = this.isMobile ? '20px' : '30px';\n        settingsContainer.style.borderRadius = '15px';\n        settingsContainer.style.border = '2px solid #33aaff';\n        settingsContainer.style.boxShadow = '0 0 30px #33aaff';\n        settingsContainer.style.fontFamily = 'Courier New, monospace';\n        settingsContainer.style.zIndex = '1000';\n        settingsContainer.style.display = 'none';\n        \n        // Add mobile-specific scroll support\n        if (this.isMobile) {\n            settingsContainer.style.webkitOverflowScrolling = 'touch';\n            settingsContainer.style.touchAction = 'pan-y';\n            settingsContainer.style.overscrollBehavior = 'contain';\n        }\n        \n        // Create settings content\n        settingsContainer.innerHTML = `\n            <h2 style=\"text-align: center; color: #33aaff; margin-top: 0; font-size: ${this.isMobile ? '24px' : '28px'};\">GAME SETTINGS</h2>\n            \n            <div style=\"margin-bottom: 20px;\">\n                <h3 style=\"color: #33aaff; border-bottom: 1px solid #33aaff; padding-bottom: 10px; font-size: ${this.isMobile ? '18px' : '20px'};\">GRAPHICS SETTINGS</h3>\n                \n                <!-- Graphical Quality Setting -->\n                <div class=\"settings-row\" style=\"display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; flex-direction: ${this.isMobile ? 'column' : 'row'}; align-items: ${this.isMobile ? 'flex-start' : 'center'};\">\n                    <div style=\"margin-bottom: ${this.isMobile ? '8px' : '0'}; ${this.isMobile ? 'width: 100%' : ''}\">\n                        <label style=\"font-weight: bold; font-size: ${this.isMobile ? '15px' : 'inherit'};\">Graphical Quality</label>\n                        <p style=\"margin: 5px 0 0 0; font-size: ${this.isMobile ? '11px' : '12px'}; color: #aaa;\">Affects overall visual fidelity and performance</p>\n                    </div>\n                    <div style=\"${this.isMobile ? 'width: 100%' : ''}\">\n                        <select id=\"graphical-quality\" style=\"background-color: #2a3a5a; color: white; border: 1px solid #33aaff; padding: ${this.isMobile ? '10px' : '8px'}; border-radius: 5px; width: ${this.isMobile ? '100%' : 'auto'}; font-size: ${this.isMobile ? '16px' : 'inherit'};\">\n                            <option value=\"low\">Low</option>\n                            <option value=\"medium\">Medium</option>\n                            <option value=\"high\">High</option>\n                        </select>\n                    </div>\n                </div>\n                \n                <!-- Post-processing Effects Setting -->\n                <div class=\"settings-row\" style=\"display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; flex-direction: ${this.isMobile ? 'column' : 'row'}; align-items: ${this.isMobile ? 'flex-start' : 'center'};\">\n                    <div style=\"margin-bottom: ${this.isMobile ? '8px' : '0'}; ${this.isMobile ? 'width: 100%' : ''}\">\n                        <label style=\"font-weight: bold; font-size: ${this.isMobile ? '15px' : 'inherit'};\">Post-processing Effects</label>\n                        <p style=\"margin: 5px 0 0 0; font-size: ${this.isMobile ? '11px' : '12px'}; color: #aaa;\">Bloom, anti-aliasing, and visual effects</p>\n                    </div>\n                    <div style=\"${this.isMobile ? 'width: 100%; display: flex; justify-content: flex-end;' : ''}\">\n                        <label class=\"toggle\" style=\"display: inline-block; position: relative; width: ${this.isMobile ? '70px' : '60px'}; height: ${this.isMobile ? '34px' : '30px'};\">\n                            <input type=\"checkbox\" id=\"post-processing\" style=\"opacity: 0; width: 0; height: 0;\">\n                            <span class=\"slider\" style=\"position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #555; border-radius: ${this.isMobile ? '17px' : '15px'}; transition: .4s;\"></span>\n                        </label>\n                    </div>\n                </div>\n                \n                <!-- Volumetric Light Rays (God Rays) Setting -->\n                <div class=\"settings-row\" style=\"display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; flex-direction: ${this.isMobile ? 'column' : 'row'}; align-items: ${this.isMobile ? 'flex-start' : 'center'};\">\n                    <div style=\"margin-bottom: ${this.isMobile ? '8px' : '0'}; ${this.isMobile ? 'width: 100%' : ''}\">\n                        <label style=\"font-weight: bold; font-size: ${this.isMobile ? '15px' : 'inherit'};\">Volumetric Light Rays</label>\n                        <p style=\"margin: 5px 0 0 0; font-size: ${this.isMobile ? '11px' : '12px'}; color: #aaa;\">Enable sunlight rays effect</p>\n                    </div>\n                    <div style=\"${this.isMobile ? 'width: 100%; display: flex; justify-content: flex-end;' : ''}\">\n                        <label class=\"toggle\" style=\"display: inline-block; position: relative; width: ${this.isMobile ? '70px' : '60px'}; height: ${this.isMobile ? '34px' : '30px'};\">\n                            <input type=\"checkbox\" id=\"god-rays-enabled\" style=\"opacity: 0; width: 0; height: 0;\">\n                            <span class=\"slider\" style=\"position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #555; border-radius: ${this.isMobile ? '17px' : '15px'}; transition: .4s;\"></span>\n                        </label>\n                    </div>\n                </div>\n                \n                <!-- God Ray Type Setting -->\n                <div class=\"settings-row\" style=\"display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; flex-direction: ${this.isMobile ? 'column' : 'row'}; align-items: ${this.isMobile ? 'flex-start' : 'center'};\">\n                    <div style=\"margin-bottom: ${this.isMobile ? '8px' : '0'}; ${this.isMobile ? 'width: 100%' : ''}\">\n                        <label style=\"font-weight: bold; font-size: ${this.isMobile ? '15px' : 'inherit'};\">Light Ray Type</label>\n                        <p style=\"margin: 5px 0 0 0; font-size: ${this.isMobile ? '11px' : '12px'}; color: #aaa;\">Choose light ray effect style</p>\n                    </div>\n                    <div style=\"${this.isMobile ? 'width: 100%' : ''}\">\n                        <select id=\"god-rays-type\" style=\"background-color: #2a3a5a; color: white; border: 1px solid #33aaff; padding: ${this.isMobile ? '10px' : '8px'}; border-radius: 5px; width: ${this.isMobile ? '100%' : 'auto'}; font-size: ${this.isMobile ? '16px' : 'inherit'};\">\n                            <option value=\"standard\">Standard God Rays</option>\n                            <option value=\"claude\">Claude Rays</option>\n                        </select>\n                    </div>\n                </div>\n                \n                <!-- Asteroid Detail Setting -->\n                <div class=\"settings-row\" style=\"display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; flex-direction: ${this.isMobile ? 'column' : 'row'}; align-items: ${this.isMobile ? 'flex-start' : 'center'};\">\n                    <div style=\"margin-bottom: ${this.isMobile ? '8px' : '0'}; ${this.isMobile ? 'width: 100%' : ''}\">\n                        <label style=\"font-weight: bold; font-size: ${this.isMobile ? '15px' : 'inherit'};\">Asteroid Detail</label>\n                        <p style=\"margin: 5px 0 0 0; font-size: ${this.isMobile ? '11px' : '12px'}; color: #aaa;\">Affects asteroid count and model complexity</p>\n                    </div>\n                    <div style=\"${this.isMobile ? 'width: 100%' : ''}\">\n                        <select id=\"asteroid-detail\" style=\"background-color: #2a3a5a; color: white; border: 1px solid #33aaff; padding: ${this.isMobile ? '10px' : '8px'}; border-radius: 5px; width: ${this.isMobile ? '100%' : 'auto'}; font-size: ${this.isMobile ? '16px' : 'inherit'};\">\n                            <option value=\"low\">Low</option>\n                            <option value=\"medium\">Medium</option>\n                            <option value=\"high\">High</option>\n                        </select>\n                    </div>\n                </div>\n                \n                <!-- Lighting Quality Setting -->\n                <div class=\"settings-row\" style=\"display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; flex-direction: ${this.isMobile ? 'column' : 'row'}; align-items: ${this.isMobile ? 'flex-start' : 'center'};\">\n                    <div style=\"margin-bottom: ${this.isMobile ? '8px' : '0'}; ${this.isMobile ? 'width: 100%' : ''}\">\n                        <label style=\"font-weight: bold; font-size: ${this.isMobile ? '15px' : 'inherit'};\">Lighting Quality</label>\n                        <p style=\"margin: 5px 0 0 0; font-size: ${this.isMobile ? '11px' : '12px'}; color: #aaa;\">Affects light sources and shadows</p>\n                    </div>\n                    <div style=\"${this.isMobile ? 'width: 100%' : ''}\">\n                        <select id=\"lighting-quality\" style=\"background-color: #2a3a5a; color: white; border: 1px solid #33aaff; padding: ${this.isMobile ? '10px' : '8px'}; border-radius: 5px; width: ${this.isMobile ? '100%' : 'auto'}; font-size: ${this.isMobile ? '16px' : 'inherit'};\">\n                            <option value=\"low\">Low</option>\n                            <option value=\"medium\">Medium</option>\n                            <option value=\"high\">High</option>\n                        </select>\n                    </div>\n                </div>\n                \n                <!-- Particle Effects Setting -->\n                <div class=\"settings-row\" style=\"display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; flex-direction: ${this.isMobile ? 'column' : 'row'}; align-items: ${this.isMobile ? 'flex-start' : 'center'};\">\n                    <div style=\"margin-bottom: ${this.isMobile ? '8px' : '0'}; ${this.isMobile ? 'width: 100%' : ''}\">\n                        <label style=\"font-weight: bold; font-size: ${this.isMobile ? '15px' : 'inherit'};\">Particle Effects</label>\n                        <p style=\"margin: 5px 0 0 0; font-size: ${this.isMobile ? '11px' : '12px'}; color: #aaa;\">Affects thruster, explosion, and other particle effects</p>\n                    </div>\n                    <div style=\"${this.isMobile ? 'width: 100%' : ''}\">\n                        <select id=\"particle-effects\" style=\"background-color: #2a3a5a; color: white; border: 1px solid #33aaff; padding: ${this.isMobile ? '10px' : '8px'}; border-radius: 5px; width: ${this.isMobile ? '100%' : 'auto'}; font-size: ${this.isMobile ? '16px' : 'inherit'};\">\n                            <option value=\"low\">Low</option>\n                            <option value=\"medium\">Medium</option>\n                            <option value=\"high\">High</option>\n                        </select>\n                    </div>\n                </div>\n                \n                <!-- Resolution Scale Setting -->\n                <div class=\"settings-row\" style=\"display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; flex-direction: ${this.isMobile ? 'column' : 'row'}; align-items: ${this.isMobile ? 'flex-start' : 'center'};\">\n                    <div style=\"margin-bottom: ${this.isMobile ? '8px' : '0'}; ${this.isMobile ? 'width: 100%' : ''}\">\n                        <label style=\"font-weight: bold; font-size: ${this.isMobile ? '15px' : 'inherit'};\">Resolution Scale</label>\n                        <p style=\"margin: 5px 0 0 0; font-size: ${this.isMobile ? '11px' : '12px'}; color: #aaa;\">Adjusts rendering resolution</p>\n                    </div>\n                    <div style=\"${this.isMobile ? 'width: 100%' : ''}\">\n                        <select id=\"resolution-scale\" style=\"background-color: #2a3a5a; color: white; border: 1px solid #33aaff; padding: ${this.isMobile ? '10px' : '8px'}; border-radius: 5px; width: ${this.isMobile ? '100%' : 'auto'}; font-size: ${this.isMobile ? '16px' : 'inherit'};\">\n                            <option value=\"low\">Low (75%)</option>\n                            <option value=\"medium\">Medium (100%)</option>\n                            <option value=\"high\">High (125%)</option>\n                        </select>\n                    </div>\n                </div>\n            </div>\n            \n            <div style=\"margin-bottom: 20px;\">\n                <h3 style=\"color: #33aaff; border-bottom: 1px solid #33aaff; padding-bottom: 10px; font-size: ${this.isMobile ? '18px' : '20px'};\">PERFORMANCE SETTINGS</h3>\n                \n                <!-- Frame Rate Cap Setting -->\n                <div class=\"settings-row\" style=\"display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; flex-direction: ${this.isMobile ? 'column' : 'row'}; align-items: ${this.isMobile ? 'flex-start' : 'center'};\">\n                    <div style=\"margin-bottom: ${this.isMobile ? '8px' : '0'}; ${this.isMobile ? 'width: 100%' : ''}\">\n                        <label style=\"font-weight: bold; font-size: ${this.isMobile ? '15px' : 'inherit'};\">Frame Rate Cap</label>\n                        <p style=\"margin: 5px 0 0 0; font-size: ${this.isMobile ? '11px' : '12px'}; color: #aaa;\">Limits maximum frame rate</p>\n                    </div>\n                    <div style=\"${this.isMobile ? 'width: 100%' : ''}\">\n                        <select id=\"frame-rate-cap\" style=\"background-color: #2a3a5a; color: white; border: 1px solid #33aaff; padding: ${this.isMobile ? '10px' : '8px'}; border-radius: 5px; width: ${this.isMobile ? '100%' : 'auto'}; font-size: ${this.isMobile ? '16px' : 'inherit'};\">\n                            <option value=\"30\">30 FPS</option>\n                            <option value=\"60\">60 FPS</option>\n                            <option value=\"auto\">Monitor Refresh Rate (${this.monitorRefreshRate}Hz)</option>\n                            <option value=\"0\">Unlimited</option>\n                        </select>\n                    </div>\n                </div>\n                \n                <!-- Show FPS Setting -->\n                <div class=\"settings-row\" style=\"display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; flex-direction: ${this.isMobile ? 'column' : 'row'}; align-items: ${this.isMobile ? 'flex-start' : 'center'};\">\n                    <div style=\"margin-bottom: ${this.isMobile ? '8px' : '0'}; ${this.isMobile ? 'width: 100%' : ''}\">\n                        <label style=\"font-weight: bold; font-size: ${this.isMobile ? '15px' : 'inherit'};\">Show FPS Counter</label>\n                        <p style=\"margin: 5px 0 0 0; font-size: ${this.isMobile ? '11px' : '12px'}; color: #aaa;\">Display current frame rate</p>\n                    </div>\n                    <div style=\"${this.isMobile ? 'width: 100%; display: flex; justify-content: flex-end;' : ''}\">\n                        <label class=\"toggle\" style=\"display: inline-block; position: relative; width: ${this.isMobile ? '70px' : '60px'}; height: ${this.isMobile ? '34px' : '30px'};\">\n                            <input type=\"checkbox\" id=\"show-fps\" style=\"opacity: 0; width: 0; height: 0;\">\n                            <span class=\"slider\" style=\"position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #555; border-radius: ${this.isMobile ? '17px' : '15px'}; transition: .4s;\"></span>\n                        </label>\n                    </div>\n                </div>\n                \n                <!-- Auto Quality Setting -->\n                <div class=\"settings-row\" style=\"display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; flex-direction: ${this.isMobile ? 'column' : 'row'}; align-items: ${this.isMobile ? 'flex-start' : 'center'};\">\n                    <div style=\"margin-bottom: ${this.isMobile ? '8px' : '0'}; ${this.isMobile ? 'width: 100%' : ''}\">\n                        <label style=\"font-weight: bold; font-size: ${this.isMobile ? '15px' : 'inherit'};\">Auto-Adjust Quality</label>\n                        <p style=\"margin: 5px 0 0 0; font-size: ${this.isMobile ? '11px' : '12px'}; color: #aaa;\">Automatically adjusts settings based on performance</p>\n                    </div>\n                    <div style=\"${this.isMobile ? 'width: 100%; display: flex; justify-content: flex-end;' : ''}\">\n                        <label class=\"toggle\" style=\"display: inline-block; position: relative; width: ${this.isMobile ? '70px' : '60px'}; height: ${this.isMobile ? '34px' : '30px'};\">\n                            <input type=\"checkbox\" id=\"auto-quality\" style=\"opacity: 0; width: 0; height: 0;\">\n                            <span class=\"slider\" style=\"position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #555; border-radius: ${this.isMobile ? '17px' : '15px'}; transition: .4s;\"></span>\n                        </label>\n                    </div>\n                </div>\n            </div>\n            \n            <div style=\"margin-bottom: 20px;\">\n                <h3 style=\"color: #33aaff; border-bottom: 1px solid #33aaff; padding-bottom: 10px; font-size: ${this.isMobile ? '18px' : '20px'};\">AUDIO SETTINGS</h3>\n                \n                <!-- Spatial Audio Setting -->\n                <div class=\"settings-row\" style=\"display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; flex-direction: ${this.isMobile ? 'column' : 'row'}; align-items: ${this.isMobile ? 'flex-start' : 'center'};\">\n                    <div style=\"margin-bottom: ${this.isMobile ? '8px' : '0'}; ${this.isMobile ? 'width: 100%' : ''}\">\n                        <label style=\"font-weight: bold; font-size: ${this.isMobile ? '15px' : 'inherit'};\">Spatial Audio</label>\n                        <p style=\"margin: 5px 0 0 0; font-size: ${this.isMobile ? '11px' : '12px'}; color: #aaa;\">3D positional sound effects</p>\n                    </div>\n                    <div style=\"${this.isMobile ? 'width: 100%; display: flex; justify-content: flex-end;' : ''}\">\n                        <label class=\"toggle\" style=\"display: inline-block; position: relative; width: ${this.isMobile ? '70px' : '60px'}; height: ${this.isMobile ? '34px' : '30px'};\">\n                            <input type=\"checkbox\" id=\"spatial-audio\" style=\"opacity: 0; width: 0; height: 0;\">\n                            <span class=\"slider\" style=\"position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #555; border-radius: ${this.isMobile ? '17px' : '15px'}; transition: .4s;\"></span>\n                        </label>\n                    </div>\n                </div>\n            </div>\n            \n            <div style=\"margin-bottom: 20px;\">\n                <h3 style=\"color: #33aaff; border-bottom: 1px solid #33aaff; padding-bottom: 10px; font-size: ${this.isMobile ? '18px' : '20px'};\">PRESETS</h3>\n                \n                <div style=\"display: flex; justify-content: space-between; margin-bottom: 20px; flex-direction: ${this.isMobile ? 'column' : 'row'}; gap: ${this.isMobile ? '10px' : '0'};\">\n                    <button id=\"preset-performance\" style=\"flex: 1; margin-right: ${this.isMobile ? '0' : '10px'}; padding: ${this.isMobile ? '15px' : '10px'}; background-color: #2a3a5a; color: white; border: 1px solid #33aaff; border-radius: 5px; cursor: pointer; font-size: ${this.isMobile ? '16px' : 'inherit'};\">\n                        PERFORMANCE\n                    </button>\n                    <button id=\"preset-balanced\" style=\"flex: 1; margin-right: ${this.isMobile ? '0' : '10px'}; padding: ${this.isMobile ? '15px' : '10px'}; background-color: #2a3a5a; color: white; border: 1px solid #33aaff; border-radius: 5px; cursor: pointer; font-size: ${this.isMobile ? '16px' : 'inherit'};\">\n                        BALANCED\n                    </button>\n                    <button id=\"preset-quality\" style=\"flex: 1; padding: ${this.isMobile ? '15px' : '10px'}; background-color: #2a3a5a; color: white; border: 1px solid #33aaff; border-radius: 5px; cursor: pointer; font-size: ${this.isMobile ? '16px' : 'inherit'};\">\n                        QUALITY\n                    </button>\n                </div>\n            </div>\n            \n            <div style=\"display: flex; justify-content: space-between; flex-direction: ${this.isMobile ? 'column' : 'row'}; gap: ${this.isMobile ? '15px' : '0'};\">\n                <button id=\"apply-settings\" style=\"flex: 1; margin-right: ${this.isMobile ? '0' : '10px'}; padding: ${this.isMobile ? '20px' : '15px'}; background-color: #33aaff; color: black; border: none; border-radius: 5px; cursor: pointer; font-family: 'Courier New', monospace; font-weight: bold; font-size: ${this.isMobile ? '18px' : '16px'};\">\n                    APPLY\n                </button>\n                <button id=\"settings-back\" style=\"flex: 1; padding: ${this.isMobile ? '20px' : '15px'}; background-color: #555; color: white; border: none; border-radius: 5px; cursor: pointer; font-family: 'Courier New', monospace; font-weight: bold; font-size: ${this.isMobile ? '18px' : '16px'};\">\n                    BACK\n                </button>\n            </div>\n        `;\n        \n        // Add slider style\n        const style = document.createElement('style');\n        style.textContent = `\n            .slider:before {\n                position: absolute;\n                content: \"\";\n                height: ${this.isMobile ? '26px' : '22px'};\n                width: ${this.isMobile ? '26px' : '22px'};\n                left: 4px;\n                bottom: 4px;\n                background-color: white;\n                border-radius: 50%;\n                transition: .4s;\n            }\n            \n            input:checked + .slider {\n                background-color: #33aaff;\n            }\n            \n            input:checked + .slider:before {\n                transform: translateX(${this.isMobile ? '36px' : '30px'});\n            }\n        `;\n        \n        document.head.appendChild(style);\n        document.body.appendChild(settingsContainer);\n        \n        // Add event listeners\n        this.setupEventListeners();\n    }\n    \n    setupEventListeners() {\n        // Back button\n        const backButton = document.getElementById('settings-back');\n        if (backButton) {\n            // Mouse event\n            backButton.addEventListener('click', () => {\n                this.hide();\n            });\n            \n            // Touch event for mobile\n            if (this.isMobile) {\n                backButton.addEventListener('touchend', (e) => {\n                    e.preventDefault();\n                    this.hide();\n                });\n            }\n        }\n        \n        // Apply button\n        const applyButton = document.getElementById('apply-settings');\n        if (applyButton) {\n            const applyHandler = () => {\n                this.updateSettings();\n                this.saveSettings();\n                this.applyAllSettings();\n                \n                // Show confirmation message\n                this.showSettingsApplied();\n            };\n            \n            // Mouse event\n            applyButton.addEventListener('click', applyHandler);\n            \n            // Touch event for mobile\n            if (this.isMobile) {\n                applyButton.addEventListener('touchend', (e) => {\n                    e.preventDefault();\n                    applyHandler();\n                });\n            }\n        }\n        \n        // Preset buttons with both mouse and touch events\n        this.setupPresetButton('preset-performance', 'performance');\n        this.setupPresetButton('preset-balanced', 'balanced');\n        this.setupPresetButton('preset-quality', 'quality');\n    }\n    \n    setupPresetButton(buttonId, presetName) {\n        const button = document.getElementById(buttonId);\n        if (!button) return;\n        \n        const presetHandler = () => {\n            this.applyPreset(presetName);\n        };\n        \n        // Mouse event\n        button.addEventListener('click', presetHandler);\n        \n        // Touch event for mobile\n        if (this.isMobile) {\n            button.addEventListener('touchend', (e) => {\n                e.preventDefault();\n                presetHandler();\n            });\n        }\n        \n        // Add hover/touch effects\n        if (this.isMobile) {\n            button.addEventListener('touchstart', () => {\n                button.style.backgroundColor = '#3a4b6a';\n                button.style.boxShadow = '0 0 10px #33aaff';\n            }, { passive: true });\n            \n            button.addEventListener('touchend', () => {\n                button.style.backgroundColor = '#2a3a5a';\n                button.style.boxShadow = 'none';\n            }, { passive: true });\n        } else {\n            button.addEventListener('mouseover', () => {\n                button.style.backgroundColor = '#3a4b6a';\n                button.style.boxShadow = '0 0 10px #33aaff';\n            });\n            \n            button.addEventListener('mouseout', () => {\n                button.style.backgroundColor = '#2a3a5a';\n                button.style.boxShadow = 'none';\n            });\n        }\n    }\n    \n    updateSettings() {\n        // Update settings object from UI values\n        this.settings.graphicalQuality = document.getElementById('graphical-quality').value;\n        this.settings.postProcessing = document.getElementById('post-processing').checked;\n        this.settings.asteroidDetail = document.getElementById('asteroid-detail').value;\n        this.settings.lightingQuality = document.getElementById('lighting-quality').value;\n        this.settings.particleEffects = document.getElementById('particle-effects').value;\n        this.settings.resolutionScale = document.getElementById('resolution-scale').value;\n        this.settings.frameRateCap = document.getElementById('frame-rate-cap').value;\n        this.settings.showFPS = document.getElementById('show-fps').checked;\n        this.settings.spatialAudio = document.getElementById('spatial-audio').checked;\n        this.settings.autoQuality = document.getElementById('auto-quality').checked;\n        this.settings.godRaysEnabled = document.getElementById('god-rays-enabled').checked;\n        this.settings.godRaysType = document.getElementById('god-rays-type').value;\n    }\n    \n    updateUI() {\n        // Set form values from current settings\n        document.getElementById('graphical-quality').value = this.settings.graphicalQuality;\n        document.getElementById('post-processing').checked = this.settings.postProcessing;\n        document.getElementById('asteroid-detail').value = this.settings.asteroidDetail;\n        document.getElementById('lighting-quality').value = this.settings.lightingQuality;\n        document.getElementById('particle-effects').value = this.settings.particleEffects;\n        document.getElementById('resolution-scale').value = this.settings.resolutionScale;\n        document.getElementById('frame-rate-cap').value = this.settings.frameRateCap;\n        document.getElementById('show-fps').checked = this.settings.showFPS;\n        document.getElementById('spatial-audio').checked = this.settings.spatialAudio;\n        document.getElementById('auto-quality').checked = this.settings.autoQuality;\n        document.getElementById('god-rays-enabled').checked = this.settings.godRaysEnabled;\n        document.getElementById('god-rays-type').value = this.settings.godRaysType;\n    }\n    \n    applyPreset(preset) {\n        console.log(`Applying ${preset} preset`);\n        \n        switch (preset) {\n            case 'performance':\n                // Performance preset - prioritizes frame rate\n                this.settings.graphicalQuality = 'low';\n                this.settings.postProcessing = false;\n                this.settings.asteroidDetail = 'low';\n                this.settings.lightingQuality = 'low';\n                this.settings.particleEffects = 'low';\n                this.settings.resolutionScale = 'low';\n                this.settings.frameRateCap = 60; // Cap at 60 FPS for better consistency\n                this.settings.spatialAudio = false;\n                this.settings.godRaysEnabled = false; // Disable god rays for performance\n                break;\n                \n            case 'balanced':\n                // Balanced preset - moderate settings\n                this.settings.graphicalQuality = 'medium';\n                this.settings.postProcessing = true;\n                this.settings.asteroidDetail = 'medium';\n                this.settings.lightingQuality = 'medium';\n                this.settings.particleEffects = 'medium';\n                this.settings.resolutionScale = 'medium';\n                this.settings.frameRateCap = 'auto'; // Use monitor refresh rate\n                this.settings.spatialAudio = true;\n                this.settings.godRaysEnabled = true; // Enable god rays\n                this.settings.godRaysType = 'standard'; // Use standard rays\n                break;\n                \n            case 'quality':\n                // Quality preset - prioritizes visuals\n                this.settings.graphicalQuality = 'high';\n                this.settings.postProcessing = true;\n                this.settings.asteroidDetail = 'high';\n                this.settings.lightingQuality = 'high';\n                this.settings.particleEffects = 'high';\n                this.settings.resolutionScale = 'high';\n                this.settings.frameRateCap = 0; // Unlimited\n                this.settings.spatialAudio = true;\n                this.settings.godRaysEnabled = true; // Enable god rays\n                this.settings.godRaysType = 'claude'; // Use Claude rays for dramatic effect\n                break;\n                \n            default:\n                console.error(`Unknown preset: ${preset}`);\n                return;\n        }\n        \n        // Don't change auto quality and FPS display settings\n        \n        // Update the UI to reflect new settings\n        this.updateUI();\n        \n        // Show confirmation message\n        this.showSettingsApplied();\n    }\n    \n    applyAllSettings() {\n        if (!this.game) return;\n        \n        // Apply renderer settings\n        this.applyRendererSettings();\n        \n        // Apply physics settings\n        this.applyPhysicsSettings();\n        \n        // Apply environment settings\n        this.applyEnvironmentSettings();\n        \n        // Apply audio settings\n        this.applyAudioSettings();\n        \n        // Apply UI settings\n        this.applyUISettings();\n        \n        console.log('All settings applied successfully');\n    }\n    \n    applyRendererSettings() {\n        if (!this.game.renderer) return;\n        \n        const renderer = this.game.renderer;\n        \n        // Apply graphical quality\n        switch (this.settings.graphicalQuality) {\n            case 'low':\n                // Disable antialiasing\n                if (renderer.renderer) {\n                    renderer.renderer.antialias = false;\n                }\n                \n                // Set low shadow map size\n                if (renderer.renderer && renderer.renderer.shadowMap) {\n                    renderer.renderer.shadowMap.enabled = false;\n                }\n                break;\n                \n            case 'medium':\n                // Enable antialiasing\n                if (renderer.renderer) {\n                    renderer.renderer.antialias = true;\n                }\n                \n                // Set medium shadow map size\n                if (renderer.renderer && renderer.renderer.shadowMap) {\n                    renderer.renderer.shadowMap.enabled = true;\n                    renderer.renderer.shadowMap.type = THREE.PCFShadowMap;\n                }\n                break;\n                \n            case 'high':\n                // Enable antialiasing\n                if (renderer.renderer) {\n                    renderer.renderer.antialias = true;\n                }\n                \n                // Set high shadow map size\n                if (renderer.renderer && renderer.renderer.shadowMap) {\n                    renderer.renderer.shadowMap.enabled = true;\n                    renderer.renderer.shadowMap.type = THREE.PCFSoftShadowMap;\n                }\n                break;\n        }\n        \n        // Apply post-processing setting\n        if (renderer.composer) {\n            renderer.useBasicRendering = !this.settings.postProcessing;\n        }\n        \n        // Apply god ray type setting first (this affects ambient light)\n        if (renderer.setRayType) {\n            const useClaudeRays = this.settings.godRaysType === 'claude';\n            renderer.setRayType(useClaudeRays);\n        }\n        \n        // Apply volumetric lighting (god rays) settings\n        if (renderer.setVolumetricLightEnabled) {\n            renderer.setVolumetricLightEnabled(this.settings.godRaysEnabled);\n            \n            // Ensure lighting is adjusted even when disabling god rays\n            if (renderer.adjustLightingForRayType) {\n                renderer.adjustLightingForRayType();\n            }\n        }\n        \n        // Apply volumetric light intensity based on quality setting\n        if (renderer.setVolumetricLightIntensity) {\n            let intensity;\n            switch (this.settings.graphicalQuality) {\n                case 'low':\n                    intensity = 0.4; // Increased from 0.3\n                    break;\n                case 'medium':\n                    intensity = 0.65; // Increased from 0.5\n                    break;\n                case 'high':\n                    intensity = 0.85; // Increased from 0.7\n                    break;\n                default:\n                    intensity = 0.65;\n            }\n            renderer.setVolumetricLightIntensity(intensity);\n        }\n        \n        // Apply bloom settings based on quality\n        if (renderer.bloomPass) {\n            switch (this.settings.graphicalQuality) {\n                case 'low':\n                    renderer.adjustBloom(0.4, 0.3, 0.9);\n                    break;\n                case 'medium':\n                    renderer.adjustBloom(0.6, 0.4, 0.85);\n                    break;\n                case 'high':\n                    renderer.adjustBloom(0.8, 0.5, 0.8);\n                    break;\n            }\n        }\n        \n        // Apply resolution scaling\n        if (renderer.renderer) {\n            let pixelRatio = window.devicePixelRatio || 1;\n            \n            switch (this.settings.resolutionScale) {\n                case 'low':\n                    pixelRatio *= 0.75;\n                    break;\n                case 'medium':\n                    // Use default pixel ratio\n                    break;\n                case 'high':\n                    pixelRatio *= 1.25;\n                    break;\n            }\n            \n            renderer.renderer.setPixelRatio(pixelRatio);\n            \n            // Update size to apply new pixel ratio\n            renderer.handleResize();\n        }\n    }\n    \n    applyPhysicsSettings() {\n        // Physics settings don't need much adjustment, but we can optimize collision detection\n        // based on asteroid detail setting\n        if (this.game.physics) {\n            const physics = this.game.physics;\n            \n            switch (this.settings.asteroidDetail) {\n                case 'low':\n                    physics.collisionDistance = 10; // Reduced collision distance\n                    break;\n                case 'medium':\n                    physics.collisionDistance = 15; // Default\n                    break;\n                case 'high':\n                    physics.collisionDistance = 20; // More precise collision\n                    break;\n            }\n        }\n    }\n    \n    applyEnvironmentSettings() {\n        if (!this.game.environment) return;\n        \n        const environment = this.game.environment;\n        \n        // Apply asteroid detail settings\n        if (environment.asteroidBelt && environment.asteroidBelt.updateDensity) {\n            switch (this.settings.asteroidDetail) {\n                case 'low':\n                    environment.asteroidBelt.updateDensity(0.5); // 50% density\n                    break;\n                case 'medium':\n                    environment.asteroidBelt.updateDensity(1.0); // 100% density\n                    break;\n                case 'high':\n                    environment.asteroidBelt.updateDensity(1.5); // 150% density\n                    break;\n            }\n        }\n    }\n    \n    applyAudioSettings() {\n        if (!this.game.audio) return;\n        \n        const audio = this.game.audio;\n        \n        // Apply spatial audio setting\n        if (audio.spatialAudio !== undefined) {\n            audio.spatialAudio = this.settings.spatialAudio;\n        }\n    }\n    \n    applyUISettings() {\n        // Apply FPS counter setting - we'll use the existing HUD FPS display\n        const fpsElement = document.getElementById('fps-display');\n        if (fpsElement) {\n            if (this.settings.showFPS) {\n                // Show FPS display in HUD\n                fpsElement.style.display = 'block';\n                \n                // Update FPS immediately if we have a current value\n                if (this.game && this.game.currentFPS) {\n                    fpsElement.textContent = `FPS: ${Math.round(this.game.currentFPS)}`;\n                }\n            } else {\n                // Hide FPS display in HUD\n                fpsElement.style.display = 'none';\n            }\n        } else {\n            console.warn(\"FPS display element not found in HUD. It should have ID 'fps-display'\");\n        }\n        \n        // Update frame rate cap in game\n        if (this.game) {\n            const oldCap = this.game.frameRateCap;\n            \n            // Handle auto (monitor refresh rate) setting\n            if (this.settings.frameRateCap === 'auto') {\n                // If refresh rate is over 65Hz, set to unlimited (0)\n                if (this.monitorRefreshRate > 65) {\n                    this.game.frameRateCap = 0;\n                    console.log(`Using unlimited frame rate (refresh rate ${this.monitorRefreshRate}Hz > 65Hz)`);\n                } else {\n                    this.game.frameRateCap = this.monitorRefreshRate;\n                    console.log(`Setting frame rate cap to monitor refresh rate: ${this.monitorRefreshRate}Hz`);\n                }\n            } else {\n                // Use the selected numeric value\n                this.game.frameRateCap = parseInt(this.settings.frameRateCap) || 0;\n            }\n            \n            // Only reset timing when changing from unlimited to limited or vice versa\n            // This prevents disrupting the animation loop when just changing cap values\n            if ((oldCap === 0 && this.game.frameRateCap > 0) || \n                (oldCap > 0 && this.game.frameRateCap === 0)) {\n                this.game.lastFrameTime = 0;\n            }\n            \n            console.log(`Frame rate cap changed from ${oldCap} to ${this.game.frameRateCap}`);\n        }\n    }\n    \n    showSettingsApplied() {\n        // Create notification\n        const notification = document.createElement('div');\n        notification.style.position = 'fixed';\n        notification.style.top = this.isMobile ? '25%' : '20%';\n        notification.style.left = '50%';\n        notification.style.transform = 'translate(-50%, -50%)';\n        notification.style.backgroundColor = 'rgba(0, 0, 0, 0.8)';\n        notification.style.color = '#33aaff';\n        notification.style.padding = this.isMobile ? '20px 40px' : '15px 30px';\n        notification.style.borderRadius = '10px';\n        notification.style.fontFamily = 'Courier New, monospace';\n        notification.style.fontSize = this.isMobile ? '18px' : '16px';\n        notification.style.zIndex = '9999';\n        notification.style.textAlign = 'center';\n        notification.textContent = 'Settings applied and saved';\n        \n        document.body.appendChild(notification);\n        \n        // Remove after a few seconds\n        setTimeout(() => {\n            notification.style.opacity = '0';\n            notification.style.transition = 'opacity 0.5s';\n            \n            setTimeout(() => {\n                notification.remove();\n            }, 500);\n        }, 1500);\n    }\n    \n    show() {\n        const settingsContainer = document.getElementById('settings-container');\n        if (settingsContainer) {\n            // Update UI to reflect current settings\n            this.updateUI();\n            \n            // Show settings\n            settingsContainer.style.display = 'block';\n            this.isVisible = true;\n        }\n    }\n    \n    hide() {\n        const settingsContainer = document.getElementById('settings-container');\n        if (settingsContainer) {\n            settingsContainer.style.display = 'none';\n            this.isVisible = false;\n            \n            // Show the stargate UI when returning from settings\n            if (this.stargateInterface) {\n                this.stargateInterface.showStargateUI();\n            }\n        }\n    }\n    \n    toggle() {\n        if (this.isVisible) {\n            this.hide();\n        } else {\n            this.show();\n        }\n    }\n    \n    // Helper method to check if system can run high quality settings\n    detectSystemCapabilities() {\n        const performance = {};\n        \n        // Check device pixel ratio (higher on high-end devices)\n        performance.highDPI = window.devicePixelRatio > 1;\n        \n        // Check if WebGL2 is available\n        const canvas = document.createElement('canvas');\n        const gl = canvas.getContext('webgl2');\n        performance.webgl2 = !!gl;\n        \n        // Get GPU info if available\n        if (gl) {\n            const debugInfo = gl.getExtension('WEBGL_debug_renderer_info');\n            if (debugInfo) {\n                performance.gpu = gl.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL);\n            }\n        }\n        \n        // Check for recent browser features that suggest a modern device\n        performance.modernBrowser = \n            'IntersectionObserver' in window && \n            'requestAnimationFrame' in window &&\n            'localStorage' in window;\n            \n        // Make a recommendation based on the detected capabilities\n        if (performance.webgl2 && performance.highDPI && performance.modernBrowser) {\n            return 'high';\n        } else if (performance.webgl2 && performance.modernBrowser) {\n            return 'medium';\n        } else {\n            return 'low';\n        }\n    }\n    \n    detectMonitorRefreshRate() {\n        this.monitorRefreshRate = 60; // Default fallback value\n        \n        try {\n            // Method 1: requestAnimationFrame timing\n            let rafCount = 0;\n            let startTime = performance.now();\n            let prevTimestamp = 0;\n            const refreshRates = []; // Store intervals between frames\n            \n            const detectFrame = (timestamp) => {\n                if (prevTimestamp) {\n                    // Calculate time between frames\n                    const interval = timestamp - prevTimestamp;\n                    if (interval > 0) { // Avoid division by zero\n                        refreshRates.push(1000 / interval);\n                    }\n                }\n                \n                prevTimestamp = timestamp;\n                rafCount++;\n                \n                // Collect samples for about 500ms\n                if (timestamp - startTime < 500 && rafCount < 60) { \n                    requestAnimationFrame(detectFrame);\n                } else {\n                    // Calculate average refresh rate from samples\n                    if (refreshRates.length > 0) {\n                        // Remove outliers (values more than 20% from median)\n                        refreshRates.sort((a, b) => a - b);\n                        const median = refreshRates[Math.floor(refreshRates.length / 2)];\n                        const validRates = refreshRates.filter(rate => \n                            rate >= median * 0.8 && rate <= median * 1.2\n                        );\n                        \n                        // Calculate average from valid rates\n                        if (validRates.length > 0) {\n                            const sum = validRates.reduce((a, b) => a + b, 0);\n                            const avg = Math.round(sum / validRates.length);\n                            this.monitorRefreshRate = avg;\n                            console.log(`Detected monitor refresh rate: ${this.monitorRefreshRate}Hz`);\n                        }\n                    }\n                    \n                    // Method 2: Try screen.refresh if available in some browsers\n                    if (window.screen && 'refresh' in window.screen) {\n                        try {\n                            this.monitorRefreshRate = window.screen.refresh;\n                            console.log(`Using screen.refresh value: ${this.monitorRefreshRate}Hz`);\n                        } catch (error) {\n                            console.warn(\"Error accessing screen.refresh:\", error);\n                        }\n                    }\n                }\n            };\n            \n            requestAnimationFrame(detectFrame);\n        } catch (error) {\n            console.warn(\"Error detecting refresh rate:\", error);\n            // Keep the default value (60)\n        }\n    }\n} ","// startScreen.js - Manages the game's start screen UI\n\nexport class StartScreen {\n    constructor(game, ui) {\n        this.game = game;\n        this.ui = ui;\n        this.isVisible = false;\n        this.setupStartScreen();\n    }\n\n    setupStartScreen() {\n        // Create start screen container\n        const startScreen = document.createElement('div');\n        startScreen.id = 'start-screen';\n        startScreen.className = 'start-screen';\n        startScreen.style.display = 'none';\n\n        // Add content to start screen\n        startScreen.innerHTML = `\n            <div class=\"start-screen-inner\">\n                <h1 class=\"game-title\">Solar System Asteroid Miner</h1>\n                <div class=\"button-container\">\n                    <button id=\"play-button\" class=\"start-button\">Play</button>\n                    <button id=\"how-to-play-button\" class=\"start-button\">How to Play</button>\n                </div>\n                <div class=\"version\">v0.5.8</div>\n            </div>\n            \n            <div id=\"how-to-play-modal\" class=\"modal\">\n                <div class=\"modal-content\">\n                    <h2>How to Play</h2>\n                    \n                    <div class=\"gameplay-section\">\n                        <h3>Game Overview</h3>\n                        <p>Welcome to Solar System Asteroid Miner! Your mission is to mine asteroids, collect resources, and upgrade your ship.</p>\n                        \n                        <h4>Core Objectives:</h4>\n                        <ul>\n                            <li><strong>Mining:</strong> Target asteroids (E key), then use your mining laser (R key) to extract resources.</li>\n                            <li><strong>Trading:</strong> Dock at stargates (Q key) to sell resources and purchase ship upgrades.</li>\n                            <li><strong>Combat:</strong> Defend yourself against enemy ships using your weapons.</li>\n                            <li><strong>Exploration:</strong> Travel between star systems through stargates to discover new resources.</li>\n                            <li><strong>Anomalies:</strong> Find and collect energy orbs from space anomalies for credits.</li>\n                            <li><strong>Defense:</strong> Deploy autonomous laser turrets (T key) to protect mining operations.</li>\n                        </ul>\n                        \n                        <h4>Horde Mode:</h4>\n                        <p>Work toward activating the ultimate challenge - Horde Mode:</p>\n                        <ul>\n                            <li><strong>Endless Survival:</strong> Face waves of increasingly difficult enemies that never stop coming.</li>\n                            <li><strong>Escalating Difficulty:</strong> Enemy health, damage, speed, and spawn rates increase over time.</li>\n                            <li><strong>Preparation:</strong> Upgrade your ship's weapons, shields, and hull before activating.</li>\n                            <li><strong>Strategy:</strong> Deploy multiple laser turrets (T key) around your position to create defensive perimeters.</li>\n                            <li><strong>High Score:</strong> How long can you survive as difficulty scales to infinity?</li>\n                        </ul>\n                    </div>\n                    \n                    <div class=\"control-section\">\n                        <h3>Movement</h3>\n                        <div class=\"control-row\"><span class=\"key\">W</span> <span>Forward</span></div>\n                        <div class=\"control-row\"><span class=\"key\">S</span> <span>Backward</span></div>\n                        <div class=\"control-row\"><span class=\"key\">A</span> <span>Left</span></div>\n                        <div class=\"control-row\"><span class=\"key\">D</span> <span>Right</span></div>\n                        <div class=\"control-row\"><span class=\"key\">SHIFT</span> <span>Boost</span></div>\n                        <div class=\"control-row\"><span class=\"key\">Mouse</span> <span>Ship Rotation</span></div>\n                    </div>\n                    \n                    <div class=\"control-section\">\n                        <h3>Combat & Mining</h3>\n                        <div class=\"control-row\"><span class=\"key\">LMB</span> <span>Fire Weapons</span></div>\n                        <div class=\"control-row\"><span class=\"key\">E</span> <span>Toggle Target Lock-On</span></div>\n                        <div class=\"control-row\"><span class=\"key\">R</span> <span>Toggle Mining Laser</span></div>\n                        <div class=\"control-row\"><span class=\"key\">TAB</span> <span>Cycle Targets</span></div>\n                    </div>\n                    \n                    <div class=\"control-section\">\n                        <h3>Special</h3>\n                        <div class=\"control-row\"><span class=\"key\">T</span> <span>Deploy Laser Turret</span></div>\n                        <div class=\"control-row\"><span class=\"key\">Q</span> <span>Dock/Undock at Stargate</span></div>\n                        <div class=\"control-row\"><span class=\"key\">ESC</span> <span>Pause Game</span></div>\n                    </div>\n                    \n                    <button id=\"close-how-to-play\" class=\"modal-close-button\">Close</button>\n                </div>\n            </div>\n        `;\n\n        // Add to document body\n        document.body.appendChild(startScreen);\n\n        // Set up event listeners\n        this.setupEventListeners();\n    }\n\n    setupEventListeners() {\n        // Play button\n        const playButton = document.getElementById('play-button');\n        if (playButton) {\n            playButton.addEventListener('click', () => {\n                this.hide();\n                // Check if intro has been played before\n                const introPlayed = localStorage.getItem('introPlayed') === 'true';\n                if (introPlayed) {\n                    // Returning player - go directly to docked state\n                    if (this.game.startDocked) {\n                        this.game.startDocked();\n                    } else {\n                        console.error(\"Game.startDocked not found\");\n                    }\n                } else {\n                    // New player - start intro sequence\n                    if (this.game.startIntroSequence) {\n                        this.game.startIntroSequence();\n                    } else {\n                        console.error(\"Game.startIntroSequence not found\");\n                    }\n                }\n            });\n        }\n\n        // How to Play button\n        const howToPlayButton = document.getElementById('how-to-play-button');\n        const howToPlayModal = document.getElementById('how-to-play-modal');\n        const closeHowToPlayButton = document.getElementById('close-how-to-play');\n\n        if (howToPlayButton && howToPlayModal) {\n            howToPlayButton.addEventListener('click', () => {\n                howToPlayModal.style.display = 'flex';\n            });\n        }\n\n        if (closeHowToPlayButton && howToPlayModal) {\n            closeHowToPlayButton.addEventListener('click', () => {\n                howToPlayModal.style.display = 'none';\n            });\n\n            // Also close when clicking outside the modal content\n            howToPlayModal.addEventListener('click', (e) => {\n                if (e.target === howToPlayModal) {\n                    howToPlayModal.style.display = 'none';\n                }\n            });\n        }\n    }\n\n    show() {\n        const startScreen = document.getElementById('start-screen');\n        if (startScreen) {\n            startScreen.style.display = 'flex';\n            this.isVisible = true;\n            \n            // End timing for initialization when start screen becomes visible\n            if (window.initialTimestamp) {\n                const timeToStartScreen = performance.now() - window.initialTimestamp;\n                console.log(`Time to start screen visible: ${timeToStartScreen.toFixed(2)}ms`);\n                console.timeEnd(\"init\");\n            }\n        }\n    }\n\n    hide() {\n        const startScreen = document.getElementById('start-screen');\n        if (startScreen) {\n            startScreen.style.display = 'none';\n            this.isVisible = false;\n        }\n\n        // Also hide How to Play modal if it's open\n        const howToPlayModal = document.getElementById('how-to-play-modal');\n        if (howToPlayModal) {\n            howToPlayModal.style.display = 'none';\n        }\n    }\n} ","/**\r\n * Memory Management Utilities\r\n * Provides tools for optimizing memory usage and reducing garbage collection\r\n */\r\n\r\nimport * as THREE from 'three';\r\n\r\n// Typed Array Pools\r\nconst typedArrayPools = {\r\n    float32: [],\r\n    int32: [],\r\n    uint32: [],\r\n    uint16: [],\r\n    uint8: []\r\n};\r\n\r\n// Maximum pool sizes to prevent memory leaks\r\nconst MAX_POOL_SIZE = 100;\r\n\r\n/**\r\n * Get a Float32Array from the pool or create a new one\r\n * @param {number} size - Length of the array\r\n * @returns {Float32Array} - A Float32Array of the specified size\r\n */\r\nexport function getFloat32Array(size) {\r\n    const pool = typedArrayPools.float32;\r\n    \r\n    // Find an array of appropriate size in the pool\r\n    for (let i = 0; i < pool.length; i++) {\r\n        if (pool[i].length >= size) {\r\n            const array = pool.splice(i, 1)[0];\r\n            return array;\r\n        }\r\n    }\r\n    \r\n    // Create a new array if none found in pool\r\n    return new Float32Array(size);\r\n}\r\n\r\n/**\r\n * Release a Float32Array back to the pool\r\n * @param {Float32Array} array - The array to release\r\n */\r\nexport function releaseFloat32Array(array) {\r\n    if (typedArrayPools.float32.length < MAX_POOL_SIZE) {\r\n        // Zero out the array to prevent data leaks\r\n        array.fill(0);\r\n        typedArrayPools.float32.push(array);\r\n    }\r\n}\r\n\r\n/**\r\n * Get an Int32Array from the pool or create a new one\r\n * @param {number} size - Length of the array\r\n * @returns {Int32Array} - An Int32Array of the specified size\r\n */\r\nexport function getInt32Array(size) {\r\n    const pool = typedArrayPools.int32;\r\n    \r\n    for (let i = 0; i < pool.length; i++) {\r\n        if (pool[i].length >= size) {\r\n            const array = pool.splice(i, 1)[0];\r\n            return array;\r\n        }\r\n    }\r\n    \r\n    return new Int32Array(size);\r\n}\r\n\r\n/**\r\n * Release an Int32Array back to the pool\r\n * @param {Int32Array} array - The array to release\r\n */\r\nexport function releaseInt32Array(array) {\r\n    if (typedArrayPools.int32.length < MAX_POOL_SIZE) {\r\n        array.fill(0);\r\n        typedArrayPools.int32.push(array);\r\n    }\r\n}\r\n\r\n/**\r\n * Get a Uint32Array from the pool or create a new one\r\n * @param {number} size - Length of the array\r\n * @returns {Uint32Array} - A Uint32Array of the specified size\r\n */\r\nexport function getUint32Array(size) {\r\n    const pool = typedArrayPools.uint32;\r\n    \r\n    for (let i = 0; i < pool.length; i++) {\r\n        if (pool[i].length >= size) {\r\n            const array = pool.splice(i, 1)[0];\r\n            return array;\r\n        }\r\n    }\r\n    \r\n    return new Uint32Array(size);\r\n}\r\n\r\n/**\r\n * Release a Uint32Array back to the pool\r\n * @param {Uint32Array} array - The array to release\r\n */\r\nexport function releaseUint32Array(array) {\r\n    if (typedArrayPools.uint32.length < MAX_POOL_SIZE) {\r\n        array.fill(0);\r\n        typedArrayPools.uint32.push(array);\r\n    }\r\n}\r\n\r\n/**\r\n * Get a Uint16Array from the pool or create a new one\r\n * @param {number} size - Length of the array\r\n * @returns {Uint16Array} - A Uint16Array of the specified size\r\n */\r\nexport function getUint16Array(size) {\r\n    const pool = typedArrayPools.uint16;\r\n    \r\n    for (let i = 0; i < pool.length; i++) {\r\n        if (pool[i].length >= size) {\r\n            const array = pool.splice(i, 1)[0];\r\n            return array;\r\n        }\r\n    }\r\n    \r\n    return new Uint16Array(size);\r\n}\r\n\r\n/**\r\n * Release a Uint16Array back to the pool\r\n * @param {Uint16Array} array - The array to release\r\n */\r\nexport function releaseUint16Array(array) {\r\n    if (typedArrayPools.uint16.length < MAX_POOL_SIZE) {\r\n        array.fill(0);\r\n        typedArrayPools.uint16.push(array);\r\n    }\r\n}\r\n\r\n/**\r\n * Get a Uint8Array from the pool or create a new one\r\n * @param {number} size - Length of the array\r\n * @returns {Uint8Array} - A Uint8Array of the specified size\r\n */\r\nexport function getUint8Array(size) {\r\n    const pool = typedArrayPools.uint8;\r\n    \r\n    for (let i = 0; i < pool.length; i++) {\r\n        if (pool[i].length >= size) {\r\n            const array = pool.splice(i, 1)[0];\r\n            return array;\r\n        }\r\n    }\r\n    \r\n    return new Uint8Array(size);\r\n}\r\n\r\n/**\r\n * Release a Uint8Array back to the pool\r\n * @param {Uint8Array} array - The array to release\r\n */\r\nexport function releaseUint8Array(array) {\r\n    if (typedArrayPools.uint8.length < MAX_POOL_SIZE) {\r\n        array.fill(0);\r\n        typedArrayPools.uint8.push(array);\r\n    }\r\n}\r\n\r\n/**\r\n * Creates a pooled THREE.js BufferAttribute\r\n * @param {number} size - Number of vertices\r\n * @param {number} itemSize - Number of values per vertex (e.g. 3 for position, 2 for UV)\r\n * @returns {THREE.BufferAttribute} - A buffer attribute backed by a pooled typed array\r\n */\r\nexport function createPooledBufferAttribute(size, itemSize) {\r\n    const array = getFloat32Array(size * itemSize);\r\n    return new THREE.BufferAttribute(array, itemSize);\r\n}\r\n\r\n/**\r\n * Releases a pooled buffer attribute back to the pool\r\n * @param {THREE.BufferAttribute} attribute - The buffer attribute to release\r\n */\r\nexport function releasePooledBufferAttribute(attribute) {\r\n    if (attribute && attribute.array instanceof Float32Array) {\r\n        releaseFloat32Array(attribute.array);\r\n        attribute.array = null;\r\n    }\r\n}\r\n\r\n/**\r\n * Fixed-size array implementation to avoid dynamic array resizing\r\n */\r\nexport class FixedArray {\r\n    /**\r\n     * @param {number} size - Maximum size of the array\r\n     */\r\n    constructor(size) {\r\n        this.data = new Array(size);\r\n        this.length = 0;\r\n        this.capacity = size;\r\n    }\r\n    \r\n    /**\r\n     * Add an item to the array\r\n     * @param {*} item - Item to add\r\n     * @returns {boolean} - True if item was added, false if array is full\r\n     */\r\n    push(item) {\r\n        if (this.length < this.capacity) {\r\n            this.data[this.length++] = item;\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n    \r\n    /**\r\n     * Remove and return the last item\r\n     * @returns {*} - The last item or undefined if empty\r\n     */\r\n    pop() {\r\n        if (this.length === 0) return undefined;\r\n        const item = this.data[--this.length];\r\n        this.data[this.length] = undefined; // Avoid memory leaks\r\n        return item;\r\n    }\r\n    \r\n    /**\r\n     * Get item at index\r\n     * @param {number} index - Index to retrieve\r\n     * @returns {*} - Item at that index\r\n     */\r\n    get(index) {\r\n        if (index < 0 || index >= this.length) return undefined;\r\n        return this.data[index];\r\n    }\r\n    \r\n    /**\r\n     * Set item at index\r\n     * @param {number} index - Index to set\r\n     * @param {*} value - Value to set\r\n     */\r\n    set(index, value) {\r\n        if (index < 0 || index >= this.capacity) return;\r\n        if (index >= this.length) this.length = index + 1;\r\n        this.data[index] = value;\r\n    }\r\n    \r\n    /**\r\n     * Remove item at index\r\n     * @param {number} index - Index to remove\r\n     * @returns {boolean} - True if removal was successful\r\n     */\r\n    removeAt(index) {\r\n        if (index < 0 || index >= this.length) return false;\r\n        \r\n        // Shift all elements after index\r\n        for (let i = index; i < this.length - 1; i++) {\r\n            this.data[i] = this.data[i + 1];\r\n        }\r\n        \r\n        // Clear the last element to avoid memory leaks\r\n        this.data[--this.length] = undefined;\r\n        return true;\r\n    }\r\n    \r\n    /**\r\n     * Clear the array\r\n     */\r\n    clear() {\r\n        for (let i = 0; i < this.length; i++) {\r\n            this.data[i] = undefined;\r\n        }\r\n        this.length = 0;\r\n    }\r\n    \r\n    /**\r\n     * Iterate over each item\r\n     * @param {Function} callback - Function to call for each item\r\n     */\r\n    forEach(callback) {\r\n        for (let i = 0; i < this.length; i++) {\r\n            callback(this.data[i], i, this);\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Map array items to a new array\r\n     * @param {Function} callback - Function to transform each item\r\n     * @returns {Array} - New array with transformed items\r\n     */\r\n    map(callback) {\r\n        const result = new Array(this.length);\r\n        for (let i = 0; i < this.length; i++) {\r\n            result[i] = callback(this.data[i], i, this);\r\n        }\r\n        return result;\r\n    }\r\n    \r\n    /**\r\n     * Filter items into a new array\r\n     * @param {Function} callback - Predicate function to test each item\r\n     * @returns {Array} - New array with items that passed the test\r\n     */\r\n    filter(callback) {\r\n        const result = [];\r\n        for (let i = 0; i < this.length; i++) {\r\n            if (callback(this.data[i], i, this)) {\r\n                result.push(this.data[i]);\r\n            }\r\n        }\r\n        return result;\r\n    }\r\n}\r\n\r\n/**\r\n * Memory usage statistics tracking\r\n */\r\nexport const MemoryStats = {\r\n    vectorPoolSize: 0,\r\n    objectPoolSizes: {},\r\n    typedArrayPoolSizes: {},\r\n    \r\n    /**\r\n     * Update memory statistics\r\n     */\r\n    update() {\r\n        // Vector pool stats\r\n        if (window.vectorPool) {\r\n            this.vectorPoolSize = window.vectorPool.pool.length;\r\n        }\r\n        \r\n        // Object pool stats\r\n        if (window.objectPool) {\r\n            for (const type in window.objectPool.pools) {\r\n                this.objectPoolSizes[type] = window.objectPool.pools[type].objects.length;\r\n            }\r\n        }\r\n        \r\n        // Typed array pool stats\r\n        for (const type in typedArrayPools) {\r\n            this.typedArrayPoolSizes[type] = typedArrayPools[type].length;\r\n        }\r\n    },\r\n    \r\n    /**\r\n     * Get a formatted report of memory usage\r\n     * @returns {string} - Formatted memory stats\r\n     */\r\n    getReport() {\r\n        this.update();\r\n        \r\n        let report = \"Memory Pool Stats:\\n\";\r\n        \r\n        // Vector pool\r\n        report += `Vector Pool: ${this.vectorPoolSize} vectors\\n`;\r\n        \r\n        // Object pools\r\n        report += \"Object Pools:\\n\";\r\n        for (const type in this.objectPoolSizes) {\r\n            report += `  ${type}: ${this.objectPoolSizes[type]} objects\\n`;\r\n        }\r\n        \r\n        // Typed array pools\r\n        report += \"Typed Array Pools:\\n\";\r\n        for (const type in this.typedArrayPoolSizes) {\r\n            report += `  ${type}: ${this.typedArrayPoolSizes[type]} arrays\\n`;\r\n        }\r\n        \r\n        return report;\r\n    },\r\n    \r\n    /**\r\n     * Print memory stats to console\r\n     */\r\n    logReport() {\r\n        console.log(this.getReport());\r\n    }\r\n};\r\n\r\n// Make MemoryStats globally available for debug purposes\r\nwindow.MemoryStats = MemoryStats;\r\n\r\n// Export a no-op function that can replace often-created objects\r\n// to help identify memory hot spots\r\nexport function createNoOpVector() {\r\n    if (window.DEBUG_MODE) {\r\n        console.trace(\"Vector created at:\");\r\n    }\r\n    return window.vectorPool ? window.vectorPool.get() : { x: 0, y: 0, z: 0 };\r\n} ","// ui.js - Main UI class that integrates all UI components\n\nimport { HUD } from './ui/hud.js';\nimport { MobileHUD } from './ui/mobileHUD.js';\nimport { MiningDisplay } from './ui/miningDisplay.js';\nimport { TargetingUI } from './ui/targetingUI.js';\nimport { StargateInterface } from './ui/stargateInterface.js';\nimport { GameOverScreen } from './ui/gameOverScreen.js';\nimport { ControlsMenu } from './ui/controlsMenu.js';\nimport { StarMap } from './ui/starMap.js';\nimport { BlackjackGame } from './ui/blackjackGame.js';\nimport { Settings } from './ui/settings.js';\nimport { StartScreen } from './ui/startScreen.js';\nimport { MemoryStats } from '../utils/memoryManager.js';\nimport { MobileDetector } from '../utils/mobileDetector.js';\n\nexport class UI {\n    constructor(spaceship, environment) {\n        this.spaceship = spaceship;\n        this.environment = environment;\n        this.controls = null; // Will be set via setControls\n        this.audio = null; // Will be set via setAudio\n        this.isMobile = MobileDetector.isMobile();\n        \n        console.log(`Initializing UI components for ${this.isMobile ? 'mobile' : 'desktop'} device...`);\n        \n        // Load mobile CSS if on mobile device\n        if (this.isMobile) {\n            this.loadMobileCSS();\n        }\n        \n        // Initialize UI components\n        if (this.isMobile) {\n            this.hud = new MobileHUD(spaceship);\n        } else {\n            this.hud = new HUD(spaceship);\n        }\n        \n        this.miningDisplay = new MiningDisplay();\n        this.targetingUI = new TargetingUI();\n        this.stargateInterface = new StargateInterface();\n        this.gameOverScreen = new GameOverScreen();\n        this.controlsMenu = new ControlsMenu();\n        \n        // Initialize star map (requires environment, docking system, and stargate interface)\n        this.starMap = new StarMap(this.environment.starSystemGenerator, null, this.stargateInterface);\n        \n        // Initialize Blackjack game (will be fully initialized after audio is set)\n        this.blackjackGame = null;\n        \n        // Initialize settings (requires game instance)\n        this.settings = null;\n        \n        // Link starMap to stargateInterface\n        this.stargateInterface.setStarMap(this.starMap);\n        \n        // StartScreen will be initialized after game instance is available\n        this.startScreen = null;\n        \n        // Initialize performance monitoring if in debug mode\n        if (window.DEBUG_MODE) {\n            this.initializePerformanceMonitor();\n        }\n        \n        console.log(\"UI components initialized\");\n    }\n    \n    loadMobileCSS() {\n        // Create link element for mobile CSS\n        const mobileCSS = document.createElement('link');\n        mobileCSS.rel = 'stylesheet';\n        mobileCSS.href = 'css/mobile.css';\n        mobileCSS.type = 'text/css';\n        \n        // Add to document head\n        document.head.appendChild(mobileCSS);\n        \n        console.log(\"Mobile CSS loaded\");\n    }\n    \n    setAudio(audio) {\n        console.log(\"Setting audio reference in UI\");\n        this.audio = audio;\n        \n        // Now that we have audio, initialize BlackjackGame\n        if (this.audio) {\n            // Make sure spaceship has cargo property\n            if (this.spaceship && !this.spaceship.cargo) {\n                this.spaceship.cargo = { iron: 0, gold: 0, platinum: 0 };\n                console.warn(\"UI: Created empty cargo object for spaceship\");\n            }\n            \n            this.blackjackGame = new BlackjackGame(null, this.spaceship, this.audio);\n            console.log(\"UI: Created BlackjackGame with spaceship:\", this.spaceship);\n            \n            // Link blackjackGame to stargateInterface\n            this.stargateInterface.setBlackjackGame(this.blackjackGame);\n        }\n    }\n    \n    setControls(controls) {\n        console.log(\"Setting controls reference in UI\");\n        this.controls = controls;\n        \n        // Now that we have controls, we can set it in components that need it\n        if (this.miningDisplay.setControls) {\n            this.miningDisplay.setControls(this.controls);\n        }\n        \n        // Set controls in the mobile HUD if we're on mobile\n        if (this.isMobile && this.hud && this.hud.setControls) {\n            this.hud.setControls(this.controls);\n        }\n        \n        // Update star map with docking system\n        if (this.starMap && this.controls.dockingSystem) {\n            this.starMap.dockingSystem = this.controls.dockingSystem;\n        }\n        \n        // Set up button handlers\n        this.setupEventHandlers();\n    }\n    \n    // Initialize settings with the game instance\n    initializeSettings(game) {\n        if (!game) {\n            console.error(\"Cannot initialize settings without game instance\");\n            return;\n        }\n        \n        // Create settings\n        this.settings = new Settings(game);\n        \n        // Link settings to stargateInterface\n        this.stargateInterface.setSettings(this.settings);\n        \n        // Initialize start screen now that we have game instance\n        this.startScreen = new StartScreen(game, this);\n        \n        console.log(\"Settings and StartScreen initialized with game instance\");\n    }\n    \n    /**\n     * Set up event handlers\n     */\n    setupEventHandlers() {\n        console.log(\"Setting up UI event handlers\");\n        \n        // Set up controls menu button handler\n        if (this.controlsMenu && this.controlsMenu.setupButtonHandler) {\n            this.controlsMenu.setupButtonHandler();\n        }\n        \n        // Set up stargate UI control handlers if controls are available\n        if (this.controls && this.controls.setupStargateUIControls) {\n            this.controls.setupStargateUIControls();\n        }\n        \n        // Listen for UI notification events\n        window.mainMessageBus.subscribe('ui.notification', this.handleNotification.bind(this));\n        \n        // Add resize handler to update mobile detection\n        window.addEventListener('resize', () => {\n            const wasMobile = this.isMobile;\n            this.isMobile = MobileDetector.isMobile();\n            \n            // If device type changed, reload the page to apply correct UI\n            if (wasMobile !== this.isMobile) {\n                console.log(`Device type changed from ${wasMobile ? 'mobile' : 'desktop'} to ${this.isMobile ? 'mobile' : 'desktop'}`);\n                location.reload();\n            }\n        });\n    }\n    \n    /**\n     * Handle UI notification events\n     * @param {Object} message The notification message\n     */\n    handleNotification(message) {\n        if (message && message.data) {\n            const content = message.data.message || 'System notification';\n            const duration = message.data.duration || 3000;\n            this.showNotification(content, duration);\n        }\n    }\n    \n    /**\n     * Handle game over event\n     * @param {Object} message Event data\n     */\n    handleGameOver(message) {\n        // ... existing code ...\n    }\n    \n    update() {\n        // Update appropriate HUD based on device type\n        if (this.hud && this.hud.update) {\n            this.hud.update();\n        }\n        \n        if (this.miningDisplay && this.miningDisplay.update) {\n            this.miningDisplay.update();\n        }\n        \n        // Update touch controls if on mobile\n        if (this.isMobile && this.controls && this.controls.touchControls) {\n            this.controls.touchControls.update();\n        }\n    }\n    \n    updateLocation(locationName) {\n        // Get the current star system name from the environment\n        let systemName = 'Unknown System';\n        if (this.environment && this.environment.starSystemGenerator) {\n            const systemData = this.environment.starSystemGenerator.getCurrentSystemData();\n            systemName = systemData ? systemData.name : 'Unknown System';\n        }\n        \n        if (this.hud && this.hud.updateLocation) {\n            // Only pass the system name since we removed the location display\n            this.hud.updateLocation(null, systemName);\n        }\n    }\n    \n    updateCoordinates(x, y, z) {\n        if (this.hud && this.hud.updateCoordinates) {\n            this.hud.updateCoordinates(x, y, z);\n        }\n    }\n    \n    updateFPS(fps, cap) {\n        if (this.hud && this.hud.updateFPS) {\n            // Pass both actual FPS and cap to HUD\n            this.hud.updateFPS(fps, cap);\n            \n            // Control visibility of FPS display based on settings\n            if (this.settings && this.settings.settings) {\n                const fpsDisplay = document.getElementById('fps-display');\n                if (fpsDisplay) {\n                    fpsDisplay.style.display = this.settings.settings.showFPS ? 'block' : 'none';\n                }\n            }\n        }\n    }\n    \n    /**\n     * Show a notification message to the user\n     * @param {string} message - The message to display\n     * @param {number} duration - Time in milliseconds to show the notification\n     */\n    showNotification(message, duration = 3000) {\n        const notificationsArea = document.getElementById('notifications-area');\n        if (!notificationsArea) return;\n        \n        const notification = document.createElement('div');\n        notification.className = 'notification';\n        notification.textContent = message;\n        notification.style.backgroundColor = 'rgba(6, 22, 31, 0.7)';\n        notification.style.backdropFilter = 'blur(5px)';\n        notification.style.color = 'rgba(120, 220, 232, 0.9)';\n        notification.style.padding = '8px 15px';\n        notification.style.borderRadius = '5px';\n        notification.style.marginBottom = '10px';\n        notification.style.border = '1px solid rgba(120, 220, 232, 0.3)';\n        notification.style.boxShadow = '0 0 10px rgba(120, 220, 232, 0.2)';\n        notification.style.textAlign = 'center';\n        notification.style.opacity = '0';\n        notification.style.transition = 'opacity 0.3s';\n        \n        notificationsArea.appendChild(notification);\n        \n        // Fade in\n        setTimeout(() => {\n            notification.style.opacity = '1';\n        }, 10);\n        \n        // Fade out and remove after duration\n        setTimeout(() => {\n            notification.style.opacity = '0';\n            setTimeout(() => {\n                if (notification.parentNode) {\n                    notification.parentNode.removeChild(notification);\n                }\n            }, 300);\n        }, duration);\n    }\n    \n    showGameOver(resources, message) {\n        console.log(\"Showing game over screen\");\n        console.log(\"Resources data:\", resources); // Add logging to see structure\n        \n        // Show game over screen\n        if (this.gameOverScreen && this.gameOverScreen.show) {\n            // Make sure element exists in DOM first\n            if (!document.getElementById('game-over-container')) {\n                console.warn(\"Game over container not found in DOM, recreating\");\n                this.gameOverScreen.setupGameOverScreen();\n            }\n            \n            // Pass the audio reference to the game over screen\n            if (this.audio) {\n                this.gameOverScreen.audio = this.audio;\n            }\n            \n            // Pass the message object through directly - gameOverScreen will handle the parsing\n            this.gameOverScreen.show(resources, message);\n            \n            // Remove all direct sound playback from here\n            // The GameOverScreen will handle playing the sound\n        } else {\n            console.error(\"Game over screen not properly initialized\");\n            // Create a very simple fallback\n            const fallbackOverlay = document.createElement('div');\n            fallbackOverlay.id = 'fallback-overlay';\n            fallbackOverlay.style.position = 'fixed';\n            fallbackOverlay.style.top = '0';\n            fallbackOverlay.style.left = '0';\n            fallbackOverlay.style.width = '100%';\n            fallbackOverlay.style.height = '100%';\n            fallbackOverlay.style.backgroundColor = 'rgba(0, 0, 0, 0.8)';\n            fallbackOverlay.style.display = 'flex';\n            fallbackOverlay.style.justifyContent = 'center';\n            fallbackOverlay.style.alignItems = 'center';\n            fallbackOverlay.style.zIndex = '9999';\n            \n            // Extract message text if it's an object\n            const messageText = typeof message === 'string' ? message : \n                               (message && message.data && message.data.reason ? message.data.reason : \n                                'Your ship was destroyed!');\n            \n            const content = document.createElement('div');\n            content.innerHTML = `\n                <h1 style=\"color: #ff3030; font-size: 48px; margin-bottom: 20px;\">GAME OVER</h1>\n                <p style=\"color: #fff; font-size: 24px; margin-bottom: 30px;\">${messageText}</p>\n                <button id=\"restart-btn\" style=\"padding: 15px 30px; background-color: #ff3030; color: #fff; border: none; \n                    font-size: 24px; cursor: pointer; border-radius: 5px;\">RESTART GAME</button>\n            `;\n            fallbackOverlay.appendChild(content);\n            document.body.appendChild(fallbackOverlay);\n            \n            // Add restart button handler\n            document.getElementById('restart-btn').addEventListener('click', () => {\n                location.reload();\n            });\n        }\n        \n        // Hide other UI elements\n        this.hideUI();\n    }\n    \n    hideUI() {\n        console.log(\"Hiding UI elements\");\n        \n        // Force hide ALL UI elements during intro sequence\n        if (window.game && window.game.introSequenceActive) {\n            console.log(\"Intro sequence active - forcing ALL UI elements to be hidden\");\n            \n            // Get references to each UI element we need to hide\n            const elements = [\n                document.getElementById('hud-container'),\n                document.getElementById('mobile-hud-container'),\n                document.getElementById('pointer-lock-instructions'),\n                document.getElementById('notifications-area')\n            ];\n            \n            // Hide each found element (being careful to check if it exists)\n            elements.forEach(element => {\n                if (element) {\n                    element.style.display = 'none';\n                }\n            });\n            \n            // Hide any additional UI panels that might be visible\n            const allPanels = document.querySelectorAll('.ui-panel, .panel, .hud-panel, .status-panel');\n            allPanels.forEach(panel => {\n                panel.style.display = 'none';\n            });\n            \n            return; // Skip standard hiding - we've handled everything\n        }\n        \n        // Standard UI hiding for non-intro cases\n        // Hide main UI elements but not game over screen\n        if (this.hud && this.hud.hide) {\n            this.hud.hide();\n        }\n        \n        if (this.miningDisplay && this.miningDisplay.hide) {\n            this.miningDisplay.hide();\n        }\n        \n        if (this.targetingUI && this.targetingUI.hideLockOn) {\n            this.targetingUI.hideLockOn();\n        }\n        \n        if (this.targetingUI && this.targetingUI.hideTargetInfo) {\n            this.targetingUI.hideTargetInfo();\n        }\n        \n        if (this.stargateInterface && this.stargateInterface.hideDockingPrompt) {\n            this.stargateInterface.hideDockingPrompt();\n        }\n        \n        // Hide touch controls if on mobile\n        if (this.isMobile && this.controls && this.controls.touchControls) {\n            this.controls.touchControls.hide();\n        }\n    }\n    \n    showUI() {\n        console.log(\"Showing UI elements\");\n        \n        // Don't show UI if intro sequence is active\n        if (window.game && window.game.introSequenceActive) {\n            console.warn(\"showUI called while intro is still active - not showing UI elements\");\n            return; // Exit early - don't show any UI during intro\n        }\n        \n        // Don't show UI if start screen is visible\n        if (this.startScreen && this.startScreen.isVisible) {\n            console.warn(\"showUI called while start screen is visible - not showing UI elements\");\n            return;\n        }\n        \n        // First, show UI components through their interfaces\n        if (this.hud && this.hud.show) {\n            console.log(\"Calling hud.show()\");\n            this.hud.show();\n        }\n        \n        if (this.miningDisplay && this.miningDisplay.show) {\n            this.miningDisplay.show();\n        }\n        \n        // Show touch controls if on mobile\n        if (this.isMobile && this.controls && this.controls.touchControls) {\n            this.controls.touchControls.show();\n        }\n        \n        // FORCE restore elements that might have been forcibly hidden\n        // But only if intro is not active\n        if (window.game && window.game.introSequenceActive) {\n            return; // Double-check intro is not active before forcing visibility\n        }\n        \n        console.log(\"Forcing all UI elements to be displayed\");\n        \n        // Ensure HUD container is visible\n        const hudContainer = document.getElementById('hud-container');\n        if (hudContainer) {\n            console.log(\"Setting hudContainer to display:block\");\n            hudContainer.style.display = 'block';\n            hudContainer.style.visibility = 'visible'; // Double ensure visibility\n        } else {\n            console.warn(\"HUD container not found - could not make visible\");\n        }\n        \n        // Ensure mobile HUD is visible if on mobile\n        const mobileHudContainer = document.getElementById('mobile-hud-container');\n        if (mobileHudContainer) {\n            mobileHudContainer.style.display = 'block';\n            mobileHudContainer.style.visibility = 'visible';\n        }\n        \n        // Show pointer lock instructions only if not locked\n        const pointerLockInstructions = document.getElementById('pointer-lock-instructions');\n        if (pointerLockInstructions && !document.pointerLockElement) {\n            pointerLockInstructions.style.display = 'block';\n            pointerLockInstructions.style.visibility = 'visible';\n        }\n        \n        // Show notifications area\n        const notificationsArea = document.getElementById('notifications-area');\n        if (notificationsArea) {\n            notificationsArea.style.display = 'block';\n            notificationsArea.style.visibility = 'visible';\n        }\n\n        // Also show any panels that might have been hidden\n        const allPanels = document.querySelectorAll('.ui-panel, .panel, .hud-panel, .status-panel');\n        allPanels.forEach(panel => {\n            panel.style.display = 'block';\n            panel.style.visibility = 'visible';\n        });\n    }\n    \n    /**\n     * Initialize performance monitor for debugging\n     */\n    initializePerformanceMonitor() {\n        // Create container for performance stats\n        const statsContainer = document.createElement('div');\n        statsContainer.id = 'performance-stats';\n        statsContainer.style.position = 'fixed';\n        statsContainer.style.bottom = '10px';\n        statsContainer.style.right = '10px';\n        statsContainer.style.backgroundColor = 'rgba(0, 0, 0, 0.7)';\n        statsContainer.style.color = '#0ff';\n        statsContainer.style.padding = '10px';\n        statsContainer.style.fontFamily = 'monospace';\n        statsContainer.style.fontSize = '12px';\n        statsContainer.style.borderRadius = '4px';\n        statsContainer.style.zIndex = '1000';\n        statsContainer.style.maxWidth = '300px';\n        statsContainer.style.maxHeight = '200px';\n        statsContainer.style.overflow = 'auto';\n        \n        // Memory stats container\n        const memoryStats = document.createElement('div');\n        memoryStats.id = 'memory-stats';\n        statsContainer.appendChild(memoryStats);\n        \n        // FPS counter\n        const fpsCounter = document.createElement('div');\n        fpsCounter.id = 'fps-counter';\n        statsContainer.appendChild(fpsCounter);\n        \n        // Add to DOM\n        document.body.appendChild(statsContainer);\n        \n        // Update stats every second\n        this.statsInterval = setInterval(() => {\n            // Update memory stats display\n            memoryStats.innerHTML = MemoryStats.getReport().replace(/\\n/g, '<br>');\n            \n            // Display current FPS if available\n            if (window.game && window.game.currentFPS) {\n                fpsCounter.innerHTML = `FPS: ${Math.round(window.game.currentFPS)}`;\n            }\n        }, 1000);\n    }\n    \n    // Make sure to clean up stats interval when necessary\n    onDisabled() {\n        // Clear stats interval if it exists\n        if (this.statsInterval) {\n            clearInterval(this.statsInterval);\n            this.statsInterval = null;\n        }\n    }\n} ","// audio.js - Handles game audio, both music and sound effects with improved resource management\n\nimport { getAbsolutePath } from '../utils/pathUtils.js';\n\nexport class AudioManager {\n    constructor() {\n        // Initialize Web Audio API context\n        this.audioContext = null;\n        try {\n            this.audioContext = new (window.AudioContext || window.webkitAudioContext)();\n            console.log(\"Web Audio API context created successfully\");\n        } catch (error) {\n            console.error(\"Failed to create Web Audio API context:\", error);\n        }\n        \n        this.sounds = {}; // Stores decoded AudioBuffers\n        this.soundSources = {}; // Tracks currently playing sound sources\n        this.backgroundMusic = [];\n        this.currentMusicIndex = 0;\n        this.currentMusic = null;\n        this.isMuted = false;\n        this.thrustSound = null;\n        this.music = []; // Store all background music tracks\n        this.musicVolume = 0.21; // Reduced by 30% from 0.3\n        this.sfxVolume = 0.5; // Default sound effects volume\n        \n        // Store active audio nodes\n        this.activeNodes = new Set();\n        \n        // Track active continuous sounds\n        this.activeSounds = {\n            laser: null,\n            thrust: null,\n            \"mining-laser\": null\n        };\n        \n        // Track if the user has interacted with the page (for autoplay policies)\n        this.userHasInteracted = false;\n        \n        console.log(\"Initializing audio manager with Web Audio API...\");\n        \n        // Set up compatibility layer for intro sequence\n        this.initializeToneCompatibility();\n        \n        // Listen for user interaction to enable audio\n        this.setupUserInteractionListener();\n        \n        // Set up garbage collection interval\n        this.setupGarbageCollection();\n    }\n    \n    // Set up regular garbage collection for unused audio nodes\n    setupGarbageCollection() {\n        // Clean up inactive nodes every 30 seconds\n        this.gcInterval = setInterval(() => this.cleanupInactiveNodes(), 30000);\n        console.log(\"Audio garbage collection scheduled\");\n    }\n    \n    // Clean up inactive audio nodes to prevent memory leaks\n    cleanupInactiveNodes() {\n        let count = 0;\n        this.activeNodes.forEach(node => {\n            // Check if node is inactive\n            if (node._inactive || (node.disposed === true)) {\n                this.activeNodes.delete(node);\n                count++;\n            }\n        });\n        \n        if (count > 0) {\n            console.log(`Audio manager: cleaned up ${count} inactive audio objects`);\n        }\n    }\n    \n    // Track an audio node for garbage collection\n    trackNode(node) {\n        if (node) {\n            this.activeNodes.add(node);\n        }\n        return node;\n    }\n    \n    // Initialize a minimal Tone.js compatibility layer for the intro sequence\n    initializeToneCompatibility() {\n        // Create a dummy masterEQ object that the intro sequence can connect to\n        // This allows the intro sequence code to remain unchanged\n        this.masterEQ = {\n            // Dummy connect method that returns the input\n            connect: function(node) {\n                return node;\n            }\n        };\n        \n        console.log(\"Audio compatibility layer initialized for intro sequence\");\n    }\n    \n    // Initialize audio - load all sounds and music\n    async initialize() {\n        try {\n            console.log(\"Loading audio files...\");\n            \n            // Ensure audio context is resumed on first user interaction\n            if (this.audioContext && this.audioContext.state === 'suspended') {\n                this.resumeAudioContext();\n            }\n            \n            // Check if the sound directories exist for music\n            await this.checkSoundDirectories();\n            \n            // Load only the essential UI sounds first for faster startup\n            await this.preDecodeEssentialSounds();\n            \n            // Load music in the background (non-blocking)\n            this.loadBackgroundMusic().catch(error => {\n                console.error(\"Error loading background music:\", error);\n            });\n            \n            console.log(\"Essential audio initialization complete\");\n            \n            // Music will play automatically once the user interacts with the page\n            // If the user has already interacted, we can play immediately\n            if (this.userHasInteracted) {\n                this.playBackgroundMusic();\n            } else {\n                console.log(\"Music playback waiting for user interaction.\");\n            }\n            \n            return true;\n        } catch (error) {\n            console.error(\"Error initializing audio:\", error);\n            return false;\n        }\n    }\n    \n    // Pre-decode only essential UI sounds for quick startup\n    async preDecodeEssentialSounds() {\n        try {\n            console.log(\"Pre-decoding essential UI sounds...\");\n            \n            // List of essential sounds needed for UI interaction\n            const essentialSounds = [\n                { name: 'boink', path: 'sounds/effects/boink.wav' },\n                { name: 'phaserUp', path: 'sounds/effects/phaserUp.wav' },\n                { name: 'phaserDown', path: 'sounds/effects/phaserDown.wav' },\n            ];\n            \n            // Create a promise for each sound to load\n            const loadPromises = essentialSounds.map(sound => \n                this.loadAndDecodeSound(sound.name, this.getPath(sound.path))\n            );\n            \n            // Wait for all essential sounds to be loaded and decoded\n            await Promise.all(loadPromises);\n            \n            console.log(\"Essential UI sounds pre-decoded successfully\");\n            \n            // Schedule loading of remaining gameplay sounds in the background \n            // after a short delay to let the UI fully initialize\n            setTimeout(() => {\n                this.loadGameplaySounds();\n            }, 1000);\n            \n        } catch (error) {\n            console.error(\"Error pre-decoding essential sounds:\", error);\n            this.createDummySounds();\n        }\n    }\n    \n    // Load remaining gameplay sounds in the background\n    async loadGameplaySounds() {\n        try {\n            console.log(\"Loading gameplay sounds in background...\");\n            \n            // List of gameplay sounds to load\n            const gameplaySounds = [\n                { name: 'thrust', path: 'sounds/effects/thrust.wav' },\n                { name: 'laser', path: 'sounds/effects/laser.wav' },\n                { name: 'mining-laser', path: 'sounds/effects/mining-laser.wav' },\n                { name: 'explosion', path: 'sounds/effects/explosion.wav' },\n            ];\n            \n            // Load sounds sequentially to avoid overwhelming the audio decoder\n            for (const sound of gameplaySounds) {\n                try {\n                    await this.loadAndDecodeSound(sound.name, this.getPath(sound.path));\n                } catch (err) {\n                    console.warn(`Could not load gameplay sound ${sound.name}:`, err);\n                }\n            }\n            \n            // Explicitly set up projectile sound using the laser sound\n            // This is needed for weapon firing\n            if (this.sounds.laser && !this.sounds.projectile) {\n                console.log(\"Setting up projectile sound using laser sound buffer\");\n                this.sounds.projectile = this.sounds.laser;\n            }\n            \n            console.log(\"All gameplay sounds loaded successfully\");\n        } catch (error) {\n            console.error(\"Error loading gameplay sounds:\", error);\n        }\n    }\n    \n    // Pre-decode all sound effects using Web Audio API (legacy method, kept for compatibility)\n    async preDecodeAllSoundEffects() {\n        try {\n            console.log(\"Using optimized sound loading path instead of preDecodeAllSoundEffects\");\n            // Load essential sounds first\n            await this.preDecodeEssentialSounds();\n            // Then load gameplay sounds\n            await this.loadGameplaySounds();\n        } catch (error) {\n            console.error(\"Error pre-decoding sound effects:\", error);\n            this.createDummySounds();\n        }\n    }\n    \n    // Load and decode a sound file using Web Audio API\n    async loadAndDecodeSound(name, url) {\n        try {\n            console.log(`Loading and decoding sound: ${name} from ${url}`);\n            \n            // Fetch the audio file\n            const response = await fetch(url);\n            if (!response.ok) {\n                throw new Error(`Failed to fetch sound ${name}: ${response.status} ${response.statusText}`);\n            }\n            \n            // Get the audio data as an ArrayBuffer\n            const audioData = await response.arrayBuffer();\n            \n            // Decode the audio data\n            const audioBuffer = await this.audioContext.decodeAudioData(audioData);\n            \n            // Store the decoded buffer\n            this.sounds[name] = audioBuffer;\n            \n            console.log(`Sound ${name} loaded and decoded successfully`);\n            return audioBuffer;\n        } catch (error) {\n            console.error(`Error loading and decoding sound ${name}:`, error);\n            \n            // Create a dummy buffer for this sound to prevent errors\n            this.sounds[name] = null;\n            throw error;\n        }\n    }\n    \n    // Resume audio context on user interaction\n    resumeAudioContext() {\n        if (this.audioContext && this.audioContext.state === 'suspended') {\n            this.audioContext.resume().then(() => {\n                console.log(\"AudioContext resumed successfully\");\n            }).catch(error => {\n                console.error(\"Failed to resume AudioContext:\", error);\n            });\n        }\n    }\n    \n    // Check if the required sound directories exist and notify user if they don't\n    async checkSoundDirectories() {\n        // Check for sounds directory\n        const soundsDirExists = await this.checkFileExists(this.getPath('sounds'));\n        if (!soundsDirExists.exists) {\n            console.warn(\"Sounds directory not found, but will attempt to load files directly anyway.\");\n        }\n        \n        // Check for soundtrack directory\n        const soundtrackDirExists = await this.checkFileExists(this.getPath('sounds/soundtrack'));\n        if (!soundtrackDirExists.exists) {\n            console.warn(\"Soundtrack directory not found, but will attempt to load files directly anyway.\");\n        }\n        \n        // Check for sound effects directory\n        const effectsDirExists = await this.checkFileExists(this.getPath('sounds/effects'));\n        if (!effectsDirExists.exists) {\n            console.warn(\"Sound effects directory not found. Some sounds may not play correctly.\");\n        }\n        \n        // Always return true to continue loading process\n        return true;\n    }\n    \n    // Show a notification to the user when a directory is missing\n    showDirectoryMissingNotification(directory) {\n        console.warn(`Directory not found: ${directory}`);\n        \n        // Create a notification element\n        const notification = document.createElement('div');\n        notification.style.position = 'fixed';\n        notification.style.top = '20px';\n        notification.style.left = '50%';\n        notification.style.transform = 'translateX(-50%)';\n        notification.style.backgroundColor = 'rgba(0, 0, 0, 0.7)';\n        notification.style.color = '#ff4400';\n        notification.style.padding = '10px 15px';\n        notification.style.borderRadius = '5px';\n        notification.style.zIndex = '9999';\n        notification.style.fontSize = '14px';\n        notification.style.maxWidth = '80%';\n        notification.style.textAlign = 'center';\n        \n        // Add message\n        notification.innerHTML = `\n            <div style=\"margin-bottom: 5px;\">\n                <strong>Note:</strong> ${directory} directory not found.\n            </div>\n            <div style=\"font-size: 12px; color: #aaa;\">\n                Game will continue with limited audio. This is normal when running on GitHub Pages.\n            </div>\n        `;\n        \n        // Add close button\n        const closeButton = document.createElement('div');\n        closeButton.style.position = 'absolute';\n        closeButton.style.top = '5px';\n        closeButton.style.right = '10px';\n        closeButton.style.cursor = 'pointer';\n        closeButton.style.color = '#aaa';\n        closeButton.textContent = '✕';\n        closeButton.addEventListener('click', () => notification.remove());\n        notification.appendChild(closeButton);\n        \n        // Add to document\n        document.body.appendChild(notification);\n        \n        // Auto-remove after 5 seconds\n        setTimeout(() => {\n            if (document.body.contains(notification)) {\n                notification.style.opacity = '0';\n                notification.style.transition = 'opacity 0.5s ease';\n                setTimeout(() => {\n                    if (document.body.contains(notification)) {\n                        notification.remove();\n                    }\n                }, 500);\n            }\n        }, 5000);\n    }\n    \n    // Set up a listener to detect the first user interaction\n    setupUserInteractionListener() {\n        const handleInteraction = () => {\n            if (!this.userHasInteracted) {\n                this.userHasInteracted = true;\n                console.log(\"User interaction detected, enabling audio playback\");\n                \n                // Resume AudioContext if it's suspended\n                this.resumeAudioContext();\n                \n                // Start playing background music once the user interacts\n                this.playBackgroundMusic();\n                \n                // Clean up the event listeners\n                document.removeEventListener('click', handleInteraction);\n                document.removeEventListener('keydown', handleInteraction);\n                document.removeEventListener('touchstart', handleInteraction);\n            }\n        };\n        \n        // Add event listeners for user interactions\n        document.addEventListener('click', handleInteraction);\n        document.addEventListener('keydown', handleInteraction);\n        document.addEventListener('touchstart', handleInteraction);\n        \n        // Additional handling specifically for mobile devices\n        if ('ontouchstart' in window || navigator.maxTouchPoints > 0) {\n            console.log(\"Mobile device detected - adding additional audio handlers\");\n            \n            // Force audio context resumption on specific UI interactions for mobile\n            const forceAudioResume = () => {\n                this.userHasInteracted = true;\n                \n                // Resume AudioContext if it's suspended\n                this.resumeAudioContext();\n                \n                // Ensure background music is playing\n                if (this.music.length > 0 && !this.muted) {\n                    const currentTrack = this.music[0];\n                    if (currentTrack.paused) {\n                        console.log(\"Mobile: Forcing background music playback\");\n                        this.playBackgroundMusic();\n                    }\n                }\n            };\n            \n            // Add these handlers to common UI interaction points\n            document.addEventListener('touchend', forceAudioResume, {passive: true});\n            \n            // Attach to specific game buttons when they're created\n            const attachToButtons = () => {\n                // Check for UI elements every 500ms for 5 seconds after page load\n                let attempts = 0;\n                const interval = setInterval(() => {\n                    attempts++;\n                    \n                    // Find and attach to important action buttons\n                    const actionButtons = document.querySelectorAll('button');\n                    if (actionButtons.length > 0) {\n                        console.log(`Mobile: Found ${actionButtons.length} buttons to attach audio handlers`);\n                        actionButtons.forEach(button => {\n                            if (!button.hasAudioHandler) {\n                                button.addEventListener('touchend', forceAudioResume, {passive: true});\n                                button.hasAudioHandler = true;\n                            }\n                        });\n                    }\n                    \n                    // Stop checking after 10 attempts (5 seconds)\n                    if (attempts >= 10) {\n                        clearInterval(interval);\n                    }\n                }, 500);\n            };\n            \n            // Run initially and also after document is fully loaded\n            attachToButtons();\n            if (document.readyState === 'complete') {\n                attachToButtons();\n            } else {\n                window.addEventListener('load', attachToButtons);\n            }\n        }\n    }\n    \n    // Load all music files from the soundtrack folder\n    async loadBackgroundMusic() {\n        try {\n            console.log(\"Loading soundtrack files...\");\n            \n            // Directly use the exact soundtrack files from the user's folder\n            const soundtrackFiles = [\n                this.getPath('sounds/soundtrack/The Sound of Lightyears.wav'),\n                this.getPath('sounds/soundtrack/Aurora Drifts.wav'),\n                this.getPath('sounds/soundtrack/Tidal Lock.wav'),\n                this.getPath('sounds/soundtrack/Solar Drift.wav'),\n                this.getPath('sounds/soundtrack/Orbital Resonance.wav'),\n                this.getPath('sounds/soundtrack/Starlight Trails.wav'),\n                this.getPath('sounds/soundtrack/Orbit Bloom.wav')\n            ];\n            \n            console.log(`Loading ${soundtrackFiles.length} soundtrack files...`);\n            \n            // Load the music files\n            await this.loadMusicFiles(soundtrackFiles);\n            \n        } catch (error) {\n            console.error(\"Error loading background music:\", error);\n            \n            // Create a dummy audio element if loading fails\n            console.warn(\"Falling back to a dummy silent track\");\n            const dummyAudio = new Audio();\n            dummyAudio.loop = true;\n            this.music.push(dummyAudio);\n        }\n    }\n    \n    // Helper method to check if a file exists\n    async checkFileExists(path) {\n        console.log(`Checking if file/directory exists: ${path}`);\n        try {\n            // Try to fetch the resource\n            const response = await fetch(path, { \n                method: 'HEAD',\n                cache: 'no-cache' // Avoid caching issues\n            });\n            \n            console.log(`Fetch response for ${path}: status=${response.status}, ok=${response.ok}`);\n            \n            return { \n                path, \n                exists: response.ok \n            };\n        } catch (err) {\n            console.error(`Error checking if file exists (${path}):`, err);\n            return { path, exists: false };\n        }\n    }\n    \n    // Helper method to handle paths correctly for both local and GitHub Pages deployment\n    getPath(relativePath) {\n        return getAbsolutePath(relativePath);\n    }\n    \n    // Fisher-Yates shuffle algorithm for arrays\n    shuffleArray(array) {\n        let currentIndex = array.length, randomIndex;\n        \n        // While there remain elements to shuffle\n        while (currentIndex > 0) {\n            // Pick a remaining element\n            randomIndex = Math.floor(Math.random() * currentIndex);\n            currentIndex--;\n            \n            // Swap it with the current element\n            [array[currentIndex], array[randomIndex]] = [array[randomIndex], array[currentIndex]];\n        }\n        \n        return array;\n    }\n    \n    // Helper method to load music files\n    async loadMusicFiles(files) {\n        // Note: Currently keeping music as HTML5 Audio for compatibility\n        // Could be updated to Web Audio API in the future\n        console.log(`Found ${files.length} music files:`, files);\n        \n        // Create a copy of the files array and shuffle it to randomize the order\n        const shuffledFiles = [...files];\n        this.shuffleArray(shuffledFiles);\n        \n        console.log(`Randomized playlist order:`, shuffledFiles.map(file => file.split('/').pop()));\n        \n        // Check if any files exist before trying to load them\n        let anyFilesExist = false;\n        for (const file of shuffledFiles) {\n            const fileExists = await this.checkFileExists(file);\n            if (fileExists.exists) {\n                anyFilesExist = true;\n                break;\n            }\n        }\n        \n        if (!anyFilesExist) {\n            console.warn(\"None of the music files could be found. Using fallback audio.\");\n            this.createDummySounds();\n            return;\n        }\n        \n        // Load each music track in the randomized order\n        for (const file of shuffledFiles) {\n            try {\n                console.log(`Attempting to load audio file: ${file}`);\n                const audio = new Audio(file);\n                audio.loop = false; // We'll handle looping manually for playlist functionality\n                audio.volume = this.musicVolume;\n                \n                // Add ended event to play the next track\n                audio.addEventListener('ended', () => this.playNextTrack());\n                \n                // Add error handler\n                audio.addEventListener('error', (e) => {\n                    console.error(`Error loading music file ${file}:`, e);\n                });\n                \n                // Add a load event to confirm successful loading\n                audio.addEventListener('canplaythrough', () => {\n                    console.log(`Successfully loaded music file: ${file}`);\n                });\n                \n                this.music.push(audio);\n                console.log(`Added music track to playlist: ${file}`);\n            } catch (err) {\n                console.error(`Failed to load music file ${file}:`, err);\n            }\n        }\n        \n        console.log(`Loaded ${this.music.length} music tracks in randomized order`);\n        \n        // If we haven't found any music, create a dummy audio element\n        // so that the music system doesn't break\n        if (this.music.length === 0) {\n            console.warn(\"No music files could be loaded, creating a dummy track\");\n            const dummyAudio = new Audio();\n            dummyAudio.loop = true;\n            this.music.push(dummyAudio);\n        }\n    }\n    \n    // Create dummy sounds if loading fails\n    createDummySounds() {\n        console.warn(\"Creating dummy silent AudioBuffers as fallback\");\n        \n        const soundEffects = ['laser', 'thrust', 'explosion', 'boink', 'phaserUp', 'phaserDown', 'mining-laser', 'projectile'];\n        \n        for (const name of soundEffects) {\n            // Create a silent buffer (0.1 seconds of silence)\n            if (this.audioContext) {\n                try {\n                    const buffer = this.audioContext.createBuffer(\n                        2, // stereo\n                        this.audioContext.sampleRate * 0.1, // 0.1 seconds\n                        this.audioContext.sampleRate\n                    );\n                    this.sounds[name] = buffer;\n                } catch (error) {\n                    console.error(`Failed to create dummy buffer for ${name}:`, error);\n                    this.sounds[name] = null;\n                }\n            } else {\n                this.sounds[name] = null;\n            }\n        }\n    }\n    \n    // Play the next music track in the playlist\n    playNextTrack() {\n        if (this.music.length === 0) return;\n        \n        // Move current track to the end of the playlist\n        const currentTrack = this.music.shift();\n        this.music.push(currentTrack);\n        \n        // Play the next track\n        this.playBackgroundMusic();\n    }\n    \n    // Start playing background music\n    playBackgroundMusic() {\n        if (this.music.length === 0 || this.muted) return;\n        \n        // Only attempt to play if the user has interacted with the page\n        if (!this.userHasInteracted) {\n            console.log(\"Deferring music playback until user interaction\");\n            return;\n        }\n        \n        // Get the track at the front of the queue\n        const track = this.music[0];\n        console.log(`Starting to play track: ${track.src.split('/').pop()}`);\n        \n        // Reset the track to the beginning\n        track.currentTime = 0;\n        \n        // Attempt to play the track\n        const playPromise = track.play();\n        \n        // Handle play promise (modern browsers return a promise from play())\n        if (playPromise !== undefined) {\n            playPromise\n                .then(() => {\n                    console.log(\"Started playing background music\");\n                })\n                .catch(err => {\n                    if (err.name === 'NotAllowedError') {\n                        console.log(\"Autoplay prevented by browser. Music will play after user interaction.\");\n                    } else {\n                        console.error(\"Error playing background music:\", err);\n                    }\n                });\n        }\n    }\n    \n    // Play a sound effect using Web Audio API\n    playSound(name) {\n        console.log(`Attempting to play sound: ${name}`);\n        \n        if (this.muted) {\n            console.log(`Sound ${name} not played: audio is muted`);\n            return;\n        }\n        \n        if (!this.userHasInteracted) {\n            console.log(`Sound ${name} not played: waiting for user interaction`);\n            return;\n        }\n        \n        // Make sure AudioContext is running\n        if (this.audioContext && this.audioContext.state === 'suspended') {\n            this.resumeAudioContext();\n        }\n        \n        // Handle the case where the name is 'weapon' or similar, map to projectile sound\n        if (name === 'weapon' || name === 'fire' || name === 'shoot') {\n            console.log(`Mapping ${name} sound to projectile sound`);\n            name = 'projectile';\n            // Use 'laser' sound for projectile if projectile sound is not available\n            if (!this.sounds.projectile && this.sounds.laser) {\n                console.log(\"Using laser sound for projectile\");\n                this.sounds.projectile = this.sounds.laser;\n            }\n        }\n        \n        if (!this.sounds[name]) {\n            console.warn(`Sound \"${name}\" not found in loaded sounds`);\n            return;\n        }\n        \n        try {\n            // Handle looped sounds vs one-shot sounds\n            if (name === 'laser' || name === 'thrust' || name === 'mining-laser') {\n                // For continuous sounds, create and track the sound source node\n                if (!this.activeSounds[name]) {\n                    // Create source node for looping sound\n                    const sourceNode = this.audioContext.createBufferSource();\n                    sourceNode.buffer = this.sounds[name];\n                    sourceNode.loop = true;\n                    \n                    // Create gain node for volume control\n                    const gainNode = this.audioContext.createGain();\n                    gainNode.gain.value = this.sfxVolume * (name === 'thrust' ? 1.5 : 1.0);\n                    \n                    // Connect nodes: source -> gain -> destination\n                    sourceNode.connect(gainNode);\n                    gainNode.connect(this.audioContext.destination);\n                    \n                    // Start playing\n                    sourceNode.start(0);\n                    \n                    // Store references to these nodes for later control\n                    this.activeSounds[name] = {\n                        source: sourceNode,\n                        gain: gainNode\n                    };\n                    \n                    // Track nodes for garbage collection\n                    this.trackNode(sourceNode);\n                    this.trackNode(gainNode);\n                }\n            } else {\n                // For one-shot sounds\n                // Create source node\n                const sourceNode = this.audioContext.createBufferSource();\n                sourceNode.buffer = this.sounds[name];\n                \n                // Create gain node for volume control\n                const gainNode = this.audioContext.createGain();\n                // Increase volume slightly for projectile sounds to make them more noticeable\n                const volumeMultiplier = name === 'projectile' ? 0.7 : 0.5;\n                gainNode.gain.value = this.sfxVolume * volumeMultiplier;\n                \n                // Connect nodes: source -> gain -> destination\n                sourceNode.connect(gainNode);\n                gainNode.connect(this.audioContext.destination);\n                \n                // Start playing (one-shot)\n                sourceNode.start(0);\n                \n                // Set ended callback for cleanup\n                sourceNode.onended = () => {\n                    sourceNode._inactive = true;\n                    gainNode._inactive = true;\n                };\n                \n                // Track nodes for garbage collection\n                this.trackNode(sourceNode);\n                this.trackNode(gainNode);\n                \n                // Log successful playback\n                console.log(`Started playback of one-shot sound: ${name}`);\n            }\n        } catch (err) {\n            console.error(`Error playing sound ${name}:`, err);\n        }\n    }\n    \n    // Stop a continuous sound effect\n    stopSound(name) {\n        if (!this.activeSounds[name]) return;\n        \n        try {\n            if (name === 'laser' || name === 'thrust' || name === 'mining-laser') {\n                // For looping sounds\n                if (this.activeSounds[name]) {\n                    const nodes = this.activeSounds[name];\n                    \n                    // Stop the source node\n                    if (nodes.source) {\n                        try {\n                            nodes.source.stop();\n                        } catch (e) {\n                            // Ignore errors if already stopped\n                        }\n                        nodes.source._inactive = true;\n                    }\n                    \n                    // Mark gain node as inactive\n                    if (nodes.gain) {\n                        nodes.gain._inactive = true;\n                    }\n                    \n                    // Clear reference\n                    this.activeSounds[name] = null;\n                }\n            }\n        } catch (err) {\n            console.error(`Error stopping sound ${name}:`, err);\n        }\n    }\n    \n    // Set the volume for thrust sound based on thrust level\n    setThrustVolume(thrustLevel) {\n        if (!this.activeSounds.thrust || !this.activeSounds.thrust.gain) return;\n        \n        // Scale the volume based on thrust level\n        const volume = Math.min(1.0, Math.max(0.1, thrustLevel)) * this.sfxVolume * 1.5;\n        \n        // Apply volume to gain node\n        try {\n            this.activeSounds.thrust.gain.gain.value = volume;\n        } catch (err) {\n            console.error(\"Error setting thrust volume:\", err);\n        }\n    }\n    \n    // Toggle mute for all audio\n    toggleMute() {\n        this.muted = !this.muted;\n        \n        // Adjust music volume\n        for (const track of this.music) {\n            track.volume = this.muted ? 0 : this.musicVolume;\n        }\n        \n        // Stop any active sound effects\n        if (this.muted) {\n            this.stopSound('laser');\n            this.stopSound('thrust');\n            this.stopSound('mining-laser');\n        }\n        \n        console.log(`Audio ${this.muted ? 'muted' : 'unmuted'}`);\n        return this.muted;\n    }\n    \n    // Clean up resources when destroying the audio manager\n    cleanup() {\n        console.log(\"Cleaning up AudioManager resources...\");\n        \n        // Stop all active sounds\n        this.stopSound('laser');\n        this.stopSound('thrust');\n        this.stopSound('mining-laser');\n        \n        // Pause all music\n        for (const track of this.music) {\n            track.pause();\n        }\n        \n        // Clear intervals\n        if (this.gcInterval) {\n            clearInterval(this.gcInterval);\n            this.gcInterval = null;\n        }\n        \n        // Close audio context\n        if (this.audioContext) {\n            this.audioContext.close().then(() => {\n                console.log(\"AudioContext closed successfully\");\n            }).catch(error => {\n                console.error(\"Error closing AudioContext:\", error);\n            });\n        }\n        \n        // Remove event listeners\n        document.removeEventListener('click', this.handleInteraction);\n        document.removeEventListener('keydown', this.handleInteraction);\n        document.removeEventListener('touchstart', this.handleInteraction);\n        \n        console.log(\"AudioManager cleanup complete\");\n    }\n    \n    // Play weapon firing sound - dedicated method for weapon sounds\n    playWeaponSound() {\n        console.log(\"Playing weapon firing sound\");\n        \n        // Check usual conditions\n        if (this.muted || !this.userHasInteracted) {\n            return;\n        }\n        \n        // Make sure AudioContext is running\n        if (this.audioContext && this.audioContext.state === 'suspended') {\n            this.resumeAudioContext();\n        }\n        \n        // Make sure we have a projectile sound (use laser as fallback)\n        if (!this.sounds.projectile && this.sounds.laser) {\n            console.log(\"Using laser sound for projectile in playWeaponSound\");\n            this.sounds.projectile = this.sounds.laser;\n        }\n        \n        if (!this.sounds.projectile) {\n            console.warn(\"Projectile sound not found\");\n            return;\n        }\n        \n        try {\n            // Create source node\n            const sourceNode = this.audioContext.createBufferSource();\n            sourceNode.buffer = this.sounds.projectile;\n            \n            // Create gain node with higher volume for weapon sound\n            const gainNode = this.audioContext.createGain();\n            gainNode.gain.value = this.sfxVolume * 0.8; // Higher volume for weapon sounds\n            \n            // Connect nodes: source -> gain -> destination\n            sourceNode.connect(gainNode);\n            gainNode.connect(this.audioContext.destination);\n            \n            // Start playing\n            sourceNode.start(0);\n            \n            // Set ended callback for cleanup\n            sourceNode.onended = () => {\n                sourceNode._inactive = true;\n                gainNode._inactive = true;\n            };\n            \n            // Track nodes for garbage collection\n            this.trackNode(sourceNode);\n            this.trackNode(gainNode);\n            \n            console.log(\"Weapon sound started playing\");\n        } catch (err) {\n            console.error(\"Error playing weapon sound:\", err);\n        }\n    }\n} "],"file":"assets/game-modules-DrL_oOTa.js"}