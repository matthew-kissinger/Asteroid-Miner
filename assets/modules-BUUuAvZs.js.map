{"version":3,"mappings":"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","names":["self","res","transform","URL","sourceURI","node","accessor","OptimizedProjectileStore","TransformComponent","HealthComponent","THREE.Vector3","THREE.Euler","THREE.Quaternion","MessageBus","THREE.Matrix4","THREE.Mesh","THREE.BoxGeometry","THREE.MeshBasicMaterial","THREE.Raycaster","THREE.SphereGeometry","THREE.AdditiveBlending","THREE.BufferGeometry","THREE.Float32BufferAttribute","THREE.BufferAttribute","THREE.ShaderMaterial","THREE.Color","THREE.DoubleSide","THREE.LineBasicMaterial","THREE.Line","THREE.OctahedronGeometry","THREE.MeshPhongMaterial","THREE.Group","THREE.Frustum","mesh","healthComponent","THREE.CylinderGeometry","THREE.TorusGeometry","MeshComponent","InstancedRenderer","THREE.MeshStandardMaterial","THREE.PointsMaterial","THREE.Points","THREE.Object3D","THREE.Scene","THREE.Vector2","THREE.ACESFilmicToneMapping","THREE.PCFSoftShadowMap","THREE.SRGBColorSpace","THREE.DirectionalLight","THREE.HemisphereLight","THREE.MathUtils","THREE.InstancedMesh","THREE.PerspectiveCamera","THREE.WebGLRenderer","THREE.ConeGeometry","location","asteroidBelt","THREE.TextureLoader","THREE.BackSide","THREE.FrontSide","textureLoader","THREE.Sprite","THREE.SpriteMaterial","THREE.PointLight","THREE.RingGeometry","THREE.CircleGeometry","AsteroidBelt","SpaceAnomalies","SystemTransition","CustomSystemCreator","VibeVersePortals","spaceAnomalies","systemTransition","THREE.IcosahedronGeometry","THREE.TetrahedronGeometry","customSystemCreator","element","_a","THREE.Box3","THREE.CanvasTexture","THREE.PlaneGeometry","THREE.DodecahedronGeometry","THREE.CubicBezierCurve3","THREE.EdgesGeometry","THREE.LineSegments","systemId","positions","game","TouchControls","RefactoredTouchControls","controlsMenu","THREE.PCFShadowMap","performance"],"ignoreList":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14],"sources":["../../node_modules/three/examples/jsm/utils/BufferGeometryUtils.js","../../node_modules/three/examples/jsm/loaders/GLTFLoader.js","../../node_modules/three/examples/jsm/shaders/CopyShader.js","../../node_modules/three/examples/jsm/postprocessing/Pass.js","../../node_modules/three/examples/jsm/postprocessing/ShaderPass.js","../../node_modules/three/examples/jsm/postprocessing/MaskPass.js","../../node_modules/three/examples/jsm/postprocessing/EffectComposer.js","../../node_modules/three/examples/jsm/postprocessing/RenderPass.js","../../node_modules/three/examples/jsm/shaders/LuminosityHighPassShader.js","../../node_modules/three/examples/jsm/postprocessing/UnrealBloomPass.js","../../node_modules/three/examples/jsm/shaders/FXAAShader.js","../../node_modules/three/examples/jsm/shaders/ColorCorrectionShader.js","../../node_modules/three/examples/jsm/shaders/FilmShader.js","../../node_modules/three/examples/jsm/shaders/VignetteShader.js","../../node_modules/three/examples/jsm/capabilities/WebGL.js","../../js/core/entity.js","../../js/core/entityManager.js","../../js/core/systemManager.js","../../js/core/spatial/SpatialHash.js","../../js/core/EntityIndex.js","../../js/core/world.js","../../js/modules/combat/worldSetup.js","../../js/core/system.js","../../js/core/component.js","../../js/components/combat/healthComponent.js","../../js/components/transform.js","../../js/components/physics/rigidbody.js","../../js/components/rendering/mesh.js","../../js/utils/memoryManager.js","../../js/systems/combat/combatSystem.js","../../js/components/rendering/trail.js","../../js/components/combat/enemyAI.js","../../js/systems/combat/enemyPoolManager.js","../../js/systems/combat/spawner/waves/definitions.js","../../js/systems/combat/spawner/waves/progression.js","../../js/systems/combat/spawner/formations/patterns.js","../../js/systems/combat/spawner/formations/builder.js","../../js/systems/combat/spawner/timing/scheduler.js","../../js/systems/combat/spawner/factory/enemies/spectralDrone.js","../../js/systems/combat/spawner/factory/enemies/meshGeneration.js","../../js/systems/combat/spawner/factory/enemyFactory.js","../../js/systems/combat/spawner/enemySpawner.js","../../js/systems/combat/enemyLifecycle.js","../../js/systems/combat/enemy/behaviors/separationBehavior.js","../../js/systems/combat/enemy/state/difficultyScaling.js","../../js/systems/combat/enemy/state/dockingManager.js","../../js/systems/combat/enemy/updates/spawnMonitoring.js","../../js/systems/combat/enemySystem.js","../../js/systems/rendering/renderSystem.js","../../js/systems/physics/collisionSystem.js","../../js/systems/rendering/visualEffectsSystem.js","../../js/systems/rendering/trailSystem.js","../../js/systems/weapons/deployableLaserSystem.js","../../js/systems/deployables/deploymentSystem.js","../../js/systems/effects/explosionHandler.js","../../js/modules/combat/registerSystems.js","../../js/modules/combat/events.js","../../js/modules/combat/effects/explosionEffects.js","../../js/modules/combat/effects/materialManager.js","../../js/modules/combat/effects/geometryManager.js","../../js/modules/combat/effects/projectileEffects.js","../../js/modules/combat/effects.js","../../js/modules/combat/aiAndSpawners.js","../../js/modules/combat/combatLogic.js","../../js/modules/combat.js","../../js/utils/pathUtils.js","../../js/modules/renderer/lighting.js","../../js/modules/renderer/shaders.js","../../js/modules/renderer/post.js","../../js/modules/renderer/sceneApi.js","../../js/modules/renderer/helpers.js","../../js/modules/renderer/volumetricLighting.js","../../js/modules/renderer.js","../../js/modules/trail.js","../../js/modules/spaceship/model/shipModel.js","../../js/modules/spaceship/systems/upgrades.js","../../js/modules/spaceship/systems/docking.js","../../js/modules/spaceship/systems/services.js","../../js/modules/spaceship/effects/visualEffects.js","../../js/modules/spaceship/sync/healthSync.js","../../js/modules/spaceship/spaceship.js","../../js/modules/physics.js","../../js/modules/environment/skybox.js","../../js/modules/environment/sun/sunShaders.js","../../js/modules/environment/sun/sunFlares.js","../../js/modules/environment/sun/sunLighting.js","../../js/modules/environment/sun.js","../../js/modules/environment/planets/planetGenerator.js","../../js/modules/environment/planets/planetTextures.js","../../js/modules/environment/planets/planetMaterials.js","../../js/modules/environment/planets/planetFactory.js","../../js/modules/environment/planets.js","../../js/modules/environment/stargate.js","../../js/modules/environment/generator/systemConfig.js","../../js/modules/environment/generator/systemNames.js","../../js/modules/environment/generator/systemUtils.js","../../js/modules/environment/generator/systemFactory.js","../../js/modules/environment/starSystemGenerator.js","../../js/modules/environment/core/sceneInitializer.js","../../js/modules/environment/core/regionManager.js","../../js/modules/environment/core/systemTransitionManager.js","../../js/modules/environment/asteroidBelt.js","../../js/modules/environment/systemTransition.js","../../js/modules/utils/apiClient.js","../../js/modules/ui/components/customSystem/styles.js","../../js/modules/ui/components/customSystem/validation.js","../../js/modules/ui/components/customSystem/systemData.js","../../js/modules/ui/components/customSystem/formView.js","../../js/modules/ui/components/customSystem/preview.js","../../js/modules/ui/components/customSystem/eventHandlers.js","../../js/modules/ui/components/customSystem/helpers.js","../../js/modules/ui/customSystemCreator.js","../../js/modules/environment/vibeVersePortals.js","../../js/modules/environment/anomalies/vortex.js","../../js/modules/environment/anomalies/crystalCluster.js","../../js/modules/environment/anomalies/nebulaNexus.js","../../js/modules/environment/anomalies/quantumFlux.js","../../js/modules/environment/anomalies/darkMatter.js","../../js/modules/environment/anomalies/anomalyRegistry.js","../../js/modules/environment/spaceAnomalies.js","../../js/modules/environment.js","../../js/modules/controls/inputHandler.js","../../js/modules/controls/gamepadHandler.js","../../js/modules/controls/mining/laserControl.js","../../js/modules/controls/mining/targetValidation.js","../../js/modules/controls/mining/resourceExtraction.js","../../js/modules/controls/mining/uiUpdates.js","../../js/modules/controls/mining/visualEffects.js","../../js/modules/controls/miningSystem.js","../../js/modules/controls/targetingSystem.js","../../js/modules/controls/docking/proximityDetector.js","../../js/modules/controls/docking/dockingLogic.js","../../js/modules/controls/docking/uiIntegration.js","../../js/modules/controls/dockingSystem.js","../../js/modules/controls/touch/ui/joystickZones.js","../../js/modules/controls/touch/ui/actionButtons.js","../../js/modules/controls/touch/input/joystickHandler.js","../../js/modules/controls/touch/input/gestureDetector.js","../../js/modules/controls/touch/actions/miningHandler.js","../../js/modules/controls/touch/actions/weaponHandler.js","../../js/modules/controls/touch/actions/systemActions.js","../../js/modules/controls/touch/touchControls.js","../../js/modules/controls/touchControls.js","../../js/utils/mobileDetector.js","../../js/modules/controls.js","../../js/modules/ui/components/hud/styles.js","../../js/modules/ui/components/hud/displays.js","../../js/modules/ui/components/hud/notifications.js","../../js/modules/ui/components/hud/statusIndicators.js","../../js/modules/ui/components/hud/eventHandlers.js","../../js/modules/ui/components/hud/helpers.js","../../js/modules/ui/hud.js","../../js/modules/ui/mobileHUD.js","../../js/modules/ui/miningDisplay.js","../../js/modules/ui/targetingUI.js","../../js/modules/ui/components/stargate/terminal/display/screen.js","../../js/modules/ui/components/stargate/terminal/display/effects.js","../../js/modules/ui/components/stargate/terminal/commands/parser.js","../../js/modules/ui/components/stargate/terminal/commands/handlers.js","../../js/modules/ui/components/stargate/terminal/content/messages.js","../../js/modules/ui/components/stargate/terminal/content/ascii.js","../../js/modules/ui/components/stargate/terminal/input/keyboard.js","../../js/modules/ui/components/stargate/terminalView.js","../../js/modules/ui/components/stargate/systemsView.js","../../js/modules/ui/components/stargate/tradingView.js","../../js/modules/ui/components/stargate/upgrades.js","../../js/modules/ui/components/stargate/missions.js","../../js/modules/ui/components/stargate/eventHandlers.js","../../js/modules/ui/components/stargate/helpers.js","../../js/modules/ui/stargateInterface.js","../../js/modules/ui/gameOverScreen.js","../../js/modules/ui/controlsMenu.js","../../js/modules/ui/starmap/canvasRenderer.js","../../js/modules/ui/starmap/navigationLogic.js","../../js/modules/ui/starmap/dataManager.js","../../js/modules/ui/starmap/uiCreator.js","../../js/modules/ui/starMap.js","../../js/modules/ui/components/blackjack/styles.js","../../js/modules/ui/components/blackjack/gameView.js","../../js/modules/ui/components/blackjack/cardDeck.js","../../js/modules/ui/components/blackjack/gameLogic.js","../../js/modules/ui/components/blackjack/animations.js","../../js/modules/ui/components/blackjack/betting.js","../../js/modules/ui/components/blackjack/eventHandlers.js","../../js/modules/ui/blackjackGame.js","../../js/modules/ui/components/settings/styles.js","../../js/modules/ui/components/settings/audioSettings.js","../../js/modules/ui/components/settings/graphicsSettings.js","../../js/modules/ui/components/settings/settingsView.js","../../js/modules/ui/components/settings/persistence.js","../../js/modules/ui/components/settings/eventHandlers.js","../../js/modules/ui/components/settings/helpers.js","../../js/modules/ui/settings.js","../../js/modules/ui/startScreen.js","../../js/modules/ui.js","../../js/modules/audio/core/context.js","../../js/modules/audio/core/loader.js","../../js/modules/audio/music/playlist.js","../../js/modules/audio/music/player.js","../../js/modules/audio/effects/soundPlayer.js","../../js/modules/audio/mobile/enabler.js","../../js/modules/audio/audio.js"],"sourcesContent":["import {\n\tBufferAttribute,\n\tBufferGeometry,\n\tFloat32BufferAttribute,\n\tInstancedBufferAttribute,\n\tInterleavedBuffer,\n\tInterleavedBufferAttribute,\n\tTriangleFanDrawMode,\n\tTriangleStripDrawMode,\n\tTrianglesDrawMode,\n\tVector3,\n} from 'three';\n\n/** @module BufferGeometryUtils */\n\n/**\n * Computes vertex tangents using the MikkTSpace algorithm. MikkTSpace generates the same tangents consistently,\n * and is used in most modelling tools and normal map bakers. Use MikkTSpace for materials with normal maps,\n * because inconsistent tangents may lead to subtle visual issues in the normal map, particularly around mirrored\n * UV seams.\n *\n * In comparison to this method, {@link BufferGeometry#computeTangents} (a custom algorithm) generates tangents that\n * probably will not match the tangents in other software. The custom algorithm is sufficient for general use with a\n * custom material, and may be faster than MikkTSpace.\n *\n * Returns the original BufferGeometry. Indexed geometries will be de-indexed. Requires position, normal, and uv attributes.\n *\n * @param {BufferGeometry} geometry - The geometry to compute tangents for.\n * @param {Object} MikkTSpace - Instance of `examples/jsm/libs/mikktspace.module.js`, or `mikktspace` npm package.\n * Await `MikkTSpace.ready` before use.\n * @param {boolean} [negateSign=true] - Whether to negate the sign component (.w) of each tangent.\n * Required for normal map conventions in some formats, including glTF.\n * @return {BufferGeometry} The updated geometry.\n */\nfunction computeMikkTSpaceTangents( geometry, MikkTSpace, negateSign = true ) {\n\n\tif ( ! MikkTSpace || ! MikkTSpace.isReady ) {\n\n\t\tthrow new Error( 'BufferGeometryUtils: Initialized MikkTSpace library required.' );\n\n\t}\n\n\tif ( ! geometry.hasAttribute( 'position' ) || ! geometry.hasAttribute( 'normal' ) || ! geometry.hasAttribute( 'uv' ) ) {\n\n\t\tthrow new Error( 'BufferGeometryUtils: Tangents require \"position\", \"normal\", and \"uv\" attributes.' );\n\n\t}\n\n\tfunction getAttributeArray( attribute ) {\n\n\t\tif ( attribute.normalized || attribute.isInterleavedBufferAttribute ) {\n\n\t\t\tconst dstArray = new Float32Array( attribute.count * attribute.itemSize );\n\n\t\t\tfor ( let i = 0, j = 0; i < attribute.count; i ++ ) {\n\n\t\t\t\tdstArray[ j ++ ] = attribute.getX( i );\n\t\t\t\tdstArray[ j ++ ] = attribute.getY( i );\n\n\t\t\t\tif ( attribute.itemSize > 2 ) {\n\n\t\t\t\t\tdstArray[ j ++ ] = attribute.getZ( i );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn dstArray;\n\n\t\t}\n\n\t\tif ( attribute.array instanceof Float32Array ) {\n\n\t\t\treturn attribute.array;\n\n\t\t}\n\n\t\treturn new Float32Array( attribute.array );\n\n\t}\n\n\t// MikkTSpace algorithm requires non-indexed input.\n\n\tconst _geometry = geometry.index ? geometry.toNonIndexed() : geometry;\n\n\t// Compute vertex tangents.\n\n\tconst tangents = MikkTSpace.generateTangents(\n\n\t\tgetAttributeArray( _geometry.attributes.position ),\n\t\tgetAttributeArray( _geometry.attributes.normal ),\n\t\tgetAttributeArray( _geometry.attributes.uv )\n\n\t);\n\n\t// Texture coordinate convention of glTF differs from the apparent\n\t// default of the MikkTSpace library; .w component must be flipped.\n\n\tif ( negateSign ) {\n\n\t\tfor ( let i = 3; i < tangents.length; i += 4 ) {\n\n\t\t\ttangents[ i ] *= - 1;\n\n\t\t}\n\n\t}\n\n\t//\n\n\t_geometry.setAttribute( 'tangent', new BufferAttribute( tangents, 4 ) );\n\n\tif ( geometry !== _geometry ) {\n\n\t\tgeometry.copy( _geometry );\n\n\t}\n\n\treturn geometry;\n\n}\n\n/**\n * Merges a set of geometries into a single instance. All geometries must have compatible attributes.\n *\n * @param {Array<BufferGeometry>} geometries - The geometries to merge.\n * @param {boolean} [useGroups=false] - Whether to use groups or not.\n * @return {?BufferGeometry} The merged geometry. Returns `null` if the merge does not succeed.\n */\nfunction mergeGeometries( geometries, useGroups = false ) {\n\n\tconst isIndexed = geometries[ 0 ].index !== null;\n\n\tconst attributesUsed = new Set( Object.keys( geometries[ 0 ].attributes ) );\n\tconst morphAttributesUsed = new Set( Object.keys( geometries[ 0 ].morphAttributes ) );\n\n\tconst attributes = {};\n\tconst morphAttributes = {};\n\n\tconst morphTargetsRelative = geometries[ 0 ].morphTargetsRelative;\n\n\tconst mergedGeometry = new BufferGeometry();\n\n\tlet offset = 0;\n\n\tfor ( let i = 0; i < geometries.length; ++ i ) {\n\n\t\tconst geometry = geometries[ i ];\n\t\tlet attributesCount = 0;\n\n\t\t// ensure that all geometries are indexed, or none\n\n\t\tif ( isIndexed !== ( geometry.index !== null ) ) {\n\n\t\t\tconsole.error( 'THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index ' + i + '. All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them.' );\n\t\t\treturn null;\n\n\t\t}\n\n\t\t// gather attributes, exit early if they're different\n\n\t\tfor ( const name in geometry.attributes ) {\n\n\t\t\tif ( ! attributesUsed.has( name ) ) {\n\n\t\t\t\tconsole.error( 'THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index ' + i + '. All geometries must have compatible attributes; make sure \"' + name + '\" attribute exists among all geometries, or in none of them.' );\n\t\t\t\treturn null;\n\n\t\t\t}\n\n\t\t\tif ( attributes[ name ] === undefined ) attributes[ name ] = [];\n\n\t\t\tattributes[ name ].push( geometry.attributes[ name ] );\n\n\t\t\tattributesCount ++;\n\n\t\t}\n\n\t\t// ensure geometries have the same number of attributes\n\n\t\tif ( attributesCount !== attributesUsed.size ) {\n\n\t\t\tconsole.error( 'THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index ' + i + '. Make sure all geometries have the same number of attributes.' );\n\t\t\treturn null;\n\n\t\t}\n\n\t\t// gather morph attributes, exit early if they're different\n\n\t\tif ( morphTargetsRelative !== geometry.morphTargetsRelative ) {\n\n\t\t\tconsole.error( 'THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index ' + i + '. .morphTargetsRelative must be consistent throughout all geometries.' );\n\t\t\treturn null;\n\n\t\t}\n\n\t\tfor ( const name in geometry.morphAttributes ) {\n\n\t\t\tif ( ! morphAttributesUsed.has( name ) ) {\n\n\t\t\t\tconsole.error( 'THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index ' + i + '.  .morphAttributes must be consistent throughout all geometries.' );\n\t\t\t\treturn null;\n\n\t\t\t}\n\n\t\t\tif ( morphAttributes[ name ] === undefined ) morphAttributes[ name ] = [];\n\n\t\t\tmorphAttributes[ name ].push( geometry.morphAttributes[ name ] );\n\n\t\t}\n\n\t\tif ( useGroups ) {\n\n\t\t\tlet count;\n\n\t\t\tif ( isIndexed ) {\n\n\t\t\t\tcount = geometry.index.count;\n\n\t\t\t} else if ( geometry.attributes.position !== undefined ) {\n\n\t\t\t\tcount = geometry.attributes.position.count;\n\n\t\t\t} else {\n\n\t\t\t\tconsole.error( 'THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index ' + i + '. The geometry must have either an index or a position attribute' );\n\t\t\t\treturn null;\n\n\t\t\t}\n\n\t\t\tmergedGeometry.addGroup( offset, count, i );\n\n\t\t\toffset += count;\n\n\t\t}\n\n\t}\n\n\t// merge indices\n\n\tif ( isIndexed ) {\n\n\t\tlet indexOffset = 0;\n\t\tconst mergedIndex = [];\n\n\t\tfor ( let i = 0; i < geometries.length; ++ i ) {\n\n\t\t\tconst index = geometries[ i ].index;\n\n\t\t\tfor ( let j = 0; j < index.count; ++ j ) {\n\n\t\t\t\tmergedIndex.push( index.getX( j ) + indexOffset );\n\n\t\t\t}\n\n\t\t\tindexOffset += geometries[ i ].attributes.position.count;\n\n\t\t}\n\n\t\tmergedGeometry.setIndex( mergedIndex );\n\n\t}\n\n\t// merge attributes\n\n\tfor ( const name in attributes ) {\n\n\t\tconst mergedAttribute = mergeAttributes( attributes[ name ] );\n\n\t\tif ( ! mergedAttribute ) {\n\n\t\t\tconsole.error( 'THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the ' + name + ' attribute.' );\n\t\t\treturn null;\n\n\t\t}\n\n\t\tmergedGeometry.setAttribute( name, mergedAttribute );\n\n\t}\n\n\t// merge morph attributes\n\n\tfor ( const name in morphAttributes ) {\n\n\t\tconst numMorphTargets = morphAttributes[ name ][ 0 ].length;\n\n\t\tif ( numMorphTargets === 0 ) break;\n\n\t\tmergedGeometry.morphAttributes = mergedGeometry.morphAttributes || {};\n\t\tmergedGeometry.morphAttributes[ name ] = [];\n\n\t\tfor ( let i = 0; i < numMorphTargets; ++ i ) {\n\n\t\t\tconst morphAttributesToMerge = [];\n\n\t\t\tfor ( let j = 0; j < morphAttributes[ name ].length; ++ j ) {\n\n\t\t\t\tmorphAttributesToMerge.push( morphAttributes[ name ][ j ][ i ] );\n\n\t\t\t}\n\n\t\t\tconst mergedMorphAttribute = mergeAttributes( morphAttributesToMerge );\n\n\t\t\tif ( ! mergedMorphAttribute ) {\n\n\t\t\t\tconsole.error( 'THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the ' + name + ' morphAttribute.' );\n\t\t\t\treturn null;\n\n\t\t\t}\n\n\t\t\tmergedGeometry.morphAttributes[ name ].push( mergedMorphAttribute );\n\n\t\t}\n\n\t}\n\n\treturn mergedGeometry;\n\n}\n\n/**\n * Merges a set of attributes into a single instance. All attributes must have compatible properties and types.\n * Instances of {@link InterleavedBufferAttribute} are not supported.\n *\n * @param {Array<BufferAttribute>} attributes - The attributes to merge.\n * @return {?BufferAttribute} The merged attribute. Returns `null` if the merge does not succeed.\n */\nfunction mergeAttributes( attributes ) {\n\n\tlet TypedArray;\n\tlet itemSize;\n\tlet normalized;\n\tlet gpuType = - 1;\n\tlet arrayLength = 0;\n\n\tfor ( let i = 0; i < attributes.length; ++ i ) {\n\n\t\tconst attribute = attributes[ i ];\n\n\t\tif ( TypedArray === undefined ) TypedArray = attribute.array.constructor;\n\t\tif ( TypedArray !== attribute.array.constructor ) {\n\n\t\t\tconsole.error( 'THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes.' );\n\t\t\treturn null;\n\n\t\t}\n\n\t\tif ( itemSize === undefined ) itemSize = attribute.itemSize;\n\t\tif ( itemSize !== attribute.itemSize ) {\n\n\t\t\tconsole.error( 'THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes.' );\n\t\t\treturn null;\n\n\t\t}\n\n\t\tif ( normalized === undefined ) normalized = attribute.normalized;\n\t\tif ( normalized !== attribute.normalized ) {\n\n\t\t\tconsole.error( 'THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes.' );\n\t\t\treturn null;\n\n\t\t}\n\n\t\tif ( gpuType === - 1 ) gpuType = attribute.gpuType;\n\t\tif ( gpuType !== attribute.gpuType ) {\n\n\t\t\tconsole.error( 'THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.gpuType must be consistent across matching attributes.' );\n\t\t\treturn null;\n\n\t\t}\n\n\t\tarrayLength += attribute.count * itemSize;\n\n\t}\n\n\tconst array = new TypedArray( arrayLength );\n\tconst result = new BufferAttribute( array, itemSize, normalized );\n\tlet offset = 0;\n\n\tfor ( let i = 0; i < attributes.length; ++ i ) {\n\n\t\tconst attribute = attributes[ i ];\n\t\tif ( attribute.isInterleavedBufferAttribute ) {\n\n\t\t\tconst tupleOffset = offset / itemSize;\n\t\t\tfor ( let j = 0, l = attribute.count; j < l; j ++ ) {\n\n\t\t\t\tfor ( let c = 0; c < itemSize; c ++ ) {\n\n\t\t\t\t\tconst value = attribute.getComponent( j, c );\n\t\t\t\t\tresult.setComponent( j + tupleOffset, c, value );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t} else {\n\n\t\t\tarray.set( attribute.array, offset );\n\n\t\t}\n\n\t\toffset += attribute.count * itemSize;\n\n\t}\n\n\tif ( gpuType !== undefined ) {\n\n\t\tresult.gpuType = gpuType;\n\n\t}\n\n\treturn result;\n\n}\n\n/**\n * Performs a deep clone of the given buffer attribute.\n *\n * @param {BufferAttribute} attribute - The attribute to clone.\n * @return {BufferAttribute} The cloned attribute.\n */\nfunction deepCloneAttribute( attribute ) {\n\n\tif ( attribute.isInstancedInterleavedBufferAttribute || attribute.isInterleavedBufferAttribute ) {\n\n\t\treturn deinterleaveAttribute( attribute );\n\n\t}\n\n\tif ( attribute.isInstancedBufferAttribute ) {\n\n\t\treturn new InstancedBufferAttribute().copy( attribute );\n\n\t}\n\n\treturn new BufferAttribute().copy( attribute );\n\n}\n\n/**\n * Interleaves a set of attributes and returns a new array of corresponding attributes that share a\n * single {@link InterleavedBuffer} instance. All attributes must have compatible types.\n *\n * @param {Array<BufferAttribute>} attributes - The attributes to interleave.\n * @return {Array<InterleavedBufferAttribute>} An array of interleaved attributes. If interleave does not succeed, the method returns `null`.\n */\nfunction interleaveAttributes( attributes ) {\n\n\t// Interleaves the provided attributes into an InterleavedBuffer and returns\n\t// a set of InterleavedBufferAttributes for each attribute\n\tlet TypedArray;\n\tlet arrayLength = 0;\n\tlet stride = 0;\n\n\t// calculate the length and type of the interleavedBuffer\n\tfor ( let i = 0, l = attributes.length; i < l; ++ i ) {\n\n\t\tconst attribute = attributes[ i ];\n\n\t\tif ( TypedArray === undefined ) TypedArray = attribute.array.constructor;\n\t\tif ( TypedArray !== attribute.array.constructor ) {\n\n\t\t\tconsole.error( 'AttributeBuffers of different types cannot be interleaved' );\n\t\t\treturn null;\n\n\t\t}\n\n\t\tarrayLength += attribute.array.length;\n\t\tstride += attribute.itemSize;\n\n\t}\n\n\t// Create the set of buffer attributes\n\tconst interleavedBuffer = new InterleavedBuffer( new TypedArray( arrayLength ), stride );\n\tlet offset = 0;\n\tconst res = [];\n\tconst getters = [ 'getX', 'getY', 'getZ', 'getW' ];\n\tconst setters = [ 'setX', 'setY', 'setZ', 'setW' ];\n\n\tfor ( let j = 0, l = attributes.length; j < l; j ++ ) {\n\n\t\tconst attribute = attributes[ j ];\n\t\tconst itemSize = attribute.itemSize;\n\t\tconst count = attribute.count;\n\t\tconst iba = new InterleavedBufferAttribute( interleavedBuffer, itemSize, offset, attribute.normalized );\n\t\tres.push( iba );\n\n\t\toffset += itemSize;\n\n\t\t// Move the data for each attribute into the new interleavedBuffer\n\t\t// at the appropriate offset\n\t\tfor ( let c = 0; c < count; c ++ ) {\n\n\t\t\tfor ( let k = 0; k < itemSize; k ++ ) {\n\n\t\t\t\tiba[ setters[ k ] ]( c, attribute[ getters[ k ] ]( c ) );\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n\treturn res;\n\n}\n\n/**\n * Returns a new, non-interleaved version of the given attribute.\n *\n * @param {InterleavedBufferAttribute} attribute - The interleaved attribute.\n * @return {BufferAttribute} The non-interleaved attribute.\n */\nfunction deinterleaveAttribute( attribute ) {\n\n\tconst cons = attribute.data.array.constructor;\n\tconst count = attribute.count;\n\tconst itemSize = attribute.itemSize;\n\tconst normalized = attribute.normalized;\n\n\tconst array = new cons( count * itemSize );\n\tlet newAttribute;\n\tif ( attribute.isInstancedInterleavedBufferAttribute ) {\n\n\t\tnewAttribute = new InstancedBufferAttribute( array, itemSize, normalized, attribute.meshPerAttribute );\n\n\t} else {\n\n\t\tnewAttribute = new BufferAttribute( array, itemSize, normalized );\n\n\t}\n\n\tfor ( let i = 0; i < count; i ++ ) {\n\n\t\tnewAttribute.setX( i, attribute.getX( i ) );\n\n\t\tif ( itemSize >= 2 ) {\n\n\t\t\tnewAttribute.setY( i, attribute.getY( i ) );\n\n\t\t}\n\n\t\tif ( itemSize >= 3 ) {\n\n\t\t\tnewAttribute.setZ( i, attribute.getZ( i ) );\n\n\t\t}\n\n\t\tif ( itemSize >= 4 ) {\n\n\t\t\tnewAttribute.setW( i, attribute.getW( i ) );\n\n\t\t}\n\n\t}\n\n\treturn newAttribute;\n\n}\n\n/**\n * Deinterleaves all attributes on the given geometry.\n *\n * @param {BufferGeometry} geometry - The geometry to deinterleave.\n */\nfunction deinterleaveGeometry( geometry ) {\n\n\tconst attributes = geometry.attributes;\n\tconst morphTargets = geometry.morphTargets;\n\tconst attrMap = new Map();\n\n\tfor ( const key in attributes ) {\n\n\t\tconst attr = attributes[ key ];\n\t\tif ( attr.isInterleavedBufferAttribute ) {\n\n\t\t\tif ( ! attrMap.has( attr ) ) {\n\n\t\t\t\tattrMap.set( attr, deinterleaveAttribute( attr ) );\n\n\t\t\t}\n\n\t\t\tattributes[ key ] = attrMap.get( attr );\n\n\t\t}\n\n\t}\n\n\tfor ( const key in morphTargets ) {\n\n\t\tconst attr = morphTargets[ key ];\n\t\tif ( attr.isInterleavedBufferAttribute ) {\n\n\t\t\tif ( ! attrMap.has( attr ) ) {\n\n\t\t\t\tattrMap.set( attr, deinterleaveAttribute( attr ) );\n\n\t\t\t}\n\n\t\t\tmorphTargets[ key ] = attrMap.get( attr );\n\n\t\t}\n\n\t}\n\n}\n\n/**\n * Returns the amount of bytes used by all attributes to represent the geometry.\n *\n * @param {BufferGeometry} geometry - The geometry.\n * @return {number} The estimate bytes used.\n */\nfunction estimateBytesUsed( geometry ) {\n\n\t// Return the estimated memory used by this geometry in bytes\n\t// Calculate using itemSize, count, and BYTES_PER_ELEMENT to account\n\t// for InterleavedBufferAttributes.\n\tlet mem = 0;\n\tfor ( const name in geometry.attributes ) {\n\n\t\tconst attr = geometry.getAttribute( name );\n\t\tmem += attr.count * attr.itemSize * attr.array.BYTES_PER_ELEMENT;\n\n\t}\n\n\tconst indices = geometry.getIndex();\n\tmem += indices ? indices.count * indices.itemSize * indices.array.BYTES_PER_ELEMENT : 0;\n\treturn mem;\n\n}\n\n/**\n * Returns a new geometry with vertices for which all similar vertex attributes (within tolerance) are merged.\n *\n * @param {BufferGeometry} geometry - The geometry to merge vertices for.\n * @param {number} [tolerance=1e-4] - The tolerance value.\n * @return {BufferGeometry} - The new geometry with merged vertices.\n */\nfunction mergeVertices( geometry, tolerance = 1e-4 ) {\n\n\ttolerance = Math.max( tolerance, Number.EPSILON );\n\n\t// Generate an index buffer if the geometry doesn't have one, or optimize it\n\t// if it's already available.\n\tconst hashToIndex = {};\n\tconst indices = geometry.getIndex();\n\tconst positions = geometry.getAttribute( 'position' );\n\tconst vertexCount = indices ? indices.count : positions.count;\n\n\t// next value for triangle indices\n\tlet nextIndex = 0;\n\n\t// attributes and new attribute arrays\n\tconst attributeNames = Object.keys( geometry.attributes );\n\tconst tmpAttributes = {};\n\tconst tmpMorphAttributes = {};\n\tconst newIndices = [];\n\tconst getters = [ 'getX', 'getY', 'getZ', 'getW' ];\n\tconst setters = [ 'setX', 'setY', 'setZ', 'setW' ];\n\n\t// Initialize the arrays, allocating space conservatively. Extra\n\t// space will be trimmed in the last step.\n\tfor ( let i = 0, l = attributeNames.length; i < l; i ++ ) {\n\n\t\tconst name = attributeNames[ i ];\n\t\tconst attr = geometry.attributes[ name ];\n\n\t\ttmpAttributes[ name ] = new attr.constructor(\n\t\t\tnew attr.array.constructor( attr.count * attr.itemSize ),\n\t\t\tattr.itemSize,\n\t\t\tattr.normalized\n\t\t);\n\n\t\tconst morphAttributes = geometry.morphAttributes[ name ];\n\t\tif ( morphAttributes ) {\n\n\t\t\tif ( ! tmpMorphAttributes[ name ] ) tmpMorphAttributes[ name ] = [];\n\t\t\tmorphAttributes.forEach( ( morphAttr, i ) => {\n\n\t\t\t\tconst array = new morphAttr.array.constructor( morphAttr.count * morphAttr.itemSize );\n\t\t\t\ttmpMorphAttributes[ name ][ i ] = new morphAttr.constructor( array, morphAttr.itemSize, morphAttr.normalized );\n\n\t\t\t} );\n\n\t\t}\n\n\t}\n\n\t// convert the error tolerance to an amount of decimal places to truncate to\n\tconst halfTolerance = tolerance * 0.5;\n\tconst exponent = Math.log10( 1 / tolerance );\n\tconst hashMultiplier = Math.pow( 10, exponent );\n\tconst hashAdditive = halfTolerance * hashMultiplier;\n\tfor ( let i = 0; i < vertexCount; i ++ ) {\n\n\t\tconst index = indices ? indices.getX( i ) : i;\n\n\t\t// Generate a hash for the vertex attributes at the current index 'i'\n\t\tlet hash = '';\n\t\tfor ( let j = 0, l = attributeNames.length; j < l; j ++ ) {\n\n\t\t\tconst name = attributeNames[ j ];\n\t\t\tconst attribute = geometry.getAttribute( name );\n\t\t\tconst itemSize = attribute.itemSize;\n\n\t\t\tfor ( let k = 0; k < itemSize; k ++ ) {\n\n\t\t\t\t// double tilde truncates the decimal value\n\t\t\t\thash += `${ ~ ~ ( attribute[ getters[ k ] ]( index ) * hashMultiplier + hashAdditive ) },`;\n\n\t\t\t}\n\n\t\t}\n\n\t\t// Add another reference to the vertex if it's already\n\t\t// used by another index\n\t\tif ( hash in hashToIndex ) {\n\n\t\t\tnewIndices.push( hashToIndex[ hash ] );\n\n\t\t} else {\n\n\t\t\t// copy data to the new index in the temporary attributes\n\t\t\tfor ( let j = 0, l = attributeNames.length; j < l; j ++ ) {\n\n\t\t\t\tconst name = attributeNames[ j ];\n\t\t\t\tconst attribute = geometry.getAttribute( name );\n\t\t\t\tconst morphAttributes = geometry.morphAttributes[ name ];\n\t\t\t\tconst itemSize = attribute.itemSize;\n\t\t\t\tconst newArray = tmpAttributes[ name ];\n\t\t\t\tconst newMorphArrays = tmpMorphAttributes[ name ];\n\n\t\t\t\tfor ( let k = 0; k < itemSize; k ++ ) {\n\n\t\t\t\t\tconst getterFunc = getters[ k ];\n\t\t\t\t\tconst setterFunc = setters[ k ];\n\t\t\t\t\tnewArray[ setterFunc ]( nextIndex, attribute[ getterFunc ]( index ) );\n\n\t\t\t\t\tif ( morphAttributes ) {\n\n\t\t\t\t\t\tfor ( let m = 0, ml = morphAttributes.length; m < ml; m ++ ) {\n\n\t\t\t\t\t\t\tnewMorphArrays[ m ][ setterFunc ]( nextIndex, morphAttributes[ m ][ getterFunc ]( index ) );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\thashToIndex[ hash ] = nextIndex;\n\t\t\tnewIndices.push( nextIndex );\n\t\t\tnextIndex ++;\n\n\t\t}\n\n\t}\n\n\t// generate result BufferGeometry\n\tconst result = geometry.clone();\n\tfor ( const name in geometry.attributes ) {\n\n\t\tconst tmpAttribute = tmpAttributes[ name ];\n\n\t\tresult.setAttribute( name, new tmpAttribute.constructor(\n\t\t\ttmpAttribute.array.slice( 0, nextIndex * tmpAttribute.itemSize ),\n\t\t\ttmpAttribute.itemSize,\n\t\t\ttmpAttribute.normalized,\n\t\t) );\n\n\t\tif ( ! ( name in tmpMorphAttributes ) ) continue;\n\n\t\tfor ( let j = 0; j < tmpMorphAttributes[ name ].length; j ++ ) {\n\n\t\t\tconst tmpMorphAttribute = tmpMorphAttributes[ name ][ j ];\n\n\t\t\tresult.morphAttributes[ name ][ j ] = new tmpMorphAttribute.constructor(\n\t\t\t\ttmpMorphAttribute.array.slice( 0, nextIndex * tmpMorphAttribute.itemSize ),\n\t\t\t\ttmpMorphAttribute.itemSize,\n\t\t\t\ttmpMorphAttribute.normalized,\n\t\t\t);\n\n\t\t}\n\n\t}\n\n\t// indices\n\n\tresult.setIndex( newIndices );\n\n\treturn result;\n\n}\n\n/**\n * Returns a new indexed geometry based on `TrianglesDrawMode` draw mode.\n * This mode corresponds to the `gl.TRIANGLES` primitive in WebGL.\n *\n * @param {BufferGeometry} geometry - The geometry to convert.\n * @param {number} drawMode - The current draw mode.\n * @return {BufferGeometry} The new geometry using `TrianglesDrawMode`.\n */\nfunction toTrianglesDrawMode( geometry, drawMode ) {\n\n\tif ( drawMode === TrianglesDrawMode ) {\n\n\t\tconsole.warn( 'THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles.' );\n\t\treturn geometry;\n\n\t}\n\n\tif ( drawMode === TriangleFanDrawMode || drawMode === TriangleStripDrawMode ) {\n\n\t\tlet index = geometry.getIndex();\n\n\t\t// generate index if not present\n\n\t\tif ( index === null ) {\n\n\t\t\tconst indices = [];\n\n\t\t\tconst position = geometry.getAttribute( 'position' );\n\n\t\t\tif ( position !== undefined ) {\n\n\t\t\t\tfor ( let i = 0; i < position.count; i ++ ) {\n\n\t\t\t\t\tindices.push( i );\n\n\t\t\t\t}\n\n\t\t\t\tgeometry.setIndex( indices );\n\t\t\t\tindex = geometry.getIndex();\n\n\t\t\t} else {\n\n\t\t\t\tconsole.error( 'THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible.' );\n\t\t\t\treturn geometry;\n\n\t\t\t}\n\n\t\t}\n\n\t\t//\n\n\t\tconst numberOfTriangles = index.count - 2;\n\t\tconst newIndices = [];\n\n\t\tif ( drawMode === TriangleFanDrawMode ) {\n\n\t\t\t// gl.TRIANGLE_FAN\n\n\t\t\tfor ( let i = 1; i <= numberOfTriangles; i ++ ) {\n\n\t\t\t\tnewIndices.push( index.getX( 0 ) );\n\t\t\t\tnewIndices.push( index.getX( i ) );\n\t\t\t\tnewIndices.push( index.getX( i + 1 ) );\n\n\t\t\t}\n\n\t\t} else {\n\n\t\t\t// gl.TRIANGLE_STRIP\n\n\t\t\tfor ( let i = 0; i < numberOfTriangles; i ++ ) {\n\n\t\t\t\tif ( i % 2 === 0 ) {\n\n\t\t\t\t\tnewIndices.push( index.getX( i ) );\n\t\t\t\t\tnewIndices.push( index.getX( i + 1 ) );\n\t\t\t\t\tnewIndices.push( index.getX( i + 2 ) );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tnewIndices.push( index.getX( i + 2 ) );\n\t\t\t\t\tnewIndices.push( index.getX( i + 1 ) );\n\t\t\t\t\tnewIndices.push( index.getX( i ) );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tif ( ( newIndices.length / 3 ) !== numberOfTriangles ) {\n\n\t\t\tconsole.error( 'THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.' );\n\n\t\t}\n\n\t\t// build final geometry\n\n\t\tconst newGeometry = geometry.clone();\n\t\tnewGeometry.setIndex( newIndices );\n\t\tnewGeometry.clearGroups();\n\n\t\treturn newGeometry;\n\n\t} else {\n\n\t\tconsole.error( 'THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:', drawMode );\n\t\treturn geometry;\n\n\t}\n\n}\n\n/**\n * Calculates the morphed attributes of a morphed/skinned BufferGeometry.\n *\n * Helpful for Raytracing or Decals (i.e. a `DecalGeometry` applied to a morphed Object with a `BufferGeometry`\n * will use the original `BufferGeometry`, not the morphed/skinned one, generating an incorrect result.\n * Using this function to create a shadow `Object3`D the `DecalGeometry` can be correctly generated).\n *\n * @param {Mesh|Line|Points} object - The 3D object to compute morph attributes for.\n * @return {Object} An object with original position/normal attributes and morphed ones.\n */\nfunction computeMorphedAttributes( object ) {\n\n\tconst _vA = new Vector3();\n\tconst _vB = new Vector3();\n\tconst _vC = new Vector3();\n\n\tconst _tempA = new Vector3();\n\tconst _tempB = new Vector3();\n\tconst _tempC = new Vector3();\n\n\tconst _morphA = new Vector3();\n\tconst _morphB = new Vector3();\n\tconst _morphC = new Vector3();\n\n\tfunction _calculateMorphedAttributeData(\n\t\tobject,\n\t\tattribute,\n\t\tmorphAttribute,\n\t\tmorphTargetsRelative,\n\t\ta,\n\t\tb,\n\t\tc,\n\t\tmodifiedAttributeArray\n\t) {\n\n\t\t_vA.fromBufferAttribute( attribute, a );\n\t\t_vB.fromBufferAttribute( attribute, b );\n\t\t_vC.fromBufferAttribute( attribute, c );\n\n\t\tconst morphInfluences = object.morphTargetInfluences;\n\n\t\tif ( morphAttribute && morphInfluences ) {\n\n\t\t\t_morphA.set( 0, 0, 0 );\n\t\t\t_morphB.set( 0, 0, 0 );\n\t\t\t_morphC.set( 0, 0, 0 );\n\n\t\t\tfor ( let i = 0, il = morphAttribute.length; i < il; i ++ ) {\n\n\t\t\t\tconst influence = morphInfluences[ i ];\n\t\t\t\tconst morph = morphAttribute[ i ];\n\n\t\t\t\tif ( influence === 0 ) continue;\n\n\t\t\t\t_tempA.fromBufferAttribute( morph, a );\n\t\t\t\t_tempB.fromBufferAttribute( morph, b );\n\t\t\t\t_tempC.fromBufferAttribute( morph, c );\n\n\t\t\t\tif ( morphTargetsRelative ) {\n\n\t\t\t\t\t_morphA.addScaledVector( _tempA, influence );\n\t\t\t\t\t_morphB.addScaledVector( _tempB, influence );\n\t\t\t\t\t_morphC.addScaledVector( _tempC, influence );\n\n\t\t\t\t} else {\n\n\t\t\t\t\t_morphA.addScaledVector( _tempA.sub( _vA ), influence );\n\t\t\t\t\t_morphB.addScaledVector( _tempB.sub( _vB ), influence );\n\t\t\t\t\t_morphC.addScaledVector( _tempC.sub( _vC ), influence );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t_vA.add( _morphA );\n\t\t\t_vB.add( _morphB );\n\t\t\t_vC.add( _morphC );\n\n\t\t}\n\n\t\tif ( object.isSkinnedMesh ) {\n\n\t\t\tobject.applyBoneTransform( a, _vA );\n\t\t\tobject.applyBoneTransform( b, _vB );\n\t\t\tobject.applyBoneTransform( c, _vC );\n\n\t\t}\n\n\t\tmodifiedAttributeArray[ a * 3 + 0 ] = _vA.x;\n\t\tmodifiedAttributeArray[ a * 3 + 1 ] = _vA.y;\n\t\tmodifiedAttributeArray[ a * 3 + 2 ] = _vA.z;\n\t\tmodifiedAttributeArray[ b * 3 + 0 ] = _vB.x;\n\t\tmodifiedAttributeArray[ b * 3 + 1 ] = _vB.y;\n\t\tmodifiedAttributeArray[ b * 3 + 2 ] = _vB.z;\n\t\tmodifiedAttributeArray[ c * 3 + 0 ] = _vC.x;\n\t\tmodifiedAttributeArray[ c * 3 + 1 ] = _vC.y;\n\t\tmodifiedAttributeArray[ c * 3 + 2 ] = _vC.z;\n\n\t}\n\n\tconst geometry = object.geometry;\n\tconst material = object.material;\n\n\tlet a, b, c;\n\tconst index = geometry.index;\n\tconst positionAttribute = geometry.attributes.position;\n\tconst morphPosition = geometry.morphAttributes.position;\n\tconst morphTargetsRelative = geometry.morphTargetsRelative;\n\tconst normalAttribute = geometry.attributes.normal;\n\tconst morphNormal = geometry.morphAttributes.position;\n\n\tconst groups = geometry.groups;\n\tconst drawRange = geometry.drawRange;\n\tlet i, j, il, jl;\n\tlet group;\n\tlet start, end;\n\n\tconst modifiedPosition = new Float32Array( positionAttribute.count * positionAttribute.itemSize );\n\tconst modifiedNormal = new Float32Array( normalAttribute.count * normalAttribute.itemSize );\n\n\tif ( index !== null ) {\n\n\t\t// indexed buffer geometry\n\n\t\tif ( Array.isArray( material ) ) {\n\n\t\t\tfor ( i = 0, il = groups.length; i < il; i ++ ) {\n\n\t\t\t\tgroup = groups[ i ];\n\n\t\t\t\tstart = Math.max( group.start, drawRange.start );\n\t\t\t\tend = Math.min( ( group.start + group.count ), ( drawRange.start + drawRange.count ) );\n\n\t\t\t\tfor ( j = start, jl = end; j < jl; j += 3 ) {\n\n\t\t\t\t\ta = index.getX( j );\n\t\t\t\t\tb = index.getX( j + 1 );\n\t\t\t\t\tc = index.getX( j + 2 );\n\n\t\t\t\t\t_calculateMorphedAttributeData(\n\t\t\t\t\t\tobject,\n\t\t\t\t\t\tpositionAttribute,\n\t\t\t\t\t\tmorphPosition,\n\t\t\t\t\t\tmorphTargetsRelative,\n\t\t\t\t\t\ta, b, c,\n\t\t\t\t\t\tmodifiedPosition\n\t\t\t\t\t);\n\n\t\t\t\t\t_calculateMorphedAttributeData(\n\t\t\t\t\t\tobject,\n\t\t\t\t\t\tnormalAttribute,\n\t\t\t\t\t\tmorphNormal,\n\t\t\t\t\t\tmorphTargetsRelative,\n\t\t\t\t\t\ta, b, c,\n\t\t\t\t\t\tmodifiedNormal\n\t\t\t\t\t);\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t} else {\n\n\t\t\tstart = Math.max( 0, drawRange.start );\n\t\t\tend = Math.min( index.count, ( drawRange.start + drawRange.count ) );\n\n\t\t\tfor ( i = start, il = end; i < il; i += 3 ) {\n\n\t\t\t\ta = index.getX( i );\n\t\t\t\tb = index.getX( i + 1 );\n\t\t\t\tc = index.getX( i + 2 );\n\n\t\t\t\t_calculateMorphedAttributeData(\n\t\t\t\t\tobject,\n\t\t\t\t\tpositionAttribute,\n\t\t\t\t\tmorphPosition,\n\t\t\t\t\tmorphTargetsRelative,\n\t\t\t\t\ta, b, c,\n\t\t\t\t\tmodifiedPosition\n\t\t\t\t);\n\n\t\t\t\t_calculateMorphedAttributeData(\n\t\t\t\t\tobject,\n\t\t\t\t\tnormalAttribute,\n\t\t\t\t\tmorphNormal,\n\t\t\t\t\tmorphTargetsRelative,\n\t\t\t\t\ta, b, c,\n\t\t\t\t\tmodifiedNormal\n\t\t\t\t);\n\n\t\t\t}\n\n\t\t}\n\n\t} else {\n\n\t\t// non-indexed buffer geometry\n\n\t\tif ( Array.isArray( material ) ) {\n\n\t\t\tfor ( i = 0, il = groups.length; i < il; i ++ ) {\n\n\t\t\t\tgroup = groups[ i ];\n\n\t\t\t\tstart = Math.max( group.start, drawRange.start );\n\t\t\t\tend = Math.min( ( group.start + group.count ), ( drawRange.start + drawRange.count ) );\n\n\t\t\t\tfor ( j = start, jl = end; j < jl; j += 3 ) {\n\n\t\t\t\t\ta = j;\n\t\t\t\t\tb = j + 1;\n\t\t\t\t\tc = j + 2;\n\n\t\t\t\t\t_calculateMorphedAttributeData(\n\t\t\t\t\t\tobject,\n\t\t\t\t\t\tpositionAttribute,\n\t\t\t\t\t\tmorphPosition,\n\t\t\t\t\t\tmorphTargetsRelative,\n\t\t\t\t\t\ta, b, c,\n\t\t\t\t\t\tmodifiedPosition\n\t\t\t\t\t);\n\n\t\t\t\t\t_calculateMorphedAttributeData(\n\t\t\t\t\t\tobject,\n\t\t\t\t\t\tnormalAttribute,\n\t\t\t\t\t\tmorphNormal,\n\t\t\t\t\t\tmorphTargetsRelative,\n\t\t\t\t\t\ta, b, c,\n\t\t\t\t\t\tmodifiedNormal\n\t\t\t\t\t);\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t} else {\n\n\t\t\tstart = Math.max( 0, drawRange.start );\n\t\t\tend = Math.min( positionAttribute.count, ( drawRange.start + drawRange.count ) );\n\n\t\t\tfor ( i = start, il = end; i < il; i += 3 ) {\n\n\t\t\t\ta = i;\n\t\t\t\tb = i + 1;\n\t\t\t\tc = i + 2;\n\n\t\t\t\t_calculateMorphedAttributeData(\n\t\t\t\t\tobject,\n\t\t\t\t\tpositionAttribute,\n\t\t\t\t\tmorphPosition,\n\t\t\t\t\tmorphTargetsRelative,\n\t\t\t\t\ta, b, c,\n\t\t\t\t\tmodifiedPosition\n\t\t\t\t);\n\n\t\t\t\t_calculateMorphedAttributeData(\n\t\t\t\t\tobject,\n\t\t\t\t\tnormalAttribute,\n\t\t\t\t\tmorphNormal,\n\t\t\t\t\tmorphTargetsRelative,\n\t\t\t\t\ta, b, c,\n\t\t\t\t\tmodifiedNormal\n\t\t\t\t);\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n\tconst morphedPositionAttribute = new Float32BufferAttribute( modifiedPosition, 3 );\n\tconst morphedNormalAttribute = new Float32BufferAttribute( modifiedNormal, 3 );\n\n\treturn {\n\n\t\tpositionAttribute: positionAttribute,\n\t\tnormalAttribute: normalAttribute,\n\t\tmorphedPositionAttribute: morphedPositionAttribute,\n\t\tmorphedNormalAttribute: morphedNormalAttribute\n\n\t};\n\n}\n\n/**\n * Merges the {@link BufferGeometry#groups} for the given geometry.\n *\n * @param {BufferGeometry} geometry - The geometry to modify.\n * @return {BufferGeometry} - The updated geometry\n */\nfunction mergeGroups( geometry ) {\n\n\tif ( geometry.groups.length === 0 ) {\n\n\t\tconsole.warn( 'THREE.BufferGeometryUtils.mergeGroups(): No groups are defined. Nothing to merge.' );\n\t\treturn geometry;\n\n\t}\n\n\tlet groups = geometry.groups;\n\n\t// sort groups by material index\n\n\tgroups = groups.sort( ( a, b ) => {\n\n\t\tif ( a.materialIndex !== b.materialIndex ) return a.materialIndex - b.materialIndex;\n\n\t\treturn a.start - b.start;\n\n\t} );\n\n\t// create index for non-indexed geometries\n\n\tif ( geometry.getIndex() === null ) {\n\n\t\tconst positionAttribute = geometry.getAttribute( 'position' );\n\t\tconst indices = [];\n\n\t\tfor ( let i = 0; i < positionAttribute.count; i += 3 ) {\n\n\t\t\tindices.push( i, i + 1, i + 2 );\n\n\t\t}\n\n\t\tgeometry.setIndex( indices );\n\n\t}\n\n\t// sort index\n\n\tconst index = geometry.getIndex();\n\n\tconst newIndices = [];\n\n\tfor ( let i = 0; i < groups.length; i ++ ) {\n\n\t\tconst group = groups[ i ];\n\n\t\tconst groupStart = group.start;\n\t\tconst groupLength = groupStart + group.count;\n\n\t\tfor ( let j = groupStart; j < groupLength; j ++ ) {\n\n\t\t\tnewIndices.push( index.getX( j ) );\n\n\t\t}\n\n\t}\n\n\tgeometry.dispose(); // Required to force buffer recreation\n\tgeometry.setIndex( newIndices );\n\n\t// update groups indices\n\n\tlet start = 0;\n\n\tfor ( let i = 0; i < groups.length; i ++ ) {\n\n\t\tconst group = groups[ i ];\n\n\t\tgroup.start = start;\n\t\tstart += group.count;\n\n\t}\n\n\t// merge groups\n\n\tlet currentGroup = groups[ 0 ];\n\n\tgeometry.groups = [ currentGroup ];\n\n\tfor ( let i = 1; i < groups.length; i ++ ) {\n\n\t\tconst group = groups[ i ];\n\n\t\tif ( currentGroup.materialIndex === group.materialIndex ) {\n\n\t\t\tcurrentGroup.count += group.count;\n\n\t\t} else {\n\n\t\t\tcurrentGroup = group;\n\t\t\tgeometry.groups.push( currentGroup );\n\n\t\t}\n\n\t}\n\n\treturn geometry;\n\n}\n\n/**\n * Modifies the supplied geometry if it is non-indexed, otherwise creates a new,\n * non-indexed geometry. Returns the geometry with smooth normals everywhere except\n * faces that meet at an angle greater than the crease angle.\n *\n * @param {BufferGeometry} geometry - The geometry to modify.\n * @param {number} [creaseAngle=Math.PI/3] - The crease angle in radians.\n * @return {BufferGeometry} - The updated geometry\n */\nfunction toCreasedNormals( geometry, creaseAngle = Math.PI / 3 /* 60 degrees */ ) {\n\n\tconst creaseDot = Math.cos( creaseAngle );\n\tconst hashMultiplier = ( 1 + 1e-10 ) * 1e2;\n\n\t// reusable vectors\n\tconst verts = [ new Vector3(), new Vector3(), new Vector3() ];\n\tconst tempVec1 = new Vector3();\n\tconst tempVec2 = new Vector3();\n\tconst tempNorm = new Vector3();\n\tconst tempNorm2 = new Vector3();\n\n\t// hashes a vector\n\tfunction hashVertex( v ) {\n\n\t\tconst x = ~ ~ ( v.x * hashMultiplier );\n\t\tconst y = ~ ~ ( v.y * hashMultiplier );\n\t\tconst z = ~ ~ ( v.z * hashMultiplier );\n\t\treturn `${x},${y},${z}`;\n\n\t}\n\n\t// BufferGeometry.toNonIndexed() warns if the geometry is non-indexed\n\t// and returns the original geometry\n\tconst resultGeometry = geometry.index ? geometry.toNonIndexed() : geometry;\n\tconst posAttr = resultGeometry.attributes.position;\n\tconst vertexMap = {};\n\n\t// find all the normals shared by commonly located vertices\n\tfor ( let i = 0, l = posAttr.count / 3; i < l; i ++ ) {\n\n\t\tconst i3 = 3 * i;\n\t\tconst a = verts[ 0 ].fromBufferAttribute( posAttr, i3 + 0 );\n\t\tconst b = verts[ 1 ].fromBufferAttribute( posAttr, i3 + 1 );\n\t\tconst c = verts[ 2 ].fromBufferAttribute( posAttr, i3 + 2 );\n\n\t\ttempVec1.subVectors( c, b );\n\t\ttempVec2.subVectors( a, b );\n\n\t\t// add the normal to the map for all vertices\n\t\tconst normal = new Vector3().crossVectors( tempVec1, tempVec2 ).normalize();\n\t\tfor ( let n = 0; n < 3; n ++ ) {\n\n\t\t\tconst vert = verts[ n ];\n\t\t\tconst hash = hashVertex( vert );\n\t\t\tif ( ! ( hash in vertexMap ) ) {\n\n\t\t\t\tvertexMap[ hash ] = [];\n\n\t\t\t}\n\n\t\t\tvertexMap[ hash ].push( normal );\n\n\t\t}\n\n\t}\n\n\t// average normals from all vertices that share a common location if they are within the\n\t// provided crease threshold\n\tconst normalArray = new Float32Array( posAttr.count * 3 );\n\tconst normAttr = new BufferAttribute( normalArray, 3, false );\n\tfor ( let i = 0, l = posAttr.count / 3; i < l; i ++ ) {\n\n\t\t// get the face normal for this vertex\n\t\tconst i3 = 3 * i;\n\t\tconst a = verts[ 0 ].fromBufferAttribute( posAttr, i3 + 0 );\n\t\tconst b = verts[ 1 ].fromBufferAttribute( posAttr, i3 + 1 );\n\t\tconst c = verts[ 2 ].fromBufferAttribute( posAttr, i3 + 2 );\n\n\t\ttempVec1.subVectors( c, b );\n\t\ttempVec2.subVectors( a, b );\n\n\t\ttempNorm.crossVectors( tempVec1, tempVec2 ).normalize();\n\n\t\t// average all normals that meet the threshold and set the normal value\n\t\tfor ( let n = 0; n < 3; n ++ ) {\n\n\t\t\tconst vert = verts[ n ];\n\t\t\tconst hash = hashVertex( vert );\n\t\t\tconst otherNormals = vertexMap[ hash ];\n\t\t\ttempNorm2.set( 0, 0, 0 );\n\n\t\t\tfor ( let k = 0, lk = otherNormals.length; k < lk; k ++ ) {\n\n\t\t\t\tconst otherNorm = otherNormals[ k ];\n\t\t\t\tif ( tempNorm.dot( otherNorm ) > creaseDot ) {\n\n\t\t\t\t\ttempNorm2.add( otherNorm );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\ttempNorm2.normalize();\n\t\t\tnormAttr.setXYZ( i3 + n, tempNorm2.x, tempNorm2.y, tempNorm2.z );\n\n\t\t}\n\n\t}\n\n\tresultGeometry.setAttribute( 'normal', normAttr );\n\treturn resultGeometry;\n\n}\n\nexport {\n\tcomputeMikkTSpaceTangents,\n\tmergeGeometries,\n\tmergeAttributes,\n\tdeepCloneAttribute,\n\tdeinterleaveAttribute,\n\tdeinterleaveGeometry,\n\tinterleaveAttributes,\n\testimateBytesUsed,\n\tmergeVertices,\n\ttoTrianglesDrawMode,\n\tcomputeMorphedAttributes,\n\tmergeGroups,\n\ttoCreasedNormals\n};\n","import {\n\tAnimationClip,\n\tBone,\n\tBox3,\n\tBufferAttribute,\n\tBufferGeometry,\n\tClampToEdgeWrapping,\n\tColor,\n\tColorManagement,\n\tDirectionalLight,\n\tDoubleSide,\n\tFileLoader,\n\tFrontSide,\n\tGroup,\n\tImageBitmapLoader,\n\tInstancedMesh,\n\tInterleavedBuffer,\n\tInterleavedBufferAttribute,\n\tInterpolant,\n\tInterpolateDiscrete,\n\tInterpolateLinear,\n\tLine,\n\tLineBasicMaterial,\n\tLineLoop,\n\tLineSegments,\n\tLinearFilter,\n\tLinearMipmapLinearFilter,\n\tLinearMipmapNearestFilter,\n\tLinearSRGBColorSpace,\n\tLoader,\n\tLoaderUtils,\n\tMaterial,\n\tMathUtils,\n\tMatrix4,\n\tMesh,\n\tMeshBasicMaterial,\n\tMeshPhysicalMaterial,\n\tMeshStandardMaterial,\n\tMirroredRepeatWrapping,\n\tNearestFilter,\n\tNearestMipmapLinearFilter,\n\tNearestMipmapNearestFilter,\n\tNumberKeyframeTrack,\n\tObject3D,\n\tOrthographicCamera,\n\tPerspectiveCamera,\n\tPointLight,\n\tPoints,\n\tPointsMaterial,\n\tPropertyBinding,\n\tQuaternion,\n\tQuaternionKeyframeTrack,\n\tRepeatWrapping,\n\tSkeleton,\n\tSkinnedMesh,\n\tSphere,\n\tSpotLight,\n\tTexture,\n\tTextureLoader,\n\tTriangleFanDrawMode,\n\tTriangleStripDrawMode,\n\tVector2,\n\tVector3,\n\tVectorKeyframeTrack,\n\tSRGBColorSpace,\n\tInstancedBufferAttribute\n} from 'three';\nimport { toTrianglesDrawMode } from '../utils/BufferGeometryUtils.js';\n\n/**\n * A loader for the glTF 2.0 format.\n *\n * [glTF]{@link https://www.khronos.org/gltf/} (GL Transmission Format) is an [open format specification]{@link https://github.com/KhronosGroup/glTF/tree/main/specification/2.0}\n * for efficient delivery and loading of 3D content. Assets may be provided either in JSON (.gltf) or binary (.glb)\n * format. External files store textures (.jpg, .png) and additional binary data (.bin). A glTF asset may deliver\n * one or more scenes, including meshes, materials, textures, skins, skeletons, morph targets, animations, lights,\n * and/or cameras.\n *\n * `GLTFLoader` uses {@link ImageBitmapLoader} whenever possible. Be advised that image bitmaps are not\n * automatically GC-collected when they are no longer referenced, and they require special handling during\n * the disposal process.\n *\n * `GLTFLoader` supports the following glTF 2.0 extensions:\n * - KHR_draco_mesh_compression\n * - KHR_materials_clearcoat\n * - KHR_materials_dispersion\n * - KHR_materials_ior\n * - KHR_materials_specular\n * - KHR_materials_transmission\n * - KHR_materials_iridescence\n * - KHR_materials_unlit\n * - KHR_materials_volume\n * - KHR_mesh_quantization\n * - KHR_lights_punctual\n * - KHR_texture_basisu\n * - KHR_texture_transform\n * - EXT_texture_webp\n * - EXT_meshopt_compression\n * - EXT_mesh_gpu_instancing\n *\n * The following glTF 2.0 extension is supported by an external user plugin:\n * - [KHR_materials_variants]{@link https://github.com/takahirox/three-gltf-extensions}\n * - [MSFT_texture_dds]{@link https://github.com/takahirox/three-gltf-extensions}\n *\n * ```js\n * const loader = new GLTFLoader();\n *\n * // Optional: Provide a DRACOLoader instance to decode compressed mesh data\n * const dracoLoader = new DRACOLoader();\n * dracoLoader.setDecoderPath( '/examples/jsm/libs/draco/' );\n * loader.setDRACOLoader( dracoLoader );\n *\n * const gltf = await loader.loadAsync( 'models/gltf/duck/duck.gltf' );\n * scene.add( gltf.scene );\n * ```\n *\n * @augments Loader\n */\nclass GLTFLoader extends Loader {\n\n\t/**\n\t * Constructs a new glTF loader.\n\t *\n\t * @param {LoadingManager} [manager] - The loading manager.\n\t */\n\tconstructor( manager ) {\n\n\t\tsuper( manager );\n\n\t\tthis.dracoLoader = null;\n\t\tthis.ktx2Loader = null;\n\t\tthis.meshoptDecoder = null;\n\n\t\tthis.pluginCallbacks = [];\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFMaterialsClearcoatExtension( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFMaterialsDispersionExtension( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFTextureBasisUExtension( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFTextureWebPExtension( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFTextureAVIFExtension( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFMaterialsSheenExtension( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFMaterialsTransmissionExtension( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFMaterialsVolumeExtension( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFMaterialsIorExtension( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFMaterialsEmissiveStrengthExtension( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFMaterialsSpecularExtension( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFMaterialsIridescenceExtension( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFMaterialsAnisotropyExtension( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFMaterialsBumpExtension( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFLightsExtension( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFMeshoptCompression( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFMeshGpuInstancing( parser );\n\n\t\t} );\n\n\t}\n\n\t/**\n\t * Starts loading from the given URL and passes the loaded glTF asset\n\t * to the `onLoad()` callback.\n\t *\n\t * @param {string} url - The path/URL of the file to be loaded. This can also be a data URI.\n\t * @param {function(GLTFLoader~LoadObject)} onLoad - Executed when the loading process has been finished.\n\t * @param {onProgressCallback} onProgress - Executed while the loading is in progress.\n\t * @param {onErrorCallback} onError - Executed when errors occur.\n\t */\n\tload( url, onLoad, onProgress, onError ) {\n\n\t\tconst scope = this;\n\n\t\tlet resourcePath;\n\n\t\tif ( this.resourcePath !== '' ) {\n\n\t\t\tresourcePath = this.resourcePath;\n\n\t\t} else if ( this.path !== '' ) {\n\n\t\t\t// If a base path is set, resources will be relative paths from that plus the relative path of the gltf file\n\t\t\t// Example  path = 'https://my-cnd-server.com/', url = 'assets/models/model.gltf'\n\t\t\t// resourcePath = 'https://my-cnd-server.com/assets/models/'\n\t\t\t// referenced resource 'model.bin' will be loaded from 'https://my-cnd-server.com/assets/models/model.bin'\n\t\t\t// referenced resource '../textures/texture.png' will be loaded from 'https://my-cnd-server.com/assets/textures/texture.png'\n\t\t\tconst relativeUrl = LoaderUtils.extractUrlBase( url );\n\t\t\tresourcePath = LoaderUtils.resolveURL( relativeUrl, this.path );\n\n\t\t} else {\n\n\t\t\tresourcePath = LoaderUtils.extractUrlBase( url );\n\n\t\t}\n\n\t\t// Tells the LoadingManager to track an extra item, which resolves after\n\t\t// the model is fully loaded. This means the count of items loaded will\n\t\t// be incorrect, but ensures manager.onLoad() does not fire early.\n\t\tthis.manager.itemStart( url );\n\n\t\tconst _onError = function ( e ) {\n\n\t\t\tif ( onError ) {\n\n\t\t\t\tonError( e );\n\n\t\t\t} else {\n\n\t\t\t\tconsole.error( e );\n\n\t\t\t}\n\n\t\t\tscope.manager.itemError( url );\n\t\t\tscope.manager.itemEnd( url );\n\n\t\t};\n\n\t\tconst loader = new FileLoader( this.manager );\n\n\t\tloader.setPath( this.path );\n\t\tloader.setResponseType( 'arraybuffer' );\n\t\tloader.setRequestHeader( this.requestHeader );\n\t\tloader.setWithCredentials( this.withCredentials );\n\n\t\tloader.load( url, function ( data ) {\n\n\t\t\ttry {\n\n\t\t\t\tscope.parse( data, resourcePath, function ( gltf ) {\n\n\t\t\t\t\tonLoad( gltf );\n\n\t\t\t\t\tscope.manager.itemEnd( url );\n\n\t\t\t\t}, _onError );\n\n\t\t\t} catch ( e ) {\n\n\t\t\t\t_onError( e );\n\n\t\t\t}\n\n\t\t}, onProgress, _onError );\n\n\t}\n\n\t/**\n\t * Sets the given Draco loader to this loader. Required for decoding assets\n\t * compressed with the `KHR_draco_mesh_compression` extension.\n\t *\n\t * @param {DRACOLoader} dracoLoader - The Draco loader to set.\n\t * @return {GLTFLoader} A reference to this loader.\n\t */\n\tsetDRACOLoader( dracoLoader ) {\n\n\t\tthis.dracoLoader = dracoLoader;\n\t\treturn this;\n\n\t}\n\n\t/**\n\t * Sets the given KTX2 loader to this loader. Required for loading KTX2\n\t * compressed textures.\n\t *\n\t * @param {KTX2Loader} ktx2Loader - The KTX2 loader to set.\n\t * @return {GLTFLoader} A reference to this loader.\n\t */\n\tsetKTX2Loader( ktx2Loader ) {\n\n\t\tthis.ktx2Loader = ktx2Loader;\n\t\treturn this;\n\n\t}\n\n\t/**\n\t * Sets the given meshopt decoder. Required for decoding assets\n\t * compressed with the `EXT_meshopt_compression` extension.\n\t *\n\t * @param {Object} meshoptDecoder - The meshopt decoder to set.\n\t * @return {GLTFLoader} A reference to this loader.\n\t */\n\tsetMeshoptDecoder( meshoptDecoder ) {\n\n\t\tthis.meshoptDecoder = meshoptDecoder;\n\t\treturn this;\n\n\t}\n\n\t/**\n\t * Registers a plugin callback. This API is internally used to implement the various\n\t * glTF extensions but can also used by third-party code to add additional logic\n\t * to the loader.\n\t *\n\t * @param {function(parser:GLTFParser)} callback - The callback function to register.\n\t * @return {GLTFLoader} A reference to this loader.\n\t */\n\tregister( callback ) {\n\n\t\tif ( this.pluginCallbacks.indexOf( callback ) === - 1 ) {\n\n\t\t\tthis.pluginCallbacks.push( callback );\n\n\t\t}\n\n\t\treturn this;\n\n\t}\n\n\t/**\n\t * Unregisters a plugin callback.\n\t *\n\t * @param {Function} callback - The callback function to unregister.\n\t * @return {GLTFLoader} A reference to this loader.\n\t */\n\tunregister( callback ) {\n\n\t\tif ( this.pluginCallbacks.indexOf( callback ) !== - 1 ) {\n\n\t\t\tthis.pluginCallbacks.splice( this.pluginCallbacks.indexOf( callback ), 1 );\n\n\t\t}\n\n\t\treturn this;\n\n\t}\n\n\t/**\n\t * Parses the given FBX data and returns the resulting group.\n\t *\n\t * @param {string|ArrayBuffer} data - The raw glTF data.\n\t * @param {string} path - The URL base path.\n\t * @param {function(GLTFLoader~LoadObject)} onLoad - Executed when the loading process has been finished.\n\t * @param {onErrorCallback} onError - Executed when errors occur.\n\t */\n\tparse( data, path, onLoad, onError ) {\n\n\t\tlet json;\n\t\tconst extensions = {};\n\t\tconst plugins = {};\n\t\tconst textDecoder = new TextDecoder();\n\n\t\tif ( typeof data === 'string' ) {\n\n\t\t\tjson = JSON.parse( data );\n\n\t\t} else if ( data instanceof ArrayBuffer ) {\n\n\t\t\tconst magic = textDecoder.decode( new Uint8Array( data, 0, 4 ) );\n\n\t\t\tif ( magic === BINARY_EXTENSION_HEADER_MAGIC ) {\n\n\t\t\t\ttry {\n\n\t\t\t\t\textensions[ EXTENSIONS.KHR_BINARY_GLTF ] = new GLTFBinaryExtension( data );\n\n\t\t\t\t} catch ( error ) {\n\n\t\t\t\t\tif ( onError ) onError( error );\n\t\t\t\t\treturn;\n\n\t\t\t\t}\n\n\t\t\t\tjson = JSON.parse( extensions[ EXTENSIONS.KHR_BINARY_GLTF ].content );\n\n\t\t\t} else {\n\n\t\t\t\tjson = JSON.parse( textDecoder.decode( data ) );\n\n\t\t\t}\n\n\t\t} else {\n\n\t\t\tjson = data;\n\n\t\t}\n\n\t\tif ( json.asset === undefined || json.asset.version[ 0 ] < 2 ) {\n\n\t\t\tif ( onError ) onError( new Error( 'THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.' ) );\n\t\t\treturn;\n\n\t\t}\n\n\t\tconst parser = new GLTFParser( json, {\n\n\t\t\tpath: path || this.resourcePath || '',\n\t\t\tcrossOrigin: this.crossOrigin,\n\t\t\trequestHeader: this.requestHeader,\n\t\t\tmanager: this.manager,\n\t\t\tktx2Loader: this.ktx2Loader,\n\t\t\tmeshoptDecoder: this.meshoptDecoder\n\n\t\t} );\n\n\t\tparser.fileLoader.setRequestHeader( this.requestHeader );\n\n\t\tfor ( let i = 0; i < this.pluginCallbacks.length; i ++ ) {\n\n\t\t\tconst plugin = this.pluginCallbacks[ i ]( parser );\n\n\t\t\tif ( ! plugin.name ) console.error( 'THREE.GLTFLoader: Invalid plugin found: missing name' );\n\n\t\t\tplugins[ plugin.name ] = plugin;\n\n\t\t\t// Workaround to avoid determining as unknown extension\n\t\t\t// in addUnknownExtensionsToUserData().\n\t\t\t// Remove this workaround if we move all the existing\n\t\t\t// extension handlers to plugin system\n\t\t\textensions[ plugin.name ] = true;\n\n\t\t}\n\n\t\tif ( json.extensionsUsed ) {\n\n\t\t\tfor ( let i = 0; i < json.extensionsUsed.length; ++ i ) {\n\n\t\t\t\tconst extensionName = json.extensionsUsed[ i ];\n\t\t\t\tconst extensionsRequired = json.extensionsRequired || [];\n\n\t\t\t\tswitch ( extensionName ) {\n\n\t\t\t\t\tcase EXTENSIONS.KHR_MATERIALS_UNLIT:\n\t\t\t\t\t\textensions[ extensionName ] = new GLTFMaterialsUnlitExtension();\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase EXTENSIONS.KHR_DRACO_MESH_COMPRESSION:\n\t\t\t\t\t\textensions[ extensionName ] = new GLTFDracoMeshCompressionExtension( json, this.dracoLoader );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase EXTENSIONS.KHR_TEXTURE_TRANSFORM:\n\t\t\t\t\t\textensions[ extensionName ] = new GLTFTextureTransformExtension();\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase EXTENSIONS.KHR_MESH_QUANTIZATION:\n\t\t\t\t\t\textensions[ extensionName ] = new GLTFMeshQuantizationExtension();\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tdefault:\n\n\t\t\t\t\t\tif ( extensionsRequired.indexOf( extensionName ) >= 0 && plugins[ extensionName ] === undefined ) {\n\n\t\t\t\t\t\t\tconsole.warn( 'THREE.GLTFLoader: Unknown extension \"' + extensionName + '\".' );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tparser.setExtensions( extensions );\n\t\tparser.setPlugins( plugins );\n\t\tparser.parse( onLoad, onError );\n\n\t}\n\n\t/**\n\t * Async version of {@link GLTFLoader#parse}.\n\t *\n\t * @async\n\t * @param {string|ArrayBuffer} data - The raw glTF data.\n\t * @param {string} path - The URL base path.\n\t * @return {Promise<GLTFLoader~LoadObject>} A Promise that resolves with the loaded glTF when the parsing has been finished.\n\t */\n\tparseAsync( data, path ) {\n\n\t\tconst scope = this;\n\n\t\treturn new Promise( function ( resolve, reject ) {\n\n\t\t\tscope.parse( data, path, resolve, reject );\n\n\t\t} );\n\n\t}\n\n}\n\n/* GLTFREGISTRY */\n\nfunction GLTFRegistry() {\n\n\tlet objects = {};\n\n\treturn\t{\n\n\t\tget: function ( key ) {\n\n\t\t\treturn objects[ key ];\n\n\t\t},\n\n\t\tadd: function ( key, object ) {\n\n\t\t\tobjects[ key ] = object;\n\n\t\t},\n\n\t\tremove: function ( key ) {\n\n\t\t\tdelete objects[ key ];\n\n\t\t},\n\n\t\tremoveAll: function () {\n\n\t\t\tobjects = {};\n\n\t\t}\n\n\t};\n\n}\n\n/*********************************/\n/********** EXTENSIONS ***********/\n/*********************************/\n\nconst EXTENSIONS = {\n\tKHR_BINARY_GLTF: 'KHR_binary_glTF',\n\tKHR_DRACO_MESH_COMPRESSION: 'KHR_draco_mesh_compression',\n\tKHR_LIGHTS_PUNCTUAL: 'KHR_lights_punctual',\n\tKHR_MATERIALS_CLEARCOAT: 'KHR_materials_clearcoat',\n\tKHR_MATERIALS_DISPERSION: 'KHR_materials_dispersion',\n\tKHR_MATERIALS_IOR: 'KHR_materials_ior',\n\tKHR_MATERIALS_SHEEN: 'KHR_materials_sheen',\n\tKHR_MATERIALS_SPECULAR: 'KHR_materials_specular',\n\tKHR_MATERIALS_TRANSMISSION: 'KHR_materials_transmission',\n\tKHR_MATERIALS_IRIDESCENCE: 'KHR_materials_iridescence',\n\tKHR_MATERIALS_ANISOTROPY: 'KHR_materials_anisotropy',\n\tKHR_MATERIALS_UNLIT: 'KHR_materials_unlit',\n\tKHR_MATERIALS_VOLUME: 'KHR_materials_volume',\n\tKHR_TEXTURE_BASISU: 'KHR_texture_basisu',\n\tKHR_TEXTURE_TRANSFORM: 'KHR_texture_transform',\n\tKHR_MESH_QUANTIZATION: 'KHR_mesh_quantization',\n\tKHR_MATERIALS_EMISSIVE_STRENGTH: 'KHR_materials_emissive_strength',\n\tEXT_MATERIALS_BUMP: 'EXT_materials_bump',\n\tEXT_TEXTURE_WEBP: 'EXT_texture_webp',\n\tEXT_TEXTURE_AVIF: 'EXT_texture_avif',\n\tEXT_MESHOPT_COMPRESSION: 'EXT_meshopt_compression',\n\tEXT_MESH_GPU_INSTANCING: 'EXT_mesh_gpu_instancing'\n};\n\n/**\n * Punctual Lights Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_lights_punctual\n *\n * @private\n */\nclass GLTFLightsExtension {\n\n\tconstructor( parser ) {\n\n\t\tthis.parser = parser;\n\t\tthis.name = EXTENSIONS.KHR_LIGHTS_PUNCTUAL;\n\n\t\t// Object3D instance caches\n\t\tthis.cache = { refs: {}, uses: {} };\n\n\t}\n\n\t_markDefs() {\n\n\t\tconst parser = this.parser;\n\t\tconst nodeDefs = this.parser.json.nodes || [];\n\n\t\tfor ( let nodeIndex = 0, nodeLength = nodeDefs.length; nodeIndex < nodeLength; nodeIndex ++ ) {\n\n\t\t\tconst nodeDef = nodeDefs[ nodeIndex ];\n\n\t\t\tif ( nodeDef.extensions\n\t\t\t\t\t&& nodeDef.extensions[ this.name ]\n\t\t\t\t\t&& nodeDef.extensions[ this.name ].light !== undefined ) {\n\n\t\t\t\tparser._addNodeRef( this.cache, nodeDef.extensions[ this.name ].light );\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n\t_loadLight( lightIndex ) {\n\n\t\tconst parser = this.parser;\n\t\tconst cacheKey = 'light:' + lightIndex;\n\t\tlet dependency = parser.cache.get( cacheKey );\n\n\t\tif ( dependency ) return dependency;\n\n\t\tconst json = parser.json;\n\t\tconst extensions = ( json.extensions && json.extensions[ this.name ] ) || {};\n\t\tconst lightDefs = extensions.lights || [];\n\t\tconst lightDef = lightDefs[ lightIndex ];\n\t\tlet lightNode;\n\n\t\tconst color = new Color( 0xffffff );\n\n\t\tif ( lightDef.color !== undefined ) color.setRGB( lightDef.color[ 0 ], lightDef.color[ 1 ], lightDef.color[ 2 ], LinearSRGBColorSpace );\n\n\t\tconst range = lightDef.range !== undefined ? lightDef.range : 0;\n\n\t\tswitch ( lightDef.type ) {\n\n\t\t\tcase 'directional':\n\t\t\t\tlightNode = new DirectionalLight( color );\n\t\t\t\tlightNode.target.position.set( 0, 0, - 1 );\n\t\t\t\tlightNode.add( lightNode.target );\n\t\t\t\tbreak;\n\n\t\t\tcase 'point':\n\t\t\t\tlightNode = new PointLight( color );\n\t\t\t\tlightNode.distance = range;\n\t\t\t\tbreak;\n\n\t\t\tcase 'spot':\n\t\t\t\tlightNode = new SpotLight( color );\n\t\t\t\tlightNode.distance = range;\n\t\t\t\t// Handle spotlight properties.\n\t\t\t\tlightDef.spot = lightDef.spot || {};\n\t\t\t\tlightDef.spot.innerConeAngle = lightDef.spot.innerConeAngle !== undefined ? lightDef.spot.innerConeAngle : 0;\n\t\t\t\tlightDef.spot.outerConeAngle = lightDef.spot.outerConeAngle !== undefined ? lightDef.spot.outerConeAngle : Math.PI / 4.0;\n\t\t\t\tlightNode.angle = lightDef.spot.outerConeAngle;\n\t\t\t\tlightNode.penumbra = 1.0 - lightDef.spot.innerConeAngle / lightDef.spot.outerConeAngle;\n\t\t\t\tlightNode.target.position.set( 0, 0, - 1 );\n\t\t\t\tlightNode.add( lightNode.target );\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tthrow new Error( 'THREE.GLTFLoader: Unexpected light type: ' + lightDef.type );\n\n\t\t}\n\n\t\t// Some lights (e.g. spot) default to a position other than the origin. Reset the position\n\t\t// here, because node-level parsing will only override position if explicitly specified.\n\t\tlightNode.position.set( 0, 0, 0 );\n\n\t\tassignExtrasToUserData( lightNode, lightDef );\n\n\t\tif ( lightDef.intensity !== undefined ) lightNode.intensity = lightDef.intensity;\n\n\t\tlightNode.name = parser.createUniqueName( lightDef.name || ( 'light_' + lightIndex ) );\n\n\t\tdependency = Promise.resolve( lightNode );\n\n\t\tparser.cache.add( cacheKey, dependency );\n\n\t\treturn dependency;\n\n\t}\n\n\tgetDependency( type, index ) {\n\n\t\tif ( type !== 'light' ) return;\n\n\t\treturn this._loadLight( index );\n\n\t}\n\n\tcreateNodeAttachment( nodeIndex ) {\n\n\t\tconst self = this;\n\t\tconst parser = this.parser;\n\t\tconst json = parser.json;\n\t\tconst nodeDef = json.nodes[ nodeIndex ];\n\t\tconst lightDef = ( nodeDef.extensions && nodeDef.extensions[ this.name ] ) || {};\n\t\tconst lightIndex = lightDef.light;\n\n\t\tif ( lightIndex === undefined ) return null;\n\n\t\treturn this._loadLight( lightIndex ).then( function ( light ) {\n\n\t\t\treturn parser._getNodeRef( self.cache, lightIndex, light );\n\n\t\t} );\n\n\t}\n\n}\n\n/**\n * Unlit Materials Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_unlit\n *\n * @private\n */\nclass GLTFMaterialsUnlitExtension {\n\n\tconstructor() {\n\n\t\tthis.name = EXTENSIONS.KHR_MATERIALS_UNLIT;\n\n\t}\n\n\tgetMaterialType() {\n\n\t\treturn MeshBasicMaterial;\n\n\t}\n\n\textendParams( materialParams, materialDef, parser ) {\n\n\t\tconst pending = [];\n\n\t\tmaterialParams.color = new Color( 1.0, 1.0, 1.0 );\n\t\tmaterialParams.opacity = 1.0;\n\n\t\tconst metallicRoughness = materialDef.pbrMetallicRoughness;\n\n\t\tif ( metallicRoughness ) {\n\n\t\t\tif ( Array.isArray( metallicRoughness.baseColorFactor ) ) {\n\n\t\t\t\tconst array = metallicRoughness.baseColorFactor;\n\n\t\t\t\tmaterialParams.color.setRGB( array[ 0 ], array[ 1 ], array[ 2 ], LinearSRGBColorSpace );\n\t\t\t\tmaterialParams.opacity = array[ 3 ];\n\n\t\t\t}\n\n\t\t\tif ( metallicRoughness.baseColorTexture !== undefined ) {\n\n\t\t\t\tpending.push( parser.assignTexture( materialParams, 'map', metallicRoughness.baseColorTexture, SRGBColorSpace ) );\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn Promise.all( pending );\n\n\t}\n\n}\n\n/**\n * Materials Emissive Strength Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/blob/5768b3ce0ef32bc39cdf1bef10b948586635ead3/extensions/2.0/Khronos/KHR_materials_emissive_strength/README.md\n *\n * @private\n */\nclass GLTFMaterialsEmissiveStrengthExtension {\n\n\tconstructor( parser ) {\n\n\t\tthis.parser = parser;\n\t\tthis.name = EXTENSIONS.KHR_MATERIALS_EMISSIVE_STRENGTH;\n\n\t}\n\n\textendMaterialParams( materialIndex, materialParams ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) {\n\n\t\t\treturn Promise.resolve();\n\n\t\t}\n\n\t\tconst emissiveStrength = materialDef.extensions[ this.name ].emissiveStrength;\n\n\t\tif ( emissiveStrength !== undefined ) {\n\n\t\t\tmaterialParams.emissiveIntensity = emissiveStrength;\n\n\t\t}\n\n\t\treturn Promise.resolve();\n\n\t}\n\n}\n\n/**\n * Clearcoat Materials Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_clearcoat\n *\n * @private\n */\nclass GLTFMaterialsClearcoatExtension {\n\n\tconstructor( parser ) {\n\n\t\tthis.parser = parser;\n\t\tthis.name = EXTENSIONS.KHR_MATERIALS_CLEARCOAT;\n\n\t}\n\n\tgetMaterialType( materialIndex ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) return null;\n\n\t\treturn MeshPhysicalMaterial;\n\n\t}\n\n\textendMaterialParams( materialIndex, materialParams ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) {\n\n\t\t\treturn Promise.resolve();\n\n\t\t}\n\n\t\tconst pending = [];\n\n\t\tconst extension = materialDef.extensions[ this.name ];\n\n\t\tif ( extension.clearcoatFactor !== undefined ) {\n\n\t\t\tmaterialParams.clearcoat = extension.clearcoatFactor;\n\n\t\t}\n\n\t\tif ( extension.clearcoatTexture !== undefined ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'clearcoatMap', extension.clearcoatTexture ) );\n\n\t\t}\n\n\t\tif ( extension.clearcoatRoughnessFactor !== undefined ) {\n\n\t\t\tmaterialParams.clearcoatRoughness = extension.clearcoatRoughnessFactor;\n\n\t\t}\n\n\t\tif ( extension.clearcoatRoughnessTexture !== undefined ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'clearcoatRoughnessMap', extension.clearcoatRoughnessTexture ) );\n\n\t\t}\n\n\t\tif ( extension.clearcoatNormalTexture !== undefined ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'clearcoatNormalMap', extension.clearcoatNormalTexture ) );\n\n\t\t\tif ( extension.clearcoatNormalTexture.scale !== undefined ) {\n\n\t\t\t\tconst scale = extension.clearcoatNormalTexture.scale;\n\n\t\t\t\tmaterialParams.clearcoatNormalScale = new Vector2( scale, scale );\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn Promise.all( pending );\n\n\t}\n\n}\n\n/**\n * Materials dispersion Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/main/extensions/2.0/Khronos/KHR_materials_dispersion\n *\n * @private\n */\nclass GLTFMaterialsDispersionExtension {\n\n\tconstructor( parser ) {\n\n\t\tthis.parser = parser;\n\t\tthis.name = EXTENSIONS.KHR_MATERIALS_DISPERSION;\n\n\t}\n\n\tgetMaterialType( materialIndex ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) return null;\n\n\t\treturn MeshPhysicalMaterial;\n\n\t}\n\n\textendMaterialParams( materialIndex, materialParams ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) {\n\n\t\t\treturn Promise.resolve();\n\n\t\t}\n\n\t\tconst extension = materialDef.extensions[ this.name ];\n\n\t\tmaterialParams.dispersion = extension.dispersion !== undefined ? extension.dispersion : 0;\n\n\t\treturn Promise.resolve();\n\n\t}\n\n}\n\n/**\n * Iridescence Materials Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_iridescence\n *\n * @private\n */\nclass GLTFMaterialsIridescenceExtension {\n\n\tconstructor( parser ) {\n\n\t\tthis.parser = parser;\n\t\tthis.name = EXTENSIONS.KHR_MATERIALS_IRIDESCENCE;\n\n\t}\n\n\tgetMaterialType( materialIndex ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) return null;\n\n\t\treturn MeshPhysicalMaterial;\n\n\t}\n\n\textendMaterialParams( materialIndex, materialParams ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) {\n\n\t\t\treturn Promise.resolve();\n\n\t\t}\n\n\t\tconst pending = [];\n\n\t\tconst extension = materialDef.extensions[ this.name ];\n\n\t\tif ( extension.iridescenceFactor !== undefined ) {\n\n\t\t\tmaterialParams.iridescence = extension.iridescenceFactor;\n\n\t\t}\n\n\t\tif ( extension.iridescenceTexture !== undefined ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'iridescenceMap', extension.iridescenceTexture ) );\n\n\t\t}\n\n\t\tif ( extension.iridescenceIor !== undefined ) {\n\n\t\t\tmaterialParams.iridescenceIOR = extension.iridescenceIor;\n\n\t\t}\n\n\t\tif ( materialParams.iridescenceThicknessRange === undefined ) {\n\n\t\t\tmaterialParams.iridescenceThicknessRange = [ 100, 400 ];\n\n\t\t}\n\n\t\tif ( extension.iridescenceThicknessMinimum !== undefined ) {\n\n\t\t\tmaterialParams.iridescenceThicknessRange[ 0 ] = extension.iridescenceThicknessMinimum;\n\n\t\t}\n\n\t\tif ( extension.iridescenceThicknessMaximum !== undefined ) {\n\n\t\t\tmaterialParams.iridescenceThicknessRange[ 1 ] = extension.iridescenceThicknessMaximum;\n\n\t\t}\n\n\t\tif ( extension.iridescenceThicknessTexture !== undefined ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'iridescenceThicknessMap', extension.iridescenceThicknessTexture ) );\n\n\t\t}\n\n\t\treturn Promise.all( pending );\n\n\t}\n\n}\n\n/**\n * Sheen Materials Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/main/extensions/2.0/Khronos/KHR_materials_sheen\n *\n * @private\n */\nclass GLTFMaterialsSheenExtension {\n\n\tconstructor( parser ) {\n\n\t\tthis.parser = parser;\n\t\tthis.name = EXTENSIONS.KHR_MATERIALS_SHEEN;\n\n\t}\n\n\tgetMaterialType( materialIndex ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) return null;\n\n\t\treturn MeshPhysicalMaterial;\n\n\t}\n\n\textendMaterialParams( materialIndex, materialParams ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) {\n\n\t\t\treturn Promise.resolve();\n\n\t\t}\n\n\t\tconst pending = [];\n\n\t\tmaterialParams.sheenColor = new Color( 0, 0, 0 );\n\t\tmaterialParams.sheenRoughness = 0;\n\t\tmaterialParams.sheen = 1;\n\n\t\tconst extension = materialDef.extensions[ this.name ];\n\n\t\tif ( extension.sheenColorFactor !== undefined ) {\n\n\t\t\tconst colorFactor = extension.sheenColorFactor;\n\t\t\tmaterialParams.sheenColor.setRGB( colorFactor[ 0 ], colorFactor[ 1 ], colorFactor[ 2 ], LinearSRGBColorSpace );\n\n\t\t}\n\n\t\tif ( extension.sheenRoughnessFactor !== undefined ) {\n\n\t\t\tmaterialParams.sheenRoughness = extension.sheenRoughnessFactor;\n\n\t\t}\n\n\t\tif ( extension.sheenColorTexture !== undefined ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'sheenColorMap', extension.sheenColorTexture, SRGBColorSpace ) );\n\n\t\t}\n\n\t\tif ( extension.sheenRoughnessTexture !== undefined ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'sheenRoughnessMap', extension.sheenRoughnessTexture ) );\n\n\t\t}\n\n\t\treturn Promise.all( pending );\n\n\t}\n\n}\n\n/**\n * Transmission Materials Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_transmission\n * Draft: https://github.com/KhronosGroup/glTF/pull/1698\n *\n * @private\n */\nclass GLTFMaterialsTransmissionExtension {\n\n\tconstructor( parser ) {\n\n\t\tthis.parser = parser;\n\t\tthis.name = EXTENSIONS.KHR_MATERIALS_TRANSMISSION;\n\n\t}\n\n\tgetMaterialType( materialIndex ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) return null;\n\n\t\treturn MeshPhysicalMaterial;\n\n\t}\n\n\textendMaterialParams( materialIndex, materialParams ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) {\n\n\t\t\treturn Promise.resolve();\n\n\t\t}\n\n\t\tconst pending = [];\n\n\t\tconst extension = materialDef.extensions[ this.name ];\n\n\t\tif ( extension.transmissionFactor !== undefined ) {\n\n\t\t\tmaterialParams.transmission = extension.transmissionFactor;\n\n\t\t}\n\n\t\tif ( extension.transmissionTexture !== undefined ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'transmissionMap', extension.transmissionTexture ) );\n\n\t\t}\n\n\t\treturn Promise.all( pending );\n\n\t}\n\n}\n\n/**\n * Materials Volume Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_volume\n *\n * @private\n */\nclass GLTFMaterialsVolumeExtension {\n\n\tconstructor( parser ) {\n\n\t\tthis.parser = parser;\n\t\tthis.name = EXTENSIONS.KHR_MATERIALS_VOLUME;\n\n\t}\n\n\tgetMaterialType( materialIndex ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) return null;\n\n\t\treturn MeshPhysicalMaterial;\n\n\t}\n\n\textendMaterialParams( materialIndex, materialParams ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) {\n\n\t\t\treturn Promise.resolve();\n\n\t\t}\n\n\t\tconst pending = [];\n\n\t\tconst extension = materialDef.extensions[ this.name ];\n\n\t\tmaterialParams.thickness = extension.thicknessFactor !== undefined ? extension.thicknessFactor : 0;\n\n\t\tif ( extension.thicknessTexture !== undefined ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'thicknessMap', extension.thicknessTexture ) );\n\n\t\t}\n\n\t\tmaterialParams.attenuationDistance = extension.attenuationDistance || Infinity;\n\n\t\tconst colorArray = extension.attenuationColor || [ 1, 1, 1 ];\n\t\tmaterialParams.attenuationColor = new Color().setRGB( colorArray[ 0 ], colorArray[ 1 ], colorArray[ 2 ], LinearSRGBColorSpace );\n\n\t\treturn Promise.all( pending );\n\n\t}\n\n}\n\n/**\n * Materials ior Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_ior\n *\n * @private\n */\nclass GLTFMaterialsIorExtension {\n\n\tconstructor( parser ) {\n\n\t\tthis.parser = parser;\n\t\tthis.name = EXTENSIONS.KHR_MATERIALS_IOR;\n\n\t}\n\n\tgetMaterialType( materialIndex ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) return null;\n\n\t\treturn MeshPhysicalMaterial;\n\n\t}\n\n\textendMaterialParams( materialIndex, materialParams ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) {\n\n\t\t\treturn Promise.resolve();\n\n\t\t}\n\n\t\tconst extension = materialDef.extensions[ this.name ];\n\n\t\tmaterialParams.ior = extension.ior !== undefined ? extension.ior : 1.5;\n\n\t\treturn Promise.resolve();\n\n\t}\n\n}\n\n/**\n * Materials specular Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_specular\n *\n * @private\n */\nclass GLTFMaterialsSpecularExtension {\n\n\tconstructor( parser ) {\n\n\t\tthis.parser = parser;\n\t\tthis.name = EXTENSIONS.KHR_MATERIALS_SPECULAR;\n\n\t}\n\n\tgetMaterialType( materialIndex ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) return null;\n\n\t\treturn MeshPhysicalMaterial;\n\n\t}\n\n\textendMaterialParams( materialIndex, materialParams ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) {\n\n\t\t\treturn Promise.resolve();\n\n\t\t}\n\n\t\tconst pending = [];\n\n\t\tconst extension = materialDef.extensions[ this.name ];\n\n\t\tmaterialParams.specularIntensity = extension.specularFactor !== undefined ? extension.specularFactor : 1.0;\n\n\t\tif ( extension.specularTexture !== undefined ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'specularIntensityMap', extension.specularTexture ) );\n\n\t\t}\n\n\t\tconst colorArray = extension.specularColorFactor || [ 1, 1, 1 ];\n\t\tmaterialParams.specularColor = new Color().setRGB( colorArray[ 0 ], colorArray[ 1 ], colorArray[ 2 ], LinearSRGBColorSpace );\n\n\t\tif ( extension.specularColorTexture !== undefined ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'specularColorMap', extension.specularColorTexture, SRGBColorSpace ) );\n\n\t\t}\n\n\t\treturn Promise.all( pending );\n\n\t}\n\n}\n\n\n/**\n * Materials bump Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/EXT_materials_bump\n *\n * @private\n */\nclass GLTFMaterialsBumpExtension {\n\n\tconstructor( parser ) {\n\n\t\tthis.parser = parser;\n\t\tthis.name = EXTENSIONS.EXT_MATERIALS_BUMP;\n\n\t}\n\n\tgetMaterialType( materialIndex ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) return null;\n\n\t\treturn MeshPhysicalMaterial;\n\n\t}\n\n\textendMaterialParams( materialIndex, materialParams ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) {\n\n\t\t\treturn Promise.resolve();\n\n\t\t}\n\n\t\tconst pending = [];\n\n\t\tconst extension = materialDef.extensions[ this.name ];\n\n\t\tmaterialParams.bumpScale = extension.bumpFactor !== undefined ? extension.bumpFactor : 1.0;\n\n\t\tif ( extension.bumpTexture !== undefined ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'bumpMap', extension.bumpTexture ) );\n\n\t\t}\n\n\t\treturn Promise.all( pending );\n\n\t}\n\n}\n\n/**\n * Materials anisotropy Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_anisotropy\n *\n * @private\n */\nclass GLTFMaterialsAnisotropyExtension {\n\n\tconstructor( parser ) {\n\n\t\tthis.parser = parser;\n\t\tthis.name = EXTENSIONS.KHR_MATERIALS_ANISOTROPY;\n\n\t}\n\n\tgetMaterialType( materialIndex ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) return null;\n\n\t\treturn MeshPhysicalMaterial;\n\n\t}\n\n\textendMaterialParams( materialIndex, materialParams ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) {\n\n\t\t\treturn Promise.resolve();\n\n\t\t}\n\n\t\tconst pending = [];\n\n\t\tconst extension = materialDef.extensions[ this.name ];\n\n\t\tif ( extension.anisotropyStrength !== undefined ) {\n\n\t\t\tmaterialParams.anisotropy = extension.anisotropyStrength;\n\n\t\t}\n\n\t\tif ( extension.anisotropyRotation !== undefined ) {\n\n\t\t\tmaterialParams.anisotropyRotation = extension.anisotropyRotation;\n\n\t\t}\n\n\t\tif ( extension.anisotropyTexture !== undefined ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'anisotropyMap', extension.anisotropyTexture ) );\n\n\t\t}\n\n\t\treturn Promise.all( pending );\n\n\t}\n\n}\n\n/**\n * BasisU Texture Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_texture_basisu\n *\n * @private\n */\nclass GLTFTextureBasisUExtension {\n\n\tconstructor( parser ) {\n\n\t\tthis.parser = parser;\n\t\tthis.name = EXTENSIONS.KHR_TEXTURE_BASISU;\n\n\t}\n\n\tloadTexture( textureIndex ) {\n\n\t\tconst parser = this.parser;\n\t\tconst json = parser.json;\n\n\t\tconst textureDef = json.textures[ textureIndex ];\n\n\t\tif ( ! textureDef.extensions || ! textureDef.extensions[ this.name ] ) {\n\n\t\t\treturn null;\n\n\t\t}\n\n\t\tconst extension = textureDef.extensions[ this.name ];\n\t\tconst loader = parser.options.ktx2Loader;\n\n\t\tif ( ! loader ) {\n\n\t\t\tif ( json.extensionsRequired && json.extensionsRequired.indexOf( this.name ) >= 0 ) {\n\n\t\t\t\tthrow new Error( 'THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures' );\n\n\t\t\t} else {\n\n\t\t\t\t// Assumes that the extension is optional and that a fallback texture is present\n\t\t\t\treturn null;\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn parser.loadTextureImage( textureIndex, extension.source, loader );\n\n\t}\n\n}\n\n/**\n * WebP Texture Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Vendor/EXT_texture_webp\n *\n * @private\n */\nclass GLTFTextureWebPExtension {\n\n\tconstructor( parser ) {\n\n\t\tthis.parser = parser;\n\t\tthis.name = EXTENSIONS.EXT_TEXTURE_WEBP;\n\t\tthis.isSupported = null;\n\n\t}\n\n\tloadTexture( textureIndex ) {\n\n\t\tconst name = this.name;\n\t\tconst parser = this.parser;\n\t\tconst json = parser.json;\n\n\t\tconst textureDef = json.textures[ textureIndex ];\n\n\t\tif ( ! textureDef.extensions || ! textureDef.extensions[ name ] ) {\n\n\t\t\treturn null;\n\n\t\t}\n\n\t\tconst extension = textureDef.extensions[ name ];\n\t\tconst source = json.images[ extension.source ];\n\n\t\tlet loader = parser.textureLoader;\n\t\tif ( source.uri ) {\n\n\t\t\tconst handler = parser.options.manager.getHandler( source.uri );\n\t\t\tif ( handler !== null ) loader = handler;\n\n\t\t}\n\n\t\treturn this.detectSupport().then( function ( isSupported ) {\n\n\t\t\tif ( isSupported ) return parser.loadTextureImage( textureIndex, extension.source, loader );\n\n\t\t\tif ( json.extensionsRequired && json.extensionsRequired.indexOf( name ) >= 0 ) {\n\n\t\t\t\tthrow new Error( 'THREE.GLTFLoader: WebP required by asset but unsupported.' );\n\n\t\t\t}\n\n\t\t\t// Fall back to PNG or JPEG.\n\t\t\treturn parser.loadTexture( textureIndex );\n\n\t\t} );\n\n\t}\n\n\tdetectSupport() {\n\n\t\tif ( ! this.isSupported ) {\n\n\t\t\tthis.isSupported = new Promise( function ( resolve ) {\n\n\t\t\t\tconst image = new Image();\n\n\t\t\t\t// Lossy test image. Support for lossy images doesn't guarantee support for all\n\t\t\t\t// WebP images, unfortunately.\n\t\t\t\timage.src = 'data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA';\n\n\t\t\t\timage.onload = image.onerror = function () {\n\n\t\t\t\t\tresolve( image.height === 1 );\n\n\t\t\t\t};\n\n\t\t\t} );\n\n\t\t}\n\n\t\treturn this.isSupported;\n\n\t}\n\n}\n\n/**\n * AVIF Texture Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Vendor/EXT_texture_avif\n *\n * @private\n */\nclass GLTFTextureAVIFExtension {\n\n\tconstructor( parser ) {\n\n\t\tthis.parser = parser;\n\t\tthis.name = EXTENSIONS.EXT_TEXTURE_AVIF;\n\t\tthis.isSupported = null;\n\n\t}\n\n\tloadTexture( textureIndex ) {\n\n\t\tconst name = this.name;\n\t\tconst parser = this.parser;\n\t\tconst json = parser.json;\n\n\t\tconst textureDef = json.textures[ textureIndex ];\n\n\t\tif ( ! textureDef.extensions || ! textureDef.extensions[ name ] ) {\n\n\t\t\treturn null;\n\n\t\t}\n\n\t\tconst extension = textureDef.extensions[ name ];\n\t\tconst source = json.images[ extension.source ];\n\n\t\tlet loader = parser.textureLoader;\n\t\tif ( source.uri ) {\n\n\t\t\tconst handler = parser.options.manager.getHandler( source.uri );\n\t\t\tif ( handler !== null ) loader = handler;\n\n\t\t}\n\n\t\treturn this.detectSupport().then( function ( isSupported ) {\n\n\t\t\tif ( isSupported ) return parser.loadTextureImage( textureIndex, extension.source, loader );\n\n\t\t\tif ( json.extensionsRequired && json.extensionsRequired.indexOf( name ) >= 0 ) {\n\n\t\t\t\tthrow new Error( 'THREE.GLTFLoader: AVIF required by asset but unsupported.' );\n\n\t\t\t}\n\n\t\t\t// Fall back to PNG or JPEG.\n\t\t\treturn parser.loadTexture( textureIndex );\n\n\t\t} );\n\n\t}\n\n\tdetectSupport() {\n\n\t\tif ( ! this.isSupported ) {\n\n\t\t\tthis.isSupported = new Promise( function ( resolve ) {\n\n\t\t\t\tconst image = new Image();\n\n\t\t\t\t// Lossy test image.\n\t\t\t\timage.src = 'data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=';\n\t\t\t\timage.onload = image.onerror = function () {\n\n\t\t\t\t\tresolve( image.height === 1 );\n\n\t\t\t\t};\n\n\t\t\t} );\n\n\t\t}\n\n\t\treturn this.isSupported;\n\n\t}\n\n}\n\n/**\n * meshopt BufferView Compression Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Vendor/EXT_meshopt_compression\n *\n * @private\n */\nclass GLTFMeshoptCompression {\n\n\tconstructor( parser ) {\n\n\t\tthis.name = EXTENSIONS.EXT_MESHOPT_COMPRESSION;\n\t\tthis.parser = parser;\n\n\t}\n\n\tloadBufferView( index ) {\n\n\t\tconst json = this.parser.json;\n\t\tconst bufferView = json.bufferViews[ index ];\n\n\t\tif ( bufferView.extensions && bufferView.extensions[ this.name ] ) {\n\n\t\t\tconst extensionDef = bufferView.extensions[ this.name ];\n\n\t\t\tconst buffer = this.parser.getDependency( 'buffer', extensionDef.buffer );\n\t\t\tconst decoder = this.parser.options.meshoptDecoder;\n\n\t\t\tif ( ! decoder || ! decoder.supported ) {\n\n\t\t\t\tif ( json.extensionsRequired && json.extensionsRequired.indexOf( this.name ) >= 0 ) {\n\n\t\t\t\t\tthrow new Error( 'THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files' );\n\n\t\t\t\t} else {\n\n\t\t\t\t\t// Assumes that the extension is optional and that fallback buffer data is present\n\t\t\t\t\treturn null;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn buffer.then( function ( res ) {\n\n\t\t\t\tconst byteOffset = extensionDef.byteOffset || 0;\n\t\t\t\tconst byteLength = extensionDef.byteLength || 0;\n\n\t\t\t\tconst count = extensionDef.count;\n\t\t\t\tconst stride = extensionDef.byteStride;\n\n\t\t\t\tconst source = new Uint8Array( res, byteOffset, byteLength );\n\n\t\t\t\tif ( decoder.decodeGltfBufferAsync ) {\n\n\t\t\t\t\treturn decoder.decodeGltfBufferAsync( count, stride, source, extensionDef.mode, extensionDef.filter ).then( function ( res ) {\n\n\t\t\t\t\t\treturn res.buffer;\n\n\t\t\t\t\t} );\n\n\t\t\t\t} else {\n\n\t\t\t\t\t// Support for MeshoptDecoder 0.18 or earlier, without decodeGltfBufferAsync\n\t\t\t\t\treturn decoder.ready.then( function () {\n\n\t\t\t\t\t\tconst result = new ArrayBuffer( count * stride );\n\t\t\t\t\t\tdecoder.decodeGltfBuffer( new Uint8Array( result ), count, stride, source, extensionDef.mode, extensionDef.filter );\n\t\t\t\t\t\treturn result;\n\n\t\t\t\t\t} );\n\n\t\t\t\t}\n\n\t\t\t} );\n\n\t\t} else {\n\n\t\t\treturn null;\n\n\t\t}\n\n\t}\n\n}\n\n/**\n * GPU Instancing Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Vendor/EXT_mesh_gpu_instancing\n *\n * @private\n */\nclass GLTFMeshGpuInstancing {\n\n\tconstructor( parser ) {\n\n\t\tthis.name = EXTENSIONS.EXT_MESH_GPU_INSTANCING;\n\t\tthis.parser = parser;\n\n\t}\n\n\tcreateNodeMesh( nodeIndex ) {\n\n\t\tconst json = this.parser.json;\n\t\tconst nodeDef = json.nodes[ nodeIndex ];\n\n\t\tif ( ! nodeDef.extensions || ! nodeDef.extensions[ this.name ] ||\n\t\t\tnodeDef.mesh === undefined ) {\n\n\t\t\treturn null;\n\n\t\t}\n\n\t\tconst meshDef = json.meshes[ nodeDef.mesh ];\n\n\t\t// No Points or Lines + Instancing support yet\n\n\t\tfor ( const primitive of meshDef.primitives ) {\n\n\t\t\tif ( primitive.mode !== WEBGL_CONSTANTS.TRIANGLES &&\n\t\t\t\t primitive.mode !== WEBGL_CONSTANTS.TRIANGLE_STRIP &&\n\t\t\t\t primitive.mode !== WEBGL_CONSTANTS.TRIANGLE_FAN &&\n\t\t\t\t primitive.mode !== undefined ) {\n\n\t\t\t\treturn null;\n\n\t\t\t}\n\n\t\t}\n\n\t\tconst extensionDef = nodeDef.extensions[ this.name ];\n\t\tconst attributesDef = extensionDef.attributes;\n\n\t\t// @TODO: Can we support InstancedMesh + SkinnedMesh?\n\n\t\tconst pending = [];\n\t\tconst attributes = {};\n\n\t\tfor ( const key in attributesDef ) {\n\n\t\t\tpending.push( this.parser.getDependency( 'accessor', attributesDef[ key ] ).then( accessor => {\n\n\t\t\t\tattributes[ key ] = accessor;\n\t\t\t\treturn attributes[ key ];\n\n\t\t\t} ) );\n\n\t\t}\n\n\t\tif ( pending.length < 1 ) {\n\n\t\t\treturn null;\n\n\t\t}\n\n\t\tpending.push( this.parser.createNodeMesh( nodeIndex ) );\n\n\t\treturn Promise.all( pending ).then( results => {\n\n\t\t\tconst nodeObject = results.pop();\n\t\t\tconst meshes = nodeObject.isGroup ? nodeObject.children : [ nodeObject ];\n\t\t\tconst count = results[ 0 ].count; // All attribute counts should be same\n\t\t\tconst instancedMeshes = [];\n\n\t\t\tfor ( const mesh of meshes ) {\n\n\t\t\t\t// Temporal variables\n\t\t\t\tconst m = new Matrix4();\n\t\t\t\tconst p = new Vector3();\n\t\t\t\tconst q = new Quaternion();\n\t\t\t\tconst s = new Vector3( 1, 1, 1 );\n\n\t\t\t\tconst instancedMesh = new InstancedMesh( mesh.geometry, mesh.material, count );\n\n\t\t\t\tfor ( let i = 0; i < count; i ++ ) {\n\n\t\t\t\t\tif ( attributes.TRANSLATION ) {\n\n\t\t\t\t\t\tp.fromBufferAttribute( attributes.TRANSLATION, i );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( attributes.ROTATION ) {\n\n\t\t\t\t\t\tq.fromBufferAttribute( attributes.ROTATION, i );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( attributes.SCALE ) {\n\n\t\t\t\t\t\ts.fromBufferAttribute( attributes.SCALE, i );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tinstancedMesh.setMatrixAt( i, m.compose( p, q, s ) );\n\n\t\t\t\t}\n\n\t\t\t\t// Add instance attributes to the geometry, excluding TRS.\n\t\t\t\tfor ( const attributeName in attributes ) {\n\n\t\t\t\t\tif ( attributeName === '_COLOR_0' ) {\n\n\t\t\t\t\t\tconst attr = attributes[ attributeName ];\n\t\t\t\t\t\tinstancedMesh.instanceColor = new InstancedBufferAttribute( attr.array, attr.itemSize, attr.normalized );\n\n\t\t\t\t\t} else if ( attributeName !== 'TRANSLATION' &&\n\t\t\t\t\t\t attributeName !== 'ROTATION' &&\n\t\t\t\t\t\t attributeName !== 'SCALE' ) {\n\n\t\t\t\t\t\tmesh.geometry.setAttribute( attributeName, attributes[ attributeName ] );\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\t// Just in case\n\t\t\t\tObject3D.prototype.copy.call( instancedMesh, mesh );\n\n\t\t\t\tthis.parser.assignFinalMaterial( instancedMesh );\n\n\t\t\t\tinstancedMeshes.push( instancedMesh );\n\n\t\t\t}\n\n\t\t\tif ( nodeObject.isGroup ) {\n\n\t\t\t\tnodeObject.clear();\n\n\t\t\t\tnodeObject.add( ... instancedMeshes );\n\n\t\t\t\treturn nodeObject;\n\n\t\t\t}\n\n\t\t\treturn instancedMeshes[ 0 ];\n\n\t\t} );\n\n\t}\n\n}\n\n/* BINARY EXTENSION */\nconst BINARY_EXTENSION_HEADER_MAGIC = 'glTF';\nconst BINARY_EXTENSION_HEADER_LENGTH = 12;\nconst BINARY_EXTENSION_CHUNK_TYPES = { JSON: 0x4E4F534A, BIN: 0x004E4942 };\n\nclass GLTFBinaryExtension {\n\n\tconstructor( data ) {\n\n\t\tthis.name = EXTENSIONS.KHR_BINARY_GLTF;\n\t\tthis.content = null;\n\t\tthis.body = null;\n\n\t\tconst headerView = new DataView( data, 0, BINARY_EXTENSION_HEADER_LENGTH );\n\t\tconst textDecoder = new TextDecoder();\n\n\t\tthis.header = {\n\t\t\tmagic: textDecoder.decode( new Uint8Array( data.slice( 0, 4 ) ) ),\n\t\t\tversion: headerView.getUint32( 4, true ),\n\t\t\tlength: headerView.getUint32( 8, true )\n\t\t};\n\n\t\tif ( this.header.magic !== BINARY_EXTENSION_HEADER_MAGIC ) {\n\n\t\t\tthrow new Error( 'THREE.GLTFLoader: Unsupported glTF-Binary header.' );\n\n\t\t} else if ( this.header.version < 2.0 ) {\n\n\t\t\tthrow new Error( 'THREE.GLTFLoader: Legacy binary file detected.' );\n\n\t\t}\n\n\t\tconst chunkContentsLength = this.header.length - BINARY_EXTENSION_HEADER_LENGTH;\n\t\tconst chunkView = new DataView( data, BINARY_EXTENSION_HEADER_LENGTH );\n\t\tlet chunkIndex = 0;\n\n\t\twhile ( chunkIndex < chunkContentsLength ) {\n\n\t\t\tconst chunkLength = chunkView.getUint32( chunkIndex, true );\n\t\t\tchunkIndex += 4;\n\n\t\t\tconst chunkType = chunkView.getUint32( chunkIndex, true );\n\t\t\tchunkIndex += 4;\n\n\t\t\tif ( chunkType === BINARY_EXTENSION_CHUNK_TYPES.JSON ) {\n\n\t\t\t\tconst contentArray = new Uint8Array( data, BINARY_EXTENSION_HEADER_LENGTH + chunkIndex, chunkLength );\n\t\t\t\tthis.content = textDecoder.decode( contentArray );\n\n\t\t\t} else if ( chunkType === BINARY_EXTENSION_CHUNK_TYPES.BIN ) {\n\n\t\t\t\tconst byteOffset = BINARY_EXTENSION_HEADER_LENGTH + chunkIndex;\n\t\t\t\tthis.body = data.slice( byteOffset, byteOffset + chunkLength );\n\n\t\t\t}\n\n\t\t\t// Clients must ignore chunks with unknown types.\n\n\t\t\tchunkIndex += chunkLength;\n\n\t\t}\n\n\t\tif ( this.content === null ) {\n\n\t\t\tthrow new Error( 'THREE.GLTFLoader: JSON content not found.' );\n\n\t\t}\n\n\t}\n\n}\n\n/**\n * DRACO Mesh Compression Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_draco_mesh_compression\n *\n * @private\n */\nclass GLTFDracoMeshCompressionExtension {\n\n\tconstructor( json, dracoLoader ) {\n\n\t\tif ( ! dracoLoader ) {\n\n\t\t\tthrow new Error( 'THREE.GLTFLoader: No DRACOLoader instance provided.' );\n\n\t\t}\n\n\t\tthis.name = EXTENSIONS.KHR_DRACO_MESH_COMPRESSION;\n\t\tthis.json = json;\n\t\tthis.dracoLoader = dracoLoader;\n\t\tthis.dracoLoader.preload();\n\n\t}\n\n\tdecodePrimitive( primitive, parser ) {\n\n\t\tconst json = this.json;\n\t\tconst dracoLoader = this.dracoLoader;\n\t\tconst bufferViewIndex = primitive.extensions[ this.name ].bufferView;\n\t\tconst gltfAttributeMap = primitive.extensions[ this.name ].attributes;\n\t\tconst threeAttributeMap = {};\n\t\tconst attributeNormalizedMap = {};\n\t\tconst attributeTypeMap = {};\n\n\t\tfor ( const attributeName in gltfAttributeMap ) {\n\n\t\t\tconst threeAttributeName = ATTRIBUTES[ attributeName ] || attributeName.toLowerCase();\n\n\t\t\tthreeAttributeMap[ threeAttributeName ] = gltfAttributeMap[ attributeName ];\n\n\t\t}\n\n\t\tfor ( const attributeName in primitive.attributes ) {\n\n\t\t\tconst threeAttributeName = ATTRIBUTES[ attributeName ] || attributeName.toLowerCase();\n\n\t\t\tif ( gltfAttributeMap[ attributeName ] !== undefined ) {\n\n\t\t\t\tconst accessorDef = json.accessors[ primitive.attributes[ attributeName ] ];\n\t\t\t\tconst componentType = WEBGL_COMPONENT_TYPES[ accessorDef.componentType ];\n\n\t\t\t\tattributeTypeMap[ threeAttributeName ] = componentType.name;\n\t\t\t\tattributeNormalizedMap[ threeAttributeName ] = accessorDef.normalized === true;\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn parser.getDependency( 'bufferView', bufferViewIndex ).then( function ( bufferView ) {\n\n\t\t\treturn new Promise( function ( resolve, reject ) {\n\n\t\t\t\tdracoLoader.decodeDracoFile( bufferView, function ( geometry ) {\n\n\t\t\t\t\tfor ( const attributeName in geometry.attributes ) {\n\n\t\t\t\t\t\tconst attribute = geometry.attributes[ attributeName ];\n\t\t\t\t\t\tconst normalized = attributeNormalizedMap[ attributeName ];\n\n\t\t\t\t\t\tif ( normalized !== undefined ) attribute.normalized = normalized;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tresolve( geometry );\n\n\t\t\t\t}, threeAttributeMap, attributeTypeMap, LinearSRGBColorSpace, reject );\n\n\t\t\t} );\n\n\t\t} );\n\n\t}\n\n}\n\n/**\n * Texture Transform Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_texture_transform\n *\n * @private\n */\nclass GLTFTextureTransformExtension {\n\n\tconstructor() {\n\n\t\tthis.name = EXTENSIONS.KHR_TEXTURE_TRANSFORM;\n\n\t}\n\n\textendTexture( texture, transform ) {\n\n\t\tif ( ( transform.texCoord === undefined || transform.texCoord === texture.channel )\n\t\t\t&& transform.offset === undefined\n\t\t\t&& transform.rotation === undefined\n\t\t\t&& transform.scale === undefined ) {\n\n\t\t\t// See https://github.com/mrdoob/three.js/issues/21819.\n\t\t\treturn texture;\n\n\t\t}\n\n\t\ttexture = texture.clone();\n\n\t\tif ( transform.texCoord !== undefined ) {\n\n\t\t\ttexture.channel = transform.texCoord;\n\n\t\t}\n\n\t\tif ( transform.offset !== undefined ) {\n\n\t\t\ttexture.offset.fromArray( transform.offset );\n\n\t\t}\n\n\t\tif ( transform.rotation !== undefined ) {\n\n\t\t\ttexture.rotation = transform.rotation;\n\n\t\t}\n\n\t\tif ( transform.scale !== undefined ) {\n\n\t\t\ttexture.repeat.fromArray( transform.scale );\n\n\t\t}\n\n\t\ttexture.needsUpdate = true;\n\n\t\treturn texture;\n\n\t}\n\n}\n\n/**\n * Mesh Quantization Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_mesh_quantization\n *\n * @private\n */\nclass GLTFMeshQuantizationExtension {\n\n\tconstructor() {\n\n\t\tthis.name = EXTENSIONS.KHR_MESH_QUANTIZATION;\n\n\t}\n\n}\n\n/*********************************/\n/********** INTERPOLATION ********/\n/*********************************/\n\n// Spline Interpolation\n// Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#appendix-c-spline-interpolation\nclass GLTFCubicSplineInterpolant extends Interpolant {\n\n\tconstructor( parameterPositions, sampleValues, sampleSize, resultBuffer ) {\n\n\t\tsuper( parameterPositions, sampleValues, sampleSize, resultBuffer );\n\n\t}\n\n\tcopySampleValue_( index ) {\n\n\t\t// Copies a sample value to the result buffer. See description of glTF\n\t\t// CUBICSPLINE values layout in interpolate_() function below.\n\n\t\tconst result = this.resultBuffer,\n\t\t\tvalues = this.sampleValues,\n\t\t\tvalueSize = this.valueSize,\n\t\t\toffset = index * valueSize * 3 + valueSize;\n\n\t\tfor ( let i = 0; i !== valueSize; i ++ ) {\n\n\t\t\tresult[ i ] = values[ offset + i ];\n\n\t\t}\n\n\t\treturn result;\n\n\t}\n\n\tinterpolate_( i1, t0, t, t1 ) {\n\n\t\tconst result = this.resultBuffer;\n\t\tconst values = this.sampleValues;\n\t\tconst stride = this.valueSize;\n\n\t\tconst stride2 = stride * 2;\n\t\tconst stride3 = stride * 3;\n\n\t\tconst td = t1 - t0;\n\n\t\tconst p = ( t - t0 ) / td;\n\t\tconst pp = p * p;\n\t\tconst ppp = pp * p;\n\n\t\tconst offset1 = i1 * stride3;\n\t\tconst offset0 = offset1 - stride3;\n\n\t\tconst s2 = - 2 * ppp + 3 * pp;\n\t\tconst s3 = ppp - pp;\n\t\tconst s0 = 1 - s2;\n\t\tconst s1 = s3 - pp + p;\n\n\t\t// Layout of keyframe output values for CUBICSPLINE animations:\n\t\t//   [ inTangent_1, splineVertex_1, outTangent_1, inTangent_2, splineVertex_2, ... ]\n\t\tfor ( let i = 0; i !== stride; i ++ ) {\n\n\t\t\tconst p0 = values[ offset0 + i + stride ]; // splineVertex_k\n\t\t\tconst m0 = values[ offset0 + i + stride2 ] * td; // outTangent_k * (t_k+1 - t_k)\n\t\t\tconst p1 = values[ offset1 + i + stride ]; // splineVertex_k+1\n\t\t\tconst m1 = values[ offset1 + i ] * td; // inTangent_k+1 * (t_k+1 - t_k)\n\n\t\t\tresult[ i ] = s0 * p0 + s1 * m0 + s2 * p1 + s3 * m1;\n\n\t\t}\n\n\t\treturn result;\n\n\t}\n\n}\n\nconst _q = new Quaternion();\n\nclass GLTFCubicSplineQuaternionInterpolant extends GLTFCubicSplineInterpolant {\n\n\tinterpolate_( i1, t0, t, t1 ) {\n\n\t\tconst result = super.interpolate_( i1, t0, t, t1 );\n\n\t\t_q.fromArray( result ).normalize().toArray( result );\n\n\t\treturn result;\n\n\t}\n\n}\n\n\n/*********************************/\n/********** INTERNALS ************/\n/*********************************/\n\n/* CONSTANTS */\n\nconst WEBGL_CONSTANTS = {\n\tFLOAT: 5126,\n\t//FLOAT_MAT2: 35674,\n\tFLOAT_MAT3: 35675,\n\tFLOAT_MAT4: 35676,\n\tFLOAT_VEC2: 35664,\n\tFLOAT_VEC3: 35665,\n\tFLOAT_VEC4: 35666,\n\tLINEAR: 9729,\n\tREPEAT: 10497,\n\tSAMPLER_2D: 35678,\n\tPOINTS: 0,\n\tLINES: 1,\n\tLINE_LOOP: 2,\n\tLINE_STRIP: 3,\n\tTRIANGLES: 4,\n\tTRIANGLE_STRIP: 5,\n\tTRIANGLE_FAN: 6,\n\tUNSIGNED_BYTE: 5121,\n\tUNSIGNED_SHORT: 5123\n};\n\nconst WEBGL_COMPONENT_TYPES = {\n\t5120: Int8Array,\n\t5121: Uint8Array,\n\t5122: Int16Array,\n\t5123: Uint16Array,\n\t5125: Uint32Array,\n\t5126: Float32Array\n};\n\nconst WEBGL_FILTERS = {\n\t9728: NearestFilter,\n\t9729: LinearFilter,\n\t9984: NearestMipmapNearestFilter,\n\t9985: LinearMipmapNearestFilter,\n\t9986: NearestMipmapLinearFilter,\n\t9987: LinearMipmapLinearFilter\n};\n\nconst WEBGL_WRAPPINGS = {\n\t33071: ClampToEdgeWrapping,\n\t33648: MirroredRepeatWrapping,\n\t10497: RepeatWrapping\n};\n\nconst WEBGL_TYPE_SIZES = {\n\t'SCALAR': 1,\n\t'VEC2': 2,\n\t'VEC3': 3,\n\t'VEC4': 4,\n\t'MAT2': 4,\n\t'MAT3': 9,\n\t'MAT4': 16\n};\n\nconst ATTRIBUTES = {\n\tPOSITION: 'position',\n\tNORMAL: 'normal',\n\tTANGENT: 'tangent',\n\tTEXCOORD_0: 'uv',\n\tTEXCOORD_1: 'uv1',\n\tTEXCOORD_2: 'uv2',\n\tTEXCOORD_3: 'uv3',\n\tCOLOR_0: 'color',\n\tWEIGHTS_0: 'skinWeight',\n\tJOINTS_0: 'skinIndex',\n};\n\nconst PATH_PROPERTIES = {\n\tscale: 'scale',\n\ttranslation: 'position',\n\trotation: 'quaternion',\n\tweights: 'morphTargetInfluences'\n};\n\nconst INTERPOLATION = {\n\tCUBICSPLINE: undefined, // We use a custom interpolant (GLTFCubicSplineInterpolation) for CUBICSPLINE tracks. Each\n\t\t                        // keyframe track will be initialized with a default interpolation type, then modified.\n\tLINEAR: InterpolateLinear,\n\tSTEP: InterpolateDiscrete\n};\n\nconst ALPHA_MODES = {\n\tOPAQUE: 'OPAQUE',\n\tMASK: 'MASK',\n\tBLEND: 'BLEND'\n};\n\n/**\n * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#default-material\n *\n * @private\n * @param {Object<string, Material>} cache\n * @return {Material}\n */\nfunction createDefaultMaterial( cache ) {\n\n\tif ( cache[ 'DefaultMaterial' ] === undefined ) {\n\n\t\tcache[ 'DefaultMaterial' ] = new MeshStandardMaterial( {\n\t\t\tcolor: 0xFFFFFF,\n\t\t\temissive: 0x000000,\n\t\t\tmetalness: 1,\n\t\t\troughness: 1,\n\t\t\ttransparent: false,\n\t\t\tdepthTest: true,\n\t\t\tside: FrontSide\n\t\t} );\n\n\t}\n\n\treturn cache[ 'DefaultMaterial' ];\n\n}\n\nfunction addUnknownExtensionsToUserData( knownExtensions, object, objectDef ) {\n\n\t// Add unknown glTF extensions to an object's userData.\n\n\tfor ( const name in objectDef.extensions ) {\n\n\t\tif ( knownExtensions[ name ] === undefined ) {\n\n\t\t\tobject.userData.gltfExtensions = object.userData.gltfExtensions || {};\n\t\t\tobject.userData.gltfExtensions[ name ] = objectDef.extensions[ name ];\n\n\t\t}\n\n\t}\n\n}\n\n/**\n *\n * @private\n * @param {Object3D|Material|BufferGeometry|Object} object\n * @param {GLTF.definition} gltfDef\n */\nfunction assignExtrasToUserData( object, gltfDef ) {\n\n\tif ( gltfDef.extras !== undefined ) {\n\n\t\tif ( typeof gltfDef.extras === 'object' ) {\n\n\t\t\tObject.assign( object.userData, gltfDef.extras );\n\n\t\t} else {\n\n\t\t\tconsole.warn( 'THREE.GLTFLoader: Ignoring primitive type .extras, ' + gltfDef.extras );\n\n\t\t}\n\n\t}\n\n}\n\n/**\n * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#morph-targets\n *\n * @private\n * @param {BufferGeometry} geometry\n * @param {Array<GLTF.Target>} targets\n * @param {GLTFParser} parser\n * @return {Promise<BufferGeometry>}\n */\nfunction addMorphTargets( geometry, targets, parser ) {\n\n\tlet hasMorphPosition = false;\n\tlet hasMorphNormal = false;\n\tlet hasMorphColor = false;\n\n\tfor ( let i = 0, il = targets.length; i < il; i ++ ) {\n\n\t\tconst target = targets[ i ];\n\n\t\tif ( target.POSITION !== undefined ) hasMorphPosition = true;\n\t\tif ( target.NORMAL !== undefined ) hasMorphNormal = true;\n\t\tif ( target.COLOR_0 !== undefined ) hasMorphColor = true;\n\n\t\tif ( hasMorphPosition && hasMorphNormal && hasMorphColor ) break;\n\n\t}\n\n\tif ( ! hasMorphPosition && ! hasMorphNormal && ! hasMorphColor ) return Promise.resolve( geometry );\n\n\tconst pendingPositionAccessors = [];\n\tconst pendingNormalAccessors = [];\n\tconst pendingColorAccessors = [];\n\n\tfor ( let i = 0, il = targets.length; i < il; i ++ ) {\n\n\t\tconst target = targets[ i ];\n\n\t\tif ( hasMorphPosition ) {\n\n\t\t\tconst pendingAccessor = target.POSITION !== undefined\n\t\t\t\t? parser.getDependency( 'accessor', target.POSITION )\n\t\t\t\t: geometry.attributes.position;\n\n\t\t\tpendingPositionAccessors.push( pendingAccessor );\n\n\t\t}\n\n\t\tif ( hasMorphNormal ) {\n\n\t\t\tconst pendingAccessor = target.NORMAL !== undefined\n\t\t\t\t? parser.getDependency( 'accessor', target.NORMAL )\n\t\t\t\t: geometry.attributes.normal;\n\n\t\t\tpendingNormalAccessors.push( pendingAccessor );\n\n\t\t}\n\n\t\tif ( hasMorphColor ) {\n\n\t\t\tconst pendingAccessor = target.COLOR_0 !== undefined\n\t\t\t\t? parser.getDependency( 'accessor', target.COLOR_0 )\n\t\t\t\t: geometry.attributes.color;\n\n\t\t\tpendingColorAccessors.push( pendingAccessor );\n\n\t\t}\n\n\t}\n\n\treturn Promise.all( [\n\t\tPromise.all( pendingPositionAccessors ),\n\t\tPromise.all( pendingNormalAccessors ),\n\t\tPromise.all( pendingColorAccessors )\n\t] ).then( function ( accessors ) {\n\n\t\tconst morphPositions = accessors[ 0 ];\n\t\tconst morphNormals = accessors[ 1 ];\n\t\tconst morphColors = accessors[ 2 ];\n\n\t\tif ( hasMorphPosition ) geometry.morphAttributes.position = morphPositions;\n\t\tif ( hasMorphNormal ) geometry.morphAttributes.normal = morphNormals;\n\t\tif ( hasMorphColor ) geometry.morphAttributes.color = morphColors;\n\t\tgeometry.morphTargetsRelative = true;\n\n\t\treturn geometry;\n\n\t} );\n\n}\n\n/**\n *\n * @private\n * @param {Mesh} mesh\n * @param {GLTF.Mesh} meshDef\n */\nfunction updateMorphTargets( mesh, meshDef ) {\n\n\tmesh.updateMorphTargets();\n\n\tif ( meshDef.weights !== undefined ) {\n\n\t\tfor ( let i = 0, il = meshDef.weights.length; i < il; i ++ ) {\n\n\t\t\tmesh.morphTargetInfluences[ i ] = meshDef.weights[ i ];\n\n\t\t}\n\n\t}\n\n\t// .extras has user-defined data, so check that .extras.targetNames is an array.\n\tif ( meshDef.extras && Array.isArray( meshDef.extras.targetNames ) ) {\n\n\t\tconst targetNames = meshDef.extras.targetNames;\n\n\t\tif ( mesh.morphTargetInfluences.length === targetNames.length ) {\n\n\t\t\tmesh.morphTargetDictionary = {};\n\n\t\t\tfor ( let i = 0, il = targetNames.length; i < il; i ++ ) {\n\n\t\t\t\tmesh.morphTargetDictionary[ targetNames[ i ] ] = i;\n\n\t\t\t}\n\n\t\t} else {\n\n\t\t\tconsole.warn( 'THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.' );\n\n\t\t}\n\n\t}\n\n}\n\nfunction createPrimitiveKey( primitiveDef ) {\n\n\tlet geometryKey;\n\n\tconst dracoExtension = primitiveDef.extensions && primitiveDef.extensions[ EXTENSIONS.KHR_DRACO_MESH_COMPRESSION ];\n\n\tif ( dracoExtension ) {\n\n\t\tgeometryKey = 'draco:' + dracoExtension.bufferView\n\t\t\t\t+ ':' + dracoExtension.indices\n\t\t\t\t+ ':' + createAttributesKey( dracoExtension.attributes );\n\n\t} else {\n\n\t\tgeometryKey = primitiveDef.indices + ':' + createAttributesKey( primitiveDef.attributes ) + ':' + primitiveDef.mode;\n\n\t}\n\n\tif ( primitiveDef.targets !== undefined ) {\n\n\t\tfor ( let i = 0, il = primitiveDef.targets.length; i < il; i ++ ) {\n\n\t\t\tgeometryKey += ':' + createAttributesKey( primitiveDef.targets[ i ] );\n\n\t\t}\n\n\t}\n\n\treturn geometryKey;\n\n}\n\nfunction createAttributesKey( attributes ) {\n\n\tlet attributesKey = '';\n\n\tconst keys = Object.keys( attributes ).sort();\n\n\tfor ( let i = 0, il = keys.length; i < il; i ++ ) {\n\n\t\tattributesKey += keys[ i ] + ':' + attributes[ keys[ i ] ] + ';';\n\n\t}\n\n\treturn attributesKey;\n\n}\n\nfunction getNormalizedComponentScale( constructor ) {\n\n\t// Reference:\n\t// https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_mesh_quantization#encoding-quantized-data\n\n\tswitch ( constructor ) {\n\n\t\tcase Int8Array:\n\t\t\treturn 1 / 127;\n\n\t\tcase Uint8Array:\n\t\t\treturn 1 / 255;\n\n\t\tcase Int16Array:\n\t\t\treturn 1 / 32767;\n\n\t\tcase Uint16Array:\n\t\t\treturn 1 / 65535;\n\n\t\tdefault:\n\t\t\tthrow new Error( 'THREE.GLTFLoader: Unsupported normalized accessor component type.' );\n\n\t}\n\n}\n\nfunction getImageURIMimeType( uri ) {\n\n\tif ( uri.search( /\\.jpe?g($|\\?)/i ) > 0 || uri.search( /^data\\:image\\/jpeg/ ) === 0 ) return 'image/jpeg';\n\tif ( uri.search( /\\.webp($|\\?)/i ) > 0 || uri.search( /^data\\:image\\/webp/ ) === 0 ) return 'image/webp';\n\tif ( uri.search( /\\.ktx2($|\\?)/i ) > 0 || uri.search( /^data\\:image\\/ktx2/ ) === 0 ) return 'image/ktx2';\n\n\treturn 'image/png';\n\n}\n\nconst _identityMatrix = new Matrix4();\n\n/* GLTF PARSER */\n\nclass GLTFParser {\n\n\tconstructor( json = {}, options = {} ) {\n\n\t\tthis.json = json;\n\t\tthis.extensions = {};\n\t\tthis.plugins = {};\n\t\tthis.options = options;\n\n\t\t// loader object cache\n\t\tthis.cache = new GLTFRegistry();\n\n\t\t// associations between Three.js objects and glTF elements\n\t\tthis.associations = new Map();\n\n\t\t// BufferGeometry caching\n\t\tthis.primitiveCache = {};\n\n\t\t// Node cache\n\t\tthis.nodeCache = {};\n\n\t\t// Object3D instance caches\n\t\tthis.meshCache = { refs: {}, uses: {} };\n\t\tthis.cameraCache = { refs: {}, uses: {} };\n\t\tthis.lightCache = { refs: {}, uses: {} };\n\n\t\tthis.sourceCache = {};\n\t\tthis.textureCache = {};\n\n\t\t// Track node names, to ensure no duplicates\n\t\tthis.nodeNamesUsed = {};\n\n\t\t// Use an ImageBitmapLoader if imageBitmaps are supported. Moves much of the\n\t\t// expensive work of uploading a texture to the GPU off the main thread.\n\n\t\tlet isSafari = false;\n\t\tlet safariVersion = - 1;\n\t\tlet isFirefox = false;\n\t\tlet firefoxVersion = - 1;\n\n\t\tif ( typeof navigator !== 'undefined' ) {\n\n\t\t\tconst userAgent = navigator.userAgent;\n\n\t\t\tisSafari = /^((?!chrome|android).)*safari/i.test( userAgent ) === true;\n\t\t\tconst safariMatch = userAgent.match( /Version\\/(\\d+)/ );\n\t\t\tsafariVersion = isSafari && safariMatch ? parseInt( safariMatch[ 1 ], 10 ) : - 1;\n\n\t\t\tisFirefox = userAgent.indexOf( 'Firefox' ) > - 1;\n\t\t\tfirefoxVersion = isFirefox ? userAgent.match( /Firefox\\/([0-9]+)\\./ )[ 1 ] : - 1;\n\n\t\t}\n\n\t\tif ( typeof createImageBitmap === 'undefined' || ( isSafari && safariVersion < 17 ) || ( isFirefox && firefoxVersion < 98 ) ) {\n\n\t\t\tthis.textureLoader = new TextureLoader( this.options.manager );\n\n\t\t} else {\n\n\t\t\tthis.textureLoader = new ImageBitmapLoader( this.options.manager );\n\n\t\t}\n\n\t\tthis.textureLoader.setCrossOrigin( this.options.crossOrigin );\n\t\tthis.textureLoader.setRequestHeader( this.options.requestHeader );\n\n\t\tthis.fileLoader = new FileLoader( this.options.manager );\n\t\tthis.fileLoader.setResponseType( 'arraybuffer' );\n\n\t\tif ( this.options.crossOrigin === 'use-credentials' ) {\n\n\t\t\tthis.fileLoader.setWithCredentials( true );\n\n\t\t}\n\n\t}\n\n\tsetExtensions( extensions ) {\n\n\t\tthis.extensions = extensions;\n\n\t}\n\n\tsetPlugins( plugins ) {\n\n\t\tthis.plugins = plugins;\n\n\t}\n\n\tparse( onLoad, onError ) {\n\n\t\tconst parser = this;\n\t\tconst json = this.json;\n\t\tconst extensions = this.extensions;\n\n\t\t// Clear the loader cache\n\t\tthis.cache.removeAll();\n\t\tthis.nodeCache = {};\n\n\t\t// Mark the special nodes/meshes in json for efficient parse\n\t\tthis._invokeAll( function ( ext ) {\n\n\t\t\treturn ext._markDefs && ext._markDefs();\n\n\t\t} );\n\n\t\tPromise.all( this._invokeAll( function ( ext ) {\n\n\t\t\treturn ext.beforeRoot && ext.beforeRoot();\n\n\t\t} ) ).then( function () {\n\n\t\t\treturn Promise.all( [\n\n\t\t\t\tparser.getDependencies( 'scene' ),\n\t\t\t\tparser.getDependencies( 'animation' ),\n\t\t\t\tparser.getDependencies( 'camera' ),\n\n\t\t\t] );\n\n\t\t} ).then( function ( dependencies ) {\n\n\t\t\tconst result = {\n\t\t\t\tscene: dependencies[ 0 ][ json.scene || 0 ],\n\t\t\t\tscenes: dependencies[ 0 ],\n\t\t\t\tanimations: dependencies[ 1 ],\n\t\t\t\tcameras: dependencies[ 2 ],\n\t\t\t\tasset: json.asset,\n\t\t\t\tparser: parser,\n\t\t\t\tuserData: {}\n\t\t\t};\n\n\t\t\taddUnknownExtensionsToUserData( extensions, result, json );\n\n\t\t\tassignExtrasToUserData( result, json );\n\n\t\t\treturn Promise.all( parser._invokeAll( function ( ext ) {\n\n\t\t\t\treturn ext.afterRoot && ext.afterRoot( result );\n\n\t\t\t} ) ).then( function () {\n\n\t\t\t\tfor ( const scene of result.scenes ) {\n\n\t\t\t\t\tscene.updateMatrixWorld();\n\n\t\t\t\t}\n\n\t\t\t\tonLoad( result );\n\n\t\t\t} );\n\n\t\t} ).catch( onError );\n\n\t}\n\n\t/**\n\t * Marks the special nodes/meshes in json for efficient parse.\n\t *\n\t * @private\n\t */\n\t_markDefs() {\n\n\t\tconst nodeDefs = this.json.nodes || [];\n\t\tconst skinDefs = this.json.skins || [];\n\t\tconst meshDefs = this.json.meshes || [];\n\n\t\t// Nothing in the node definition indicates whether it is a Bone or an\n\t\t// Object3D. Use the skins' joint references to mark bones.\n\t\tfor ( let skinIndex = 0, skinLength = skinDefs.length; skinIndex < skinLength; skinIndex ++ ) {\n\n\t\t\tconst joints = skinDefs[ skinIndex ].joints;\n\n\t\t\tfor ( let i = 0, il = joints.length; i < il; i ++ ) {\n\n\t\t\t\tnodeDefs[ joints[ i ] ].isBone = true;\n\n\t\t\t}\n\n\t\t}\n\n\t\t// Iterate over all nodes, marking references to shared resources,\n\t\t// as well as skeleton joints.\n\t\tfor ( let nodeIndex = 0, nodeLength = nodeDefs.length; nodeIndex < nodeLength; nodeIndex ++ ) {\n\n\t\t\tconst nodeDef = nodeDefs[ nodeIndex ];\n\n\t\t\tif ( nodeDef.mesh !== undefined ) {\n\n\t\t\t\tthis._addNodeRef( this.meshCache, nodeDef.mesh );\n\n\t\t\t\t// Nothing in the mesh definition indicates whether it is\n\t\t\t\t// a SkinnedMesh or Mesh. Use the node's mesh reference\n\t\t\t\t// to mark SkinnedMesh if node has skin.\n\t\t\t\tif ( nodeDef.skin !== undefined ) {\n\n\t\t\t\t\tmeshDefs[ nodeDef.mesh ].isSkinnedMesh = true;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tif ( nodeDef.camera !== undefined ) {\n\n\t\t\t\tthis._addNodeRef( this.cameraCache, nodeDef.camera );\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n\t/**\n\t * Counts references to shared node / Object3D resources. These resources\n\t * can be reused, or \"instantiated\", at multiple nodes in the scene\n\t * hierarchy. Mesh, Camera, and Light instances are instantiated and must\n\t * be marked. Non-scenegraph resources (like Materials, Geometries, and\n\t * Textures) can be reused directly and are not marked here.\n\t *\n\t * Example: CesiumMilkTruck sample model reuses \"Wheel\" meshes.\n\t *\n\t * @private\n\t * @param {Object} cache\n\t * @param {Object3D} index\n\t */\n\t_addNodeRef( cache, index ) {\n\n\t\tif ( index === undefined ) return;\n\n\t\tif ( cache.refs[ index ] === undefined ) {\n\n\t\t\tcache.refs[ index ] = cache.uses[ index ] = 0;\n\n\t\t}\n\n\t\tcache.refs[ index ] ++;\n\n\t}\n\n\t/**\n\t * Returns a reference to a shared resource, cloning it if necessary.\n\t *\n\t * @private\n\t * @param {Object} cache\n\t * @param {number} index\n\t * @param {Object} object\n\t * @return {Object}\n\t */\n\t_getNodeRef( cache, index, object ) {\n\n\t\tif ( cache.refs[ index ] <= 1 ) return object;\n\n\t\tconst ref = object.clone();\n\n\t\t// Propagates mappings to the cloned object, prevents mappings on the\n\t\t// original object from being lost.\n\t\tconst updateMappings = ( original, clone ) => {\n\n\t\t\tconst mappings = this.associations.get( original );\n\t\t\tif ( mappings != null ) {\n\n\t\t\t\tthis.associations.set( clone, mappings );\n\n\t\t\t}\n\n\t\t\tfor ( const [ i, child ] of original.children.entries() ) {\n\n\t\t\t\tupdateMappings( child, clone.children[ i ] );\n\n\t\t\t}\n\n\t\t};\n\n\t\tupdateMappings( object, ref );\n\n\t\tref.name += '_instance_' + ( cache.uses[ index ] ++ );\n\n\t\treturn ref;\n\n\t}\n\n\t_invokeOne( func ) {\n\n\t\tconst extensions = Object.values( this.plugins );\n\t\textensions.push( this );\n\n\t\tfor ( let i = 0; i < extensions.length; i ++ ) {\n\n\t\t\tconst result = func( extensions[ i ] );\n\n\t\t\tif ( result ) return result;\n\n\t\t}\n\n\t\treturn null;\n\n\t}\n\n\t_invokeAll( func ) {\n\n\t\tconst extensions = Object.values( this.plugins );\n\t\textensions.unshift( this );\n\n\t\tconst pending = [];\n\n\t\tfor ( let i = 0; i < extensions.length; i ++ ) {\n\n\t\t\tconst result = func( extensions[ i ] );\n\n\t\t\tif ( result ) pending.push( result );\n\n\t\t}\n\n\t\treturn pending;\n\n\t}\n\n\t/**\n\t * Requests the specified dependency asynchronously, with caching.\n\t *\n\t * @private\n\t * @param {string} type\n\t * @param {number} index\n\t * @return {Promise<Object3D|Material|THREE.Texture|AnimationClip|ArrayBuffer|Object>}\n\t */\n\tgetDependency( type, index ) {\n\n\t\tconst cacheKey = type + ':' + index;\n\t\tlet dependency = this.cache.get( cacheKey );\n\n\t\tif ( ! dependency ) {\n\n\t\t\tswitch ( type ) {\n\n\t\t\t\tcase 'scene':\n\t\t\t\t\tdependency = this.loadScene( index );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'node':\n\t\t\t\t\tdependency = this._invokeOne( function ( ext ) {\n\n\t\t\t\t\t\treturn ext.loadNode && ext.loadNode( index );\n\n\t\t\t\t\t} );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'mesh':\n\t\t\t\t\tdependency = this._invokeOne( function ( ext ) {\n\n\t\t\t\t\t\treturn ext.loadMesh && ext.loadMesh( index );\n\n\t\t\t\t\t} );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'accessor':\n\t\t\t\t\tdependency = this.loadAccessor( index );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'bufferView':\n\t\t\t\t\tdependency = this._invokeOne( function ( ext ) {\n\n\t\t\t\t\t\treturn ext.loadBufferView && ext.loadBufferView( index );\n\n\t\t\t\t\t} );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'buffer':\n\t\t\t\t\tdependency = this.loadBuffer( index );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'material':\n\t\t\t\t\tdependency = this._invokeOne( function ( ext ) {\n\n\t\t\t\t\t\treturn ext.loadMaterial && ext.loadMaterial( index );\n\n\t\t\t\t\t} );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'texture':\n\t\t\t\t\tdependency = this._invokeOne( function ( ext ) {\n\n\t\t\t\t\t\treturn ext.loadTexture && ext.loadTexture( index );\n\n\t\t\t\t\t} );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'skin':\n\t\t\t\t\tdependency = this.loadSkin( index );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'animation':\n\t\t\t\t\tdependency = this._invokeOne( function ( ext ) {\n\n\t\t\t\t\t\treturn ext.loadAnimation && ext.loadAnimation( index );\n\n\t\t\t\t\t} );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'camera':\n\t\t\t\t\tdependency = this.loadCamera( index );\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\tdependency = this._invokeOne( function ( ext ) {\n\n\t\t\t\t\t\treturn ext != this && ext.getDependency && ext.getDependency( type, index );\n\n\t\t\t\t\t} );\n\n\t\t\t\t\tif ( ! dependency ) {\n\n\t\t\t\t\t\tthrow new Error( 'Unknown type: ' + type );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t\tthis.cache.add( cacheKey, dependency );\n\n\t\t}\n\n\t\treturn dependency;\n\n\t}\n\n\t/**\n\t * Requests all dependencies of the specified type asynchronously, with caching.\n\t *\n\t * @private\n\t * @param {string} type\n\t * @return {Promise<Array<Object>>}\n\t */\n\tgetDependencies( type ) {\n\n\t\tlet dependencies = this.cache.get( type );\n\n\t\tif ( ! dependencies ) {\n\n\t\t\tconst parser = this;\n\t\t\tconst defs = this.json[ type + ( type === 'mesh' ? 'es' : 's' ) ] || [];\n\n\t\t\tdependencies = Promise.all( defs.map( function ( def, index ) {\n\n\t\t\t\treturn parser.getDependency( type, index );\n\n\t\t\t} ) );\n\n\t\t\tthis.cache.add( type, dependencies );\n\n\t\t}\n\n\t\treturn dependencies;\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#buffers-and-buffer-views\n\t *\n\t * @private\n\t * @param {number} bufferIndex\n\t * @return {Promise<ArrayBuffer>}\n\t */\n\tloadBuffer( bufferIndex ) {\n\n\t\tconst bufferDef = this.json.buffers[ bufferIndex ];\n\t\tconst loader = this.fileLoader;\n\n\t\tif ( bufferDef.type && bufferDef.type !== 'arraybuffer' ) {\n\n\t\t\tthrow new Error( 'THREE.GLTFLoader: ' + bufferDef.type + ' buffer type is not supported.' );\n\n\t\t}\n\n\t\t// If present, GLB container is required to be the first buffer.\n\t\tif ( bufferDef.uri === undefined && bufferIndex === 0 ) {\n\n\t\t\treturn Promise.resolve( this.extensions[ EXTENSIONS.KHR_BINARY_GLTF ].body );\n\n\t\t}\n\n\t\tconst options = this.options;\n\n\t\treturn new Promise( function ( resolve, reject ) {\n\n\t\t\tloader.load( LoaderUtils.resolveURL( bufferDef.uri, options.path ), resolve, undefined, function () {\n\n\t\t\t\treject( new Error( 'THREE.GLTFLoader: Failed to load buffer \"' + bufferDef.uri + '\".' ) );\n\n\t\t\t} );\n\n\t\t} );\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#buffers-and-buffer-views\n\t *\n\t * @private\n\t * @param {number} bufferViewIndex\n\t * @return {Promise<ArrayBuffer>}\n\t */\n\tloadBufferView( bufferViewIndex ) {\n\n\t\tconst bufferViewDef = this.json.bufferViews[ bufferViewIndex ];\n\n\t\treturn this.getDependency( 'buffer', bufferViewDef.buffer ).then( function ( buffer ) {\n\n\t\t\tconst byteLength = bufferViewDef.byteLength || 0;\n\t\t\tconst byteOffset = bufferViewDef.byteOffset || 0;\n\t\t\treturn buffer.slice( byteOffset, byteOffset + byteLength );\n\n\t\t} );\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#accessors\n\t *\n\t * @private\n\t * @param {number} accessorIndex\n\t * @return {Promise<BufferAttribute|InterleavedBufferAttribute>}\n\t */\n\tloadAccessor( accessorIndex ) {\n\n\t\tconst parser = this;\n\t\tconst json = this.json;\n\n\t\tconst accessorDef = this.json.accessors[ accessorIndex ];\n\n\t\tif ( accessorDef.bufferView === undefined && accessorDef.sparse === undefined ) {\n\n\t\t\tconst itemSize = WEBGL_TYPE_SIZES[ accessorDef.type ];\n\t\t\tconst TypedArray = WEBGL_COMPONENT_TYPES[ accessorDef.componentType ];\n\t\t\tconst normalized = accessorDef.normalized === true;\n\n\t\t\tconst array = new TypedArray( accessorDef.count * itemSize );\n\t\t\treturn Promise.resolve( new BufferAttribute( array, itemSize, normalized ) );\n\n\t\t}\n\n\t\tconst pendingBufferViews = [];\n\n\t\tif ( accessorDef.bufferView !== undefined ) {\n\n\t\t\tpendingBufferViews.push( this.getDependency( 'bufferView', accessorDef.bufferView ) );\n\n\t\t} else {\n\n\t\t\tpendingBufferViews.push( null );\n\n\t\t}\n\n\t\tif ( accessorDef.sparse !== undefined ) {\n\n\t\t\tpendingBufferViews.push( this.getDependency( 'bufferView', accessorDef.sparse.indices.bufferView ) );\n\t\t\tpendingBufferViews.push( this.getDependency( 'bufferView', accessorDef.sparse.values.bufferView ) );\n\n\t\t}\n\n\t\treturn Promise.all( pendingBufferViews ).then( function ( bufferViews ) {\n\n\t\t\tconst bufferView = bufferViews[ 0 ];\n\n\t\t\tconst itemSize = WEBGL_TYPE_SIZES[ accessorDef.type ];\n\t\t\tconst TypedArray = WEBGL_COMPONENT_TYPES[ accessorDef.componentType ];\n\n\t\t\t// For VEC3: itemSize is 3, elementBytes is 4, itemBytes is 12.\n\t\t\tconst elementBytes = TypedArray.BYTES_PER_ELEMENT;\n\t\t\tconst itemBytes = elementBytes * itemSize;\n\t\t\tconst byteOffset = accessorDef.byteOffset || 0;\n\t\t\tconst byteStride = accessorDef.bufferView !== undefined ? json.bufferViews[ accessorDef.bufferView ].byteStride : undefined;\n\t\t\tconst normalized = accessorDef.normalized === true;\n\t\t\tlet array, bufferAttribute;\n\n\t\t\t// The buffer is not interleaved if the stride is the item size in bytes.\n\t\t\tif ( byteStride && byteStride !== itemBytes ) {\n\n\t\t\t\t// Each \"slice\" of the buffer, as defined by 'count' elements of 'byteStride' bytes, gets its own InterleavedBuffer\n\t\t\t\t// This makes sure that IBA.count reflects accessor.count properly\n\t\t\t\tconst ibSlice = Math.floor( byteOffset / byteStride );\n\t\t\t\tconst ibCacheKey = 'InterleavedBuffer:' + accessorDef.bufferView + ':' + accessorDef.componentType + ':' + ibSlice + ':' + accessorDef.count;\n\t\t\t\tlet ib = parser.cache.get( ibCacheKey );\n\n\t\t\t\tif ( ! ib ) {\n\n\t\t\t\t\tarray = new TypedArray( bufferView, ibSlice * byteStride, accessorDef.count * byteStride / elementBytes );\n\n\t\t\t\t\t// Integer parameters to IB/IBA are in array elements, not bytes.\n\t\t\t\t\tib = new InterleavedBuffer( array, byteStride / elementBytes );\n\n\t\t\t\t\tparser.cache.add( ibCacheKey, ib );\n\n\t\t\t\t}\n\n\t\t\t\tbufferAttribute = new InterleavedBufferAttribute( ib, itemSize, ( byteOffset % byteStride ) / elementBytes, normalized );\n\n\t\t\t} else {\n\n\t\t\t\tif ( bufferView === null ) {\n\n\t\t\t\t\tarray = new TypedArray( accessorDef.count * itemSize );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tarray = new TypedArray( bufferView, byteOffset, accessorDef.count * itemSize );\n\n\t\t\t\t}\n\n\t\t\t\tbufferAttribute = new BufferAttribute( array, itemSize, normalized );\n\n\t\t\t}\n\n\t\t\t// https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#sparse-accessors\n\t\t\tif ( accessorDef.sparse !== undefined ) {\n\n\t\t\t\tconst itemSizeIndices = WEBGL_TYPE_SIZES.SCALAR;\n\t\t\t\tconst TypedArrayIndices = WEBGL_COMPONENT_TYPES[ accessorDef.sparse.indices.componentType ];\n\n\t\t\t\tconst byteOffsetIndices = accessorDef.sparse.indices.byteOffset || 0;\n\t\t\t\tconst byteOffsetValues = accessorDef.sparse.values.byteOffset || 0;\n\n\t\t\t\tconst sparseIndices = new TypedArrayIndices( bufferViews[ 1 ], byteOffsetIndices, accessorDef.sparse.count * itemSizeIndices );\n\t\t\t\tconst sparseValues = new TypedArray( bufferViews[ 2 ], byteOffsetValues, accessorDef.sparse.count * itemSize );\n\n\t\t\t\tif ( bufferView !== null ) {\n\n\t\t\t\t\t// Avoid modifying the original ArrayBuffer, if the bufferView wasn't initialized with zeroes.\n\t\t\t\t\tbufferAttribute = new BufferAttribute( bufferAttribute.array.slice(), bufferAttribute.itemSize, bufferAttribute.normalized );\n\n\t\t\t\t}\n\n\t\t\t\t// Ignore normalized since we copy from sparse\n\t\t\t\tbufferAttribute.normalized = false;\n\n\t\t\t\tfor ( let i = 0, il = sparseIndices.length; i < il; i ++ ) {\n\n\t\t\t\t\tconst index = sparseIndices[ i ];\n\n\t\t\t\t\tbufferAttribute.setX( index, sparseValues[ i * itemSize ] );\n\t\t\t\t\tif ( itemSize >= 2 ) bufferAttribute.setY( index, sparseValues[ i * itemSize + 1 ] );\n\t\t\t\t\tif ( itemSize >= 3 ) bufferAttribute.setZ( index, sparseValues[ i * itemSize + 2 ] );\n\t\t\t\t\tif ( itemSize >= 4 ) bufferAttribute.setW( index, sparseValues[ i * itemSize + 3 ] );\n\t\t\t\t\tif ( itemSize >= 5 ) throw new Error( 'THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.' );\n\n\t\t\t\t}\n\n\t\t\t\tbufferAttribute.normalized = normalized;\n\n\t\t\t}\n\n\t\t\treturn bufferAttribute;\n\n\t\t} );\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#textures\n\t *\n\t * @private\n\t * @param {number} textureIndex\n\t * @return {Promise<THREE.Texture|null>}\n\t */\n\tloadTexture( textureIndex ) {\n\n\t\tconst json = this.json;\n\t\tconst options = this.options;\n\t\tconst textureDef = json.textures[ textureIndex ];\n\t\tconst sourceIndex = textureDef.source;\n\t\tconst sourceDef = json.images[ sourceIndex ];\n\n\t\tlet loader = this.textureLoader;\n\n\t\tif ( sourceDef.uri ) {\n\n\t\t\tconst handler = options.manager.getHandler( sourceDef.uri );\n\t\t\tif ( handler !== null ) loader = handler;\n\n\t\t}\n\n\t\treturn this.loadTextureImage( textureIndex, sourceIndex, loader );\n\n\t}\n\n\tloadTextureImage( textureIndex, sourceIndex, loader ) {\n\n\t\tconst parser = this;\n\t\tconst json = this.json;\n\n\t\tconst textureDef = json.textures[ textureIndex ];\n\t\tconst sourceDef = json.images[ sourceIndex ];\n\n\t\tconst cacheKey = ( sourceDef.uri || sourceDef.bufferView ) + ':' + textureDef.sampler;\n\n\t\tif ( this.textureCache[ cacheKey ] ) {\n\n\t\t\t// See https://github.com/mrdoob/three.js/issues/21559.\n\t\t\treturn this.textureCache[ cacheKey ];\n\n\t\t}\n\n\t\tconst promise = this.loadImageSource( sourceIndex, loader ).then( function ( texture ) {\n\n\t\t\ttexture.flipY = false;\n\n\t\t\ttexture.name = textureDef.name || sourceDef.name || '';\n\n\t\t\tif ( texture.name === '' && typeof sourceDef.uri === 'string' && sourceDef.uri.startsWith( 'data:image/' ) === false ) {\n\n\t\t\t\ttexture.name = sourceDef.uri;\n\n\t\t\t}\n\n\t\t\tconst samplers = json.samplers || {};\n\t\t\tconst sampler = samplers[ textureDef.sampler ] || {};\n\n\t\t\ttexture.magFilter = WEBGL_FILTERS[ sampler.magFilter ] || LinearFilter;\n\t\t\ttexture.minFilter = WEBGL_FILTERS[ sampler.minFilter ] || LinearMipmapLinearFilter;\n\t\t\ttexture.wrapS = WEBGL_WRAPPINGS[ sampler.wrapS ] || RepeatWrapping;\n\t\t\ttexture.wrapT = WEBGL_WRAPPINGS[ sampler.wrapT ] || RepeatWrapping;\n\t\t\ttexture.generateMipmaps = ! texture.isCompressedTexture && texture.minFilter !== NearestFilter && texture.minFilter !== LinearFilter;\n\n\t\t\tparser.associations.set( texture, { textures: textureIndex } );\n\n\t\t\treturn texture;\n\n\t\t} ).catch( function () {\n\n\t\t\treturn null;\n\n\t\t} );\n\n\t\tthis.textureCache[ cacheKey ] = promise;\n\n\t\treturn promise;\n\n\t}\n\n\tloadImageSource( sourceIndex, loader ) {\n\n\t\tconst parser = this;\n\t\tconst json = this.json;\n\t\tconst options = this.options;\n\n\t\tif ( this.sourceCache[ sourceIndex ] !== undefined ) {\n\n\t\t\treturn this.sourceCache[ sourceIndex ].then( ( texture ) => texture.clone() );\n\n\t\t}\n\n\t\tconst sourceDef = json.images[ sourceIndex ];\n\n\t\tconst URL = self.URL || self.webkitURL;\n\n\t\tlet sourceURI = sourceDef.uri || '';\n\t\tlet isObjectURL = false;\n\n\t\tif ( sourceDef.bufferView !== undefined ) {\n\n\t\t\t// Load binary image data from bufferView, if provided.\n\n\t\t\tsourceURI = parser.getDependency( 'bufferView', sourceDef.bufferView ).then( function ( bufferView ) {\n\n\t\t\t\tisObjectURL = true;\n\t\t\t\tconst blob = new Blob( [ bufferView ], { type: sourceDef.mimeType } );\n\t\t\t\tsourceURI = URL.createObjectURL( blob );\n\t\t\t\treturn sourceURI;\n\n\t\t\t} );\n\n\t\t} else if ( sourceDef.uri === undefined ) {\n\n\t\t\tthrow new Error( 'THREE.GLTFLoader: Image ' + sourceIndex + ' is missing URI and bufferView' );\n\n\t\t}\n\n\t\tconst promise = Promise.resolve( sourceURI ).then( function ( sourceURI ) {\n\n\t\t\treturn new Promise( function ( resolve, reject ) {\n\n\t\t\t\tlet onLoad = resolve;\n\n\t\t\t\tif ( loader.isImageBitmapLoader === true ) {\n\n\t\t\t\t\tonLoad = function ( imageBitmap ) {\n\n\t\t\t\t\t\tconst texture = new Texture( imageBitmap );\n\t\t\t\t\t\ttexture.needsUpdate = true;\n\n\t\t\t\t\t\tresolve( texture );\n\n\t\t\t\t\t};\n\n\t\t\t\t}\n\n\t\t\t\tloader.load( LoaderUtils.resolveURL( sourceURI, options.path ), onLoad, undefined, reject );\n\n\t\t\t} );\n\n\t\t} ).then( function ( texture ) {\n\n\t\t\t// Clean up resources and configure Texture.\n\n\t\t\tif ( isObjectURL === true ) {\n\n\t\t\t\tURL.revokeObjectURL( sourceURI );\n\n\t\t\t}\n\n\t\t\tassignExtrasToUserData( texture, sourceDef );\n\n\t\t\ttexture.userData.mimeType = sourceDef.mimeType || getImageURIMimeType( sourceDef.uri );\n\n\t\t\treturn texture;\n\n\t\t} ).catch( function ( error ) {\n\n\t\t\tconsole.error( 'THREE.GLTFLoader: Couldn\\'t load texture', sourceURI );\n\t\t\tthrow error;\n\n\t\t} );\n\n\t\tthis.sourceCache[ sourceIndex ] = promise;\n\t\treturn promise;\n\n\t}\n\n\t/**\n\t * Asynchronously assigns a texture to the given material parameters.\n\t *\n\t * @private\n\t * @param {Object} materialParams\n\t * @param {string} mapName\n\t * @param {Object} mapDef\n\t * @param {string} [colorSpace]\n\t * @return {Promise<Texture>}\n\t */\n\tassignTexture( materialParams, mapName, mapDef, colorSpace ) {\n\n\t\tconst parser = this;\n\n\t\treturn this.getDependency( 'texture', mapDef.index ).then( function ( texture ) {\n\n\t\t\tif ( ! texture ) return null;\n\n\t\t\tif ( mapDef.texCoord !== undefined && mapDef.texCoord > 0 ) {\n\n\t\t\t\ttexture = texture.clone();\n\t\t\t\ttexture.channel = mapDef.texCoord;\n\n\t\t\t}\n\n\t\t\tif ( parser.extensions[ EXTENSIONS.KHR_TEXTURE_TRANSFORM ] ) {\n\n\t\t\t\tconst transform = mapDef.extensions !== undefined ? mapDef.extensions[ EXTENSIONS.KHR_TEXTURE_TRANSFORM ] : undefined;\n\n\t\t\t\tif ( transform ) {\n\n\t\t\t\t\tconst gltfReference = parser.associations.get( texture );\n\t\t\t\t\ttexture = parser.extensions[ EXTENSIONS.KHR_TEXTURE_TRANSFORM ].extendTexture( texture, transform );\n\t\t\t\t\tparser.associations.set( texture, gltfReference );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tif ( colorSpace !== undefined ) {\n\n\t\t\t\ttexture.colorSpace = colorSpace;\n\n\t\t\t}\n\n\t\t\tmaterialParams[ mapName ] = texture;\n\n\t\t\treturn texture;\n\n\t\t} );\n\n\t}\n\n\t/**\n\t * Assigns final material to a Mesh, Line, or Points instance. The instance\n\t * already has a material (generated from the glTF material options alone)\n\t * but reuse of the same glTF material may require multiple threejs materials\n\t * to accommodate different primitive types, defines, etc. New materials will\n\t * be created if necessary, and reused from a cache.\n\t *\n\t * @private\n\t * @param {Object3D} mesh Mesh, Line, or Points instance.\n\t */\n\tassignFinalMaterial( mesh ) {\n\n\t\tconst geometry = mesh.geometry;\n\t\tlet material = mesh.material;\n\n\t\tconst useDerivativeTangents = geometry.attributes.tangent === undefined;\n\t\tconst useVertexColors = geometry.attributes.color !== undefined;\n\t\tconst useFlatShading = geometry.attributes.normal === undefined;\n\n\t\tif ( mesh.isPoints ) {\n\n\t\t\tconst cacheKey = 'PointsMaterial:' + material.uuid;\n\n\t\t\tlet pointsMaterial = this.cache.get( cacheKey );\n\n\t\t\tif ( ! pointsMaterial ) {\n\n\t\t\t\tpointsMaterial = new PointsMaterial();\n\t\t\t\tMaterial.prototype.copy.call( pointsMaterial, material );\n\t\t\t\tpointsMaterial.color.copy( material.color );\n\t\t\t\tpointsMaterial.map = material.map;\n\t\t\t\tpointsMaterial.sizeAttenuation = false; // glTF spec says points should be 1px\n\n\t\t\t\tthis.cache.add( cacheKey, pointsMaterial );\n\n\t\t\t}\n\n\t\t\tmaterial = pointsMaterial;\n\n\t\t} else if ( mesh.isLine ) {\n\n\t\t\tconst cacheKey = 'LineBasicMaterial:' + material.uuid;\n\n\t\t\tlet lineMaterial = this.cache.get( cacheKey );\n\n\t\t\tif ( ! lineMaterial ) {\n\n\t\t\t\tlineMaterial = new LineBasicMaterial();\n\t\t\t\tMaterial.prototype.copy.call( lineMaterial, material );\n\t\t\t\tlineMaterial.color.copy( material.color );\n\t\t\t\tlineMaterial.map = material.map;\n\n\t\t\t\tthis.cache.add( cacheKey, lineMaterial );\n\n\t\t\t}\n\n\t\t\tmaterial = lineMaterial;\n\n\t\t}\n\n\t\t// Clone the material if it will be modified\n\t\tif ( useDerivativeTangents || useVertexColors || useFlatShading ) {\n\n\t\t\tlet cacheKey = 'ClonedMaterial:' + material.uuid + ':';\n\n\t\t\tif ( useDerivativeTangents ) cacheKey += 'derivative-tangents:';\n\t\t\tif ( useVertexColors ) cacheKey += 'vertex-colors:';\n\t\t\tif ( useFlatShading ) cacheKey += 'flat-shading:';\n\n\t\t\tlet cachedMaterial = this.cache.get( cacheKey );\n\n\t\t\tif ( ! cachedMaterial ) {\n\n\t\t\t\tcachedMaterial = material.clone();\n\n\t\t\t\tif ( useVertexColors ) cachedMaterial.vertexColors = true;\n\t\t\t\tif ( useFlatShading ) cachedMaterial.flatShading = true;\n\n\t\t\t\tif ( useDerivativeTangents ) {\n\n\t\t\t\t\t// https://github.com/mrdoob/three.js/issues/11438#issuecomment-507003995\n\t\t\t\t\tif ( cachedMaterial.normalScale ) cachedMaterial.normalScale.y *= - 1;\n\t\t\t\t\tif ( cachedMaterial.clearcoatNormalScale ) cachedMaterial.clearcoatNormalScale.y *= - 1;\n\n\t\t\t\t}\n\n\t\t\t\tthis.cache.add( cacheKey, cachedMaterial );\n\n\t\t\t\tthis.associations.set( cachedMaterial, this.associations.get( material ) );\n\n\t\t\t}\n\n\t\t\tmaterial = cachedMaterial;\n\n\t\t}\n\n\t\tmesh.material = material;\n\n\t}\n\n\tgetMaterialType( /* materialIndex */ ) {\n\n\t\treturn MeshStandardMaterial;\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#materials\n\t *\n\t * @private\n\t * @param {number} materialIndex\n\t * @return {Promise<Material>}\n\t */\n\tloadMaterial( materialIndex ) {\n\n\t\tconst parser = this;\n\t\tconst json = this.json;\n\t\tconst extensions = this.extensions;\n\t\tconst materialDef = json.materials[ materialIndex ];\n\n\t\tlet materialType;\n\t\tconst materialParams = {};\n\t\tconst materialExtensions = materialDef.extensions || {};\n\n\t\tconst pending = [];\n\n\t\tif ( materialExtensions[ EXTENSIONS.KHR_MATERIALS_UNLIT ] ) {\n\n\t\t\tconst kmuExtension = extensions[ EXTENSIONS.KHR_MATERIALS_UNLIT ];\n\t\t\tmaterialType = kmuExtension.getMaterialType();\n\t\t\tpending.push( kmuExtension.extendParams( materialParams, materialDef, parser ) );\n\n\t\t} else {\n\n\t\t\t// Specification:\n\t\t\t// https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#metallic-roughness-material\n\n\t\t\tconst metallicRoughness = materialDef.pbrMetallicRoughness || {};\n\n\t\t\tmaterialParams.color = new Color( 1.0, 1.0, 1.0 );\n\t\t\tmaterialParams.opacity = 1.0;\n\n\t\t\tif ( Array.isArray( metallicRoughness.baseColorFactor ) ) {\n\n\t\t\t\tconst array = metallicRoughness.baseColorFactor;\n\n\t\t\t\tmaterialParams.color.setRGB( array[ 0 ], array[ 1 ], array[ 2 ], LinearSRGBColorSpace );\n\t\t\t\tmaterialParams.opacity = array[ 3 ];\n\n\t\t\t}\n\n\t\t\tif ( metallicRoughness.baseColorTexture !== undefined ) {\n\n\t\t\t\tpending.push( parser.assignTexture( materialParams, 'map', metallicRoughness.baseColorTexture, SRGBColorSpace ) );\n\n\t\t\t}\n\n\t\t\tmaterialParams.metalness = metallicRoughness.metallicFactor !== undefined ? metallicRoughness.metallicFactor : 1.0;\n\t\t\tmaterialParams.roughness = metallicRoughness.roughnessFactor !== undefined ? metallicRoughness.roughnessFactor : 1.0;\n\n\t\t\tif ( metallicRoughness.metallicRoughnessTexture !== undefined ) {\n\n\t\t\t\tpending.push( parser.assignTexture( materialParams, 'metalnessMap', metallicRoughness.metallicRoughnessTexture ) );\n\t\t\t\tpending.push( parser.assignTexture( materialParams, 'roughnessMap', metallicRoughness.metallicRoughnessTexture ) );\n\n\t\t\t}\n\n\t\t\tmaterialType = this._invokeOne( function ( ext ) {\n\n\t\t\t\treturn ext.getMaterialType && ext.getMaterialType( materialIndex );\n\n\t\t\t} );\n\n\t\t\tpending.push( Promise.all( this._invokeAll( function ( ext ) {\n\n\t\t\t\treturn ext.extendMaterialParams && ext.extendMaterialParams( materialIndex, materialParams );\n\n\t\t\t} ) ) );\n\n\t\t}\n\n\t\tif ( materialDef.doubleSided === true ) {\n\n\t\t\tmaterialParams.side = DoubleSide;\n\n\t\t}\n\n\t\tconst alphaMode = materialDef.alphaMode || ALPHA_MODES.OPAQUE;\n\n\t\tif ( alphaMode === ALPHA_MODES.BLEND ) {\n\n\t\t\tmaterialParams.transparent = true;\n\n\t\t\t// See: https://github.com/mrdoob/three.js/issues/17706\n\t\t\tmaterialParams.depthWrite = false;\n\n\t\t} else {\n\n\t\t\tmaterialParams.transparent = false;\n\n\t\t\tif ( alphaMode === ALPHA_MODES.MASK ) {\n\n\t\t\t\tmaterialParams.alphaTest = materialDef.alphaCutoff !== undefined ? materialDef.alphaCutoff : 0.5;\n\n\t\t\t}\n\n\t\t}\n\n\t\tif ( materialDef.normalTexture !== undefined && materialType !== MeshBasicMaterial ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'normalMap', materialDef.normalTexture ) );\n\n\t\t\tmaterialParams.normalScale = new Vector2( 1, 1 );\n\n\t\t\tif ( materialDef.normalTexture.scale !== undefined ) {\n\n\t\t\t\tconst scale = materialDef.normalTexture.scale;\n\n\t\t\t\tmaterialParams.normalScale.set( scale, scale );\n\n\t\t\t}\n\n\t\t}\n\n\t\tif ( materialDef.occlusionTexture !== undefined && materialType !== MeshBasicMaterial ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'aoMap', materialDef.occlusionTexture ) );\n\n\t\t\tif ( materialDef.occlusionTexture.strength !== undefined ) {\n\n\t\t\t\tmaterialParams.aoMapIntensity = materialDef.occlusionTexture.strength;\n\n\t\t\t}\n\n\t\t}\n\n\t\tif ( materialDef.emissiveFactor !== undefined && materialType !== MeshBasicMaterial ) {\n\n\t\t\tconst emissiveFactor = materialDef.emissiveFactor;\n\t\t\tmaterialParams.emissive = new Color().setRGB( emissiveFactor[ 0 ], emissiveFactor[ 1 ], emissiveFactor[ 2 ], LinearSRGBColorSpace );\n\n\t\t}\n\n\t\tif ( materialDef.emissiveTexture !== undefined && materialType !== MeshBasicMaterial ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'emissiveMap', materialDef.emissiveTexture, SRGBColorSpace ) );\n\n\t\t}\n\n\t\treturn Promise.all( pending ).then( function () {\n\n\t\t\tconst material = new materialType( materialParams );\n\n\t\t\tif ( materialDef.name ) material.name = materialDef.name;\n\n\t\t\tassignExtrasToUserData( material, materialDef );\n\n\t\t\tparser.associations.set( material, { materials: materialIndex } );\n\n\t\t\tif ( materialDef.extensions ) addUnknownExtensionsToUserData( extensions, material, materialDef );\n\n\t\t\treturn material;\n\n\t\t} );\n\n\t}\n\n\t/**\n\t * When Object3D instances are targeted by animation, they need unique names.\n\t *\n\t * @private\n\t * @param {string} originalName\n\t * @return {string}\n\t */\n\tcreateUniqueName( originalName ) {\n\n\t\tconst sanitizedName = PropertyBinding.sanitizeNodeName( originalName || '' );\n\n\t\tif ( sanitizedName in this.nodeNamesUsed ) {\n\n\t\t\treturn sanitizedName + '_' + ( ++ this.nodeNamesUsed[ sanitizedName ] );\n\n\t\t} else {\n\n\t\t\tthis.nodeNamesUsed[ sanitizedName ] = 0;\n\n\t\t\treturn sanitizedName;\n\n\t\t}\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#geometry\n\t *\n\t * Creates BufferGeometries from primitives.\n\t *\n\t * @private\n\t * @param {Array<GLTF.Primitive>} primitives\n\t * @return {Promise<Array<BufferGeometry>>}\n\t */\n\tloadGeometries( primitives ) {\n\n\t\tconst parser = this;\n\t\tconst extensions = this.extensions;\n\t\tconst cache = this.primitiveCache;\n\n\t\tfunction createDracoPrimitive( primitive ) {\n\n\t\t\treturn extensions[ EXTENSIONS.KHR_DRACO_MESH_COMPRESSION ]\n\t\t\t\t.decodePrimitive( primitive, parser )\n\t\t\t\t.then( function ( geometry ) {\n\n\t\t\t\t\treturn addPrimitiveAttributes( geometry, primitive, parser );\n\n\t\t\t\t} );\n\n\t\t}\n\n\t\tconst pending = [];\n\n\t\tfor ( let i = 0, il = primitives.length; i < il; i ++ ) {\n\n\t\t\tconst primitive = primitives[ i ];\n\t\t\tconst cacheKey = createPrimitiveKey( primitive );\n\n\t\t\t// See if we've already created this geometry\n\t\t\tconst cached = cache[ cacheKey ];\n\n\t\t\tif ( cached ) {\n\n\t\t\t\t// Use the cached geometry if it exists\n\t\t\t\tpending.push( cached.promise );\n\n\t\t\t} else {\n\n\t\t\t\tlet geometryPromise;\n\n\t\t\t\tif ( primitive.extensions && primitive.extensions[ EXTENSIONS.KHR_DRACO_MESH_COMPRESSION ] ) {\n\n\t\t\t\t\t// Use DRACO geometry if available\n\t\t\t\t\tgeometryPromise = createDracoPrimitive( primitive );\n\n\t\t\t\t} else {\n\n\t\t\t\t\t// Otherwise create a new geometry\n\t\t\t\t\tgeometryPromise = addPrimitiveAttributes( new BufferGeometry(), primitive, parser );\n\n\t\t\t\t}\n\n\t\t\t\t// Cache this geometry\n\t\t\t\tcache[ cacheKey ] = { primitive: primitive, promise: geometryPromise };\n\n\t\t\t\tpending.push( geometryPromise );\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn Promise.all( pending );\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#meshes\n\t *\n\t * @private\n\t * @param {number} meshIndex\n\t * @return {Promise<Group|Mesh|SkinnedMesh|Line|Points>}\n\t */\n\tloadMesh( meshIndex ) {\n\n\t\tconst parser = this;\n\t\tconst json = this.json;\n\t\tconst extensions = this.extensions;\n\n\t\tconst meshDef = json.meshes[ meshIndex ];\n\t\tconst primitives = meshDef.primitives;\n\n\t\tconst pending = [];\n\n\t\tfor ( let i = 0, il = primitives.length; i < il; i ++ ) {\n\n\t\t\tconst material = primitives[ i ].material === undefined\n\t\t\t\t? createDefaultMaterial( this.cache )\n\t\t\t\t: this.getDependency( 'material', primitives[ i ].material );\n\n\t\t\tpending.push( material );\n\n\t\t}\n\n\t\tpending.push( parser.loadGeometries( primitives ) );\n\n\t\treturn Promise.all( pending ).then( function ( results ) {\n\n\t\t\tconst materials = results.slice( 0, results.length - 1 );\n\t\t\tconst geometries = results[ results.length - 1 ];\n\n\t\t\tconst meshes = [];\n\n\t\t\tfor ( let i = 0, il = geometries.length; i < il; i ++ ) {\n\n\t\t\t\tconst geometry = geometries[ i ];\n\t\t\t\tconst primitive = primitives[ i ];\n\n\t\t\t\t// 1. create Mesh\n\n\t\t\t\tlet mesh;\n\n\t\t\t\tconst material = materials[ i ];\n\n\t\t\t\tif ( primitive.mode === WEBGL_CONSTANTS.TRIANGLES ||\n\t\t\t\t\t\tprimitive.mode === WEBGL_CONSTANTS.TRIANGLE_STRIP ||\n\t\t\t\t\t\tprimitive.mode === WEBGL_CONSTANTS.TRIANGLE_FAN ||\n\t\t\t\t\t\tprimitive.mode === undefined ) {\n\n\t\t\t\t\t// .isSkinnedMesh isn't in glTF spec. See ._markDefs()\n\t\t\t\t\tmesh = meshDef.isSkinnedMesh === true\n\t\t\t\t\t\t? new SkinnedMesh( geometry, material )\n\t\t\t\t\t\t: new Mesh( geometry, material );\n\n\t\t\t\t\tif ( mesh.isSkinnedMesh === true ) {\n\n\t\t\t\t\t\t// normalize skin weights to fix malformed assets (see #15319)\n\t\t\t\t\t\tmesh.normalizeSkinWeights();\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( primitive.mode === WEBGL_CONSTANTS.TRIANGLE_STRIP ) {\n\n\t\t\t\t\t\tmesh.geometry = toTrianglesDrawMode( mesh.geometry, TriangleStripDrawMode );\n\n\t\t\t\t\t} else if ( primitive.mode === WEBGL_CONSTANTS.TRIANGLE_FAN ) {\n\n\t\t\t\t\t\tmesh.geometry = toTrianglesDrawMode( mesh.geometry, TriangleFanDrawMode );\n\n\t\t\t\t\t}\n\n\t\t\t\t} else if ( primitive.mode === WEBGL_CONSTANTS.LINES ) {\n\n\t\t\t\t\tmesh = new LineSegments( geometry, material );\n\n\t\t\t\t} else if ( primitive.mode === WEBGL_CONSTANTS.LINE_STRIP ) {\n\n\t\t\t\t\tmesh = new Line( geometry, material );\n\n\t\t\t\t} else if ( primitive.mode === WEBGL_CONSTANTS.LINE_LOOP ) {\n\n\t\t\t\t\tmesh = new LineLoop( geometry, material );\n\n\t\t\t\t} else if ( primitive.mode === WEBGL_CONSTANTS.POINTS ) {\n\n\t\t\t\t\tmesh = new Points( geometry, material );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tthrow new Error( 'THREE.GLTFLoader: Primitive mode unsupported: ' + primitive.mode );\n\n\t\t\t\t}\n\n\t\t\t\tif ( Object.keys( mesh.geometry.morphAttributes ).length > 0 ) {\n\n\t\t\t\t\tupdateMorphTargets( mesh, meshDef );\n\n\t\t\t\t}\n\n\t\t\t\tmesh.name = parser.createUniqueName( meshDef.name || ( 'mesh_' + meshIndex ) );\n\n\t\t\t\tassignExtrasToUserData( mesh, meshDef );\n\n\t\t\t\tif ( primitive.extensions ) addUnknownExtensionsToUserData( extensions, mesh, primitive );\n\n\t\t\t\tparser.assignFinalMaterial( mesh );\n\n\t\t\t\tmeshes.push( mesh );\n\n\t\t\t}\n\n\t\t\tfor ( let i = 0, il = meshes.length; i < il; i ++ ) {\n\n\t\t\t\tparser.associations.set( meshes[ i ], {\n\t\t\t\t\tmeshes: meshIndex,\n\t\t\t\t\tprimitives: i\n\t\t\t\t} );\n\n\t\t\t}\n\n\t\t\tif ( meshes.length === 1 ) {\n\n\t\t\t\tif ( meshDef.extensions ) addUnknownExtensionsToUserData( extensions, meshes[ 0 ], meshDef );\n\n\t\t\t\treturn meshes[ 0 ];\n\n\t\t\t}\n\n\t\t\tconst group = new Group();\n\n\t\t\tif ( meshDef.extensions ) addUnknownExtensionsToUserData( extensions, group, meshDef );\n\n\t\t\tparser.associations.set( group, { meshes: meshIndex } );\n\n\t\t\tfor ( let i = 0, il = meshes.length; i < il; i ++ ) {\n\n\t\t\t\tgroup.add( meshes[ i ] );\n\n\t\t\t}\n\n\t\t\treturn group;\n\n\t\t} );\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#cameras\n\t *\n\t * @private\n\t * @param {number} cameraIndex\n\t * @return {Promise<THREE.Camera>}\n\t */\n\tloadCamera( cameraIndex ) {\n\n\t\tlet camera;\n\t\tconst cameraDef = this.json.cameras[ cameraIndex ];\n\t\tconst params = cameraDef[ cameraDef.type ];\n\n\t\tif ( ! params ) {\n\n\t\t\tconsole.warn( 'THREE.GLTFLoader: Missing camera parameters.' );\n\t\t\treturn;\n\n\t\t}\n\n\t\tif ( cameraDef.type === 'perspective' ) {\n\n\t\t\tcamera = new PerspectiveCamera( MathUtils.radToDeg( params.yfov ), params.aspectRatio || 1, params.znear || 1, params.zfar || 2e6 );\n\n\t\t} else if ( cameraDef.type === 'orthographic' ) {\n\n\t\t\tcamera = new OrthographicCamera( - params.xmag, params.xmag, params.ymag, - params.ymag, params.znear, params.zfar );\n\n\t\t}\n\n\t\tif ( cameraDef.name ) camera.name = this.createUniqueName( cameraDef.name );\n\n\t\tassignExtrasToUserData( camera, cameraDef );\n\n\t\treturn Promise.resolve( camera );\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#skins\n\t *\n\t * @private\n\t * @param {number} skinIndex\n\t * @return {Promise<Skeleton>}\n\t */\n\tloadSkin( skinIndex ) {\n\n\t\tconst skinDef = this.json.skins[ skinIndex ];\n\n\t\tconst pending = [];\n\n\t\tfor ( let i = 0, il = skinDef.joints.length; i < il; i ++ ) {\n\n\t\t\tpending.push( this._loadNodeShallow( skinDef.joints[ i ] ) );\n\n\t\t}\n\n\t\tif ( skinDef.inverseBindMatrices !== undefined ) {\n\n\t\t\tpending.push( this.getDependency( 'accessor', skinDef.inverseBindMatrices ) );\n\n\t\t} else {\n\n\t\t\tpending.push( null );\n\n\t\t}\n\n\t\treturn Promise.all( pending ).then( function ( results ) {\n\n\t\t\tconst inverseBindMatrices = results.pop();\n\t\t\tconst jointNodes = results;\n\n\t\t\t// Note that bones (joint nodes) may or may not be in the\n\t\t\t// scene graph at this time.\n\n\t\t\tconst bones = [];\n\t\t\tconst boneInverses = [];\n\n\t\t\tfor ( let i = 0, il = jointNodes.length; i < il; i ++ ) {\n\n\t\t\t\tconst jointNode = jointNodes[ i ];\n\n\t\t\t\tif ( jointNode ) {\n\n\t\t\t\t\tbones.push( jointNode );\n\n\t\t\t\t\tconst mat = new Matrix4();\n\n\t\t\t\t\tif ( inverseBindMatrices !== null ) {\n\n\t\t\t\t\t\tmat.fromArray( inverseBindMatrices.array, i * 16 );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tboneInverses.push( mat );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tconsole.warn( 'THREE.GLTFLoader: Joint \"%s\" could not be found.', skinDef.joints[ i ] );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn new Skeleton( bones, boneInverses );\n\n\t\t} );\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#animations\n\t *\n\t * @private\n\t * @param {number} animationIndex\n\t * @return {Promise<AnimationClip>}\n\t */\n\tloadAnimation( animationIndex ) {\n\n\t\tconst json = this.json;\n\t\tconst parser = this;\n\n\t\tconst animationDef = json.animations[ animationIndex ];\n\t\tconst animationName = animationDef.name ? animationDef.name : 'animation_' + animationIndex;\n\n\t\tconst pendingNodes = [];\n\t\tconst pendingInputAccessors = [];\n\t\tconst pendingOutputAccessors = [];\n\t\tconst pendingSamplers = [];\n\t\tconst pendingTargets = [];\n\n\t\tfor ( let i = 0, il = animationDef.channels.length; i < il; i ++ ) {\n\n\t\t\tconst channel = animationDef.channels[ i ];\n\t\t\tconst sampler = animationDef.samplers[ channel.sampler ];\n\t\t\tconst target = channel.target;\n\t\t\tconst name = target.node;\n\t\t\tconst input = animationDef.parameters !== undefined ? animationDef.parameters[ sampler.input ] : sampler.input;\n\t\t\tconst output = animationDef.parameters !== undefined ? animationDef.parameters[ sampler.output ] : sampler.output;\n\n\t\t\tif ( target.node === undefined ) continue;\n\n\t\t\tpendingNodes.push( this.getDependency( 'node', name ) );\n\t\t\tpendingInputAccessors.push( this.getDependency( 'accessor', input ) );\n\t\t\tpendingOutputAccessors.push( this.getDependency( 'accessor', output ) );\n\t\t\tpendingSamplers.push( sampler );\n\t\t\tpendingTargets.push( target );\n\n\t\t}\n\n\t\treturn Promise.all( [\n\n\t\t\tPromise.all( pendingNodes ),\n\t\t\tPromise.all( pendingInputAccessors ),\n\t\t\tPromise.all( pendingOutputAccessors ),\n\t\t\tPromise.all( pendingSamplers ),\n\t\t\tPromise.all( pendingTargets )\n\n\t\t] ).then( function ( dependencies ) {\n\n\t\t\tconst nodes = dependencies[ 0 ];\n\t\t\tconst inputAccessors = dependencies[ 1 ];\n\t\t\tconst outputAccessors = dependencies[ 2 ];\n\t\t\tconst samplers = dependencies[ 3 ];\n\t\t\tconst targets = dependencies[ 4 ];\n\n\t\t\tconst tracks = [];\n\n\t\t\tfor ( let i = 0, il = nodes.length; i < il; i ++ ) {\n\n\t\t\t\tconst node = nodes[ i ];\n\t\t\t\tconst inputAccessor = inputAccessors[ i ];\n\t\t\t\tconst outputAccessor = outputAccessors[ i ];\n\t\t\t\tconst sampler = samplers[ i ];\n\t\t\t\tconst target = targets[ i ];\n\n\t\t\t\tif ( node === undefined ) continue;\n\n\t\t\t\tif ( node.updateMatrix ) {\n\n\t\t\t\t\tnode.updateMatrix();\n\n\t\t\t\t}\n\n\t\t\t\tconst createdTracks = parser._createAnimationTracks( node, inputAccessor, outputAccessor, sampler, target );\n\n\t\t\t\tif ( createdTracks ) {\n\n\t\t\t\t\tfor ( let k = 0; k < createdTracks.length; k ++ ) {\n\n\t\t\t\t\t\ttracks.push( createdTracks[ k ] );\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn new AnimationClip( animationName, undefined, tracks );\n\n\t\t} );\n\n\t}\n\n\tcreateNodeMesh( nodeIndex ) {\n\n\t\tconst json = this.json;\n\t\tconst parser = this;\n\t\tconst nodeDef = json.nodes[ nodeIndex ];\n\n\t\tif ( nodeDef.mesh === undefined ) return null;\n\n\t\treturn parser.getDependency( 'mesh', nodeDef.mesh ).then( function ( mesh ) {\n\n\t\t\tconst node = parser._getNodeRef( parser.meshCache, nodeDef.mesh, mesh );\n\n\t\t\t// if weights are provided on the node, override weights on the mesh.\n\t\t\tif ( nodeDef.weights !== undefined ) {\n\n\t\t\t\tnode.traverse( function ( o ) {\n\n\t\t\t\t\tif ( ! o.isMesh ) return;\n\n\t\t\t\t\tfor ( let i = 0, il = nodeDef.weights.length; i < il; i ++ ) {\n\n\t\t\t\t\t\to.morphTargetInfluences[ i ] = nodeDef.weights[ i ];\n\n\t\t\t\t\t}\n\n\t\t\t\t} );\n\n\t\t\t}\n\n\t\t\treturn node;\n\n\t\t} );\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#nodes-and-hierarchy\n\t *\n\t * @private\n\t * @param {number} nodeIndex\n\t * @return {Promise<Object3D>}\n\t */\n\tloadNode( nodeIndex ) {\n\n\t\tconst json = this.json;\n\t\tconst parser = this;\n\n\t\tconst nodeDef = json.nodes[ nodeIndex ];\n\n\t\tconst nodePending = parser._loadNodeShallow( nodeIndex );\n\n\t\tconst childPending = [];\n\t\tconst childrenDef = nodeDef.children || [];\n\n\t\tfor ( let i = 0, il = childrenDef.length; i < il; i ++ ) {\n\n\t\t\tchildPending.push( parser.getDependency( 'node', childrenDef[ i ] ) );\n\n\t\t}\n\n\t\tconst skeletonPending = nodeDef.skin === undefined\n\t\t\t? Promise.resolve( null )\n\t\t\t: parser.getDependency( 'skin', nodeDef.skin );\n\n\t\treturn Promise.all( [\n\t\t\tnodePending,\n\t\t\tPromise.all( childPending ),\n\t\t\tskeletonPending\n\t\t] ).then( function ( results ) {\n\n\t\t\tconst node = results[ 0 ];\n\t\t\tconst children = results[ 1 ];\n\t\t\tconst skeleton = results[ 2 ];\n\n\t\t\tif ( skeleton !== null ) {\n\n\t\t\t\t// This full traverse should be fine because\n\t\t\t\t// child glTF nodes have not been added to this node yet.\n\t\t\t\tnode.traverse( function ( mesh ) {\n\n\t\t\t\t\tif ( ! mesh.isSkinnedMesh ) return;\n\n\t\t\t\t\tmesh.bind( skeleton, _identityMatrix );\n\n\t\t\t\t} );\n\n\t\t\t}\n\n\t\t\tfor ( let i = 0, il = children.length; i < il; i ++ ) {\n\n\t\t\t\tnode.add( children[ i ] );\n\n\t\t\t}\n\n\t\t\treturn node;\n\n\t\t} );\n\n\t}\n\n\t// ._loadNodeShallow() parses a single node.\n\t// skin and child nodes are created and added in .loadNode() (no '_' prefix).\n\t_loadNodeShallow( nodeIndex ) {\n\n\t\tconst json = this.json;\n\t\tconst extensions = this.extensions;\n\t\tconst parser = this;\n\n\t\t// This method is called from .loadNode() and .loadSkin().\n\t\t// Cache a node to avoid duplication.\n\n\t\tif ( this.nodeCache[ nodeIndex ] !== undefined ) {\n\n\t\t\treturn this.nodeCache[ nodeIndex ];\n\n\t\t}\n\n\t\tconst nodeDef = json.nodes[ nodeIndex ];\n\n\t\t// reserve node's name before its dependencies, so the root has the intended name.\n\t\tconst nodeName = nodeDef.name ? parser.createUniqueName( nodeDef.name ) : '';\n\n\t\tconst pending = [];\n\n\t\tconst meshPromise = parser._invokeOne( function ( ext ) {\n\n\t\t\treturn ext.createNodeMesh && ext.createNodeMesh( nodeIndex );\n\n\t\t} );\n\n\t\tif ( meshPromise ) {\n\n\t\t\tpending.push( meshPromise );\n\n\t\t}\n\n\t\tif ( nodeDef.camera !== undefined ) {\n\n\t\t\tpending.push( parser.getDependency( 'camera', nodeDef.camera ).then( function ( camera ) {\n\n\t\t\t\treturn parser._getNodeRef( parser.cameraCache, nodeDef.camera, camera );\n\n\t\t\t} ) );\n\n\t\t}\n\n\t\tparser._invokeAll( function ( ext ) {\n\n\t\t\treturn ext.createNodeAttachment && ext.createNodeAttachment( nodeIndex );\n\n\t\t} ).forEach( function ( promise ) {\n\n\t\t\tpending.push( promise );\n\n\t\t} );\n\n\t\tthis.nodeCache[ nodeIndex ] = Promise.all( pending ).then( function ( objects ) {\n\n\t\t\tlet node;\n\n\t\t\t// .isBone isn't in glTF spec. See ._markDefs\n\t\t\tif ( nodeDef.isBone === true ) {\n\n\t\t\t\tnode = new Bone();\n\n\t\t\t} else if ( objects.length > 1 ) {\n\n\t\t\t\tnode = new Group();\n\n\t\t\t} else if ( objects.length === 1 ) {\n\n\t\t\t\tnode = objects[ 0 ];\n\n\t\t\t} else {\n\n\t\t\t\tnode = new Object3D();\n\n\t\t\t}\n\n\t\t\tif ( node !== objects[ 0 ] ) {\n\n\t\t\t\tfor ( let i = 0, il = objects.length; i < il; i ++ ) {\n\n\t\t\t\t\tnode.add( objects[ i ] );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tif ( nodeDef.name ) {\n\n\t\t\t\tnode.userData.name = nodeDef.name;\n\t\t\t\tnode.name = nodeName;\n\n\t\t\t}\n\n\t\t\tassignExtrasToUserData( node, nodeDef );\n\n\t\t\tif ( nodeDef.extensions ) addUnknownExtensionsToUserData( extensions, node, nodeDef );\n\n\t\t\tif ( nodeDef.matrix !== undefined ) {\n\n\t\t\t\tconst matrix = new Matrix4();\n\t\t\t\tmatrix.fromArray( nodeDef.matrix );\n\t\t\t\tnode.applyMatrix4( matrix );\n\n\t\t\t} else {\n\n\t\t\t\tif ( nodeDef.translation !== undefined ) {\n\n\t\t\t\t\tnode.position.fromArray( nodeDef.translation );\n\n\t\t\t\t}\n\n\t\t\t\tif ( nodeDef.rotation !== undefined ) {\n\n\t\t\t\t\tnode.quaternion.fromArray( nodeDef.rotation );\n\n\t\t\t\t}\n\n\t\t\t\tif ( nodeDef.scale !== undefined ) {\n\n\t\t\t\t\tnode.scale.fromArray( nodeDef.scale );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tif ( ! parser.associations.has( node ) ) {\n\n\t\t\t\tparser.associations.set( node, {} );\n\n\t\t\t}\n\n\t\t\tparser.associations.get( node ).nodes = nodeIndex;\n\n\t\t\treturn node;\n\n\t\t} );\n\n\t\treturn this.nodeCache[ nodeIndex ];\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#scenes\n\t *\n\t * @private\n\t * @param {number} sceneIndex\n\t * @return {Promise<Group>}\n\t */\n\tloadScene( sceneIndex ) {\n\n\t\tconst extensions = this.extensions;\n\t\tconst sceneDef = this.json.scenes[ sceneIndex ];\n\t\tconst parser = this;\n\n\t\t// Loader returns Group, not Scene.\n\t\t// See: https://github.com/mrdoob/three.js/issues/18342#issuecomment-578981172\n\t\tconst scene = new Group();\n\t\tif ( sceneDef.name ) scene.name = parser.createUniqueName( sceneDef.name );\n\n\t\tassignExtrasToUserData( scene, sceneDef );\n\n\t\tif ( sceneDef.extensions ) addUnknownExtensionsToUserData( extensions, scene, sceneDef );\n\n\t\tconst nodeIds = sceneDef.nodes || [];\n\n\t\tconst pending = [];\n\n\t\tfor ( let i = 0, il = nodeIds.length; i < il; i ++ ) {\n\n\t\t\tpending.push( parser.getDependency( 'node', nodeIds[ i ] ) );\n\n\t\t}\n\n\t\treturn Promise.all( pending ).then( function ( nodes ) {\n\n\t\t\tfor ( let i = 0, il = nodes.length; i < il; i ++ ) {\n\n\t\t\t\tscene.add( nodes[ i ] );\n\n\t\t\t}\n\n\t\t\t// Removes dangling associations, associations that reference a node that\n\t\t\t// didn't make it into the scene.\n\t\t\tconst reduceAssociations = ( node ) => {\n\n\t\t\t\tconst reducedAssociations = new Map();\n\n\t\t\t\tfor ( const [ key, value ] of parser.associations ) {\n\n\t\t\t\t\tif ( key instanceof Material || key instanceof Texture ) {\n\n\t\t\t\t\t\treducedAssociations.set( key, value );\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\tnode.traverse( ( node ) => {\n\n\t\t\t\t\tconst mappings = parser.associations.get( node );\n\n\t\t\t\t\tif ( mappings != null ) {\n\n\t\t\t\t\t\treducedAssociations.set( node, mappings );\n\n\t\t\t\t\t}\n\n\t\t\t\t} );\n\n\t\t\t\treturn reducedAssociations;\n\n\t\t\t};\n\n\t\t\tparser.associations = reduceAssociations( scene );\n\n\t\t\treturn scene;\n\n\t\t} );\n\n\t}\n\n\t_createAnimationTracks( node, inputAccessor, outputAccessor, sampler, target ) {\n\n\t\tconst tracks = [];\n\n\t\tconst targetName = node.name ? node.name : node.uuid;\n\t\tconst targetNames = [];\n\n\t\tif ( PATH_PROPERTIES[ target.path ] === PATH_PROPERTIES.weights ) {\n\n\t\t\tnode.traverse( function ( object ) {\n\n\t\t\t\tif ( object.morphTargetInfluences ) {\n\n\t\t\t\t\ttargetNames.push( object.name ? object.name : object.uuid );\n\n\t\t\t\t}\n\n\t\t\t} );\n\n\t\t} else {\n\n\t\t\ttargetNames.push( targetName );\n\n\t\t}\n\n\t\tlet TypedKeyframeTrack;\n\n\t\tswitch ( PATH_PROPERTIES[ target.path ] ) {\n\n\t\t\tcase PATH_PROPERTIES.weights:\n\n\t\t\t\tTypedKeyframeTrack = NumberKeyframeTrack;\n\t\t\t\tbreak;\n\n\t\t\tcase PATH_PROPERTIES.rotation:\n\n\t\t\t\tTypedKeyframeTrack = QuaternionKeyframeTrack;\n\t\t\t\tbreak;\n\n\t\t\tcase PATH_PROPERTIES.translation:\n\t\t\tcase PATH_PROPERTIES.scale:\n\n\t\t\t\tTypedKeyframeTrack = VectorKeyframeTrack;\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\n\t\t\t\tswitch ( outputAccessor.itemSize ) {\n\n\t\t\t\t\tcase 1:\n\t\t\t\t\t\tTypedKeyframeTrack = NumberKeyframeTrack;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 2:\n\t\t\t\t\tcase 3:\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tTypedKeyframeTrack = VectorKeyframeTrack;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\n\t\t}\n\n\t\tconst interpolation = sampler.interpolation !== undefined ? INTERPOLATION[ sampler.interpolation ] : InterpolateLinear;\n\n\n\t\tconst outputArray = this._getArrayFromAccessor( outputAccessor );\n\n\t\tfor ( let j = 0, jl = targetNames.length; j < jl; j ++ ) {\n\n\t\t\tconst track = new TypedKeyframeTrack(\n\t\t\t\ttargetNames[ j ] + '.' + PATH_PROPERTIES[ target.path ],\n\t\t\t\tinputAccessor.array,\n\t\t\t\toutputArray,\n\t\t\t\tinterpolation\n\t\t\t);\n\n\t\t\t// Override interpolation with custom factory method.\n\t\t\tif ( sampler.interpolation === 'CUBICSPLINE' ) {\n\n\t\t\t\tthis._createCubicSplineTrackInterpolant( track );\n\n\t\t\t}\n\n\t\t\ttracks.push( track );\n\n\t\t}\n\n\t\treturn tracks;\n\n\t}\n\n\t_getArrayFromAccessor( accessor ) {\n\n\t\tlet outputArray = accessor.array;\n\n\t\tif ( accessor.normalized ) {\n\n\t\t\tconst scale = getNormalizedComponentScale( outputArray.constructor );\n\t\t\tconst scaled = new Float32Array( outputArray.length );\n\n\t\t\tfor ( let j = 0, jl = outputArray.length; j < jl; j ++ ) {\n\n\t\t\t\tscaled[ j ] = outputArray[ j ] * scale;\n\n\t\t\t}\n\n\t\t\toutputArray = scaled;\n\n\t\t}\n\n\t\treturn outputArray;\n\n\t}\n\n\t_createCubicSplineTrackInterpolant( track ) {\n\n\t\ttrack.createInterpolant = function InterpolantFactoryMethodGLTFCubicSpline( result ) {\n\n\t\t\t// A CUBICSPLINE keyframe in glTF has three output values for each input value,\n\t\t\t// representing inTangent, splineVertex, and outTangent. As a result, track.getValueSize()\n\t\t\t// must be divided by three to get the interpolant's sampleSize argument.\n\n\t\t\tconst interpolantType = ( this instanceof QuaternionKeyframeTrack ) ? GLTFCubicSplineQuaternionInterpolant : GLTFCubicSplineInterpolant;\n\n\t\t\treturn new interpolantType( this.times, this.values, this.getValueSize() / 3, result );\n\n\t\t};\n\n\t\t// Mark as CUBICSPLINE. `track.getInterpolation()` doesn't support custom interpolants.\n\t\ttrack.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline = true;\n\n\t}\n\n}\n\n/**\n *\n * @private\n * @param {BufferGeometry} geometry\n * @param {GLTF.Primitive} primitiveDef\n * @param {GLTFParser} parser\n */\nfunction computeBounds( geometry, primitiveDef, parser ) {\n\n\tconst attributes = primitiveDef.attributes;\n\n\tconst box = new Box3();\n\n\tif ( attributes.POSITION !== undefined ) {\n\n\t\tconst accessor = parser.json.accessors[ attributes.POSITION ];\n\n\t\tconst min = accessor.min;\n\t\tconst max = accessor.max;\n\n\t\t// glTF requires 'min' and 'max', but VRM (which extends glTF) currently ignores that requirement.\n\n\t\tif ( min !== undefined && max !== undefined ) {\n\n\t\t\tbox.set(\n\t\t\t\tnew Vector3( min[ 0 ], min[ 1 ], min[ 2 ] ),\n\t\t\t\tnew Vector3( max[ 0 ], max[ 1 ], max[ 2 ] )\n\t\t\t);\n\n\t\t\tif ( accessor.normalized ) {\n\n\t\t\t\tconst boxScale = getNormalizedComponentScale( WEBGL_COMPONENT_TYPES[ accessor.componentType ] );\n\t\t\t\tbox.min.multiplyScalar( boxScale );\n\t\t\t\tbox.max.multiplyScalar( boxScale );\n\n\t\t\t}\n\n\t\t} else {\n\n\t\t\tconsole.warn( 'THREE.GLTFLoader: Missing min/max properties for accessor POSITION.' );\n\n\t\t\treturn;\n\n\t\t}\n\n\t} else {\n\n\t\treturn;\n\n\t}\n\n\tconst targets = primitiveDef.targets;\n\n\tif ( targets !== undefined ) {\n\n\t\tconst maxDisplacement = new Vector3();\n\t\tconst vector = new Vector3();\n\n\t\tfor ( let i = 0, il = targets.length; i < il; i ++ ) {\n\n\t\t\tconst target = targets[ i ];\n\n\t\t\tif ( target.POSITION !== undefined ) {\n\n\t\t\t\tconst accessor = parser.json.accessors[ target.POSITION ];\n\t\t\t\tconst min = accessor.min;\n\t\t\t\tconst max = accessor.max;\n\n\t\t\t\t// glTF requires 'min' and 'max', but VRM (which extends glTF) currently ignores that requirement.\n\n\t\t\t\tif ( min !== undefined && max !== undefined ) {\n\n\t\t\t\t\t// we need to get max of absolute components because target weight is [-1,1]\n\t\t\t\t\tvector.setX( Math.max( Math.abs( min[ 0 ] ), Math.abs( max[ 0 ] ) ) );\n\t\t\t\t\tvector.setY( Math.max( Math.abs( min[ 1 ] ), Math.abs( max[ 1 ] ) ) );\n\t\t\t\t\tvector.setZ( Math.max( Math.abs( min[ 2 ] ), Math.abs( max[ 2 ] ) ) );\n\n\n\t\t\t\t\tif ( accessor.normalized ) {\n\n\t\t\t\t\t\tconst boxScale = getNormalizedComponentScale( WEBGL_COMPONENT_TYPES[ accessor.componentType ] );\n\t\t\t\t\t\tvector.multiplyScalar( boxScale );\n\n\t\t\t\t\t}\n\n\t\t\t\t\t// Note: this assumes that the sum of all weights is at most 1. This isn't quite correct - it's more conservative\n\t\t\t\t\t// to assume that each target can have a max weight of 1. However, for some use cases - notably, when morph targets\n\t\t\t\t\t// are used to implement key-frame animations and as such only two are active at a time - this results in very large\n\t\t\t\t\t// boxes. So for now we make a box that's sometimes a touch too small but is hopefully mostly of reasonable size.\n\t\t\t\t\tmaxDisplacement.max( vector );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tconsole.warn( 'THREE.GLTFLoader: Missing min/max properties for accessor POSITION.' );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\t// As per comment above this box isn't conservative, but has a reasonable size for a very large number of morph targets.\n\t\tbox.expandByVector( maxDisplacement );\n\n\t}\n\n\tgeometry.boundingBox = box;\n\n\tconst sphere = new Sphere();\n\n\tbox.getCenter( sphere.center );\n\tsphere.radius = box.min.distanceTo( box.max ) / 2;\n\n\tgeometry.boundingSphere = sphere;\n\n}\n\n/**\n *\n * @private\n * @param {BufferGeometry} geometry\n * @param {GLTF.Primitive} primitiveDef\n * @param {GLTFParser} parser\n * @return {Promise<BufferGeometry>}\n */\nfunction addPrimitiveAttributes( geometry, primitiveDef, parser ) {\n\n\tconst attributes = primitiveDef.attributes;\n\n\tconst pending = [];\n\n\tfunction assignAttributeAccessor( accessorIndex, attributeName ) {\n\n\t\treturn parser.getDependency( 'accessor', accessorIndex )\n\t\t\t.then( function ( accessor ) {\n\n\t\t\t\tgeometry.setAttribute( attributeName, accessor );\n\n\t\t\t} );\n\n\t}\n\n\tfor ( const gltfAttributeName in attributes ) {\n\n\t\tconst threeAttributeName = ATTRIBUTES[ gltfAttributeName ] || gltfAttributeName.toLowerCase();\n\n\t\t// Skip attributes already provided by e.g. Draco extension.\n\t\tif ( threeAttributeName in geometry.attributes ) continue;\n\n\t\tpending.push( assignAttributeAccessor( attributes[ gltfAttributeName ], threeAttributeName ) );\n\n\t}\n\n\tif ( primitiveDef.indices !== undefined && ! geometry.index ) {\n\n\t\tconst accessor = parser.getDependency( 'accessor', primitiveDef.indices ).then( function ( accessor ) {\n\n\t\t\tgeometry.setIndex( accessor );\n\n\t\t} );\n\n\t\tpending.push( accessor );\n\n\t}\n\n\tif ( ColorManagement.workingColorSpace !== LinearSRGBColorSpace && 'COLOR_0' in attributes ) {\n\n\t\tconsole.warn( `THREE.GLTFLoader: Converting vertex colors from \"srgb-linear\" to \"${ColorManagement.workingColorSpace}\" not supported.` );\n\n\t}\n\n\tassignExtrasToUserData( geometry, primitiveDef );\n\n\tcomputeBounds( geometry, primitiveDef, parser );\n\n\treturn Promise.all( pending ).then( function () {\n\n\t\treturn primitiveDef.targets !== undefined\n\t\t\t? addMorphTargets( geometry, primitiveDef.targets, parser )\n\t\t\t: geometry;\n\n\t} );\n\n}\n\n/**\n * Loader result of `GLTFLoader`.\n *\n * @typedef {Object} GLTFLoader~LoadObject\n * @property {Array<AnimationClip>} animations - An array of animation clips.\n * @property {Object} asset - Meta data about the loaded asset.\n * @property {Array<Camera>} cameras - An array of cameras.\n * @property {GLTFParser} parser - A reference to the internal parser.\n * @property {Group} scene - The default scene.\n * @property {Array<Group>} scenes - glTF assets might define multiple scenes.\n * @property {Object} userData - Additional data.\n **/\n\nexport { GLTFLoader };\n","/** @module CopyShader */\n\n/**\n * Full-screen copy shader pass.\n *\n * @constant\n * @type {ShaderMaterial~Shader}\n */\nconst CopyShader = {\n\n\tname: 'CopyShader',\n\n\tuniforms: {\n\n\t\t'tDiffuse': { value: null },\n\t\t'opacity': { value: 1.0 }\n\n\t},\n\n\tvertexShader: /* glsl */`\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}`,\n\n\tfragmentShader: /* glsl */`\n\n\t\tuniform float opacity;\n\n\t\tuniform sampler2D tDiffuse;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 texel = texture2D( tDiffuse, vUv );\n\t\t\tgl_FragColor = opacity * texel;\n\n\n\t\t}`\n\n};\n\nexport { CopyShader };\n","import {\n\tBufferGeometry,\n\tFloat32BufferAttribute,\n\tOrthographicCamera,\n\tMesh\n} from 'three';\n\n/**\n * Abstract base class for all post processing passes.\n *\n * This module is only relevant for post processing with {@link WebGLRenderer}.\n *\n * @abstract\n */\nclass Pass {\n\n\t/**\n\t * Constructs a new pass.\n\t */\n\tconstructor() {\n\n\t\t/**\n\t\t * This flag can be used for type testing.\n\t\t *\n\t\t * @type {boolean}\n\t\t * @readonly\n\t\t * @default true\n\t\t */\n\t\tthis.isPass = true;\n\n\t\t/**\n\t\t * If set to `true`, the pass is processed by the composer.\n\t\t *\n\t\t * @type {boolean}\n\t\t * @default true\n\t\t */\n\t\tthis.enabled = true;\n\n\t\t/**\n\t\t * If set to `true`, the pass indicates to swap read and write buffer after rendering.\n\t\t *\n\t\t * @type {boolean}\n\t\t * @default true\n\t\t */\n\t\tthis.needsSwap = true;\n\n\t\t/**\n\t\t * If set to `true`, the pass clears its buffer before rendering\n\t\t *\n\t\t * @type {boolean}\n\t\t * @default false\n\t\t */\n\t\tthis.clear = false;\n\n\t\t/**\n\t\t * If set to `true`, the result of the pass is rendered to screen. The last pass in the composers\n\t\t * pass chain gets automatically rendered to screen, no matter how this property is configured.\n\t\t *\n\t\t * @type {boolean}\n\t\t * @default false\n\t\t */\n\t\tthis.renderToScreen = false;\n\n\t}\n\n\t/**\n\t * Sets the size of the pass.\n\t *\n\t * @abstract\n\t * @param {number} width - The width to set.\n\t * @param {number} height - The width to set.\n\t */\n\tsetSize( /* width, height */ ) {}\n\n\t/**\n\t * This method holds the render logic of a pass. It must be implemented in all derived classes.\n\t *\n\t * @abstract\n\t * @param {WebGLRenderer} renderer - The renderer.\n\t * @param {WebGLRenderTarget} writeBuffer - The write buffer. This buffer is intended as the rendering\n\t * destination for the pass.\n\t * @param {WebGLRenderTarget} readBuffer - The read buffer. The pass can access the result from the\n\t * previous pass from this buffer.\n\t * @param {number} deltaTime - The delta time in seconds.\n\t * @param {boolean} maskActive - Whether masking is active or not.\n\t */\n\trender( /* renderer, writeBuffer, readBuffer, deltaTime, maskActive */ ) {\n\n\t\tconsole.error( 'THREE.Pass: .render() must be implemented in derived pass.' );\n\n\t}\n\n\t/**\n\t * Frees the GPU-related resources allocated by this instance. Call this\n\t * method whenever the pass is no longer used in your app.\n\t *\n\t * @abstract\n\t */\n\tdispose() {}\n\n}\n\n// Helper for passes that need to fill the viewport with a single quad.\n\nconst _camera = new OrthographicCamera( - 1, 1, 1, - 1, 0, 1 );\n\n// https://github.com/mrdoob/three.js/pull/21358\n\nclass FullscreenTriangleGeometry extends BufferGeometry {\n\n\tconstructor() {\n\n\t\tsuper();\n\n\t\tthis.setAttribute( 'position', new Float32BufferAttribute( [ - 1, 3, 0, - 1, - 1, 0, 3, - 1, 0 ], 3 ) );\n\t\tthis.setAttribute( 'uv', new Float32BufferAttribute( [ 0, 2, 0, 0, 2, 0 ], 2 ) );\n\n\t}\n\n}\n\nconst _geometry = new FullscreenTriangleGeometry();\n\n\n/**\n * This module is a helper for passes which need to render a full\n * screen effect which is quite common in context of post processing.\n *\n * The intended usage is to reuse a single full screen quad for rendering\n * subsequent passes by just reassigning the `material` reference.\n *\n * This module can only be used with {@link WebGLRenderer}.\n *\n * @augments Mesh\n */\nclass FullScreenQuad {\n\n\t/**\n\t * Constructs a new full screen quad.\n\t *\n\t * @param {?Material} material - The material to render te full screen quad with.\n\t */\n\tconstructor( material ) {\n\n\t\tthis._mesh = new Mesh( _geometry, material );\n\n\t}\n\n\t/**\n\t * Frees the GPU-related resources allocated by this instance. Call this\n\t * method whenever the instance is no longer used in your app.\n\t */\n\tdispose() {\n\n\t\tthis._mesh.geometry.dispose();\n\n\t}\n\n\t/**\n\t * Renders the full screen quad.\n\t *\n\t * @param {WebGLRenderer} renderer - The renderer.\n\t */\n\trender( renderer ) {\n\n\t\trenderer.render( this._mesh, _camera );\n\n\t}\n\n\t/**\n\t * The quad's material.\n\t *\n\t * @type {?Material}\n\t */\n\tget material() {\n\n\t\treturn this._mesh.material;\n\n\t}\n\n\tset material( value ) {\n\n\t\tthis._mesh.material = value;\n\n\t}\n\n}\n\nexport { Pass, FullScreenQuad };\n","import {\n\tShaderMaterial,\n\tUniformsUtils\n} from 'three';\nimport { Pass, FullScreenQuad } from './Pass.js';\n\n/**\n * This pass can be used to create a post processing effect\n * with a raw GLSL shader object. Useful for implementing custom\n * effects.\n *\n * ```js\n * const fxaaPass = new ShaderPass( FXAAShader );\n * composer.addPass( fxaaPass );\n * ```\n *\n * @augments Pass\n */\nclass ShaderPass extends Pass {\n\n\t/**\n\t * Constructs a new shader pass.\n\t *\n\t * @param {Object|ShaderMaterial} [shader] - A shader object holding vertex and fragment shader as well as\n\t * defines and uniforms. It's also valid to pass a custom shader material.\n\t * @param {string} [textureID='tDiffuse'] - The name of the texture uniform that should sample\n\t * the read buffer.\n\t */\n\tconstructor( shader, textureID = 'tDiffuse' ) {\n\n\t\tsuper();\n\n\t\t/**\n\t\t * The name of the texture uniform that should sample the read buffer.\n\t\t *\n\t\t * @type {string}\n\t\t * @default 'tDiffuse'\n\t\t */\n\t\tthis.textureID = textureID;\n\n\t\t/**\n\t\t * The pass uniforms.\n\t\t *\n\t\t * @type {?Object}\n\t\t */\n\t\tthis.uniforms = null;\n\n\t\t/**\n\t\t * The pass material.\n\t\t *\n\t\t * @type {?ShaderMaterial}\n\t\t */\n\t\tthis.material = null;\n\n\t\tif ( shader instanceof ShaderMaterial ) {\n\n\t\t\tthis.uniforms = shader.uniforms;\n\n\t\t\tthis.material = shader;\n\n\t\t} else if ( shader ) {\n\n\t\t\tthis.uniforms = UniformsUtils.clone( shader.uniforms );\n\n\t\t\tthis.material = new ShaderMaterial( {\n\n\t\t\t\tname: ( shader.name !== undefined ) ? shader.name : 'unspecified',\n\t\t\t\tdefines: Object.assign( {}, shader.defines ),\n\t\t\t\tuniforms: this.uniforms,\n\t\t\t\tvertexShader: shader.vertexShader,\n\t\t\t\tfragmentShader: shader.fragmentShader\n\n\t\t\t} );\n\n\t\t}\n\n\t\t// internals\n\n\t\tthis._fsQuad = new FullScreenQuad( this.material );\n\n\t}\n\n\t/**\n\t * Performs the shader pass.\n\t *\n\t * @param {WebGLRenderer} renderer - The renderer.\n\t * @param {WebGLRenderTarget} writeBuffer - The write buffer. This buffer is intended as the rendering\n\t * destination for the pass.\n\t * @param {WebGLRenderTarget} readBuffer - The read buffer. The pass can access the result from the\n\t * previous pass from this buffer.\n\t * @param {number} deltaTime - The delta time in seconds.\n\t * @param {boolean} maskActive - Whether masking is active or not.\n\t */\n\trender( renderer, writeBuffer, readBuffer /*, deltaTime, maskActive */ ) {\n\n\t\tif ( this.uniforms[ this.textureID ] ) {\n\n\t\t\tthis.uniforms[ this.textureID ].value = readBuffer.texture;\n\n\t\t}\n\n\t\tthis._fsQuad.material = this.material;\n\n\t\tif ( this.renderToScreen ) {\n\n\t\t\trenderer.setRenderTarget( null );\n\t\t\tthis._fsQuad.render( renderer );\n\n\t\t} else {\n\n\t\t\trenderer.setRenderTarget( writeBuffer );\n\t\t\t// TODO: Avoid using autoClear properties, see https://github.com/mrdoob/three.js/pull/15571#issuecomment-465669600\n\t\t\tif ( this.clear ) renderer.clear( renderer.autoClearColor, renderer.autoClearDepth, renderer.autoClearStencil );\n\t\t\tthis._fsQuad.render( renderer );\n\n\t\t}\n\n\t}\n\n\t/**\n\t * Frees the GPU-related resources allocated by this instance. Call this\n\t * method whenever the pass is no longer used in your app.\n\t */\n\tdispose() {\n\n\t\tthis.material.dispose();\n\n\t\tthis._fsQuad.dispose();\n\n\t}\n\n}\n\nexport { ShaderPass };\n","import { Pass } from './Pass.js';\n\n/**\n * This pass can be used to define a mask during post processing.\n * Meaning only areas of subsequent post processing are affected\n * which lie in the masking area of this pass. Internally, the masking\n * is implemented with the stencil buffer.\n *\n * ```js\n * const maskPass = new MaskPass( scene, camera );\n * composer.addPass( maskPass );\n * ```\n *\n * @augments Pass\n */\nclass MaskPass extends Pass {\n\n\t/**\n\t * Constructs a new mask pass.\n\t *\n\t * @param {Scene} scene - The 3D objects in this scene will define the mask.\n\t * @param {Camera} camera - The camera.\n\t */\n\tconstructor( scene, camera ) {\n\n\t\tsuper();\n\n\t\t/**\n\t\t * The scene that defines the mask.\n\t\t *\n\t\t * @type {Scene}\n\t\t */\n\t\tthis.scene = scene;\n\n\t\t/**\n\t\t * The camera.\n\t\t *\n\t\t * @type {Camera}\n\t\t */\n\t\tthis.camera = camera;\n\n\t\t/**\n\t\t * Overwritten to perform a clear operation by default.\n\t\t *\n\t\t * @type {boolean}\n\t\t * @default true\n\t\t */\n\t\tthis.clear = true;\n\n\t\t/**\n\t\t * Overwritten to disable the swap.\n\t\t *\n\t\t * @type {boolean}\n\t\t * @default false\n\t\t */\n\t\tthis.needsSwap = false;\n\n\t\t/**\n\t\t * Whether to inverse the mask or not.\n\t\t *\n\t\t * @type {boolean}\n\t\t * @default false\n\t\t */\n\t\tthis.inverse = false;\n\n\t}\n\n\t/**\n\t * Performs a mask pass with the configured scene and camera.\n\t *\n\t * @param {WebGLRenderer} renderer - The renderer.\n\t * @param {WebGLRenderTarget} writeBuffer - The write buffer. This buffer is intended as the rendering\n\t * destination for the pass.\n\t * @param {WebGLRenderTarget} readBuffer - The read buffer. The pass can access the result from the\n\t * previous pass from this buffer.\n\t * @param {number} deltaTime - The delta time in seconds.\n\t * @param {boolean} maskActive - Whether masking is active or not.\n\t */\n\trender( renderer, writeBuffer, readBuffer /*, deltaTime, maskActive */ ) {\n\n\t\tconst context = renderer.getContext();\n\t\tconst state = renderer.state;\n\n\t\t// don't update color or depth\n\n\t\tstate.buffers.color.setMask( false );\n\t\tstate.buffers.depth.setMask( false );\n\n\t\t// lock buffers\n\n\t\tstate.buffers.color.setLocked( true );\n\t\tstate.buffers.depth.setLocked( true );\n\n\t\t// set up stencil\n\n\t\tlet writeValue, clearValue;\n\n\t\tif ( this.inverse ) {\n\n\t\t\twriteValue = 0;\n\t\t\tclearValue = 1;\n\n\t\t} else {\n\n\t\t\twriteValue = 1;\n\t\t\tclearValue = 0;\n\n\t\t}\n\n\t\tstate.buffers.stencil.setTest( true );\n\t\tstate.buffers.stencil.setOp( context.REPLACE, context.REPLACE, context.REPLACE );\n\t\tstate.buffers.stencil.setFunc( context.ALWAYS, writeValue, 0xffffffff );\n\t\tstate.buffers.stencil.setClear( clearValue );\n\t\tstate.buffers.stencil.setLocked( true );\n\n\t\t// draw into the stencil buffer\n\n\t\trenderer.setRenderTarget( readBuffer );\n\t\tif ( this.clear ) renderer.clear();\n\t\trenderer.render( this.scene, this.camera );\n\n\t\trenderer.setRenderTarget( writeBuffer );\n\t\tif ( this.clear ) renderer.clear();\n\t\trenderer.render( this.scene, this.camera );\n\n\t\t// unlock color and depth buffer and make them writable for subsequent rendering/clearing\n\n\t\tstate.buffers.color.setLocked( false );\n\t\tstate.buffers.depth.setLocked( false );\n\n\t\tstate.buffers.color.setMask( true );\n\t\tstate.buffers.depth.setMask( true );\n\n\t\t// only render where stencil is set to 1\n\n\t\tstate.buffers.stencil.setLocked( false );\n\t\tstate.buffers.stencil.setFunc( context.EQUAL, 1, 0xffffffff ); // draw if == 1\n\t\tstate.buffers.stencil.setOp( context.KEEP, context.KEEP, context.KEEP );\n\t\tstate.buffers.stencil.setLocked( true );\n\n\t}\n\n}\n\n/**\n * This pass can be used to clear a mask previously defined with {@link MaskPass}.\n *\n * ```js\n * const clearPass = new ClearMaskPass();\n * composer.addPass( clearPass );\n * ```\n *\n * @augments Pass\n */\nclass ClearMaskPass extends Pass {\n\n\t/**\n\t * Constructs a new clear mask pass.\n\t */\n\tconstructor() {\n\n\t\tsuper();\n\n\t\t/**\n\t\t * Overwritten to disable the swap.\n\t\t *\n\t\t * @type {boolean}\n\t\t * @default false\n\t\t */\n\t\tthis.needsSwap = false;\n\n\t}\n\n\t/**\n\t * Performs the clear of the currently defined mask.\n\t *\n\t * @param {WebGLRenderer} renderer - The renderer.\n\t * @param {WebGLRenderTarget} writeBuffer - The write buffer. This buffer is intended as the rendering\n\t * destination for the pass.\n\t * @param {WebGLRenderTarget} readBuffer - The read buffer. The pass can access the result from the\n\t * previous pass from this buffer.\n\t * @param {number} deltaTime - The delta time in seconds.\n\t * @param {boolean} maskActive - Whether masking is active or not.\n\t */\n\trender( renderer /*, writeBuffer, readBuffer, deltaTime, maskActive */ ) {\n\n\t\trenderer.state.buffers.stencil.setLocked( false );\n\t\trenderer.state.buffers.stencil.setTest( false );\n\n\t}\n\n}\n\nexport { MaskPass, ClearMaskPass };\n","import {\n\tClock,\n\tHalfFloatType,\n\tNoBlending,\n\tVector2,\n\tWebGLRenderTarget\n} from 'three';\nimport { CopyShader } from '../shaders/CopyShader.js';\nimport { ShaderPass } from './ShaderPass.js';\nimport { ClearMaskPass, MaskPass } from './MaskPass.js';\n\n/**\n * Used to implement post-processing effects in three.js.\n * The class manages a chain of post-processing passes to produce the final visual result.\n * Post-processing passes are executed in order of their addition/insertion.\n * The last pass is automatically rendered to screen.\n *\n * This module can only be used with {@link WebGLRenderer}.\n *\n * ```js\n * const composer = new EffectComposer( renderer );\n *\n * // adding some passes\n * const renderPass = new RenderPass( scene, camera );\n * composer.addPass( renderPass );\n *\n * const glitchPass = new GlitchPass();\n * composer.addPass( glitchPass );\n *\n * const outputPass = new OutputPass()\n * composer.addPass( outputPass );\n *\n * function animate() {\n *\n * \tcomposer.render(); // instead of renderer.render()\n *\n * }\n * ```\n */\nclass EffectComposer {\n\n\t/**\n\t * Constructs a new effect composer.\n\t *\n\t * @param {WebGLRenderer} renderer - The renderer.\n\t * @param {WebGLRenderTarget} [renderTarget] - This render target and a clone will\n\t * be used as the internal read and write buffers. If not given, the composer creates\n\t * the buffers automatically.\n\t */\n\tconstructor( renderer, renderTarget ) {\n\n\t\t/**\n\t\t * The renderer.\n\t\t *\n\t\t * @type {WebGLRenderer}\n\t\t */\n\t\tthis.renderer = renderer;\n\n\t\tthis._pixelRatio = renderer.getPixelRatio();\n\n\t\tif ( renderTarget === undefined ) {\n\n\t\t\tconst size = renderer.getSize( new Vector2() );\n\t\t\tthis._width = size.width;\n\t\t\tthis._height = size.height;\n\n\t\t\trenderTarget = new WebGLRenderTarget( this._width * this._pixelRatio, this._height * this._pixelRatio, { type: HalfFloatType } );\n\t\t\trenderTarget.texture.name = 'EffectComposer.rt1';\n\n\t\t} else {\n\n\t\t\tthis._width = renderTarget.width;\n\t\t\tthis._height = renderTarget.height;\n\n\t\t}\n\n\t\tthis.renderTarget1 = renderTarget;\n\t\tthis.renderTarget2 = renderTarget.clone();\n\t\tthis.renderTarget2.texture.name = 'EffectComposer.rt2';\n\n\t\t/**\n\t\t * A reference to the internal write buffer. Passes usually write\n\t\t * their result into this buffer.\n\t\t *\n\t\t * @type {WebGLRenderTarget}\n\t\t */\n\t\tthis.writeBuffer = this.renderTarget1;\n\n\t\t/**\n\t\t * A reference to the internal read buffer. Passes usually read\n\t\t * the previous render result from this buffer.\n\t\t *\n\t\t * @type {WebGLRenderTarget}\n\t\t */\n\t\tthis.readBuffer = this.renderTarget2;\n\n\t\t/**\n\t\t * Whether the final pass is rendered to the screen (default framebuffer) or not.\n\t\t *\n\t\t * @type {boolean}\n\t\t * @default true\n\t\t */\n\t\tthis.renderToScreen = true;\n\n\t\t/**\n\t\t * An array representing the (ordered) chain of post-processing passes.\n\t\t *\n\t\t * @type {Array<Pass>}\n\t\t */\n\t\tthis.passes = [];\n\n\t\t/**\n\t\t * A copy pass used for internal swap operations.\n\t\t *\n\t\t * @private\n\t\t * @type {ShaderPass}\n\t\t */\n\t\tthis.copyPass = new ShaderPass( CopyShader );\n\t\tthis.copyPass.material.blending = NoBlending;\n\n\t\t/**\n\t\t * The intenral clock for managing time data.\n\t\t *\n\t\t * @private\n\t\t * @type {Clock}\n\t\t */\n\t\tthis.clock = new Clock();\n\n\t}\n\n\t/**\n\t * Swaps the internal read/write buffers.\n\t */\n\tswapBuffers() {\n\n\t\tconst tmp = this.readBuffer;\n\t\tthis.readBuffer = this.writeBuffer;\n\t\tthis.writeBuffer = tmp;\n\n\t}\n\n\t/**\n\t * Adds the given pass to the pass chain.\n\t *\n\t * @param {Pass} pass - The pass to add.\n\t */\n\taddPass( pass ) {\n\n\t\tthis.passes.push( pass );\n\t\tpass.setSize( this._width * this._pixelRatio, this._height * this._pixelRatio );\n\n\t}\n\n\t/**\n\t * Inserts the given pass at a given index.\n\t *\n\t * @param {Pass} pass - The pass to insert.\n\t * @param {number} index - The index into the pass chain.\n\t */\n\tinsertPass( pass, index ) {\n\n\t\tthis.passes.splice( index, 0, pass );\n\t\tpass.setSize( this._width * this._pixelRatio, this._height * this._pixelRatio );\n\n\t}\n\n\t/**\n\t * Removes the given pass from the pass chain.\n\t *\n\t * @param {Pass} pass - The pass to remove.\n\t */\n\tremovePass( pass ) {\n\n\t\tconst index = this.passes.indexOf( pass );\n\n\t\tif ( index !== - 1 ) {\n\n\t\t\tthis.passes.splice( index, 1 );\n\n\t\t}\n\n\t}\n\n\t/**\n\t * Returns `true` if the pass for the given index is the last enabled pass in the pass chain.\n\t *\n\t * @param {number} passIndex - The pass index.\n\t * @return {boolean} Whether the the pass for the given index is the last pass in the pass chain.\n\t */\n\tisLastEnabledPass( passIndex ) {\n\n\t\tfor ( let i = passIndex + 1; i < this.passes.length; i ++ ) {\n\n\t\t\tif ( this.passes[ i ].enabled ) {\n\n\t\t\t\treturn false;\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn true;\n\n\t}\n\n\t/**\n\t * Executes all enabled post-processing passes in order to produce the final frame.\n\t *\n\t * @param {number} deltaTime - The delta time in seconds. If not given, the composer computes\n\t * its own time delta value.\n\t */\n\trender( deltaTime ) {\n\n\t\t// deltaTime value is in seconds\n\n\t\tif ( deltaTime === undefined ) {\n\n\t\t\tdeltaTime = this.clock.getDelta();\n\n\t\t}\n\n\t\tconst currentRenderTarget = this.renderer.getRenderTarget();\n\n\t\tlet maskActive = false;\n\n\t\tfor ( let i = 0, il = this.passes.length; i < il; i ++ ) {\n\n\t\t\tconst pass = this.passes[ i ];\n\n\t\t\tif ( pass.enabled === false ) continue;\n\n\t\t\tpass.renderToScreen = ( this.renderToScreen && this.isLastEnabledPass( i ) );\n\t\t\tpass.render( this.renderer, this.writeBuffer, this.readBuffer, deltaTime, maskActive );\n\n\t\t\tif ( pass.needsSwap ) {\n\n\t\t\t\tif ( maskActive ) {\n\n\t\t\t\t\tconst context = this.renderer.getContext();\n\t\t\t\t\tconst stencil = this.renderer.state.buffers.stencil;\n\n\t\t\t\t\t//context.stencilFunc( context.NOTEQUAL, 1, 0xffffffff );\n\t\t\t\t\tstencil.setFunc( context.NOTEQUAL, 1, 0xffffffff );\n\n\t\t\t\t\tthis.copyPass.render( this.renderer, this.writeBuffer, this.readBuffer, deltaTime );\n\n\t\t\t\t\t//context.stencilFunc( context.EQUAL, 1, 0xffffffff );\n\t\t\t\t\tstencil.setFunc( context.EQUAL, 1, 0xffffffff );\n\n\t\t\t\t}\n\n\t\t\t\tthis.swapBuffers();\n\n\t\t\t}\n\n\t\t\tif ( MaskPass !== undefined ) {\n\n\t\t\t\tif ( pass instanceof MaskPass ) {\n\n\t\t\t\t\tmaskActive = true;\n\n\t\t\t\t} else if ( pass instanceof ClearMaskPass ) {\n\n\t\t\t\t\tmaskActive = false;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tthis.renderer.setRenderTarget( currentRenderTarget );\n\n\t}\n\n\t/**\n\t * Resets the internal state of the EffectComposer.\n\t *\n\t * @param {WebGLRenderTarget} [renderTarget] - This render target has the same purpose like\n\t * the one from the constructor. If set, it is used to setup the read and write buffers.\n\t */\n\treset( renderTarget ) {\n\n\t\tif ( renderTarget === undefined ) {\n\n\t\t\tconst size = this.renderer.getSize( new Vector2() );\n\t\t\tthis._pixelRatio = this.renderer.getPixelRatio();\n\t\t\tthis._width = size.width;\n\t\t\tthis._height = size.height;\n\n\t\t\trenderTarget = this.renderTarget1.clone();\n\t\t\trenderTarget.setSize( this._width * this._pixelRatio, this._height * this._pixelRatio );\n\n\t\t}\n\n\t\tthis.renderTarget1.dispose();\n\t\tthis.renderTarget2.dispose();\n\t\tthis.renderTarget1 = renderTarget;\n\t\tthis.renderTarget2 = renderTarget.clone();\n\n\t\tthis.writeBuffer = this.renderTarget1;\n\t\tthis.readBuffer = this.renderTarget2;\n\n\t}\n\n\t/**\n\t * Resizes the internal read and write buffers as well as all passes. Similar to {@link WebGLRenderer#setSize},\n\t * this method honors the current pixel ration.\n\t *\n\t * @param {number} width - The width in logical pixels.\n\t * @param {number} height - The height in logical pixels.\n\t */\n\tsetSize( width, height ) {\n\n\t\tthis._width = width;\n\t\tthis._height = height;\n\n\t\tconst effectiveWidth = this._width * this._pixelRatio;\n\t\tconst effectiveHeight = this._height * this._pixelRatio;\n\n\t\tthis.renderTarget1.setSize( effectiveWidth, effectiveHeight );\n\t\tthis.renderTarget2.setSize( effectiveWidth, effectiveHeight );\n\n\t\tfor ( let i = 0; i < this.passes.length; i ++ ) {\n\n\t\t\tthis.passes[ i ].setSize( effectiveWidth, effectiveHeight );\n\n\t\t}\n\n\t}\n\n\t/**\n\t * Sets device pixel ratio. This is usually used for HiDPI device to prevent blurring output.\n\t * Setting the pixel ratio will automatically resize the composer.\n\t *\n\t * @param {number} pixelRatio - The pixel ratio to set.\n\t */\n\tsetPixelRatio( pixelRatio ) {\n\n\t\tthis._pixelRatio = pixelRatio;\n\n\t\tthis.setSize( this._width, this._height );\n\n\t}\n\n\t/**\n\t * Frees the GPU-related resources allocated by this instance. Call this\n\t * method whenever the composer is no longer used in your app.\n\t */\n\tdispose() {\n\n\t\tthis.renderTarget1.dispose();\n\t\tthis.renderTarget2.dispose();\n\n\t\tthis.copyPass.dispose();\n\n\t}\n\n}\n\nexport { EffectComposer };\n","import {\n\tColor\n} from 'three';\nimport { Pass } from './Pass.js';\n\n/**\n * This class represents a render pass. It takes a camera and a scene and produces\n * a beauty pass for subsequent post processing effects.\n *\n * ```js\n * const renderPass = new RenderPass( scene, camera );\n * composer.addPass( renderPass );\n * ```\n *\n * @augments Pass\n */\nclass RenderPass extends Pass {\n\n\t/**\n\t * Constructs a new render pass.\n\t *\n\t * @param {Scene} scene - The scene to render.\n\t * @param {Camera} camera - The camera.\n\t * @param {?Material} [overrideMaterial=null] - The override material. If set, this material is used\n\t * for all objects in the scene.\n\t * @param {?(number|Color|string)} [clearColor=null] - The clear color of the render pass.\n\t * @param {?number} [clearAlpha=null] - The clear alpha of the render pass.\n\t */\n\tconstructor( scene, camera, overrideMaterial = null, clearColor = null, clearAlpha = null ) {\n\n\t\tsuper();\n\n\t\t/**\n\t\t * The scene to render.\n\t\t *\n\t\t * @type {Scene}\n\t\t */\n\t\tthis.scene = scene;\n\n\t\t/**\n\t\t * The camera.\n\t\t *\n\t\t * @type {Camera}\n\t\t */\n\t\tthis.camera = camera;\n\n\t\t/**\n\t\t * The override material. If set, this material is used\n\t\t * for all objects in the scene.\n\t\t *\n\t\t * @type {?Material}\n\t\t * @default null\n\t\t */\n\t\tthis.overrideMaterial = overrideMaterial;\n\n\t\t/**\n\t\t * The clear color of the render pass.\n\t\t *\n\t\t * @type {?(number|Color|string)}\n\t\t * @default null\n\t\t */\n\t\tthis.clearColor = clearColor;\n\n\t\t/**\n\t\t * The clear alpha of the render pass.\n\t\t *\n\t\t * @type {?number}\n\t\t * @default null\n\t\t */\n\t\tthis.clearAlpha = clearAlpha;\n\n\t\t/**\n\t\t * Overwritten to perform a clear operation by default.\n\t\t *\n\t\t * @type {boolean}\n\t\t * @default true\n\t\t */\n\t\tthis.clear = true;\n\n\t\t/**\n\t\t * If set to `true`, only the depth can be cleared when `clear` is to `false`.\n\t\t *\n\t\t * @type {boolean}\n\t\t * @default false\n\t\t */\n\t\tthis.clearDepth = false;\n\n\t\t/**\n\t\t * Overwritten to disable the swap.\n\t\t *\n\t\t * @type {boolean}\n\t\t * @default false\n\t\t */\n\t\tthis.needsSwap = false;\n\t\tthis._oldClearColor = new Color();\n\n\t}\n\n\t/**\n\t * Performs a beauty pass with the configured scene and camera.\n\t *\n\t * @param {WebGLRenderer} renderer - The renderer.\n\t * @param {WebGLRenderTarget} writeBuffer - The write buffer. This buffer is intended as the rendering\n\t * destination for the pass.\n\t * @param {WebGLRenderTarget} readBuffer - The read buffer. The pass can access the result from the\n\t * previous pass from this buffer.\n\t * @param {number} deltaTime - The delta time in seconds.\n\t * @param {boolean} maskActive - Whether masking is active or not.\n\t */\n\trender( renderer, writeBuffer, readBuffer /*, deltaTime, maskActive */ ) {\n\n\t\tconst oldAutoClear = renderer.autoClear;\n\t\trenderer.autoClear = false;\n\n\t\tlet oldClearAlpha, oldOverrideMaterial;\n\n\t\tif ( this.overrideMaterial !== null ) {\n\n\t\t\toldOverrideMaterial = this.scene.overrideMaterial;\n\n\t\t\tthis.scene.overrideMaterial = this.overrideMaterial;\n\n\t\t}\n\n\t\tif ( this.clearColor !== null ) {\n\n\t\t\trenderer.getClearColor( this._oldClearColor );\n\t\t\trenderer.setClearColor( this.clearColor, renderer.getClearAlpha() );\n\n\t\t}\n\n\t\tif ( this.clearAlpha !== null ) {\n\n\t\t\toldClearAlpha = renderer.getClearAlpha();\n\t\t\trenderer.setClearAlpha( this.clearAlpha );\n\n\t\t}\n\n\t\tif ( this.clearDepth == true ) {\n\n\t\t\trenderer.clearDepth();\n\n\t\t}\n\n\t\trenderer.setRenderTarget( this.renderToScreen ? null : readBuffer );\n\n\t\tif ( this.clear === true ) {\n\n\t\t\t// TODO: Avoid using autoClear properties, see https://github.com/mrdoob/three.js/pull/15571#issuecomment-465669600\n\t\t\trenderer.clear( renderer.autoClearColor, renderer.autoClearDepth, renderer.autoClearStencil );\n\n\t\t}\n\n\t\trenderer.render( this.scene, this.camera );\n\n\t\t// restore\n\n\t\tif ( this.clearColor !== null ) {\n\n\t\t\trenderer.setClearColor( this._oldClearColor );\n\n\t\t}\n\n\t\tif ( this.clearAlpha !== null ) {\n\n\t\t\trenderer.setClearAlpha( oldClearAlpha );\n\n\t\t}\n\n\t\tif ( this.overrideMaterial !== null ) {\n\n\t\t\tthis.scene.overrideMaterial = oldOverrideMaterial;\n\n\t\t}\n\n\t\trenderer.autoClear = oldAutoClear;\n\n\t}\n\n}\n\nexport { RenderPass };\n","import {\n\tColor\n} from 'three';\n\n/** @module LuminosityHighPassShader */\n\n/**\n * Luminosity high pass shader.\n *\n * @constant\n * @type {ShaderMaterial~Shader}\n */\nconst LuminosityHighPassShader = {\n\n\tname: 'LuminosityHighPassShader',\n\n\tuniforms: {\n\n\t\t'tDiffuse': { value: null },\n\t\t'luminosityThreshold': { value: 1.0 },\n\t\t'smoothWidth': { value: 1.0 },\n\t\t'defaultColor': { value: new Color( 0x000000 ) },\n\t\t'defaultOpacity': { value: 0.0 }\n\n\t},\n\n\tvertexShader: /* glsl */`\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}`,\n\n\tfragmentShader: /* glsl */`\n\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform vec3 defaultColor;\n\t\tuniform float defaultOpacity;\n\t\tuniform float luminosityThreshold;\n\t\tuniform float smoothWidth;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 texel = texture2D( tDiffuse, vUv );\n\n\t\t\tfloat v = luminance( texel.xyz );\n\n\t\t\tvec4 outputColor = vec4( defaultColor.rgb, defaultOpacity );\n\n\t\t\tfloat alpha = smoothstep( luminosityThreshold, luminosityThreshold + smoothWidth, v );\n\n\t\t\tgl_FragColor = mix( outputColor, texel, alpha );\n\n\t\t}`\n\n};\n\nexport { LuminosityHighPassShader };\n","import {\n\tAdditiveBlending,\n\tColor,\n\tHalfFloatType,\n\tMeshBasicMaterial,\n\tShaderMaterial,\n\tUniformsUtils,\n\tVector2,\n\tVector3,\n\tWebGLRenderTarget\n} from 'three';\nimport { Pass, FullScreenQuad } from './Pass.js';\nimport { CopyShader } from '../shaders/CopyShader.js';\nimport { LuminosityHighPassShader } from '../shaders/LuminosityHighPassShader.js';\n\n/**\n * This pass is inspired by the bloom pass of Unreal Engine. It creates a\n * mip map chain of bloom textures and blurs them with different radii. Because\n * of the weighted combination of mips, and because larger blurs are done on\n * higher mips, this effect provides good quality and performance.\n *\n * When using this pass, tone mapping must be enabled in the renderer settings.\n *\n * Reference:\n * - [Bloom in Unreal Engine]{@link https://docs.unrealengine.com/latest/INT/Engine/Rendering/PostProcessEffects/Bloom/}\n *\n * ```js\n * const resolution = new THREE.Vector2( window.innerWidth, window.innerHeight );\n * const bloomPass = new UnrealBloomPass( resolution, 1.5, 0.4, 0.85 );\n * composer.addPass( bloomPass );\n * ```\n *\n * @augments Pass\n */\nclass UnrealBloomPass extends Pass {\n\n\t/**\n\t * Constructs a new Unreal Bloom pass.\n\t *\n\t * @param {Vector2} [resolution] - The effect's resolution.\n\t * @param {number} [strength=1] - The Bloom strength.\n\t * @param {number} radius - The Bloom radius.\n\t * @param {number} threshold - The luminance threshold limits which bright areas contribute to the Bloom effect.\n\t */\n\tconstructor( resolution, strength = 1, radius, threshold ) {\n\n\t\tsuper();\n\n\t\t/**\n\t\t * The Bloom strength.\n\t\t *\n\t\t * @type {number}\n\t\t * @default 1\n\t\t */\n\t\tthis.strength = strength;\n\n\t\t/**\n\t\t * The Bloom radius.\n\t\t *\n\t\t * @type {number}\n\t\t */\n\t\tthis.radius = radius;\n\n\t\t/**\n\t\t * The luminance threshold limits which bright areas contribute to the Bloom effect.\n\t\t *\n\t\t * @type {number}\n\t\t */\n\t\tthis.threshold = threshold;\n\n\t\t/**\n\t\t * The effect's resolution.\n\t\t *\n\t\t * @type {Vector2}\n\t\t * @default (256,256)\n\t\t */\n\t\tthis.resolution = ( resolution !== undefined ) ? new Vector2( resolution.x, resolution.y ) : new Vector2( 256, 256 );\n\n\t\t/**\n\t\t * The effect's clear color\n\t\t *\n\t\t * @type {Color}\n\t\t * @default (0,0,0)\n\t\t */\n\t\tthis.clearColor = new Color( 0, 0, 0 );\n\n\t\t/**\n\t\t * Overwritten to disable the swap.\n\t\t *\n\t\t * @type {boolean}\n\t\t * @default false\n\t\t */\n\t\tthis.needsSwap = false;\n\n\t\t// internals\n\n\t\t// render targets\n\t\tthis.renderTargetsHorizontal = [];\n\t\tthis.renderTargetsVertical = [];\n\t\tthis.nMips = 5;\n\t\tlet resx = Math.round( this.resolution.x / 2 );\n\t\tlet resy = Math.round( this.resolution.y / 2 );\n\n\t\tthis.renderTargetBright = new WebGLRenderTarget( resx, resy, { type: HalfFloatType } );\n\t\tthis.renderTargetBright.texture.name = 'UnrealBloomPass.bright';\n\t\tthis.renderTargetBright.texture.generateMipmaps = false;\n\n\t\tfor ( let i = 0; i < this.nMips; i ++ ) {\n\n\t\t\tconst renderTargetHorizontal = new WebGLRenderTarget( resx, resy, { type: HalfFloatType } );\n\n\t\t\trenderTargetHorizontal.texture.name = 'UnrealBloomPass.h' + i;\n\t\t\trenderTargetHorizontal.texture.generateMipmaps = false;\n\n\t\t\tthis.renderTargetsHorizontal.push( renderTargetHorizontal );\n\n\t\t\tconst renderTargetVertical = new WebGLRenderTarget( resx, resy, { type: HalfFloatType } );\n\n\t\t\trenderTargetVertical.texture.name = 'UnrealBloomPass.v' + i;\n\t\t\trenderTargetVertical.texture.generateMipmaps = false;\n\n\t\t\tthis.renderTargetsVertical.push( renderTargetVertical );\n\n\t\t\tresx = Math.round( resx / 2 );\n\n\t\t\tresy = Math.round( resy / 2 );\n\n\t\t}\n\n\t\t// luminosity high pass material\n\n\t\tconst highPassShader = LuminosityHighPassShader;\n\t\tthis.highPassUniforms = UniformsUtils.clone( highPassShader.uniforms );\n\n\t\tthis.highPassUniforms[ 'luminosityThreshold' ].value = threshold;\n\t\tthis.highPassUniforms[ 'smoothWidth' ].value = 0.01;\n\n\t\tthis.materialHighPassFilter = new ShaderMaterial( {\n\t\t\tuniforms: this.highPassUniforms,\n\t\t\tvertexShader: highPassShader.vertexShader,\n\t\t\tfragmentShader: highPassShader.fragmentShader\n\t\t} );\n\n\t\t// gaussian blur materials\n\n\t\tthis.separableBlurMaterials = [];\n\t\tconst kernelSizeArray = [ 3, 5, 7, 9, 11 ];\n\t\tresx = Math.round( this.resolution.x / 2 );\n\t\tresy = Math.round( this.resolution.y / 2 );\n\n\t\tfor ( let i = 0; i < this.nMips; i ++ ) {\n\n\t\t\tthis.separableBlurMaterials.push( this._getSeparableBlurMaterial( kernelSizeArray[ i ] ) );\n\n\t\t\tthis.separableBlurMaterials[ i ].uniforms[ 'invSize' ].value = new Vector2( 1 / resx, 1 / resy );\n\n\t\t\tresx = Math.round( resx / 2 );\n\n\t\t\tresy = Math.round( resy / 2 );\n\n\t\t}\n\n\t\t// composite material\n\n\t\tthis.compositeMaterial = this._getCompositeMaterial( this.nMips );\n\t\tthis.compositeMaterial.uniforms[ 'blurTexture1' ].value = this.renderTargetsVertical[ 0 ].texture;\n\t\tthis.compositeMaterial.uniforms[ 'blurTexture2' ].value = this.renderTargetsVertical[ 1 ].texture;\n\t\tthis.compositeMaterial.uniforms[ 'blurTexture3' ].value = this.renderTargetsVertical[ 2 ].texture;\n\t\tthis.compositeMaterial.uniforms[ 'blurTexture4' ].value = this.renderTargetsVertical[ 3 ].texture;\n\t\tthis.compositeMaterial.uniforms[ 'blurTexture5' ].value = this.renderTargetsVertical[ 4 ].texture;\n\t\tthis.compositeMaterial.uniforms[ 'bloomStrength' ].value = strength;\n\t\tthis.compositeMaterial.uniforms[ 'bloomRadius' ].value = 0.1;\n\n\t\tconst bloomFactors = [ 1.0, 0.8, 0.6, 0.4, 0.2 ];\n\t\tthis.compositeMaterial.uniforms[ 'bloomFactors' ].value = bloomFactors;\n\t\tthis.bloomTintColors = [ new Vector3( 1, 1, 1 ), new Vector3( 1, 1, 1 ), new Vector3( 1, 1, 1 ), new Vector3( 1, 1, 1 ), new Vector3( 1, 1, 1 ) ];\n\t\tthis.compositeMaterial.uniforms[ 'bloomTintColors' ].value = this.bloomTintColors;\n\n\t\t// blend material\n\n\t\tthis.copyUniforms = UniformsUtils.clone( CopyShader.uniforms );\n\n\t\tthis.blendMaterial = new ShaderMaterial( {\n\t\t\tuniforms: this.copyUniforms,\n\t\t\tvertexShader: CopyShader.vertexShader,\n\t\t\tfragmentShader: CopyShader.fragmentShader,\n\t\t\tblending: AdditiveBlending,\n\t\t\tdepthTest: false,\n\t\t\tdepthWrite: false,\n\t\t\ttransparent: true\n\t\t} );\n\n\t\tthis._oldClearColor = new Color();\n\t\tthis._oldClearAlpha = 1;\n\n\t\tthis._basic = new MeshBasicMaterial();\n\n\t\tthis._fsQuad = new FullScreenQuad( null );\n\n\t}\n\n\t/**\n\t * Frees the GPU-related resources allocated by this instance. Call this\n\t * method whenever the pass is no longer used in your app.\n\t */\n\tdispose() {\n\n\t\tfor ( let i = 0; i < this.renderTargetsHorizontal.length; i ++ ) {\n\n\t\t\tthis.renderTargetsHorizontal[ i ].dispose();\n\n\t\t}\n\n\t\tfor ( let i = 0; i < this.renderTargetsVertical.length; i ++ ) {\n\n\t\t\tthis.renderTargetsVertical[ i ].dispose();\n\n\t\t}\n\n\t\tthis.renderTargetBright.dispose();\n\n\t\t//\n\n\t\tfor ( let i = 0; i < this.separableBlurMaterials.length; i ++ ) {\n\n\t\t\tthis.separableBlurMaterials[ i ].dispose();\n\n\t\t}\n\n\t\tthis.compositeMaterial.dispose();\n\t\tthis.blendMaterial.dispose();\n\t\tthis._basic.dispose();\n\n\t\t//\n\n\t\tthis._fsQuad.dispose();\n\n\t}\n\n\t/**\n\t * Sets the size of the pass.\n\t *\n\t * @param {number} width - The width to set.\n\t * @param {number} height - The width to set.\n\t */\n\tsetSize( width, height ) {\n\n\t\tlet resx = Math.round( width / 2 );\n\t\tlet resy = Math.round( height / 2 );\n\n\t\tthis.renderTargetBright.setSize( resx, resy );\n\n\t\tfor ( let i = 0; i < this.nMips; i ++ ) {\n\n\t\t\tthis.renderTargetsHorizontal[ i ].setSize( resx, resy );\n\t\t\tthis.renderTargetsVertical[ i ].setSize( resx, resy );\n\n\t\t\tthis.separableBlurMaterials[ i ].uniforms[ 'invSize' ].value = new Vector2( 1 / resx, 1 / resy );\n\n\t\t\tresx = Math.round( resx / 2 );\n\t\t\tresy = Math.round( resy / 2 );\n\n\t\t}\n\n\t}\n\n\t/**\n\t * Performs the Bloom pass.\n\t *\n\t * @param {WebGLRenderer} renderer - The renderer.\n\t * @param {WebGLRenderTarget} writeBuffer - The write buffer. This buffer is intended as the rendering\n\t * destination for the pass.\n\t * @param {WebGLRenderTarget} readBuffer - The read buffer. The pass can access the result from the\n\t * previous pass from this buffer.\n\t * @param {number} deltaTime - The delta time in seconds.\n\t * @param {boolean} maskActive - Whether masking is active or not.\n\t */\n\trender( renderer, writeBuffer, readBuffer, deltaTime, maskActive ) {\n\n\t\trenderer.getClearColor( this._oldClearColor );\n\t\tthis._oldClearAlpha = renderer.getClearAlpha();\n\t\tconst oldAutoClear = renderer.autoClear;\n\t\trenderer.autoClear = false;\n\n\t\trenderer.setClearColor( this.clearColor, 0 );\n\n\t\tif ( maskActive ) renderer.state.buffers.stencil.setTest( false );\n\n\t\t// Render input to screen\n\n\t\tif ( this.renderToScreen ) {\n\n\t\t\tthis._fsQuad.material = this._basic;\n\t\t\tthis._basic.map = readBuffer.texture;\n\n\t\t\trenderer.setRenderTarget( null );\n\t\t\trenderer.clear();\n\t\t\tthis._fsQuad.render( renderer );\n\n\t\t}\n\n\t\t// 1. Extract Bright Areas\n\n\t\tthis.highPassUniforms[ 'tDiffuse' ].value = readBuffer.texture;\n\t\tthis.highPassUniforms[ 'luminosityThreshold' ].value = this.threshold;\n\t\tthis._fsQuad.material = this.materialHighPassFilter;\n\n\t\trenderer.setRenderTarget( this.renderTargetBright );\n\t\trenderer.clear();\n\t\tthis._fsQuad.render( renderer );\n\n\t\t// 2. Blur All the mips progressively\n\n\t\tlet inputRenderTarget = this.renderTargetBright;\n\n\t\tfor ( let i = 0; i < this.nMips; i ++ ) {\n\n\t\t\tthis._fsQuad.material = this.separableBlurMaterials[ i ];\n\n\t\t\tthis.separableBlurMaterials[ i ].uniforms[ 'colorTexture' ].value = inputRenderTarget.texture;\n\t\t\tthis.separableBlurMaterials[ i ].uniforms[ 'direction' ].value = UnrealBloomPass.BlurDirectionX;\n\t\t\trenderer.setRenderTarget( this.renderTargetsHorizontal[ i ] );\n\t\t\trenderer.clear();\n\t\t\tthis._fsQuad.render( renderer );\n\n\t\t\tthis.separableBlurMaterials[ i ].uniforms[ 'colorTexture' ].value = this.renderTargetsHorizontal[ i ].texture;\n\t\t\tthis.separableBlurMaterials[ i ].uniforms[ 'direction' ].value = UnrealBloomPass.BlurDirectionY;\n\t\t\trenderer.setRenderTarget( this.renderTargetsVertical[ i ] );\n\t\t\trenderer.clear();\n\t\t\tthis._fsQuad.render( renderer );\n\n\t\t\tinputRenderTarget = this.renderTargetsVertical[ i ];\n\n\t\t}\n\n\t\t// Composite All the mips\n\n\t\tthis._fsQuad.material = this.compositeMaterial;\n\t\tthis.compositeMaterial.uniforms[ 'bloomStrength' ].value = this.strength;\n\t\tthis.compositeMaterial.uniforms[ 'bloomRadius' ].value = this.radius;\n\t\tthis.compositeMaterial.uniforms[ 'bloomTintColors' ].value = this.bloomTintColors;\n\n\t\trenderer.setRenderTarget( this.renderTargetsHorizontal[ 0 ] );\n\t\trenderer.clear();\n\t\tthis._fsQuad.render( renderer );\n\n\t\t// Blend it additively over the input texture\n\n\t\tthis._fsQuad.material = this.blendMaterial;\n\t\tthis.copyUniforms[ 'tDiffuse' ].value = this.renderTargetsHorizontal[ 0 ].texture;\n\n\t\tif ( maskActive ) renderer.state.buffers.stencil.setTest( true );\n\n\t\tif ( this.renderToScreen ) {\n\n\t\t\trenderer.setRenderTarget( null );\n\t\t\tthis._fsQuad.render( renderer );\n\n\t\t} else {\n\n\t\t\trenderer.setRenderTarget( readBuffer );\n\t\t\tthis._fsQuad.render( renderer );\n\n\t\t}\n\n\t\t// Restore renderer settings\n\n\t\trenderer.setClearColor( this._oldClearColor, this._oldClearAlpha );\n\t\trenderer.autoClear = oldAutoClear;\n\n\t}\n\n\t// internals\n\n\t_getSeparableBlurMaterial( kernelRadius ) {\n\n\t\tconst coefficients = [];\n\n\t\tfor ( let i = 0; i < kernelRadius; i ++ ) {\n\n\t\t\tcoefficients.push( 0.39894 * Math.exp( - 0.5 * i * i / ( kernelRadius * kernelRadius ) ) / kernelRadius );\n\n\t\t}\n\n\t\treturn new ShaderMaterial( {\n\n\t\t\tdefines: {\n\t\t\t\t'KERNEL_RADIUS': kernelRadius\n\t\t\t},\n\n\t\t\tuniforms: {\n\t\t\t\t'colorTexture': { value: null },\n\t\t\t\t'invSize': { value: new Vector2( 0.5, 0.5 ) }, // inverse texture size\n\t\t\t\t'direction': { value: new Vector2( 0.5, 0.5 ) },\n\t\t\t\t'gaussianCoefficients': { value: coefficients } // precomputed Gaussian coefficients\n\t\t\t},\n\n\t\t\tvertexShader:\n\t\t\t\t`varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}`,\n\n\t\t\tfragmentShader:\n\t\t\t\t`#include <common>\n\t\t\t\tvarying vec2 vUv;\n\t\t\t\tuniform sampler2D colorTexture;\n\t\t\t\tuniform vec2 invSize;\n\t\t\t\tuniform vec2 direction;\n\t\t\t\tuniform float gaussianCoefficients[KERNEL_RADIUS];\n\n\t\t\t\tvoid main() {\n\t\t\t\t\tfloat weightSum = gaussianCoefficients[0];\n\t\t\t\t\tvec3 diffuseSum = texture2D( colorTexture, vUv ).rgb * weightSum;\n\t\t\t\t\tfor( int i = 1; i < KERNEL_RADIUS; i ++ ) {\n\t\t\t\t\t\tfloat x = float(i);\n\t\t\t\t\t\tfloat w = gaussianCoefficients[i];\n\t\t\t\t\t\tvec2 uvOffset = direction * invSize * x;\n\t\t\t\t\t\tvec3 sample1 = texture2D( colorTexture, vUv + uvOffset ).rgb;\n\t\t\t\t\t\tvec3 sample2 = texture2D( colorTexture, vUv - uvOffset ).rgb;\n\t\t\t\t\t\tdiffuseSum += (sample1 + sample2) * w;\n\t\t\t\t\t\tweightSum += 2.0 * w;\n\t\t\t\t\t}\n\t\t\t\t\tgl_FragColor = vec4(diffuseSum/weightSum, 1.0);\n\t\t\t\t}`\n\t\t} );\n\n\t}\n\n\t_getCompositeMaterial( nMips ) {\n\n\t\treturn new ShaderMaterial( {\n\n\t\t\tdefines: {\n\t\t\t\t'NUM_MIPS': nMips\n\t\t\t},\n\n\t\t\tuniforms: {\n\t\t\t\t'blurTexture1': { value: null },\n\t\t\t\t'blurTexture2': { value: null },\n\t\t\t\t'blurTexture3': { value: null },\n\t\t\t\t'blurTexture4': { value: null },\n\t\t\t\t'blurTexture5': { value: null },\n\t\t\t\t'bloomStrength': { value: 1.0 },\n\t\t\t\t'bloomFactors': { value: null },\n\t\t\t\t'bloomTintColors': { value: null },\n\t\t\t\t'bloomRadius': { value: 0.0 }\n\t\t\t},\n\n\t\t\tvertexShader:\n\t\t\t\t`varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}`,\n\n\t\t\tfragmentShader:\n\t\t\t\t`varying vec2 vUv;\n\t\t\t\tuniform sampler2D blurTexture1;\n\t\t\t\tuniform sampler2D blurTexture2;\n\t\t\t\tuniform sampler2D blurTexture3;\n\t\t\t\tuniform sampler2D blurTexture4;\n\t\t\t\tuniform sampler2D blurTexture5;\n\t\t\t\tuniform float bloomStrength;\n\t\t\t\tuniform float bloomRadius;\n\t\t\t\tuniform float bloomFactors[NUM_MIPS];\n\t\t\t\tuniform vec3 bloomTintColors[NUM_MIPS];\n\n\t\t\t\tfloat lerpBloomFactor(const in float factor) {\n\t\t\t\t\tfloat mirrorFactor = 1.2 - factor;\n\t\t\t\t\treturn mix(factor, mirrorFactor, bloomRadius);\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\t\t\t\t\tgl_FragColor = bloomStrength * ( lerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv) );\n\t\t\t\t}`\n\t\t} );\n\n\t}\n\n}\n\nUnrealBloomPass.BlurDirectionX = new Vector2( 1.0, 0.0 );\nUnrealBloomPass.BlurDirectionY = new Vector2( 0.0, 1.0 );\n\nexport { UnrealBloomPass };\n","import {\n\tVector2\n} from 'three';\n\n/** @module FXAAShader */\n\n/**\n * FXAA algorithm from NVIDIA, C# implementation by Jasper Flick, GLSL port by Dave Hoskins.\n *\n * References:\n * - {@link http://developer.download.nvidia.com/assets/gamedev/files/sdk/11/FXAA_WhitePaper.pdf}.\n * - {@link https://catlikecoding.com/unity/tutorials/advanced-rendering/fxaa/}.\n *\n * @constant\n * @type {ShaderMaterial~Shader}\n */\nconst FXAAShader = {\n\n\tname: 'FXAAShader',\n\n\tuniforms: {\n\n\t\t'tDiffuse': { value: null },\n\t\t'resolution': { value: new Vector2( 1 / 1024, 1 / 512 ) }\n\n\t},\n\n\tvertexShader: /* glsl */`\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}`,\n\n\tfragmentShader: /* glsl */`\n\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform vec2 resolution;\n\t\tvarying vec2 vUv;\n\n\t\t#define EDGE_STEP_COUNT 6\n\t\t#define EDGE_GUESS 8.0\n\t\t#define EDGE_STEPS 1.0, 1.5, 2.0, 2.0, 2.0, 4.0\n\t\tconst float edgeSteps[EDGE_STEP_COUNT] = float[EDGE_STEP_COUNT]( EDGE_STEPS );\n\n\t\tfloat _ContrastThreshold = 0.0312;\n\t\tfloat _RelativeThreshold = 0.063;\n\t\tfloat _SubpixelBlending = 1.0;\n\n\t\tvec4 Sample( sampler2D  tex2D, vec2 uv ) {\n\n\t\t\treturn texture( tex2D, uv );\n\n\t\t}\n\n\t\tfloat SampleLuminance( sampler2D tex2D, vec2 uv ) {\n\n\t\t\treturn dot( Sample( tex2D, uv ).rgb, vec3( 0.3, 0.59, 0.11 ) );\n\n\t\t}\n\n\t\tfloat SampleLuminance( sampler2D tex2D, vec2 texSize, vec2 uv, float uOffset, float vOffset ) {\n\n\t\t\tuv += texSize * vec2(uOffset, vOffset);\n\t\t\treturn SampleLuminance(tex2D, uv);\n\n\t\t}\n\n\t\tstruct LuminanceData {\n\n\t\t\tfloat m, n, e, s, w;\n\t\t\tfloat ne, nw, se, sw;\n\t\t\tfloat highest, lowest, contrast;\n\n\t\t};\n\n\t\tLuminanceData SampleLuminanceNeighborhood( sampler2D tex2D, vec2 texSize, vec2 uv ) {\n\n\t\t\tLuminanceData l;\n\t\t\tl.m = SampleLuminance( tex2D, uv );\n\t\t\tl.n = SampleLuminance( tex2D, texSize, uv,  0.0,  1.0 );\n\t\t\tl.e = SampleLuminance( tex2D, texSize, uv,  1.0,  0.0 );\n\t\t\tl.s = SampleLuminance( tex2D, texSize, uv,  0.0, -1.0 );\n\t\t\tl.w = SampleLuminance( tex2D, texSize, uv, -1.0,  0.0 );\n\n\t\t\tl.ne = SampleLuminance( tex2D, texSize, uv,  1.0,  1.0 );\n\t\t\tl.nw = SampleLuminance( tex2D, texSize, uv, -1.0,  1.0 );\n\t\t\tl.se = SampleLuminance( tex2D, texSize, uv,  1.0, -1.0 );\n\t\t\tl.sw = SampleLuminance( tex2D, texSize, uv, -1.0, -1.0 );\n\n\t\t\tl.highest = max( max( max( max( l.n, l.e ), l.s ), l.w ), l.m );\n\t\t\tl.lowest = min( min( min( min( l.n, l.e ), l.s ), l.w ), l.m );\n\t\t\tl.contrast = l.highest - l.lowest;\n\t\t\treturn l;\n\n\t\t}\n\n\t\tbool ShouldSkipPixel( LuminanceData l ) {\n\n\t\t\tfloat threshold = max( _ContrastThreshold, _RelativeThreshold * l.highest );\n\t\t\treturn l.contrast < threshold;\n\n\t\t}\n\n\t\tfloat DeterminePixelBlendFactor( LuminanceData l ) {\n\n\t\t\tfloat f = 2.0 * ( l.n + l.e + l.s + l.w );\n\t\t\tf += l.ne + l.nw + l.se + l.sw;\n\t\t\tf *= 1.0 / 12.0;\n\t\t\tf = abs( f - l.m );\n\t\t\tf = clamp( f / l.contrast, 0.0, 1.0 );\n\n\t\t\tfloat blendFactor = smoothstep( 0.0, 1.0, f );\n\t\t\treturn blendFactor * blendFactor * _SubpixelBlending;\n\n\t\t}\n\n\t\tstruct EdgeData {\n\n\t\t\tbool isHorizontal;\n\t\t\tfloat pixelStep;\n\t\t\tfloat oppositeLuminance, gradient;\n\n\t\t};\n\n\t\tEdgeData DetermineEdge( vec2 texSize, LuminanceData l ) {\n\n\t\t\tEdgeData e;\n\t\t\tfloat horizontal =\n\t\t\t\tabs( l.n + l.s - 2.0 * l.m ) * 2.0 +\n\t\t\t\tabs( l.ne + l.se - 2.0 * l.e ) +\n\t\t\t\tabs( l.nw + l.sw - 2.0 * l.w );\n\t\t\tfloat vertical =\n\t\t\t\tabs( l.e + l.w - 2.0 * l.m ) * 2.0 +\n\t\t\t\tabs( l.ne + l.nw - 2.0 * l.n ) +\n\t\t\t\tabs( l.se + l.sw - 2.0 * l.s );\n\t\t\te.isHorizontal = horizontal >= vertical;\n\n\t\t\tfloat pLuminance = e.isHorizontal ? l.n : l.e;\n\t\t\tfloat nLuminance = e.isHorizontal ? l.s : l.w;\n\t\t\tfloat pGradient = abs( pLuminance - l.m );\n\t\t\tfloat nGradient = abs( nLuminance - l.m );\n\n\t\t\te.pixelStep = e.isHorizontal ? texSize.y : texSize.x;\n\n\t\t\tif (pGradient < nGradient) {\n\n\t\t\t\te.pixelStep = -e.pixelStep;\n\t\t\t\te.oppositeLuminance = nLuminance;\n\t\t\t\te.gradient = nGradient;\n\n\t\t\t} else {\n\n\t\t\t\te.oppositeLuminance = pLuminance;\n\t\t\t\te.gradient = pGradient;\n\n\t\t\t}\n\n\t\t\treturn e;\n\n\t\t}\n\n\t\tfloat DetermineEdgeBlendFactor( sampler2D  tex2D, vec2 texSize, LuminanceData l, EdgeData e, vec2 uv ) {\n\n\t\t\tvec2 uvEdge = uv;\n\t\t\tvec2 edgeStep;\n\t\t\tif (e.isHorizontal) {\n\n\t\t\t\tuvEdge.y += e.pixelStep * 0.5;\n\t\t\t\tedgeStep = vec2( texSize.x, 0.0 );\n\n\t\t\t} else {\n\n\t\t\t\tuvEdge.x += e.pixelStep * 0.5;\n\t\t\t\tedgeStep = vec2( 0.0, texSize.y );\n\n\t\t\t}\n\n\t\t\tfloat edgeLuminance = ( l.m + e.oppositeLuminance ) * 0.5;\n\t\t\tfloat gradientThreshold = e.gradient * 0.25;\n\n\t\t\tvec2 puv = uvEdge + edgeStep * edgeSteps[0];\n\t\t\tfloat pLuminanceDelta = SampleLuminance( tex2D, puv ) - edgeLuminance;\n\t\t\tbool pAtEnd = abs( pLuminanceDelta ) >= gradientThreshold;\n\n\t\t\tfor ( int i = 1; i < EDGE_STEP_COUNT && !pAtEnd; i++ ) {\n\n\t\t\t\tpuv += edgeStep * edgeSteps[i];\n\t\t\t\tpLuminanceDelta = SampleLuminance( tex2D, puv ) - edgeLuminance;\n\t\t\t\tpAtEnd = abs( pLuminanceDelta ) >= gradientThreshold;\n\n\t\t\t}\n\n\t\t\tif ( !pAtEnd ) {\n\n\t\t\t\tpuv += edgeStep * EDGE_GUESS;\n\n\t\t\t}\n\n\t\t\tvec2 nuv = uvEdge - edgeStep * edgeSteps[0];\n\t\t\tfloat nLuminanceDelta = SampleLuminance( tex2D, nuv ) - edgeLuminance;\n\t\t\tbool nAtEnd = abs( nLuminanceDelta ) >= gradientThreshold;\n\n\t\t\tfor ( int i = 1; i < EDGE_STEP_COUNT && !nAtEnd; i++ ) {\n\n\t\t\t\tnuv -= edgeStep * edgeSteps[i];\n\t\t\t\tnLuminanceDelta = SampleLuminance( tex2D, nuv ) - edgeLuminance;\n\t\t\t\tnAtEnd = abs( nLuminanceDelta ) >= gradientThreshold;\n\n\t\t\t}\n\n\t\t\tif ( !nAtEnd ) {\n\n\t\t\t\tnuv -= edgeStep * EDGE_GUESS;\n\n\t\t\t}\n\n\t\t\tfloat pDistance, nDistance;\n\t\t\tif ( e.isHorizontal ) {\n\n\t\t\t\tpDistance = puv.x - uv.x;\n\t\t\t\tnDistance = uv.x - nuv.x;\n\n\t\t\t} else {\n\n\t\t\t\tpDistance = puv.y - uv.y;\n\t\t\t\tnDistance = uv.y - nuv.y;\n\n\t\t\t}\n\n\t\t\tfloat shortestDistance;\n\t\t\tbool deltaSign;\n\t\t\tif ( pDistance <= nDistance ) {\n\n\t\t\t\tshortestDistance = pDistance;\n\t\t\t\tdeltaSign = pLuminanceDelta >= 0.0;\n\n\t\t\t} else {\n\n\t\t\t\tshortestDistance = nDistance;\n\t\t\t\tdeltaSign = nLuminanceDelta >= 0.0;\n\n\t\t\t}\n\n\t\t\tif ( deltaSign == ( l.m - edgeLuminance >= 0.0 ) ) {\n\n\t\t\t\treturn 0.0;\n\n\t\t\t}\n\n\t\t\treturn 0.5 - shortestDistance / ( pDistance + nDistance );\n\n\t\t}\n\n\t\tvec4 ApplyFXAA( sampler2D  tex2D, vec2 texSize, vec2 uv ) {\n\n\t\t\tLuminanceData luminance = SampleLuminanceNeighborhood( tex2D, texSize, uv );\n\t\t\tif ( ShouldSkipPixel( luminance ) ) {\n\n\t\t\t\treturn Sample( tex2D, uv );\n\n\t\t\t}\n\n\t\t\tfloat pixelBlend = DeterminePixelBlendFactor( luminance );\n\t\t\tEdgeData edge = DetermineEdge( texSize, luminance );\n\t\t\tfloat edgeBlend = DetermineEdgeBlendFactor( tex2D, texSize, luminance, edge, uv );\n\t\t\tfloat finalBlend = max( pixelBlend, edgeBlend );\n\n\t\t\tif (edge.isHorizontal) {\n\n\t\t\t\tuv.y += edge.pixelStep * finalBlend;\n\n\t\t\t} else {\n\n\t\t\t\tuv.x += edge.pixelStep * finalBlend;\n\n\t\t\t}\n\n\t\t\treturn Sample( tex2D, uv );\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tgl_FragColor = ApplyFXAA( tDiffuse, resolution.xy, vUv );\n\n\t\t}`\n\n};\n\nexport { FXAAShader };\n","import {\n\tVector3\n} from 'three';\n\n/** @module ColorCorrectionShader */\n\n/**\n * Color correction shader.\n *\n * @constant\n * @type {ShaderMaterial~Shader}\n */\nconst ColorCorrectionShader = {\n\n\tname: 'ColorCorrectionShader',\n\n\tuniforms: {\n\n\t\t'tDiffuse': { value: null },\n\t\t'powRGB': { value: new Vector3( 2, 2, 2 ) },\n\t\t'mulRGB': { value: new Vector3( 1, 1, 1 ) },\n\t\t'addRGB': { value: new Vector3( 0, 0, 0 ) }\n\n\t},\n\n\tvertexShader: /* glsl */`\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}`,\n\n\tfragmentShader: /* glsl */`\n\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform vec3 powRGB;\n\t\tuniform vec3 mulRGB;\n\t\tuniform vec3 addRGB;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tgl_FragColor = texture2D( tDiffuse, vUv );\n\t\t\tgl_FragColor.rgb = mulRGB * pow( ( gl_FragColor.rgb + addRGB ), powRGB );\n\n\t\t}`\n\n};\n\nexport { ColorCorrectionShader };\n","/** @module FilmShader */\n\n/**\n * TODO\n *\n * Used by {@link FilmPass}.\n *\n * @constant\n * @type {ShaderMaterial~Shader}\n */\nconst FilmShader = {\n\n\tname: 'FilmShader',\n\n\tuniforms: {\n\n\t\t'tDiffuse': { value: null },\n\t\t'time': { value: 0.0 },\n\t\t'intensity': { value: 0.5 },\n\t\t'grayscale': { value: false }\n\n\t},\n\n\tvertexShader: /* glsl */`\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}`,\n\n\tfragmentShader: /* glsl */`\n\n\t\t#include <common>\n\n\t\tuniform float intensity;\n\t\tuniform bool grayscale;\n\t\tuniform float time;\n\n\t\tuniform sampler2D tDiffuse;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 base = texture2D( tDiffuse, vUv );\n\n\t\t\tfloat noise = rand( fract( vUv + time ) );\n\n\t\t\tvec3 color = base.rgb + base.rgb * clamp( 0.1 + noise, 0.0, 1.0 );\n\n\t\t\tcolor = mix( base.rgb, color, intensity );\n\n\t\t\tif ( grayscale ) {\n\n\t\t\t\tcolor = vec3( luminance( color ) ); // assuming linear-srgb\n\n\t\t\t}\n\n\t\t\tgl_FragColor = vec4( color, base.a );\n\n\t\t}`,\n\n};\n\nexport { FilmShader };\n","/** @module VignetteShader */\n\n/**\n * Based on [PaintEffect postprocess from ro.me]{@link http://code.google.com/p/3-dreams-of-black/source/browse/deploy/js/effects/PaintEffect.js}.\n *\n * @constant\n * @type {ShaderMaterial~Shader}\n */\nconst VignetteShader = {\n\n\tname: 'VignetteShader',\n\n\tuniforms: {\n\n\t\t'tDiffuse': { value: null },\n\t\t'offset': { value: 1.0 },\n\t\t'darkness': { value: 1.0 }\n\n\t},\n\n\tvertexShader: /* glsl */`\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}`,\n\n\tfragmentShader: /* glsl */`\n\n\t\tuniform float offset;\n\t\tuniform float darkness;\n\n\t\tuniform sampler2D tDiffuse;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\t// Eskil's vignette\n\n\t\t\tvec4 texel = texture2D( tDiffuse, vUv );\n\t\t\tvec2 uv = ( vUv - vec2( 0.5 ) ) * vec2( offset );\n\t\t\tgl_FragColor = vec4( mix( texel.rgb, vec3( 1.0 - darkness ), dot( uv, uv ) ), texel.a );\n\n\t\t}`\n\n};\n\nexport { VignetteShader };\n","/**\n * A utility module with basic WebGL 2 capability testing.\n *\n * @hideconstructor\n */\nclass WebGL {\n\n\t/**\n\t * Returns `true` if WebGL 2 is available.\n\t *\n\t * @return {boolean} Whether WebGL 2 is available or not.\n\t */\n\tstatic isWebGL2Available() {\n\n\t\ttry {\n\n\t\t\tconst canvas = document.createElement( 'canvas' );\n\t\t\treturn !! ( window.WebGL2RenderingContext && canvas.getContext( 'webgl2' ) );\n\n\t\t} catch ( e ) {\n\n\t\t\treturn false;\n\n\t\t}\n\n\t}\n\n\t/**\n\t * Returns `true` if the given color space is available. This method can only be used\n\t * if WebGL 2 is supported.\n\t *\n\t * @param {string} colorSpace - The color space to test.\n\t * @return {boolean} Whether the given color space is available or not.\n\t */\n\tstatic isColorSpaceAvailable( colorSpace ) {\n\n\t\ttry {\n\n\t\t\tconst canvas = document.createElement( 'canvas' );\n\t\t\tconst ctx = window.WebGL2RenderingContext && canvas.getContext( 'webgl2' );\n\t\t\tctx.drawingBufferColorSpace = colorSpace;\n\t\t\treturn ctx.drawingBufferColorSpace === colorSpace; // deepscan-disable-line SAME_OPERAND_VALUE\n\n\t\t} catch ( e ) {\n\n\t\t\treturn false;\n\n\t\t}\n\n\t}\n\n\t/**\n\t * Returns a `div` element representing a formatted error message that can be appended in\n\t * web sites if WebGL 2 isn't supported.\n\t *\n\t * @return {HTMLDivElement} A `div` element representing a formatted error message that WebGL 2 isn't supported.\n\t */\n\tstatic getWebGL2ErrorMessage() {\n\n\t\treturn this._getErrorMessage( 2 );\n\n\t}\n\n\t// private\n\n\tstatic _getErrorMessage( version ) {\n\n\t\tconst names = {\n\t\t\t1: 'WebGL',\n\t\t\t2: 'WebGL 2'\n\t\t};\n\n\t\tconst contexts = {\n\t\t\t1: window.WebGLRenderingContext,\n\t\t\t2: window.WebGL2RenderingContext\n\t\t};\n\n\t\tlet message = 'Your $0 does not seem to support <a href=\"http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation\" style=\"color:#000\">$1</a>';\n\n\t\tconst element = document.createElement( 'div' );\n\t\telement.id = 'webglmessage';\n\t\telement.style.fontFamily = 'monospace';\n\t\telement.style.fontSize = '13px';\n\t\telement.style.fontWeight = 'normal';\n\t\telement.style.textAlign = 'center';\n\t\telement.style.background = '#fff';\n\t\telement.style.color = '#000';\n\t\telement.style.padding = '1.5em';\n\t\telement.style.width = '400px';\n\t\telement.style.margin = '5em auto 0';\n\n\t\tif ( contexts[ version ] ) {\n\n\t\t\tmessage = message.replace( '$0', 'graphics card' );\n\n\t\t} else {\n\n\t\t\tmessage = message.replace( '$0', 'browser' );\n\n\t\t}\n\n\t\tmessage = message.replace( '$1', names[ version ] );\n\n\t\telement.innerHTML = message;\n\n\t\treturn element;\n\n\t}\n\n\t// @deprecated, r168\n\n\tstatic isWebGLAvailable() {\n\n\t\tconsole.warn( 'isWebGLAvailable() has been deprecated and will be removed in r178. Use isWebGL2Available() instead.' );\n\n\t\ttry {\n\n\t\t\tconst canvas = document.createElement( 'canvas' );\n\t\t\treturn !! ( window.WebGLRenderingContext && ( canvas.getContext( 'webgl' ) || canvas.getContext( 'experimental-webgl' ) ) );\n\n\t\t} catch ( e ) {\n\n\t\t\treturn false;\n\n\t\t}\n\n\t}\n\n\tstatic getWebGLErrorMessage() {\n\n\t\tconsole.warn( 'getWebGLErrorMessage() has been deprecated and will be removed in r178. Use getWebGL2ErrorMessage() instead.' );\n\n\t\treturn this._getErrorMessage( 1 );\n\n\t}\n\n}\n\nexport default WebGL;\n","/**\r\n * Entity Class - Base entity class for ECS architecture\r\n * \r\n * The core building block of the Entity-Component-System pattern.\r\n * Each entity is essentially just an ID with a collection of components\r\n * that define its behavior and properties.\r\n */\r\n\r\nexport class Entity {\r\n    constructor(id, world) {\r\n        this.id = id;\r\n        this.world = world;\r\n        this.components = new Map();\r\n        this.tags = new Set();\r\n        \r\n        // Cache flags for commonly checked tags (initialize as undefined)\r\n        this._isEnemy = undefined;\r\n        this._isPlayer = undefined;\r\n        this._isProjectile = undefined;\r\n        this._isPooled = undefined;\r\n    }\r\n    \r\n    /**\r\n     * Add a component to this entity\r\n     * @param {Component} component The component to add\r\n     * @returns {Entity} This entity for chaining\r\n     */\r\n    addComponent(component) {\r\n        component.entity = this;\r\n        this.components.set(component.constructor.name, component);\r\n        \r\n        // Call onAttached\r\n        if (component.onAttached) {\r\n            component.onAttached();\r\n        }\r\n        \r\n        // Notify the world that a component was added\r\n        if (this.world && this.world.messageBus) {\r\n            this.world.messageBus.publish('component.added', {\r\n                entity: this,\r\n                componentType: component.constructor.name,\r\n                component: component\r\n            });\r\n        }\r\n        \r\n        return this;\r\n    }\r\n    \r\n    /**\r\n     * Remove a component from this entity\r\n     * @param {Function|string} componentType The component class or name to remove\r\n     * @returns {Entity} This entity for chaining\r\n     */\r\n    removeComponent(componentType) {\r\n        const component = this.getComponent(componentType);\r\n        if (component) {\r\n            if (component.onDetached) {\r\n                component.onDetached();\r\n            }\r\n            component.entity = null;\r\n            \r\n            // Get the component type name - handle both string and class inputs\r\n            const componentTypeName = typeof componentType === 'string' \r\n                ? componentType \r\n                : componentType.name;\r\n            this.components.delete(componentTypeName);\r\n            \r\n            // Notify the world that a component was removed\r\n            if (this.world && this.world.messageBus) {\r\n                this.world.messageBus.publish('component.removed', {\r\n                    entity: this,\r\n                    componentType: componentTypeName,\r\n                    component: component\r\n                });\r\n            }\r\n        }\r\n        return this;\r\n    }\r\n    \r\n    /**\r\n     * Get a component of the specified type\r\n     * @param {Function|string} componentType The component class or name to get\r\n     * @returns {Component|null} The component or null if not found\r\n     */\r\n    getComponent(componentType) {\r\n        if (typeof componentType === 'string') {\r\n            return this.components.get(componentType);\r\n        }\r\n        return this.components.get(componentType.name);\r\n    }\r\n    \r\n    /**\r\n     * Check if this entity has a component of the specified type\r\n     * @param {Function|string} componentType The component class or name to check for\r\n     * @returns {boolean} True if the entity has the component\r\n     */\r\n    hasComponent(componentType) {\r\n        if (typeof componentType === 'string') {\r\n            return this.components.has(componentType);\r\n        }\r\n        return this.components.has(componentType.name);\r\n    }\r\n    \r\n    /**\r\n     * Sync internal tag cache with actual tags\r\n     * @private\r\n     */\r\n    _syncTagCache() {\r\n        // Reset all cached flags to match actual tag state\r\n        this._isEnemy = this.tags.has('enemy');\r\n        this._isPlayer = this.tags.has('player');\r\n        this._isProjectile = this.tags.has('projectile');\r\n        this._isPooled = this.tags.has('pooled');\r\n    }\r\n    \r\n    /**\r\n     * Add a tag to this entity\r\n     * @param {string} tag The tag to add\r\n     * @returns {Entity} This entity for chaining\r\n     */\r\n    addTag(tag) {\r\n        if (!this.tags.has(tag)) {\r\n            // Add tag to local Set\r\n            this.tags.add(tag);\r\n            \r\n            // Update cached flags immediately\r\n            if (tag === 'enemy') this._isEnemy = true;\r\n            else if (tag === 'player') this._isPlayer = true;\r\n            else if (tag === 'projectile') this._isProjectile = true;\r\n            else if (tag === 'pooled') this._isPooled = true;\r\n            \r\n            // Update the entity manager's tag index\r\n            if (this.world && this.world.entityManager) {\r\n                this.world.entityManager.onTagAdded(this, tag);\r\n                \r\n                // Verify tag was added to tag index map\r\n                if (!this.world.entityManager.entitiesByTag.has(tag) || \r\n                    !this.world.entityManager.entitiesByTag.get(tag).includes(this)) {\r\n                    // Force add entity to tag map as fallback\r\n                    if (!this.world.entityManager.entitiesByTag.has(tag)) {\r\n                        this.world.entityManager.entitiesByTag.set(tag, []);\r\n                    }\r\n                    this.world.entityManager.entitiesByTag.get(tag).push(this);\r\n                }\r\n            }\r\n        }\r\n        return this;\r\n    }\r\n    \r\n    /**\r\n     * Remove a tag from this entity\r\n     * @param {string} tag The tag to remove\r\n     * @returns {Entity} This entity for chaining\r\n     */\r\n    removeTag(tag) {\r\n        if (this.tags.has(tag)) {\r\n            // Remove tag from local Set\r\n            this.tags.delete(tag);\r\n            \r\n            // Update cached flags immediately\r\n            if (tag === 'enemy') this._isEnemy = false;\r\n            else if (tag === 'player') this._isPlayer = false;\r\n            else if (tag === 'projectile') this._isProjectile = false;\r\n            else if (tag === 'pooled') this._isPooled = false;\r\n            \r\n            // Update the entity manager's tag index\r\n            if (this.world && this.world.entityManager) {\r\n                this.world.entityManager.onTagRemoved(this, tag);\r\n            }\r\n        }\r\n        return this;\r\n    }\r\n    \r\n    /**\r\n     * Clear all tags from this entity\r\n     * @returns {Entity} This entity for chaining\r\n     */\r\n    clearTags() {\r\n        // Make a copy of the tags to iterate over\r\n        const allTags = [...this.tags];\r\n        \r\n        // Remove each tag properly\r\n        for (const tag of allTags) {\r\n            this.removeTag(tag);\r\n        }\r\n        \r\n        // Reset ALL tag caches to ensure consistency\r\n        this._isEnemy = false;\r\n        this._isPlayer = false;\r\n        this._isProjectile = false;\r\n        this._isPooled = false;\r\n        \r\n        // Verify the local Set is empty\r\n        this.tags.clear();\r\n        \r\n        return this;\r\n    }\r\n    \r\n    /**\r\n     * Check if this entity has the specified tag\r\n     * @param {string} tag The tag to check for\r\n     * @returns {boolean} True if the entity has the tag\r\n     */\r\n    hasTag(tag) {\r\n        // Use direct Set lookup instead of potentially stale cached values\r\n        const hasTag = this.tags.has(tag);\r\n        \r\n        // Check for inconsistency between cache and actual tags\r\n        // This helps detect and fix cache issues\r\n        let cacheInconsistent = false;\r\n        \r\n        if (tag === 'enemy' && this._isEnemy !== hasTag) {\r\n            this._isEnemy = hasTag; // Fix the cache\r\n            cacheInconsistent = true;\r\n        } \r\n        else if (tag === 'player' && this._isPlayer !== hasTag) {\r\n            this._isPlayer = hasTag; // Fix the cache\r\n            cacheInconsistent = true;\r\n        } \r\n        else if (tag === 'projectile' && this._isProjectile !== hasTag) {\r\n            this._isProjectile = hasTag; // Fix the cache\r\n            cacheInconsistent = true;\r\n        }\r\n        else if (tag === 'pooled' && this._isPooled !== hasTag) {\r\n            this._isPooled = hasTag; // Fix the cache\r\n            cacheInconsistent = true;\r\n        }\r\n        \r\n        // If we detected an inconsistency, sync the entire cache\r\n        if (cacheInconsistent) {\r\n            this._syncTagCache();\r\n        }\r\n        \r\n        return hasTag;\r\n    }\r\n}","/**\r\n * EntityManager - Manages entity creation, tracking and destruction\r\n * \r\n * Handles entity lifecycle and provides methods to query entities\r\n * based on components or tags.\r\n */\r\n\r\nimport { Entity } from './entity.js';\r\n\r\nexport class EntityManager {\r\n    constructor(world) {\r\n        this.world = world;\r\n        this.entities = new Map();\r\n        // Use WeakMap for entity tracking to allow garbage collection\r\n        this.entitiesByComponent = new Map();\r\n        this.entitiesByTag = new Map();\r\n        this.lastEntityId = 0;\r\n        \r\n        // Entity recycle pool for faster instantiation\r\n        this.recycledEntities = [];\r\n        this.maxRecycledEntities = 100;\r\n    }\r\n    \r\n    /**\r\n     * Create a new entity\r\n     * @param {string} name Optional name for the entity\r\n     * @returns {Entity} The created entity\r\n     */\r\n    createEntity(name = '') {\r\n        // Try to reuse a recycled entity first\r\n        let entity;\r\n        \r\n        if (this.recycledEntities.length > 0) {\r\n            entity = this.recycledEntities.pop();\r\n            entity.components.clear();\r\n            entity.tags.clear();\r\n            entity._isEnemy = undefined;\r\n            entity._isPlayer = undefined;\r\n            entity._isProjectile = undefined;\r\n        } else {\r\n            const id = this._generateEntityId();\r\n            entity = new Entity(id, this.world);\r\n        }\r\n        \r\n        // Add to entities map first\r\n        this.entities.set(entity.id.toString(), entity);\r\n        \r\n        // Add name as tag using the fixed addTag method which will register with entityManager\r\n        if (name) {\r\n            entity.addTag(name);\r\n        }\r\n        \r\n        // Notify systems that an entity was created\r\n        this.world.messageBus.publish('entity.created', { entity });\r\n        \r\n        return entity;\r\n    }\r\n    \r\n    /**\r\n     * Destroy an entity and remove all its components\r\n     * @param {Entity|string} entityOrId The entity or entity ID to destroy\r\n     */\r\n    destroyEntity(entityOrId) {\r\n        const id = typeof entityOrId === 'string' ? entityOrId : entityOrId.id;\r\n        const entity = this.entities.get(id.toString());\r\n        \r\n        if (!entity) return;\r\n        \r\n        // Notify systems that this entity will be destroyed\r\n        this.world.messageBus.publish('entity.destroyed', { entity });\r\n        \r\n        // Remove from tag maps\r\n        entity.tags.forEach(tag => {\r\n            if (this.entitiesByTag.has(tag)) {\r\n                const entities = this.entitiesByTag.get(tag);\r\n                const index = entities.indexOf(entity);\r\n                if (index !== -1) {\r\n                    entities.splice(index, 1);\r\n                }\r\n                \r\n                if (entities.length === 0) {\r\n                    this.entitiesByTag.delete(tag);\r\n                }\r\n            }\r\n        });\r\n        \r\n        // Remove all components\r\n        for (const [componentType, component] of entity.components.entries()) {\r\n            entity.removeComponent(component.constructor);\r\n        }\r\n        \r\n        // Remove from entities map\r\n        this.entities.delete(id.toString());\r\n        \r\n        // Add to recycled entities pool if not full\r\n        if (this.recycledEntities.length < this.maxRecycledEntities) {\r\n            this.recycledEntities.push(entity);\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Get an entity by ID\r\n     * @param {string} id The entity ID\r\n     * @returns {Entity|undefined} The entity or undefined if not found\r\n     */\r\n    getEntity(id) {\r\n        return this.entities.get(id.toString());\r\n    }\r\n    \r\n    /**\r\n     * Get all entities with the specified tag\r\n     * @param {string} tag The tag to filter by\r\n     * @returns {Entity[]} Array of entities with the tag\r\n     */\r\n    getEntitiesByTag(tag) {\r\n        return this.entitiesByTag.get(tag) || [];\r\n    }\r\n    \r\n    /**\r\n     * Get all entities that have all the specified components\r\n     * @param {Function[]} componentTypes Array of component types\r\n     * @returns {Entity[]} Array of entities with all components\r\n     */\r\n    getEntitiesWithComponents(componentTypes) {\r\n        if (!componentTypes || componentTypes.length === 0) {\r\n            return Array.from(this.entities.values());\r\n        }\r\n        \r\n        return Array.from(this.entities.values()).filter(entity => {\r\n            return componentTypes.every(type => entity.hasComponent(type));\r\n        });\r\n    }\r\n    \r\n    /**\r\n     * Get all entities in the manager\r\n     * @returns {Entity[]} Array of all entities\r\n     */\r\n    getEntities() {\r\n        return Array.from(this.entities.values());\r\n    }\r\n    \r\n    /**\r\n     * Update entity tag index when a tag is added\r\n     * @param {Entity} entity The entity\r\n     * @param {string} tag The tag\r\n     */\r\n    onTagAdded(entity, tag) {\r\n        if (!this.entitiesByTag.has(tag)) {\r\n            this.entitiesByTag.set(tag, []);\r\n        }\r\n        \r\n        this.entitiesByTag.get(tag).push(entity);\r\n    }\r\n    \r\n    /**\r\n     * Update entity tag index when a tag is removed\r\n     * @param {Entity} entity The entity\r\n     * @param {string} tag The tag\r\n     */\r\n    onTagRemoved(entity, tag) {\r\n        if (this.entitiesByTag.has(tag)) {\r\n            const entities = this.entitiesByTag.get(tag);\r\n            const index = entities.indexOf(entity);\r\n            \r\n            if (index !== -1) {\r\n                entities.splice(index, 1);\r\n            }\r\n            \r\n            if (entities.length === 0) {\r\n                this.entitiesByTag.delete(tag);\r\n            }\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Generate a unique entity ID\r\n     * @returns {string} A unique entity ID\r\n     * @private\r\n     */\r\n    _generateEntityId() {\r\n        return (++this.lastEntityId).toString();\r\n    }\r\n}","/**\r\n * SystemManager - Manages the registration and execution of systems\r\n * \r\n * Handles system priority, updates, and lifecycle.\r\n */\r\n\r\nexport class SystemManager {\r\n    constructor(world) {\r\n        this.world = world;\r\n        this.systems = [];\r\n        this.systemsByType = new Map();\r\n    // perf timings bucket\r\n    if (!window.__perf) window.__perf = { systems: {} };\r\n    this._tick = 0;\r\n    }\r\n    \r\n    /**\r\n     * Register a system with the manager\r\n     * @param {System} system The system to register\r\n     * @returns {System} The registered system\r\n     */\r\n    registerSystem(system) {\r\n        if (this.systemsByType.has(system.constructor.name)) {\r\n            console.warn(`System of type ${system.constructor.name} already registered`);\r\n            return system;\r\n        }\r\n        \r\n        this.systems.push(system);\r\n        this.systemsByType.set(system.constructor.name, system);\r\n        \r\n        // Sort systems by priority (lower = earlier)\r\n        this.systems.sort((a, b) => a.priority - b.priority);\r\n        \r\n        return system;\r\n    }\r\n    \r\n    /**\r\n     * Get a system by type\r\n     * @param {Function} systemType The system class type\r\n     * @returns {System|undefined} The system instance or undefined if not found\r\n     */\r\n    getSystem(systemType) {\r\n        return this.systemsByType.get(systemType.name);\r\n    }\r\n    \r\n    /**\r\n     * Update all enabled systems\r\n     * @param {number} deltaTime Time since last update in seconds\r\n     */\r\n    update(deltaTime) {\r\n    this._tick = (this._tick + 1) >>> 0;\r\n    for (const system of this.systems) {\r\n      if (!system.enabled) continue;\r\n      // Stagger heavy systems every 2 ticks (example heuristic)\r\n      const name = system.constructor.name;\r\n      const isHeavy = name === 'EnemySystem' || name === 'CollisionSystem' || name === 'TargetingSystem';\r\n      if (isHeavy && (this._tick & 1) === 1) {\r\n        continue;\r\n      }\r\n      const t0 = performance.now();\r\n      system.update(deltaTime);\r\n      const t1 = performance.now();\r\n      if (window.__perf) {\r\n        if (!window.__perf.systems) window.__perf.systems = {};\r\n        window.__perf.systems[name] = Number(t1 - t0);\r\n      }\r\n    }\r\n    }\r\n    \r\n    /**\r\n     * Initialize all systems\r\n     * Called once before the first update\r\n     */\r\n    initialize() {\r\n        for (const system of this.systems) {\r\n            if (typeof system.initialize === 'function') {\r\n                system.initialize();\r\n            }\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Enable a system by type\r\n     * @param {Function} systemType The system class type\r\n     */\r\n    enableSystem(systemType) {\r\n        const system = this.getSystem(systemType);\r\n        if (system) {\r\n            system.enable();\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Disable a system by type\r\n     * @param {Function} systemType The system class type\r\n     */\r\n    disableSystem(systemType) {\r\n        const system = this.getSystem(systemType);\r\n        if (system) {\r\n            system.disable();\r\n        }\r\n    }\r\n}","// SpatialHash.js - simple 3D spatial hash grid for proximity queries\r\n\r\nexport class SpatialHash {\r\n  constructor(cellSize = 200) {\r\n    this.cellSize = cellSize;\r\n    this.map = new Map(); // key -> Set(entityId)\r\n    this.entityToCells = new Map(); // entityId -> array of keys\r\n  }\r\n\r\n  _key(ix, iy, iz) { return `${ix}|${iy}|${iz}`; }\r\n  _cellIndex(v) { return Math.floor(v / this.cellSize) | 0; }\r\n\r\n  _computeKeysForAABB(min, max) {\r\n    const ix0 = this._cellIndex(min.x), iy0 = this._cellIndex(min.y), iz0 = this._cellIndex(min.z);\r\n    const ix1 = this._cellIndex(max.x), iy1 = this._cellIndex(max.y), iz1 = this._cellIndex(max.z);\r\n    const keys = [];\r\n    for (let ix = ix0; ix <= ix1; ix++)\r\n      for (let iy = iy0; iy <= iy1; iy++)\r\n        for (let iz = iz0; iz <= iz1; iz++)\r\n          keys.push(this._key(ix, iy, iz));\r\n    return keys;\r\n  }\r\n\r\n  insert(entityId, position, radius = 1) {\r\n    const min = { x: position.x - radius, y: position.y - radius, z: position.z - radius };\r\n    const max = { x: position.x + radius, y: position.y + radius, z: position.z + radius };\r\n    const keys = this._computeKeysForAABB(min, max);\r\n    this.entityToCells.set(entityId, keys);\r\n    for (const k of keys) {\r\n      let set = this.map.get(k);\r\n      if (!set) { set = new Set(); this.map.set(k, set); }\r\n      set.add(entityId);\r\n    }\r\n  }\r\n\r\n  update(entityId, position, radius = 1) {\r\n    this.remove(entityId);\r\n    this.insert(entityId, position, radius);\r\n  }\r\n\r\n  remove(entityId) {\r\n    const keys = this.entityToCells.get(entityId);\r\n    if (!keys) return;\r\n    for (const k of keys) {\r\n      const set = this.map.get(k);\r\n      if (set) {\r\n        set.delete(entityId);\r\n        if (set.size === 0) this.map.delete(k);\r\n      }\r\n    }\r\n    this.entityToCells.delete(entityId);\r\n  }\r\n\r\n  querySphere(center, radius) {\r\n    const min = { x: center.x - radius, y: center.y - radius, z: center.z - radius };\r\n    const max = { x: center.x + radius, y: center.y + radius, z: center.z + radius };\r\n    const keys = this._computeKeysForAABB(min, max);\r\n    const result = new Set();\r\n    for (const k of keys) {\r\n      const set = this.map.get(k);\r\n      if (set) for (const id of set) result.add(id);\r\n    }\r\n    return Array.from(result);\r\n  }\r\n}\r\n\r\n\r\n","// EntityIndex.js - track entity lookups and mesh/instance mapping\r\n\r\nexport class EntityIndex {\r\n  constructor() {\r\n    this.entityToView = new Map(); // entityId -> { meshRef, instanceKey, instanceId }\r\n    this.tagToEntities = new Map(); // tag -> Set(entityId)\r\n  }\r\n\r\n  setView(entityId, view) {\r\n    this.entityToView.set(entityId, view);\r\n  }\r\n  getView(entityId) { return this.entityToView.get(entityId); }\r\n  clearView(entityId) { this.entityToView.delete(entityId); }\r\n\r\n  addTag(entityId, tag) {\r\n    let set = this.tagToEntities.get(tag);\r\n    if (!set) { set = new Set(); this.tagToEntities.set(tag, set); }\r\n    set.add(entityId);\r\n  }\r\n  removeTag(entityId, tag) {\r\n    const set = this.tagToEntities.get(tag);\r\n    if (set) { set.delete(entityId); if (set.size === 0) this.tagToEntities.delete(tag); }\r\n  }\r\n  getByTag(tag) {\r\n    const set = this.tagToEntities.get(tag);\r\n    return set ? Array.from(set) : [];\r\n  }\r\n}\r\n\r\n\r\n","/**\r\n * World - Main container class for the ECS architecture\r\n * \r\n * The World manages the entire ECS setup, including entities,\r\n * components, systems, and messaging.\r\n */\r\n\r\nimport { EntityManager } from './entityManager.js';\r\nimport { SystemManager } from './systemManager.js';\r\nimport { MessageBus } from './messageBus.js';\r\nimport { SpatialHash } from './spatial/SpatialHash.js';\r\nimport { EntityIndex } from './EntityIndex.js';\r\n\r\nexport class World {\r\n    constructor(messageBus = null) {\r\n        // Use provided message bus or create a new one\r\n        // This allows sharing the message bus between World and Game\r\n        this.messageBus = messageBus || new MessageBus();\r\n        \r\n        // If we created a new message bus, make it accessible globally\r\n        if (!messageBus && !window.mainMessageBus) {\r\n            window.mainMessageBus = this.messageBus;\r\n        }\r\n        \r\n        // Create managers\r\n        this.entityManager = new EntityManager(this);\r\n        this.systemManager = new SystemManager(this);\r\n        this.spatial = new SpatialHash(400); // cell size tuned later\r\n        this.index = new EntityIndex();\r\n        \r\n        // Time tracking\r\n        this.deltaTime = 0;\r\n        this.time = 0;\r\n        this.lastUpdateTime = 0;\r\n    }\r\n    \r\n    /**\r\n     * Initialize the world and all systems\r\n     */\r\n    initialize() {\r\n        this.lastUpdateTime = performance.now();\r\n        this.systemManager.initialize();\r\n        this.messageBus.publish('world.initialized', {});\r\n    }\r\n\r\n    // Hook for systems to notify when entity moved\r\n    onEntityTransformUpdated(entity) {\r\n        const t = entity.getComponent && entity.getComponent('TransformComponent');\r\n        if (t) this.spatial.update(entity.id, t.position, entity.collisionRadius || 1);\r\n    }\r\n    \r\n    /**\r\n     * Update all systems\r\n     */\r\n    update() {\r\n        // Calculate delta time\r\n        const now = performance.now();\r\n        this.deltaTime = Math.min((now - this.lastUpdateTime) / 1000, 0.1); // Cap at 100ms\r\n        this.lastUpdateTime = now;\r\n        this.time += this.deltaTime;\r\n        \r\n        // Publish pre-update message\r\n        this.messageBus.publish('world.preUpdate', { deltaTime: this.deltaTime, time: this.time });\r\n        \r\n        // Update all systems\r\n        this.systemManager.update(this.deltaTime);\r\n        \r\n        // Publish post-update message\r\n        this.messageBus.publish('world.postUpdate', { deltaTime: this.deltaTime, time: this.time });\r\n        \r\n        // For debugging - log active entities in dev console\r\n        if (window.DEBUG_MODE && this.time % 5 < this.deltaTime) {\r\n            // Get all entities from entity manager using values from the map\r\n            const entities = Array.from(this.entityManager.entities.values());\r\n            const entitiesWithMesh = this.getEntitiesWithComponents(['MeshComponent']);\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Create a new entity\r\n     * @param {string} name Optional name for the entity\r\n     * @returns {Entity} The created entity\r\n     */\r\n    createEntity(name = '') {\r\n        return this.entityManager.createEntity(name);\r\n    }\r\n    \r\n    /**\r\n     * Destroy an entity\r\n     * @param {Entity|string} entityOrId The entity or entity ID to destroy\r\n     */\r\n    destroyEntity(entityOrId) {\r\n        this.entityManager.destroyEntity(entityOrId);\r\n    }\r\n    \r\n    /**\r\n     * Register a system\r\n     * @param {System} system The system to register\r\n     * @returns {System} The registered system\r\n     */\r\n    registerSystem(system) {\r\n        return this.systemManager.registerSystem(system);\r\n    }\r\n    \r\n    /**\r\n     * Get entities with specific components\r\n     * @param {Function[]} componentTypes Array of component types\r\n     * @returns {Entity[]} Array of entities with all components\r\n     */\r\n    getEntitiesWithComponents(componentTypes) {\r\n        return this.entityManager.getEntitiesWithComponents(componentTypes);\r\n    }\r\n    \r\n    /**\r\n     * Get entities with a specific tag\r\n     * @param {string} tag The tag to filter by\r\n     * @returns {Entity[]} Array of entities with the tag\r\n     */\r\n    getEntitiesByTag(tag) {\r\n        return this.entityManager.getEntitiesByTag(tag);\r\n    }\r\n    \r\n    /**\r\n     * Get a specific entity by ID\r\n     * @param {string} id The entity ID\r\n     * @returns {Entity|undefined} The entity or undefined if not found\r\n     */\r\n    getEntity(id) {\r\n        return this.entityManager.getEntity(id);\r\n    }\r\n    \r\n    /**\r\n     * Get a system by type\r\n     * @param {Function} systemType The system class type\r\n     * @returns {System|undefined} The system instance or undefined if not found\r\n     */\r\n    getSystem(systemType) {\r\n        return this.systemManager.getSystem(systemType);\r\n    }\r\n}","/**\r\n * World Setup Module - Handles ECS World construction and scene setup\r\n * \r\n * This module contains all the logic for creating and initializing the ECS world,\r\n * including the player reference entity and basic world configuration.\r\n */\r\n\r\nimport { World } from '../../core/world.js';\r\nimport * as THREE from 'three';\r\n\r\nexport class WorldSetup {\r\n    constructor() {\r\n        this.world = null;\r\n        this.playerEntity = null;\r\n        this.worldInitialized = false;\r\n    }\r\n\r\n    /**\r\n     * Initialize the ECS world asynchronously\r\n     * This is called from the constructor and runs in the background\r\n     */\r\n    async initializeECSWorld(scene, spaceship) {\r\n        try {\r\n            console.log(\"[COMBAT] Starting ECS world initialization...\");\r\n            \r\n            // Create a new World instance immediately to allow references\r\n            this.world = new World(window.mainMessageBus);\r\n            console.log(\"[COMBAT] Created world with messageBus: \", \r\n                        this.world.messageBus === window.mainMessageBus ? \"Using shared messageBus\" : \"Created new messageBus\");\r\n            \r\n            // Make world globally available immediately\r\n            if (window.game) {\r\n                window.game.ecsWorld = this.world;\r\n                console.log(\"[COMBAT] Made ECS world globally available via window.game.ecsWorld\");\r\n            }\r\n            \r\n            // Store scene reference in world for systems that need it\r\n            this.world.scene = scene;\r\n            \r\n            // Log scene reference for debugging\r\n            console.log(`[COMBAT] Set scene reference in ECS world for enemy rendering:`, \r\n                       scene ? \"Scene available\" : \"No scene available\");\r\n            \r\n            // Create player entity immediately - don't wait for full setup\r\n            await this.createPlayerReferenceEntity(spaceship);\r\n            \r\n            // Create optimized projectile store\r\n            if (!this.world.optimizedProjectiles) {\r\n                try {\r\n                    const { OptimizedProjectileStore } = await import('../../core/optimized/OptimizedProjectileStore.js');\r\n                    this.world.optimizedProjectiles = new OptimizedProjectileStore(4096);\r\n                    console.log('[COMBAT] OptimizedProjectileStore created');\r\n                } catch (e) {\r\n                    console.warn('[COMBAT] OptimizedProjectileStore unavailable:', e);\r\n                }\r\n            }\r\n            \r\n            console.log(\"[COMBAT] ECS world initialization complete\");\r\n            return this.world;\r\n        } catch (error) {\r\n            console.error(\"[COMBAT] Error initializing ECS world:\", error);\r\n            throw error;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Create a player reference entity in the ECS world\r\n     * This allows enemies and other systems to interact with the player\r\n     */\r\n    async createPlayerReferenceEntity(spaceship) {\r\n        if (!this.world) {\r\n            console.error(\"[COMBAT] Cannot create player entity - world not available\");\r\n            return null;\r\n        }\r\n        \r\n        if (!spaceship) {\r\n            console.error(\"[COMBAT] Cannot create player entity - spaceship not available\");\r\n            return null;\r\n        }\r\n        \r\n        try {\r\n            console.log(\"[COMBAT] Creating player reference entity...\");\r\n            \r\n            // If player entity already exists, check if it's valid\r\n            if (this.playerEntity) {\r\n                const existingEntity = this.world.getEntity(this.playerEntity.id);\r\n                if (existingEntity) {\r\n                    console.log(`[COMBAT] Player entity already exists with ID: ${this.playerEntity.id}`);\r\n                    \r\n                    // Make sure it has the player tag (re-add if missing)\r\n                    if (!existingEntity.hasTag('player')) {\r\n                        console.log(\"[COMBAT] Re-adding 'player' tag to existing entity\");\r\n                        existingEntity.addTag('player');\r\n                    }\r\n                    \r\n                    // Update its position\r\n                    const transform = existingEntity.getComponent('TransformComponent');\r\n                    if (transform && spaceship.mesh) {\r\n                        transform.position.copy(spaceship.mesh.position);\r\n                        transform.rotation.copy(spaceship.mesh.rotation);\r\n                        transform.quaternion.copy(spaceship.mesh.quaternion);\r\n                        if (typeof transform.setUpdated === 'function') {\r\n                            transform.setUpdated();\r\n                        }\r\n                    }\r\n                    \r\n                    // Make it globally accessible\r\n                    if (window.game) {\r\n                        window.game.combat = window.game.combat || {};\r\n                        window.game.combat.playerEntity = existingEntity;\r\n                    }\r\n                    \r\n                    return existingEntity;\r\n                } else {\r\n                    console.log(\"[COMBAT] Previous player entity no longer exists, creating new one\");\r\n                }\r\n            }\r\n            \r\n            // Create player entity with a clear unique name\r\n            const playerEntity = this.world.createEntity('player_' + Date.now());\r\n            \r\n            // Add player tag and log it\r\n            playerEntity.addTag('player');\r\n            console.log(`[COMBAT] Added 'player' tag to entity ${playerEntity.id}`);\r\n            \r\n            // Import needed components\r\n            let TransformComponent, HealthComponent;\r\n            \r\n            try {\r\n                const transformModule = await import('../../components/transform.js');\r\n                TransformComponent = transformModule.TransformComponent;\r\n                console.log(\"[COMBAT] Successfully imported TransformComponent\");\r\n            } catch (error) {\r\n                console.error(\"[COMBAT] Failed to import TransformComponent:\", error);\r\n                // Create a minimal fallback if import fails\r\n                TransformComponent = class FallbackTransform {\r\n                    constructor(position) { \r\n                        this.position = position || new THREE.Vector3();\r\n                        this.rotation = new THREE.Euler();\r\n                        this.quaternion = new THREE.Quaternion();\r\n                    }\r\n                };\r\n            }\r\n            \r\n            try {\r\n                const healthModule = await import('../../components/combat/healthComponent.js');\r\n                HealthComponent = healthModule.HealthComponent;\r\n                console.log(\"[COMBAT] Successfully imported HealthComponent\");\r\n            } catch (error) {\r\n                console.error(\"[COMBAT] Failed to import HealthComponent:\", error);\r\n                // Create a minimal fallback if import fails\r\n                HealthComponent = class FallbackHealth {\r\n                    constructor(health, shield) {\r\n                        this.health = health || 100;\r\n                        this.shield = shield || 50;\r\n                        this.maxHealth = health || 100;\r\n                        this.maxShield = shield || 50;\r\n                    }\r\n                };\r\n            }\r\n            \r\n            // Add transform component linked to spaceship position\r\n            try {\r\n                const position = spaceship.mesh ? spaceship.mesh.position.clone() : new THREE.Vector3();\r\n                const transform = new TransformComponent(position);\r\n                playerEntity.addComponent(transform);\r\n                console.log(`[COMBAT] Added TransformComponent to player entity with position: ${position.x.toFixed(1)}, ${position.y.toFixed(1)}, ${position.z.toFixed(1)}`);\r\n            } catch (error) {\r\n                console.error(\"[COMBAT] Error adding TransformComponent to player entity:\", error);\r\n            }\r\n            \r\n            // Add health component\r\n            try {\r\n                const health = new HealthComponent(100, 50); // 100 health, 50 shield\r\n                playerEntity.addComponent(health);\r\n                console.log(\"[COMBAT] Added HealthComponent to player entity\");\r\n            } catch (error) {\r\n                console.error(\"[COMBAT] Error adding HealthComponent to player entity:\", error);\r\n            }\r\n            \r\n            // Store reference to player entity\r\n            this.playerEntity = playerEntity;\r\n            \r\n            // Make the player entity globally accessible for emergency access\r\n            if (window.game) {\r\n                window.game.combat = window.game.combat || {};\r\n                window.game.combat.playerEntity = playerEntity;\r\n                console.log(\"[COMBAT] Made player entity globally accessible via window.game.combat.playerEntity\");\r\n            }\r\n            \r\n            // Add direct player entity reference to the world\r\n            this.world.playerEntity = playerEntity;\r\n            console.log(\"[COMBAT] Made player entity available directly via world.playerEntity\");\r\n            \r\n            // Explicitly publish an event for player entity creation\r\n            if (this.world && this.world.messageBus) {\r\n                this.world.messageBus.publish('player.created', { entity: playerEntity });\r\n                console.log(\"[COMBAT] Published player.created event\");\r\n            }\r\n            \r\n            console.log(\"[COMBAT] Successfully created player reference entity with ID:\", playerEntity.id);\r\n            \r\n            // Return the entity for chaining\r\n            return playerEntity;\r\n        } catch (error) {\r\n            console.error(\"[COMBAT] Error creating player reference entity:\", error);\r\n            console.error(\"[COMBAT] Stack trace:\", error.stack);\r\n            return null;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Update the player reference entity with the current spaceship position\r\n     */\r\n    updatePlayerReference(spaceship) {\r\n        // Skip if missing references\r\n        if (!this.world || !spaceship || !this.playerEntity) {\r\n            // If we don't have a player entity, try to create one now if world is ready\r\n            if (this.world && spaceship && !this.playerEntity) {\r\n                console.log(\"No player entity found, creating one...\");\r\n                this.createPlayerReferenceEntity(spaceship);\r\n                return;\r\n            }\r\n            return;\r\n        }\r\n        \r\n        // Get the player entity\r\n        const playerEntity = this.world.getEntity(this.playerEntity.id);\r\n        \r\n        // If entity was somehow lost, recreate it\r\n        if (!playerEntity) {\r\n            console.warn(\"Player entity lost, recreating...\");\r\n            this.createPlayerReferenceEntity(spaceship);\r\n            return;\r\n        }\r\n        \r\n        // Update transform component with current spaceship position\r\n        const transform = playerEntity.getComponent('TransformComponent');\r\n        if (transform && spaceship.mesh) {\r\n            // Update position\r\n            transform.position.copy(spaceship.mesh.position);\r\n            \r\n            // Update rotation\r\n            transform.rotation.copy(spaceship.mesh.rotation);\r\n            transform.quaternion.copy(spaceship.mesh.quaternion);\r\n            \r\n            // Mark transform as updated to trigger any listening systems\r\n            if (typeof transform.setUpdated === 'function') {\r\n                transform.setUpdated();\r\n            }\r\n        }\r\n        \r\n        // Update health component if spaceship has relevant health info\r\n        const health = playerEntity.getComponent('HealthComponent');\r\n        if (health && spaceship.health !== undefined) {\r\n            // Only update health if it would be higher - don't override damage\r\n            if (spaceship.health > health.health) {\r\n                health.health = spaceship.health;\r\n            }\r\n            \r\n            // Only update shield if it would be higher - don't override damage\r\n            if (spaceship.shield !== undefined && spaceship.shield > health.shield) {\r\n                health.shield = spaceship.shield;\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Sync the spaceship hull/shield with the player entity's HealthComponent\r\n     */\r\n    updateSpaceshipHealth(spaceship) {\r\n        if (!this.playerEntity || !spaceship) return;\r\n        \r\n        // Get health component\r\n        const health = this.playerEntity.getComponent('HealthComponent');\r\n        if (health) {\r\n            // IMPORTANT: Only update spaceship health if the health component shows MORE damage\r\n            // (less health) than the spaceship currently has - this means damage was applied to the component\r\n            if (health.health < spaceship.hull) {\r\n                console.log(`Damage detected in health component: ${health.health} (was ${spaceship.hull})`);\r\n                spaceship.hull = health.health;\r\n            }\r\n            \r\n            // Similarly for shield\r\n            if (health.shield < spaceship.shield) {\r\n                console.log(`Shield damage detected in health component: ${health.shield} (was ${spaceship.shield})`);\r\n                spaceship.shield = health.shield;\r\n            }\r\n            \r\n            // Check if health indicates the ship is destroyed\r\n            if (health.isDestroyed && !spaceship.isDestroyed) {\r\n                console.log(\"Health component indicates player is destroyed - updating spaceship state\");\r\n                spaceship.isDestroyed = true;\r\n                \r\n                // Call handle destruction for visual effects\r\n                if (typeof spaceship.handleDestruction === 'function') {\r\n                    spaceship.handleDestruction();\r\n                }\r\n            }\r\n            \r\n            // Check for low health and update spaceship directly\r\n            if (health.health <= 0 && !spaceship.isDestroyed) {\r\n                console.log(\"Player health is zero - marking spaceship as destroyed\");\r\n                spaceship.isDestroyed = true;\r\n                \r\n                // Call handle destruction for visual effects\r\n                if (typeof spaceship.handleDestruction === 'function') {\r\n                    spaceship.handleDestruction();\r\n                }\r\n                \r\n                // Force game over with a \"pwned by space alien\" message\r\n                if (window.game) {\r\n                    console.log(\"FORCING GAME OVER FROM COMBAT MODULE!\");\r\n                    window.game.gameOver(\"You were pwned by a space alien!\");\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Initialize the world\r\n     */\r\n    initializeWorld() {\r\n        try {\r\n            console.log(\"[COMBAT] Calling world.initialize()...\");\r\n            this.world.initialize();\r\n            console.log(\"[COMBAT] World initialization completed successfully\");\r\n        } catch (error) {\r\n            console.error(\"[COMBAT] Error during world.initialize():\", error);\r\n            console.error(\"[COMBAT] Stack trace:\", error.stack);\r\n            \r\n            // Continue execution - don't let this error stop us\r\n            console.log(\"[COMBAT] Continuing despite initialization error\");\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Mark world as initialized\r\n     */\r\n    setWorldInitialized() {\r\n        this.worldInitialized = true;\r\n    }\r\n\r\n    /**\r\n     * Set reference to this world in the scene for cross-component access\r\n     */\r\n    setSceneReference(scene) {\r\n        if (scene) {\r\n            scene.ecsWorld = this.world;\r\n            console.log(\"[COMBAT] Set ECS world reference in scene for cross-system access\");\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Get the world instance\r\n     */\r\n    getWorld() {\r\n        return this.world;\r\n    }\r\n\r\n    /**\r\n     * Get the player entity\r\n     */\r\n    getPlayerEntity() {\r\n        return this.playerEntity;\r\n    }\r\n\r\n    /**\r\n     * Check if world is initialized\r\n     */\r\n    isWorldInitialized() {\r\n        return this.worldInitialized;\r\n    }\r\n}","/**\r\n * System Base Class - Base class for all ECS systems\r\n * \r\n * Systems operate on entities that have specific components.\r\n * They contain the logic that processes entity data.\r\n */\r\n\r\nexport class System {\r\n    constructor(world) {\r\n        this.world = world;\r\n        this.enabled = true;\r\n        this.requiredComponents = []; // Component types required for processing\r\n        this.priority = 0; // Execution order (lower = earlier)\r\n    }\r\n    \r\n    /**\r\n     * Check if entity has all required components for this system\r\n     * @param {Entity} entity The entity to check\r\n     * @returns {boolean} True if entity can be processed by this system\r\n     */\r\n    checkEntity(entity) {\r\n        return this.requiredComponents.every(componentType => \r\n            entity.hasComponent(componentType));\r\n    }\r\n    \r\n    /**\r\n     * Get all entities that match this system's requirements\r\n     * @returns {Entity[]} Array of compatible entities\r\n     */\r\n    getEntities() {\r\n        return this.world.getEntitiesWithComponents(this.requiredComponents);\r\n    }\r\n    \r\n    /**\r\n     * Update method called each frame\r\n     * @param {number} deltaTime Time since last update in seconds\r\n     */\r\n    update(deltaTime) {\r\n        if (!this.enabled) return;\r\n        \r\n        const entities = this.getEntities();\r\n        entities.forEach(entity => {\r\n            this.processEntity(entity, deltaTime);\r\n        });\r\n    }\r\n    \r\n    /**\r\n     * Process a single entity\r\n     * @param {Entity} entity The entity to process\r\n     * @param {number} deltaTime Time since last update in seconds\r\n     */\r\n    processEntity(entity, deltaTime) {\r\n        // Override in derived systems\r\n    }\r\n    \r\n    /**\r\n     * Initialize the system\r\n     * Called once when the system is first registered\r\n     */\r\n    initialize() {\r\n        // Base implementation does nothing\r\n        // Override in derived systems for initialization logic\r\n    }\r\n    \r\n    /**\r\n     * Enable this system\r\n     */\r\n    enable() {\r\n        this.enabled = true;\r\n    }\r\n    \r\n    /**\r\n     * Disable this system\r\n     */\r\n    disable() {\r\n        this.enabled = false;\r\n    }\r\n}","/**\r\n * Component Base Class - Foundation for all ECS components\r\n * \r\n * Components hold data and state but typically have no logic.\r\n * They can define lifecycle methods that are called by the entity system.\r\n */\r\n\r\nexport class Component {\r\n    constructor() {\r\n        this.entity = null;\r\n        this.enabled = true;\r\n    }\r\n    \r\n    /**\r\n     * Called when the component is attached to an entity\r\n     * Override in derived components if needed\r\n     */\r\n    onAttached() {}\r\n    \r\n    /**\r\n     * Called when the component is detached from an entity\r\n     * Override in derived components if needed\r\n     */\r\n    onDetached() {}\r\n    \r\n    /**\r\n     * Called when the component is enabled\r\n     * Override in derived components if needed\r\n     */\r\n    onEnabled() {}\r\n    \r\n    /**\r\n     * Called when the component is disabled\r\n     * Override in derived components if needed\r\n     */\r\n    onDisabled() {}\r\n    \r\n    /**\r\n     * Enable this component\r\n     * @returns {Component} This component for chaining\r\n     */\r\n    enable() {\r\n        if (!this.enabled) {\r\n            this.enabled = true;\r\n            this.onEnabled();\r\n        }\r\n        return this;\r\n    }\r\n    \r\n    /**\r\n     * Disable this component\r\n     * @returns {Component} This component for chaining\r\n     */\r\n    disable() {\r\n        if (this.enabled) {\r\n            this.enabled = false;\r\n            this.onDisabled();\r\n        }\r\n        return this;\r\n    }\r\n}","/**\r\n * HealthComponent - Handles health, shield, and damage for entities\r\n * \r\n * Manages health, shields, and damage application for both players and enemies\r\n */\r\n\r\nimport { Component } from '../../core/component.js';\r\n\r\nexport class HealthComponent extends Component {\r\n    constructor(maxHealth = 100, maxShield = 0) {\r\n        super();\r\n        \r\n        // Health properties\r\n        this.maxHealth = maxHealth;\r\n        this.health = maxHealth;\r\n        \r\n        // Shield properties\r\n        this.maxShield = maxShield;\r\n        this.shield = maxShield;\r\n        this.shieldRegenRate = 5; // Shield points per second\r\n        this.shieldRegenDelay = 3; // Seconds after damage before regeneration starts\r\n        this.timeSinceLastDamage = this.shieldRegenDelay; // Start regenerating immediately\r\n        \r\n        // Resistance properties (damage reduction percentage)\r\n        this.damageResistance = 0; // 0-1 range, 0.5 = 50% damage reduction\r\n        \r\n        // Status\r\n        this.isDestroyed = false;\r\n        this.isInvulnerable = false;\r\n        \r\n    }\r\n    \r\n    // Add an onAttached method to subscribe to health sync events\r\n    onAttached() {\r\n        // Only subscribe for player entities\r\n        if (this.entity && this.entity.hasTag && this.entity.hasTag('player')) {\r\n            \r\n            // Subscribe to health sync events on the message bus\r\n            if (this.entity.world && this.entity.world.messageBus) {\r\n                this.entity.world.messageBus.subscribe('player.syncHealth', this.handleSyncHealth.bind(this));\r\n                this.entity.world.messageBus.subscribe('player.undocked', this.handleSyncHealth.bind(this));\r\n            } else if (window.mainMessageBus) {\r\n                window.mainMessageBus.subscribe('player.syncHealth', this.handleSyncHealth.bind(this));\r\n                window.mainMessageBus.subscribe('player.undocked', this.handleSyncHealth.bind(this));\r\n            }\r\n        }\r\n    }\r\n    \r\n    // Handle the sync health event\r\n    handleSyncHealth(message) {\r\n        // Only apply if this component is attached to a player entity\r\n        if (!this.entity || !this.entity.hasTag || !this.entity.hasTag('player')) {\r\n            return;\r\n        }\r\n        \r\n        \r\n        // CRITICAL FIX: The message from MessageBus has a nested data property\r\n        // Extract the actual sync data from the message\r\n        const data = message.data || message;\r\n        \r\n        \r\n        // Update shield values if provided\r\n        if (data.shield !== undefined) {\r\n            const oldShield = this.shield;\r\n            \r\n            // SHIELD SYNC: Add additional logging to debug shield sync issues\r\n            \r\n            // Set shield value from spaceship\r\n            this.shield = data.shield;\r\n            \r\n        }\r\n        \r\n        if (data.maxShield !== undefined) {\r\n            const oldMaxShield = this.maxShield;\r\n            this.maxShield = data.maxShield;\r\n        }\r\n        \r\n        // Update health values if provided\r\n        if (data.hull !== undefined) {\r\n            const oldHealth = this.health;\r\n            this.health = data.hull;\r\n        }\r\n        \r\n        if (data.maxHull !== undefined) {\r\n            const oldMaxHealth = this.maxHealth;\r\n            this.maxHealth = data.maxHull;\r\n        }\r\n        \r\n    }\r\n    \r\n    /**\r\n     * Apply damage to this entity\r\n     * @param {number} amount Amount of damage to apply\r\n     * @param {string} type Type of damage (e.g., 'projectile', 'collision', 'emp')\r\n     * @param {object} source Source entity of the damage\r\n     * @returns {object} Damage result with actual damage dealt\r\n     */\r\n    applyDamage(amount, type = 'projectile', source = null) {\r\n        \r\n        // Check if entity can be damaged\r\n        if (this.isDestroyed || this.isInvulnerable) {\r\n            return { damageApplied: 0, shieldDamage: 0, healthDamage: 0, destroyed: false };\r\n        }\r\n        \r\n        // Apply damage resistance\r\n        const resistedAmount = amount * (1 - this.damageResistance);\r\n        \r\n        // Track how much damage was applied to shields vs health\r\n        let shieldDamage = 0;\r\n        let healthDamage = 0;\r\n        \r\n        // Reset shield regeneration timer\r\n        this.timeSinceLastDamage = 0;\r\n        \r\n        // Apply damage to shield first if available\r\n        if (this.shield > 0) {\r\n            if (resistedAmount <= this.shield) {\r\n                // Shield absorbs all damage\r\n                this.shield -= resistedAmount;\r\n                shieldDamage = resistedAmount;\r\n            } else {\r\n                // Damage breaks through shield\r\n                shieldDamage = this.shield;\r\n                healthDamage = resistedAmount - this.shield;\r\n                this.shield = 0;\r\n                this.health -= healthDamage;\r\n            }\r\n        } else {\r\n            // No shield, apply damage directly to health\r\n            this.health -= resistedAmount;\r\n            healthDamage = resistedAmount;\r\n        }\r\n        \r\n        // Ensure health doesn't go below 0\r\n        if (this.health < 0) {\r\n            this.health = 0;\r\n        }\r\n        \r\n        // Check if entity is destroyed\r\n        if (this.health <= 0 && !this.isDestroyed) {\r\n            this.isDestroyed = true;\r\n            \r\n            // Notify entity destruction\r\n            if (this.entity && this.entity.world) {\r\n                this.entity.world.messageBus.publish('entity.destroyed', {\r\n                    entity: this.entity,\r\n                    source: source,\r\n                    damageType: type\r\n                });\r\n                \r\n                // Additional check for player entity - publish game over event\r\n                if (this.entity.hasTag && this.entity.hasTag('player')) {\r\n                    \r\n                    \r\n                    // Use direct world message bus\r\n                    if (this.entity && this.entity.world && this.entity.world.messageBus) {\r\n                        this.entity.world.messageBus.publish('game.over', {\r\n                            reason: \"You were pwned by a space alien!\",\r\n                            source: \"health\"\r\n                        });\r\n                    } else {\r\n                        // Import MessageBus to use the static method if needed\r\n                        import('../../core/messageBus.js').then(module => {\r\n                            const MessageBus = module.MessageBus;\r\n                            \r\n                            // Use the static method for handling\r\n                            MessageBus.triggerGameOver(\"You were pwned by a space alien!\", \"health\");\r\n                        }).catch(err => {});\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        \r\n        // Notify about damage\r\n        if (this.entity && this.entity.world) {\r\n            this.entity.world.messageBus.publish('entity.damaged', {\r\n                entity: this.entity,\r\n                source: source,\r\n                damageType: type,\r\n                amount: resistedAmount,\r\n                shieldDamage: shieldDamage,\r\n                healthDamage: healthDamage\r\n            });\r\n        }\r\n        \r\n        \r\n        return {\r\n            damageApplied: resistedAmount,\r\n            shieldDamage: shieldDamage,\r\n            healthDamage: healthDamage,\r\n            destroyed: this.isDestroyed\r\n        };\r\n    }\r\n    \r\n    /**\r\n     * Heal the entity\r\n     * @param {number} amount Amount to heal\r\n     * @returns {number} Actual amount healed\r\n     */\r\n    heal(amount) {\r\n        if (this.isDestroyed) return 0;\r\n        \r\n        const startHealth = this.health;\r\n        this.health = Math.min(this.health + amount, this.maxHealth);\r\n        \r\n        const healedAmount = this.health - startHealth;\r\n        \r\n        if (healedAmount > 0 && this.entity && this.entity.world) {\r\n            this.entity.world.messageBus.publish('entity.healed', {\r\n                entity: this.entity,\r\n                amount: healedAmount\r\n            });\r\n        }\r\n        \r\n        return healedAmount;\r\n    }\r\n    \r\n    /**\r\n     * Recharge the shield\r\n     * @param {number} amount Amount to recharge\r\n     * @returns {number} Actual amount recharged\r\n     */\r\n    rechargeShield(amount) {\r\n        if (this.isDestroyed) return 0;\r\n        \r\n        const startShield = this.shield;\r\n        this.shield = Math.min(this.shield + amount, this.maxShield);\r\n        \r\n        const rechargedAmount = this.shield - startShield;\r\n        \r\n        if (rechargedAmount > 0 && this.entity && this.entity.world) {\r\n            this.entity.world.messageBus.publish('entity.shieldRecharged', {\r\n                entity: this.entity,\r\n                amount: rechargedAmount\r\n            });\r\n        }\r\n        \r\n        return rechargedAmount;\r\n    }\r\n    \r\n    /**\r\n     * Update shield and health regeneration\r\n     * @param {number} deltaTime Time since last update in seconds\r\n     */\r\n    update(deltaTime) {\r\n        if (this.isDestroyed) return;\r\n        \r\n        // Update timer since last damage\r\n        this.timeSinceLastDamage += deltaTime;\r\n        \r\n        // Regenerate shields if enough time has passed since last damage\r\n        if (this.timeSinceLastDamage >= this.shieldRegenDelay && this.shield < this.maxShield) {\r\n            const regenAmount = this.shieldRegenRate * deltaTime;\r\n            this.rechargeShield(regenAmount);\r\n        }\r\n        \r\n        // Regenerate hull health slowly (only for player)\r\n        if (this.entity && this.entity.hasTag('player') && this.health < this.maxHealth) {\r\n            // Regenerate 5% of max health per second\r\n            const healthRegenRate = this.maxHealth * 0.05;\r\n            const healthRegenAmount = healthRegenRate * deltaTime;\r\n            this.heal(healthRegenAmount);\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Get health as a percentage (0-100)\r\n     * @returns {number} Health percentage\r\n     */\r\n    getHealthPercentage() {\r\n        return (this.health / this.maxHealth) * 100;\r\n    }\r\n    \r\n    /**\r\n     * Get shield as a percentage (0-100)\r\n     * @returns {number} Shield percentage\r\n     */\r\n    getShieldPercentage() {\r\n        return this.maxShield > 0 ? (this.shield / this.maxShield) * 100 : 0;\r\n    }\r\n    \r\n    /**\r\n     * Upgrade health capacity and fully heal\r\n     * @param {number} multiplier Multiplier for health increase\r\n     * @returns {object} New health stats\r\n     */\r\n    upgradeHealth(multiplier = 1.25) {\r\n        const oldMax = this.maxHealth;\r\n        this.maxHealth *= multiplier;\r\n        this.health = this.maxHealth; // Full heal on upgrade\r\n        \r\n        \r\n        // Notify upgrade\r\n        if (this.entity && this.entity.world) {\r\n            this.entity.world.messageBus.publish('health.upgraded', {\r\n                entity: this.entity,\r\n                oldMax: oldMax,\r\n                newMax: this.maxHealth\r\n            });\r\n        }\r\n        \r\n        return {\r\n            maxHealth: this.maxHealth,\r\n            healthBoost: this.maxHealth - oldMax\r\n        };\r\n    }\r\n    \r\n    /**\r\n     * Upgrade shield capacity\r\n     * @param {number} multiplier Multiplier for shield increase\r\n     * @returns {object} New shield stats\r\n     */\r\n    upgradeShield(multiplier = 1.5) {\r\n        \r\n        const oldMax = this.maxShield;\r\n        const oldShield = this.shield;\r\n        \r\n        // Increase max shield\r\n        this.maxShield = Math.ceil(this.maxShield * multiplier);\r\n        \r\n        // Full recharge on upgrade - this is the original behavior\r\n        this.shield = this.maxShield;\r\n        \r\n        \r\n        // Notify upgrade\r\n        if (this.entity && this.entity.world) {\r\n            this.entity.world.messageBus.publish('shield.upgraded', {\r\n                entity: this.entity,\r\n                oldMax: oldMax,\r\n                newMax: this.maxShield\r\n            });\r\n        }\r\n        \r\n        return {\r\n            maxShield: this.maxShield,\r\n            shieldBoost: this.maxShield - oldMax\r\n        };\r\n    }\r\n}","/**\r\n * TransformComponent - Position, rotation, scale component\r\n * \r\n * Handles spatial transformation of entities in the 3D world.\r\n */\r\n\r\nimport { Component } from '../core/component.js';\r\nimport * as THREE from 'three';\r\n\r\nexport class TransformComponent extends Component {\r\n    constructor(position = new THREE.Vector3(), rotation = new THREE.Euler(), scale = new THREE.Vector3(1, 1, 1)) {\r\n        super();\r\n        this.position = position.clone();\r\n        this.rotation = rotation.clone();\r\n        this.scale = scale.clone();\r\n        this.quaternion = new THREE.Quaternion().setFromEuler(this.rotation);\r\n        this.matrix = new THREE.Matrix4();\r\n        this.needsUpdate = true;\r\n        // Previous state for interpolation\r\n        this.prevPosition = this.position.clone();\r\n        this.prevQuaternion = this.quaternion.clone();\r\n    }\r\n    \r\n    /**\r\n     * Set the position\r\n     * @param {number} x X coordinate\r\n     * @param {number} y Y coordinate\r\n     * @param {number} z Z coordinate\r\n     * @returns {TransformComponent} This component for chaining\r\n     */\r\n    setPosition(x, y, z) {\r\n        this.position.set(x, y, z);\r\n        this.needsUpdate = true;\r\n        return this;\r\n    }\r\n    \r\n    /**\r\n     * Set the rotation in Euler angles\r\n     * @param {number} x X rotation in radians\r\n     * @param {number} y Y rotation in radians\r\n     * @param {number} z Z rotation in radians\r\n     * @returns {TransformComponent} This component for chaining\r\n     */\r\n    setRotation(x, y, z) {\r\n        this.rotation.set(x, y, z);\r\n        this.quaternion.setFromEuler(this.rotation);\r\n        this.needsUpdate = true;\r\n        return this;\r\n    }\r\n    \r\n    /**\r\n     * Set the rotation from a quaternion\r\n     * @param {THREE.Quaternion} quaternion The quaternion\r\n     * @returns {TransformComponent} This component for chaining\r\n     */\r\n    setQuaternion(quaternion) {\r\n        this.quaternion.copy(quaternion);\r\n        this.rotation.setFromQuaternion(this.quaternion);\r\n        this.needsUpdate = true;\r\n        return this;\r\n    }\r\n    \r\n    /**\r\n     * Set the scale\r\n     * @param {number} x X scale\r\n     * @param {number} y Y scale\r\n     * @param {number} z Z scale\r\n     * @returns {TransformComponent} This component for chaining\r\n     */\r\n    setScale(x, y, z) {\r\n        this.scale.set(x, y, z);\r\n        this.needsUpdate = true;\r\n        return this;\r\n    }\r\n    \r\n    /**\r\n     * Look at a point\r\n     * @param {THREE.Vector3} target The point to look at\r\n     * @returns {TransformComponent} This component for chaining\r\n     */\r\n    lookAt(target) {\r\n        // Create a temporary matrix to derive the rotation\r\n        const tempMatrix = new THREE.Matrix4();\r\n        tempMatrix.lookAt(this.position, target, new THREE.Vector3(0, 1, 0));\r\n        \r\n        // Extract the quaternion from the matrix\r\n        this.quaternion.setFromRotationMatrix(tempMatrix);\r\n        this.rotation.setFromQuaternion(this.quaternion);\r\n        \r\n        this.needsUpdate = true;\r\n        return this;\r\n    }\r\n    \r\n    /**\r\n     * Update the matrix from position, quaternion, and scale\r\n     * @returns {THREE.Matrix4} The updated matrix\r\n     */\r\n    updateMatrix() {\r\n        if (this.needsUpdate) {\r\n            this.matrix.compose(this.position, this.quaternion, this.scale);\r\n            this.needsUpdate = false;\r\n        }\r\n        return this.matrix;\r\n    }\r\n\r\n    /**\r\n     * Snapshot the current transform to previous for interpolation\r\n     */\r\n    snapshotPrevious() {\r\n        this.prevPosition.copy(this.position);\r\n        this.prevQuaternion.copy(this.quaternion);\r\n    }\r\n    \r\n    /**\r\n     * Get world position\r\n     * @returns {THREE.Vector3} A new vector representing the world position\r\n     */\r\n    getWorldPosition() {\r\n        return this.position.clone();\r\n    }\r\n    \r\n    /**\r\n     * Get forward direction vector\r\n     * @returns {THREE.Vector3} A normalized vector pointing forward\r\n     */\r\n    getForwardVector() {\r\n        const forward = new THREE.Vector3(0, 0, -1);\r\n        forward.applyQuaternion(this.quaternion);\r\n        return forward;\r\n    }\r\n    \r\n    /**\r\n     * Get right direction vector\r\n     * @returns {THREE.Vector3} A normalized vector pointing right\r\n     */\r\n    getRightVector() {\r\n        const right = new THREE.Vector3(1, 0, 0);\r\n        right.applyQuaternion(this.quaternion);\r\n        return right;\r\n    }\r\n    \r\n    /**\r\n     * Get up direction vector\r\n     * @returns {THREE.Vector3} A normalized vector pointing up\r\n     */\r\n    getUpVector() {\r\n        const up = new THREE.Vector3(0, 1, 0);\r\n        up.applyQuaternion(this.quaternion);\r\n        return up;\r\n    }\r\n}","/**\r\n * RigidbodyComponent - Physics properties for entities\r\n * \r\n * Handles velocity, forces, and other physics-related properties.\r\n */\r\n\r\nimport * as THREE from 'three';\r\nimport { Component } from '../../core/component.js';\r\n\r\nexport class RigidbodyComponent extends Component {\r\n    constructor(mass = 1.0) {\r\n        super();\r\n        \r\n        // Basic physics properties\r\n        this.velocity = new THREE.Vector3();\r\n        this.angularVelocity = new THREE.Vector3();\r\n        this.mass = mass;\r\n        this.drag = 0.01;\r\n        this.angularDrag = 0.01;\r\n        \r\n        // Movement constraints\r\n        this.useGravity = false;\r\n        this.isKinematic = false;\r\n        this.freezeRotation = false;\r\n        \r\n        // Force properties\r\n        this.forces = new THREE.Vector3();\r\n        this.torque = new THREE.Vector3();\r\n        \r\n        // Collision properties\r\n        this.collisionRadius = 1.0;\r\n        this.isTrigger = false;\r\n    }\r\n    \r\n    /**\r\n     * Reset forces applied this frame\r\n     */\r\n    resetForces() {\r\n        this.forces.set(0, 0, 0);\r\n        this.torque.set(0, 0, 0);\r\n    }\r\n    \r\n    /**\r\n     * Apply a force to the rigidbody\r\n     * @param {THREE.Vector3} force Force vector to apply\r\n     * @param {THREE.Vector3} point Point where force is applied (for torque)\r\n     */\r\n    applyForce(force, point = null) {\r\n        if (this.isKinematic) return;\r\n        \r\n        // Add to force accumulator\r\n        this.forces.add(force);\r\n        \r\n        // Calculate torque if point is specified\r\n        if (point) {\r\n            const transformComponent = this.entity.getComponent('TransformComponent');\r\n            if (transformComponent) {\r\n                const relativePoint = point.clone().sub(transformComponent.position);\r\n                const torque = relativePoint.cross(force);\r\n                this.applyTorque(torque);\r\n            }\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Apply an impulse (immediate velocity change)\r\n     * @param {THREE.Vector3} impulse Impulse vector\r\n     */\r\n    applyImpulse(impulse) {\r\n        if (this.isKinematic) return;\r\n        \r\n        // Calculate velocity change based on mass\r\n        const velocityChange = impulse.clone().divideScalar(this.mass);\r\n        this.velocity.add(velocityChange);\r\n    }\r\n    \r\n    /**\r\n     * Apply torque (rotational force)\r\n     * @param {THREE.Vector3} torque Torque vector\r\n     */\r\n    applyTorque(torque) {\r\n        if (this.isKinematic || this.freezeRotation) return;\r\n        \r\n        this.torque.add(torque);\r\n    }\r\n    \r\n    /**\r\n     * Set velocity directly\r\n     * @param {THREE.Vector3} velocity New velocity vector\r\n     */\r\n    setVelocity(velocity) {\r\n        this.velocity.copy(velocity);\r\n    }\r\n    \r\n    /**\r\n     * Set angular velocity directly\r\n     * @param {THREE.Vector3} angularVelocity New angular velocity vector\r\n     */\r\n    setAngularVelocity(angularVelocity) {\r\n        if (this.freezeRotation) return;\r\n        \r\n        this.angularVelocity.copy(angularVelocity);\r\n    }\r\n}","/**\r\n * MeshComponent - Visual representation of an entity\r\n * \r\n * Handles the Three.js mesh and its properties.\r\n */\r\n\r\nimport { Component } from '../../core/component.js';\r\nimport * as THREE from 'three';\r\n\r\nexport class MeshComponent extends Component {\r\n    constructor(geometry, material) {\r\n        super();\r\n        \r\n        // Handle case where geometry is already a mesh or group\r\n        if (geometry && geometry.isMesh || geometry && geometry.isGroup) {\r\n            this.mesh = geometry;\r\n        } else if (geometry && material) {\r\n            this.mesh = new THREE.Mesh(geometry, material);\r\n            \r\n            // Ensure geometry has computed boundingSphere\r\n            if (geometry && typeof geometry.computeBoundingSphere === 'function' && !geometry.boundingSphere) {\r\n                geometry.computeBoundingSphere();\r\n            }\r\n        } else {\r\n            // Fallback to simple cube if no valid geometry, but make it invisible\r\n            console.warn('MeshComponent created with invalid geometry, using invisible default cube');\r\n            const defaultGeom = new THREE.BoxGeometry(10, 10, 10);\r\n            defaultGeom.computeBoundingSphere();\r\n            const defaultMat = new THREE.MeshBasicMaterial({ \r\n                color: 0xff0000, \r\n                transparent: true, \r\n                opacity: 0.0,\r\n                visible: false \r\n            });\r\n            this.mesh = new THREE.Mesh(defaultGeom, defaultMat);\r\n            this.mesh.visible = false; // Ensure the mesh is invisible\r\n        }\r\n        \r\n        this.visible = true;\r\n        this.castShadow = false;\r\n        this.receiveShadow = false;\r\n    }\r\n    \r\n    /**\r\n     * Called when component is attached to an entity\r\n     */\r\n    onAttached() {\r\n        // Link mesh to transform if available\r\n        const transform = this.entity.getComponent('TransformComponent');\r\n        if (transform) {\r\n            // Initial setup of mesh position, rotation, and scale\r\n            this.mesh.position.copy(transform.position);\r\n            this.mesh.quaternion.copy(transform.quaternion);\r\n            this.mesh.scale.copy(transform.scale);\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Called when component is detached from an entity\r\n     */\r\n    onDetached() {\r\n        // Remove from scene if present\r\n        if (this.mesh.parent) {\r\n            this.mesh.parent.remove(this.mesh);\r\n        }\r\n        \r\n        // Dispose of geometry and material to prevent memory leaks\r\n        if (this.mesh.geometry) {\r\n            this.mesh.geometry.dispose();\r\n        }\r\n        \r\n        if (this.mesh.material) {\r\n            // Check if material is an array\r\n            if (Array.isArray(this.mesh.material)) {\r\n                this.mesh.material.forEach(material => {\r\n                    if (material.map) material.map.dispose();\r\n                    if (material.lightMap) material.lightMap.dispose();\r\n                    if (material.bumpMap) material.bumpMap.dispose();\r\n                    if (material.normalMap) material.normalMap.dispose();\r\n                    if (material.specularMap) material.specularMap.dispose();\r\n                    if (material.envMap) material.envMap.dispose();\r\n                    material.dispose();\r\n                });\r\n            } else {\r\n                // Single material case\r\n                if (this.mesh.material.map) this.mesh.material.map.dispose();\r\n                if (this.mesh.material.lightMap) this.mesh.material.lightMap.dispose();\r\n                if (this.mesh.material.bumpMap) this.mesh.material.bumpMap.dispose();\r\n                if (this.mesh.material.normalMap) this.mesh.material.normalMap.dispose();\r\n                if (this.mesh.material.specularMap) this.mesh.material.specularMap.dispose();\r\n                if (this.mesh.material.envMap) this.mesh.material.envMap.dispose();\r\n                this.mesh.material.dispose();\r\n            }\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Set mesh visibility\r\n     * @param {boolean} visible Whether the mesh is visible\r\n     */\r\n    setVisible(visible) {\r\n        this.visible = visible;\r\n        this.mesh.visible = visible;\r\n    }\r\n    \r\n    /**\r\n     * Check if mesh is visible\r\n     * @returns {boolean} Whether the mesh is visible\r\n     */\r\n    isVisible() {\r\n        return this.visible && this.mesh.visible;\r\n    }\r\n    \r\n    /**\r\n     * Set whether the mesh casts shadows\r\n     * @param {boolean} castShadow Whether the mesh casts shadows\r\n     */\r\n    setCastShadow(castShadow) {\r\n        this.castShadow = castShadow;\r\n        this.mesh.castShadow = castShadow;\r\n    }\r\n    \r\n    /**\r\n     * Set whether the mesh receives shadows\r\n     * @param {boolean} receiveShadow Whether the mesh receives shadows\r\n     */\r\n    setReceiveShadow(receiveShadow) {\r\n        this.receiveShadow = receiveShadow;\r\n        this.mesh.receiveShadow = receiveShadow;\r\n    }\r\n    \r\n    /**\r\n     * Change the mesh's material\r\n     * @param {THREE.Material} material New material\r\n     */\r\n    setMaterial(material) {\r\n        this.mesh.material = material;\r\n    }\r\n    \r\n    /**\r\n     * Change the mesh's geometry\r\n     * @param {THREE.BufferGeometry} geometry New geometry\r\n     */\r\n    setGeometry(geometry) {\r\n        this.mesh.geometry = geometry;\r\n    }\r\n    \r\n    /**\r\n     * Add the mesh to a scene\r\n     * @param {THREE.Scene} scene Scene to add the mesh to\r\n     */\r\n    addToScene(scene) {\r\n        scene.add(this.mesh);\r\n    }\r\n    \r\n    /**\r\n     * Update mesh transform from entity transform\r\n     */\r\n    updateFromTransform() {\r\n        const transform = this.entity.getComponent('TransformComponent');\r\n        if (transform) {\r\n            this.mesh.position.copy(transform.position);\r\n            this.mesh.quaternion.copy(transform.quaternion);\r\n            this.mesh.scale.copy(transform.scale);\r\n        }\r\n    }\r\n}","/**\r\n * Memory Management Utilities\r\n * Provides tools for optimizing memory usage and reducing garbage collection\r\n */\r\n\r\nimport * as THREE from 'three';\r\n\r\n// Typed Array Pools\r\nconst typedArrayPools = {\r\n    float32: [],\r\n    int32: [],\r\n    uint32: [],\r\n    uint16: [],\r\n    uint8: []\r\n};\r\n\r\n// Maximum pool sizes to prevent memory leaks\r\nconst MAX_POOL_SIZE = 100;\r\n\r\n/**\r\n * Get a Float32Array from the pool or create a new one\r\n * @param {number} size - Length of the array\r\n * @returns {Float32Array} - A Float32Array of the specified size\r\n */\r\nexport function getFloat32Array(size) {\r\n    const pool = typedArrayPools.float32;\r\n    \r\n    // Find an array of appropriate size in the pool\r\n    for (let i = 0; i < pool.length; i++) {\r\n        if (pool[i].length >= size) {\r\n            const array = pool.splice(i, 1)[0];\r\n            return array;\r\n        }\r\n    }\r\n    \r\n    // Create a new array if none found in pool\r\n    return new Float32Array(size);\r\n}\r\n\r\n/**\r\n * Release a Float32Array back to the pool\r\n * @param {Float32Array} array - The array to release\r\n */\r\nexport function releaseFloat32Array(array) {\r\n    if (typedArrayPools.float32.length < MAX_POOL_SIZE) {\r\n        // Zero out the array to prevent data leaks\r\n        array.fill(0);\r\n        typedArrayPools.float32.push(array);\r\n    }\r\n}\r\n\r\n/**\r\n * Get an Int32Array from the pool or create a new one\r\n * @param {number} size - Length of the array\r\n * @returns {Int32Array} - An Int32Array of the specified size\r\n */\r\nexport function getInt32Array(size) {\r\n    const pool = typedArrayPools.int32;\r\n    \r\n    for (let i = 0; i < pool.length; i++) {\r\n        if (pool[i].length >= size) {\r\n            const array = pool.splice(i, 1)[0];\r\n            return array;\r\n        }\r\n    }\r\n    \r\n    return new Int32Array(size);\r\n}\r\n\r\n/**\r\n * Release an Int32Array back to the pool\r\n * @param {Int32Array} array - The array to release\r\n */\r\nexport function releaseInt32Array(array) {\r\n    if (typedArrayPools.int32.length < MAX_POOL_SIZE) {\r\n        array.fill(0);\r\n        typedArrayPools.int32.push(array);\r\n    }\r\n}\r\n\r\n/**\r\n * Get a Uint32Array from the pool or create a new one\r\n * @param {number} size - Length of the array\r\n * @returns {Uint32Array} - A Uint32Array of the specified size\r\n */\r\nexport function getUint32Array(size) {\r\n    const pool = typedArrayPools.uint32;\r\n    \r\n    for (let i = 0; i < pool.length; i++) {\r\n        if (pool[i].length >= size) {\r\n            const array = pool.splice(i, 1)[0];\r\n            return array;\r\n        }\r\n    }\r\n    \r\n    return new Uint32Array(size);\r\n}\r\n\r\n/**\r\n * Release a Uint32Array back to the pool\r\n * @param {Uint32Array} array - The array to release\r\n */\r\nexport function releaseUint32Array(array) {\r\n    if (typedArrayPools.uint32.length < MAX_POOL_SIZE) {\r\n        array.fill(0);\r\n        typedArrayPools.uint32.push(array);\r\n    }\r\n}\r\n\r\n/**\r\n * Get a Uint16Array from the pool or create a new one\r\n * @param {number} size - Length of the array\r\n * @returns {Uint16Array} - A Uint16Array of the specified size\r\n */\r\nexport function getUint16Array(size) {\r\n    const pool = typedArrayPools.uint16;\r\n    \r\n    for (let i = 0; i < pool.length; i++) {\r\n        if (pool[i].length >= size) {\r\n            const array = pool.splice(i, 1)[0];\r\n            return array;\r\n        }\r\n    }\r\n    \r\n    return new Uint16Array(size);\r\n}\r\n\r\n/**\r\n * Release a Uint16Array back to the pool\r\n * @param {Uint16Array} array - The array to release\r\n */\r\nexport function releaseUint16Array(array) {\r\n    if (typedArrayPools.uint16.length < MAX_POOL_SIZE) {\r\n        array.fill(0);\r\n        typedArrayPools.uint16.push(array);\r\n    }\r\n}\r\n\r\n/**\r\n * Get a Uint8Array from the pool or create a new one\r\n * @param {number} size - Length of the array\r\n * @returns {Uint8Array} - A Uint8Array of the specified size\r\n */\r\nexport function getUint8Array(size) {\r\n    const pool = typedArrayPools.uint8;\r\n    \r\n    for (let i = 0; i < pool.length; i++) {\r\n        if (pool[i].length >= size) {\r\n            const array = pool.splice(i, 1)[0];\r\n            return array;\r\n        }\r\n    }\r\n    \r\n    return new Uint8Array(size);\r\n}\r\n\r\n/**\r\n * Release a Uint8Array back to the pool\r\n * @param {Uint8Array} array - The array to release\r\n */\r\nexport function releaseUint8Array(array) {\r\n    if (typedArrayPools.uint8.length < MAX_POOL_SIZE) {\r\n        array.fill(0);\r\n        typedArrayPools.uint8.push(array);\r\n    }\r\n}\r\n\r\n/**\r\n * Creates a pooled THREE.js BufferAttribute\r\n * @param {number} size - Number of vertices\r\n * @param {number} itemSize - Number of values per vertex (e.g. 3 for position, 2 for UV)\r\n * @returns {THREE.BufferAttribute} - A buffer attribute backed by a pooled typed array\r\n */\r\nexport function createPooledBufferAttribute(size, itemSize) {\r\n    const array = getFloat32Array(size * itemSize);\r\n    return new THREE.BufferAttribute(array, itemSize);\r\n}\r\n\r\n/**\r\n * Releases a pooled buffer attribute back to the pool\r\n * @param {THREE.BufferAttribute} attribute - The buffer attribute to release\r\n */\r\nexport function releasePooledBufferAttribute(attribute) {\r\n    if (attribute && attribute.array instanceof Float32Array) {\r\n        releaseFloat32Array(attribute.array);\r\n        attribute.array = null;\r\n    }\r\n}\r\n\r\n/**\r\n * Fixed-size array implementation to avoid dynamic array resizing\r\n */\r\nexport class FixedArray {\r\n    /**\r\n     * @param {number} size - Maximum size of the array\r\n     */\r\n    constructor(size) {\r\n        this.data = new Array(size);\r\n        this.length = 0;\r\n        this.capacity = size;\r\n    }\r\n    \r\n    /**\r\n     * Add an item to the array\r\n     * @param {*} item - Item to add\r\n     * @returns {boolean} - True if item was added, false if array is full\r\n     */\r\n    push(item) {\r\n        if (this.length < this.capacity) {\r\n            this.data[this.length++] = item;\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n    \r\n    /**\r\n     * Remove and return the last item\r\n     * @returns {*} - The last item or undefined if empty\r\n     */\r\n    pop() {\r\n        if (this.length === 0) return undefined;\r\n        const item = this.data[--this.length];\r\n        this.data[this.length] = undefined; // Avoid memory leaks\r\n        return item;\r\n    }\r\n    \r\n    /**\r\n     * Get item at index\r\n     * @param {number} index - Index to retrieve\r\n     * @returns {*} - Item at that index\r\n     */\r\n    get(index) {\r\n        if (index < 0 || index >= this.length) return undefined;\r\n        return this.data[index];\r\n    }\r\n    \r\n    /**\r\n     * Set item at index\r\n     * @param {number} index - Index to set\r\n     * @param {*} value - Value to set\r\n     */\r\n    set(index, value) {\r\n        if (index < 0 || index >= this.capacity) return;\r\n        if (index >= this.length) this.length = index + 1;\r\n        this.data[index] = value;\r\n    }\r\n    \r\n    /**\r\n     * Remove item at index\r\n     * @param {number} index - Index to remove\r\n     * @returns {boolean} - True if removal was successful\r\n     */\r\n    removeAt(index) {\r\n        if (index < 0 || index >= this.length) return false;\r\n        \r\n        // Shift all elements after index\r\n        for (let i = index; i < this.length - 1; i++) {\r\n            this.data[i] = this.data[i + 1];\r\n        }\r\n        \r\n        // Clear the last element to avoid memory leaks\r\n        this.data[--this.length] = undefined;\r\n        return true;\r\n    }\r\n    \r\n    /**\r\n     * Clear the array\r\n     */\r\n    clear() {\r\n        for (let i = 0; i < this.length; i++) {\r\n            this.data[i] = undefined;\r\n        }\r\n        this.length = 0;\r\n    }\r\n    \r\n    /**\r\n     * Iterate over each item\r\n     * @param {Function} callback - Function to call for each item\r\n     */\r\n    forEach(callback) {\r\n        for (let i = 0; i < this.length; i++) {\r\n            callback(this.data[i], i, this);\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Map array items to a new array\r\n     * @param {Function} callback - Function to transform each item\r\n     * @returns {Array} - New array with transformed items\r\n     */\r\n    map(callback) {\r\n        const result = new Array(this.length);\r\n        for (let i = 0; i < this.length; i++) {\r\n            result[i] = callback(this.data[i], i, this);\r\n        }\r\n        return result;\r\n    }\r\n    \r\n    /**\r\n     * Filter items into a new array\r\n     * @param {Function} callback - Predicate function to test each item\r\n     * @returns {Array} - New array with items that passed the test\r\n     */\r\n    filter(callback) {\r\n        const result = [];\r\n        for (let i = 0; i < this.length; i++) {\r\n            if (callback(this.data[i], i, this)) {\r\n                result.push(this.data[i]);\r\n            }\r\n        }\r\n        return result;\r\n    }\r\n}\r\n\r\n/**\r\n * Memory usage statistics tracking\r\n */\r\nexport const MemoryStats = {\r\n    vectorPoolSize: 0,\r\n    objectPoolSizes: {},\r\n    typedArrayPoolSizes: {},\r\n    \r\n    /**\r\n     * Update memory statistics\r\n     */\r\n    update() {\r\n        // Vector pool stats\r\n        if (window.vectorPool) {\r\n            this.vectorPoolSize = window.vectorPool.pool.length;\r\n        }\r\n        \r\n        // Object pool stats\r\n        if (window.objectPool) {\r\n            for (const type in window.objectPool.pools) {\r\n                this.objectPoolSizes[type] = window.objectPool.pools[type].objects.length;\r\n            }\r\n        }\r\n        \r\n        // Typed array pool stats\r\n        for (const type in typedArrayPools) {\r\n            this.typedArrayPoolSizes[type] = typedArrayPools[type].length;\r\n        }\r\n    },\r\n    \r\n    /**\r\n     * Get a formatted report of memory usage\r\n     * @returns {string} - Formatted memory stats\r\n     */\r\n    getReport() {\r\n        this.update();\r\n        \r\n        let report = \"Memory Pool Stats:\\n\";\r\n        \r\n        // Vector pool\r\n        report += `Vector Pool: ${this.vectorPoolSize} vectors\\n`;\r\n        \r\n        // Object pools\r\n        report += \"Object Pools:\\n\";\r\n        for (const type in this.objectPoolSizes) {\r\n            report += `  ${type}: ${this.objectPoolSizes[type]} objects\\n`;\r\n        }\r\n        \r\n        // Typed array pools\r\n        report += \"Typed Array Pools:\\n\";\r\n        for (const type in this.typedArrayPoolSizes) {\r\n            report += `  ${type}: ${this.typedArrayPoolSizes[type]} arrays\\n`;\r\n        }\r\n        \r\n        return report;\r\n    },\r\n    \r\n    /**\r\n     * Print memory stats to console\r\n     */\r\n    logReport() {\r\n        console.log(this.getReport());\r\n    }\r\n};\r\n\r\n// Make MemoryStats globally available for debug purposes\r\nwindow.MemoryStats = MemoryStats;\r\n\r\n// Export a no-op function that can replace often-created objects\r\n// to help identify memory hot spots\r\nexport function createNoOpVector() {\r\n    if (window.DEBUG_MODE) {\r\n        console.trace(\"Vector created at:\");\r\n    }\r\n    return window.vectorPool ? window.vectorPool.get() : { x: 0, y: 0, z: 0 };\r\n} ","/**\r\n * CombatSystem - Manages combat interactions between entities\r\n * \r\n * Handles projectile collisions, damage application, and combat effects\r\n */\r\n\r\nimport { System } from '../../core/system.js';\r\nimport { HealthComponent } from '../../components/combat/healthComponent.js';\r\nimport { TransformComponent } from '../../components/transform.js';\r\nimport { RigidbodyComponent } from '../../components/physics/rigidbody.js';\r\nimport { MeshComponent } from '../../components/rendering/mesh.js';\r\nimport { FixedArray } from '../../utils/memoryManager.js';\r\nimport * as THREE from 'three';\r\n\r\nexport class CombatSystem extends System {\r\n    constructor(world) {\r\n        super(world);\r\n        this.requiredComponents = ['TransformComponent', 'RigidbodyComponent'];\r\n        this.priority = 50; // Run after enemy AI and player input\r\n        \r\n        // Projectile tracking\r\n        this.projectiles = new Set();\r\n        \r\n        // Combat statistics\r\n        this.damageDealt = 0;\r\n        this.damageReceived = 0;\r\n        \r\n        // Pre-allocated arrays for entity filtering\r\n        this.cachedProjectiles = new FixedArray(100);\r\n        this.cachedEnemies = new FixedArray(50);\r\n        this.cachedPlayers = new FixedArray(5);\r\n        \r\n        // Reusable vectors for calculations\r\n        this.hitPosition = new THREE.Vector3();\r\n        this.effectPosition = new THREE.Vector3();\r\n        \r\n        // Setup event listeners\r\n        this.setupEventListeners();\r\n    }\r\n    \r\n    /**\r\n     * Set up event listeners for combat-related events\r\n     */\r\n    setupEventListeners() {\r\n        // Listen for projectile creation events\r\n        this.world.messageBus.subscribe('weapon.fired', this.handleProjectileCreated.bind(this));\r\n        this.world.messageBus.subscribe('turret.fire', this.handleProjectileCreated.bind(this));\r\n        this.world.messageBus.subscribe('missile.fired', this.handleProjectileCreated.bind(this));\r\n        \r\n        // Listen for entity damaged events to track stats\r\n        this.world.messageBus.subscribe('entity.damaged', this.handleEntityDamaged.bind(this));\r\n    }\r\n    \r\n    /**\r\n     * Update all entities relevant to combat\r\n     * @param {number} deltaTime Time since last update in seconds\r\n     */\r\n    update(deltaTime) {\r\n        // Advance optimized projectile store if present\r\n        if (this.world && this.world.optimizedProjectiles && typeof this.world.optimizedProjectiles.update === 'function') {\r\n            this.world.optimizedProjectiles.update(deltaTime);\r\n        }\r\n        // Get all entities with transforms (potential targets)\r\n        // Use the correct method to get entities - entityManager.getEntities()\r\n        const entities = this.world.entityManager.getEntities();\r\n        \r\n        // Check for projectile collisions\r\n        this.checkProjectileCollisions(entities);\r\n        \r\n        // Remove any tracked projectiles that no longer exist\r\n        this.cleanupInvalidProjectiles();\r\n    }\r\n    \r\n    /**\r\n     * Remove projectiles that are no longer valid (missing components or destroyed)\r\n     */\r\n    cleanupInvalidProjectiles() {\r\n        // Get all current projectile entities\r\n        const validProjectileIds = new Set();\r\n        const projectiles = this.world.entityManager.getEntitiesByTag('projectile');\r\n        const enemyProjectiles = this.world.entityManager.getEntitiesByTag('enemyProjectile');\r\n        \r\n        // Add all valid projectile IDs to the set\r\n        [...projectiles, ...enemyProjectiles].forEach(p => {\r\n            if (p && p.id) { // Add null check for safety\r\n                validProjectileIds.add(p.id);\r\n            }\r\n        });\r\n        \r\n        // Remove any tracked projectiles that aren't in the valid set\r\n        for (const projectileId of this.projectiles) {\r\n            if (!validProjectileIds.has(projectileId)) {\r\n                console.log(`Removing invalid projectile ${projectileId} from tracking`);\r\n                this.projectiles.delete(projectileId);\r\n            }\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Check projectiles for collision with entities\r\n     * @param {Array} entities All entities in the world\r\n     */\r\n    checkProjectileCollisions(entities) {\r\n        const projectiles = this.world.entityManager.getEntitiesByTag('projectile');\r\n        const enemyProjectiles = this.world.entityManager.getEntitiesByTag('enemyProjectile');\r\n        \r\n        // Clear our cached arrays\r\n        this.cachedProjectiles.clear();\r\n        this.cachedEnemies.clear();\r\n        this.cachedPlayers.clear();\r\n        \r\n        // Filter entities only once and store in cached arrays\r\n        for (let i = 0; i < entities.length; i++) {\r\n            const entity = entities[i];\r\n            if (entity.hasTag('enemy') || entity.hasComponent('EnemyAIComponent')) {\r\n                this.cachedEnemies.push(entity);\r\n            } else if (entity.hasTag('player')) {\r\n                this.cachedPlayers.push(entity);\r\n            }\r\n        }\r\n        \r\n        // Combine projectiles into our cached array\r\n        for (let i = 0; i < projectiles.length; i++) {\r\n            this.cachedProjectiles.push(projectiles[i]);\r\n        }\r\n        \r\n        for (let i = 0; i < enemyProjectiles.length; i++) {\r\n            this.cachedProjectiles.push(enemyProjectiles[i]);\r\n        }\r\n        \r\n        // Log number of projectiles if any are found\r\n        if (this.cachedProjectiles.length > 0) {\r\n            console.log(`CombatSystem: Checking ${this.cachedProjectiles.length} projectiles for collisions`);\r\n        }\r\n        \r\n        // Check each projectile against potential targets\r\n        for (let i = 0; i < this.cachedProjectiles.length; i++) {\r\n            const projectile = this.cachedProjectiles.get(i);\r\n            \r\n            try {\r\n                // Track this projectile if not already tracked\r\n                if (!this.projectiles.has(projectile.id)) {\r\n                    this.projectiles.add(projectile.id);\r\n                }\r\n                \r\n                const projectileTransform = projectile.getComponent(TransformComponent);\r\n                const projectileRigidbody = projectile.getComponent(RigidbodyComponent);\r\n                \r\n                if (!projectileTransform || !projectileRigidbody) {\r\n                    console.log(`Projectile ${projectile.id} missing transform or rigidbody component`);\r\n                    continue;\r\n                }\r\n                \r\n                // Determine if this is a player projectile or enemy projectile\r\n                const isPlayerProjectile = projectile._isPlayerProjectile || \r\n                                          projectile.hasTag('projectile') || \r\n                                          projectile.hasTag('playerProjectile');\r\n                                          \r\n                const isEnemyProjectile = projectile._isEnemyProjectile || \r\n                                         projectile.hasTag('enemyProjectile');\r\n                \r\n                // Skip projectile if it has no velocity (inactive)\r\n                if (projectileRigidbody.velocity.lengthSq() < 0.1) continue;\r\n                \r\n                // Use our cached arrays for better performance\r\n                const targets = isPlayerProjectile ? this.cachedEnemies : \r\n                               (isEnemyProjectile ? this.cachedPlayers : entities);\r\n                \r\n                // Set up raycaster for mesh-based collision detection\r\n                const raycaster = new THREE.Raycaster();\r\n                \r\n                // Use current projectile position and velocity direction\r\n                const projectilePosition = projectileTransform.position.clone();\r\n                const projectileDirection = projectileRigidbody.velocity.clone().normalize();\r\n                \r\n                // Set origin point for ray slightly behind projectile to catch collisions even at high speeds\r\n                const rayOffset = projectileDirection.clone().multiplyScalar(-10);\r\n                const rayOrigin = projectilePosition.clone().add(rayOffset);\r\n                \r\n                // Configure raycaster with proper near and far clipping\r\n                raycaster.set(rayOrigin, projectileDirection);\r\n                raycaster.near = 0;\r\n                raycaster.far = 50; // Detect collisions up to 50 units ahead\r\n                \r\n                // Debug info\r\n                console.log(`Raycaster for projectile ${projectile.id} - Origin: (${rayOrigin.x.toFixed(1)}, ${rayOrigin.y.toFixed(1)}, ${rayOrigin.z.toFixed(1)}), Direction: (${projectileDirection.x.toFixed(2)}, ${projectileDirection.y.toFixed(2)}, ${projectileDirection.z.toFixed(2)})`);\r\n                \r\n                let targetHit = false;\r\n                \r\n                // Check for collisions with all potential targets\r\n                for (let j = 0; j < targets.length; j++) {\r\n                    const target = targets.get ? targets.get(j) : targets[j];\r\n                    \r\n                    // Skip if target is destroyed\r\n                    if (target.destroyed) continue;\r\n                    \r\n                    // Skip self-collision\r\n                    if (target.id === projectile.id) continue;\r\n                    \r\n                    // Get the mesh component for collision testing\r\n                    const meshComponent = target.getComponent(MeshComponent);\r\n                    \r\n                    // Skip if no mesh component or mesh\r\n                    if (!meshComponent || !meshComponent.mesh) {\r\n                        console.log(`Target ${target.id} has no mesh component or mesh`);\r\n                        continue;\r\n                    }\r\n                    \r\n                    // Debug the mesh properties\r\n                    console.log(`Testing collision with target ${target.id}, mesh visible: ${meshComponent.mesh.visible}, mesh children: ${meshComponent.mesh.children ? meshComponent.mesh.children.length : 0}`);\r\n                    \r\n                    // Ensure mesh is visible and has geometry\r\n                    if (!meshComponent.mesh.visible) {\r\n                        console.log(`Mesh for ${target.id} is not visible, skipping`);\r\n                        continue;\r\n                    }\r\n                    \r\n                    // Perform the intersection test with entire mesh hierarchy (true for recursive)\r\n                    const intersections = raycaster.intersectObject(meshComponent.mesh, true);\r\n                    \r\n                    if (intersections.length > 0) {\r\n                        // We have a mesh intersection!\r\n                        const intersection = intersections[0]; // closest intersection\r\n                        \r\n                        // Debug information\r\n                        console.log(`MESH HIT! Projectile ${projectile.id} hit ${target.id} at distance ${intersection.distance.toFixed(2)}`);\r\n                        console.log(`Hit point: (${intersection.point.x.toFixed(1)}, ${intersection.point.y.toFixed(1)}, ${intersection.point.z.toFixed(1)})`);\r\n                        \r\n                        if (intersection.object) {\r\n                            console.log(`Hit specific mesh: ${intersection.object.name || 'unnamed'}`);\r\n                        }\r\n                        \r\n                        // Use the hit point for effects\r\n                        this.hitPosition.copy(intersection.point);\r\n                        \r\n                        // Handle the collision\r\n                        this.handleProjectileCollision(projectile, target);\r\n                        \r\n                        // Destroy projectile after hit\r\n                        try {\r\n                            this.world.destroyEntity(projectile.id);\r\n                            this.projectiles.delete(projectile.id);\r\n                            targetHit = true;\r\n                        } catch (e) {\r\n                            console.error(\"Failed to destroy projectile after hit:\", e);\r\n                        }\r\n                        \r\n                        // Break out of target loop - projectile hits only one target\r\n                        break;\r\n                    } else {\r\n                        // Debug when no intersection is found\r\n                        const targetTransform = target.getComponent(TransformComponent);\r\n                        if (targetTransform) {\r\n                            const distance = projectilePosition.distanceTo(targetTransform.position);\r\n                            console.log(`No intersection with ${target.id} at distance ${distance.toFixed(1)}`);\r\n                        }\r\n                    }\r\n                }\r\n                \r\n                // If we hit a target, skip to the next projectile\r\n                if (targetHit) continue;\r\n                \r\n            } catch (error) {\r\n                console.error(`Error processing projectile ${projectile.id}:`, error);\r\n            }\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Handle a projectile collision with a target\r\n     * @param {Entity} projectile Projectile entity\r\n     * @param {Entity} target Target entity\r\n     */\r\n    handleProjectileCollision(projectile, target) {\r\n        // Determine damage amount\r\n        let damage = 10; // Default damage\r\n        const source = projectile.userData?.source;\r\n        \r\n        // Get damage from userData if available\r\n        if (projectile.userData && projectile.userData.damage) {\r\n            damage = projectile.userData.damage;\r\n        } else if (projectile.sourceComponent) {\r\n            // Alternative: get damage from source component\r\n            damage = projectile.sourceComponent.damage;\r\n        }\r\n        \r\n        // Apply damage to target\r\n        const targetHealth = target.getComponent(HealthComponent);\r\n        if (targetHealth) {\r\n            const damageType = projectile.userData?.attackType || 'projectile';\r\n            const damageResult = targetHealth.applyDamage(damage, damageType, source);\r\n            \r\n            // Create hit effect\r\n            this.createHitEffect(projectile, target, damageResult);\r\n            \r\n            // Track statistics based on hit entity type\r\n            if (target.hasTag('player')) {\r\n                this.damageReceived += damageResult.damageApplied;\r\n            } else if (target.hasTag('enemy')) {\r\n                this.damageDealt += damageResult.damageApplied;\r\n            }\r\n            \r\n            // Get position using our reusable vector\r\n            const projectileTransform = projectile.getComponent(TransformComponent);\r\n            if (projectileTransform) {\r\n                this.hitPosition.copy(projectileTransform.position);\r\n            } else {\r\n                this.hitPosition.set(0, 0, 0);\r\n            }\r\n            \r\n            // Publish hit event\r\n            this.world.messageBus.publish('combat.hit', {\r\n                projectile: projectile,\r\n                target: target,\r\n                damage: damageResult.damageApplied,\r\n                shieldDamage: damageResult.shieldDamage,\r\n                healthDamage: damageResult.healthDamage,\r\n                destroyed: damageResult.destroyed,\r\n                position: this.hitPosition // Pass direct reference for better performance\r\n            });\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Create a visual effect for a projectile hit\r\n     * @param {Entity} projectile Projectile entity\r\n     * @param {Entity} target Target entity\r\n     * @param {object} damageResult Result of damage application\r\n     */\r\n    createHitEffect(projectile, target, damageResult) {\r\n        // Get projectile information\r\n        const projectileTransform = projectile.getComponent(TransformComponent);\r\n        if (!projectileTransform) return;\r\n        \r\n        // Determine hit effect based on damage type and result\r\n        let effectColor = 0xff5500; // Default orange hit\r\n        let effectSize = 1;\r\n        \r\n        // Shield hit has blue color\r\n        if (damageResult.shieldDamage > 0) {\r\n            effectColor = 0x3399ff; // Blue for shield hit\r\n            effectSize = 1.5;\r\n        }\r\n        \r\n        // Critical hit has red color and larger size\r\n        if (damageResult.healthDamage > 20) {\r\n            effectColor = 0xff0000; // Red for critical hit\r\n            effectSize = 2;\r\n        }\r\n        \r\n        // Use our cached effect position\r\n        this.effectPosition.copy(projectileTransform.position);\r\n        \r\n        // Create hit effect using object pool\r\n        // Check for hit effect pool availability\r\n        let hitEffect;\r\n        const objectPoolAvailable = window.objectPool && \r\n                                    window.objectPool.pools && \r\n                                    window.objectPool.pools['hitEffect'];\r\n                                    \r\n        if (objectPoolAvailable) {\r\n            // Get hit effect from pool\r\n            hitEffect = window.objectPool.get('hitEffect', effectColor, effectSize);\r\n        } else {\r\n            // Fallback to creating a new effect if pool unavailable\r\n            hitEffect = this.createNewHitEffect(effectColor, effectSize);\r\n        }\r\n        \r\n        if (hitEffect && hitEffect.mesh) {\r\n            // Position the effect\r\n            hitEffect.mesh.position.copy(this.effectPosition);\r\n            \r\n            // Add to scene if not already added\r\n            if (!hitEffect.mesh.parent) {\r\n                this.world.scene.add(hitEffect.mesh);\r\n            }\r\n            \r\n            // Start the animation\r\n            this.animateHitEffect(hitEffect, hitEffect.mesh, objectPoolAvailable);\r\n        }\r\n    }\r\n    \r\n    // Helper method to create a new hit effect - only used as fallback when object pool is unavailable\r\n    createNewHitEffect(effectColor, effectSize) {\r\n        // Use precomputed geometry if available\r\n        let geometry;\r\n        if (window.game && window.game.hitEffectGeometry) {\r\n            geometry = window.game.hitEffectGeometry;\r\n        } else if (!this.hitEffectGeometry) {\r\n            // Create and cache geometry if not available\r\n            this.hitEffectGeometry = new THREE.SphereGeometry(1, 8, 8);\r\n            geometry = this.hitEffectGeometry;\r\n        } else {\r\n            // Use cached geometry\r\n            geometry = this.hitEffectGeometry;\r\n        }\r\n        \r\n        // Create the hit effect mesh\r\n        const material = new THREE.MeshBasicMaterial({\r\n            color: effectColor,\r\n            transparent: true,\r\n            opacity: 0.8\r\n        });\r\n        \r\n        const mesh = new THREE.Mesh(geometry, material);\r\n        mesh.scale.set(effectSize, effectSize, effectSize);\r\n        \r\n        return { mesh, material };\r\n    }\r\n    \r\n    /**\r\n     * Animate a hit effect\r\n     * @param {object} hitEffect The hit effect object\r\n     * @param {THREE.Mesh} effectMesh The effect mesh\r\n     * @param {boolean} useObjectPool Whether to return the object to pool after animation\r\n     */\r\n    animateHitEffect(hitEffect, effectMesh, useObjectPool = true) {\r\n        let scale = 1.0;\r\n        let opacity = 0.8;\r\n        \r\n        const animate = () => {\r\n            // Increase scale\r\n            scale += 0.1;\r\n            opacity -= 0.05;\r\n            \r\n            // Update mesh\r\n            if (effectMesh && effectMesh.scale) {\r\n                effectMesh.scale.set(scale, scale, scale);\r\n                \r\n                if (hitEffect.material) {\r\n                    hitEffect.material.opacity = opacity;\r\n                }\r\n                \r\n                // Continue animation until opacity reaches 0\r\n                if (opacity > 0) {\r\n                    requestAnimationFrame(animate);\r\n                } else {\r\n                    // Clean up effect when animation is done\r\n                    if (effectMesh.parent) {\r\n                        effectMesh.parent.remove(effectMesh);\r\n                    }\r\n                    \r\n                    // Return to pool if using object pooling\r\n                    if (useObjectPool && window.objectPool && window.objectPool.pools['hitEffect']) {\r\n                        window.objectPool.release('hitEffect', hitEffect);\r\n                    } else if (!useObjectPool) {\r\n                        // Dispose of material if not using object pooling\r\n                        if (hitEffect.material) {\r\n                            hitEffect.material.dispose();\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        };\r\n        \r\n        // Start animation\r\n        animate();\r\n    }\r\n    \r\n    /**\r\n     * Handle projectile creation event\r\n     * @param {object} message Event message\r\n     */\r\n    handleProjectileCreated(message) {\r\n        // Track the projectile if it has a valid entity\r\n        if (message.entity && message.entity.id) {\r\n            this.projectiles.add(message.entity.id);\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Handle entity damaged event\r\n     * @param {object} message Event message\r\n     */\r\n    handleEntityDamaged(message) {\r\n        // Update damage statistics\r\n        if (message.target) {\r\n            if (message.target.hasTag('player')) {\r\n                this.damageReceived += message.damage || 0;\r\n            } else if (message.target.hasTag('enemy')) {\r\n                this.damageDealt += message.damage || 0;\r\n            }\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Clean up when system is disabled\r\n     */\r\n    onDisabled() {\r\n        // Remove all event listeners\r\n        this.world.messageBus.unsubscribe('weapon.fired', this.handleProjectileCreated);\r\n        this.world.messageBus.unsubscribe('turret.fire', this.handleProjectileCreated);\r\n        this.world.messageBus.unsubscribe('missile.fired', this.handleProjectileCreated);\r\n        this.world.messageBus.unsubscribe('entity.damaged', this.handleEntityDamaged);\r\n    }\r\n}","/**\r\n * TrailComponent - Creates a plasma energy trail with dynamic geometry\r\n * \r\n * Uses advanced shader effects to create a dynamic plasma trail with electric arcs\r\n */\r\n\r\nimport { Component } from '../../core/component.js';\r\nimport * as THREE from 'three';\r\n\r\nexport class TrailComponent extends Component {\r\n    /**\r\n     * Creates a new plasma trail component\r\n     * @param {Object} config Trail configuration\r\n     */\r\n    constructor(config = {}) {\r\n        super();\r\n        \r\n        // Trail configuration\r\n        this.maxPoints = config.maxPoints || 60;          // More points for smoother trail\r\n        this.pointDistance = config.pointDistance || 2;   // Smaller distance for smoother trail\r\n        this.width = config.width || 15;                  // Base trail width\r\n        this.color = config.color || 0x00ddff;            // Plasma blue color\r\n        this.coreColor = config.coreColor || 0xffffff;    // White hot core\r\n        this.fadeTime = config.fadeTime || 0.8;           // Faster fade for energy effect\r\n        this.transparent = config.transparent !== undefined ? config.transparent : true;\r\n        this.alphaTest = config.alphaTest || 0.01;\r\n        this.blending = config.blending || THREE.AdditiveBlending;\r\n        this.pulse = config.pulse !== undefined ? config.pulse : true;  // Enable pulsing by default\r\n        this.pulseSpeed = config.pulseSpeed || 2.0;       // Faster pulsing\r\n        this.tapering = config.tapering !== undefined ? config.tapering : true;  // Enable tapering\r\n        this.glow = config.glow !== undefined ? config.glow : true;  // Enable glow\r\n        this.thrustPower = 0;                             // Current thrust power (0-1)\r\n        this.trailType = config.trailType || 'main';      // Type of trail (main, left, right)\r\n        \r\n        // Internal state\r\n        this.points = [];                                 // Trail points\r\n        this.times = [];                                  // Time each point was added\r\n        this.widths = [];                                 // Width at each point\r\n        this.lastPosition = new THREE.Vector3();          // Last recorded position\r\n        this.initialized = false;                         // Whether trail has been initialized\r\n        this.trailMesh = null;                            // Main trail mesh\r\n        this.coreMesh = null;                             // Core energy mesh\r\n        this.electricArcs = [];                           // Electric arc effects\r\n        this.trailGeometry = null;                        // Trail geometry\r\n        this.trailMaterial = null;                        // Trail material\r\n        this.isActive = true;                             // Whether trail is active\r\n        this.time = 0;                                    // Time accumulator for animations\r\n    }\r\n    \r\n    /**\r\n     * Called when component is attached to an entity\r\n     */\r\n    onAttached() {\r\n        if (!this.entity) return;\r\n        \r\n        // Get transform component\r\n        const transform = this.entity.getComponent('TransformComponent');\r\n        if (!transform) {\r\n            console.warn('TrailComponent requires a TransformComponent on the entity');\r\n            return;\r\n        }\r\n        \r\n        // Initialize trail with current position\r\n        this.lastPosition.copy(transform.position);\r\n        this.initializeTrail();\r\n    }\r\n    \r\n    /**\r\n     * Initialize plasma trail visuals with dynamic geometry\r\n     */\r\n    initializeTrail() {\r\n        // Create dynamic ribbon geometry for smooth trail\r\n        const vertices = [];\r\n        const uvs = [];\r\n        \r\n        // Create ribbon vertices (2 vertices per point for width)\r\n        for (let i = 0; i < this.maxPoints; i++) {\r\n            vertices.push(0, 0, 0); // Left vertex\r\n            vertices.push(0, 0, 0); // Right vertex\r\n            uvs.push(0, i / this.maxPoints);\r\n            uvs.push(1, i / this.maxPoints);\r\n        }\r\n        \r\n        // Create faces for ribbon\r\n        const indices = [];\r\n        for (let i = 0; i < this.maxPoints - 1; i++) {\r\n            const a = i * 2;\r\n            const b = i * 2 + 1;\r\n            const c = i * 2 + 2;\r\n            const d = i * 2 + 3;\r\n            \r\n            // Two triangles per segment\r\n            indices.push(a, b, c);\r\n            indices.push(b, d, c);\r\n        }\r\n        \r\n        this.trailGeometry = new THREE.BufferGeometry();\r\n        this.trailGeometry.setAttribute('position', new THREE.Float32BufferAttribute(vertices, 3));\r\n        this.trailGeometry.setAttribute('uv', new THREE.Float32BufferAttribute(uvs, 2));\r\n        this.trailGeometry.setIndex(indices);\r\n        \r\n        // Add custom attributes for effects\r\n        const alphas = new Float32Array(this.maxPoints * 2);\r\n        const energyLevels = new Float32Array(this.maxPoints * 2);\r\n        this.trailGeometry.setAttribute('alpha', new THREE.BufferAttribute(alphas, 1));\r\n        this.trailGeometry.setAttribute('energy', new THREE.BufferAttribute(energyLevels, 1));\r\n        \r\n        // Create plasma shader material\r\n        this.trailMaterial = new THREE.ShaderMaterial({\r\n            uniforms: {\r\n                time: { value: 0 },\r\n                color: { value: new THREE.Color(this.color) },\r\n                coreColor: { value: new THREE.Color(this.coreColor) },\r\n                thrustPower: { value: 0 },\r\n                opacity: { value: 1.0 }\r\n            },\r\n            vertexShader: `\r\n                attribute float alpha;\r\n                attribute float energy;\r\n                varying float vAlpha;\r\n                varying float vEnergy;\r\n                varying vec2 vUv;\r\n                \r\n                void main() {\r\n                    vAlpha = alpha;\r\n                    vEnergy = energy;\r\n                    vUv = uv;\r\n                    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\r\n                }\r\n            `,\r\n            fragmentShader: `\r\n                uniform float time;\r\n                uniform vec3 color;\r\n                uniform vec3 coreColor;\r\n                uniform float thrustPower;\r\n                uniform float opacity;\r\n                \r\n                varying float vAlpha;\r\n                varying float vEnergy;\r\n                varying vec2 vUv;\r\n                \r\n                void main() {\r\n                    // Create plasma effect with hot core\r\n                    float coreIntensity = 1.0 - abs(vUv.x - 0.5) * 2.0;\r\n                    coreIntensity = pow(coreIntensity, 2.0);\r\n                    \r\n                    // Energy pulse effect\r\n                    float pulse = sin(time * 4.0 + vUv.y * 10.0) * 0.2 + 0.8;\r\n                    \r\n                    // Mix core and outer colors\r\n                    vec3 finalColor = mix(color, coreColor, coreIntensity * vEnergy);\r\n                    \r\n                    // Add electric arc effect\r\n                    float arc = sin(vUv.y * 50.0 + time * 20.0) * 0.1;\r\n                    finalColor += vec3(arc) * vEnergy;\r\n                    \r\n                    // Apply alpha and energy\r\n                    float finalAlpha = vAlpha * coreIntensity * pulse * opacity * thrustPower;\r\n                    \r\n                    gl_FragColor = vec4(finalColor, finalAlpha);\r\n                }\r\n            `,\r\n            transparent: true,\r\n            blending: THREE.AdditiveBlending,\r\n            side: THREE.DoubleSide,\r\n            depthWrite: false\r\n        });\r\n        \r\n        // Create the trail mesh\r\n        this.trailMesh = new THREE.Mesh(this.trailGeometry, this.trailMaterial);\r\n        this.trailMesh.frustumCulled = false;\r\n        \r\n        // Create additional core energy line for extra glow\r\n        const coreGeometry = new THREE.BufferGeometry();\r\n        const corePositions = new Float32Array(this.maxPoints * 3);\r\n        coreGeometry.setAttribute('position', new THREE.BufferAttribute(corePositions, 3));\r\n        coreGeometry.setDrawRange(0, 0);\r\n        \r\n        const coreMaterial = new THREE.LineBasicMaterial({\r\n            color: this.coreColor,\r\n            linewidth: 2,\r\n            transparent: true,\r\n            opacity: 0.8,\r\n            blending: THREE.AdditiveBlending\r\n        });\r\n        \r\n        this.coreMesh = new THREE.Line(coreGeometry, coreMaterial);\r\n        this.coreMesh.frustumCulled = false;\r\n        \r\n        // Mark as initialized\r\n        this.initialized = true;\r\n        \r\n        // Add to scene if available\r\n        if (this.entity && this.entity.world && this.entity.world.scene) {\r\n            this.entity.world.scene.add(this.trailMesh);\r\n            this.entity.world.scene.add(this.coreMesh);\r\n        } else if (window.game && window.game.scene) {\r\n            window.game.scene.add(this.trailMesh);\r\n            window.game.scene.add(this.coreMesh);\r\n        } else {\r\n            console.warn('TrailComponent: No scene available to add trail mesh');\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Called when component is detached from an entity\r\n     */\r\n    onDetached() {\r\n        // Clean up THREE.js objects\r\n        if (this.trailMesh && this.trailMesh.parent) {\r\n            this.trailMesh.parent.remove(this.trailMesh);\r\n        }\r\n        \r\n        if (this.coreMesh && this.coreMesh.parent) {\r\n            this.coreMesh.parent.remove(this.coreMesh);\r\n        }\r\n        \r\n        // Clean up electric arcs\r\n        for (const arc of this.electricArcs) {\r\n            if (arc.mesh && arc.mesh.parent) {\r\n                arc.mesh.parent.remove(arc.mesh);\r\n                if (arc.mesh.geometry) arc.mesh.geometry.dispose();\r\n                if (arc.mesh.material) arc.mesh.material.dispose();\r\n            }\r\n        }\r\n        this.electricArcs = [];\r\n        \r\n        if (this.trailGeometry) {\r\n            this.trailGeometry.dispose();\r\n        }\r\n        \r\n        if (this.trailMaterial) {\r\n            this.trailMaterial.dispose();\r\n        }\r\n        \r\n        if (this.coreMesh && this.coreMesh.geometry) {\r\n            this.coreMesh.geometry.dispose();\r\n        }\r\n        \r\n        if (this.coreMesh && this.coreMesh.material) {\r\n            this.coreMesh.material.dispose();\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Update the plasma trail\r\n     * @param {number} deltaTime Time since last update in seconds\r\n     * @param {number} thrustPower Current thrust power (0-1)\r\n     */\r\n    update(deltaTime, thrustPower = 0) {\r\n        if (!this.initialized || !this.isActive || !this.entity) return;\r\n        \r\n        this.time += deltaTime;\r\n        this.thrustPower = thrustPower;\r\n        \r\n        // Get transform\r\n        const transform = this.entity.getComponent('TransformComponent');\r\n        if (!transform) return;\r\n        \r\n        // Calculate distance moved\r\n        const distance = transform.position.distanceTo(this.lastPosition);\r\n        \r\n        // Only add new point if moved enough distance or thrusting\r\n        if (distance >= this.pointDistance || thrustPower > 0.1) {\r\n            // Add current position to points array\r\n            this.points.unshift(transform.position.clone());\r\n            this.times.unshift(performance.now());\r\n            this.widths.unshift(this.width * (0.5 + thrustPower * 0.5)); // Dynamic width based on thrust\r\n            \r\n            // Limit number of points\r\n            if (this.points.length > this.maxPoints) {\r\n                this.points.pop();\r\n                this.times.pop();\r\n                this.widths.pop();\r\n            }\r\n            \r\n            // Update last position\r\n            this.lastPosition.copy(transform.position);\r\n            \r\n            // Update trail visual\r\n            this.updateTrailGeometry();\r\n        }\r\n        \r\n        // Update shader uniforms\r\n        if (this.trailMaterial && this.trailMaterial.uniforms) {\r\n            this.trailMaterial.uniforms.time.value = this.time;\r\n            this.trailMaterial.uniforms.thrustPower.value = thrustPower;\r\n        }\r\n        \r\n        // Always update trail effects\r\n        this.updateTrailEffects(deltaTime);\r\n    }\r\n    \r\n    /**\r\n     * Update plasma trail ribbon geometry\r\n     */\r\n    updateTrailGeometry() {\r\n        if (!this.trailGeometry || this.points.length < 2) return;\r\n        \r\n        const positions = this.trailGeometry.attributes.position.array;\r\n        const alphas = this.trailGeometry.attributes.alpha.array;\r\n        const energies = this.trailGeometry.attributes.energy.array;\r\n        \r\n        // Get transform for orientation\r\n        const transform = this.entity.getComponent('TransformComponent');\r\n        if (!transform) return;\r\n        \r\n        // Update ribbon vertices\r\n        for (let i = 0; i < this.points.length; i++) {\r\n            const point = this.points[i];\r\n            const width = this.widths[i] || this.width;\r\n            \r\n            // Calculate perpendicular vector for ribbon width\r\n            let perpVector;\r\n            if (i < this.points.length - 1) {\r\n                const nextPoint = this.points[i + 1];\r\n                const direction = new THREE.Vector3().subVectors(point, nextPoint).normalize();\r\n                perpVector = new THREE.Vector3().crossVectors(direction, new THREE.Vector3(0, 1, 0)).normalize();\r\n            } else if (i > 0) {\r\n                const prevPoint = this.points[i - 1];\r\n                const direction = new THREE.Vector3().subVectors(prevPoint, point).normalize();\r\n                perpVector = new THREE.Vector3().crossVectors(direction, new THREE.Vector3(0, 1, 0)).normalize();\r\n            } else {\r\n                perpVector = new THREE.Vector3(1, 0, 0);\r\n            }\r\n            \r\n            // Taper width based on position in trail\r\n            const taperFactor = this.tapering ? (1 - i / this.points.length) : 1;\r\n            const currentWidth = width * taperFactor;\r\n            \r\n            // Set left and right vertices\r\n            const leftVertex = point.clone().add(perpVector.clone().multiplyScalar(currentWidth * 0.5));\r\n            const rightVertex = point.clone().sub(perpVector.clone().multiplyScalar(currentWidth * 0.5));\r\n            \r\n            positions[i * 6] = leftVertex.x;\r\n            positions[i * 6 + 1] = leftVertex.y;\r\n            positions[i * 6 + 2] = leftVertex.z;\r\n            positions[i * 6 + 3] = rightVertex.x;\r\n            positions[i * 6 + 4] = rightVertex.y;\r\n            positions[i * 6 + 5] = rightVertex.z;\r\n            \r\n            // Calculate fade based on time\r\n            const now = performance.now();\r\n            const age = (now - this.times[i]) / 1000;\r\n            const fadeRatio = Math.max(0, 1 - (age / this.fadeTime));\r\n            \r\n            // Set alpha and energy values\r\n            alphas[i * 2] = fadeRatio;\r\n            alphas[i * 2 + 1] = fadeRatio;\r\n            energies[i * 2] = fadeRatio * this.thrustPower;\r\n            energies[i * 2 + 1] = fadeRatio * this.thrustPower;\r\n        }\r\n        \r\n        // Update core line\r\n        if (this.coreMesh && this.coreMesh.geometry) {\r\n            const corePositions = this.coreMesh.geometry.attributes.position.array;\r\n            for (let i = 0; i < this.points.length; i++) {\r\n                const point = this.points[i];\r\n                corePositions[i * 3] = point.x;\r\n                corePositions[i * 3 + 1] = point.y;\r\n                corePositions[i * 3 + 2] = point.z;\r\n            }\r\n            this.coreMesh.geometry.attributes.position.needsUpdate = true;\r\n            this.coreMesh.geometry.setDrawRange(0, this.points.length);\r\n        }\r\n        \r\n        // Mark as needing update\r\n        this.trailGeometry.attributes.position.needsUpdate = true;\r\n        this.trailGeometry.attributes.alpha.needsUpdate = true;\r\n        this.trailGeometry.attributes.energy.needsUpdate = true;\r\n    }\r\n    \r\n    /**\r\n     * Update plasma trail effects and animations\r\n     */\r\n    updateTrailEffects(deltaTime) {\r\n        if (!this.trailGeometry || this.points.length === 0) return;\r\n        \r\n        // Update electric arc effects randomly\r\n        if (Math.random() < 0.05 * this.thrustPower && this.points.length > 5) {\r\n            this.createElectricArc();\r\n        }\r\n        \r\n        // Update existing arcs\r\n        for (let i = this.electricArcs.length - 1; i >= 0; i--) {\r\n            const arc = this.electricArcs[i];\r\n            arc.life -= deltaTime;\r\n            \r\n            if (arc.life <= 0) {\r\n                // Remove expired arc\r\n                if (arc.mesh && arc.mesh.parent) {\r\n                    arc.mesh.parent.remove(arc.mesh);\r\n                    if (arc.mesh.geometry) arc.mesh.geometry.dispose();\r\n                    if (arc.mesh.material) arc.mesh.material.dispose();\r\n                }\r\n                this.electricArcs.splice(i, 1);\r\n            } else {\r\n                // Update arc opacity\r\n                if (arc.mesh && arc.mesh.material) {\r\n                    arc.mesh.material.opacity = arc.life / arc.maxLife;\r\n                }\r\n            }\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Create an electric arc effect\r\n     */\r\n    createElectricArc() {\r\n        if (this.points.length < 2) return;\r\n        \r\n        // Pick random points for arc\r\n        const startIdx = Math.floor(Math.random() * (this.points.length - 1));\r\n        const endIdx = Math.min(startIdx + Math.floor(Math.random() * 5) + 1, this.points.length - 1);\r\n        \r\n        const startPoint = this.points[startIdx];\r\n        const endPoint = this.points[endIdx];\r\n        \r\n        // Create arc geometry with jagged path\r\n        const arcPoints = [];\r\n        const segments = 5;\r\n        \r\n        for (let i = 0; i <= segments; i++) {\r\n            const t = i / segments;\r\n            const point = new THREE.Vector3().lerpVectors(startPoint, endPoint, t);\r\n            \r\n            // Add random offset for electric effect\r\n            if (i > 0 && i < segments) {\r\n                point.x += (Math.random() - 0.5) * 2;\r\n                point.y += (Math.random() - 0.5) * 2;\r\n                point.z += (Math.random() - 0.5) * 2;\r\n            }\r\n            \r\n            arcPoints.push(point);\r\n        }\r\n        \r\n        const arcGeometry = new THREE.BufferGeometry().setFromPoints(arcPoints);\r\n        const arcMaterial = new THREE.LineBasicMaterial({\r\n            color: 0xffffff,\r\n            linewidth: 2,\r\n            transparent: true,\r\n            opacity: 0.8,\r\n            blending: THREE.AdditiveBlending\r\n        });\r\n        \r\n        const arcMesh = new THREE.Line(arcGeometry, arcMaterial);\r\n        \r\n        // Add to scene\r\n        const scene = this.entity?.world?.scene || window.game?.scene;\r\n        if (scene) {\r\n            scene.add(arcMesh);\r\n            \r\n            // Track arc for cleanup\r\n            this.electricArcs.push({\r\n                mesh: arcMesh,\r\n                life: 0.2,\r\n                maxLife: 0.2\r\n            });\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Set trail active/inactive\r\n     * @param {boolean} active Whether trail should be active\r\n     */\r\n    setActive(active) {\r\n        this.isActive = active;\r\n        if (this.trailMesh) {\r\n            this.trailMesh.visible = active;\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Clear all trail points\r\n     */\r\n    clear() {\r\n        this.points = [];\r\n        this.times = [];\r\n        if (this.trailGeometry) {\r\n            this.trailGeometry.setDrawRange(0, 0);\r\n        }\r\n    }\r\n} ","/**\r\n * EnemyAIComponent - Handles enemy behavior and AI\r\n * \r\n * Controls enemy behavior with simplified kamikaze attack pattern\r\n */\r\n\r\nimport * as THREE from 'three';\r\nimport { Component } from '../../core/component.js';\r\nimport { TransformComponent } from '../transform.js';\r\nimport { HealthComponent } from './healthComponent.js';\r\n\r\nexport class EnemyAIComponent extends Component {\r\n    constructor(config = {}) {\r\n        super();\r\n        \r\n        // Store the type of enemy\r\n        this.faction = config.faction || 'spectrals';\r\n        this.type = config.type || 'drone';\r\n        this.subtype = config.subtype || 'standard'; // standard, heavy, or swift\r\n        \r\n        // Detection and engagement ranges\r\n        this.detectionRange = config.detectionRange || 2500;\r\n        \r\n        // Combat properties\r\n        this.damage = config.damage || 25;\r\n        \r\n        // Movement properties\r\n        this.speed = config.speed || 1000;\r\n        \r\n        // State tracking\r\n        this.playerFound = false;\r\n        \r\n        // Special movement parameters for spiraling pattern\r\n        this.spiralAmplitude = config.spiralAmplitude || 150; // Radius of spiral\r\n        this.spiralFrequency = config.spiralFrequency || 2.0; // How tight the spiral is\r\n        this.spiralPhase = Math.random() * Math.PI * 2; // Random starting phase\r\n        this.timeAlive = 0; // Track time for movement calculation\r\n        \r\n        // Direction vector caching\r\n        this.lastDirection = new THREE.Vector3(0, 0, 1);\r\n        \r\n        // New flag for drone-like movement\r\n        this.isDroneLike = config.isDroneLike || false;\r\n        \r\n        // Separation force response\r\n        this.separationInfluence = config.separationInfluence || 0.3; // How much separation affects movement (0-1)\r\n        this.separationForce = new THREE.Vector3(); // Store the last calculated separation force\r\n        \r\n    }\r\n    \r\n    /**\r\n     * Sets the separation force to influence movement behavior\r\n     * @param {THREE.Vector3} force The separation force vector\r\n     */\r\n    setSeparationForce(force) {\r\n        // Store the separation force for use in movement calculations\r\n        this.separationForce.copy(force);\r\n    }\r\n    \r\n    /**\r\n     * Update AI behavior - implements kamikaze attack pattern\r\n     * @param {number} deltaTime Time since last update in seconds\r\n     */\r\n    update(deltaTime) {\r\n        if (!this.entity || !this.entity.world) return;\r\n        \r\n        // Track how long this enemy has been alive\r\n        this.timeAlive += deltaTime;\r\n        \r\n        // ===== ENHANCED PLAYER DETECTION =====\r\n        let player = null;\r\n        \r\n        // METHOD 1: Check direct reference in world\r\n        try {\r\n            if (this.entity.world.playerEntity) {\r\n                player = this.entity.world.playerEntity;\r\n                //console.log(\"Found player via direct world.playerEntity reference\");\r\n            }\r\n        } catch (error) {}\r\n        \r\n        // METHOD 2: Try global window reference\r\n        if (!player && window.game && window.game.combat && window.game.combat.playerEntity) {\r\n            player = window.game.combat.playerEntity;\r\n            //console.log(\"Found player via window.game.combat.playerEntity\");\r\n        }\r\n        \r\n        // METHOD 3: Use getEntitiesByTag\r\n        if (!player) {\r\n            try {\r\n                const playerEntities = this.entity.world.getEntitiesByTag('player');\r\n                if (playerEntities && playerEntities.length > 0) {\r\n                    player = playerEntities[0];\r\n                    //console.log(\"Found player via world.getEntitiesByTag\");\r\n                }\r\n            } catch (error) {}\r\n        }\r\n        \r\n        // METHOD 4: Check entitiesByTag map\r\n        if (!player && this.entity.world.entityManager && this.entity.world.entityManager.entitiesByTag) {\r\n            try {\r\n                const playerEntities = this.entity.world.entityManager.entitiesByTag.get('player');\r\n                if (playerEntities && (playerEntities.size > 0 || playerEntities.length > 0)) {\r\n                    player = Array.from(playerEntities)[0];\r\n                    //console.log(\"Found player via entityManager.entitiesByTag map\");\r\n                }\r\n            } catch (error) {}\r\n        }\r\n        \r\n        // METHOD 5: Bruteforce search all entities\r\n        if (!player && this.entity.world.entityManager && this.entity.world.entityManager.entities) {\r\n            try {\r\n                const allEntities = Array.from(this.entity.world.entityManager.entities.values());\r\n                for (const entity of allEntities) {\r\n                    if ((entity.hasTag && entity.hasTag('player')) || \r\n                        entity.name === 'player' || \r\n                        (entity.id && entity.id.includes('player'))) {\r\n                        player = entity;\r\n                        //console.log(\"Found player via brute force entity search\");\r\n                        break;\r\n                    }\r\n                }\r\n            } catch (error) {}\r\n        }\r\n        \r\n        // METHOD 6: Check for spaceship in scene\r\n        if (!player && window.game && window.game.spaceship && window.game.spaceship.mesh) {\r\n            // Create a temporary entity if needed\r\n            \r\n            // Use the spaceship as the target without an actual entity\r\n            // We'll create a minimal object with the necessary properties\r\n            player = {\r\n                getComponent: (type) => {\r\n                    if (type === TransformComponent) {\r\n                        return {\r\n                            position: window.game.spaceship.mesh.position,\r\n                            rotation: window.game.spaceship.mesh.rotation,\r\n                            quaternion: window.game.spaceship.mesh.quaternion\r\n                        };\r\n                    }\r\n                    return null;\r\n                }\r\n            };\r\n        }\r\n        \r\n        // If still no player, we can't proceed\r\n        if (!player) {\r\n            // Only show error message occasionally to avoid console spam\r\n            return;\r\n        }\r\n        \r\n        // Get required components\r\n        const transform = this.entity.getComponent(TransformComponent);\r\n        if (!transform) {\r\n            return;\r\n        }\r\n        \r\n        // Get health component to check status\r\n        const health = this.entity.getComponent(HealthComponent);\r\n        if (health && health.isDestroyed) {\r\n            return;\r\n        }\r\n        \r\n        // Get player transform\r\n        let playerTransform = player.getComponent ? player.getComponent(TransformComponent) : null;\r\n        if (!playerTransform) {\r\n            // If using spaceship directly, playerTransform is already correctly set up\r\n            if (player.position) {\r\n                playerTransform = player;\r\n            } else {\r\n                return;\r\n            }\r\n        }\r\n        \r\n        // Log that we found the player (only once)\r\n        if (!this.playerFound) {\r\n            this.playerFound = true;\r\n        }\r\n        \r\n        // Calculate distance to player for decision-making\r\n        const distanceToPlayer = transform.position.distanceTo(playerTransform.position);\r\n        \r\n        // Calculate base direction to player\r\n        const baseDirection = new THREE.Vector3().subVectors(\r\n            playerTransform.position,\r\n            transform.position\r\n        ).normalize();\r\n        \r\n        // Cache this direction for calculations\r\n        this.lastDirection.copy(baseDirection);\r\n        \r\n        // DIFFERENT MOVEMENT PATTERNS BASED ON SUBTYPE\r\n        \r\n        // Special movement for spectral drones based on subtype\r\n        if (this.faction === 'spectrals' && this.type === 'drone') {\r\n            // Choose movement pattern based on subtype\r\n            switch (this.subtype) {\r\n                case 'heavy':\r\n                    this.applyHeavyDroneMovement(transform, playerTransform, baseDirection, distanceToPlayer, deltaTime);\r\n                    break;\r\n                case 'swift':\r\n                    this.applySwiftDroneMovement(transform, playerTransform, baseDirection, distanceToPlayer, deltaTime);\r\n                    break;\r\n                case 'standard':\r\n                default:\r\n                    // Standard drones use existing movement patterns\r\n                    if (this.isDroneLike) {\r\n                        this.applyDroneLikeMovement(transform, playerTransform, baseDirection, distanceToPlayer, deltaTime);\r\n                    } else {\r\n                        this.applySpectralDroneMovement(transform, playerTransform, baseDirection, distanceToPlayer, deltaTime);\r\n                    }\r\n                    break;\r\n            }\r\n        } else {\r\n            // Standard kamikaze movement for other enemies\r\n            transform.position.add(baseDirection.multiplyScalar(this.speed * deltaTime));\r\n            transform.lookAt(playerTransform.position);\r\n        }\r\n        \r\n        // Check for kamikaze attack condition (same for all enemies)\r\n        if (distanceToPlayer < 75) { // Collision distance\r\n            \r\n            // Get player health component\r\n            const playerHealth = player.getComponent(HealthComponent);\r\n            if (playerHealth) {\r\n                // Use the configured damage value instead of calculating from player's health\r\n                playerHealth.applyDamage(this.damage, 'collision', this.entity);\r\n                \r\n                // CRITICAL FIX: Also update the spaceship object directly to ensure damage is reflected\r\n                if (window.game && window.game.spaceship) {\r\n                    const spaceship = window.game.spaceship;\r\n                    \r\n                    // Apply damage to shields first, then hull\r\n                    if (spaceship.shield > 0) {\r\n                        if (spaceship.shield >= this.damage) {\r\n                            spaceship.shield -= this.damage;\r\n                        } else {\r\n                            const remainingDamage = this.damage - spaceship.shield;\r\n                            spaceship.shield = 0;\r\n                            spaceship.hull -= remainingDamage;\r\n                        }\r\n                    } else {\r\n                        spaceship.hull -= this.damage;\r\n                    }\r\n                    \r\n                    \r\n                    // Check for game over condition\r\n                    if (spaceship.hull <= 0 && !spaceship.isDestroyed) {\r\n                        spaceship.hull = 0;\r\n                        spaceship.isDestroyed = true;\r\n                        \r\n                        // Force game over\r\n                        if (window.game && window.game.gameOver) {\r\n                            window.game.gameOver(\"Your ship was destroyed by a kamikaze attack!\");\r\n                        }\r\n                    }\r\n                }\r\n                \r\n                // Create explosion effect using the visual effects system\r\n                if (this.entity.world && this.entity.world.messageBus) {\r\n                    this.entity.world.messageBus.publish('vfx.explosion', {\r\n                        position: transform.position.clone(),\r\n                        scale: 1.5, // Larger explosion for impact\r\n                        duration: 2.0\r\n                    });\r\n                    \r\n                    // Also create damage flash for player\r\n                    this.entity.world.messageBus.publish('vfx.damageFlash', {\r\n                        intensity: 0.3\r\n                    });\r\n                }\r\n                \r\n                // Play explosion sound if available\r\n                if (window.game && window.game.audio) {\r\n                    window.game.audio.playSound('boink');\r\n                }\r\n                \r\n                // Properly destroy this enemy entity\r\n                // Don't manually set health.isDestroyed, just let the entity system handle it\r\n                if (this.entity && this.entity.world) {\r\n                    // IMPORTANT FIX: Store entity ID locally before destruction\r\n                    const entityId = this.entity.id;\r\n                    const entityWorld = this.entity.world;\r\n                    \r\n                    // Publish a destroy event before actually destroying\r\n                    entityWorld.messageBus.publish('entity.aboutToBeDestroyed', {\r\n                        entity: this.entity,\r\n                        reason: 'kamikaze'\r\n                    });\r\n                    \r\n                    // Actually destroy the entity via world\r\n                    entityWorld.destroyEntity(entityId);\r\n                }\r\n            }\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Apply drone-like movement pattern - more realistic drone behavior\r\n     * @param {TransformComponent} transform This entity's transform\r\n     * @param {TransformComponent} playerTransform Player's transform\r\n     * @param {THREE.Vector3} baseDirection Base direction to player\r\n     * @param {number} distanceToPlayer Distance to player\r\n     * @param {number} deltaTime Delta time for frame\r\n     */\r\n    applyDroneLikeMovement(transform, playerTransform, baseDirection, distanceToPlayer, deltaTime) {\r\n        // Create an orthogonal basis for movement\r\n        const up = new THREE.Vector3(0, 1, 0);\r\n        const right = new THREE.Vector3().crossVectors(baseDirection, up).normalize();\r\n        \r\n        // In case the direction is parallel to up, we need a fallback\r\n        if (right.lengthSq() < 0.1) {\r\n            right.set(1, 0, 0); // Fallback right vector\r\n        }\r\n        \r\n        // Now get a proper up vector that's perpendicular to both\r\n        const properUp = new THREE.Vector3().crossVectors(right, baseDirection).normalize();\r\n        \r\n        // Calculate movement based on distance to player\r\n        let moveSpeed = this.speed;\r\n        let finalDirection = new THREE.Vector3();\r\n        \r\n        // Different behavior based on distance from player\r\n        if (distanceToPlayer > 1000) {\r\n            // Far away - approach rapidly with slight variations\r\n            moveSpeed = this.speed * 1.2; // Move faster when far away\r\n            \r\n            // Add slight zigzag for interesting approach\r\n            const zigzag = Math.sin(this.timeAlive * 1.5) * 30;\r\n            finalDirection.copy(baseDirection)\r\n                .multiplyScalar(moveSpeed)\r\n                .add(right.clone().multiplyScalar(zigzag));\r\n                \r\n        } else if (distanceToPlayer > 400) {\r\n            // Medium distance - circle and approach\r\n            const approachWeight = 0.6; // 60% approach, 40% circling\r\n            const circleSpeed = this.speed * (1 - approachWeight);\r\n            \r\n            // Determine circling direction (clockwise or counterclockwise)\r\n            // Use entity ID to make it consistent for this drone\r\n            const entityIdSum = this.entity.id.split('').reduce((sum, char) => sum + char.charCodeAt(0), 0);\r\n            const circleDir = (entityIdSum % 2 === 0) ? 1 : -1;\r\n            \r\n            // Calculate strafing component (perpendicular to player direction)\r\n            const strafeDir = right.clone().multiplyScalar(circleDir * circleSpeed);\r\n            \r\n            // Calculate approach component\r\n            const approachDir = baseDirection.clone().multiplyScalar(this.speed * approachWeight);\r\n            \r\n            // Combine for final movement\r\n            finalDirection.copy(approachDir).add(strafeDir);\r\n            \r\n            // Add slight up/down bobbing\r\n            const bobAmount = Math.sin(this.timeAlive * 2.0) * 15;\r\n            finalDirection.add(properUp.clone().multiplyScalar(bobAmount));\r\n            \r\n        } else {\r\n            // Close range - erratic evasive movements with approach\r\n            \r\n            // Generate pseudo-random evasive pattern\r\n            const evasiveTime = this.timeAlive * 3.0; // Faster pattern changes\r\n            \r\n            // Horizontal evasion\r\n            const horizontalEvasion = Math.sin(evasiveTime) * Math.cos(evasiveTime * 1.3) * 80;\r\n            \r\n            // Vertical evasion\r\n            const verticalEvasion = Math.cos(evasiveTime * 0.7) * Math.sin(evasiveTime * 1.1) * 60;\r\n            \r\n            // Forward thrust varies with a pulsing pattern (0.5 to 1.0 of base speed)\r\n            const thrustPulse = 0.5 + (0.5 * (0.5 + 0.5 * Math.sin(evasiveTime * 0.5)));\r\n            \r\n            // Combine all movements\r\n            finalDirection.copy(baseDirection)\r\n                .multiplyScalar(this.speed * thrustPulse)\r\n                .add(right.clone().multiplyScalar(horizontalEvasion))\r\n                .add(properUp.clone().multiplyScalar(verticalEvasion));\r\n        }\r\n        \r\n        // Apply separation force influence to final direction\r\n        if (this.separationForce && this.separationForce.lengthSq() > 0) {\r\n            // Scale the separation force by influence factor\r\n            const separationDirection = this.separationForce.clone().normalize();\r\n            const separationStrength = this.separationForce.length();\r\n            \r\n            // Add scaled separation force to final direction\r\n            // Use higher influence when separation force is stronger\r\n            const dynamicInfluence = this.separationInfluence * \r\n                (0.5 + 0.5 * Math.min(1.0, separationStrength / 100));\r\n                \r\n            finalDirection.lerp(\r\n                separationDirection.multiplyScalar(this.speed), \r\n                dynamicInfluence\r\n            );\r\n        }\r\n        \r\n        // Apply the final movement\r\n        transform.position.add(finalDirection.multiplyScalar(deltaTime));\r\n        \r\n        // Create a look target that leads slightly in the direction of movement\r\n        // This creates a more natural flight pattern where the drone looks ahead of its movement\r\n        const lookAheadTime = 0.1; // Look 0.1 seconds ahead\r\n        const lookTarget = new THREE.Vector3()\r\n            .copy(transform.position)\r\n            .add(finalDirection.clone().normalize().multiplyScalar(100)); // Look 100 units ahead\r\n            \r\n        // Look at the calculated target point\r\n        transform.lookAt(lookTarget);\r\n        \r\n        // Add realistic banking effect based on lateral movement\r\n        // Extract the lateral (right) component of our movement\r\n        const lateralMovement = new THREE.Vector3();\r\n        lateralMovement.copy(finalDirection).projectOnVector(right);\r\n        \r\n        // Calculate bank angle based on lateral movement (max 25 degrees)\r\n        const lateralSpeed = lateralMovement.length() * (lateralMovement.dot(right) > 0 ? -1 : 1);\r\n        const bankAngle = (lateralSpeed / this.speed) * 0.4; // Max ~25 degrees\r\n        \r\n        // Apply banking rotation around the forward axis\r\n        const forward = transform.getForwardVector();\r\n        const bankQuaternion = new THREE.Quaternion().setFromAxisAngle(forward, bankAngle);\r\n        transform.quaternion.multiply(bankQuaternion);\r\n        \r\n        // Update Euler angles to match quaternion\r\n        transform.rotation.setFromQuaternion(transform.quaternion);\r\n    }\r\n    \r\n    /**\r\n     * Apply spectral drone movement pattern - spiral toward player\r\n     * @param {TransformComponent} transform This entity's transform\r\n     * @param {TransformComponent} playerTransform Player's transform\r\n     * @param {THREE.Vector3} baseDirection Base direction to player\r\n     * @param {number} distanceToPlayer Distance to player\r\n     * @param {number} deltaTime Delta time for frame\r\n     */\r\n    applySpectralDroneMovement(transform, playerTransform, baseDirection, distanceToPlayer, deltaTime) {\r\n        // Create an orthogonal basis for spiral movement\r\n        // We need a right vector that's perpendicular to the direction to the player\r\n        const up = new THREE.Vector3(0, 1, 0);\r\n        const right = new THREE.Vector3().crossVectors(baseDirection, up).normalize();\r\n        \r\n        // In case the direction is parallel to up, we need a fallback\r\n        if (right.lengthSq() < 0.1) {\r\n            right.set(1, 0, 0); // Fallback right vector\r\n        }\r\n        \r\n        // Now get a proper up vector that's perpendicular to both\r\n        const properUp = new THREE.Vector3().crossVectors(right, baseDirection).normalize();\r\n        \r\n        // Calculate spiral movement\r\n        // We use sine and cosine to create a circular pattern around the direct path\r\n        const time = this.timeAlive * this.spiralFrequency;\r\n        \r\n        // Adjust spiral amplitude based on distance to player (tighter spirals when closer)\r\n        let amplitude = this.spiralAmplitude;\r\n        if (distanceToPlayer < 500) {\r\n            // Gradually reduce spiral size as we get closer to the player\r\n            amplitude = this.spiralAmplitude * (distanceToPlayer / 500);\r\n        }\r\n        \r\n        // Calculate offsets using sine and cosine for a circular pattern\r\n        const offsetX = Math.sin(time) * amplitude;\r\n        const offsetY = Math.cos(time) * amplitude;\r\n        \r\n        // Apply the offsets to the base direction\r\n        const finalDirection = new THREE.Vector3()\r\n            .copy(baseDirection)\r\n            .multiplyScalar(this.speed) // Base forward speed\r\n            .add(right.multiplyScalar(offsetX)) // Add right/left offset\r\n            .add(properUp.multiplyScalar(offsetY)); // Add up/down offset\r\n        \r\n        // Apply separation force influence to final direction\r\n        if (this.separationForce && this.separationForce.lengthSq() > 0) {\r\n            // Scale the separation force by influence factor\r\n            const separationDirection = this.separationForce.clone().normalize();\r\n            const separationStrength = this.separationForce.length();\r\n            \r\n            // Calculate dynamic influence - more influence when separation force is stronger\r\n            const dynamicInfluence = this.separationInfluence * \r\n                (0.5 + 0.5 * Math.min(1.0, separationStrength / 100));\r\n            \r\n            // Blend the final direction with the separation direction\r\n            finalDirection.lerp(\r\n                separationDirection.multiplyScalar(this.speed),\r\n                dynamicInfluence\r\n            );\r\n        }\r\n        \r\n        // Apply the final movement\r\n        transform.position.add(finalDirection.multiplyScalar(deltaTime));\r\n        \r\n        // Create a look target that's ahead of us in the spiral path\r\n        // This makes the drone look in the direction it's moving, not just at the player\r\n        const lookAheadTime = 0.2; // Look 0.2 seconds ahead\r\n        const nextSpiral = time + (this.spiralFrequency * lookAheadTime);\r\n        \r\n        const lookAheadOffsetX = Math.sin(nextSpiral) * amplitude;\r\n        const lookAheadOffsetY = Math.cos(nextSpiral) * amplitude;\r\n        \r\n        // Calculate look target position\r\n        const lookTarget = new THREE.Vector3()\r\n            .copy(transform.position)\r\n            .add(baseDirection.multiplyScalar(100)) // Look ahead along base path\r\n            .add(right.multiplyScalar(lookAheadOffsetX)) // Add spiral offset X\r\n            .add(properUp.multiplyScalar(lookAheadOffsetY)); // Add spiral offset Y\r\n        \r\n        // Look at the calculated target point\r\n        transform.lookAt(lookTarget);\r\n        \r\n        // Optional: Add a slight tilt to the drone to make it look like it's banking in the turns\r\n        const tiltAngle = Math.atan2(offsetX, this.speed) * 0.5; // Scale down the bank angle\r\n        \r\n        // Apply tilt by modifying the quaternion directly\r\n        // We need to apply a rotation around the local forward axis\r\n        // Since we've already looked at the target, we're working in local space\r\n        \r\n        // Get the forward vector (from the lookAt we just did)\r\n        const forward = transform.getForwardVector();\r\n        \r\n        // Create quaternion for the tilt rotation around the forward vector (local Z)\r\n        const tiltQuaternion = new THREE.Quaternion().setFromAxisAngle(forward, tiltAngle);\r\n        \r\n        // Apply the tilt rotation to the current rotation\r\n        transform.quaternion.multiply(tiltQuaternion);\r\n        \r\n        // Update the Euler angles to match the quaternion\r\n        transform.rotation.setFromQuaternion(transform.quaternion);\r\n    }\r\n    \r\n    /**\r\n     * Apply heavy drone movement - Direct approach with tank-like behavior\r\n     * @param {TransformComponent} transform This entity's transform\r\n     * @param {TransformComponent} playerTransform Player's transform\r\n     * @param {THREE.Vector3} baseDirection Base direction to player\r\n     * @param {number} distanceToPlayer Distance to player\r\n     * @param {number} deltaTime Delta time for frame\r\n     */\r\n    applyHeavyDroneMovement(transform, playerTransform, baseDirection, distanceToPlayer, deltaTime) {\r\n        // Heavy drones move slowly but steadily\r\n        const movement = baseDirection.clone();\r\n        \r\n        // Minimal evasion - just slight wobble\r\n        const wobbleAmount = Math.sin(this.timeAlive * 1.5) * 0.1;\r\n        const perpendicular = new THREE.Vector3(-baseDirection.z, 0, baseDirection.x);\r\n        perpendicular.multiplyScalar(wobbleAmount);\r\n        movement.add(perpendicular);\r\n        \r\n        // Apply separation force with reduced influence for heavy drones\r\n        const separationInfluence = 0.2; // Less responsive to separation\r\n        movement.add(this.separationForce.clone().multiplyScalar(separationInfluence));\r\n        movement.normalize();\r\n        \r\n        // Update position\r\n        const speed = this.speed * deltaTime;\r\n        transform.position.add(movement.multiplyScalar(speed));\r\n        \r\n        // Look at player with slight anticipation\r\n        const lookTarget = playerTransform.position.clone();\r\n        transform.lookAt(lookTarget);\r\n        \r\n        // Store direction for other systems\r\n        this.lastDirection.copy(movement);\r\n    }\r\n    \r\n    /**\r\n     * Apply swift drone movement - Evasive zigzag with hit-and-run tactics\r\n     * @param {TransformComponent} transform This entity's transform\r\n     * @param {TransformComponent} playerTransform Player's transform\r\n     * @param {THREE.Vector3} baseDirection Base direction to player\r\n     * @param {number} distanceToPlayer Distance to player\r\n     * @param {number} deltaTime Delta time for frame\r\n     */\r\n    applySwiftDroneMovement(transform, playerTransform, baseDirection, distanceToPlayer, deltaTime) {\r\n        // Swift drones move very fast with erratic patterns\r\n        const movement = baseDirection.clone();\r\n        \r\n        // Extreme evasive maneuvers\r\n        const zigzagAmplitude = 0.5;\r\n        const zigzagFrequency = 8.0;\r\n        const zigzag = Math.sin(this.timeAlive * zigzagFrequency) * zigzagAmplitude;\r\n        const perpendicular = new THREE.Vector3(-baseDirection.z, 0, baseDirection.x);\r\n        perpendicular.multiplyScalar(zigzag);\r\n        \r\n        // Add vertical evasion\r\n        const verticalDodge = Math.cos(this.timeAlive * 10) * 0.3;\r\n        perpendicular.y = verticalDodge;\r\n        \r\n        movement.add(perpendicular);\r\n        \r\n        // High separation influence for nimble avoidance\r\n        const separationInfluence = 0.8;\r\n        movement.add(this.separationForce.clone().multiplyScalar(separationInfluence));\r\n        movement.normalize();\r\n        \r\n        // Hit-and-run behavior\r\n        if (distanceToPlayer < 200) {\r\n            // When close, strafe around the player\r\n            const strafeAngle = this.timeAlive * 5;\r\n            const strafeDirection = new THREE.Vector3(\r\n                Math.cos(strafeAngle),\r\n                0,\r\n                Math.sin(strafeAngle)\r\n            );\r\n            movement.lerp(strafeDirection, 0.3);\r\n        }\r\n        \r\n        // Update position\r\n        const speed = this.speed * deltaTime;\r\n        transform.position.add(movement.multiplyScalar(speed));\r\n        \r\n        // Rapid rotation changes with banking effect\r\n        const lookTarget = playerTransform.position.clone();\r\n        lookTarget.add(perpendicular.multiplyScalar(10)); // Look ahead of zigzag\r\n        transform.lookAt(lookTarget);\r\n        \r\n        // Add banking effect\r\n        transform.rotation.z = zigzag * 0.5;\r\n        \r\n        // Store direction\r\n        this.lastDirection.copy(movement);\r\n    }\r\n}","/**\r\n * Enemy Pool Manager - Handles the object pooling system for enemy entities\r\n */\r\n\r\nimport { TransformComponent } from '../../components/transform.js';\r\nimport { EnemyAIComponent } from '../../components/combat/enemyAI.js';\r\nimport { HealthComponent } from '../../components/combat/healthComponent.js';\r\nimport { MeshComponent } from '../../components/rendering/mesh.js';\r\nimport { RigidbodyComponent } from '../../components/physics/rigidbody.js';\r\nimport { TrailComponent } from '../../components/rendering/trail.js';\r\n\r\nexport class EnemyPoolManager {\r\n    constructor(world, maxPoolSize = 20) {\r\n        this.world = world;\r\n        this.maxPoolSize = maxPoolSize;\r\n        this.enemyPool = [];\r\n        \r\n        // Pre-allocate the pool\r\n        this.preallocateEnemyPool();\r\n    }\r\n    \r\n    /**\r\n     * Pre-allocate enemy pool to avoid runtime allocations\r\n     */\r\n    preallocateEnemyPool() {\r\n        // Pre-allocate spectral drones\r\n        for (let i = 0; i < 10; i++) {\r\n            const spectralEntity = this.createEnemyEntity();\r\n            // IMPORTANT: Don't add pooled entities to tracking\r\n            // The entity will be tracked only when spawned\r\n            this.enemyPool.push(spectralEntity);\r\n        }\r\n        \r\n        console.log(`Pre-allocated enemy pool with ${this.enemyPool.length} spectral drones`);\r\n    }\r\n    \r\n    /**\r\n     * Create a basic enemy entity (for pooling)\r\n     * @returns {Entity} The created enemy entity\r\n     */\r\n    createEnemyEntity() {\r\n        const entity = this.world.createEntity('enemy_spectral');\r\n        // Add tags but ensure they aren't tracked until spawned\r\n        entity.addTag('pooled'); // Add 'pooled' tag to mark as inactive\r\n        \r\n        // Add basic components\r\n        entity.addComponent(new TransformComponent());\r\n        entity.addComponent(new MeshComponent());\r\n        \r\n        return entity;\r\n    }\r\n    \r\n    /**\r\n     * Get an enemy from the pool or create a new one if the pool is empty\r\n     * @returns {Entity} An enemy entity\r\n     */\r\n    getEnemyFromPool() {\r\n        // Get from pool if available\r\n        if (this.enemyPool.length > 0) {\r\n            // Get entity from pool\r\n            const entity = this.enemyPool.pop();\r\n            \r\n            // Double-check this entity isn't already in the active enemies list\r\n            // (This should never happen, but let's be defensive)\r\n            if (this.enemies && this.enemies.has(entity.id)) {\r\n                console.warn(`CRITICAL ERROR: Entity ${entity.id} is in both the pool and active enemies!`);\r\n                \r\n                // Remove from active enemies to avoid duplicates\r\n                this.enemies.delete(entity.id);\r\n                console.log(`Fixed inconsistency: Removed entity ${entity.id} from active enemies`);\r\n            }\r\n            \r\n            // Verify all pooled entities in enemyPool don't include this entity\r\n            // This ensures no duplicate references exist in the pool\r\n            for (let i = 0; i < this.enemyPool.length; i++) {\r\n                if (this.enemyPool[i].id === entity.id) {\r\n                    console.warn(`CRITICAL ERROR: Duplicate of entity ${entity.id} found in enemy pool!`);\r\n                    this.enemyPool.splice(i, 1);\r\n                    console.log(`Fixed inconsistency: Removed duplicate entity ${entity.id} from enemy pool`);\r\n                    i--; // Adjust index since we removed an element\r\n                }\r\n            }\r\n            \r\n            console.log(`Getting entity ${entity.id} from pool. Current tags: [${entity.tags ? [...entity.tags] : 'undefined'}]`);\r\n            \r\n            // CRITICAL FIX: Use the proper clearTags method first to completely reset tag state\r\n            if (entity.clearTags && typeof entity.clearTags === 'function') {\r\n                entity.clearTags();\r\n                console.log(`Cleared all tags from entity ${entity.id}`);\r\n            } else {\r\n                console.warn(`Entity ${entity.id} missing clearTags method`);\r\n                // Remove the pooled tag manually at minimum\r\n                if (entity.hasTag && entity.removeTag) {\r\n                    if (entity.hasTag('pooled')) {\r\n                        entity.removeTag('pooled');\r\n                    }\r\n                    // Clear any other possible tags\r\n                    if (entity.hasTag('enemy')) entity.removeTag('enemy');\r\n                    if (entity.hasTag('spectrals')) entity.removeTag('spectrals');\r\n                }\r\n            }\r\n            \r\n            // Explicitly reset the tag cache flags\r\n            if (entity._syncTagCache && typeof entity._syncTagCache === 'function') {\r\n                entity._syncTagCache();\r\n                console.log(`Reset tag cache for entity ${entity.id}`);\r\n            } else {\r\n                // Direct reset of cache variables\r\n                if (entity._isEnemy !== undefined) entity._isEnemy = false;\r\n                if (entity._isPooled !== undefined) entity._isPooled = false;\r\n            }\r\n            \r\n            // Reset any component states that might be problematic\r\n            const enemyAI = entity.getComponent(EnemyAIComponent);\r\n            if (enemyAI) {\r\n                // Reset internal state\r\n                enemyAI.playerFound = false;\r\n                enemyAI.timeAlive = 0;\r\n                enemyAI.spiralPhase = Math.random() * Math.PI * 2; // New random starting phase\r\n                enemyAI.enabled = true; // Ensure it's enabled\r\n            }\r\n            \r\n            // Verify the entity is clean\r\n            console.log(`Entity ${entity.id} prepared for reuse. Current tags: [${entity.tags ? [...entity.tags] : 'undefined'}]`);\r\n            \r\n            return entity;\r\n        }\r\n        \r\n        // Otherwise create a new one\r\n        const newEntity = this.createEnemyEntity();\r\n        console.log(`Created new entity ${newEntity.id} because pool was empty`);\r\n        return newEntity;\r\n    }\r\n    \r\n    /**\r\n     * Return an enemy to the pool\r\n     * @param {Entity} entity Enemy entity\r\n     * @param {Set} enemies Reference to the active enemies set for tracking\r\n     */\r\n    returnEnemyToPool(entity, enemies) {\r\n        // Safeguard against null/undefined entities\r\n        if (!entity) {\r\n            console.warn(\"Attempt to return null/undefined entity to pool\");\r\n            return;\r\n        }\r\n        \r\n        // Get entity ID for consistent logging\r\n        const entityId = entity.id;\r\n        \r\n        // Log entity state for debugging\r\n        console.log(`Returning entity ${entityId} to pool. Has tags: [${entity.tags ? [...entity.tags] : 'undefined'}]`);\r\n        \r\n        // ENHANCED CLEANUP: Multiple checks to ensure entity is removed from enemies tracking\r\n        // 1. Direct check and remove from tracking Set\r\n        if (enemies && enemies.has(entityId)) {\r\n            enemies.delete(entityId);\r\n            console.log(`Removed entity ${entityId} from enemies tracking`);\r\n        }\r\n        \r\n        // 2. FIRST: Clear ALL tags using the improved clearTags method\r\n        // This will properly update both the tags Set and the cached flags\r\n        if (entity.clearTags && typeof entity.clearTags === 'function') {\r\n            entity.clearTags();\r\n            console.log(`Cleared all tags from entity ${entityId}`);\r\n        } else {\r\n            // Fallback if clearTags is not available\r\n            console.warn(`No clearTags method on entity ${entityId}, using manual tag removal`);\r\n            \r\n            // Manually remove known tags\r\n            if (entity.hasTag && entity.removeTag) {\r\n                if (entity.hasTag('enemy')) entity.removeTag('enemy');\r\n                if (entity.hasTag('spectrals')) entity.removeTag('spectrals');\r\n                if (entity.hasTag('drone')) entity.removeTag('drone');\r\n                if (entity.hasTag('frozen')) entity.removeTag('frozen');\r\n            }\r\n        }\r\n        \r\n        // Only return to pool if it's not full\r\n        if (this.enemyPool.length < this.maxPoolSize) {\r\n            // TRAIL CLEANUP: Remove trail component and its visual elements first\r\n            // This is critical to prevent the trail from persisting after enemy destruction\r\n            const trailComponent = entity.getComponent(TrailComponent);\r\n            if (trailComponent) {\r\n                try {\r\n                    // Call the onDetached method if it exists to clean up resources\r\n                    if (typeof trailComponent.onDetached === 'function') {\r\n                        trailComponent.onDetached();\r\n                    }\r\n                    \r\n                    // Remove from trail system tracking if it exists\r\n                    if (window.game && window.game.trailSystem) {\r\n                        window.game.trailSystem.unregisterTrail && \r\n                        window.game.trailSystem.unregisterTrail(entityId);\r\n                    }\r\n                    \r\n                    // If the trail has a mesh or points object, remove it from scene\r\n                    if (trailComponent.trailMesh && trailComponent.trailMesh.parent) {\r\n                        trailComponent.trailMesh.parent.remove(trailComponent.trailMesh);\r\n                    }\r\n                    \r\n                    // Dispose of geometry and material\r\n                    if (trailComponent.trailMesh) {\r\n                        if (trailComponent.trailMesh.geometry) {\r\n                            trailComponent.trailMesh.geometry.dispose();\r\n                        }\r\n                        if (trailComponent.trailMesh.material) {\r\n                            trailComponent.trailMesh.material.dispose();\r\n                        }\r\n                    }\r\n                    \r\n                    // Remove the component from the entity\r\n                    entity.removeComponent(TrailComponent);\r\n                    console.log(`Removed and cleaned up TrailComponent from entity ${entityId}`);\r\n                } catch (error) {\r\n                    console.error(`Error cleaning up trail for entity ${entityId}:`, error);\r\n                }\r\n            }\r\n            \r\n            // Reset the entity's transform\r\n            const transform = entity.getComponent(TransformComponent);\r\n            if (transform) {\r\n                transform.position.set(0, 0, 0);\r\n                transform.rotation.set(0, 0, 0);\r\n                transform.scale.set(1, 1, 1);\r\n            }\r\n            \r\n            // Reset health if present\r\n            const health = entity.getComponent(HealthComponent);\r\n            if (health) {\r\n                health.health = 0;\r\n                health.isDestroyed = true;\r\n            }\r\n            \r\n            // Disable AI component if present\r\n            const enemyAI = entity.getComponent(EnemyAIComponent);\r\n            if (enemyAI) {\r\n                enemyAI.enabled = false;\r\n                // Reset internal state variables to prevent stale behavior\r\n                enemyAI.playerFound = false;\r\n                enemyAI.timeAlive = 0;\r\n                enemyAI.spiralPhase = Math.random() * Math.PI * 2; // New random starting phase\r\n            }\r\n            \r\n            // Clean up and hide mesh\r\n            const meshComponent = entity.getComponent(MeshComponent);\r\n            if (meshComponent && meshComponent.mesh) {\r\n                try {\r\n                    // Remove from scene if it has a parent\r\n                    if (meshComponent.mesh.parent) {\r\n                        meshComponent.mesh.parent.remove(meshComponent.mesh);\r\n                    }\r\n                    \r\n                    // Make the mesh invisible\r\n                    meshComponent.mesh.visible = false;\r\n                } catch (error) {\r\n                    console.error(`Error cleaning up mesh for entity ${entityId}:`, error);\r\n                }\r\n            }\r\n            \r\n            // Disable rigidbody physics\r\n            const rigidbody = entity.getComponent(RigidbodyComponent);\r\n            if (rigidbody) {\r\n                rigidbody.isFrozen = true;\r\n                if (rigidbody.velocity) {\r\n                    rigidbody.velocity.set(0, 0, 0);\r\n                }\r\n            }\r\n\r\n            // Now, add the pooled tag after all cleanup is done\r\n            entity.addTag('pooled');\r\n            console.log(`Entity ${entityId} marked as pooled`);\r\n            \r\n            // Verify entity state after pooling\r\n            console.log(`Final entity ${entityId} state - Tags: [${entity.tags ? [...entity.tags] : 'none'}]`);\r\n            \r\n            // Add to pool\r\n            this.enemyPool.push(entity);\r\n            \r\n            console.log(`Entity ${entityId} returned to pool. Pool size now ${this.enemyPool.length}`);\r\n        } else {\r\n            // If pool is full, destroy the entity\r\n            console.log(`Pool is full (${this.maxPoolSize}), destroying entity ${entityId} instead of pooling`);\r\n            \r\n            // CRITICAL FIX: Ensure entity is completely destroyed\r\n            if (this.world && this.world.destroyEntity) {\r\n                this.world.destroyEntity(entityId);\r\n                console.log(`Entity ${entityId} fully destroyed`);\r\n            } else {\r\n                console.error(`Failed to destroy entity ${entityId} - world or destroyEntity method not available`);\r\n            }\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Run diagnostics on the enemy pool system to detect and fix inconsistencies\r\n     * @param {Set} enemies Reference to the active enemies set for tracking\r\n     */\r\n    runPoolDiagnostics(enemies) {\r\n        console.log(\"=== RUNNING ENEMY POOL DIAGNOSTICS ===\");\r\n        console.log(`Active enemies: ${enemies.size}, Pool size: ${this.enemyPool.length}`);\r\n        \r\n        // Track number of fixes made\r\n        let inconsistenciesFixed = 0;\r\n        \r\n        // POOL INTEGRITY CHECK: Check for duplicate entities in the pool\r\n        const poolEntityIds = new Set();\r\n        const duplicateIndices = [];\r\n        \r\n        for (let i = 0; i < this.enemyPool.length; i++) {\r\n            const entity = this.enemyPool[i];\r\n            \r\n            // Skip invalid entities\r\n            if (!entity || !entity.id) {\r\n                console.warn(`Invalid entity at index ${i} in enemy pool - removing`);\r\n                duplicateIndices.push(i);\r\n                inconsistenciesFixed++;\r\n                continue;\r\n            }\r\n            \r\n            // Check if this entity ID is already in the pool\r\n            if (poolEntityIds.has(entity.id)) {\r\n                console.warn(`Duplicate entity ${entity.id} found in enemy pool at index ${i} - removing`);\r\n                duplicateIndices.push(i);\r\n                inconsistenciesFixed++;\r\n            } else {\r\n                poolEntityIds.add(entity.id);\r\n            }\r\n        }\r\n        \r\n        // Remove duplicates from the pool (in reverse order to avoid index issues)\r\n        for (let i = duplicateIndices.length - 1; i >= 0; i--) {\r\n            this.enemyPool.splice(duplicateIndices[i], 1);\r\n        }\r\n        \r\n        // ACTIVE-POOLED CHECK: No entity should be both active and in the pool\r\n        const activePooledEntities = [];\r\n        \r\n        for (let i = 0; i < this.enemyPool.length; i++) {\r\n            const entity = this.enemyPool[i];\r\n            \r\n            // If entity is also in active enemies, that's a critical error\r\n            if (enemies.has(entity.id)) {\r\n                console.error(`CRITICAL ERROR: Entity ${entity.id} is both active and in the pool!`);\r\n                activePooledEntities.push(i);\r\n                inconsistenciesFixed++;\r\n            }\r\n        }\r\n        \r\n        // Remove entities that are both active and pooled from the pool\r\n        for (let i = activePooledEntities.length - 1; i >= 0; i--) {\r\n            const index = activePooledEntities[i];\r\n            const entityId = this.enemyPool[index].id;\r\n            this.enemyPool.splice(index, 1);\r\n            console.log(`Fixed critical inconsistency: Removed entity ${entityId} from pool since it's active`);\r\n        }\r\n        \r\n        // Check the enemy tag map\r\n        let enemyTaggedCount = 0;\r\n        let pooledTaggedCount = 0;\r\n        let inconsistentEntities = 0;\r\n        \r\n        if (this.world && this.world.entityManager && this.world.entityManager.entitiesByTag) {\r\n            // Count entities with enemy tag\r\n            const enemyTaggedEntities = this.world.entityManager.entitiesByTag.get('enemy') || [];\r\n            enemyTaggedCount = enemyTaggedEntities.length;\r\n            \r\n            // Count entities with pooled tag\r\n            const pooledTaggedEntities = this.world.entityManager.entitiesByTag.get('pooled') || [];\r\n            pooledTaggedCount = pooledTaggedEntities.length;\r\n            \r\n            // Check for inconsistent state: entities with both 'enemy' and 'pooled' tags\r\n            for (const entity of enemyTaggedEntities) {\r\n                if (entity.hasTag('pooled')) {\r\n                    console.warn(`INCONSISTENT ENTITY ${entity.id}: Has both 'enemy' and 'pooled' tags`);\r\n                    inconsistentEntities++;\r\n                    \r\n                    // POOL STATUS CHECK: If entity has pooled tag, it MUST be in the pool\r\n                    const isInPool = this.enemyPool.some(e => e.id === entity.id);\r\n                    \r\n                    if (isInPool) {\r\n                        // Entity is in pool with enemy tag - remove enemy tag\r\n                        entity.removeTag('enemy');\r\n                        console.log(`Fixed entity ${entity.id} by removing 'enemy' tag since it's in the pool`);\r\n                    } else {\r\n                        // Entity has pooled tag but not in pool - remove pooled tag\r\n                        entity.removeTag('pooled');\r\n                        console.log(`Fixed entity ${entity.id} by removing 'pooled' tag since it's not in the pool`);\r\n                    }\r\n                    \r\n                    inconsistenciesFixed++;\r\n                }\r\n            }\r\n            \r\n            // Check for inconsistent state: pooled entities in active enemies set\r\n            for (const entityId of enemies) {\r\n                const entity = this.world.getEntity(entityId);\r\n                if (entity && entity.hasTag('pooled')) {\r\n                    console.warn(`INCONSISTENT TRACKING: Entity ${entityId} is in active enemies but has 'pooled' tag`);\r\n                    \r\n                    // Check if entity is actually in the pool\r\n                    const isInPool = this.enemyPool.some(e => e.id === entityId);\r\n                    \r\n                    if (isInPool) {\r\n                        // Entity is in pool and active list - remove from active list\r\n                        enemies.delete(entityId);\r\n                        console.log(`Fixed by removing entity ${entityId} from active enemies set since it's in the pool`);\r\n                    } else {\r\n                        // Entity has pooled tag but not in pool - remove pooled tag\r\n                        entity.removeTag('pooled');\r\n                        console.log(`Fixed entity ${entityId} by removing 'pooled' tag since it's not in the pool`);\r\n                    }\r\n                    \r\n                    inconsistentEntities++;\r\n                    inconsistenciesFixed++;\r\n                }\r\n            }\r\n            \r\n            // Check enemy pool for tag issues\r\n            for (let i = 0; i < this.enemyPool.length; i++) {\r\n                const entity = this.enemyPool[i];\r\n                \r\n                if (!entity) continue;\r\n                \r\n                let entityFixed = false;\r\n                \r\n                // Entities in the pool MUST have the pooled tag\r\n                if (!entity.hasTag('pooled')) {\r\n                    console.warn(`INCONSISTENT POOL: Entity ${entity.id} in enemy pool but missing 'pooled' tag`);\r\n                    entity.addTag('pooled');\r\n                    console.log(`Fixed by adding 'pooled' tag to entity ${entity.id}`);\r\n                    entityFixed = true;\r\n                    inconsistenciesFixed++;\r\n                }\r\n                \r\n                // Entities in the pool MUST NOT have the enemy tag\r\n                if (entity.hasTag('enemy')) {\r\n                    console.warn(`INCONSISTENT POOL: Entity ${entity.id} in enemy pool but has 'enemy' tag`);\r\n                    entity.removeTag('enemy');\r\n                    console.log(`Fixed by removing 'enemy' tag from entity ${entity.id}`);\r\n                    entityFixed = true;\r\n                    inconsistenciesFixed++;\r\n                }\r\n                \r\n                if (entityFixed) {\r\n                    inconsistentEntities++;\r\n                }\r\n            }\r\n        }\r\n        \r\n        console.log(`Diagnostic results: ${enemyTaggedCount} entities with 'enemy' tag, ${pooledTaggedCount} entities with 'pooled' tag`);\r\n        console.log(`Fixed ${inconsistenciesFixed} inconsistencies across ${inconsistentEntities} entities`);\r\n        console.log(\"=== DIAGNOSTICS COMPLETE ===\");\r\n    }\r\n} ","/**\r\n * Wave Definitions - Enemy wave configurations and base parameters\r\n */\r\n\r\n/**\r\n * Base enemy configuration template\r\n */\r\nexport const BASE_ENEMY_CONFIG = {\r\n    health: 20,\r\n    damage: 15,\r\n    speed: 700,\r\n    spiralAmplitude: 150,\r\n    spiralFrequency: 2.0\r\n};\r\n\r\n/**\r\n * Enemy subtype configurations - Three distinct drone variants\r\n */\r\nexport const ENEMY_SUBTYPES = {\r\n    STANDARD: {\r\n        id: 'standard',\r\n        name: 'Standard Spectral Drone',\r\n        health: 20,\r\n        damage: 15,\r\n        speed: 700,\r\n        sizeScale: 1.0,\r\n        collisionRadius: 50,\r\n        spiralAmplitude: 150,\r\n        spiralFrequency: 2.0,\r\n        spawnWeight: 60, // 60% spawn chance\r\n        // Visual properties\r\n        color: { main: 0x00FFFF, emissive: { r: 0, g: 1, b: 1 } },\r\n        emissiveIntensity: 3.0,\r\n        shaderType: 'pulsingCore'\r\n    },\r\n    HEAVY: {\r\n        id: 'heavy',\r\n        name: 'Heavy Spectral Drone',\r\n        health: 60,\r\n        damage: 30,\r\n        speed: 400,\r\n        sizeScale: 1.5,\r\n        collisionRadius: 75,\r\n        spiralAmplitude: 100,\r\n        spiralFrequency: 1.0,\r\n        spawnWeight: 15, // 15% spawn chance\r\n        // Visual properties\r\n        color: { main: 0xFF6600, emissive: { r: 1, g: 0.4, b: 0 } },\r\n        emissiveIntensity: 4.0,\r\n        shaderType: 'hexagonShield'\r\n    },\r\n    SWIFT: {\r\n        id: 'swift',\r\n        name: 'Swift Spectral Drone',\r\n        health: 10,\r\n        damage: 10,\r\n        speed: 1200,\r\n        sizeScale: 0.8,\r\n        collisionRadius: 40,\r\n        spiralAmplitude: 200,\r\n        spiralFrequency: 3.0,\r\n        spawnWeight: 25, // 25% spawn chance\r\n        // Visual properties\r\n        color: { main: 0x66FF00, emissive: { r: 0.4, g: 1, b: 0 } },\r\n        emissiveIntensity: 3.5,\r\n        shaderType: 'speedBlur'\r\n    }\r\n};\r\n\r\n/**\r\n * Enemy type configurations\r\n */\r\nexport const ENEMY_TYPES = {\r\n    SPECTRAL_DRONE: {\r\n        faction: 'spectrals',\r\n        type: 'drone',\r\n        baseConfig: { ...BASE_ENEMY_CONFIG },\r\n        subtypes: ENEMY_SUBTYPES,\r\n        baseSize: 80,\r\n        isDroneLike: true\r\n    }\r\n};\r\n\r\n/**\r\n * Wave spawn patterns\r\n */\r\nexport const WAVE_PATTERNS = {\r\n    SINGLE: {\r\n        name: 'single',\r\n        count: 1,\r\n        description: 'Single enemy spawn'\r\n    },\r\n    PAIR: {\r\n        name: 'pair',\r\n        count: 2,\r\n        description: 'Two enemies spawned together'\r\n    },\r\n    SQUAD: {\r\n        name: 'squad',\r\n        count: 3,\r\n        description: 'Small squad of three enemies'\r\n    },\r\n    PACK: {\r\n        name: 'pack',\r\n        count: 5,\r\n        description: 'Pack of five enemies'\r\n    }\r\n};\r\n\r\n/**\r\n * Default spawn intervals by difficulty\r\n */\r\nexport const SPAWN_INTERVALS = {\r\n    EASY: 5.0,      // 5 seconds between spawns\r\n    NORMAL: 3.0,    // 3 seconds between spawns\r\n    HARD: 2.0,      // 2 seconds between spawns\r\n    NIGHTMARE: 1.0  // 1 second between spawns\r\n};\r\n\r\n/**\r\n * Maximum enemy counts by difficulty\r\n */\r\nexport const MAX_ENEMY_COUNTS = {\r\n    EASY: 5,\r\n    NORMAL: 10,\r\n    HARD: 15,\r\n    NIGHTMARE: 25\r\n};\r\n\r\n/**\r\n * Bright color palette for enhanced visibility (deprecated - use subtype colors)\r\n */\r\nexport const ENEMY_COLOR_PALETTE = [\r\n    { main: 0x00FFFF, emissive: { r: 0, g: 1, b: 1 } },         // Bright cyan\r\n    { main: 0xFF00FF, emissive: { r: 1, g: 0, b: 1 } },         // Bright magenta\r\n    { main: 0x00FF00, emissive: { r: 0, g: 1, b: 0 } },         // Bright green\r\n    { main: 0xFFFF00, emissive: { r: 1, g: 1, b: 0 } },         // Bright yellow\r\n    { main: 0xFF6600, emissive: { r: 1, g: 0.4, b: 0 } },       // Bright orange\r\n    { main: 0x00FFAA, emissive: { r: 0, g: 1, b: 0.67 } },      // Bright teal\r\n    { main: 0xFF00AA, emissive: { r: 1, g: 0, b: 0.67 } },      // Bright pink\r\n    { main: 0xAAFF00, emissive: { r: 0.67, g: 1, b: 0 } },      // Bright lime\r\n    { main: 0xAA00FF, emissive: { r: 0.67, g: 0, b: 1 } },      // Bright purple\r\n    { main: 0xFFAA00, emissive: { r: 1, g: 0.67, b: 0 } }       // Bright amber\r\n];\r\n\r\n/**\r\n * Visual variant effects configuration\r\n */\r\nexport const VISUAL_VARIANTS = {\r\n    NORMAL: {\r\n        id: 0,\r\n        name: 'normal',\r\n        emissiveIntensity: { min: 1.0, max: 1.5 },\r\n        opacity: 1.0,\r\n        additionalEffects: false\r\n    },\r\n    DAMAGED: {\r\n        id: 1,\r\n        name: 'damaged',\r\n        emissiveIntensity: { base: 0.5, flicker: 0.3 }, // Flickering effect\r\n        opacity: 0.85,\r\n        colorMultiplier: 0.7,\r\n        additionalEffects: false\r\n    },\r\n    ELITE: {\r\n        id: 2,\r\n        name: 'elite',\r\n        emissiveIntensity: { base: 2.0, pulse: 0.5 }, // Pulsing effect\r\n        opacity: 1.0,\r\n        colorMultiplier: 1.2,\r\n        additionalEffects: true,\r\n        haloEffect: true\r\n    },\r\n    SHIELDED: {\r\n        id: 3,\r\n        name: 'shielded',\r\n        emissiveIntensity: 1.5,\r\n        opacity: 1.0,\r\n        shimmerEffect: true,\r\n        shieldEffect: true,\r\n        additionalEffects: false\r\n    }\r\n};\r\n\r\n/**\r\n * Get a random enemy subtype based on spawn weights\r\n * @returns {Object} Enemy subtype configuration\r\n */\r\nexport function getRandomEnemySubtype() {\r\n    const totalWeight = Object.values(ENEMY_SUBTYPES).reduce((sum, type) => sum + type.spawnWeight, 0);\r\n    let random = Math.random() * totalWeight;\r\n    \r\n    for (const subtype of Object.values(ENEMY_SUBTYPES)) {\r\n        random -= subtype.spawnWeight;\r\n        if (random <= 0) {\r\n            return subtype;\r\n        }\r\n    }\r\n    \r\n    return ENEMY_SUBTYPES.STANDARD; // Fallback\r\n}\r\n\r\n/**\r\n * Get enemy subtype by ID\r\n * @param {string} subtypeId - The subtype ID\r\n * @returns {Object} Enemy subtype configuration\r\n */\r\nexport function getEnemySubtype(subtypeId) {\r\n    return ENEMY_SUBTYPES[subtypeId.toUpperCase()] || ENEMY_SUBTYPES.STANDARD;\r\n}\r\n\r\n/**\r\n * Get a random color from the palette (deprecated - use subtype colors)\r\n * @returns {Object} Color configuration with main and emissive properties\r\n */\r\nexport function getRandomEnemyColor() {\r\n    // Now returns color from a random subtype for backward compatibility\r\n    const subtype = getRandomEnemySubtype();\r\n    return subtype.color;\r\n}\r\n\r\n/**\r\n * Get visual variant configuration by ID\r\n * @param {number} variantId - The variant ID (0-3)\r\n * @returns {Object} Visual variant configuration\r\n */\r\nexport function getVisualVariant(variantId = 0) {\r\n    const variants = Object.values(VISUAL_VARIANTS);\r\n    const variant = variants.find(v => v.id === variantId);\r\n    return variant || VISUAL_VARIANTS.NORMAL;\r\n}\r\n\r\n/**\r\n * Generate random visual variant ID (deprecated - use getRandomEnemySubtype)\r\n * @returns {number} Random variant ID (0-2 for backward compatibility)\r\n */\r\nexport function getRandomVisualVariant() {\r\n    // Map to new subtype system for backward compatibility\r\n    const subtype = getRandomEnemySubtype();\r\n    return subtype.id === 'standard' ? 0 : (subtype.id === 'heavy' ? 1 : 2);\r\n}","/**\r\n * Wave Progression - Difficulty scaling and parameter progression logic\r\n */\r\n\r\nimport { BASE_ENEMY_CONFIG, SPAWN_INTERVALS } from './definitions.js';\r\n\r\n/**\r\n * Difficulty progression manager\r\n */\r\nexport class DifficultyProgression {\r\n    constructor() {\r\n        this.baseConfig = { ...BASE_ENEMY_CONFIG };\r\n        this.currentConfig = { ...BASE_ENEMY_CONFIG };\r\n        this.baseSpawnInterval = 3.0; // Default spawn interval\r\n        this.currentSpawnInterval = 3.0;\r\n    }\r\n\r\n    /**\r\n     * Update difficulty parameters based on external difficulty manager\r\n     * @param {Object} world - The game world instance\r\n     * @returns {boolean} Whether parameters were updated\r\n     */\r\n    updateParameters(world) {\r\n        let updated = false;\r\n\r\n        // Try to get difficulty parameters from global difficulty manager\r\n        if (window.game && window.game.difficultyManager && window.game.difficultyManager.params) {\r\n            const diffParams = window.game.difficultyManager.params;\r\n            \r\n            // Update enemy parameters if they exist in the difficulty manager\r\n            if (diffParams.enemyHealth !== undefined && diffParams.enemyHealth !== this.currentConfig.health) {\r\n                this.currentConfig.health = diffParams.enemyHealth;\r\n                updated = true;\r\n            }\r\n            \r\n            if (diffParams.enemyDamage !== undefined && diffParams.enemyDamage !== this.currentConfig.damage) {\r\n                this.currentConfig.damage = diffParams.enemyDamage;\r\n                updated = true;\r\n            }\r\n            \r\n            if (diffParams.enemySpeed !== undefined && diffParams.enemySpeed !== this.currentConfig.speed) {\r\n                this.currentConfig.speed = diffParams.enemySpeed;\r\n                updated = true;\r\n            }\r\n            \r\n            if (diffParams.spawnInterval !== undefined && diffParams.spawnInterval !== this.currentSpawnInterval) {\r\n                this.currentSpawnInterval = diffParams.spawnInterval;\r\n                updated = true;\r\n            }\r\n\r\n            // Log current parameters occasionally for debugging\r\n            if (updated && Math.random() < 0.005) { // ~0.5% chance each frame to avoid spam\r\n                console.log(`Updated enemy parameters: Health=${this.currentConfig.health}, Damage=${this.currentConfig.damage}, Speed=${this.currentConfig.speed}, SpawnInterval=${this.currentSpawnInterval}`);\r\n            }\r\n        }\r\n\r\n        return updated;\r\n    }\r\n\r\n    /**\r\n     * Get current enemy configuration with difficulty scaling\r\n     * @returns {Object} Current enemy configuration\r\n     */\r\n    getCurrentConfig() {\r\n        return { ...this.currentConfig };\r\n    }\r\n\r\n    /**\r\n     * Get current spawn interval\r\n     * @returns {number} Current spawn interval in seconds\r\n     */\r\n    getCurrentSpawnInterval() {\r\n        return this.currentSpawnInterval;\r\n    }\r\n\r\n    /**\r\n     * Apply random variations to enemy parameters\r\n     * @param {Object} baseConfig - Base configuration to vary\r\n     * @returns {Object} Configuration with applied variations\r\n     */\r\n    applyVariations(baseConfig) {\r\n        return {\r\n            health: baseConfig.health,\r\n            damage: baseConfig.damage,\r\n            speed: baseConfig.speed * (0.7 + Math.random() * 0.6), // 70-130% of base speed\r\n            spiralAmplitude: baseConfig.spiralAmplitude * (0.8 + Math.random() * 0.4), // 80-120% of base\r\n            spiralFrequency: baseConfig.spiralFrequency * (0.9 + Math.random() * 0.2) // 90-110% of base\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Reset difficulty to base values\r\n     */\r\n    reset() {\r\n        this.currentConfig = { ...this.baseConfig };\r\n        this.currentSpawnInterval = this.baseSpawnInterval;\r\n    }\r\n\r\n    /**\r\n     * Set manual difficulty multiplier (for testing or special events)\r\n     * @param {number} multiplier - Difficulty multiplier (1.0 = normal)\r\n     */\r\n    setDifficultyMultiplier(multiplier) {\r\n        this.currentConfig.health = Math.round(this.baseConfig.health * multiplier);\r\n        this.currentConfig.damage = Math.round(this.baseConfig.damage * multiplier);\r\n        this.currentConfig.speed = Math.round(this.baseConfig.speed * multiplier);\r\n        this.currentSpawnInterval = Math.max(0.5, this.baseSpawnInterval / multiplier);\r\n    }\r\n\r\n    /**\r\n     * Get difficulty statistics\r\n     * @returns {Object} Current difficulty statistics\r\n     */\r\n    getStats() {\r\n        const healthMultiplier = this.currentConfig.health / this.baseConfig.health;\r\n        const damageMultiplier = this.currentConfig.damage / this.baseConfig.damage;\r\n        const speedMultiplier = this.currentConfig.speed / this.baseConfig.speed;\r\n        const spawnRateMultiplier = this.baseSpawnInterval / this.currentSpawnInterval;\r\n\r\n        return {\r\n            healthMultiplier: healthMultiplier.toFixed(2),\r\n            damageMultiplier: damageMultiplier.toFixed(2),\r\n            speedMultiplier: speedMultiplier.toFixed(2),\r\n            spawnRateMultiplier: spawnRateMultiplier.toFixed(2),\r\n            currentHealth: this.currentConfig.health,\r\n            currentDamage: this.currentConfig.damage,\r\n            currentSpeed: this.currentConfig.speed,\r\n            currentSpawnInterval: this.currentSpawnInterval\r\n        };\r\n    }\r\n}","/**\r\n * Formation Patterns - Templates and configurations for enemy spawn formations\r\n */\r\n\r\nimport * as THREE from 'three';\r\n\r\n/**\r\n * Formation pattern definitions\r\n */\r\nexport const FORMATION_PATTERNS = {\r\n    SPHERE: {\r\n        name: 'sphere',\r\n        description: 'Spherical distribution around center point',\r\n        defaultRadius: 2500,\r\n        defaultCount: 12,\r\n        generate: (center, count = 12, radius = 2500) => {\r\n            const points = [];\r\n            for (let i = 0; i < count; i++) {\r\n                // Generate random points on a sphere using spherical coordinates\r\n                const phi = Math.acos(2 * Math.random() - 1);\r\n                const theta = Math.random() * Math.PI * 2;\r\n                \r\n                const x = center.x + radius * Math.sin(phi) * Math.cos(theta);\r\n                const y = center.y + radius * Math.sin(phi) * Math.sin(theta);\r\n                const z = center.z + radius * Math.cos(phi);\r\n                \r\n                points.push(new THREE.Vector3(x, y, z));\r\n            }\r\n            return points;\r\n        }\r\n    },\r\n\r\n    CIRCLE: {\r\n        name: 'circle',\r\n        description: 'Circular distribution around center point',\r\n        defaultRadius: 3000,\r\n        defaultCount: 10,\r\n        generate: (center, count = 10, radius = 3000) => {\r\n            const points = [];\r\n            for (let i = 0; i < count; i++) {\r\n                const angle = (i / count) * Math.PI * 2;\r\n                const x = center.x + Math.cos(angle) * radius;\r\n                const y = center.y + (Math.random() - 0.5) * 1000; // Some Y variation\r\n                const z = center.z + Math.sin(angle) * radius;\r\n                points.push(new THREE.Vector3(x, y, z));\r\n            }\r\n            return points;\r\n        }\r\n    },\r\n\r\n    RING: {\r\n        name: 'ring',\r\n        description: 'Ring formation with inner and outer radius',\r\n        defaultInnerRadius: 2000,\r\n        defaultOuterRadius: 3500,\r\n        defaultCount: 8,\r\n        generate: (center, count = 8, innerRadius = 2000, outerRadius = 3500) => {\r\n            const points = [];\r\n            for (let i = 0; i < count; i++) {\r\n                const angle = (i / count) * Math.PI * 2;\r\n                const radius = innerRadius + Math.random() * (outerRadius - innerRadius);\r\n                const x = center.x + Math.cos(angle) * radius;\r\n                const y = center.y + (Math.random() - 0.5) * 500;\r\n                const z = center.z + Math.sin(angle) * radius;\r\n                points.push(new THREE.Vector3(x, y, z));\r\n            }\r\n            return points;\r\n        }\r\n    },\r\n\r\n    HEMISPHERE: {\r\n        name: 'hemisphere',\r\n        description: 'Hemisphere above/below center point',\r\n        defaultRadius: 2800,\r\n        defaultCount: 10,\r\n        generate: (center, count = 10, radius = 2800, upper = true) => {\r\n            const points = [];\r\n            for (let i = 0; i < count; i++) {\r\n                // Generate points on hemisphere (phi from 0 to /2 for upper, /2 to  for lower)\r\n                const phi = upper ? \r\n                    Math.random() * Math.PI / 2 : \r\n                    Math.PI / 2 + Math.random() * Math.PI / 2;\r\n                const theta = Math.random() * Math.PI * 2;\r\n                \r\n                const x = center.x + radius * Math.sin(phi) * Math.cos(theta);\r\n                const y = center.y + radius * Math.sin(phi) * Math.sin(theta);\r\n                const z = center.z + radius * Math.cos(phi);\r\n                \r\n                points.push(new THREE.Vector3(x, y, z));\r\n            }\r\n            return points;\r\n        }\r\n    },\r\n\r\n    GRID_3D: {\r\n        name: 'grid3d',\r\n        description: '3D grid formation around center',\r\n        defaultSpacing: 1000,\r\n        defaultSize: 3,\r\n        generate: (center, size = 3, spacing = 1000) => {\r\n            const points = [];\r\n            const offset = (size - 1) * spacing / 2;\r\n            \r\n            for (let x = 0; x < size; x++) {\r\n                for (let y = 0; y < size; y++) {\r\n                    for (let z = 0; z < size; z++) {\r\n                        // Skip center point to avoid spawning on player\r\n                        if (x === Math.floor(size/2) && y === Math.floor(size/2) && z === Math.floor(size/2)) {\r\n                            continue;\r\n                        }\r\n                        \r\n                        const point = new THREE.Vector3(\r\n                            center.x + (x * spacing) - offset,\r\n                            center.y + (y * spacing) - offset,\r\n                            center.z + (z * spacing) - offset\r\n                        );\r\n                        points.push(point);\r\n                    }\r\n                }\r\n            }\r\n            return points;\r\n        }\r\n    },\r\n\r\n    RANDOM_CLOUD: {\r\n        name: 'randomcloud',\r\n        description: 'Random distribution within a bounding volume',\r\n        defaultRadius: 3000,\r\n        defaultCount: 15,\r\n        generate: (center, count = 15, radius = 3000) => {\r\n            const points = [];\r\n            for (let i = 0; i < count; i++) {\r\n                // Generate random point within sphere\r\n                const u = Math.random();\r\n                const v = Math.random();\r\n                const w = Math.random();\r\n                \r\n                // Convert to spherical coordinates and scale by cube root for uniform distribution\r\n                const r = radius * Math.cbrt(u);\r\n                const theta = 2 * Math.PI * v;\r\n                const phi = Math.acos(2 * w - 1);\r\n                \r\n                const x = center.x + r * Math.sin(phi) * Math.cos(theta);\r\n                const y = center.y + r * Math.sin(phi) * Math.sin(theta);\r\n                const z = center.z + r * Math.cos(phi);\r\n                \r\n                points.push(new THREE.Vector3(x, y, z));\r\n            }\r\n            return points;\r\n        }\r\n    }\r\n};\r\n\r\n/**\r\n * Default formation configuration\r\n */\r\nexport const DEFAULT_FORMATION = FORMATION_PATTERNS.SPHERE;\r\n\r\n/**\r\n * Get formation pattern by name\r\n * @param {string} name - Pattern name\r\n * @returns {Object} Formation pattern or default pattern\r\n */\r\nexport function getFormationPattern(name) {\r\n    return FORMATION_PATTERNS[name.toUpperCase()] || DEFAULT_FORMATION;\r\n}\r\n\r\n/**\r\n * Get all available formation pattern names\r\n * @returns {Array<string>} Array of pattern names\r\n */\r\nexport function getAvailablePatterns() {\r\n    return Object.keys(FORMATION_PATTERNS);\r\n}\r\n\r\n/**\r\n * Generate formation with random pattern\r\n * @param {THREE.Vector3} center - Center point for formation\r\n * @param {number} count - Number of spawn points\r\n * @param {number} radius - Formation radius\r\n * @returns {Array<THREE.Vector3>} Array of spawn points\r\n */\r\nexport function generateRandomFormation(center, count = 12, radius = 2500) {\r\n    const patternNames = getAvailablePatterns();\r\n    const randomPattern = patternNames[Math.floor(Math.random() * patternNames.length)];\r\n    const pattern = FORMATION_PATTERNS[randomPattern];\r\n    \r\n    return pattern.generate(center, count, radius);\r\n}","/**\r\n * Formation Builder - Position calculation and spawn point management\r\n */\r\n\r\nimport * as THREE from 'three';\r\nimport { TransformComponent } from '../../../../components/transform.js';\r\nimport { FORMATION_PATTERNS, DEFAULT_FORMATION } from './patterns.js';\r\n\r\n/**\r\n * Formation builder for managing spawn points and player detection\r\n */\r\nexport class FormationBuilder {\r\n    constructor(world) {\r\n        this.world = world;\r\n        this.spawnPoints = [];\r\n        this.currentFormation = DEFAULT_FORMATION;\r\n        this.lastPlayerPosition = null;\r\n        this.regenerationDistance = 1000; // Distance player must move to regenerate points\r\n    }\r\n\r\n    /**\r\n     * Find player position using multiple detection methods\r\n     * @returns {THREE.Vector3|null} Player position or null if not found\r\n     */\r\n    findPlayerPosition() {\r\n        let players = [];\r\n        let playerPosition = null;\r\n        \r\n        // Method 1: Try using entityManager\r\n        try {\r\n            if (this.world.entityManager && this.world.entityManager.getEntitiesByTag) {\r\n                players = this.world.entityManager.getEntitiesByTag('player');\r\n                if (players.length > 0) {\r\n                    const transform = players[0].getComponent(TransformComponent);\r\n                    if (transform && transform.position) {\r\n                        playerPosition = transform.position;\r\n                    }\r\n                }\r\n            }\r\n        } catch (e) {\r\n            console.log(\"Could not get player via entityManager:\", e.message);\r\n        }\r\n        \r\n        // Method 2: Try direct world method\r\n        if (!playerPosition) {\r\n            try {\r\n                if (this.world.getEntitiesByTag) {\r\n                    players = this.world.getEntitiesByTag('player');\r\n                    if (players.length > 0) {\r\n                        const transform = players[0].getComponent(TransformComponent);\r\n                        if (transform && transform.position) {\r\n                            playerPosition = transform.position;\r\n                        }\r\n                    }\r\n                }\r\n            } catch (e) {\r\n                console.log(\"Could not get player via world.getEntitiesByTag:\", e.message);\r\n            }\r\n        }\r\n        \r\n        // Method 3: Check window.game for spaceship position\r\n        if (!playerPosition && window.game) {\r\n            try {\r\n                if (window.game.spaceship && window.game.spaceship.mesh && window.game.spaceship.mesh.position) {\r\n                    playerPosition = window.game.spaceship.mesh.position;\r\n                    console.log(\"Using spaceship mesh position for spawn points\");\r\n                }\r\n            } catch (e) {\r\n                console.log(\"Could not get player via window.game.spaceship:\", e.message);\r\n            }\r\n        }\r\n\r\n        return playerPosition;\r\n    }\r\n\r\n    /**\r\n     * Generate spawn points using current formation pattern\r\n     * @param {boolean} forceRegenerate - Force regeneration even if player hasn't moved far\r\n     * @returns {Array<THREE.Vector3>} Array of spawn points\r\n     */\r\n    generateSpawnPoints(forceRegenerate = false) {\r\n        const playerPosition = this.findPlayerPosition();\r\n        \r\n        // Check if we need to regenerate based on player movement\r\n        if (!forceRegenerate && this.lastPlayerPosition && playerPosition) {\r\n            const distance = this.lastPlayerPosition.distanceTo(playerPosition);\r\n            if (distance < this.regenerationDistance && this.spawnPoints.length > 0) {\r\n                return this.spawnPoints; // Use existing spawn points\r\n            }\r\n        }\r\n\r\n        // Clear existing spawn points\r\n        this.spawnPoints = [];\r\n        \r\n        // If no player position found, use default spawn points around origin\r\n        if (!playerPosition) {\r\n            console.log(\"No player position found - generating default spawn points around origin\");\r\n            const center = new THREE.Vector3(0, 0, 0);\r\n            this.spawnPoints = this.currentFormation.generate(\r\n                center,\r\n                this.currentFormation.defaultCount,\r\n                this.currentFormation.defaultRadius\r\n            );\r\n        } else {\r\n            // Generate spawn points around player\r\n            const center = playerPosition.clone ? playerPosition.clone() : \r\n                new THREE.Vector3(playerPosition.x, playerPosition.y, playerPosition.z);\r\n            \r\n            this.spawnPoints = this.currentFormation.generate(\r\n                center,\r\n                this.currentFormation.defaultCount,\r\n                this.currentFormation.defaultRadius\r\n            );\r\n            \r\n            this.lastPlayerPosition = center.clone();\r\n            \r\n            console.log(`Generated ${this.spawnPoints.length} spawn points using ${this.currentFormation.name} formation around player at position ${center.x.toFixed(0)}, ${center.y.toFixed(0)}, ${center.z.toFixed(0)}`);\r\n        }\r\n        \r\n        return this.spawnPoints;\r\n    }\r\n\r\n    /**\r\n     * Get a random spawn point\r\n     * @returns {THREE.Vector3} Random spawn position\r\n     */\r\n    getRandomSpawnPoint() {\r\n        // Make sure spawn points are available\r\n        if (this.spawnPoints.length === 0) {\r\n            this.generateSpawnPoints();\r\n        }\r\n        \r\n        // Choose a random spawn point\r\n        if (this.spawnPoints.length > 0) {\r\n            const index = Math.floor(Math.random() * this.spawnPoints.length);\r\n            return this.spawnPoints[index].clone();\r\n        } else {\r\n            // Fallback - spawn at a fixed distance from origin\r\n            console.warn(\"No spawn points available, using fallback position\");\r\n            const angle = Math.random() * Math.PI * 2;\r\n            const distance = 2000;\r\n            return new THREE.Vector3(\r\n                Math.cos(angle) * distance,\r\n                (Math.random() - 0.5) * 500,\r\n                Math.sin(angle) * distance\r\n            );\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Set formation pattern\r\n     * @param {string} patternName - Name of the formation pattern\r\n     * @param {boolean} regenerate - Whether to regenerate spawn points immediately\r\n     */\r\n    setFormationPattern(patternName, regenerate = true) {\r\n        const pattern = FORMATION_PATTERNS[patternName.toUpperCase()];\r\n        if (pattern) {\r\n            this.currentFormation = pattern;\r\n            if (regenerate) {\r\n                this.generateSpawnPoints(true);\r\n            }\r\n            console.log(`Formation pattern changed to: ${pattern.name}`);\r\n        } else {\r\n            console.warn(`Unknown formation pattern: ${patternName}`);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Get current formation info\r\n     * @returns {Object} Current formation information\r\n     */\r\n    getCurrentFormation() {\r\n        return {\r\n            name: this.currentFormation.name,\r\n            description: this.currentFormation.description,\r\n            spawnPointCount: this.spawnPoints.length\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Get spawn points in a specific formation around a position\r\n     * @param {THREE.Vector3} center - Center position\r\n     * @param {string} patternName - Formation pattern name\r\n     * @param {number} count - Number of spawn points\r\n     * @param {number} radius - Formation radius\r\n     * @returns {Array<THREE.Vector3>} Array of spawn points\r\n     */\r\n    generateFormationAround(center, patternName, count = 12, radius = 2500) {\r\n        const pattern = FORMATION_PATTERNS[patternName.toUpperCase()] || DEFAULT_FORMATION;\r\n        return pattern.generate(center, count, radius);\r\n    }\r\n\r\n    /**\r\n     * Clear all spawn points and force regeneration on next request\r\n     */\r\n    clearSpawnPoints() {\r\n        this.spawnPoints = [];\r\n        this.lastPlayerPosition = null;\r\n    }\r\n\r\n    /**\r\n     * Get statistics about current spawn points\r\n     * @returns {Object} Spawn point statistics\r\n     */\r\n    getSpawnPointStats() {\r\n        if (this.spawnPoints.length === 0) {\r\n            return { count: 0, pattern: 'none' };\r\n        }\r\n\r\n        // Calculate average distance from center\r\n        let totalDistance = 0;\r\n        let center = new THREE.Vector3();\r\n        \r\n        // Calculate center point\r\n        for (const point of this.spawnPoints) {\r\n            center.add(point);\r\n        }\r\n        center.divideScalar(this.spawnPoints.length);\r\n\r\n        // Calculate average distance from center\r\n        for (const point of this.spawnPoints) {\r\n            totalDistance += center.distanceTo(point);\r\n        }\r\n\r\n        return {\r\n            count: this.spawnPoints.length,\r\n            pattern: this.currentFormation.name,\r\n            averageDistance: Math.round(totalDistance / this.spawnPoints.length),\r\n            centerPosition: {\r\n                x: Math.round(center.x),\r\n                y: Math.round(center.y),\r\n                z: Math.round(center.z)\r\n            }\r\n        };\r\n    }\r\n}","/**\r\n * Spawn Scheduler - Manages timing, delays, and spawn rate control\r\n */\r\n\r\n/**\r\n * Spawn scheduler for managing enemy spawn timing\r\n */\r\nexport class SpawnScheduler {\r\n    constructor() {\r\n        this.spawnTimer = 0;\r\n        this.baseSpawnInterval = 3; // Base seconds between spawns\r\n        this.currentSpawnInterval = 3;\r\n        this.lastSpawnTime = Date.now();\r\n        this.initialDelay = 10; // Reduced to 10 seconds for testing (was 60)\r\n        this.initialDelayRemaining = this.initialDelay;\r\n        this.hasInitialDelayPassed = false;\r\n        \r\n        // Spawn rate modifiers\r\n        this.spawnRateModifier = 1.0;\r\n        this.minSpawnInterval = 0.5; // Minimum time between spawns\r\n        this.maxSpawnInterval = 10.0; // Maximum time between spawns\r\n        \r\n        // Statistics\r\n        this.totalSpawnsRequested = 0;\r\n        this.totalSpawnsSuccessful = 0;\r\n        this.lastSpawnRequestTime = 0;\r\n        this.averageSpawnInterval = this.baseSpawnInterval;\r\n        this._lastProgressLogged = 0; // Track progress logging to avoid spam\r\n        \r\n        console.log(`SpawnScheduler initialized with ${this.initialDelay}s initial delay`);\r\n    }\r\n\r\n    /**\r\n     * Update the spawn timer and check if spawning is allowed\r\n     * @param {number} deltaTime - Time since last update in seconds\r\n     * @param {number} currentEnemyCount - Current number of active enemies\r\n     * @param {number} maxEnemies - Maximum allowed enemies\r\n     * @param {number} difficultySpawnInterval - Spawn interval from difficulty system\r\n     * @returns {boolean} Whether spawning should occur\r\n     */\r\n    update(deltaTime, currentEnemyCount, maxEnemies, difficultySpawnInterval = null) {\r\n        console.log(`[SPAWN_SCHEDULER] Update called with deltaTime: ${deltaTime.toFixed(3)}, enemies: ${currentEnemyCount}/${maxEnemies}`);\r\n        \r\n        // Handle initial delay\r\n        if (!this.hasInitialDelayPassed) {\r\n            this.initialDelayRemaining -= deltaTime;\r\n            \r\n            console.log(`[SPAWN_SCHEDULER] Initial delay active: ${this.initialDelayRemaining.toFixed(1)}s remaining`);\r\n            \r\n            // Log progress every 5 seconds to help with debugging (reduced from 10 for better visibility)\r\n            const progress = Math.floor(this.initialDelay - this.initialDelayRemaining);\r\n            if (progress > 0 && progress % 5 === 0 && progress !== this._lastProgressLogged) {\r\n                const remainingTime = Math.ceil(this.initialDelayRemaining);\r\n                console.log(`[SPAWN_SCHEDULER] Enemy spawn delay: ${remainingTime} seconds remaining (${progress}/${this.initialDelay}s elapsed)`);\r\n                this._lastProgressLogged = progress;\r\n            }\r\n            \r\n            if (this.initialDelayRemaining <= 0) {\r\n                this.hasInitialDelayPassed = true;\r\n                this.showSpawnNotification();\r\n            } else {\r\n                return false; // Block all spawning during initial delay\r\n            }\r\n        }\r\n\r\n        // Update current spawn interval from difficulty if provided\r\n        if (difficultySpawnInterval !== null && difficultySpawnInterval !== this.currentSpawnInterval) {\r\n            this.setSpawnInterval(difficultySpawnInterval);\r\n        }\r\n\r\n        // Update spawn timer\r\n        this.spawnTimer += deltaTime;\r\n        \r\n        // Calculate effective spawn interval with modifiers\r\n        const effectiveInterval = this.getEffectiveSpawnInterval();\r\n        \r\n        // Check if we should spawn\r\n        const shouldSpawn = this.spawnTimer >= effectiveInterval && currentEnemyCount < maxEnemies;\r\n        \r\n        if (shouldSpawn) {\r\n            this.recordSpawnRequest();\r\n        }\r\n        \r\n        return shouldSpawn;\r\n    }\r\n\r\n    /**\r\n     * Record a spawn request for statistics\r\n     */\r\n    recordSpawnRequest() {\r\n        this.totalSpawnsRequested++;\r\n        this.lastSpawnRequestTime = Date.now();\r\n    }\r\n\r\n    /**\r\n     * Record a successful spawn and reset timer\r\n     * @param {boolean} wasSuccessful - Whether the spawn was successful\r\n     */\r\n    recordSpawn(wasSuccessful = true) {\r\n        if (wasSuccessful) {\r\n            this.totalSpawnsSuccessful++;\r\n            this.lastSpawnTime = Date.now();\r\n            \r\n            // Update running average of spawn intervals\r\n            const actualInterval = this.spawnTimer;\r\n            this.averageSpawnInterval = (this.averageSpawnInterval * 0.9) + (actualInterval * 0.1);\r\n        }\r\n        \r\n        // Reset timer regardless of success\r\n        this.spawnTimer = 0;\r\n    }\r\n\r\n    /**\r\n     * Get effective spawn interval with all modifiers applied\r\n     * @returns {number} Effective spawn interval in seconds\r\n     */\r\n    getEffectiveSpawnInterval() {\r\n        let interval = this.currentSpawnInterval * this.spawnRateModifier;\r\n        \r\n        // Clamp to min/max values\r\n        interval = Math.max(this.minSpawnInterval, Math.min(this.maxSpawnInterval, interval));\r\n        \r\n        return interval;\r\n    }\r\n\r\n    /**\r\n     * Set the base spawn interval\r\n     * @param {number} interval - New spawn interval in seconds\r\n     */\r\n    setSpawnInterval(interval) {\r\n        this.currentSpawnInterval = Math.max(this.minSpawnInterval, Math.min(this.maxSpawnInterval, interval));\r\n    }\r\n\r\n    /**\r\n     * Set spawn rate modifier (1.0 = normal, 0.5 = half rate, 2.0 = double rate)\r\n     * @param {number} modifier - Spawn rate modifier\r\n     */\r\n    setSpawnRateModifier(modifier) {\r\n        this.spawnRateModifier = Math.max(0.1, modifier); // Minimum 10% rate\r\n    }\r\n\r\n    /**\r\n     * Get time remaining until next spawn opportunity\r\n     * @returns {number} Time in seconds until next spawn check\r\n     */\r\n    getTimeUntilNextSpawn() {\r\n        if (!this.hasInitialDelayPassed) {\r\n            return this.initialDelayRemaining;\r\n        }\r\n        \r\n        const effectiveInterval = this.getEffectiveSpawnInterval();\r\n        return Math.max(0, effectiveInterval - this.spawnTimer);\r\n    }\r\n\r\n    /**\r\n     * Check if initial delay has passed\r\n     * @returns {boolean} Whether initial delay has completed\r\n     */\r\n    isInitialDelayComplete() {\r\n        return this.hasInitialDelayPassed;\r\n    }\r\n\r\n    /**\r\n     * Get remaining initial delay time\r\n     * @returns {number} Remaining initial delay in seconds\r\n     */\r\n    getRemainingInitialDelay() {\r\n        return Math.max(0, this.initialDelayRemaining);\r\n    }\r\n\r\n    /**\r\n     * Skip remaining initial delay (for testing or special events)\r\n     */\r\n    skipInitialDelay() {\r\n        this.hasInitialDelayPassed = true;\r\n        this.initialDelayRemaining = 0;\r\n        console.log(\"Initial spawn delay skipped\");\r\n    }\r\n\r\n    /**\r\n     * Reset the scheduler to initial state\r\n     */\r\n    reset() {\r\n        this.spawnTimer = 0;\r\n        this.currentSpawnInterval = this.baseSpawnInterval;\r\n        this.initialDelayRemaining = this.initialDelay;\r\n        this.hasInitialDelayPassed = false;\r\n        this.spawnRateModifier = 1.0;\r\n        this.totalSpawnsRequested = 0;\r\n        this.totalSpawnsSuccessful = 0;\r\n        this.lastSpawnTime = Date.now();\r\n        this.averageSpawnInterval = this.baseSpawnInterval;\r\n        this._lastProgressLogged = 0;\r\n        console.log(\"SpawnScheduler reset to initial state\");\r\n    }\r\n\r\n    /**\r\n     * Set new initial delay duration\r\n     * @param {number} delaySeconds - Initial delay in seconds\r\n     */\r\n    setInitialDelay(delaySeconds) {\r\n        this.initialDelay = Math.max(0, delaySeconds);\r\n        if (!this.hasInitialDelayPassed) {\r\n            this.initialDelayRemaining = this.initialDelay;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Get current scheduler statistics\r\n     * @returns {Object} Scheduler statistics\r\n     */\r\n    getStatistics() {\r\n        const now = Date.now();\r\n        const timeSinceLastSpawn = (now - this.lastSpawnTime) / 1000;\r\n        const successRate = this.totalSpawnsRequested > 0 ? \r\n            (this.totalSpawnsSuccessful / this.totalSpawnsRequested * 100).toFixed(1) : 0;\r\n\r\n        return {\r\n            currentSpawnInterval: this.currentSpawnInterval.toFixed(2),\r\n            effectiveSpawnInterval: this.getEffectiveSpawnInterval().toFixed(2),\r\n            spawnRateModifier: this.spawnRateModifier.toFixed(2),\r\n            timeUntilNextSpawn: this.getTimeUntilNextSpawn().toFixed(1),\r\n            timeSinceLastSpawn: timeSinceLastSpawn.toFixed(1),\r\n            totalSpawnsRequested: this.totalSpawnsRequested,\r\n            totalSpawnsSuccessful: this.totalSpawnsSuccessful,\r\n            successRate: `${successRate}%`,\r\n            averageSpawnInterval: this.averageSpawnInterval.toFixed(2),\r\n            initialDelayComplete: this.hasInitialDelayPassed,\r\n            remainingInitialDelay: this.hasInitialDelayPassed ? 0 : this.getRemainingInitialDelay().toFixed(1)\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Pause spawning (sets spawn rate modifier to 0)\r\n     */\r\n    pauseSpawning() {\r\n        this.spawnRateModifier = 0;\r\n        console.log(\"Spawning paused\");\r\n    }\r\n\r\n    /**\r\n     * Resume spawning (resets spawn rate modifier to 1)\r\n     */\r\n    resumeSpawning() {\r\n        this.spawnRateModifier = 1.0;\r\n        console.log(\"Spawning resumed\");\r\n    }\r\n\r\n    /**\r\n     * Check if spawning is currently paused\r\n     * @returns {boolean} Whether spawning is paused\r\n     */\r\n    isSpawningPaused() {\r\n        return this.spawnRateModifier === 0;\r\n    }\r\n\r\n    /**\r\n     * Show notification that spectral drones have been spotted\r\n     */\r\n    showSpawnNotification() {\r\n        if (window.game && window.game.ui && window.game.ui.showNotification) {\r\n            window.game.ui.showNotification('WARNING: Spectral drones have been spotted in the sector!', 5000);\r\n        } else if (window.mainMessageBus) {\r\n            window.mainMessageBus.publish('ui.notification', {\r\n                message: 'WARNING: Spectral drones have been spotted in the sector!',\r\n                duration: 5000\r\n            });\r\n        }\r\n    }\r\n}","/**\r\n * Spectral Drone - Handles spectral drone creation and configuration\r\n */\r\n\r\nimport { TransformComponent } from '../../../../../components/transform.js';\r\nimport { HealthComponent } from '../../../../../components/combat/healthComponent.js';\r\nimport { EnemyAIComponent } from '../../../../../components/combat/enemyAI.js';\r\nimport { MeshComponent } from '../../../../../components/rendering/mesh.js';\r\nimport { RigidbodyComponent } from '../../../../../components/physics/rigidbody.js';\r\nimport { ENEMY_TYPES, getEnemySubtype } from '../../waves/definitions.js';\r\n\r\nexport class SpectralDroneCreator {\r\n    constructor(world) {\r\n        this.world = world;\r\n    }\r\n\r\n    /**\r\n     * Create a spectral drone entity at the given position\r\n     * @param {THREE.Vector3} position Spawn position\r\n     * @param {Object} poolManager Enemy pool manager\r\n     * @param {Set} enemies Active enemies tracking set\r\n     * @param {number} maxEnemies Maximum enemy count\r\n     * @param {Object} subtype Enemy subtype configuration\r\n     * @returns {Entity|null} The created entity or null if failed\r\n     */\r\n    createSpectralDrone(position, poolManager, enemies, maxEnemies, subtype) {\r\n        console.log(\"Creating spectral drone...\");\r\n        \r\n        if (enemies.size >= maxEnemies) {\r\n            console.warn(`SPAWN BLOCKED: Already at maximum enemies (${enemies.size}/${maxEnemies})`);\r\n            return null;\r\n        }\r\n        \r\n        const entity = poolManager.getEnemyFromPool();\r\n        if (!entity) {\r\n            console.error(\"Failed to get entity from pool\");\r\n            return null;\r\n        }\r\n        \r\n        if (enemies.has(entity.id)) {\r\n            console.error(`Entity ${entity.id} is already in the active enemies list!`);\r\n            return null;\r\n        }\r\n        \r\n        this.cleanEntityState(entity);\r\n        \r\n        // Get full subtype config if only ID was passed\r\n        const fullSubtype = typeof subtype === 'string' ? getEnemySubtype(subtype) : \r\n                          (subtype.id ? getEnemySubtype(subtype.id) : subtype);\r\n        \r\n        this.setupEntityComponents(entity, position, fullSubtype);\r\n        \r\n        enemies.add(entity.id);\r\n        this.registerWithCombatSystem(entity);\r\n        \r\n        console.log(`Created spectral drone at position: x=${position.x.toFixed(0)}, y=${position.y.toFixed(0)}, z=${position.z.toFixed(0)}`);\r\n        \r\n        return entity;\r\n    }\r\n\r\n    /**\r\n     * Clean entity state from pool\r\n     * @param {Entity} entity Entity to clean\r\n     */\r\n    cleanEntityState(entity) {\r\n        if (entity.tags && entity.tags.size > 0) {\r\n            console.warn(`Entity ${entity.id} from pool still has tags: [${[...entity.tags]}]. Clearing all tags.`);\r\n            if (entity.clearTags && typeof entity.clearTags === 'function') {\r\n                entity.clearTags();\r\n            } else {\r\n                entity.tags.clear();\r\n                entity._isEnemy = false;\r\n                entity._isPooled = false;\r\n                entity._isPlayer = false;\r\n                entity._isProjectile = false;\r\n            }\r\n        }\r\n        \r\n        entity.addTag('enemy');\r\n        entity.addTag('spectrals');\r\n    }\r\n\r\n    /**\r\n     * Setup all components for the entity\r\n     * @param {Entity} entity Entity to setup\r\n     * @param {THREE.Vector3} position Spawn position\r\n     * @param {Object} subtype Enemy subtype configuration\r\n     */\r\n    setupEntityComponents(entity, position, subtype) {\r\n        const enemyType = ENEMY_TYPES.SPECTRAL_DRONE;\r\n        \r\n        // Store subtype on entity\r\n        entity.subtype = subtype.id;\r\n        \r\n        this.setupTransformComponent(entity, position, enemyType, subtype);\r\n        this.setupHealthComponent(entity, subtype);\r\n        this.setupAIComponent(entity, subtype);\r\n        this.setupPhysicsComponent(entity, subtype);\r\n    }\r\n\r\n\r\n    /**\r\n     * Setup transform component\r\n     */\r\n    setupTransformComponent(entity, position, enemyType, subtype) {\r\n        let transform = entity.getComponent(TransformComponent);\r\n        \r\n        if (!transform) {\r\n            transform = new TransformComponent(position.clone());\r\n            entity.addComponent(transform);\r\n        } else {\r\n            transform.position.copy(position);\r\n        }\r\n        \r\n        // Apply subtype-specific scale\r\n        const baseSize = enemyType.baseSize * (subtype.sizeScale || 1.0);\r\n        transform.scale.set(baseSize, baseSize, baseSize);\r\n        \r\n        // Random rotation offset\r\n        transform.rotation.x = (Math.random() - 0.5) * 0.2;\r\n        transform.rotation.y = (Math.random() - 0.5) * 0.2;\r\n        transform.rotation.z = (Math.random() - 0.5) * 0.2;\r\n        transform.needsUpdate = true;\r\n    }\r\n\r\n    /**\r\n     * Setup health component\r\n     */\r\n    setupHealthComponent(entity, subtype) {\r\n        let health = entity.getComponent(HealthComponent);\r\n        if (!health) {\r\n            health = new HealthComponent(subtype.health, 0);\r\n            entity.addComponent(health);\r\n        } else {\r\n            health.maxHealth = subtype.health;\r\n            health.health = subtype.health;\r\n            health.isDestroyed = false;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Setup AI component\r\n     */\r\n    setupAIComponent(entity, subtype) {\r\n        const enemyType = ENEMY_TYPES.SPECTRAL_DRONE;\r\n        \r\n        let enemyAI = entity.getComponent(EnemyAIComponent);\r\n        if (!enemyAI) {\r\n            const config = {\r\n                faction: enemyType.faction,\r\n                type: enemyType.type,\r\n                subtype: subtype.id,\r\n                health: subtype.health,\r\n                damage: subtype.damage,\r\n                speed: subtype.speed,\r\n                spiralAmplitude: subtype.spiralAmplitude,\r\n                spiralFrequency: subtype.spiralFrequency,\r\n                isDroneLike: enemyType.isDroneLike\r\n            };\r\n            enemyAI = new EnemyAIComponent(config);\r\n            entity.addComponent(enemyAI);\r\n        } else {\r\n            enemyAI.faction = enemyType.faction;\r\n            enemyAI.type = enemyType.type;\r\n            enemyAI.subtype = subtype.id;\r\n            enemyAI.damage = subtype.damage;\r\n            enemyAI.speed = subtype.speed;\r\n            enemyAI.spiralAmplitude = subtype.spiralAmplitude;\r\n            enemyAI.spiralFrequency = subtype.spiralFrequency;\r\n            enemyAI.isDroneLike = enemyType.isDroneLike;\r\n            enemyAI.enabled = true;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Setup physics component\r\n     */\r\n    setupPhysicsComponent(entity, subtype) {\r\n        let rigidbody = entity.getComponent(RigidbodyComponent);\r\n        if (!rigidbody) {\r\n            rigidbody = new RigidbodyComponent(1);\r\n            rigidbody.useGravity = false;\r\n            rigidbody.drag = 0.1;\r\n            rigidbody.shape = 'sphere';\r\n            rigidbody.collisionRadius = subtype.collisionRadius;\r\n            entity.addComponent(rigidbody);\r\n        } else {\r\n            rigidbody.isFrozen = false;\r\n            rigidbody.velocity.set(0, 0, 0);\r\n            rigidbody.collisionRadius = subtype.collisionRadius;\r\n        }\r\n        \r\n        const transform = entity.getComponent(TransformComponent);\r\n        if (transform && rigidbody) {\r\n            rigidbody.position = transform.position.clone();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Register entity with combat system\r\n     */\r\n    registerWithCombatSystem(entity) {\r\n        if (!entity.hasTag('enemy')) {\r\n            console.warn(`CRITICAL ERROR: Entity ${entity.id} missing 'enemy' tag after setup!`);\r\n            entity.addTag('enemy');\r\n        }\r\n        \r\n        if (window.game && window.game.combat && window.game.combat.registerEnemy) {\r\n            window.game.combat.registerEnemy(entity.id);\r\n        }\r\n    }\r\n}","/**\r\n * Mesh Generation - Handles enemy mesh creation and visual effects\r\n */\r\n\r\nimport * as THREE from 'three';\r\nimport { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';\r\nimport { MeshComponent } from '../../../../../components/rendering/mesh.js';\r\nimport { getEnemySubtype } from '../../waves/definitions.js';\r\n\r\nexport class MeshGeneration {\r\n    constructor(world) {\r\n        this.world = world;\r\n        this.modelCache = {};\r\n        this.materialCache = {}; // Cache materials to reuse them\r\n        this.currentEntity = null;\r\n        this.loadModels();\r\n        this.initializeMaterials(); // Pre-create all materials\r\n    }\r\n\r\n    /**\r\n     * Pre-load all enemy models\r\n     */\r\n    loadModels() {\r\n        const loader = new GLTFLoader();\r\n        const modelPaths = ['assets/enemy.glb'];\r\n        \r\n        const tryLoadModel = (index) => {\r\n            if (index >= modelPaths.length) {\r\n                console.warn('Could not load enemy model from any path, will use fallback meshes');\r\n                return;\r\n            }\r\n            \r\n            const path = modelPaths[index];\r\n            console.log(`Attempting to load enemy model from: ${path}`);\r\n            \r\n            loader.load(\r\n                path,\r\n                (gltf) => {\r\n                    console.log(`Enemy model loaded successfully from ${path}`);\r\n                    this.modelCache.enemyDrone = gltf.scene;\r\n                    this.applyGlobalModelEffects(this.modelCache.enemyDrone);\r\n                },\r\n                (xhr) => {},\r\n                (error) => {\r\n                    console.log(`Failed to load from ${path}, trying next...`);\r\n                    tryLoadModel(index + 1);\r\n                }\r\n            );\r\n        };\r\n        \r\n        tryLoadModel(0);\r\n    }\r\n\r\n    /**\r\n     * Apply global transformations and material adjustments to loaded models\r\n     * @param {THREE.Object3D} model The loaded model\r\n     */\r\n    applyGlobalModelEffects(model) {\r\n        // Model will get proper shader material when created\r\n        // Just ensure it's visible\r\n        model.traverse((child) => {\r\n            if (child.isMesh) {\r\n                child.visible = true;\r\n            }\r\n        });\r\n    }\r\n    \r\n    /**\r\n     * Pre-create and cache all materials and geometry for performance\r\n     */\r\n    initializeMaterials() {\r\n        console.log(\"Pre-creating enemy materials and geometry...\");\r\n        \r\n        // Cache geometry that will be reused\r\n        this.geometryCache = {\r\n            body: new THREE.OctahedronGeometry(2, 0),\r\n            wing: new THREE.BoxGeometry(4, 0.2, 1),\r\n            shield: new THREE.SphereGeometry(3, 8, 6)\r\n        };\r\n        \r\n        // Create simplified, performant materials for each subtype\r\n        const subtypes = ['standard', 'heavy', 'swift'];\r\n        \r\n        subtypes.forEach(subtypeId => {\r\n            const subtype = subtypeId === 'standard' ? \r\n                { color: { main: 0x00FFFF, emissive: { r: 0, g: 1, b: 1 } }, emissiveIntensity: 2.5 } :\r\n                subtypeId === 'heavy' ?\r\n                { color: { main: 0xFF6600, emissive: { r: 1, g: 0.4, b: 0 } }, emissiveIntensity: 3.0 } :\r\n                { color: { main: 0x66FF00, emissive: { r: 0.4, g: 1, b: 0 } }, emissiveIntensity: 2.8 };\r\n            \r\n            // Use simpler MeshPhongMaterial with emissive for performance\r\n            this.materialCache[subtypeId] = new THREE.MeshPhongMaterial({\r\n                color: subtype.color.main,\r\n                emissive: new THREE.Color(subtype.color.emissive.r, subtype.color.emissive.g, subtype.color.emissive.b),\r\n                emissiveIntensity: subtype.emissiveIntensity,\r\n                shininess: 100,\r\n                transparent: true,\r\n                opacity: 0.95,\r\n                side: THREE.DoubleSide\r\n            });\r\n        });\r\n        \r\n        // Warm up materials and geometry by creating temporary meshes\r\n        this.warmupMaterials();\r\n    }\r\n    \r\n    /**\r\n     * Warmup materials to precompile shaders\r\n     */\r\n    warmupMaterials() {\r\n        console.log(\"Warming up enemy materials (precompiling shaders)...\");\r\n        \r\n        // Delay warmup until scene is ready\r\n        setTimeout(() => {\r\n            // Create a temporary mesh for each material to force shader compilation\r\n            const tempGroup = new THREE.Group();\r\n            \r\n            Object.keys(this.materialCache).forEach(subtypeId => {\r\n                const tempMesh = new THREE.Mesh(this.geometryCache.body, this.materialCache[subtypeId]);\r\n                tempGroup.add(tempMesh);\r\n            });\r\n            \r\n            // Add to scene temporarily to force compilation\r\n            if (this.world && this.world.scene) {\r\n                // Use renderer facade if available\r\n                if (window.game && window.game.renderer && window.game.renderer.add) {\r\n                    window.game.renderer.add(tempGroup);\r\n                } else if (this.world.scene.add) {\r\n                    this.world.scene.add(tempGroup);\r\n                }\r\n                \r\n                // Try to force compilation if renderer supports it\r\n                try {\r\n                    if (window.game && window.game.renderer) {\r\n                        // The actual THREE.js renderer is at game.renderer.renderer\r\n                        const threeRenderer = window.game.renderer.renderer;\r\n                        const camera = window.game.camera || window.game.renderer.camera || this.world.scene.camera;\r\n                        \r\n                        if (threeRenderer && camera) {\r\n                            // Check if compile method exists (THREE.js r152+)\r\n                            if (typeof threeRenderer.compile === 'function') {\r\n                                threeRenderer.compile(this.world.scene, camera);\r\n                            } else {\r\n                                // Fallback: just render a frame to compile shaders\r\n                                threeRenderer.render(this.world.scene, camera);\r\n                            }\r\n                        }\r\n                    }\r\n                } catch (e) {\r\n                    console.log(\"Could not force shader compilation, will compile on first use:\", e.message);\r\n                }\r\n                \r\n                // Remove after a frame\r\n                setTimeout(() => {\r\n                    if (tempGroup && tempGroup.parent) {\r\n                        tempGroup.parent.remove(tempGroup);\r\n                    }\r\n                    // Dispose of temp meshes but keep materials and geometry\r\n                    if (tempGroup.children) {\r\n                        while (tempGroup.children.length > 0) {\r\n                            const child = tempGroup.children[0];\r\n                            tempGroup.remove(child);\r\n                            // Don't dispose materials or geometry - we're caching those!\r\n                        }\r\n                    }\r\n                    console.log(\"Material warmup complete\");\r\n                }, 100);\r\n            }\r\n        }, 1000); // Wait 1 second for everything to be initialized\r\n    }\r\n\r\n    /**\r\n     * Setup mesh component for entity\r\n     * @param {Entity} entity Entity to setup\r\n     * @param {string} subtypeId Enemy subtype ID\r\n     */\r\n    setupMeshComponent(entity, subtypeId = null) {\r\n        this.currentEntity = entity;\r\n        const mesh = this.createSpectralDroneMesh(subtypeId);\r\n        this.currentEntity = null;\r\n        \r\n        this.cleanupOldMeshComponent(entity);\r\n        \r\n        let meshComponent;\r\n        if (mesh.isGLTF) {\r\n            meshComponent = new MeshComponent(mesh.model);\r\n        } else {\r\n            meshComponent = new MeshComponent(mesh.geometry, mesh.material);\r\n        }\r\n        \r\n        entity.addComponent(meshComponent);\r\n        meshComponent.setVisible(true);\r\n        \r\n        this.addMeshToScene(entity, meshComponent);\r\n    }\r\n\r\n    /**\r\n     * Create spectral drone mesh\r\n     * @param {string} subtypeId Enemy subtype ID\r\n     * @returns {Object} Mesh object\r\n     */\r\n    createSpectralDroneMesh(subtypeId = null) {\r\n        console.log(\"Creating spectral drone mesh...\");\r\n        \r\n        // Get subtype configuration\r\n        const subtype = subtypeId ? getEnemySubtype(subtypeId) : \r\n                       (this.currentEntity && this.currentEntity.subtype ? \r\n                        getEnemySubtype(this.currentEntity.subtype) : \r\n                        getEnemySubtype('standard'));\r\n        \r\n        if (!this.modelCache.enemyDrone) {\r\n            return this.createFallbackMesh(subtype);\r\n        }\r\n        \r\n        const model = this.modelCache.enemyDrone.clone();\r\n        this.applySubtypeEffects(model, subtype);\r\n        \r\n        return { model, isGLTF: true };\r\n    }\r\n\r\n    /**\r\n     * Create fallback mesh when GLB model isn't available\r\n     * @param {Object} subtype Enemy subtype configuration\r\n     * @returns {Object} Fallback mesh object\r\n     */\r\n    createFallbackMesh(subtype) {\r\n        const group = new THREE.Group();\r\n        \r\n        // Use cached geometry and material for performance\r\n        const bodyMaterial = this.materialCache[subtype.id] || this.materialCache['standard'];\r\n        const body = new THREE.Mesh(this.geometryCache.body, bodyMaterial);\r\n        group.add(body);\r\n        \r\n        // Use cached geometry and reuse the same material for wings\r\n        const wingMaterial = bodyMaterial;\r\n        \r\n        const wing1 = new THREE.Mesh(this.geometryCache.wing, wingMaterial);\r\n        wing1.rotation.z = Math.PI / 6;\r\n        group.add(wing1);\r\n        \r\n        const wing2 = new THREE.Mesh(this.geometryCache.wing, wingMaterial);\r\n        wing2.rotation.z = -Math.PI / 6;\r\n        group.add(wing2);\r\n        \r\n        // Apply subtype-specific scale\r\n        const scale = 1.5 * (subtype.sizeScale || 1.0);\r\n        group.scale.set(scale, scale, scale);\r\n        \r\n        return group;\r\n    }\r\n\r\n    /**\r\n     * Apply visual effects based on subtype\r\n     * @param {THREE.Object3D} model Model to apply effects to\r\n     * @param {Object} subtype Enemy subtype configuration\r\n     */\r\n    applySubtypeEffects(model, subtype) {\r\n        // Use cached material instead of creating new shader\r\n        const material = this.materialCache[subtype.id] || this.materialCache['standard'];\r\n        \r\n        // Apply cached material to all meshes in the model\r\n        model.traverse((child) => {\r\n            if (child.isMesh) {\r\n                // Use the cached material\r\n                child.material = material;\r\n            }\r\n        });\r\n        \r\n        // Apply scale based on subtype\r\n        const scale = subtype.sizeScale || 1.0;\r\n        model.scale.multiplyScalar(scale);\r\n        \r\n        // Add subtype-specific effects\r\n        if (subtype.id === 'heavy') {\r\n            this.addHeavyDroneEffects(model, subtype);\r\n        } else if (subtype.id === 'swift') {\r\n            this.addSwiftDroneEffects(model, subtype);\r\n        } else {\r\n            this.addStandardDroneEffects(model, subtype);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Add effects for standard drones\r\n     */\r\n    addStandardDroneEffects(model, subtype) {\r\n        // Skip point lights - they're expensive\r\n        // The emissive material provides enough glow\r\n    }\r\n    \r\n    /**\r\n     * Add effects for heavy drones\r\n     */\r\n    addHeavyDroneEffects(model, subtype) {\r\n        // Add simple shield visual using cached geometry\r\n        // Cache shield material if not already cached\r\n        if (!this.materialCache['shield_' + subtype.id]) {\r\n            this.materialCache['shield_' + subtype.id] = new THREE.MeshBasicMaterial({\r\n                color: subtype.color.main,\r\n                transparent: true,\r\n                opacity: 0.15,\r\n                side: THREE.DoubleSide\r\n            });\r\n        }\r\n        const shield = new THREE.Mesh(this.geometryCache.shield, this.materialCache['shield_' + subtype.id]);\r\n        model.add(shield);\r\n        // Skip point light for performance\r\n    }\r\n    \r\n    /**\r\n     * Add effects for swift drones\r\n     */\r\n    addSwiftDroneEffects(model, subtype) {\r\n        // Skip particle trails and point lights for performance\r\n        // The high emissive and movement provides enough visual distinction\r\n    }\r\n\r\n\r\n    /**\r\n     * Clean up old mesh component\r\n     */\r\n    cleanupOldMeshComponent(entity) {\r\n        let meshComponent = entity.getComponent(MeshComponent);\r\n        \r\n        if (meshComponent) {\r\n            if (meshComponent.mesh && meshComponent.mesh.parent) {\r\n                meshComponent.mesh.parent.remove(meshComponent.mesh);\r\n            }\r\n            \r\n            if (meshComponent.mesh) {\r\n                if (meshComponent.mesh.geometry) {\r\n                    meshComponent.mesh.geometry.dispose();\r\n                }\r\n                \r\n                if (meshComponent.mesh.material) {\r\n                    if (Array.isArray(meshComponent.mesh.material)) {\r\n                        meshComponent.mesh.material.forEach(mat => mat.dispose());\r\n                    } else {\r\n                        meshComponent.mesh.material.dispose();\r\n                    }\r\n                }\r\n            }\r\n            \r\n            entity.removeComponent(MeshComponent);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Add mesh to scene and sync with transform\r\n     */\r\n    addMeshToScene(entity, meshComponent) {\r\n        if (this.world && this.world.scene && meshComponent.mesh) {\r\n            if (!meshComponent.mesh.parent) {\r\n                const prevGuard = window.__rendererGuard;\r\n                window.__rendererGuard = true;\r\n                try {\r\n                    this.world.scene.add(meshComponent.mesh);\r\n                } finally {\r\n                    window.__rendererGuard = prevGuard;\r\n                }\r\n            }\r\n            \r\n            const transform = entity.getComponent('TransformComponent');\r\n            if (transform && transform.position) {\r\n                meshComponent.mesh.position.copy(transform.position);\r\n                meshComponent.mesh.rotation.x = transform.rotation.x || 0;\r\n                meshComponent.mesh.rotation.y = transform.rotation.y || 0;\r\n                meshComponent.mesh.rotation.z = transform.rotation.z || 0;\r\n                meshComponent.mesh.scale.copy(transform.scale);\r\n                \r\n                console.log(`Synced mesh position to (${transform.position.x.toFixed(0)}, ${transform.position.y.toFixed(0)}, ${transform.position.z.toFixed(0)})`);\r\n            }\r\n        }\r\n    }\r\n}","/**\r\n * Enemy Factory - Handles entity creation, mesh generation, and component setup\r\n */\r\n\r\nimport { SpectralDroneCreator } from './enemies/spectralDrone.js';\r\nimport { MeshGeneration } from './enemies/meshGeneration.js';\r\nimport { getRandomEnemySubtype } from '../waves/definitions.js';\r\n\r\n/**\r\n * Factory for creating enemy entities with all required components\r\n */\r\nexport class EnemyFactory {\r\n    constructor(world) {\r\n        this.world = world;\r\n        \r\n        // Initialize extracted modules\r\n        this.spectralDroneCreator = new SpectralDroneCreator(world);\r\n        this.meshGeneration = new MeshGeneration(world);\r\n    }\r\n\r\n\r\n    /**\r\n     * Create a spectral drone entity at the given position\r\n     * @param {THREE.Vector3} position - Spawn position\r\n     * @param {Object} poolManager - Enemy pool manager\r\n     * @param {Set} enemies - Active enemies tracking set\r\n     * @param {number} maxEnemies - Maximum enemy count\r\n     * @param {Object} enemyConfig - Current enemy configuration (ignored, using subtype)\r\n     * @param {string} subtypeId - Optional specific subtype to create\r\n     * @returns {Entity|null} The created entity or null if failed\r\n     */\r\n    createSpectralDrone(position, poolManager, enemies, maxEnemies, enemyConfig, subtypeId = null) {\r\n        // Get random subtype if not specified\r\n        const subtype = subtypeId ? { id: subtypeId } : getRandomEnemySubtype();\r\n        \r\n        // Create entity with subtype-specific stats\r\n        const entity = this.spectralDroneCreator.createSpectralDrone(\r\n            position, \r\n            poolManager, \r\n            enemies, \r\n            maxEnemies, \r\n            subtype\r\n        );\r\n        \r\n        if (entity) {\r\n            // Store subtype on entity for later reference\r\n            entity.subtype = subtype.id;\r\n            // Setup mesh with subtype-specific shader\r\n            this.meshGeneration.setupMeshComponent(entity, subtype.id);\r\n        }\r\n        \r\n        return entity;\r\n    }\r\n\r\n\r\n\r\n}","/**\r\n * Enemy Spawner - Main spawner system that coordinates all spawning subsystems\r\n * Refactored from 856 LOC to under 250 LOC by extracting functionality into modules\r\n */\r\n\r\nimport { DifficultyProgression } from './waves/progression.js';\r\nimport { FormationBuilder } from './formations/builder.js';\r\nimport { SpawnScheduler } from './timing/scheduler.js';\r\nimport { EnemyFactory } from './factory/enemyFactory.js';\r\n\r\nexport class EnemySpawner {\r\n    constructor(world) {\r\n        this.world = world;\r\n        \r\n        // Initialize subsystems\r\n        this.difficultyProgression = new DifficultyProgression();\r\n        this.formationBuilder = new FormationBuilder(world);\r\n        this.spawnScheduler = new SpawnScheduler();\r\n        this.enemyFactory = new EnemyFactory(world);\r\n        \r\n        // Legacy compatibility properties\r\n        this.spawnPoints = []; // Maintained for backward compatibility\r\n        this.spawnTimer = 0;   // Delegated to scheduler\r\n        this.spawnInterval = 3; // Delegated to scheduler\r\n        this.lastSpawnTime = Date.now();\r\n        this.modelCache = {}; // Delegated to factory\r\n        this.baseEnemyConfig = {}; // Delegated to progression\r\n        this.enemyConfig = {}; // Delegated to progression\r\n        \r\n        console.log(\"EnemySpawner initialized with modular architecture\");\r\n        this.logInitializationStatus();\r\n    }\r\n    \r\n    /**\r\n     * Log initialization status of all subsystems\r\n     */\r\n    logInitializationStatus() {\r\n        console.log(\"Spawner subsystems: Difficulty, Formation, Scheduler (60s delay), Factory ready\");\r\n    }\r\n    \r\n    /**\r\n     * Generate spawn points for enemies based on player position\r\n     * Legacy method - now delegates to FormationBuilder\r\n     */\r\n    generateSpawnPoints() {\r\n        this.spawnPoints = this.formationBuilder.generateSpawnPoints();\r\n        console.log(`Generated ${this.spawnPoints.length} spawn points via FormationBuilder`);\r\n    }\r\n    \r\n    /**\r\n     * Get a random spawn point for enemies\r\n     * Legacy method - now delegates to FormationBuilder\r\n     * @returns {THREE.Vector3} Spawn position\r\n     */\r\n    getRandomSpawnPoint() {\r\n        const point = this.formationBuilder.getRandomSpawnPoint();\r\n        \r\n        // Update legacy spawnPoints array for compatibility\r\n        if (this.spawnPoints.length === 0) {\r\n            this.spawnPoints = this.formationBuilder.spawnPoints.slice();\r\n        }\r\n        \r\n        return point;\r\n    }\r\n    \r\n    /**\r\n     * Update difficulty parameters\r\n     * Legacy method - now delegates to DifficultyProgression\r\n     */\r\n    updateDifficultyParameters() {\r\n        const updated = this.difficultyProgression.updateParameters(this.world);\r\n        \r\n        if (updated) {\r\n            // Update legacy properties for compatibility\r\n            const currentConfig = this.difficultyProgression.getCurrentConfig();\r\n            this.enemyConfig = currentConfig;\r\n            this.spawnInterval = this.difficultyProgression.getCurrentSpawnInterval();\r\n        }\r\n        \r\n        return updated;\r\n    }\r\n    \r\n    /**\r\n     * Check the spawn timer and spawn enemies if needed\r\n     * Main update method that coordinates all subsystems\r\n     * @param {number} deltaTime - Time since last update\r\n     * @param {Set} enemies - Reference to active enemies set\r\n     * @param {number} maxEnemies - Maximum number of enemies allowed\r\n     * @param {function} spawnFunction - Function to call to spawn an enemy\r\n     * @returns {boolean} Whether an enemy was spawned\r\n     */\r\n    update(deltaTime, enemies, maxEnemies, spawnFunction) {\r\n        console.log(`[ENEMY_SPAWNER] Update called with deltaTime: ${deltaTime.toFixed(3)}, enemies: ${enemies.size}/${maxEnemies}`);\r\n        \r\n        // Update difficulty parameters\r\n        this.updateDifficultyParameters();\r\n        \r\n        // Get current difficulty-adjusted spawn interval\r\n        const currentSpawnInterval = this.difficultyProgression.getCurrentSpawnInterval();\r\n        \r\n        // Update spawn scheduler\r\n        console.log(`[ENEMY_SPAWNER] Calling scheduler.update with currentSpawnInterval: ${currentSpawnInterval}`);\r\n        const shouldSpawn = this.spawnScheduler.update(\r\n            deltaTime, \r\n            enemies.size, \r\n            maxEnemies, \r\n            currentSpawnInterval\r\n        );\r\n        \r\n        console.log(`[ENEMY_SPAWNER] Scheduler returned shouldSpawn: ${shouldSpawn}`);\r\n        \r\n        // Update legacy properties for compatibility\r\n        this.spawnTimer = this.spawnScheduler.spawnTimer;\r\n        this.spawnInterval = currentSpawnInterval;\r\n        \r\n        if (shouldSpawn) {\r\n            const spawnPoint = this.getRandomSpawnPoint();\r\n            if (!spawnPoint) {\r\n                console.error(\"Failed to get spawn point! Regenerating formation.\");\r\n                this.formationBuilder.generateSpawnPoints(true);\r\n                this.spawnScheduler.recordSpawn(false);\r\n                return false;\r\n            }\r\n            \r\n            // Call the provided spawn function\r\n            const result = spawnFunction(spawnPoint);\r\n            \r\n            // Record spawn result with scheduler\r\n            this.spawnScheduler.recordSpawn(result);\r\n            \r\n            if (result) {\r\n                this.lastSpawnTime = Date.now();\r\n                return true;\r\n            }\r\n        }\r\n        \r\n        return false;\r\n    }\r\n    \r\n    /**\r\n     * Spawn a spectral drone at the given position\r\n     * Main spawning method that delegates to EnemyFactory\r\n     * @param {THREE.Vector3} position - Position to spawn at\r\n     * @param {Object} poolManager - Enemy pool manager\r\n     * @param {Set} enemies - Reference to active enemies set\r\n     * @param {number} maxEnemies - Maximum number of enemies allowed\r\n     * @returns {Entity} The created entity\r\n     */\r\n    spawnSpectralDrone(position, poolManager, enemies, maxEnemies) {\r\n        console.log(\"Spawning spectral drone via EnemyFactory...\");\r\n        \r\n        // Get current enemy configuration from difficulty progression\r\n        const enemyConfig = this.difficultyProgression.getCurrentConfig();\r\n        \r\n        // Create the enemy using the factory\r\n        const entity = this.enemyFactory.createSpectralDrone(\r\n            position, \r\n            poolManager, \r\n            enemies, \r\n            maxEnemies, \r\n            enemyConfig\r\n        );\r\n        \r\n        if (entity) {\r\n            console.log(`Spectral drone spawned at (${position.x.toFixed(0)}, ${position.y.toFixed(0)}, ${position.z.toFixed(0)}). Count: ${enemies.size}/${maxEnemies}`);\r\n        }\r\n        \r\n        return entity;\r\n    }\r\n    \r\n    /**\r\n     * Set formation pattern for spawn points\r\n     * @param {string} patternName - Formation pattern name\r\n     */\r\n    setFormationPattern(patternName) {\r\n        this.formationBuilder.setFormationPattern(patternName, true);\r\n        this.spawnPoints = this.formationBuilder.spawnPoints.slice(); // Update legacy array\r\n    }\r\n    \r\n    /**\r\n     * Skip the initial spawn delay (for testing or special events)\r\n     */\r\n    skipInitialDelay() {\r\n        console.log(\"[ENEMY_SPAWNER] Skipping initial spawn delay\");\r\n        this.spawnScheduler.skipInitialDelay();\r\n    }\r\n    \r\n    /**\r\n     * Pause or resume spawning\r\n     * @param {boolean} paused - Whether to pause spawning\r\n     */\r\n    setSpawningPaused(paused) {\r\n        if (paused) {\r\n            this.spawnScheduler.pauseSpawning();\r\n        } else {\r\n            this.spawnScheduler.resumeSpawning();\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Reset all spawner subsystems to initial state\r\n     */\r\n    reset() {\r\n        this.difficultyProgression.reset();\r\n        this.formationBuilder.clearSpawnPoints();\r\n        this.spawnScheduler.reset();\r\n        \r\n        // Reset legacy properties\r\n        this.spawnPoints = [];\r\n        this.spawnTimer = 0;\r\n        this.spawnInterval = 3;\r\n        this.lastSpawnTime = Date.now();\r\n        \r\n        console.log(\"EnemySpawner reset to initial state\");\r\n    }\r\n    \r\n    /**\r\n     * Get comprehensive statistics from all subsystems\r\n     * @returns {Object} Combined statistics\r\n     */\r\n    getStatistics() {\r\n        return {\r\n            scheduler: this.spawnScheduler.getStatistics(),\r\n            difficulty: this.difficultyProgression.getStats(),\r\n            formation: this.formationBuilder.getSpawnPointStats(),\r\n            factory: {\r\n                modelCacheLoaded: !!this.enemyFactory.modelCache.enemyDrone\r\n            }\r\n        };\r\n    }\r\n    \r\n    /**\r\n     * Get current enemy configuration\r\n     * @returns {Object} Current enemy configuration\r\n     */\r\n    getCurrentEnemyConfig() {\r\n        return this.difficultyProgression.getCurrentConfig();\r\n    }\r\n    \r\n    /**\r\n     * Check if initial spawn delay has passed\r\n     * @returns {boolean} Whether spawning can begin\r\n     */\r\n    canSpawn() {\r\n        return this.spawnScheduler.isInitialDelayComplete();\r\n    }\r\n    \r\n    /**\r\n     * Get time remaining until spawning can begin\r\n     * @returns {number} Remaining delay time in seconds\r\n     */\r\n    getRemainingDelay() {\r\n        return this.spawnScheduler.getRemainingInitialDelay();\r\n    }\r\n}","/**\r\n * Enemy Lifecycle Manager - Handles the lifecycle of enemy entities\r\n */\r\n\r\nimport { TransformComponent } from '../../components/transform.js';\r\nimport { EnemyAIComponent } from '../../components/combat/enemyAI.js';\r\nimport { HealthComponent } from '../../components/combat/healthComponent.js';\r\nimport { MeshComponent } from '../../components/rendering/mesh.js';\r\nimport { RigidbodyComponent } from '../../components/physics/rigidbody.js';\r\n\r\nexport class EnemyLifecycle {\r\n    constructor(world) {\r\n        this.world = world;\r\n    }\r\n    \r\n    /**\r\n     * Validate enemy references to ensure all tracked enemies exist\r\n     * This helps prevent \"ghost\" references that block new spawns\r\n     * @param {Set} enemies Reference to the active enemies set for tracking\r\n     */\r\n    validateEnemyReferences(enemies) {\r\n        // Store original size for logging\r\n        const originalSize = enemies.size;\r\n        \r\n        // Create a new Set to hold valid enemy IDs\r\n        const validEnemies = new Set();\r\n        \r\n        // Check each enemy ID in our tracking Set\r\n        for (const enemyId of enemies) {\r\n            // Get the entity from the world\r\n            const entity = this.world.getEntity(enemyId);\r\n            \r\n            // If entity exists, is an enemy, and is NOT pooled, keep tracking it\r\n            if (entity && entity.hasTag && entity.hasTag('enemy') && !entity.hasTag('pooled')) {\r\n                validEnemies.add(enemyId);\r\n            } else {\r\n                if (!entity) {\r\n                    console.warn(`Removing invalid enemy reference: ${enemyId} - Entity does not exist`);\r\n                } else if (!entity.hasTag) {\r\n                    console.warn(`Removing invalid enemy reference: ${enemyId} - Entity missing hasTag method`);\r\n                } else if (!entity.hasTag('enemy')) {\r\n                    // Check for tag inconsistency - entity might have the tag in its Set but the cache is wrong\r\n                    if (entity.tags && entity.tags.has && entity.tags.has('enemy')) {\r\n                        console.warn(`Entity ${enemyId} has inconsistent tag state: hasTag('enemy')=false but tag exists in Set`);\r\n                        \r\n                        // Force sync the entity's tag cache if possible\r\n                        if (entity._syncTagCache && typeof entity._syncTagCache === 'function') {\r\n                            entity._syncTagCache();\r\n                            console.log(`Fixed tag cache for entity ${enemyId}`);\r\n                            \r\n                            // Check again if the tag is now recognized\r\n                            if (entity.hasTag('enemy')) {\r\n                                console.log(`Entity ${enemyId} now properly recognizes 'enemy' tag, keeping in tracking`);\r\n                                validEnemies.add(enemyId);\r\n                                continue;\r\n                            }\r\n                        }\r\n                    }\r\n                    \r\n                    // If entity truly doesn't have the enemy tag, log and remove\r\n                    console.warn(`Removing invalid enemy reference: ${enemyId} - Entity missing 'enemy' tag. Tags: [${Array.from(entity.tags)}]`);\r\n                } else if (entity.hasTag('pooled')) {\r\n                    console.warn(`Removing invalid enemy reference: ${enemyId} - Entity is pooled but still has 'enemy' tag`);\r\n                    // Critical fix: Ensure pooled entities don't retain 'enemy' tag\r\n                    if (entity.hasTag('enemy')) {\r\n                        console.log(`Fixing inconsistent tag state: entity ${enemyId} is pooled but still has 'enemy' tag`);\r\n                        entity.removeTag('enemy');\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        \r\n        // Replace our tracking Set with the validated Set\r\n        enemies.clear();\r\n        for (const id of validEnemies) {\r\n            enemies.add(id);\r\n        }\r\n        \r\n        // Double-check: also scan for any enemies that might not be in our tracking\r\n        let entitiesScanned = 0;\r\n        try {\r\n            if (this.world && this.world.entityManager) {\r\n                // Try to get entities with the 'enemy' tag first\r\n                let enemyEntities = [];\r\n                \r\n                if (this.world.entityManager.entitiesByTag && \r\n                    this.world.entityManager.entitiesByTag.get) {\r\n                    enemyEntities = this.world.entityManager.entitiesByTag.get('enemy') || [];\r\n                    entitiesScanned = enemyEntities.length;\r\n                    \r\n                    // Add any enemy entities that aren't in our tracking Set\r\n                    // BUT make sure they're not pooled (inactive) entities\r\n                    for (const enemy of enemyEntities) {\r\n                        // Skip undefined/null entities\r\n                        if (!enemy) continue;\r\n                        \r\n                        // Fix any cache inconsistencies before checking pooled status\r\n                        if (enemy._syncTagCache && typeof enemy._syncTagCache === 'function') {\r\n                            enemy._syncTagCache();\r\n                        }\r\n                        \r\n                        // CRITICAL FIX: First check if enemy is pooled BEFORE adding to tracking\r\n                        if (!enemy.hasTag('pooled')) {\r\n                            if (!enemies.has(enemy.id)) {\r\n                                console.log(`Found untracked enemy: ${enemy.id}, adding to tracking. Tags: [${[...enemy.tags]}]`);\r\n                                enemies.add(enemy.id);\r\n                            }\r\n                        } else {\r\n                            // Make sure pooled enemies are not in our tracking\r\n                            if (enemies.has(enemy.id)) {\r\n                                console.log(`Removing pooled enemy from tracking: ${enemy.id}`);\r\n                                enemies.delete(enemy.id);\r\n                            }\r\n                            \r\n                            // CRITICAL FIX: If an entity is pooled but still has the enemy tag, \r\n                            // remove the enemy tag to fix the inconsistency\r\n                            if (enemy.hasTag('enemy')) {\r\n                                console.log(`Fixing inconsistent tag state: pooled entity ${enemy.id} still has 'enemy' tag`);\r\n                                // Directly call removeTag to ensure proper cleanup\r\n                                enemy.removeTag('enemy');\r\n                            }\r\n                        }\r\n                    }\r\n                    \r\n                    // Another check: verify if the EntityManager tag maps are consistent with entity tags\r\n                    this.validateEntityManagerTagMaps(enemies);\r\n                }\r\n            }\r\n        } catch (error) {\r\n            console.error(\"Error during entity scan:\", error);\r\n        }\r\n        \r\n        // Log if we fixed any tracking issues\r\n        if (originalSize !== enemies.size) {\r\n            console.log(`Enemy tracking corrected: ${originalSize} -> ${enemies.size} enemies tracked. Scanned ${entitiesScanned} entities.`);\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Additional method to validate and fix EntityManager tag maps\r\n     * This helps ensure entity tags are consistent with the EntityManager's tracking\r\n     * @param {Set} enemies Reference to the active enemies set for tracking\r\n     */\r\n    validateEntityManagerTagMaps(enemies) {\r\n        if (!this.world || !this.world.entityManager || !this.world.entityManager.entitiesByTag) {\r\n            return;\r\n        }\r\n        \r\n        try {\r\n            const entitiesByTag = this.world.entityManager.entitiesByTag;\r\n            \r\n            // Check the enemy tag map specifically\r\n            if (entitiesByTag.has('enemy')) {\r\n                const enemyMap = entitiesByTag.get('enemy');\r\n                const invalidEntities = [];\r\n                \r\n                // Check each entity in the enemy map\r\n                for (let i = 0; i < enemyMap.length; i++) {\r\n                    const entity = enemyMap[i];\r\n                    \r\n                    // Skip invalid entities\r\n                    if (!entity) {\r\n                        invalidEntities.push(i);\r\n                        continue;\r\n                    }\r\n                    \r\n                    // If entity doesn't actually have the enemy tag in its tag Set, fix it\r\n                    if (!entity.tags || !entity.tags.has('enemy')) {\r\n                        console.warn(`Entity ${entity.id} is in 'enemy' tag map but doesn't have the tag in its Set`);\r\n                        \r\n                        // Add the tag properly through the entity's method\r\n                        if (entity.addTag) {\r\n                            entity.addTag('enemy');\r\n                            console.log(`Added missing 'enemy' tag to entity ${entity.id}`);\r\n                        } else {\r\n                            // If can't fix, mark for removal\r\n                            invalidEntities.push(i);\r\n                        }\r\n                    }\r\n                    \r\n                    // If entity has both enemy and pooled tags, that's an inconsistency\r\n                    if (entity.hasTag && entity.hasTag('pooled') && entity.hasTag('enemy')) {\r\n                        console.warn(`Entity ${entity.id} has both 'pooled' and 'enemy' tags - removing 'enemy' tag`);\r\n                        entity.removeTag('enemy');\r\n                        invalidEntities.push(i);\r\n                    }\r\n                }\r\n                \r\n                // Remove invalid entities from the map (in reverse order to avoid index issues)\r\n                for (let i = invalidEntities.length - 1; i >= 0; i--) {\r\n                    const index = invalidEntities[i];\r\n                    enemyMap.splice(index, 1);\r\n                }\r\n                \r\n                // Log changes if any were made\r\n                if (invalidEntities.length > 0) {\r\n                    console.log(`Fixed ${invalidEntities.length} inconsistencies in EntityManager 'enemy' tag map`);\r\n                }\r\n            }\r\n        } catch (error) {\r\n            console.error(\"Error validating EntityManager tag maps:\", error);\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Freeze all enemy entities in place\r\n     * @param {Set} enemies Reference to the active enemies set for tracking\r\n     */\r\n    freezeAllEnemies(enemies) {\r\n        // Filter out pooled (inactive) enemies\r\n        const activeEnemies = Array.from(enemies).filter(enemyId => {\r\n            const enemy = this.world.getEntity(enemyId);\r\n            return enemy && !enemy.hasTag('pooled');\r\n        });\r\n        \r\n        console.log(`Freezing all ${activeEnemies.length} active enemies...`);\r\n        \r\n        // Iterate through all active enemies and stop their movement\r\n        for (const enemyId of activeEnemies) {\r\n            const enemy = this.world.getEntity(enemyId);\r\n            if (!enemy) {\r\n                // Skip if entity doesn't exist\r\n                console.warn(`Enemy ${enemyId} not found when freezing - may have been destroyed`);\r\n                continue;\r\n            }\r\n            \r\n            // Get the rigidbody component if it exists\r\n            const rigidbody = enemy.getComponent(RigidbodyComponent);\r\n            if (rigidbody) {\r\n                // Set velocity to zero\r\n                rigidbody.velocity.set(0, 0, 0);\r\n                \r\n                // Set angular velocity to zero if it exists\r\n                if (rigidbody.angularVelocity) {\r\n                    rigidbody.angularVelocity.set(0, 0, 0);\r\n                }\r\n                \r\n                // Mark as frozen\r\n                rigidbody.isFrozen = true;\r\n            }\r\n            \r\n            // Get the enemy AI component\r\n            const enemyAI = enemy.getComponent(EnemyAIComponent);\r\n            if (enemyAI) {\r\n                // Store original enabled state if not already stored\r\n                if (enemyAI.originalEnabledState === undefined) {\r\n                    enemyAI.originalEnabledState = enemyAI.enabled;\r\n                }\r\n                \r\n                // Disable the AI component\r\n                enemyAI.enabled = false;\r\n            }\r\n            \r\n            // Mark the entity as frozen for other systems to recognize\r\n            enemy.addTag('frozen');\r\n        }\r\n        \r\n        console.log(\"All enemies frozen successfully\");\r\n    }\r\n    \r\n    /**\r\n     * Unfreeze all enemy entities and re-enable their AI\r\n     * @param {Set} enemies Reference to the active enemies set for tracking\r\n     */\r\n    unfreezeAllEnemies(enemies) {\r\n        // Filter out pooled (inactive) enemies\r\n        const activeEnemies = Array.from(enemies).filter(enemyId => {\r\n            const enemy = this.world.getEntity(enemyId);\r\n            return enemy && !enemy.hasTag('pooled');\r\n        });\r\n        \r\n        console.log(`Unfreezing all ${activeEnemies.length} active enemies...`);\r\n        \r\n        // Iterate through all active enemies and re-enable their AI\r\n        for (const enemyId of activeEnemies) {\r\n            const enemy = this.world.getEntity(enemyId);\r\n            if (!enemy) {\r\n                // Skip if entity doesn't exist\r\n                console.warn(`Enemy ${enemyId} not found when unfreezing - may have been destroyed`);\r\n                continue;\r\n            }\r\n            \r\n            // Get the rigidbody component if it exists\r\n            const rigidbody = enemy.getComponent(RigidbodyComponent);\r\n            if (rigidbody) {\r\n                // Un-mark as frozen\r\n                rigidbody.isFrozen = false;\r\n            }\r\n            \r\n            // Get the enemy AI component\r\n            const enemyAI = enemy.getComponent(EnemyAIComponent);\r\n            if (enemyAI) {\r\n                // Restore original enabled state or default to enabled\r\n                enemyAI.enabled = (enemyAI.originalEnabledState !== undefined) ? \r\n                    enemyAI.originalEnabledState : true;\r\n            }\r\n            \r\n            // Remove the frozen tag\r\n            if (enemy.hasTag && enemy.hasTag('frozen')) {\r\n                enemy.removeTag('frozen');\r\n            }\r\n        }\r\n        \r\n        console.log(\"All enemies unfrozen successfully\");\r\n    }\r\n    \r\n    /**\r\n     * Force destroy excess enemies to enforce the enemy limit\r\n     * @param {Set} enemies Reference to the active enemies set for tracking\r\n     * @param {number} maxEnemies Maximum number of enemies allowed\r\n     * @param {Function} returnEnemyToPool Function to return an enemy to the pool\r\n     */\r\n    enforceEnemyLimit(enemies, maxEnemies, returnEnemyToPool) {\r\n        // Convert to array for easier manipulation\r\n        const enemyIds = [...enemies];\r\n        \r\n        // Calculate how many enemies to remove\r\n        const excessCount = enemies.size - maxEnemies;\r\n        if (excessCount <= 0) return;\r\n        \r\n        console.log(`Enforcing enemy limit by removing ${excessCount} excess enemies`);\r\n        \r\n        // Remove the oldest enemies first (at the start of the array)\r\n        for (let i = 0; i < excessCount && i < enemyIds.length; i++) {\r\n            const entityId = enemyIds[i];\r\n            const entity = this.world.getEntity(entityId);\r\n            \r\n            if (entity) {\r\n                console.log(`Force destroying excess enemy ${entityId}`);\r\n                \r\n                // Remove from tracking first\r\n                enemies.delete(entityId);\r\n                \r\n                // If entity has health component, mark as destroyed\r\n                const health = entity.getComponent(HealthComponent);\r\n                if (health) {\r\n                    health.health = 0;\r\n                    health.isDestroyed = true;\r\n                }\r\n                \r\n                // Create explosion effect\r\n                if (this.world && this.world.messageBus) {\r\n                    const transform = entity.getComponent(TransformComponent);\r\n                    if (transform) {\r\n                        this.world.messageBus.publish('vfx.explosion', {\r\n                            position: transform.position.clone(),\r\n                            scale: 1.0,\r\n                            duration: 1.0\r\n                        });\r\n                    }\r\n                }\r\n                \r\n                // Return to pool or destroy completely\r\n                returnEnemyToPool(entity);\r\n            } else {\r\n                // If entity doesn't exist, just remove from tracking\r\n                enemies.delete(entityId);\r\n            }\r\n        }\r\n        \r\n        // Validate references after cleanup\r\n        this.validateEnemyReferences(enemies);\r\n    }\r\n    \r\n    /**\r\n     * Clear all tracking Set\r\n     * @param {Set} enemies Reference to the active enemies set for tracking\r\n     */\r\n    clearAllEnemies(enemies) {\r\n        // Log the current count\r\n        console.log(`Clearing all enemies. Current count: ${enemies.size}`);\r\n        \r\n        // Clear the enemies Set\r\n        enemies.clear();\r\n        \r\n        // Verify\r\n        console.log(`After clearing, enemy count: ${enemies.size}`);\r\n    }\r\n    \r\n    /**\r\n     * Process a single enemy entity's update\r\n     * @param {Entity} entity Entity to process\r\n     * @param {number} deltaTime Time since last update in seconds\r\n     */\r\n    processEntityUpdate(entity, deltaTime) {\r\n        // Get enemy AI component\r\n        const enemyAI = entity.getComponent(EnemyAIComponent);\r\n        \r\n        // Skip if entity is missing an enemy AI component\r\n        if (!enemyAI) return;\r\n        \r\n        // Get transform component\r\n        const transform = entity.getComponent(TransformComponent);\r\n        \r\n        // Skip if entity is missing a transform component\r\n        if (!transform) return;\r\n        \r\n        // Get mesh component\r\n        const meshComponent = entity.getComponent(MeshComponent);\r\n        \r\n        // Check if mesh component exists and has been added to scene\r\n        if (meshComponent && meshComponent.mesh) {\r\n            // Ensure mesh visibility\r\n            meshComponent.mesh.visible = true;\r\n            \r\n            // Check if mesh has been added to scene\r\n            if (!meshComponent.mesh.parent && this.world.scene) {\r\n                console.log(`Adding enemy mesh to scene`);\r\n                this.world.scene.add(meshComponent.mesh);\r\n                \r\n                // Call the onAddedToScene method if it exists\r\n                if (meshComponent.onAddedToScene) {\r\n                    meshComponent.onAddedToScene(this.world.scene);\r\n                }\r\n            }\r\n            \r\n            // Update mesh position to match entity transform\r\n            meshComponent.mesh.position.copy(transform.position);\r\n            meshComponent.mesh.quaternion.copy(transform.quaternion);\r\n            meshComponent.mesh.scale.copy(transform.scale);\r\n            \r\n            // Process special visual effects if this is an enhanced enemy\r\n            if (entity.visualVariant === 2 || entity.visualVariant === 3) {\r\n                // Update any special effects attached to the model\r\n                meshComponent.mesh.traverse((child) => {\r\n                    if (child.userData && typeof child.userData.update === 'function') {\r\n                        child.userData.update(deltaTime);\r\n                    }\r\n                });\r\n                \r\n                // Add additional visual effects for elite enemies (variant 2)\r\n                if (entity.visualVariant === 2 && entity.eliteParticleTime === undefined) {\r\n                    // Occasionally emit a small particle effect for elites\r\n                    entity.eliteParticleTime = 0;\r\n                } else if (entity.visualVariant === 2) {\r\n                    // Update elite particle timer\r\n                    entity.eliteParticleTime += deltaTime;\r\n                    \r\n                    // Every 1.5 seconds, emit a particle\r\n                    if (entity.eliteParticleTime > 1.5) {\r\n                        entity.eliteParticleTime = 0;\r\n                        \r\n                        // Emit a particle effect using the global VFX system if available\r\n                        if (this.world && this.world.messageBus) {\r\n                            this.world.messageBus.publish('vfx.pulse', {\r\n                                position: transform.position.clone(),\r\n                                color: 0xaaffff,\r\n                                scale: 0.7,\r\n                                duration: 0.8\r\n                            });\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            \r\n            // Special flickering effect for damaged enemies (variant 1)\r\n            if (entity.visualVariant === 1 && meshComponent.mesh.material) {\r\n                // Apply a flickering effect to the material\r\n                if (Array.isArray(meshComponent.mesh.material)) {\r\n                    for (const material of meshComponent.mesh.material) {\r\n                        material.emissiveIntensity = 0.5 + (Math.sin(Date.now() * 0.01) * 0.3);\r\n                    }\r\n                } else if (meshComponent.mesh.material.emissiveIntensity !== undefined) {\r\n                    meshComponent.mesh.material.emissiveIntensity = 0.5 + (Math.sin(Date.now() * 0.01) * 0.3);\r\n                }\r\n            }\r\n        }\r\n        \r\n        // Call the component's update method\r\n        enemyAI.update(deltaTime);\r\n        \r\n        // Get health component to update shield regeneration\r\n        const health = entity.getComponent(HealthComponent);\r\n        if (health) {\r\n            health.update(deltaTime);\r\n        }\r\n    }\r\n} ","/**\r\n * Separation Behavior - Handles enemy separation to avoid clustering\r\n */\r\n\r\nimport * as THREE from 'three';\r\nimport { TransformComponent } from '../../../../components/transform.js';\r\nimport { RigidbodyComponent } from '../../../../components/physics/rigidbody.js';\r\nimport { EnemyAIComponent } from '../../../../components/combat/enemyAI.js';\r\n\r\nexport class SeparationBehavior {\r\n    constructor() {\r\n        this.SEPARATION_FORCE_MAGNITUDE = 150;\r\n        this.separationThresholdMultiplier = 2.5;\r\n    }\r\n\r\n    /**\r\n     * Apply separation behavior to avoid overlapping with other enemies\r\n     * @param {Entity} entity The entity to apply separation to\r\n     * @param {number} deltaTime Time since last update in seconds\r\n     * @param {Set} enemies Set of all enemy entities\r\n     * @param {World} world Game world instance\r\n     */\r\n    applySeparationBehavior(entity, deltaTime, enemies, world) {\r\n        const transform = entity.getComponent(TransformComponent);\r\n        const rigidbody = entity.getComponent(RigidbodyComponent);\r\n        const enemyAI = entity.getComponent(EnemyAIComponent);\r\n        \r\n        if (!transform || !rigidbody || !enemyAI || rigidbody.isFrozen) {\r\n            return;\r\n        }\r\n        \r\n        const separationForce = this.calculateSeparationForce(entity, transform, rigidbody, enemies, world);\r\n        \r\n        if (separationForce.lengthSq() > 0.01) {\r\n            enemyAI.setSeparationForce(separationForce);\r\n            rigidbody.applyForce(separationForce);\r\n        } else {\r\n            enemyAI.setSeparationForce(new THREE.Vector3());\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Calculate separation force to avoid nearby enemies\r\n     * @param {Entity} entity The current entity\r\n     * @param {TransformComponent} transform The entity's transform\r\n     * @param {RigidbodyComponent} rigidbody The entity's rigidbody\r\n     * @param {Set} enemies Set of all enemy entities\r\n     * @param {World} world Game world instance\r\n     * @returns {THREE.Vector3} The calculated separation force\r\n     */\r\n    calculateSeparationForce(entity, transform, rigidbody, enemies, world) {\r\n        const separationForce = new THREE.Vector3();\r\n        const separationThreshold = rigidbody.collisionRadius * this.separationThresholdMultiplier;\r\n        const nearbyEnemies = this.findNearbyEnemies(entity, transform.position, separationThreshold, enemies, world);\r\n        \r\n        for (const neighborId of nearbyEnemies) {\r\n            if (neighborId === entity.id) continue;\r\n            \r\n            const neighbor = world.getEntity(neighborId);\r\n            if (!neighbor) continue;\r\n            \r\n            const neighborTransform = neighbor.getComponent(TransformComponent);\r\n            if (!neighborTransform) continue;\r\n            \r\n            const awayVector = transform.position.clone().sub(neighborTransform.position);\r\n            const distance = awayVector.length();\r\n            \r\n            if (distance >= separationThreshold || distance === 0) continue;\r\n            \r\n            let strength = (separationThreshold - distance) / separationThreshold;\r\n            awayVector.normalize();\r\n            separationForce.add(awayVector.multiplyScalar(strength * this.SEPARATION_FORCE_MAGNITUDE));\r\n        }\r\n        \r\n        return separationForce;\r\n    }\r\n\r\n    /**\r\n     * Find nearby enemy entities within a certain radius\r\n     * @param {Entity} entity The entity to find neighbors for\r\n     * @param {THREE.Vector3} position The position to check from\r\n     * @param {number} radius The radius to check within\r\n     * @param {Set} enemies Set of all enemy entities\r\n     * @param {World} world Game world instance\r\n     * @returns {Set} Set of nearby enemy entity IDs\r\n     */\r\n    findNearbyEnemies(entity, position, radius, enemies, world) {\r\n        const nearbyEnemies = new Set();\r\n        \r\n        for (const enemyId of enemies) {\r\n            if (enemyId === entity.id) continue;\r\n            \r\n            const enemyEntity = world.getEntity(enemyId);\r\n            if (!enemyEntity || enemyEntity.hasTag('pooled')) continue;\r\n            \r\n            const enemyTransform = enemyEntity.getComponent(TransformComponent);\r\n            if (!enemyTransform) continue;\r\n            \r\n            const distance = position.distanceTo(enemyTransform.position);\r\n            if (distance < radius) {\r\n                nearbyEnemies.add(enemyId);\r\n            }\r\n        }\r\n        \r\n        return nearbyEnemies;\r\n    }\r\n}","/**\r\n * Difficulty Scaling - Handles enemy parameter scaling based on game difficulty\r\n */\r\n\r\nexport class DifficultyScaling {\r\n    constructor() {\r\n        this.lastLoggedHordeTime = 0;\r\n        this.lastFullLoggedHordeTime = 0;\r\n    }\r\n\r\n    /**\r\n     * Update enemy parameters based on difficulty scaling from game object\r\n     * @param {Object} enemySystem Enemy system instance\r\n     */\r\n    updateDifficultyScaling(enemySystem) {\r\n        if (window.game && window.game.isHordeActive) {\r\n            this.applyHordeModeScaling(enemySystem);\r\n            return;\r\n        }\r\n        \r\n        if (window.game && window.game.difficultyManager && window.game.difficultyManager.params) {\r\n            const diffParams = window.game.difficultyManager.params;\r\n            \r\n            if (diffParams.maxEnemies !== undefined && enemySystem.maxEnemies !== diffParams.maxEnemies) {\r\n                console.log(`Updating max enemies from ${enemySystem.maxEnemies} to ${diffParams.maxEnemies}`);\r\n                enemySystem.maxEnemies = diffParams.maxEnemies;\r\n            }\r\n            \r\n            if (diffParams.spawnInterval !== undefined && enemySystem.spawnInterval !== diffParams.spawnInterval) {\r\n                console.log(`Updating spawn interval from ${enemySystem.spawnInterval} to ${diffParams.spawnInterval}`);\r\n                enemySystem.spawnInterval = diffParams.spawnInterval;\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Apply horde mode scaling based on survival time\r\n     * @param {Object} enemySystem Enemy system instance\r\n     */\r\n    applyHordeModeScaling(enemySystem) {\r\n        if (!window.game || window.game.hordeSurvivalTime === undefined) return;\r\n        \r\n        const survivalTime = window.game.hordeSurvivalTime / 1000;\r\n        \r\n        if (Math.floor(survivalTime) % 10 === 0 && Math.floor(survivalTime) !== this.lastLoggedHordeTime) {\r\n            this.lastLoggedHordeTime = Math.floor(survivalTime);\r\n            console.log(`HORDE MODE: Scaling at ${survivalTime.toFixed(1)}s survival time`);\r\n        }\r\n        \r\n        const minutesPassed = survivalTime / 60;\r\n        \r\n        // Max enemies scaling\r\n        const baseMaxEnemies = 50;\r\n        let maxEnemiesScale;\r\n        \r\n        if (minutesPassed < 5) {\r\n            maxEnemiesScale = baseMaxEnemies + (minutesPassed * 10);\r\n        } else {\r\n            maxEnemiesScale = (baseMaxEnemies + 50) * Math.pow(1.2, minutesPassed - 5);\r\n        }\r\n        \r\n        enemySystem.maxEnemies = Math.min(Math.floor(maxEnemiesScale), 300);\r\n        \r\n        // Spawn interval scaling\r\n        const maxSpawnInterval = 6.0;\r\n        const baseSpawnInterval = 1.0;\r\n        enemySystem.spawnInterval = Math.min(\r\n            baseSpawnInterval * Math.pow(1.05, minutesPassed * 2),\r\n            maxSpawnInterval\r\n        );\r\n        \r\n        // Update enemy config in spawner\r\n        if (enemySystem.spawner) {\r\n            const baseHealth = 20;\r\n            const baseDamage = 15;\r\n            const baseSpeed = 700;\r\n            \r\n            const healthMultiplier = 1 + (minutesPassed * 0.5);\r\n            const damageMultiplier = 1 + (minutesPassed * 0.3);\r\n            const speedMultiplier = 1 + (minutesPassed * 0.2);\r\n            \r\n            enemySystem.spawner.enemyConfig.health = Math.floor(baseHealth * healthMultiplier);\r\n            enemySystem.spawner.enemyConfig.damage = Math.floor(baseDamage * damageMultiplier);\r\n            enemySystem.spawner.enemyConfig.speed = baseSpeed * speedMultiplier;\r\n            \r\n            if (Math.floor(survivalTime) % 30 === 0 && Math.floor(survivalTime) !== this.lastFullLoggedHordeTime) {\r\n                this.lastFullLoggedHordeTime = Math.floor(survivalTime);\r\n                console.log(`HORDE MODE SCALING at ${Math.floor(survivalTime)}s:`);\r\n                console.log(`  Max Enemies: ${enemySystem.maxEnemies}`);\r\n                console.log(`  Spawn Interval: ${enemySystem.spawnInterval.toFixed(2)}s`);\r\n                console.log(`  Enemy Health: ${enemySystem.spawner.enemyConfig.health}`);\r\n                console.log(`  Enemy Damage: ${enemySystem.spawner.enemyConfig.damage}`);\r\n                console.log(`  Enemy Speed: ${enemySystem.spawner.enemyConfig.speed.toFixed(1)}`);\r\n            }\r\n        }\r\n    }\r\n}","/**\r\n * Docking Manager - Handles player docking state and enemy freezing\r\n */\r\n\r\nexport class DockingManager {\r\n    constructor() {\r\n        this.playerIsDocked = false;\r\n    }\r\n\r\n    /**\r\n     * Set up event listeners for player docking/undocking events\r\n     * @param {World} world Game world instance\r\n     * @param {Function} onDocked Callback for when player docks\r\n     * @param {Function} onUndocked Callback for when player undocks\r\n     */\r\n    setupEventListeners(world, onDocked, onUndocked) {\r\n        world.messageBus.subscribe('player.docked', (message) => {\r\n            this.handlePlayerDocked(message, onDocked);\r\n        });\r\n        \r\n        world.messageBus.subscribe('player.undocked', (message) => {\r\n            this.handlePlayerUndocked(message, onUndocked);\r\n        });\r\n        \r\n        console.log(\"Enemy system: Event listeners set up for player docking/undocking\");\r\n    }\r\n\r\n    /**\r\n     * Handle player docked event\r\n     * @param {object} message Event message\r\n     * @param {Function} onDocked Callback for when player docks\r\n     */\r\n    handlePlayerDocked(message, onDocked) {\r\n        console.log(\"Enemy system detected player docked - freezing enemies\");\r\n        this.playerIsDocked = true;\r\n        onDocked();\r\n    }\r\n\r\n    /**\r\n     * Handle player undocked event\r\n     * @param {object} message Event message\r\n     * @param {Function} onUndocked Callback for when player undocks\r\n     */\r\n    handlePlayerUndocked(message, onUndocked) {\r\n        console.log(\"Enemy system detected player undocked - resuming enemy activities\");\r\n        this.playerIsDocked = false;\r\n        onUndocked();\r\n    }\r\n\r\n    /**\r\n     * Check and sync global docking state\r\n     * @param {Function} onDocked Callback for when player docks\r\n     * @param {Function} onUndocked Callback for when player undocks\r\n     */\r\n    syncGlobalDockingState(onDocked, onUndocked) {\r\n        if (window.game && window.game.spaceship && window.game.spaceship.isDocked !== undefined) {\r\n            if (this.playerIsDocked !== window.game.spaceship.isDocked) {\r\n                console.log(`Enemy system syncing docked state from global: ${window.game.spaceship.isDocked}`);\r\n                this.playerIsDocked = window.game.spaceship.isDocked;\r\n                \r\n                if (this.playerIsDocked) {\r\n                    onDocked();\r\n                } else {\r\n                    onUndocked();\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Check if player is currently docked\r\n     * @returns {boolean} True if player is docked\r\n     */\r\n    isPlayerDocked() {\r\n        return this.playerIsDocked;\r\n    }\r\n}","/**\r\n * Spawn Monitoring - Monitors spawn system health and performs recovery\r\n */\r\n\r\nexport class SpawnMonitoring {\r\n    constructor() {\r\n        this.spawnMonitorInterval = null;\r\n        this.lastSpawnTime = Date.now();\r\n    }\r\n\r\n    /**\r\n     * Start monitoring the spawn system health\r\n     * @param {Object} enemySystem Enemy system instance\r\n     */\r\n    startSpawnMonitoring(enemySystem) {\r\n        this.spawnMonitorInterval = setInterval(() => {\r\n            this.checkSpawnSystemHealth(enemySystem);\r\n        }, 10000);\r\n        \r\n        console.log(\"Spawn system monitoring started\");\r\n    }\r\n\r\n    /**\r\n     * Stop spawn monitoring\r\n     */\r\n    stopSpawnMonitoring() {\r\n        if (this.spawnMonitorInterval) {\r\n            clearInterval(this.spawnMonitorInterval);\r\n            this.spawnMonitorInterval = null;\r\n            console.log(\"Spawn monitoring stopped\");\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Check the health of the spawn system\r\n     * @param {Object} enemySystem Enemy system instance\r\n     */\r\n    checkSpawnSystemHealth(enemySystem) {\r\n        const now = Date.now();\r\n        const timeSinceLastSpawn = (now - this.lastSpawnTime) / 1000;\r\n        \r\n        console.log(`Spawn system health check: ${enemySystem.enemies.size}/${enemySystem.maxEnemies} enemies, ${timeSinceLastSpawn.toFixed(1)}s since last spawn`);\r\n        \r\n        if (timeSinceLastSpawn > enemySystem.spawnInterval * 3 && enemySystem.enemies.size < enemySystem.maxEnemies) {\r\n            console.warn(\"Spawn system appears stuck! Performing recovery...\");\r\n            \r\n            enemySystem.enemies.clear();\r\n            enemySystem.spawner.generateSpawnPoints();\r\n            enemySystem.spawnTimer = enemySystem.spawnInterval;\r\n            enemySystem.lifecycle.validateEnemyReferences(enemySystem.enemies);\r\n            \r\n            console.log(\"Spawn system recovery completed\");\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Update last spawn time\r\n     */\r\n    updateLastSpawnTime() {\r\n        this.lastSpawnTime = Date.now();\r\n    }\r\n\r\n    /**\r\n     * Perform failsafe checks and recovery\r\n     * @param {Object} enemySystem Enemy system instance\r\n     */\r\n    performFailsafeCheck(enemySystem) {\r\n        if (enemySystem.enemies.size === 0 && enemySystem.spawnTimer > enemySystem.spawnInterval * 2) {\r\n            console.warn(\"FAILSAFE: No enemies detected for extended period. Resetting spawn system.\");\r\n            enemySystem.enemies.clear();\r\n            enemySystem.spawner.generateSpawnPoints();\r\n            enemySystem.spawnTimer = enemySystem.spawnInterval;\r\n        }\r\n    }\r\n}","/**\r\n * EnemySystem - Manages enemy entities and their AI behavior\r\n * \r\n * Handles enemy spawning, AI updates, and combat interactions.\r\n * This is a simplified version that only implements spectral drones.\r\n */\r\n\r\nimport * as THREE from 'three';\r\nimport { System } from '../../core/system.js';\r\nimport { TrailComponent } from '../../components/rendering/trail.js';\r\nimport { MeshComponent } from '../../components/rendering/mesh.js';\r\n\r\n// Import the existing modularized components\r\nimport { EnemyPoolManager } from './enemyPoolManager.js';\r\nimport { EnemySpawner } from './enemySpawner.js';\r\nimport { EnemyLifecycle } from './enemyLifecycle.js';\r\n\r\n// Import the new extracted modules\r\nimport { SeparationBehavior } from './enemy/behaviors/separationBehavior.js';\r\nimport { DifficultyScaling } from './enemy/state/difficultyScaling.js';\r\nimport { DockingManager } from './enemy/state/dockingManager.js';\r\nimport { SpawnMonitoring } from './enemy/updates/spawnMonitoring.js';\r\n// InitialSpawning removed - delay is now handled by SpawnScheduler\r\n\r\nexport class EnemySystem extends System {\r\n    constructor(world) {\r\n        super(world);\r\n        this.requiredComponents = ['EnemyAIComponent', 'TransformComponent'];\r\n        this.priority = 40; // Run before combat but after input and physics\r\n        \r\n        // Initialize enemies set\r\n        this.enemies = new Set();\r\n        \r\n        // Default enemy spawn parameters (will be modified by difficulty scaling)\r\n        this.maxEnemies = 10;           // Allow more enemies to spawn\r\n        this.spawnTimer = 0;           // Timer since last spawn\r\n        this.spawnInterval = 3;        // Seconds between spawns (reduced from 10)\r\n        this.lastSpawnTime = Date.now(); // Track the last successful spawn time\r\n        \r\n        // Initial spawn delay is now handled by the SpawnScheduler (60 seconds)\r\n        // This ensures consistent timing across the enemy spawning system\r\n        \r\n        // Initialize the managers for different aspects of enemy handling\r\n        this.poolManager = new EnemyPoolManager(world);\r\n        this.spawner = new EnemySpawner(world);\r\n        this.lifecycle = new EnemyLifecycle(world);\r\n        \r\n        // Initialize extracted modules\r\n        this.separationBehavior = new SeparationBehavior();\r\n        this.difficultyScaling = new DifficultyScaling();\r\n        this.dockingManager = new DockingManager();\r\n        this.spawnMonitoring = new SpawnMonitoring();\r\n        // InitialSpawning removed - delay now handled by SpawnScheduler\r\n        \r\n        // Destroyed enemies counter\r\n        this.enemiesDestroyed = 0;\r\n        \r\n        // Set up event listeners through docking manager\r\n        this.setupEventListeners();\r\n        \r\n        // Initialize with a clean enemy count\r\n        this.lifecycle.clearAllEnemies(this.enemies);\r\n        \r\n        // Force validation to ensure we start with empty tracking\r\n        this.lifecycle.validateEnemyReferences(this.enemies);\r\n        \r\n        // Start continuous monitoring for spawn health\r\n        this.spawnMonitoring.startSpawnMonitoring(this);\r\n        \r\n        \r\n        // Make skip delay function globally available for testing\r\n        if (typeof window !== 'undefined') {\r\n            window.skipEnemyDelay = () => {\r\n                this.spawner.skipInitialDelay();\r\n            };\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Set up event listeners for enemy-related events\r\n     */\r\n    setupEventListeners() {\r\n        // Listen for entity.destroyed events to track destroyed enemies\r\n        this.world.messageBus.subscribe('entity.destroyed', this.handleEntityDestroyed.bind(this));\r\n        \r\n        // Set up docking event listeners through docking manager\r\n        this.dockingManager.setupEventListeners(\r\n            this.world,\r\n            () => this.lifecycle.freezeAllEnemies(this.enemies),\r\n            () => this.lifecycle.unfreezeAllEnemies(this.enemies)\r\n        );\r\n    }\r\n    \r\n    \r\n    /**\r\n     * Update all enemy entities\r\n     * @param {number} deltaTime Time since last update in seconds\r\n     */\r\n    update(deltaTime) {\r\n        \r\n        // Sync docking state and skip processing if docked\r\n        this.dockingManager.syncGlobalDockingState(\r\n            () => this.lifecycle.freezeAllEnemies(this.enemies),\r\n            () => this.lifecycle.unfreezeAllEnemies(this.enemies)\r\n        );\r\n        \r\n        if (this.dockingManager.isPlayerDocked()) {\r\n            return;\r\n        }\r\n        \r\n        // Check intro sequence state\r\n        const introActive = window.game && window.game.introSequenceActive;\r\n        if (introActive) {\r\n            return;\r\n        }\r\n        \r\n        // Process all enemy entities\r\n        super.update(deltaTime);\r\n        \r\n        // Run diagnostics more frequently (every 3 seconds instead of 10)\r\n        if (!this._lastDiagnosticTime) {\r\n            this._lastDiagnosticTime = 0;\r\n        }\r\n        this._lastDiagnosticTime += deltaTime;\r\n        \r\n        if (this._lastDiagnosticTime >= 3) {\r\n            this.poolManager.runPoolDiagnostics(this.enemies);\r\n            this._lastDiagnosticTime = 0;\r\n        }\r\n        \r\n        // Validate enemy references before spawn decision to ensure accurate count\r\n        this.lifecycle.validateEnemyReferences(this.enemies);\r\n        \r\n        // Apply difficulty scaling from game object if available\r\n        this.difficultyScaling.updateDifficultyScaling(this);\r\n        \r\n        // STRICT ENFORCEMENT: If we're over the limit, force destroy excess enemies\r\n        if (this.enemies.size > this.maxEnemies) {\r\n            this.lifecycle.enforceEnemyLimit(this.enemies, this.maxEnemies, \r\n                (entity) => this.poolManager.returnEnemyToPool(entity, this.enemies));\r\n        }\r\n        \r\n        // Initial spawn delay is now handled by the SpawnScheduler in the spawner\r\n        // This ensures consistent 60-second delay across the system\r\n        \r\n        // Debug logging - show current enemy count and spawn timer (disabled to reduce console spam)\r\n        // if (this.spawnTimer > this.spawnInterval * 0.9 || this.enemies.size === 0) {\r\n        // }\r\n        \r\n        // Update spawn timer and try to spawn new enemies\r\n        const spawnResult = this.spawner.update(deltaTime, this.enemies, this.maxEnemies, (spawnPoint) => {\r\n            return this.spawnSpectralDrone(spawnPoint);\r\n        });\r\n        \r\n        if (spawnResult) {\r\n        }\r\n        \r\n        // FAILSAFE: Check for spawn system problems\r\n        this.spawnMonitoring.performFailsafeCheck(this);\r\n    }\r\n    \r\n    \r\n    /**\r\n     * Process a single enemy entity\r\n     * @param {Entity} entity Entity to process\r\n     * @param {number} deltaTime Time since last update in seconds\r\n     */\r\n    processEntity(entity, deltaTime) {\r\n        // Call the existing lifecycle processing\r\n        this.lifecycle.processEntityUpdate(entity, deltaTime);\r\n        \r\n        // Apply separation behavior to avoid overlapping with other enemies\r\n        this.separationBehavior.applySeparationBehavior(entity, deltaTime, this.enemies, this.world);\r\n    }\r\n    \r\n    \r\n    /**\r\n     * Handle entity destroyed event\r\n     * @param {object} message Event message\r\n     */\r\n    handleEntityDestroyed(message) {\r\n        // Check if the destroyed entity is one of our enemies\r\n        const entity = message.entity;\r\n        if (!entity) {\r\n            return;\r\n        }\r\n        \r\n        // IMPROVED CHECK: Retrieve entity ID first to ensure consistent reference\r\n        const entityId = entity.id;\r\n        \r\n        // VERIFICATION: Check if this is an entity we're tracking\r\n        const isTrackedEnemy = this.enemies.has(entityId);\r\n        \r\n        // IMPROVED CHECK: Look for either entity.hasTag('enemy') OR entity.id in this.enemies\r\n        // This ensures we catch all cases where an enemy is destroyed\r\n        if ((entity.hasTag && entity.hasTag('enemy')) || isTrackedEnemy) {\r\n            \r\n            // FIRST: Remove from tracking immediately to prevent double-processing\r\n            if (isTrackedEnemy) {\r\n                this.enemies.delete(entityId);\r\n            }\r\n            \r\n            // TRAIL CLEANUP: Ensure any trails are properly removed\r\n            // This prevents the \"line to center\" visual bug\r\n            const trailComponent = entity.getComponent(TrailComponent);\r\n            if (trailComponent) {\r\n                try {\r\n                    // Call onDetached to clean up resources\r\n                    if (typeof trailComponent.onDetached === 'function') {\r\n                        trailComponent.onDetached();\r\n                    }\r\n                    \r\n                    // Unregister from trail system if available\r\n                    if (window.game && window.game.trailSystem) {\r\n                        window.game.trailSystem.unregisterTrail && \r\n                        window.game.trailSystem.unregisterTrail(entityId);\r\n                    }\r\n                    \r\n                    // If the trail has a mesh, remove it from the scene\r\n                    if (trailComponent.trailMesh && trailComponent.trailMesh.parent) {\r\n                        trailComponent.trailMesh.parent.remove(trailComponent.trailMesh);\r\n                    }\r\n                    \r\n                    // Dispose of geometry and material\r\n                    if (trailComponent.trailMesh) {\r\n                        if (trailComponent.trailMesh.geometry) {\r\n                            trailComponent.trailMesh.geometry.dispose();\r\n                        }\r\n                        if (trailComponent.trailMesh.material) {\r\n                            trailComponent.trailMesh.material.dispose();\r\n                        }\r\n                    }\r\n                    \r\n                    // Remove the component from the entity\r\n                    entity.removeComponent('TrailComponent');\r\n                } catch (error) {\r\n                }\r\n            }\r\n            \r\n            // Clean up mesh resources before returning to pool\r\n            const meshComponent = entity.getComponent(MeshComponent);\r\n            if (meshComponent && meshComponent.mesh) {\r\n                try {\r\n                    // Remove from scene if it has a parent\r\n                    if (meshComponent.mesh.parent) {\r\n                        meshComponent.mesh.parent.remove(meshComponent.mesh);\r\n                    }\r\n                } catch (error) {\r\n                }\r\n            }\r\n            \r\n            // Increment destroyed counter\r\n            this.enemiesDestroyed++;\r\n            \r\n            // Log remaining enemies\r\n            \r\n            // ENSURE PROPER CLEANUP: Make sure entity doesn't have enemy tag\r\n            if (entity.hasTag && entity.hasTag('enemy')) {\r\n                entity.removeTag('enemy');\r\n            }\r\n            \r\n            // Check if this entity is incorrectly in the pool already\r\n            let isInPool = false;\r\n            for (let i = 0; i < this.poolManager.enemyPool.length; i++) {\r\n                if (this.poolManager.enemyPool[i] && this.poolManager.enemyPool[i].id === entityId) {\r\n                    this.poolManager.enemyPool.splice(i, 1);\r\n                    isInPool = true;\r\n                    break;\r\n                }\r\n            }\r\n            \r\n            // Only return to pool if not already there\r\n            if (!isInPool) {\r\n                // Return the entity to the pool\r\n                this.poolManager.returnEnemyToPool(entity, this.enemies);\r\n            }\r\n            \r\n            // Force spawn point regeneration after several enemies have been destroyed\r\n            if (this.enemiesDestroyed % 5 === 0) {\r\n                this.spawner.generateSpawnPoints();\r\n            }\r\n            \r\n            // CRITICAL: If this was the last enemy, make sure to reset the spawn timer\r\n            // to avoid long waits for the next enemy\r\n            if (this.enemies.size === 0) {\r\n                // Set the timer to be almost at the spawn interval\r\n                this.spawnTimer = Math.max(this.spawnTimer, this.spawnInterval * 0.8);\r\n                // Update spawn monitoring\r\n                this.spawnMonitoring.updateLastSpawnTime();\r\n            }\r\n            \r\n            // Force validation to catch any remaining inconsistencies\r\n            this.lifecycle.validateEnemyReferences(this.enemies);\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Called when the system is disabled\r\n     */\r\n    onDisabled() {\r\n        // Stop spawn monitoring\r\n        this.spawnMonitoring.stopSpawnMonitoring();\r\n        \r\n        // Clean up any tracked enemies\r\n        this.enemies.clear();\r\n        \r\n    }\r\n    \r\n    \r\n    /**\r\n     * Spawns a spectral drone at the given position - convenience method\r\n     * @param {THREE.Vector3} position The position to spawn at\r\n     * @returns {Entity} The created entity\r\n     */\r\n    spawnSpectralDrone(position) {\r\n        return this.spawner.spawnSpectralDrone(position, this.poolManager, this.enemies, this.maxEnemies);\r\n    }\r\n    \r\n    /**\r\n     * Freeze all enemy entities in place - wrapper for lifecycle method\r\n     */\r\n    freezeAllEnemies() {\r\n        this.lifecycle.freezeAllEnemies(this.enemies);\r\n    }\r\n    \r\n    /**\r\n     * Unfreeze all enemy entities and re-enable their AI - wrapper for lifecycle method\r\n     */\r\n    unfreezeAllEnemies() {\r\n        this.lifecycle.unfreezeAllEnemies(this.enemies);\r\n    }\r\n}","/**\r\n * RenderSystem - Manages visual representation of entities\r\n * \r\n * Syncs entity transforms with Three.js meshes and handles rendering.\r\n */\r\n\r\nimport * as THREE from 'three';\r\nimport { System } from '../../core/system.js';\r\n\r\nexport class RenderSystem extends System {\r\n    constructor(world, scene, camera, renderer) {\r\n        super(world);\r\n        this.requiredComponents = ['TransformComponent', 'MeshComponent'];\r\n        this.priority = 100; // Run at the end of the update cycle\r\n        \r\n        // Three.js references\r\n        this.scene = scene;\r\n        this.camera = camera;\r\n        // Don't store renderer reference to avoid issues\r\n        this.renderer = null;\r\n        \r\n        // Track meshes for frustum culling\r\n        this.meshEntities = new Map();\r\n        \r\n        // Frustum for view culling\r\n        this.frustum = new THREE.Frustum();\r\n        this.projScreenMatrix = new THREE.Matrix4();\r\n        \r\n        // Listen for entity events\r\n        this.world.messageBus.subscribe('entity.created', this.onEntityCreated.bind(this));\r\n        this.world.messageBus.subscribe('entity.destroyed', this.onEntityDestroyed.bind(this));\r\n        \r\n        // Also listen for component.added events directly to catch component additions\r\n        this.world.messageBus.subscribe('component.added', this.onComponentAdded.bind(this));\r\n        \r\n        console.log(\"RenderSystem initialized - handling mesh updates only, no rendering\");\r\n    }\r\n    \r\n    /**\r\n     * Handle component added event\r\n     * @param {object} message Event message\r\n     */\r\n    onComponentAdded(message) {\r\n        const entity = message.data.entity;\r\n        const componentType = message.data.componentType;\r\n        \r\n        // Only interested if one of our required components was added\r\n        if (componentType !== 'MeshComponent' && componentType !== 'TransformComponent') {\r\n            return;\r\n        }\r\n        \r\n        // Check if we're already tracking this entity\r\n        if (this.meshEntities.has(entity.id)) {\r\n            return;\r\n        }\r\n        \r\n        console.log(`RenderSystem: Component ${componentType} added to entity ${entity.id}`);\r\n        \r\n        // Check if entity now has all required components\r\n        if (entity.getComponent('TransformComponent') && entity.getComponent('MeshComponent')) {\r\n            console.log(`Entity ${entity.id} now has all required components, adding to scene`);\r\n            this.addEntityToScene(entity);\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Initialize the rendering system\r\n     */\r\n    initialize() {\r\n        // Verify the system has scene and camera references\r\n        if (!this.scene || !this.camera) {\r\n            console.error('RenderSystem missing required Three.js scene or camera references');\r\n            return;\r\n        }\r\n        \r\n        // Process any entities that already exist\r\n        const entities = this.world.getEntitiesWithComponents(['TransformComponent', 'MeshComponent']);\r\n        entities.forEach(entity => {\r\n            this.addEntityToScene(entity);\r\n        });\r\n    }\r\n    \r\n    /**\r\n     * Handle entity created event\r\n     * @param {object} message Event message\r\n     */\r\n    onEntityCreated(message) {\r\n        const entity = message.data.entity;\r\n        \r\n        // Log entity creation for debugging\r\n        console.log(`RenderSystem received entity.created event for entity ${entity.id}`);\r\n        \r\n        // List all components for debugging\r\n        console.log(`Entity ${entity.id} components:`, Array.from(entity.components.keys()).join(', '));\r\n        \r\n        // Check if entity has required components using getComponent for better debugging\r\n        const transform = entity.getComponent('TransformComponent');\r\n        const mesh = entity.getComponent('MeshComponent');\r\n        \r\n        if (transform && mesh) {\r\n            console.log(`Entity ${entity.id} has required components, adding to scene`);\r\n            this.addEntityToScene(entity);\r\n        } else {\r\n            // Check if the entity might get components later\r\n            console.log(`Entity ${entity.id} missing required components (has transform: ${!!transform}, has mesh: ${!!mesh}), will check later`);\r\n            \r\n            // Set up a one-time component added listener\r\n            const checkComponentsAdded = (msg) => {\r\n                // Only process if it's about our entity\r\n                if (msg.data.entity?.id !== entity.id) return;\r\n                \r\n                // Log the added component\r\n                console.log(`Entity ${entity.id} got component ${msg.data.componentType}`);\r\n                \r\n                // Check if now it has the required components\r\n                const transform = entity.getComponent('TransformComponent');\r\n                const mesh = entity.getComponent('MeshComponent');\r\n                \r\n                if (transform && mesh) {\r\n                    console.log(`Entity ${entity.id} now has required components, adding to scene`);\r\n                    this.addEntityToScene(entity);\r\n                    \r\n                    // Remove this listener after processing\r\n                    this.world.messageBus.unsubscribe('component.added', checkComponentsAdded);\r\n                }\r\n            };\r\n            \r\n            // Subscribe to component added events\r\n            this.world.messageBus.subscribe('component.added', checkComponentsAdded);\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Handle entity destroyed event\r\n     * @param {object} message Event message\r\n     */\r\n    onEntityDestroyed(message) {\r\n        const entity = message.data.entity;\r\n        \r\n        // Check if we're tracking this entity\r\n        if (this.meshEntities.has(entity.id)) {\r\n            this.removeEntityFromScene(entity);\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Add entity mesh to scene\r\n     * @param {Entity} entity Entity to add\r\n     */\r\n    addEntityToScene(entity) {\r\n        const meshComponent = entity.getComponent('MeshComponent');\r\n        \r\n        // Debug output all component keys\r\n        console.log(`Entity ${entity.id} components for scene addition:`, Array.from(entity.components.keys()).join(', '));\r\n        \r\n        // Skip if mesh component is missing\r\n        if (!meshComponent || !meshComponent.mesh) {\r\n            console.warn(`Entity ${entity.id} has no valid mesh to add to scene`);\r\n            \r\n            // Debug output if we have a meshComponent but no mesh\r\n            if (meshComponent && !meshComponent.mesh) {\r\n                console.warn(`Entity ${entity.id} has MeshComponent but mesh property is ${meshComponent.mesh}`);\r\n            }\r\n            return;\r\n        }\r\n        \r\n        // Handle bounding sphere carefully - THREE.Group objects don't have geometry\r\n        if (meshComponent.mesh.geometry) {\r\n            // Only compute if it's a mesh with geometry and not a Group\r\n            if (!meshComponent.mesh.geometry.boundingSphere && typeof meshComponent.mesh.geometry.computeBoundingSphere === 'function') {\r\n                meshComponent.mesh.geometry.computeBoundingSphere();\r\n            }\r\n        } else if (meshComponent.mesh.isGroup) {\r\n            // It's a Group object (no direct geometry property)\r\n            console.log(`Entity ${entity.id} uses a THREE.Group - skipping bounding sphere computation`);\r\n        }\r\n        \r\n        // Ensure we have access to the scene\r\n        if (!this.scene) {\r\n            console.error(`Cannot add entity ${entity.id} mesh to scene - scene reference is missing`);\r\n            return;\r\n        }\r\n        \r\n        // Add mesh to scene directly (don't check for parent)\r\n        this.scene.add(meshComponent.mesh);\r\n        \r\n        // Make sure mesh is visible\r\n        meshComponent.mesh.visible = true;\r\n        \r\n        // Apply entity transform to mesh\r\n        const transform = entity.getComponent('TransformComponent');\r\n        if (transform) {\r\n            meshComponent.mesh.position.copy(transform.position);\r\n            meshComponent.mesh.quaternion.copy(transform.quaternion);\r\n            meshComponent.mesh.scale.copy(transform.scale);\r\n        }\r\n        \r\n        // Log debug info about entity being added\r\n        console.log(`Added entity ${entity.id} mesh to scene - position: ${meshComponent.mesh.position.x.toFixed(0)},${meshComponent.mesh.position.y.toFixed(0)},${meshComponent.mesh.position.z.toFixed(0)}`);\r\n        \r\n        // Track this entity for updates\r\n        this.meshEntities.set(entity.id, entity);\r\n    }\r\n    \r\n    /**\r\n     * Remove entity mesh from scene\r\n     * @param {Entity} entity Entity to remove\r\n     */\r\n    removeEntityFromScene(entity) {\r\n        const meshComponent = entity.getComponent('MeshComponent');\r\n        \r\n        // Remove mesh from scene\r\n        if (meshComponent.mesh && meshComponent.mesh.parent) {\r\n            this.scene.remove(meshComponent.mesh);\r\n        }\r\n        \r\n        // Stop tracking this entity\r\n        this.meshEntities.delete(entity.id);\r\n    }\r\n    \r\n    /**\r\n     * Update camera frustum for culling\r\n     */\r\n    updateFrustum() {\r\n        if (!this.camera) return;\r\n        \r\n        try {\r\n            // Check if camera matrices are valid\r\n            if (!this.camera.projectionMatrix || !this.camera.matrixWorldInverse) {\r\n                console.warn('Camera matrices not initialized');\r\n                return;\r\n            }\r\n            \r\n            // Create fresh matrices to avoid reference issues\r\n            this.projScreenMatrix = new THREE.Matrix4();\r\n            \r\n            // Multiply matrices to create projection\r\n            this.projScreenMatrix.multiplyMatrices(\r\n                this.camera.projectionMatrix,\r\n                this.camera.matrixWorldInverse\r\n            );\r\n            \r\n            // Set frustum from projection matrix\r\n            this.frustum = new THREE.Frustum();\r\n            this.frustum.setFromProjectionMatrix(this.projScreenMatrix);\r\n        } catch (error) {\r\n            console.error('Error updating frustum:', error);\r\n            // If we can't update the frustum, we'll disable culling by setting DEBUG_MODE\r\n            window.DEBUG_MODE = true;\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Check if a position is visible in the camera frustum\r\n     * @param {THREE.Vector3} position Position to check\r\n     * @param {number} radius Bounding sphere radius\r\n     * @returns {boolean} True if visible\r\n     */\r\n    isVisible(position, radius) {\r\n        // Use a much larger radius for distant objects\r\n        const visibilityRadius = Math.max(radius, 1000); // Ensure large distant objects remain visible\r\n        \r\n        // During development, or for this fix, ALWAYS assume everything is visible to aid debugging\r\n        // Force to true to bypass the culling system entirely\r\n        window.DEBUG_MODE = true;\r\n        return true;\r\n        \r\n        // Safely check if position is valid before creating a sphere\r\n        if (!position || typeof position.x !== 'number') {\r\n            console.warn('Invalid position for visibility check:', position);\r\n            return true; // Default to visible if position is invalid\r\n        }\r\n        \r\n        // First try just using containsPoint which is simpler\r\n        if (this.frustum.containsPoint(position)) {\r\n            return true;\r\n        }\r\n        \r\n        // Create sphere for intersection test - with error handling\r\n        try {\r\n            const sphere = new THREE.Sphere(position.clone(), visibilityRadius);\r\n            return this.frustum.intersectsSphere(sphere);\r\n        } catch (error) {\r\n            console.warn('Error in frustum intersection test:', error);\r\n            return true; // Default to visible on error\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Update all mesh transforms from entity transforms\r\n     * @param {number} deltaTime Time since last update in seconds\r\n     */\r\n    update(deltaTime) {\r\n        // Update camera frustum for culling\r\n        this.updateFrustum();\r\n        \r\n        // Try to scan for entities that should be tracked but aren't\r\n        if (window.DEBUG_MODE && this.world.time % 5 < deltaTime) {\r\n            this.scanForMissingEntities();\r\n        }\r\n        \r\n        // Update all registered meshes\r\n        for (const entity of this.meshEntities.values()) {\r\n            const transform = entity.getComponent('TransformComponent');\r\n            const meshComponent = entity.getComponent('MeshComponent');\r\n            \r\n            // Skip if either component is missing\r\n            if (!transform || !meshComponent || !meshComponent.mesh) continue;\r\n            \r\n            // Check if mesh is in the scene, if not add it\r\n            if (!meshComponent.mesh.parent && this.scene) {\r\n                console.log(`RenderSystem: Adding missing mesh for entity ${entity.id} to scene`);\r\n                this.scene.add(meshComponent.mesh);\r\n            }\r\n            \r\n            // Update mesh from transform\r\n            meshComponent.mesh.position.copy(transform.position);\r\n            meshComponent.mesh.quaternion.copy(transform.quaternion);\r\n            meshComponent.mesh.scale.copy(transform.scale);\r\n            \r\n            // Mark transform as updated\r\n            transform.needsUpdate = false;\r\n            \r\n            // Force visibility in debug mode\r\n            if (window.DEBUG_MODE) {\r\n                meshComponent.mesh.visible = true;\r\n                continue;\r\n            }\r\n            \r\n            // Update visibility based on frustum culling\r\n            if (meshComponent.visible) {\r\n                // Use a large default radius for better visibility\r\n                // Handle both mesh geometry and group objects\r\n                let radius = 500; // Default large radius\r\n                \r\n                // Safely check for boundingSphere - handle all cases\r\n                if (meshComponent.mesh.isGroup) {\r\n                    // For groups, we don't have a direct boundingSphere, so use default\r\n                    radius = 500;\r\n                } else if (meshComponent.mesh.geometry) {\r\n                    // Only try to access boundingSphere if geometry exists\r\n                    if (meshComponent.mesh.geometry.boundingSphere) {\r\n                        radius = meshComponent.mesh.geometry.boundingSphere.radius;\r\n                    } else if (typeof meshComponent.mesh.geometry.computeBoundingSphere === 'function') {\r\n                        // Try to compute if not already done\r\n                        meshComponent.mesh.geometry.computeBoundingSphere();\r\n                        // Now check if it was created successfully\r\n                        if (meshComponent.mesh.geometry.boundingSphere) {\r\n                            radius = meshComponent.mesh.geometry.boundingSphere.radius;\r\n                        }\r\n                    }\r\n                }\r\n                const isInView = this.isVisible(transform.position, radius);\r\n                meshComponent.mesh.visible = isInView;\r\n            } else {\r\n                meshComponent.mesh.visible = false;\r\n            }\r\n        }\r\n        \r\n        // Diagnostics - log mesh counts periodically\r\n        if (window.DEBUG_MODE && this.world.time % 5 < deltaTime) {\r\n            console.log(`RenderSystem: ${this.meshEntities.size} entities being managed`);\r\n        }\r\n        \r\n        // This system only handles mesh transform updates\r\n        // The main game renderer handles the actual rendering\r\n    }\r\n    \r\n    /**\r\n     * Scan for entities that should be tracked but aren't\r\n     */\r\n    scanForMissingEntities() {\r\n        // Get all entities with transform and mesh components\r\n        const entities = this.world.getEntitiesWithComponents(['TransformComponent', 'MeshComponent']);\r\n        \r\n        // Count how many we're not tracking\r\n        let missingCount = 0;\r\n        \r\n        // Add any entities that aren't already being tracked\r\n        entities.forEach(entity => {\r\n            if (!this.meshEntities.has(entity.id)) {\r\n                console.log(`RenderSystem: Found untracked entity ${entity.id} with mesh, adding to scene`);\r\n                this.addEntityToScene(entity);\r\n                missingCount++;\r\n            }\r\n        });\r\n        \r\n        if (missingCount > 0) {\r\n            console.log(`RenderSystem: Added ${missingCount} missing entities to tracking`);\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Clean up resources when system is destroyed\r\n     */\r\n    onDestroyed() {\r\n        // Dispose of THREE.js matrices\r\n        this.projScreenMatrix = null;\r\n        this.frustum = null;\r\n        \r\n        // Clean up all entities\r\n        for (const entity of this.meshEntities.values()) {\r\n            this.removeEntityFromScene(entity);\r\n        }\r\n        \r\n        // Clear entity map\r\n        this.meshEntities.clear();\r\n        \r\n        // Clear scene reference\r\n        this.scene = null;\r\n        this.camera = null;\r\n        this.renderer = null;\r\n        \r\n        // Unsubscribe from all message bus events\r\n        if (this.world && this.world.messageBus) {\r\n            // Unsubscribe from entity events\r\n            this.world.messageBus.unsubscribe('entity.created', this.onEntityCreated.bind(this));\r\n            this.world.messageBus.unsubscribe('entity.destroyed', this.onEntityDestroyed.bind(this));\r\n            this.world.messageBus.unsubscribe('component.added', this.onComponentAdded.bind(this));\r\n        }\r\n    }\r\n}","/**\r\n * CollisionSystem - Handles collision detection and resolution\r\n * \r\n * Manages spatial partitioning and collision responses.\r\n */\r\n\r\nimport * as THREE from 'three';\r\nimport { System } from '../../core/system.js';\r\nimport { FixedArray } from '../../utils/memoryManager.js';\r\n\r\nexport class CollisionSystem extends System {\r\n    constructor(world) {\r\n        super(world);\r\n        this.requiredComponents = ['TransformComponent', 'RigidbodyComponent'];\r\n        this.priority = 20; // Run after movement system\r\n        \r\n        // Spatial partitioning grid\r\n        this.cells = new Map();\r\n        this.cellSize = 2000; // Size of each spatial cell (4x the original 500)\r\n        \r\n        // Collision tracking to prevent duplicates\r\n        this.processedCollisions = new Set();\r\n        \r\n        // Keep track of entities per cell for quick lookup\r\n        this.entityCells = new Map();\r\n        \r\n        // Pre-allocated arrays to avoid garbage collection\r\n        this.potentialColliders = new FixedArray(200); // Pre-allocate for 200 potential colliders\r\n        this.cellsToCheck = new FixedArray(27); // 3^3 neighboring cells\r\n        \r\n        // Reusable vectors for collision calculations\r\n        this.tempVec1 = new THREE.Vector3();\r\n        this.tempVec2 = new THREE.Vector3();\r\n        this.collisionNormal = new THREE.Vector3();\r\n        this.relativeVelocity = new THREE.Vector3();\r\n    }\r\n    \r\n    /**\r\n     * Process all entities for collisions\r\n     * @param {number} deltaTime Time since last update in seconds\r\n     */\r\n    update(deltaTime) {\r\n        // Clear spatial grid and tracking sets\r\n        this.cells.clear();\r\n        this.processedCollisions.clear();\r\n        this.entityCells.clear();\r\n        \r\n        // Get all entities with required components\r\n        const entities = this.getEntities();\r\n        \r\n        // First pass: populate spatial partitioning grid\r\n        for (let i = 0; i < entities.length; i++) {\r\n            this._insertIntoGrid(entities[i]);\r\n        }\r\n        \r\n        // Second pass: check for collisions using spatial partitioning\r\n        for (let i = 0; i < entities.length; i++) {\r\n            this._checkCollisionsOptimized(entities[i], deltaTime);\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Insert entity into spatial partitioning grid\r\n     * @param {Entity} entity Entity to insert\r\n     * @private\r\n     */\r\n    _insertIntoGrid(entity) {\r\n        const transform = entity.getComponent('TransformComponent');\r\n        const rigidbody = entity.getComponent('RigidbodyComponent');\r\n        \r\n        if (!transform || !rigidbody) return;\r\n        \r\n        // Calculate cell coordinates\r\n        const cellX = Math.floor(transform.position.x / this.cellSize);\r\n        const cellY = Math.floor(transform.position.y / this.cellSize);\r\n        const cellZ = Math.floor(transform.position.z / this.cellSize);\r\n        \r\n        // Create cell key\r\n        const cellKey = `${cellX},${cellY},${cellZ}`;\r\n        \r\n        // Add entity to cell\r\n        if (!this.cells.has(cellKey)) {\r\n            this.cells.set(cellKey, []);\r\n        }\r\n        this.cells.get(cellKey).push(entity);\r\n        \r\n        // Track which cells this entity is in\r\n        if (!this.entityCells.has(entity.id)) {\r\n            this.entityCells.set(entity.id, new Set());\r\n        }\r\n        this.entityCells.get(entity.id).add(cellKey);\r\n        \r\n        // For special entities like projectiles, add to neighboring cells too\r\n        const radius = rigidbody.collisionRadius;\r\n        const isProjectile = entity.hasTag('playerProjectile') || entity.hasTag('particleProjectile');\r\n        \r\n        // Fast-moving objects need to be in more cells\r\n        const overlapFactor = isProjectile ? 5 : 1;\r\n        \r\n        // Calculate neighboring cells based on entity size and velocity\r\n        const cellRadius = Math.ceil((radius * overlapFactor) / this.cellSize);\r\n        \r\n        if (isProjectile || cellRadius > 0) {\r\n            // Get velocity for high-speed projectiles\r\n            const velocity = rigidbody.velocity || { length: () => 0 };\r\n            const speedFactor = velocity.length ? Math.min(3, Math.ceil(velocity.length() / 1000)) : 1;\r\n            \r\n            // Add to more cells in the direction of movement for fast projectiles\r\n            for (let dx = -cellRadius; dx <= cellRadius; dx++) {\r\n                for (let dy = -cellRadius; dy <= cellRadius; dy++) {\r\n                    for (let dz = -cellRadius; dz <= cellRadius; dz++) {\r\n                        // Skip the center cell (already added)\r\n                        if (dx === 0 && dy === 0 && dz === 0) continue;\r\n                        \r\n                        // For projectiles, extend further in the direction of movement\r\n                        if (isProjectile && speedFactor > 1) {\r\n                            // Skip cells that are not in the direction of movement\r\n                            const dotProduct = dx * Math.sign(velocity.x || 0) + \r\n                                               dy * Math.sign(velocity.y || 0) + \r\n                                               dz * Math.sign(velocity.z || 0);\r\n                            if (dotProduct < 0) continue;\r\n                        }\r\n                        \r\n                        const neighborKey = `${cellX + dx},${cellY + dy},${cellZ + dz}`;\r\n                        if (!this.cells.has(neighborKey)) {\r\n                            this.cells.set(neighborKey, []);\r\n                        }\r\n                        this.cells.get(neighborKey).push(entity);\r\n                        this.entityCells.get(entity.id).add(neighborKey);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Check for collisions with optimized spatial partitioning\r\n     * @param {Entity} entity Entity to check\r\n     * @param {number} deltaTime Time since last update in seconds\r\n     * @private\r\n     */\r\n    _checkCollisionsOptimized(entity, deltaTime) {\r\n        const transform = entity.getComponent('TransformComponent');\r\n        const rigidbody = entity.getComponent('RigidbodyComponent');\r\n        \r\n        if (!transform || !rigidbody || !this.entityCells.has(entity.id)) {\r\n            return;\r\n        }\r\n        \r\n        // Get all cells this entity is in\r\n        const entityCellKeys = this.entityCells.get(entity.id);\r\n        \r\n        // Reset potential colliders array (reuse to avoid GC)\r\n        this.potentialColliders.clear();\r\n        \r\n        // Collect all potential colliders from all cells this entity is in\r\n        entityCellKeys.forEach(cellKey => {\r\n            const cellEntities = this.cells.get(cellKey);\r\n            if (!cellEntities) return;\r\n            \r\n            // Add all entities from this cell to potential colliders\r\n            for (let i = 0; i < cellEntities.length; i++) {\r\n                const otherEntity = cellEntities[i];\r\n                \r\n                // Skip self\r\n                if (otherEntity === entity) continue;\r\n                \r\n                // Skip if already processed this pair\r\n                const pairId = entity.id < otherEntity.id ? \r\n                    `${entity.id}:${otherEntity.id}` : \r\n                    `${otherEntity.id}:${entity.id}`;\r\n                \r\n                if (this.processedCollisions.has(pairId)) continue;\r\n                \r\n                // Add to potential colliders\r\n                this.potentialColliders.push(otherEntity);\r\n                \r\n                // Mark this pair as processed\r\n                this.processedCollisions.add(pairId);\r\n            }\r\n        });\r\n        \r\n        // Now check collisions with all potential colliders\r\n        for (let i = 0; i < this.potentialColliders.length; i++) {\r\n            const otherEntity = this.potentialColliders.get(i);\r\n            const otherTransform = otherEntity.getComponent('TransformComponent');\r\n            const otherRigidbody = otherEntity.getComponent('RigidbodyComponent');\r\n            \r\n            if (!otherTransform || !otherRigidbody) continue;\r\n            \r\n            // Check for collision\r\n            if (this._checkSphereCollision(\r\n                transform.position, rigidbody.collisionRadius,\r\n                otherTransform.position, otherRigidbody.collisionRadius\r\n            )) {\r\n                // Process the collision\r\n                if (rigidbody.isTrigger || otherRigidbody.isTrigger) {\r\n                    this._handleTrigger(entity, otherEntity);\r\n                } else {\r\n                    this._resolveCollision(\r\n                        entity, otherEntity,\r\n                        transform, rigidbody,\r\n                        otherTransform, otherRigidbody\r\n                    );\r\n                }\r\n            }\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Check for sphere-sphere collision\r\n     * @param {THREE.Vector3} posA Position A\r\n     * @param {number} radiusA Radius A\r\n     * @param {THREE.Vector3} posB Position B\r\n     * @param {number} radiusB Radius B\r\n     * @returns {boolean} True if collision detected\r\n     * @private\r\n     */\r\n    _checkSphereCollision(posA, radiusA, posB, radiusB) {\r\n        // Optimized: Use squared distance for better performance\r\n        const dx = posA.x - posB.x;\r\n        const dy = posA.y - posB.y;\r\n        const dz = posA.z - posB.z;\r\n        const distanceSquared = dx * dx + dy * dy + dz * dz;\r\n        \r\n        // Compare with squared sum of radii (more efficient than using square root)\r\n        const radiusSum = radiusA + radiusB;\r\n        return distanceSquared <= (radiusSum * radiusSum);\r\n    }\r\n    \r\n    /**\r\n     * Handle a trigger collision (no physics response)\r\n     * @param {Entity} entity Entity A\r\n     * @param {Entity} otherEntity Entity B\r\n     * @private\r\n     */\r\n    _handleTrigger(entity, otherEntity) {\r\n        // Identify projectile types and targets\r\n        let playerProjectile = null;\r\n        let enemyProjectile = null;\r\n        let enemyEntity = null;\r\n        let playerEntity = null;\r\n        \r\n        // Check for player projectiles hitting enemies\r\n        const entityIsPlayerProjectile = entity._isPlayerProjectile || \r\n                                         entity.hasTag('playerProjectile') || \r\n                                         entity.hasTag('particleProjectile');\r\n                                   \r\n        const otherIsEnemy = otherEntity._isEnemy || \r\n                            otherEntity.hasTag('enemy') || \r\n                            otherEntity.hasComponent('EnemyComponent') || \r\n                            otherEntity.hasComponent('EnemyAIComponent');\r\n        \r\n        if (entityIsPlayerProjectile && otherIsEnemy) {\r\n            playerProjectile = entity;\r\n            enemyEntity = otherEntity;\r\n        } else {\r\n            const otherIsPlayerProjectile = otherEntity._isPlayerProjectile || \r\n                                           otherEntity.hasTag('playerProjectile') || \r\n                                           otherEntity.hasTag('particleProjectile');\r\n                                     \r\n            const entityIsEnemy = entity._isEnemy || \r\n                                 entity.hasTag('enemy') || \r\n                                 entity.hasComponent('EnemyComponent') || \r\n                                 entity.hasComponent('EnemyAIComponent');\r\n            \r\n            if (otherIsPlayerProjectile && entityIsEnemy) {\r\n                playerProjectile = otherEntity;\r\n                enemyEntity = entity;\r\n            }\r\n        }\r\n        \r\n        // Check for enemy projectiles hitting the player\r\n        const entityIsEnemyProjectile = entity._isEnemyProjectile || \r\n                                        entity.hasTag('enemyProjectile');\r\n                                        \r\n        const otherIsPlayer = otherEntity._isPlayer || \r\n                             otherEntity.hasTag('player');\r\n        \r\n        if (entityIsEnemyProjectile && otherIsPlayer) {\r\n            enemyProjectile = entity;\r\n            playerEntity = otherEntity;\r\n        } else {\r\n            const otherIsEnemyProjectile = otherEntity._isEnemyProjectile || \r\n                                           otherEntity.hasTag('enemyProjectile');\r\n                                           \r\n            const entityIsPlayer = entity._isPlayer || \r\n                                  entity.hasTag('player');\r\n            \r\n            if (otherIsEnemyProjectile && entityIsPlayer) {\r\n                enemyProjectile = otherEntity;\r\n                playerEntity = entity;\r\n            }\r\n        }\r\n        \r\n        // If this is a player projectile hitting an enemy, handle the hit\r\n        if (playerProjectile && enemyEntity) {\r\n            console.log(`DIRECT HIT: Player projectile ${playerProjectile.id} hit enemy ${enemyEntity.id}`);\r\n            \r\n            // Ignore pooled entities\r\n            if (enemyEntity.hasTag('pooled')) {\r\n                console.warn(`Skipping hit on pooled enemy ${enemyEntity.id}`);\r\n                return;\r\n            }\r\n            \r\n            // Log detailed collision info\r\n            const projectileTransform = playerProjectile.getComponent('TransformComponent');\r\n            const enemyTransform = enemyEntity.getComponent('TransformComponent');\r\n            \r\n            if (projectileTransform && enemyTransform) {\r\n                const distance = projectileTransform.position.distanceTo(enemyTransform.position);\r\n                console.log(`Hit details: Distance=${distance.toFixed(1)}, ProjectilePos=${projectileTransform.position.x.toFixed(0)},${projectileTransform.position.y.toFixed(0)},${projectileTransform.position.z.toFixed(0)}, EnemyPos=${enemyTransform.position.x.toFixed(0)},${enemyTransform.position.y.toFixed(0)},${enemyTransform.position.z.toFixed(0)}`);\r\n            }\r\n            \r\n            // Apply damage to enemy\r\n            const health = enemyEntity.getComponent('HealthComponent');\r\n            if (health) {\r\n                // Apply significant damage - guaranteed to kill in one hit\r\n                const damage = 1000; // Massive damage to guarantee instant death\r\n                console.log(`CRITICAL HIT: Applying ${damage} damage to enemy ${enemyEntity.id}`);\r\n                health.applyDamage(damage, 'particle', playerProjectile);\r\n                \r\n                // Double-check if enemy was destroyed \r\n                if (!health.isDestroyed) {\r\n                    console.error(\"ERROR: Enemy not destroyed after particle hit! Sending entity.destroyed event...\");\r\n                    // Instead of forcing destruction, trigger the entity.destroyed event\r\n                    health.isDestroyed = true;\r\n                    health.health = 0;\r\n                    \r\n                    // Force publish destruction event - this will trigger the proper pool handling\r\n                    this.world.messageBus.publish('entity.destroyed', {\r\n                        entity: enemyEntity,\r\n                        source: playerProjectile,\r\n                        damageType: 'particle'\r\n                    });\r\n                } else {\r\n                    console.log(\"ENEMY DESTROYED CONFIRMED! Health reached zero and isDestroyed=true\");\r\n                }\r\n            }\r\n            \r\n            // Get position for effects\r\n            let position = null;\r\n            try {\r\n                position = playerProjectile.getComponent('TransformComponent').position.clone();\r\n            } catch (error) {\r\n                // Fallback to enemy position if needed\r\n                try {\r\n                    position = enemyEntity.getComponent('TransformComponent').position.clone();\r\n                } catch (innerError) {\r\n                    // Use zero as last resort\r\n                    position = new THREE.Vector3(0, 0, 0);\r\n                }\r\n            }\r\n            \r\n            // Publish events for the hit\r\n            this.world.messageBus.publish('collision.trigger', {\r\n                entityA: playerProjectile,\r\n                entityB: enemyEntity,\r\n                projectileHit: true\r\n            });\r\n            \r\n            this.world.messageBus.publish('projectile.hit', {\r\n                projectile: playerProjectile,\r\n                target: enemyEntity,\r\n                position: position\r\n            });\r\n            \r\n            // Destroy the projectile only - the enemy will be handled by its health component\r\n            this.world.destroyEntity(playerProjectile.id);\r\n        } \r\n        // Handle enemy projectile hitting player\r\n        else if (enemyProjectile && playerEntity) {\r\n            console.log(`ENEMY HIT: Enemy projectile ${enemyProjectile.id} hit player ${playerEntity.id}`);\r\n            \r\n            // Apply damage to player\r\n            const health = playerEntity.getComponent('HealthComponent');\r\n            if (health) {\r\n                const damage = 10; // Standard enemy projectile damage\r\n                console.log(`Applying ${damage} damage to player`);\r\n                health.applyDamage(damage, 'enemyProjectile', enemyProjectile);\r\n            }\r\n            \r\n            // Get position for effects\r\n            let position = null;\r\n            try {\r\n                position = enemyProjectile.getComponent('TransformComponent').position.clone();\r\n            } catch (error) {\r\n                try {\r\n                    position = playerEntity.getComponent('TransformComponent').position.clone();\r\n                } catch (innerError) {\r\n                    position = new THREE.Vector3(0, 0, 0);\r\n                }\r\n            }\r\n            \r\n            // Publish events for the hit\r\n            this.world.messageBus.publish('collision.trigger', {\r\n                entityA: enemyProjectile,\r\n                entityB: playerEntity,\r\n                projectileHit: true\r\n            });\r\n            \r\n            this.world.messageBus.publish('projectile.hit', {\r\n                projectile: enemyProjectile,\r\n                target: playerEntity,\r\n                position: position\r\n            });\r\n            \r\n            // Destroy the enemy projectile\r\n            this.world.destroyEntity(enemyProjectile.id);\r\n        } else {\r\n            // Generic trigger event for non-projectile collisions\r\n            this.world.messageBus.publish('collision.trigger', {\r\n                entityA: entity,\r\n                entityB: otherEntity\r\n            });\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Resolve a physical collision with impulse-based physics\r\n     * @private\r\n     */\r\n    _resolveCollision(entityA, entityB, transformA, rigidbodyA, transformB, rigidbodyB) {\r\n        // Use reusable vectors instead of creating new ones\r\n        \r\n        // Calculate collision normal\r\n        this.collisionNormal.copy(transformA.position).sub(transformB.position).normalize();\r\n        \r\n        // Calculate relative velocity\r\n        this.relativeVelocity.copy(rigidbodyA.velocity).sub(rigidbodyB.velocity);\r\n        \r\n        // Calculate relative velocity along the normal\r\n        const velocityAlongNormal = this.relativeVelocity.dot(this.collisionNormal);\r\n        \r\n        // Only resolve if objects are moving toward each other\r\n        if (velocityAlongNormal > 0) return;\r\n        \r\n        // Calculate restitution (bounciness)\r\n        const restitution = 0.3;\r\n        \r\n        // Calculate inverse masses (handle infinite mass objects for immovable objects)\r\n        const invMassA = rigidbodyA.isKinematic ? 0 : 1 / rigidbodyA.mass;\r\n        const invMassB = rigidbodyB.isKinematic ? 0 : 1 / rigidbodyB.mass;\r\n        \r\n        // Calculate impulse scalar\r\n        const impulseScalar = -(1 + restitution) * velocityAlongNormal / (invMassA + invMassB);\r\n        \r\n        // Apply impulse\r\n        // Using our reusable vector and scaling it\r\n        this.tempVec1.copy(this.collisionNormal).multiplyScalar(impulseScalar * invMassA);\r\n        this.tempVec2.copy(this.collisionNormal).multiplyScalar(impulseScalar * invMassB);\r\n        \r\n        rigidbodyA.velocity.sub(this.tempVec1);\r\n        rigidbodyB.velocity.add(this.tempVec2);\r\n        \r\n        // Position correction to prevent sinking\r\n        const percent = 0.2; // penetration percentage to correct\r\n        const slop = 0.01; // penetration allowance\r\n        \r\n        // Calculate penetration depth\r\n        const distanceSquared = transformA.position.distanceToSquared(transformB.position);\r\n        const radiusSum = rigidbodyA.collisionRadius + rigidbodyB.collisionRadius;\r\n        const penetration = radiusSum - Math.sqrt(distanceSquared);\r\n        \r\n        if (penetration > slop) {\r\n            const correction = Math.max(penetration - slop, 0) / (invMassA + invMassB) * percent;\r\n            \r\n            // Apply correction\r\n            this.tempVec1.copy(this.collisionNormal).multiplyScalar(correction * invMassA);\r\n            this.tempVec2.copy(this.collisionNormal).multiplyScalar(correction * invMassB);\r\n            \r\n            transformA.position.sub(this.tempVec1);\r\n            transformB.position.add(this.tempVec2);\r\n        }\r\n    }\r\n}","/**\r\n * VisualEffectsSystem - Manages visual effects like explosions, damage flashes, etc.\r\n * \r\n * This system handles creating and managing visual effects for the game,\r\n * keeping them separate from game logic.\r\n */\r\n\r\nimport * as THREE from 'three';\r\nimport { System } from '../../core/system.js';\r\n\r\nexport class VisualEffectsSystem extends System {\r\n    constructor(world) {\r\n        super(world);\r\n        this.priority = 70; // Lower priority, run after gameplay systems\r\n        \r\n        // Keep track of active effects\r\n        this.activeEffects = new Map();\r\n        \r\n        // Effect counters for unique IDs\r\n        this.effectCounter = 0;\r\n        \r\n        // Setup listeners for effect events\r\n        this.setupEventListeners();\r\n        \r\n        console.log(\"VisualEffectsSystem initialized\");\r\n    }\r\n    \r\n    /**\r\n     * Set up event listeners for visual effect events\r\n     */\r\n    setupEventListeners() {\r\n        // Listen for explosion effect requests\r\n        this.world.messageBus.subscribe('vfx.explosion', this.handleExplosionRequest.bind(this));\r\n        \r\n        // Listen for damage flash effect requests\r\n        this.world.messageBus.subscribe('vfx.damageFlash', this.handleDamageFlashRequest.bind(this));\r\n    }\r\n    \r\n    /**\r\n     * Update all active visual effects\r\n     * @param {number} deltaTime Time since last update in seconds\r\n     */\r\n    update(deltaTime) {\r\n        // Update all active effects and remove completed ones\r\n        for (const [id, effect] of this.activeEffects.entries()) {\r\n            if (!effect.update(deltaTime)) {\r\n                // Effect is complete, remove it\r\n                this.removeEffect(id);\r\n            }\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Handle request to create an explosion effect\r\n     * @param {object} message The explosion request message\r\n     */\r\n    handleExplosionRequest(message) {\r\n        if (!message || !message.data || !message.data.position) {\r\n            console.error(\"Invalid explosion effect request\", message);\r\n            return;\r\n        }\r\n        \r\n        // Extract parameters from message\r\n        const position = message.data.position;\r\n        const scale = message.data.scale || 1.0;\r\n        const duration = message.data.duration || 2.0;\r\n        \r\n        // Create explosion effect\r\n        this.createExplosionEffect(position, scale, duration);\r\n        \r\n        // Play explosion sound (use boink instead of explosion)\r\n        if (window.game && window.game.audio) {\r\n            window.game.audio.playSound('boink');\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Handle request to create a damage flash effect\r\n     * @param {object} message The damage flash request message\r\n     */\r\n    handleDamageFlashRequest(message) {\r\n        // Extract intensity from message if available\r\n        const intensity = message && message.data && message.data.intensity ? \r\n            message.data.intensity : 0.3;\r\n        \r\n        // Create damage flash effect\r\n        this.createDamageFlashEffect(intensity);\r\n    }\r\n    \r\n    /**\r\n     * Create an explosion effect at the specified position\r\n     * @param {THREE.Vector3} position Position for the explosion\r\n     * @param {number} scale Size scale for the explosion (1.0 = normal)\r\n     * @param {number} duration Duration in seconds\r\n     * @returns {number} Effect ID\r\n     */\r\n    createExplosionEffect(position, scale = 1.0, duration = 2.0) {\r\n        // Get access to THREE.js scene\r\n        if (!this.world.scene) {\r\n            console.error(\"No scene available for explosion effect\");\r\n            return -1;\r\n        }\r\n        \r\n        // Create effect container\r\n        const container = new THREE.Group();\r\n        container.position.copy(position);\r\n        container.scale.set(scale, scale, scale);\r\n        \r\n        // Create particles for explosion - use object pool if available\r\n        const particleCount = Math.floor(20 * scale);\r\n        const particles = [];\r\n        \r\n        // Check if pooling system is available\r\n        const usePooling = window.objectPool && \r\n                          window.objectPool.pools && \r\n                          window.objectPool.pools['explosionParticle'];\r\n        \r\n        // Create particles with properties\r\n        for (let i = 0; i < particleCount; i++) {\r\n            let particle;\r\n            const size = Math.random() * 2 + 1;\r\n            \r\n            if (usePooling) {\r\n                // Get particle from pool\r\n                particle = window.objectPool.get('explosionParticle');\r\n                \r\n                if (particle) {\r\n                    // Position randomly within explosion radius\r\n                    const radius = Math.random() * 10;\r\n                    const theta = Math.random() * Math.PI * 2;\r\n                    const phi = Math.random() * Math.PI;\r\n                    \r\n                    const particlePos = new THREE.Vector3(\r\n                        radius * Math.sin(phi) * Math.cos(theta),\r\n                        radius * Math.sin(phi) * Math.sin(theta),\r\n                        radius * Math.cos(phi)\r\n                    );\r\n                    \r\n                    // Reset the particle with position relative to container origin\r\n                    particle.reset(particlePos, size, 0xff5500);\r\n                    \r\n                    // Set velocity for animation\r\n                    particle.velocity.copy(particlePos).normalize().multiplyScalar(\r\n                        Math.random() * 2 + 1\r\n                    );\r\n                    \r\n                    // Add to container\r\n                    container.add(particle.mesh);\r\n                    particles.push(particle);\r\n                }\r\n            } else {\r\n                // Fallback to creating new particles if pool is not available\r\n                // Use precomputed geometry if available, otherwise create new\r\n                const geometry = window.game && window.game.explosionGeometry ? \r\n                                window.game.explosionGeometry : \r\n                                new THREE.SphereGeometry(size, 8, 8);\r\n                \r\n                // Use precomputed material as template if available\r\n                const material = window.game && window.game.explosionMaterial ? \r\n                                window.game.explosionMaterial.clone() : \r\n                                new THREE.MeshBasicMaterial({\r\n                                    color: 0xff5500,\r\n                                    transparent: true,\r\n                                    opacity: 0.8\r\n                                });\r\n                \r\n                const particleMesh = new THREE.Mesh(geometry, material);\r\n                \r\n                // Random position within explosion radius\r\n                const radius = Math.random() * 10;\r\n                const theta = Math.random() * Math.PI * 2;\r\n                const phi = Math.random() * Math.PI;\r\n                \r\n                particleMesh.position.set(\r\n                    radius * Math.sin(phi) * Math.cos(theta),\r\n                    radius * Math.sin(phi) * Math.sin(theta),\r\n                    radius * Math.cos(phi)\r\n                );\r\n                \r\n                // Store velocity in userData\r\n                particleMesh.userData.velocity = particleMesh.position.clone().normalize().multiplyScalar(\r\n                    Math.random() * 2 + 1\r\n                );\r\n                \r\n                // Add to container\r\n                container.add(particleMesh);\r\n                particles.push({\r\n                    mesh: particleMesh,\r\n                    material: material,\r\n                    velocity: particleMesh.userData.velocity\r\n                });\r\n            }\r\n        }\r\n        \r\n        // Add container to scene\r\n        this.world.scene.add(container);\r\n        \r\n        // Create effect object\r\n        const effectId = this.effectCounter++;\r\n        const effect = {\r\n            id: effectId,\r\n            type: 'explosion',\r\n            container: container,\r\n            particles: particles,\r\n            duration: duration,\r\n            elapsed: 0,\r\n            usePooling: usePooling,\r\n            update: (dt) => {\r\n                // Update elapsed time\r\n                effect.elapsed += dt;\r\n                \r\n                // Check if effect is complete\r\n                if (effect.elapsed >= effect.duration) {\r\n                    // Clean up explosion particles\r\n                    if (effect.usePooling) {\r\n                        // Return particles to pool\r\n                        effect.particles.forEach(particle => {\r\n                            window.objectPool.release('explosionParticle', particle);\r\n                        });\r\n                    }\r\n                    // Remove container from scene\r\n                    this.world.scene.remove(container);\r\n                    return false;\r\n                }\r\n                \r\n                // Calculate progress (0 to 1)\r\n                const progress = effect.elapsed / effect.duration;\r\n                \r\n                // Update particle positions and opacity\r\n                effect.particles.forEach(particle => {\r\n                    if (effect.usePooling) {\r\n                        // Using pooled particles\r\n                        // Move particle outward\r\n                        particle.mesh.position.add(\r\n                            particle.velocity.clone().multiplyScalar(dt)\r\n                        );\r\n                        \r\n                        // Fade out gradually\r\n                        particle.material.opacity = 0.8 * (1 - progress);\r\n                        \r\n                        // Shrink slightly\r\n                        particle.mesh.scale.multiplyScalar(0.99);\r\n                    } else {\r\n                        // Using direct mesh\r\n                        // Move particle outward\r\n                        particle.mesh.position.add(\r\n                            particle.velocity.clone().multiplyScalar(dt)\r\n                        );\r\n                        \r\n                        // Fade out gradually\r\n                        particle.material.opacity = 0.8 * (1 - progress);\r\n                        \r\n                        // Shrink slightly\r\n                        particle.mesh.scale.multiplyScalar(0.99);\r\n                    }\r\n                });\r\n                \r\n                return true;\r\n            }\r\n        };\r\n        \r\n        // Add to active effects\r\n        this.activeEffects.set(effectId, effect);\r\n        \r\n        return effectId;\r\n    }\r\n    \r\n    /**\r\n     * Create a damage flash effect on screen\r\n     * @param {number} intensity Flash intensity (0-1)\r\n     * @returns {number} Effect ID\r\n     */\r\n    createDamageFlashEffect(intensity = 0.3) {\r\n        // Create a full-screen flash element\r\n        const flash = document.createElement('div');\r\n        flash.style.position = 'fixed';\r\n        flash.style.top = '0';\r\n        flash.style.left = '0';\r\n        flash.style.width = '100%';\r\n        flash.style.height = '100%';\r\n        flash.style.backgroundColor = `rgba(255, 0, 0, ${intensity})`;\r\n        flash.style.pointerEvents = 'none';\r\n        flash.style.zIndex = '1000';\r\n        flash.style.opacity = '1';\r\n        flash.style.transition = 'opacity 0.2s ease-out';\r\n        \r\n        // Add to DOM\r\n        document.body.appendChild(flash);\r\n        \r\n        // Create effect object\r\n        const effectId = this.effectCounter++;\r\n        const effect = {\r\n            id: effectId,\r\n            type: 'damageFlash',\r\n            element: flash,\r\n            duration: 0.3, // Fixed duration for damage flash\r\n            elapsed: 0,\r\n            update: (dt) => {\r\n                // Update elapsed time\r\n                effect.elapsed += dt;\r\n                \r\n                // Check if effect is complete\r\n                if (effect.elapsed >= effect.duration) {\r\n                    // Remove element from DOM\r\n                    if (document.body.contains(flash)) {\r\n                        document.body.removeChild(flash);\r\n                    }\r\n                    return false;\r\n                }\r\n                \r\n                // Calculate progress (0 to 1)\r\n                const progress = effect.elapsed / effect.duration;\r\n                \r\n                // Fade out\r\n                flash.style.opacity = (1 - progress).toString();\r\n                \r\n                return true;\r\n            }\r\n        };\r\n        \r\n        // Add to active effects\r\n        this.activeEffects.set(effectId, effect);\r\n        \r\n        return effectId;\r\n    }\r\n    \r\n    /**\r\n     * Remove an effect and clean up its resources\r\n     * @param {number} effectId ID of the effect to remove\r\n     */\r\n    removeEffect(effectId) {\r\n        // Get effect\r\n        const effect = this.activeEffects.get(effectId);\r\n        if (!effect) return;\r\n        \r\n        // Clean up based on effect type\r\n        if (effect.type === 'explosion') {\r\n            if (effect.container && this.world.scene) {\r\n                this.world.scene.remove(effect.container);\r\n            }\r\n        } else if (effect.type === 'damageFlash') {\r\n            if (effect.element && document.body.contains(effect.element)) {\r\n                document.body.removeChild(effect.element);\r\n            }\r\n        }\r\n        \r\n        // Remove from active effects\r\n        this.activeEffects.delete(effectId);\r\n    }\r\n    \r\n    /**\r\n     * Clean up all effects when system is disabled\r\n     */\r\n    onDisabled() {\r\n        // Remove all active effects\r\n        for (const effectId of this.activeEffects.keys()) {\r\n            this.removeEffect(effectId);\r\n        }\r\n        \r\n        // Clear effects map\r\n        this.activeEffects.clear();\r\n    }\r\n} ","/**\r\n * TrailSystem - Manages trail components for entities\r\n * \r\n * Handles updating all trail components and their rendering.\r\n */\r\n\r\nimport { System } from '../../core/system.js';\r\n\r\nexport class TrailSystem extends System {\r\n    /**\r\n     * Create a new trail system\r\n     */\r\n    constructor(world) {\r\n        super(world);\r\n        this.requiredComponents = ['TrailComponent', 'TransformComponent'];\r\n        this.priority = 60; // Run after movement but before rendering\r\n        \r\n        // Track trail components by entity ID\r\n        this.trails = new Map();\r\n        \r\n        // Debug\r\n        console.log(\"Trail system initialized\");\r\n    }\r\n    \r\n    /**\r\n     * Register a trail with the system\r\n     * @param {string} entityId ID of the entity\r\n     * @param {TrailComponent} trailComponent Trail component to register\r\n     */\r\n    registerTrail(entityId, trailComponent) {\r\n        this.trails.set(entityId, trailComponent);\r\n        console.log(`Registered trail for entity ${entityId}`);\r\n    }\r\n    \r\n    /**\r\n     * Unregister a trail from the system\r\n     * @param {string} entityId ID of the entity\r\n     */\r\n    unregisterTrail(entityId) {\r\n        this.trails.delete(entityId);\r\n    }\r\n    \r\n    /**\r\n     * Process a single entity with a trail component\r\n     * @param {Entity} entity Entity to process\r\n     * @param {number} deltaTime Time since last update in seconds\r\n     */\r\n    processEntity(entity, deltaTime) {\r\n        // Get trail component\r\n        const trail = entity.getComponent('TrailComponent');\r\n        if (!trail) return;\r\n        \r\n        // Update trail\r\n        trail.update(deltaTime);\r\n    }\r\n    \r\n    /**\r\n     * Update all trails\r\n     * @param {number} deltaTime Time since last update in seconds\r\n     */\r\n    update(deltaTime) {\r\n        // Process all entities with trail components through the standard system method\r\n        super.update(deltaTime);\r\n        \r\n        // Extra manual processing for any trails registered manually\r\n        // This handles trails that might not be properly set up as components\r\n        for (const [entityId, trail] of this.trails.entries()) {\r\n            if (trail && !trail.entity) {\r\n                // This is a manually registered trail without an entity\r\n                // Try to get the entity from the world\r\n                const entity = this.world.getEntity(entityId);\r\n                if (entity) {\r\n                    // Manually update the trail with the entity's transform\r\n                    const transform = entity.getComponent('TransformComponent');\r\n                    if (transform) {\r\n                        trail.update(deltaTime);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Clean up when system is disabled\r\n     */\r\n    onDisabled() {\r\n        // Clean up all trails (best effort)\r\n        for (const trail of this.trails.values()) {\r\n            if (trail && trail.onDetached) {\r\n                trail.onDetached();\r\n            }\r\n        }\r\n        \r\n        // Clear trails map\r\n        this.trails.clear();\r\n    }\r\n} ","/**\r\n * DeployableLaserSystem - Manages deployable laser turrets\r\n * \r\n * This system handles targeting, firing, and damage application for player-owned deployable laser turrets.\r\n */\r\n\r\nimport { System } from '../../core/system.js';\r\nimport * as THREE from 'three';\r\n\r\nexport class DeployableLaserSystem extends System {\r\n    constructor(world) {\r\n        super(world);\r\n        \r\n        // Required components for entities this system processes\r\n        this.requiredComponents = ['DeployableLaserComponent', 'TransformComponent', 'MeshComponent'];\r\n        \r\n        // Tracking properties\r\n        this.player = null;\r\n        \r\n        // Visual state\r\n        this.activeBeams = new Map(); // Map of entity ID to beam object\r\n        \r\n        // Subscribe to messages\r\n        this.world.messageBus.subscribe('player.created', this.handlePlayerCreated.bind(this));\r\n    }\r\n    \r\n    /**\r\n     * Initialize the system\r\n     */\r\n    initialize() {\r\n        console.log('Deployable Laser System initialized');\r\n    }\r\n    \r\n    /**\r\n     * Handle player creation\r\n     * @param {Object} data Event data\r\n     */\r\n    handlePlayerCreated(data) {\r\n        this.player = data.entity;\r\n    }\r\n    \r\n    /**\r\n     * Update all deployable lasers\r\n     * @param {number} deltaTime Time since last update in seconds\r\n     */\r\n    update(deltaTime) {\r\n        // Get all deployable laser entities\r\n        const laserEntities = this.world.getEntitiesWithComponents(this.requiredComponents);\r\n        \r\n        // Get all potential target entities (enemies)\r\n        const targetEntities = this.world.getEntitiesByTag('enemy');\r\n        \r\n        // Update each laser\r\n        for (const laserEntity of laserEntities) {\r\n            const laserComponent = laserEntity.getComponent('DeployableLaserComponent');\r\n            const transform = laserEntity.getComponent('TransformComponent');\r\n            \r\n            // Update cooldown\r\n            if (laserComponent.fireCooldown > 0) {\r\n                laserComponent.fireCooldown -= deltaTime;\r\n            }\r\n            \r\n            // Find a target if don't have one or current target is invalid\r\n            if (!laserComponent.targetEntityId || !this.isValidTarget(laserComponent.targetEntityId)) {\r\n                this.findTarget(laserEntity, laserComponent, transform, targetEntities);\r\n            }\r\n            \r\n            // If we have a valid target and can fire, shoot at it\r\n            if (laserComponent.targetEntityId && laserComponent.canFire()) {\r\n                this.fireAtTarget(laserEntity, laserComponent);\r\n            }\r\n            \r\n            // Cleanup any beam visuals\r\n            this.updateBeamVisuals(laserEntity.id, deltaTime);\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Find a valid target for the laser\r\n     * @param {Entity} laserEntity The laser entity\r\n     * @param {Object} laserComponent The laser component\r\n     * @param {Object} transform The transform component\r\n     * @param {Entity[]} potentialTargets List of potential targets\r\n     */\r\n    findTarget(laserEntity, laserComponent, transform, potentialTargets) {\r\n        const laserPosition = transform.position;\r\n        let closestTarget = null;\r\n        let closestDistance = Infinity;\r\n        \r\n        // Find the closest valid target within range\r\n        for (const target of potentialTargets) {\r\n            // Skip already destroyed targets\r\n            const healthComponent = target.getComponent('HealthComponent');\r\n            if (!healthComponent || healthComponent.isDestroyed) {\r\n                continue;\r\n            }\r\n            \r\n            // Get target position\r\n            const targetTransform = target.getComponent('TransformComponent');\r\n            if (!targetTransform) continue;\r\n            \r\n            // Calculate distance\r\n            const distance = targetTransform.position.distanceTo(laserPosition);\r\n            \r\n            // Check if in range and closer than current closest\r\n            if (distance <= laserComponent.range && distance < closestDistance) {\r\n                closestTarget = target;\r\n                closestDistance = distance;\r\n            }\r\n        }\r\n        \r\n        // Set the target\r\n        laserComponent.targetEntityId = closestTarget ? closestTarget.id : null;\r\n    }\r\n    \r\n    /**\r\n     * Check if a target is still valid\r\n     * @param {string} targetId The target entity ID\r\n     * @returns {boolean} Whether the target is valid\r\n     */\r\n    isValidTarget(targetId) {\r\n        const entity = this.world.getEntity(targetId);\r\n        if (!entity) return false;\r\n        \r\n        const healthComponent = entity.getComponent('HealthComponent');\r\n        if (!healthComponent || healthComponent.isDestroyed) return false;\r\n        \r\n        return true;\r\n    }\r\n    \r\n    /**\r\n     * Fire the laser at the current target\r\n     * @param {Entity} laserEntity The laser entity\r\n     * @param {Object} laserComponent The laser component\r\n     */\r\n    fireAtTarget(laserEntity, laserComponent) {\r\n        // Get the target entity\r\n        const targetEntity = this.world.getEntity(laserComponent.targetEntityId);\r\n        if (!targetEntity) {\r\n            laserComponent.targetEntityId = null;\r\n            return;\r\n        }\r\n        \r\n        // Roll for accuracy\r\n        const hit = Math.random() <= laserComponent.accuracy;\r\n        \r\n        if (hit) {\r\n            // Apply damage to target\r\n            const healthComponent = targetEntity.getComponent('HealthComponent');\r\n            if (healthComponent) {\r\n                // Ensure we can reference the entity in the event\r\n                const entityId = targetEntity.id;\r\n                const entityType = targetEntity.hasTag('enemy') ? 'enemy' : 'unknown';\r\n                \r\n                try {\r\n                    // Make sure to set a large enough damage to one-shot any enemy\r\n                    const damageAmount = Math.max(healthComponent.health + healthComponent.shield, 1000);\r\n                    \r\n                    // Apply the damage\r\n                    healthComponent.applyDamage(damageAmount);\r\n                    \r\n                    // Set entity as destroyed\r\n                    healthComponent.isDestroyed = true;\r\n                    \r\n                    // Publish damage event with proper entity reference\r\n                    this.world.messageBus.publish('entity.damaged', {\r\n                        entity: targetEntity,\r\n                        entityId: entityId,\r\n                        entityType: entityType,\r\n                        damage: damageAmount,\r\n                        sourceId: laserEntity.id,\r\n                        sourceType: 'deployableLaser'\r\n                    });\r\n                    \r\n                    // Publish entity destroyed event with the full entity object\r\n                    this.world.messageBus.publish('entity.destroyed', {\r\n                        entity: targetEntity,\r\n                        entityId: entityId,\r\n                        entityType: entityType,\r\n                        sourceId: laserEntity.id,\r\n                        sourceType: 'deployableLaser'\r\n                    });\r\n                    \r\n                    // Directly destroy the entity\r\n                    if (this.world && this.world.destroyEntity) {\r\n                        // Get the mesh component to remove from scene first\r\n                        const meshComponent = targetEntity.getComponent('MeshComponent');\r\n                        if (meshComponent && meshComponent.mesh) {\r\n                            // Remove from scene before destroying\r\n                            this.world.scene.remove(meshComponent.mesh);\r\n                        }\r\n                        \r\n                        // Destroy the entity\r\n                        setTimeout(() => {\r\n                            try {\r\n                                this.world.destroyEntity(targetEntity);\r\n                            } catch (error) {\r\n                                console.error(\"Error destroying entity:\", error);\r\n                            }\r\n                        }, 10); // Small delay to ensure event processing happens first\r\n                    }\r\n                    \r\n                    console.log(`Deployable laser ${laserEntity.id} hit and destroyed target ${targetEntity.id}`);\r\n                } catch (error) {\r\n                    console.error(\"Error applying damage:\", error);\r\n                }\r\n            }\r\n        } else {\r\n            console.log(`Deployable laser ${laserEntity.id} missed target ${targetEntity.id}`);\r\n        }\r\n        \r\n        // Create visual effect\r\n        try {\r\n            this.createFireVisual(laserEntity, targetEntity, hit);\r\n        } catch (error) {\r\n            console.error(\"Error creating visual effect:\", error);\r\n        }\r\n        \r\n        // Reset cooldown\r\n        laserComponent.resetCooldown();\r\n    }\r\n    \r\n    /**\r\n     * Create visual beam effect for firing\r\n     * @param {Entity} laserEntity The laser entity\r\n     * @param {Entity} targetEntity The target entity\r\n     * @param {boolean} hit Whether the shot hit\r\n     */\r\n    createFireVisual(laserEntity, targetEntity, hit) {\r\n        try {\r\n            const laserComponent = laserEntity.getComponent('DeployableLaserComponent');\r\n            const laserTransform = laserEntity.getComponent('TransformComponent');\r\n            const targetTransform = targetEntity.getComponent('TransformComponent');\r\n            const meshComponent = laserEntity.getComponent('MeshComponent');\r\n            \r\n            if (!laserTransform || !targetTransform) {\r\n                console.error(\"Missing required transform component for visual effect\");\r\n                return;\r\n            }\r\n            \r\n            // Get the target position\r\n            const targetPos = targetTransform.position.clone();\r\n            \r\n            // Calculate base position of the laser entity\r\n            const basePos = laserTransform.position.clone();\r\n            \r\n            // Determine which emitter to use based on positions\r\n            // Calculate emitter positions relative to the base\r\n            const scale = 20; // Should match the scale in deploymentSystem.js\r\n            const emitterPositions = [\r\n                new THREE.Vector3(basePos.x + 3.5 * scale, basePos.y + 3.5 * scale, basePos.z),\r\n                new THREE.Vector3(basePos.x - 3.5 * scale, basePos.y + 3.5 * scale, basePos.z),\r\n                new THREE.Vector3(basePos.x, basePos.y - 3.5 * scale, basePos.z + 3.5 * scale),\r\n                new THREE.Vector3(basePos.x, basePos.y + 3.5 * scale, basePos.z - 3.5 * scale)\r\n            ];\r\n            \r\n            // Find closest emitter to target\r\n            let closestEmitter = null;\r\n            let minDistance = Infinity;\r\n            for (const emitterPos of emitterPositions) {\r\n                const dist = emitterPos.distanceTo(targetPos);\r\n                if (dist < minDistance) {\r\n                    minDistance = dist;\r\n                    closestEmitter = emitterPos;\r\n                }\r\n            }\r\n            \r\n            // Use the closest emitter as the start position\r\n            const start = closestEmitter;\r\n            const end = targetPos;\r\n            const direction = new THREE.Vector3().subVectors(end, start).normalize();\r\n            const distance = start.distanceTo(end);\r\n            \r\n            // Create a basic cylinder representing the laser beam\r\n            const beamWidth = 5; // Increased width for more visibility\r\n            const beamGeometry = new THREE.CylinderGeometry(beamWidth, beamWidth, distance, 12);\r\n            beamGeometry.rotateX(Math.PI / 2); // Align with z-axis\r\n            beamGeometry.translate(0, 0, distance / 2); // Move pivot to base of cylinder\r\n            \r\n            // More impressive material with emissive properties\r\n            const beamMaterial = new THREE.MeshBasicMaterial({\r\n                color: 0xFF0033,\r\n                transparent: true,\r\n                opacity: 0.8,\r\n                emissive: 0xFF0000,\r\n                emissiveIntensity: 1.0\r\n            });\r\n            \r\n            const beam = new THREE.Mesh(beamGeometry, beamMaterial);\r\n            \r\n            // Set position and orientation\r\n            beam.position.copy(start);\r\n            beam.lookAt(end);\r\n            \r\n            // Add to scene\r\n            this.world.scene.add(beam);\r\n            \r\n            // Store the beam for later cleanup with a lifetime of 0.2 seconds\r\n            this.activeBeams.set(laserEntity.id, {\r\n                mesh: beam,\r\n                lifetime: 0.2,\r\n                hit: hit\r\n            });\r\n            \r\n            // If the shot hit, create an impact effect\r\n            if (hit) {\r\n                // Use the standard explosion effect by publishing an event\r\n                this.world.messageBus.publish('vfx.explosion', {\r\n                    position: end,\r\n                    scale: 1.5, // Make it a bit larger than standard\r\n                    color: 0xFF3333\r\n                });\r\n            }\r\n        } catch (error) {\r\n            console.error(\"Error creating laser visual effect:\", error);\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Update and clean up beam visuals\r\n     * @param {string} entityId The laser entity ID\r\n     * @param {number} deltaTime Time since last update\r\n     */\r\n    updateBeamVisuals(entityId, deltaTime) {\r\n        if (this.activeBeams.has(entityId)) {\r\n            const beamData = this.activeBeams.get(entityId);\r\n            \r\n            // Skip if beam data is invalid\r\n            if (!beamData || !beamData.mesh) {\r\n                this.activeBeams.delete(entityId);\r\n                return;\r\n            }\r\n            \r\n            // Reduce lifetime\r\n            beamData.lifetime -= deltaTime;\r\n            \r\n            // If beam has expired, remove it\r\n            if (beamData.lifetime <= 0) {\r\n                try {\r\n                    this.world.scene.remove(beamData.mesh);\r\n                    \r\n                    // Clean up resources\r\n                    if (beamData.mesh.geometry) beamData.mesh.geometry.dispose();\r\n                    if (beamData.mesh.material) beamData.mesh.material.dispose();\r\n                    \r\n                    this.activeBeams.delete(entityId);\r\n                } catch (error) {\r\n                    console.error(\"Error removing beam visual:\", error);\r\n                    this.activeBeams.delete(entityId);\r\n                }\r\n            }\r\n            // Otherwise, fade it out\r\n            else {\r\n                beamData.mesh.material.opacity = beamData.lifetime / 0.2 * 0.7;\r\n            }\r\n        }\r\n    }\r\n} ","/**\r\n * DeploymentSystem - Handles deployment and pickup of deployable items\r\n * \r\n * This system manages the deployment of items like laser turrets and their pickup.\r\n */\r\n\r\nimport { System } from '../../core/system.js';\r\nimport * as THREE from 'three';\r\n\r\nexport class DeploymentSystem extends System {\r\n    constructor(world) {\r\n        super(world);\r\n        \r\n        // Required components for entities this system processes\r\n        this.requiredComponents = ['PickupableComponent', 'TransformComponent'];\r\n        \r\n        // Reference to player entity\r\n        this.player = null;\r\n        \r\n        // Pickup range (how close the player needs to be to pick up an item)\r\n        this.pickupRange = 50;\r\n        \r\n        // Deployment state\r\n        this.isDeploymentReady = false;\r\n        this.deploymentType = null;\r\n        \r\n        // Subscribe to relevant events\r\n        this.world.messageBus.subscribe('player.created', this.handlePlayerCreated.bind(this));\r\n        this.world.messageBus.subscribe('input.deployLaser', this.handleDeployLaserRequest.bind(this));\r\n        this.world.messageBus.subscribe('input.pickupInteract', this.handlePickupRequest.bind(this));\r\n    }\r\n    \r\n    /**\r\n     * Initialize the system\r\n     */\r\n    initialize() {\r\n        console.log('Deployment System initialized');\r\n        \r\n        // Try to find the player entity if it wasn't set by the player.created event\r\n        if (!this.player) {\r\n            // Check if the player is available globally\r\n            if (window.game && window.game.combat && window.game.combat.playerEntity) {\r\n                console.log('Found player entity in window.game.combat.playerEntity');\r\n                this.player = window.game.combat.playerEntity;\r\n            } \r\n            // Check if the world has a direct reference to the player\r\n            else if (this.world.playerEntity) {\r\n                console.log('Found player entity in world.playerEntity');\r\n                this.player = this.world.playerEntity;\r\n            }\r\n            // Try to find player by tag\r\n            else {\r\n                const playersWithTag = this.world.getEntitiesByTag('player');\r\n                if (playersWithTag && playersWithTag.length > 0) {\r\n                    console.log('Found player entity by tag');\r\n                    this.player = playersWithTag[0];\r\n                }\r\n            }\r\n        }\r\n        \r\n        if (this.player) {\r\n            console.log(`Deployment System found player entity with ID: ${this.player.id}`);\r\n        } else {\r\n            console.warn('Deployment System could not find player entity during initialization');\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Handle player creation\r\n     * @param {Object} data Event data\r\n     */\r\n    handlePlayerCreated(data) {\r\n        this.player = data.entity;\r\n    }\r\n    \r\n    /**\r\n     * Update the system\r\n     * @param {number} deltaTime Time since last update in seconds\r\n     */\r\n    update(deltaTime) {\r\n        // Try to find the player entity if it's not already set\r\n        if (!this.player) {\r\n            // Check several places where the player entity might be available\r\n            if (window.game && window.game.combat && window.game.combat.playerEntity) {\r\n                this.player = window.game.combat.playerEntity;\r\n                console.log('Found player entity in window.game.combat.playerEntity');\r\n            } else if (this.world.playerEntity) {\r\n                this.player = this.world.playerEntity;\r\n                console.log('Found player entity in world.playerEntity');\r\n            } else {\r\n                const playersWithTag = this.world.getEntitiesByTag('player');\r\n                if (playersWithTag && playersWithTag.length > 0) {\r\n                    this.player = playersWithTag[0];\r\n                    console.log('Found player entity by tag');\r\n                }\r\n            }\r\n        }\r\n        \r\n        // Get all pickupable entities\r\n        const pickupables = this.world.getEntitiesWithComponents(this.requiredComponents);\r\n        \r\n        // Check for nearby pickupables to highlight or interact with\r\n        if (this.player) {\r\n            const playerTransform = this.player.getComponent('TransformComponent');\r\n            if (playerTransform) {\r\n                for (const entity of pickupables) {\r\n                    // Initialize userData if it doesn't exist\r\n                    if (!entity.userData) {\r\n                        entity.userData = {};\r\n                    }\r\n                    \r\n                    const pickupable = entity.getComponent('PickupableComponent');\r\n                    const transform = entity.getComponent('TransformComponent');\r\n                    \r\n                    // Check if close enough to pick up\r\n                    const distance = playerTransform.position.distanceTo(transform.position);\r\n                    \r\n                    // Add visual indicator if player is close enough to pick up\r\n                    if (distance <= pickupable.pickupRange) {\r\n                        // Visual indicator logic could go here\r\n                        // For now, just set a flag that could be used by UI\r\n                        if (!entity.userData.isHighlighted) {\r\n                            entity.userData.isHighlighted = true;\r\n                            // Could publish an event for UI to show pickup prompt\r\n                            this.world.messageBus.publish('pickup.available', {\r\n                                entity: entity,\r\n                                type: pickupable.type\r\n                            });\r\n                        }\r\n                    } else if (entity.userData.isHighlighted) {\r\n                        // Remove highlight\r\n                        entity.userData.isHighlighted = false;\r\n                        // Could publish an event for UI to hide pickup prompt\r\n                        this.world.messageBus.publish('pickup.unavailable', {\r\n                            entity: entity\r\n                        });\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Handle request to deploy a laser turret\r\n     * @param {Object} data Event data\r\n     */\r\n    handleDeployLaserRequest(data) {\r\n        try {\r\n            // Try to find the player entity if it's not already set\r\n            if (!this.player) {\r\n                // Check several places where the player entity might be available\r\n                if (window.game && window.game.combat && window.game.combat.playerEntity) {\r\n                    this.player = window.game.combat.playerEntity;\r\n                    console.log('Found player entity in window.game.combat.playerEntity');\r\n                } else if (this.world.playerEntity) {\r\n                    this.player = this.world.playerEntity;\r\n                    console.log('Found player entity in world.playerEntity');\r\n                } else {\r\n                    const playersWithTag = this.world.getEntitiesByTag('player');\r\n                    if (playersWithTag && playersWithTag.length > 0) {\r\n                        this.player = playersWithTag[0];\r\n                        console.log('Found player entity by tag');\r\n                    }\r\n                }\r\n                \r\n                if (!this.player) {\r\n                    console.error(\"Cannot deploy laser: player entity not found\");\r\n                    return;\r\n                }\r\n            }\r\n            \r\n            // Check if the player has deployable lasers\r\n            // This requires checking the Spaceship object from window.game\r\n            if (!window.game || !window.game.spaceship) {\r\n                console.error(\"Cannot deploy laser: game or spaceship not found\");\r\n                return;\r\n            }\r\n            \r\n            const spaceship = window.game.spaceship;\r\n            if (!spaceship.deployableLaserCount || spaceship.deployableLaserCount <= 0) {\r\n                console.log(\"No deployable lasers available\");\r\n                // Notify the player\r\n                this.world.messageBus.publish('ui.notification', {\r\n                    message: \"No deployable lasers available\",\r\n                    type: \"warning\",\r\n                    duration: 2\r\n                });\r\n                return;\r\n            }\r\n            \r\n            // Get player position\r\n            const playerTransform = this.player.getComponent('TransformComponent');\r\n            if (!playerTransform) {\r\n                console.error(\"Cannot deploy laser: player transform not found\");\r\n                return;\r\n            }\r\n            \r\n            // Create deployable laser entity\r\n            const laserEntity = this.createDeployableLaser(\r\n                playerTransform.position.clone(),\r\n                this.player.id\r\n            );\r\n            \r\n            if (laserEntity) {\r\n                // Decrement player's laser count\r\n                spaceship.deployableLaserCount--;\r\n                \r\n                // Notify the player\r\n                this.world.messageBus.publish('ui.notification', {\r\n                    message: \"Laser turret deployed\",\r\n                    type: \"success\",\r\n                    duration: 2\r\n                });\r\n                \r\n                // Publish deployment event\r\n                this.world.messageBus.publish('laser.deployed', {\r\n                    entity: laserEntity,\r\n                    position: playerTransform.position.clone()\r\n                });\r\n                \r\n                console.log(`Deployed laser turret at ${playerTransform.position.x}, ${playerTransform.position.y}, ${playerTransform.position.z}`);\r\n            }\r\n        } catch (error) {\r\n            console.error(\"Error deploying laser turret:\", error);\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Handle request to pick up an item\r\n     * @param {Object} data Event data\r\n     */\r\n    handlePickupRequest(data) {\r\n        // Try to find the player entity if it's not already set\r\n        if (!this.player) {\r\n            // Check several places where the player entity might be available\r\n            if (window.game && window.game.combat && window.game.combat.playerEntity) {\r\n                this.player = window.game.combat.playerEntity;\r\n                console.log('Found player entity in window.game.combat.playerEntity');\r\n            } else if (this.world.playerEntity) {\r\n                this.player = this.world.playerEntity;\r\n                console.log('Found player entity in world.playerEntity');\r\n            } else {\r\n                const playersWithTag = this.world.getEntitiesByTag('player');\r\n                if (playersWithTag && playersWithTag.length > 0) {\r\n                    this.player = playersWithTag[0];\r\n                    console.log('Found player entity by tag');\r\n                }\r\n            }\r\n            \r\n            if (!this.player) {\r\n                console.error(\"Cannot pickup: player entity not found\");\r\n                return;\r\n            }\r\n        }\r\n        \r\n        // Get player position\r\n        const playerTransform = this.player.getComponent('TransformComponent');\r\n        if (!playerTransform) {\r\n            console.error(\"Cannot pickup: player transform not found\");\r\n            return;\r\n        }\r\n        \r\n        // Find the closest pickupable entity\r\n        const pickupables = this.world.getEntitiesWithComponents(this.requiredComponents);\r\n        let closestEntity = null;\r\n        let closestDistance = Infinity;\r\n        \r\n        for (const entity of pickupables) {\r\n            const pickupable = entity.getComponent('PickupableComponent');\r\n            if (!pickupable.canBePickedUp) continue;\r\n            \r\n            const transform = entity.getComponent('TransformComponent');\r\n            const distance = playerTransform.position.distanceTo(transform.position);\r\n            \r\n            if (distance <= pickupable.pickupRange && distance < closestDistance) {\r\n                closestEntity = entity;\r\n                closestDistance = distance;\r\n            }\r\n        }\r\n        \r\n        if (closestEntity) {\r\n            this.pickupEntity(closestEntity);\r\n        } else {\r\n            // No entities in range\r\n            console.log(\"No pickupable entities in range\");\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Pick up an entity\r\n     * @param {Entity} entity The entity to pick up\r\n     */\r\n    pickupEntity(entity) {\r\n        const pickupable = entity.getComponent('PickupableComponent');\r\n        \r\n        if (pickupable.type === 'deployableLaser') {\r\n            // Add to player inventory\r\n            if (window.game && window.game.spaceship) {\r\n                // Initialize deployableLaserCount if it doesn't exist\r\n                if (typeof window.game.spaceship.deployableLaserCount === 'undefined') {\r\n                    window.game.spaceship.deployableLaserCount = 0;\r\n                }\r\n                \r\n                window.game.spaceship.deployableLaserCount++;\r\n                \r\n                // Notify the player\r\n                this.world.messageBus.publish('ui.notification', {\r\n                    message: \"Laser turret retrieved\",\r\n                    type: \"success\",\r\n                    duration: 2\r\n                });\r\n                \r\n                // Publish pickup event\r\n                this.world.messageBus.publish('laser.pickedup', {\r\n                    entity: entity\r\n                });\r\n                \r\n                // Remove the entity from the world\r\n                this.world.destroyEntity(entity);\r\n                \r\n                console.log(\"Picked up deployable laser\");\r\n            } else {\r\n                console.error(\"Cannot pick up laser: game or spaceship not found\");\r\n            }\r\n        } else {\r\n            console.log(`Picked up ${pickupable.type} but no handler defined`);\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Create a deployable laser entity\r\n     * @param {THREE.Vector3} position The position to deploy at\r\n     * @param {string} ownerId The ID of the owner entity\r\n     * @returns {Entity} The created entity\r\n     */\r\n    createDeployableLaser(position, ownerId) {\r\n        try {\r\n            // Create the entity\r\n            const entity = this.world.createEntity(`deployable_laser_${Date.now()}`);\r\n            \r\n            // Initialize userData with necessary flags\r\n            entity.userData = { \r\n                isHighlighted: false, \r\n                _isEnemy: false, \r\n                isDeployableLaser: true \r\n            };\r\n            \r\n            // Add tags for identification\r\n            entity.addTag('deployableLaser');\r\n            entity.addTag('friendly'); // Add friendly tag to distinguish from enemies\r\n            // Explicitly add a NOT_ENEMY tag to avoid any tag cache issues\r\n            entity.addTag('NOT_ENEMY');\r\n            \r\n            // Directly create components - no async imports\r\n            // Add transform component\r\n            try {\r\n                // Get TransformComponent constructor from a player entity\r\n                const TransformComponent = this.player.getComponent('TransformComponent').constructor;\r\n                const transform = new TransformComponent(position);\r\n                entity.addComponent(transform);\r\n            } catch (error) {\r\n                console.error(\"Error adding transform component:\", error);\r\n                this.world.destroyEntity(entity);\r\n                return null;\r\n            }\r\n            \r\n            // Create the laser turret mesh - MUCH LARGER AND MORE FUTURISTIC\r\n            const scale = 20; // Scale factor for larger turret\r\n            \r\n            // Create the main body as a sphere\r\n            const coreGeometry = new THREE.SphereGeometry(4 * scale, 24, 24);\r\n            const coreMaterial = new THREE.MeshPhongMaterial({ \r\n                color: 0x333340,\r\n                specular: 0x3366FF,\r\n                shininess: 50,\r\n                emissive: 0x222233,\r\n                emissiveIntensity: 0.3\r\n            });\r\n            const core = new THREE.Mesh(coreGeometry, coreMaterial);\r\n            \r\n            // Add glowing energy sphere in the center\r\n            const energyGeometry = new THREE.SphereGeometry(2.5 * scale, 32, 32);\r\n            const energyMaterial = new THREE.MeshPhongMaterial({ \r\n                color: 0xFF3333,\r\n                specular: 0xFFFFFF,\r\n                shininess: 30,\r\n                emissive: 0xFF0000,\r\n                emissiveIntensity: 0.8,\r\n                transparent: true,\r\n                opacity: 0.9\r\n            });\r\n            const energySphere = new THREE.Mesh(energyGeometry, energyMaterial);\r\n            \r\n            // Add multiple floating emitter nodes around the sphere\r\n            const emitterGeometry = new THREE.SphereGeometry(0.8 * scale, 16, 16);\r\n            const emitterMaterial = new THREE.MeshPhongMaterial({ \r\n                color: 0xFFCC00,\r\n                specular: 0xFFFFFF, \r\n                shininess: 100,\r\n                emissive: 0xFFAA00,\r\n                emissiveIntensity: 0.7\r\n            });\r\n            \r\n            // Create 4 floating emitters at different positions\r\n            const emitters = [];\r\n            const emitterPositions = [\r\n                new THREE.Vector3(3.5 * scale, 3.5 * scale, 0),\r\n                new THREE.Vector3(-3.5 * scale, 3.5 * scale, 0),\r\n                new THREE.Vector3(0, -3.5 * scale, 3.5 * scale),\r\n                new THREE.Vector3(0, 3.5 * scale, -3.5 * scale)\r\n            ];\r\n            \r\n            for (let i = 0; i < emitterPositions.length; i++) {\r\n                const emitter = new THREE.Mesh(emitterGeometry, emitterMaterial);\r\n                emitter.position.copy(emitterPositions[i]);\r\n                emitters.push(emitter);\r\n            }\r\n            \r\n            // Add orbital rings\r\n            const ring1Geometry = new THREE.TorusGeometry(5 * scale, 0.4 * scale, 16, 48);\r\n            const ring2Geometry = new THREE.TorusGeometry(5.5 * scale, 0.4 * scale, 16, 48);\r\n            const ringMaterial = new THREE.MeshPhongMaterial({\r\n                color: 0x3366BB, \r\n                specular: 0x6699FF,\r\n                shininess: 50,\r\n                emissive: 0x3366FF,\r\n                emissiveIntensity: 0.5,\r\n                transparent: true,\r\n                opacity: 0.8\r\n            });\r\n            \r\n            const ring1 = new THREE.Mesh(ring1Geometry, ringMaterial);\r\n            const ring2 = new THREE.Mesh(ring2Geometry, ringMaterial);\r\n            \r\n            // Position rings at different angles\r\n            ring1.rotation.x = Math.PI / 2;\r\n            ring2.rotation.y = Math.PI / 2;\r\n            \r\n            // Animate rings and emitters\r\n            const animate = () => {\r\n                if (ring1 && ring2) {\r\n                    ring1.rotation.z += 0.005;\r\n                    ring2.rotation.z -= 0.003;\r\n                    \r\n                    // Make emitters orbit around the core\r\n                    for (let i = 0; i < emitters.length; i++) {\r\n                        // Create different orbital animations for each emitter\r\n                        const time = Date.now() * 0.001;\r\n                        const radius = 3.5 * scale;\r\n                        const speed = 0.5 + (i * 0.1);\r\n                        \r\n                        emitters[i].position.x = Math.cos(time * speed) * radius * (i % 2 ? 1 : 0.8);\r\n                        emitters[i].position.y = Math.sin(time * speed) * radius * (i % 3 ? 0.9 : 1);\r\n                        emitters[i].position.z = Math.cos(time * speed + Math.PI/2) * radius * (i % 2 ? 0.8 : 1);\r\n                    }\r\n                    \r\n                    requestAnimationFrame(animate);\r\n                }\r\n            };\r\n            requestAnimationFrame(animate);\r\n            \r\n            // Create group to combine all elements\r\n            const group = new THREE.Group();\r\n            group.add(core);\r\n            group.add(energySphere);\r\n            emitters.forEach(emitter => group.add(emitter));\r\n            group.add(ring1);\r\n            group.add(ring2);\r\n            \r\n            // No need to rotate as it's a spherical design that works in all directions\r\n            \r\n            // Add mesh component\r\n            try {\r\n                // Get MeshComponent from Combat module (via window.game)\r\n                let MeshComponent;\r\n                if (window.game && window.game.combat) {\r\n                    // Try to get an entity with a mesh component\r\n                    const entitiesWithMesh = this.world.getEntitiesWithComponents(['MeshComponent']);\r\n                    if (entitiesWithMesh && entitiesWithMesh.length > 0) {\r\n                        MeshComponent = entitiesWithMesh[0].getComponent('MeshComponent').constructor;\r\n                    }\r\n                }\r\n                \r\n                // Fallback if we couldn't find MeshComponent\r\n                if (!MeshComponent) {\r\n                    // Create a simple wrapper as fallback\r\n                    MeshComponent = function(mesh) {\r\n                        this.type = 'MeshComponent';\r\n                        this.mesh = mesh;\r\n                    };\r\n                    MeshComponent.prototype.dispose = function() {\r\n                        if (this.mesh) {\r\n                            if (this.mesh.geometry) this.mesh.geometry.dispose();\r\n                            if (this.mesh.material) this.mesh.material.dispose();\r\n                        }\r\n                    };\r\n                }\r\n                \r\n                const mesh = new MeshComponent(group);\r\n                entity.addComponent(mesh);\r\n                \r\n                // Add to scene\r\n                this.world.scene.add(group);\r\n            } catch (error) {\r\n                console.error(\"Error adding mesh component:\", error);\r\n                this.world.destroyEntity(entity);\r\n                return null;\r\n            }\r\n            \r\n            // Add deployable laser component\r\n            try {\r\n                // Simple implementation of DeployableLaserComponent\r\n                const DeployableLaserComponent = function(range, fireRate, accuracy) {\r\n                    this.type = 'DeployableLaserComponent';\r\n                    this.range = range || 1000;\r\n                    this.fireRate = fireRate || 3;\r\n                    this.accuracy = accuracy || 0.5;\r\n                    this.fireCooldown = 0;\r\n                    this.targetEntityId = null;\r\n                    this.laserColor = 0xFF0033;\r\n                    this.laserWidth = 0.5;\r\n                    this.ownerId = null;\r\n                    this.isDeployed = true;\r\n                };\r\n                \r\n                DeployableLaserComponent.prototype.resetCooldown = function() {\r\n                    this.fireCooldown = this.fireRate;\r\n                };\r\n                \r\n                DeployableLaserComponent.prototype.canFire = function() {\r\n                    return this.fireCooldown <= 0;\r\n                };\r\n                \r\n                const laserComponent = new DeployableLaserComponent(1000, 3, 0.5);\r\n                laserComponent.ownerId = ownerId;\r\n                entity.addComponent(laserComponent);\r\n            } catch (error) {\r\n                console.error(\"Error adding deployable laser component:\", error);\r\n                this.world.destroyEntity(entity);\r\n                return null;\r\n            }\r\n            \r\n            // Add pickupable component\r\n            try {\r\n                // Simple implementation of PickupableComponent\r\n                const PickupableComponent = function(type, pickupRange) {\r\n                    this.type = 'PickupableComponent';\r\n                    this.itemType = type || 'deployableLaser';\r\n                    this.pickupRange = pickupRange || 50;\r\n                    this.canBePickedUp = true;\r\n                };\r\n                \r\n                const pickupable = new PickupableComponent('deployableLaser', 50);\r\n                entity.addComponent(pickupable);\r\n            } catch (error) {\r\n                console.error(\"Error adding pickupable component:\", error);\r\n                this.world.destroyEntity(entity);\r\n                return null;\r\n            }\r\n            \r\n            console.log(`Created deployable laser entity: ${entity.id}`);\r\n            return entity;\r\n        } catch (error) {\r\n            console.error(\"Error creating deployable laser entity:\", error);\r\n            return null;\r\n        }\r\n    }\r\n} ","/**\r\n * ExplosionHandler - Manages explosion effects for combat events\r\n * \r\n * Listens for entity destruction and projectile hits to create explosion effects\r\n */\r\n\r\nimport { System } from '../../core/system.js';\r\nimport * as THREE from 'three';\r\n\r\nexport class ExplosionHandler extends System {\r\n    constructor(world) {\r\n        super(world);\r\n        this.requiredComponents = []; // No specific components required\r\n        this.priority = 80; // Run after combat systems\r\n        \r\n        // Subscribe to combat events\r\n        this.setupEventListeners();\r\n        \r\n        console.log(\"ExplosionHandler initialized - listening for combat events\");\r\n    }\r\n    \r\n    /**\r\n     * Set up event listeners for combat events\r\n     */\r\n    setupEventListeners() {\r\n        // Listen for entity destruction\r\n        this.world.messageBus.subscribe('entity.destroyed', this.handleEntityDestroyed.bind(this));\r\n        \r\n        // Listen for projectile hits\r\n        this.world.messageBus.subscribe('projectile.hit', this.handleProjectileHit.bind(this));\r\n        \r\n        // Listen for combat hits\r\n        this.world.messageBus.subscribe('combat.hit', this.handleCombatHit.bind(this));\r\n    }\r\n    \r\n    /**\r\n     * Handle entity destroyed event\r\n     * @param {object} message Event message\r\n     */\r\n    handleEntityDestroyed(message) {\r\n        const entity = message.entity;\r\n        if (!entity) return;\r\n        \r\n        // Only create explosions for enemies and player\r\n        const isEnemy = entity.hasTag && entity.hasTag('enemy');\r\n        const isPlayer = entity.hasTag && entity.hasTag('player');\r\n        \r\n        if (!isEnemy && !isPlayer) return;\r\n        \r\n        // Get position from entity's transform\r\n        const transform = entity.getComponent && entity.getComponent('TransformComponent');\r\n        if (!transform || !transform.position) return;\r\n        \r\n        const position = transform.position.clone();\r\n        \r\n        // Create BIG explosion effect when enemy is destroyed by player\r\n        // Enemies destroyed by player get bigger explosion (2.5 scale, 2000ms duration)\r\n        this.createExplosion(position, isEnemy ? 2000 : 2500, isEnemy ? 2.5 : 3.0);\r\n    }\r\n    \r\n    /**\r\n     * Handle projectile hit event\r\n     * @param {object} message Event message\r\n     */\r\n    handleProjectileHit(message) {\r\n        const { projectile, target, position } = message;\r\n        \r\n        if (!position) return;\r\n        \r\n        // Create smaller impact effect for projectile hits (not destroyed)\r\n        this.createExplosion(position, 800, 0.8);\r\n    }\r\n    \r\n    /**\r\n     * Handle combat hit event\r\n     * @param {object} message Event message\r\n     */\r\n    handleCombatHit(message) {\r\n        const { target, position, destroyed } = message;\r\n        \r\n        // Only create big explosion if target was destroyed\r\n        if (!destroyed) return;\r\n        \r\n        if (!position) return;\r\n        \r\n        // Create HUGE explosion for combat destruction (when player destroys enemy)\r\n        this.createExplosion(position, 2500, 3.0);\r\n    }\r\n    \r\n    /**\r\n     * Create an explosion effect at the given position\r\n     * @param {THREE.Vector3} position Position for the explosion\r\n     * @param {number} duration Duration in milliseconds\r\n     * @param {number} scale Scale of the explosion\r\n     */\r\n    createExplosion(position, duration = 1000, scale = 1.0) {\r\n        try {\r\n            // Try to use the game's combat system explosion effect (which has poolManager)\r\n            if (window.game && window.game.combat && window.game.combat.createExplosionEffect) {\r\n                const explosion = window.game.combat.createExplosionEffect(position, duration, true);\r\n                // Scale the explosion if it was created\r\n                if (explosion && explosion.scale) {\r\n                    explosion.scale.setScalar(scale);\r\n                }\r\n                return;\r\n            }\r\n            \r\n            // Try combat manager's effects manager\r\n            if (window.game && window.game.combatManager && window.game.combatManager.effectsManager) {\r\n                const effectsManager = window.game.combatManager.effectsManager;\r\n                if (effectsManager.createExplosionEffect) {\r\n                    // Pass the poolManager from combatManager\r\n                    const poolManager = window.game.combatManager.poolManager;\r\n                    const explosion = effectsManager.explosionEffects.createExplosionEffect(\r\n                        position, \r\n                        duration, \r\n                        true, \r\n                        poolManager,\r\n                        (obj) => {\r\n                            if (window.game && window.game.scene) {\r\n                                window.game.scene.add(obj);\r\n                            }\r\n                        }\r\n                    );\r\n                    if (explosion && explosion.scale) {\r\n                        explosion.scale.setScalar(scale);\r\n                    }\r\n                    return;\r\n                }\r\n            }\r\n            \r\n            // Fallback: Use object pool\r\n            if (window.objectPool && window.objectPool.getExplosion) {\r\n                const explosion = window.objectPool.getExplosion();\r\n                if (explosion) {\r\n                    explosion.position.copy(position);\r\n                    explosion.scale.setScalar(scale);\r\n                    explosion.visible = true;\r\n                    \r\n                    // Add to scene\r\n                    if (window.game && window.game.scene) {\r\n                        window.game.scene.add(explosion);\r\n                        console.log(\"Created explosion via object pool\");\r\n                        \r\n                        // Remove after duration\r\n                        setTimeout(() => {\r\n                            if (explosion.parent) {\r\n                                explosion.parent.remove(explosion);\r\n                            }\r\n                            if (window.objectPool && window.objectPool.releaseExplosion) {\r\n                                window.objectPool.releaseExplosion(explosion);\r\n                            }\r\n                        }, duration);\r\n                    }\r\n                }\r\n                return;\r\n            }\r\n            \r\n            // Final fallback: Create simple particle effect\r\n            this.createSimpleExplosion(position, duration, scale);\r\n            \r\n        } catch (error) {\r\n            console.error(\"Error creating explosion effect:\", error);\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Create a simple explosion effect as fallback\r\n     * @param {THREE.Vector3} position Position for the explosion\r\n     * @param {number} duration Duration in milliseconds\r\n     * @param {number} scale Scale of the explosion\r\n     */\r\n    createSimpleExplosion(position, duration = 1000, scale = 1.0) {\r\n        if (!window.game || !window.game.scene) return;\r\n        \r\n        // Create a simple expanding sphere as explosion\r\n        const geometry = new THREE.SphereGeometry(10 * scale, 16, 16);\r\n        const material = new THREE.MeshBasicMaterial({\r\n            color: 0xff6600,\r\n            transparent: true,\r\n            opacity: 0.8,\r\n            emissive: 0xff6600,\r\n            emissiveIntensity: 2\r\n        });\r\n        \r\n        const explosion = new THREE.Mesh(geometry, material);\r\n        explosion.position.copy(position);\r\n        window.game.scene.add(explosion);\r\n        \r\n        console.log(\"Created simple fallback explosion\");\r\n        \r\n        // Animate the explosion\r\n        const startTime = Date.now();\r\n        const animate = () => {\r\n            const elapsed = Date.now() - startTime;\r\n            const progress = elapsed / duration;\r\n            \r\n            if (progress >= 1) {\r\n                // Remove explosion\r\n                if (explosion.parent) {\r\n                    explosion.parent.remove(explosion);\r\n                }\r\n                geometry.dispose();\r\n                material.dispose();\r\n                return;\r\n            }\r\n            \r\n            // Expand and fade\r\n            const expansionScale = 1 + progress * 4;\r\n            explosion.scale.setScalar(expansionScale * scale);\r\n            material.opacity = 0.8 * (1 - progress);\r\n            \r\n            requestAnimationFrame(animate);\r\n        };\r\n        \r\n        animate();\r\n    }\r\n    \r\n    /**\r\n     * Update method (required by System base class)\r\n     * @param {number} deltaTime Time since last update\r\n     */\r\n    update(deltaTime) {\r\n        // No per-frame updates needed - we only respond to events\r\n    }\r\n    \r\n    /**\r\n     * Clean up when system is disabled\r\n     */\r\n    onDisabled() {\r\n        // Unsubscribe from events\r\n        this.world.messageBus.unsubscribe('entity.destroyed', this.handleEntityDestroyed.bind(this));\r\n        this.world.messageBus.unsubscribe('projectile.hit', this.handleProjectileHit.bind(this));\r\n        this.world.messageBus.unsubscribe('combat.hit', this.handleCombatHit.bind(this));\r\n        \r\n        console.log(\"ExplosionHandler disabled\");\r\n    }\r\n}","/**\r\n * System Registration Module - Handles deterministic system registration\r\n * \r\n * This module contains all the logic for registering ECS systems in the exact\r\n * order required to maintain compatibility with existing behavior.\r\n */\r\n\r\nimport { CombatSystem } from '../../systems/combat/combatSystem.js';\r\nimport { EnemySystem } from '../../systems/combat/enemySystem.js';\r\nimport { RenderSystem } from '../../systems/rendering/renderSystem.js';\r\nimport { CollisionSystem } from '../../systems/physics/collisionSystem.js';\r\nimport { VisualEffectsSystem } from '../../systems/rendering/visualEffectsSystem.js';\r\nimport { TrailSystem } from '../../systems/rendering/trailSystem.js';\r\nimport { DeployableLaserSystem } from '../../systems/weapons/deployableLaserSystem.js';\r\nimport { DeploymentSystem } from '../../systems/deployables/deploymentSystem.js';\r\nimport { ExplosionHandler } from '../../systems/effects/explosionHandler.js';\r\n\r\nexport class SystemRegistrar {\r\n    constructor() {\r\n        this.registeredSystems = {};\r\n    }\r\n\r\n    /**\r\n     * Register all combat systems with the ECS world in the correct order\r\n     * CRITICAL: This order must be preserved to maintain existing behavior\r\n     */\r\n    async registerAllSystems(world, scene) {\r\n        console.log(\"[COMBAT] Registering combat systems with ECS world...\");\r\n        \r\n        try {\r\n            // 1. Register the combat system\r\n            this.registeredSystems.combatSystem = new CombatSystem(world);\r\n            world.registerSystem(this.registeredSystems.combatSystem);\r\n            \r\n            // 2. Register the enemy system\r\n            this.registeredSystems.enemySystem = new EnemySystem(world);\r\n            world.registerSystem(this.registeredSystems.enemySystem);\r\n            \r\n            // GLOBAL ACCESS: Make the enemy system accessible to other modules\r\n            if (window.game) {\r\n                window.game.ecsWorld = window.game.ecsWorld || {};\r\n                window.game.ecsWorld.enemySystem = this.registeredSystems.enemySystem;\r\n                console.log(\"[COMBAT] Made enemy system globally available via window.game.ecsWorld.enemySystem\");\r\n            }\r\n            \r\n            // 3. Register the trail system for visual effects\r\n            this.registeredSystems.trailSystem = new TrailSystem(world);\r\n            world.registerSystem(this.registeredSystems.trailSystem);\r\n            \r\n            // 4. Register deployable laser systems\r\n            try {\r\n                this.registeredSystems.deployableLaserSystem = new DeployableLaserSystem(world);\r\n                world.registerSystem(this.registeredSystems.deployableLaserSystem);\r\n            } catch (error) {\r\n                console.warn('[COMBAT] Failed to register DeployableLaserSystem:', error);\r\n            }\r\n\r\n            try {\r\n                this.registeredSystems.deploymentSystem = new DeploymentSystem(world);\r\n                world.registerSystem(this.registeredSystems.deploymentSystem);\r\n            } catch (error) {\r\n                console.warn('[COMBAT] Failed to register DeploymentSystem:', error);\r\n            }\r\n            \r\n            // Add trail system to window.game for global access if game object exists\r\n            if (window.game) {\r\n                window.game.trailSystem = this.registeredSystems.trailSystem;\r\n                console.log(\"[COMBAT] Registered trail system with window.game for global access\");\r\n            }\r\n            \r\n            // 5. Register the instanced renderer first\r\n            try {\r\n                const { InstancedRenderer } = await import('../../systems/rendering/InstancedRenderer.js');\r\n                this.registeredSystems.instancedRenderer = new InstancedRenderer(world, scene);\r\n                world.registerSystem(this.registeredSystems.instancedRenderer);\r\n                console.log('[COMBAT] InstancedRenderer registered');\r\n            } catch (e) {\r\n                console.warn('[COMBAT] InstancedRenderer not available:', e);\r\n            }\r\n\r\n            // 6. Register the render system - this is critical for making meshes visible\r\n            // Use the scene's camera reference if available\r\n            const camera = scene.camera;\r\n            \r\n            if (!camera) {\r\n                console.error(\"[COMBAT] No camera found on scene, enemies may not be visible\");\r\n            }\r\n            \r\n            // Log camera reference for debugging\r\n            console.log(`[COMBAT] Camera reference for RenderSystem: ${camera ? \"Available\" : \"Missing\"}`);\r\n            \r\n            // Note: We're only passing the scene and camera, not the renderer\r\n            // This avoids the issues with trying to call render() from the RenderSystem\r\n            this.registeredSystems.renderSystem = new RenderSystem(world, scene, camera);\r\n            world.registerSystem(this.registeredSystems.renderSystem);\r\n            \r\n            // 7. Register the CollisionSystem\r\n            console.log(\"[COMBAT] Registering CollisionSystem with the world...\");\r\n            this.registeredSystems.collisionSystem = new CollisionSystem(world);\r\n            world.registerSystem(this.registeredSystems.collisionSystem);\r\n            console.log(\"[COMBAT] CollisionSystem registered\");\r\n            \r\n            // 8. Register the VisualEffectsSystem\r\n            console.log(\"[COMBAT] Registering VisualEffectsSystem with the world...\");\r\n            this.registeredSystems.visualEffectsSystem = new VisualEffectsSystem(world);\r\n            world.registerSystem(this.registeredSystems.visualEffectsSystem);\r\n            console.log(\"[COMBAT] VisualEffectsSystem registered\");\r\n            \r\n            // 9. Register the ExplosionHandler for combat explosion effects\r\n            console.log(\"[COMBAT] Registering ExplosionHandler with the world...\");\r\n            this.registeredSystems.explosionHandler = new ExplosionHandler(world);\r\n            world.registerSystem(this.registeredSystems.explosionHandler);\r\n            console.log(\"[COMBAT] ExplosionHandler registered\");\r\n            \r\n            console.log(\"[COMBAT] All combat systems registered successfully\");\r\n            \r\n            return this.registeredSystems;\r\n        } catch (error) {\r\n            console.error(\"[COMBAT] Error during system registration:\", error);\r\n            console.error(\"[COMBAT] Stack trace:\", error.stack);\r\n            throw error;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Get a specific system by name\r\n     */\r\n    getSystem(systemName) {\r\n        return this.registeredSystems[systemName];\r\n    }\r\n\r\n    /**\r\n     * Get all registered systems\r\n     */\r\n    getAllSystems() {\r\n        return this.registeredSystems;\r\n    }\r\n\r\n    /**\r\n     * Enable or disable all systems\r\n     */\r\n    setSystemsEnabled(enabled) {\r\n        // Enable/disable ECS systems\r\n        const systems = ['enemySystem', 'combatSystem'];\r\n        \r\n        for (const systemName of systems) {\r\n            const system = this.registeredSystems[systemName];\r\n            if (!system) continue;\r\n            \r\n            if (typeof system.setEnabled === 'function') {\r\n                system.setEnabled(enabled);\r\n            } else {\r\n                system.enabled = enabled;\r\n            }\r\n        }\r\n        \r\n        console.log(`Combat systems ${enabled ? 'enabled' : 'disabled'}`);\r\n    }\r\n\r\n    /**\r\n     * Import and register a system dynamically\r\n     * @param {string} path The path to the system module\r\n     * @param {string} className The name of the system class\r\n     * @param {Object} world The ECS world\r\n     * @param {Object} scene The scene (optional)\r\n     * @returns {Object} The system instance\r\n     */\r\n    async importAndRegisterSystem(path, className, world, scene = null) {\r\n        try {\r\n            // Add vite-ignore to allow dynamic imports\r\n            // @ts-ignore\r\n            const module = await import(/* @vite-ignore */ path);\r\n            if (!module[className]) {\r\n                console.error(`[COMBAT] System class ${className} not found in module ${path}`);\r\n                return null;\r\n            }\r\n            \r\n            const SystemClass = module[className];\r\n            // Pass world and scene to systems that might need them for rendering or context\r\n            let system;\r\n            if (className === 'TrailSystem' || className === 'VisualEffectsSystem' || className === 'RenderSystem') {\r\n                 // These systems might specifically need the scene\r\n                system = new SystemClass(world, scene);\r\n            } else {\r\n                system = new SystemClass(world);\r\n            }\r\n            \r\n            // Register the system\r\n            world.registerSystem(system);\r\n            \r\n            // Store reference\r\n            this.registeredSystems[className.toLowerCase()] = system;\r\n            \r\n            return system;\r\n        } catch (error) {\r\n            console.error(`[COMBAT] Error importing system ${className} from ${path}:`, error);\r\n            return null;\r\n        }\r\n    }\r\n}","/**\r\n * Events Module - Handles all cross-module event subscriptions and bridges\r\n * \r\n * This module contains all MessageBus interactions, event subscriptions,\r\n * and cross-system communication logic.\r\n */\r\n\r\nexport class EventManager {\r\n    constructor() {\r\n        this.subscriptions = [];\r\n    }\r\n\r\n    /**\r\n     * Set up all event subscriptions and message bus interactions\r\n     */\r\n    setupEventHandlers(world, playerEntity) {\r\n        if (!world || !world.messageBus) {\r\n            console.warn(\"[EVENTS] No world or messageBus available for event setup\");\r\n            return;\r\n        }\r\n\r\n        // Subscribe to transform updates to refresh spatial hash\r\n        const transformSubscription = world.messageBus.subscribe('transform.updated', (msg) => {\r\n            const entity = msg.data && msg.data.entity;\r\n            if (entity && world.onEntityTransformUpdated) {\r\n                world.onEntityTransformUpdated(entity);\r\n            }\r\n        });\r\n        this.subscriptions.push(transformSubscription);\r\n\r\n        // Subscribe to player creation events if playerEntity is provided\r\n        if (playerEntity) {\r\n            const playerCreatedSubscription = world.messageBus.subscribe('player.created', (msg) => {\r\n                console.log(\"[EVENTS] Player created event received:\", msg.data);\r\n            });\r\n            this.subscriptions.push(playerCreatedSubscription);\r\n        }\r\n\r\n        console.log(\"[EVENTS] Event handlers set up successfully\");\r\n    }\r\n\r\n    /**\r\n     * Publish an event about player entity creation\r\n     */\r\n    publishPlayerCreated(world, playerEntity) {\r\n        if (world && world.messageBus && playerEntity) {\r\n            world.messageBus.publish('player.created', { entity: playerEntity });\r\n            console.log(\"[EVENTS] Published player.created event\");\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Publish an event about enemy destruction\r\n     */\r\n    publishEnemyDestroyed(world, entityId, source, position) {\r\n        if (world && world.messageBus) {\r\n            world.messageBus.publish('enemy.destroyed', {\r\n                entityId: entityId,\r\n                source: source,\r\n                position: position ? position.clone() : null\r\n            });\r\n            console.log(`[EVENTS] Published enemy.destroyed event for entity ${entityId}`);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Notify EnemySystem directly about enemy destruction\r\n     */\r\n    notifyEnemySystemDestruction(enemy, reason = 'projectile') {\r\n        if (window.game && window.game.ecsWorld && window.game.ecsWorld.enemySystem) {\r\n            console.log(`[EVENTS] Notifying EnemySystem directly about enemy ${enemy.id} destruction`);\r\n            try {\r\n                const enemySystem = window.game.ecsWorld.enemySystem;\r\n                if (typeof enemySystem.handleEntityDestroyed === 'function') {\r\n                    enemySystem.handleEntityDestroyed({\r\n                        entity: enemy,\r\n                        reason: reason\r\n                    });\r\n                }\r\n            } catch (syncError) {\r\n                console.error(\"[EVENTS] Error syncing with EnemySystem:\", syncError);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Clean up all event subscriptions\r\n     */\r\n    cleanup() {\r\n        for (const subscription of this.subscriptions) {\r\n            if (subscription && typeof subscription.unsubscribe === 'function') {\r\n                subscription.unsubscribe();\r\n            }\r\n        }\r\n        this.subscriptions = [];\r\n        console.log(\"[EVENTS] Event subscriptions cleaned up\");\r\n    }\r\n\r\n    /**\r\n     * Set up general game event handlers\r\n     */\r\n    setupGameEventHandlers() {\r\n        // Set up any game-wide event handlers here\r\n        // This can be extended as needed for cross-module communication\r\n        console.log(\"[EVENTS] Game event handlers set up\");\r\n    }\r\n\r\n    /**\r\n     * Publish a general combat event\r\n     */\r\n    publishCombatEvent(world, eventType, data) {\r\n        if (world && world.messageBus) {\r\n            world.messageBus.publish(`combat.${eventType}`, data);\r\n            console.log(`[EVENTS] Published combat.${eventType} event`);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Subscribe to a specific event type\r\n     */\r\n    subscribe(world, eventType, handler) {\r\n        if (world && world.messageBus) {\r\n            const subscription = world.messageBus.subscribe(eventType, handler);\r\n            this.subscriptions.push(subscription);\r\n            return subscription;\r\n        }\r\n        return null;\r\n    }\r\n\r\n    /**\r\n     * Unsubscribe from a specific subscription\r\n     */\r\n    unsubscribe(subscription) {\r\n        if (subscription && typeof subscription.unsubscribe === 'function') {\r\n            subscription.unsubscribe();\r\n            const index = this.subscriptions.indexOf(subscription);\r\n            if (index > -1) {\r\n                this.subscriptions.splice(index, 1);\r\n            }\r\n        }\r\n    }\r\n}","/**\r\n * Explosion Effects Module\r\n * \r\n * Handles explosion visual effects including instant tracers and pooled explosions\r\n */\r\n\r\nimport * as THREE from 'three';\r\n\r\nexport class ExplosionEffects {\r\n    constructor() {\r\n        this.activeTracers = [];\r\n    }\r\n\r\n    /**\r\n     * Create an explosion effect at the given position\r\n     * @param {THREE.Vector3} position Position for the explosion\r\n     * @param {number} duration Duration of the explosion in milliseconds\r\n     * @param {boolean} isVisible Whether the explosion should be visible\r\n     * @param {Object} poolManager Pool manager for getting explosion objects\r\n     * @param {Function} addToScene Function to add objects to scene\r\n     */\r\n    createExplosionEffect(position, duration = 1000, isVisible = true, poolManager = null, addToScene = null) {\r\n        try {\r\n            let explosion = null;\r\n            \r\n            // Try to get explosion from poolManager\r\n            if (poolManager && poolManager.getExplosion) {\r\n                explosion = poolManager.getExplosion(position, duration);\r\n            }\r\n            \r\n            // If no explosion from pool, create a simple one\r\n            if (!explosion) {\r\n                // Create a simple explosion mesh\r\n                const geometry = new THREE.SphereGeometry(30, 16, 16);\r\n                const material = new THREE.MeshBasicMaterial({\r\n                    color: 0xff6600,\r\n                    transparent: true,\r\n                    opacity: 0.9,\r\n                    emissive: 0xff3300,\r\n                    emissiveIntensity: 2,\r\n                    blending: THREE.AdditiveBlending\r\n                });\r\n                \r\n                explosion = new THREE.Mesh(geometry, material);\r\n                explosion.position.copy(position);\r\n                \r\n                // Add to scene if function provided\r\n                if (addToScene) {\r\n                    addToScene(explosion);\r\n                } else if (window.game && window.game.scene) {\r\n                    window.game.scene.add(explosion);\r\n                }\r\n                \r\n                // Animate the explosion\r\n                const startTime = Date.now();\r\n                const animate = () => {\r\n                    const elapsed = Date.now() - startTime;\r\n                    const progress = elapsed / duration;\r\n                    \r\n                    if (progress >= 1 || !explosion.parent) {\r\n                        // Remove explosion\r\n                        if (explosion.parent) {\r\n                            explosion.parent.remove(explosion);\r\n                        }\r\n                        geometry.dispose();\r\n                        material.dispose();\r\n                        return;\r\n                    }\r\n                    \r\n                    // Expand and fade\r\n                    const expansionScale = 1 + progress * 3;\r\n                    explosion.scale.setScalar(expansionScale);\r\n                    material.opacity = 0.9 * (1 - progress);\r\n                    \r\n                    requestAnimationFrame(animate);\r\n                };\r\n                \r\n                animate();\r\n            }\r\n            \r\n            // Play explosion sound\r\n            if (window.game && window.game.audio) {\r\n                window.game.audio.playSound('boink');\r\n            }\r\n            \r\n            return explosion;\r\n        } catch (error) {\r\n            console.error(\"Error creating explosion effect:\", error);\r\n            return null;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Create an instant plasma beam with hot glow\r\n     * @param {THREE.Vector3} startPos Starting position of the beam\r\n     * @param {THREE.Vector3} endPos End position of the beam (hit point or max range)\r\n     * @param {boolean} isHit Whether this beam hit a target\r\n     * @param {number} fadeTime Time in seconds for the beam to fade\r\n     * @param {Function} addToScene Function to add objects to scene\r\n     */\r\n    createInstantTracer(startPos, endPos, isHit = false, fadeTime = 0.5, addToScene = null) {\r\n        const distance = startPos.distanceTo(endPos);\r\n        \r\n        // Create multiple cylinders for a layered plasma effect\r\n        const beamGroup = new THREE.Group();\r\n        \r\n        // Core beam - bright white/yellow hot plasma\r\n        const coreGeometry = new THREE.CylinderGeometry(1.5, 1.5, distance, 12);\r\n        const coreMaterial = new THREE.MeshBasicMaterial({\r\n            color: 0xffffaa, // Hot yellow-white\r\n            transparent: true,\r\n            opacity: 1.0,\r\n            blending: THREE.AdditiveBlending\r\n        });\r\n        const coreMesh = new THREE.Mesh(coreGeometry, coreMaterial);\r\n        \r\n        // Inner glow - orange-white plasma\r\n        const innerGlowGeometry = new THREE.CylinderGeometry(3, 3, distance, 8);\r\n        const innerGlowMaterial = new THREE.MeshBasicMaterial({\r\n            color: isHit ? 0xffaa00 : 0xff8800, // Orange for hits, red-orange for misses\r\n            transparent: true,\r\n            opacity: 0.6,\r\n            blending: THREE.AdditiveBlending\r\n        });\r\n        const innerGlowMesh = new THREE.Mesh(innerGlowGeometry, innerGlowMaterial);\r\n        \r\n        // Outer glow - cooler blue-cyan edge\r\n        const outerGlowGeometry = new THREE.CylinderGeometry(5, 5, distance, 6);\r\n        const outerGlowMaterial = new THREE.MeshBasicMaterial({\r\n            color: isHit ? 0x00ffff : 0x0088ff, // Cyan for hits, blue for misses\r\n            transparent: true,\r\n            opacity: 0.3,\r\n            blending: THREE.AdditiveBlending\r\n        });\r\n        const outerGlowMesh = new THREE.Mesh(outerGlowGeometry, outerGlowMaterial);\r\n        \r\n        // Add all layers to the group\r\n        beamGroup.add(coreMesh);\r\n        beamGroup.add(innerGlowMesh);\r\n        beamGroup.add(outerGlowMesh);\r\n        \r\n        // Position and orient the entire beam group\r\n        const midpoint = new THREE.Vector3().addVectors(startPos, endPos).multiplyScalar(0.5);\r\n        beamGroup.position.copy(midpoint);\r\n        \r\n        // Orient the cylinders along the beam direction\r\n        const direction = new THREE.Vector3().subVectors(endPos, startPos).normalize();\r\n        const quaternion = new THREE.Quaternion();\r\n        quaternion.setFromUnitVectors(new THREE.Vector3(0, 1, 0), direction);\r\n        beamGroup.quaternion.copy(quaternion);\r\n        \r\n        if (addToScene) {\r\n            addToScene(beamGroup);\r\n        }\r\n        \r\n        // Store beam data for progressive fade animation\r\n        beamGroup.userData = {\r\n            startTime: performance.now(),\r\n            fadeTime: fadeTime * 1000,\r\n            beamLength: distance,\r\n            startPos: startPos.clone(),\r\n            endPos: endPos.clone(),\r\n            direction: direction.clone(),\r\n            coreMesh: coreMesh,\r\n            innerGlowMesh: innerGlowMesh,\r\n            outerGlowMesh: outerGlowMesh,\r\n            initialCoreOpacity: 1.0,\r\n            initialInnerOpacity: 0.6,\r\n            initialOuterOpacity: 0.3,\r\n            isDissolving: false\r\n        };\r\n        \r\n        // Add to active tracers list for update loop\r\n        this.activeTracers.push(beamGroup);\r\n        \r\n        return beamGroup;\r\n    }\r\n\r\n    /**\r\n     * Update active tracer beams - fade them out from start to end\r\n     * @param {number} deltaTime Time since last update\r\n     * @param {Function} removeFromScene Function to remove objects from scene\r\n     */\r\n    updateTracers(deltaTime, removeFromScene = null) {\r\n        if (!this.activeTracers || this.activeTracers.length === 0) return;\r\n        \r\n        const currentTime = performance.now();\r\n        const tracersToRemove = [];\r\n        \r\n        for (let i = this.activeTracers.length - 1; i >= 0; i--) {\r\n            const beamGroup = this.activeTracers[i];\r\n            const userData = beamGroup.userData;\r\n            \r\n            if (!userData) continue;\r\n            \r\n            const elapsed = currentTime - userData.startTime;\r\n            const fadeProgress = Math.min(elapsed / userData.fadeTime, 1.0);\r\n            \r\n            if (fadeProgress >= 1.0) {\r\n                // Remove entire beam group\r\n                if (removeFromScene) {\r\n                    removeFromScene(beamGroup);\r\n                }\r\n                tracersToRemove.push(i);\r\n            } else {\r\n                // Progressive dissolve from start to end\r\n                // The beam shortens from the start point toward the end point\r\n                const dissolveDistance = userData.beamLength * fadeProgress;\r\n                \r\n                // Calculate new start position (moves toward end as it dissolves)\r\n                const newStartOffset = userData.direction.clone().multiplyScalar(dissolveDistance);\r\n                const newStartPos = userData.startPos.clone().add(newStartOffset);\r\n                \r\n                // Calculate new beam length\r\n                const newLength = userData.beamLength * (1.0 - fadeProgress);\r\n                \r\n                if (newLength > 0.1) {\r\n                    // Update beam geometry to be shorter\r\n                    // We need to recreate the cylinders with new height\r\n                    userData.coreMesh.geometry.dispose();\r\n                    userData.innerGlowMesh.geometry.dispose();\r\n                    userData.outerGlowMesh.geometry.dispose();\r\n                    \r\n                    userData.coreMesh.geometry = new THREE.CylinderGeometry(1.5, 1.5, newLength, 12);\r\n                    userData.innerGlowMesh.geometry = new THREE.CylinderGeometry(3, 3, newLength, 8);\r\n                    userData.outerGlowMesh.geometry = new THREE.CylinderGeometry(5, 5, newLength, 6);\r\n                    \r\n                    // Update position to new midpoint\r\n                    const newMidpoint = new THREE.Vector3().addVectors(newStartPos, userData.endPos).multiplyScalar(0.5);\r\n                    beamGroup.position.copy(newMidpoint);\r\n                    \r\n                    // Also fade opacity slightly as it dissolves\r\n                    const opacityFactor = Math.pow(1.0 - fadeProgress, 0.3); // Slower opacity fade\r\n                    userData.coreMesh.material.opacity = userData.initialCoreOpacity * opacityFactor;\r\n                    userData.innerGlowMesh.material.opacity = userData.initialInnerOpacity * opacityFactor;\r\n                    userData.outerGlowMesh.material.opacity = userData.initialOuterOpacity * opacityFactor;\r\n                }\r\n            }\r\n        }\r\n        \r\n        // Remove completed tracers from the array\r\n        for (const index of tracersToRemove) {\r\n            this.activeTracers.splice(index, 1);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Clean up explosion effects resources\r\n     */\r\n    dispose() {\r\n        this.activeTracers = [];\r\n    }\r\n}","/**\r\n * Material Manager Module\r\n * \r\n * Handles initialization and management of combat effect materials\r\n */\r\n\r\nimport * as THREE from 'three';\r\n\r\nexport class MaterialManager {\r\n    constructor(scene) {\r\n        this.scene = scene;\r\n        this.initializeTemplateMaterials();\r\n    }\r\n\r\n    /**\r\n     * Initialize template materials to prevent shader compilation stutter during first fire\r\n     */\r\n    initializeTemplateMaterials() {\r\n        console.log(\"Initializing template materials for combat effects\");\r\n        \r\n        // Template for projectile material (MeshStandardMaterial) - Red Laser Bolt\r\n        this.projectileMaterial = new THREE.MeshStandardMaterial({\r\n            color: 0xff0000,\r\n            emissive: 0xff0000,\r\n            emissiveIntensity: 10, // Vibrant laser\r\n            metalness: 0.5,\r\n            roughness: 0.5\r\n        });\r\n        \r\n        // Template for projectile glow material (MeshBasicMaterial) - Red Glow\r\n        this.projectileGlowMaterial = new THREE.MeshBasicMaterial({\r\n            color: 0xff0000,\r\n            transparent: true,\r\n            opacity: 0.5, // Softer glow\r\n            blending: THREE.AdditiveBlending\r\n        });\r\n        \r\n        // Template for trail particle material (MeshBasicMaterial) - Red (Though complex trail is removed)\r\n        this.trailParticleMaterial = new THREE.MeshBasicMaterial({\r\n            color: 0xff0000,\r\n            transparent: true,\r\n            opacity: 0.9,\r\n            blending: THREE.AdditiveBlending\r\n        });\r\n        \r\n        // Template for muzzle flash material (MeshBasicMaterial) - Red Muzzle Flash\r\n        this.muzzleFlashMaterial = new THREE.MeshBasicMaterial({\r\n            color: 0xff0000,\r\n            transparent: true,\r\n            opacity: 0.8, // Brighter flash\r\n            blending: THREE.AdditiveBlending,\r\n            side: THREE.DoubleSide,\r\n            depthWrite: false,\r\n            wireframe: false\r\n        });\r\n        \r\n        // Template for tracer line material (LineBasicMaterial) - Red Aiming Line\r\n        this.tracerLineMaterial = new THREE.LineBasicMaterial({\r\n            color: 0xff0000,\r\n            transparent: true,\r\n            opacity: 0.8, // More visible aiming line\r\n            blending: THREE.AdditiveBlending\r\n        });\r\n        \r\n        // Template material for light-halo meshes (basic unlit glow)\r\n        this.pointLightMaterial = new THREE.MeshBasicMaterial({\r\n            color: 0xff0000,\r\n            transparent: true,\r\n            opacity: 0.9,\r\n            blending: THREE.AdditiveBlending,\r\n            depthWrite: false\r\n        });\r\n        \r\n        // Template for explosion particles - Red/Orange Impact\r\n        this.explosionParticleMaterial = new THREE.PointsMaterial({\r\n            color: 0xff3300, // Red-orange for impact\r\n            size: 15, // Slightly larger impact particles\r\n            transparent: true,\r\n            opacity: 1,\r\n            blending: THREE.AdditiveBlending\r\n        });\r\n        \r\n        // Force material compilation by creating a small invisible mesh\r\n        this.precompileShaders();\r\n    }\r\n\r\n    /**\r\n     * Pre-compile shaders to prevent stutter during combat\r\n     */\r\n    precompileShaders() {\r\n        // Force material compilation by creating a small invisible mesh\r\n        // This ensures shaders are compiled immediately rather than at first fire\r\n        const dummyGeometry = new THREE.BoxGeometry(0.1, 0.1, 0.1);\r\n        const sphereGeometry = new THREE.SphereGeometry(0.1, 8, 8);\r\n        const cylinderGeometry = new THREE.CylinderGeometry(0.1, 0.2, 1, 8, 1);\r\n        const pointsPositions = new Float32Array(30); // 10 points x 3 coordinates\r\n        for (let i = 0; i < 30; i++) {\r\n            pointsPositions[i] = Math.random() - 0.5;\r\n        }\r\n        const pointsGeometry = new THREE.BufferGeometry();\r\n        pointsGeometry.setAttribute('position', new THREE.BufferAttribute(pointsPositions, 3));\r\n        \r\n        // Create dummy objects using all materials that will be used in projectiles\r\n        // IMPORTANT: Use the original material instances, not clones, for pre-compilation.\r\n        const dummyProjectile = new THREE.Mesh(sphereGeometry, this.projectileMaterial);\r\n        const dummyGlow = new THREE.Mesh(sphereGeometry, this.projectileGlowMaterial);\r\n        const dummyTrail = new THREE.Mesh(sphereGeometry, this.trailParticleMaterial);\r\n        const dummyFlash = new THREE.Mesh(cylinderGeometry, this.muzzleFlashMaterial);\r\n        const dummyTracer = new THREE.Line(\r\n            new THREE.BufferGeometry().setFromPoints([\r\n                new THREE.Vector3(0, 0, 0),\r\n                new THREE.Vector3(0, 0, 1)\r\n            ]),\r\n            this.tracerLineMaterial\r\n        );\r\n        const dummyExplosion = new THREE.Points(pointsGeometry, this.explosionParticleMaterial);\r\n        \r\n        // Create a dummy trail system with multiple particles\r\n        const dummyTrailContainer = new THREE.Object3D();\r\n        for (let i = 0; i < 5; i++) {\r\n            const trailParticle = new THREE.Mesh(sphereGeometry, this.trailParticleMaterial.clone());\r\n            trailParticle.position.z = -i * 0.2;\r\n            dummyTrailContainer.add(trailParticle);\r\n        }\r\n        \r\n        // Create a temporary scene for shader compilation\r\n        const tempScene = new THREE.Scene();\r\n        \r\n        // Add all dummy objects to the temporary scene\r\n        tempScene.add(dummyProjectile);\r\n        tempScene.add(dummyGlow);\r\n        tempScene.add(dummyTrail);\r\n        tempScene.add(dummyFlash);\r\n        tempScene.add(dummyTracer);\r\n        tempScene.add(dummyTrailContainer);\r\n        tempScene.add(dummyExplosion);\r\n        \r\n        // Add to main scene temporarily for visibility checking via renderer facade\r\n        const addToScene = this._getAddToSceneFunction();\r\n        const removeFromScene = this._getRemoveFromSceneFunction();\r\n        \r\n        addToScene(dummyProjectile);\r\n        addToScene(dummyGlow);\r\n        addToScene(dummyTrail);\r\n        addToScene(dummyFlash);\r\n        addToScene(dummyTracer);\r\n        addToScene(dummyTrailContainer);\r\n        addToScene(dummyExplosion);\r\n        \r\n        // Force shader compilation using renderer.compile if available\r\n        if (window.renderer) {\r\n            console.log(\"Forcing shader compilation with renderer.compile()\");\r\n            window.renderer.compile(tempScene, this.scene.camera || { isCamera: true, matrixWorldInverse: new THREE.Matrix4() });\r\n            window.renderer.compile(this.scene, this.scene.camera || { isCamera: true, matrixWorldInverse: new THREE.Matrix4() });\r\n        } else if (window.game && window.game.renderer && window.game.renderer.renderer) {\r\n            console.log(\"Forcing shader compilation with game.renderer.renderer.compile()\");\r\n            window.game.renderer.renderer.compile(tempScene, this.scene.camera || window.game.camera || { isCamera: true, matrixWorldInverse: new THREE.Matrix4() });\r\n            window.game.renderer.renderer.compile(this.scene, this.scene.camera || window.game.camera || { isCamera: true, matrixWorldInverse: new THREE.Matrix4() });\r\n        } else {\r\n            console.warn(\"No renderer available for shader pre-compilation\");\r\n        }\r\n        \r\n        // Keep dummy objects in scene longer to ensure compilation completes\r\n        setTimeout(() => {\r\n            // Remove from scene after shader compilation is complete via renderer facade\r\n            removeFromScene(dummyProjectile);\r\n            removeFromScene(dummyGlow);\r\n            removeFromScene(dummyTrail);\r\n            removeFromScene(dummyFlash);\r\n            removeFromScene(dummyTracer);\r\n            removeFromScene(dummyTrailContainer);\r\n            removeFromScene(dummyExplosion);\r\n            \r\n            // Clean up temporary objects\r\n            dummyGeometry.dispose();\r\n            sphereGeometry.dispose();\r\n            cylinderGeometry.dispose();\r\n            pointsGeometry.dispose();\r\n            \r\n            // Clean up trail particles\r\n            dummyTrailContainer.children.forEach(child => {\r\n                if (child.geometry) child.geometry.dispose();\r\n                if (child.material) child.material.dispose(); // Material here is a clone, original is on this.trailParticleMaterial\r\n            });\r\n            \r\n            console.log(\"Template materials initialized and dummy objects removed\");\r\n        }, 500); // Increased timeout to 500ms to ensure shader compilation completes\r\n    }\r\n\r\n    /**\r\n     * Get material by type\r\n     */\r\n    getMaterial(type) {\r\n        switch (type) {\r\n            case 'projectile': return this.projectileMaterial;\r\n            case 'projectileGlow': return this.projectileGlowMaterial;\r\n            case 'trailParticle': return this.trailParticleMaterial;\r\n            case 'muzzleFlash': return this.muzzleFlashMaterial;\r\n            case 'tracerLine': return this.tracerLineMaterial;\r\n            case 'pointLight': return this.pointLightMaterial;\r\n            case 'explosionParticle': return this.explosionParticleMaterial;\r\n            default: return null;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Helper to get add to scene function\r\n     */\r\n    _getAddToSceneFunction() {\r\n        const renderer = window.game && window.game.renderer ? window.game.renderer : null;\r\n        if (renderer && typeof renderer._withGuard === 'function') {\r\n            return (object) => renderer._withGuard(() => renderer.add(object));\r\n        } else if (this.scene && typeof this.scene.add === 'function') {\r\n            return (object) => this.scene.add(object);\r\n        }\r\n        return () => {};\r\n    }\r\n\r\n    /**\r\n     * Helper to get remove from scene function\r\n     */\r\n    _getRemoveFromSceneFunction() {\r\n        const renderer = window.game && window.game.renderer ? window.game.renderer : null;\r\n        if (renderer && typeof renderer._withGuard === 'function') {\r\n            return (object) => renderer._withGuard(() => this.scene.remove(object));\r\n        } else if (this.scene && typeof this.scene.remove === 'function') {\r\n            return (object) => this.scene.remove(object);\r\n        }\r\n        return () => {};\r\n    }\r\n\r\n    /**\r\n     * Clean up material resources\r\n     */\r\n    dispose() {\r\n        // Dispose materials\r\n        if (this.projectileMaterial) this.projectileMaterial.dispose();\r\n        if (this.projectileGlowMaterial) this.projectileGlowMaterial.dispose();\r\n        if (this.trailParticleMaterial) this.trailParticleMaterial.dispose();\r\n        if (this.muzzleFlashMaterial) this.muzzleFlashMaterial.dispose();\r\n        if (this.tracerLineMaterial) this.tracerLineMaterial.dispose();\r\n        if (this.pointLightMaterial) this.pointLightMaterial.dispose();\r\n        if (this.explosionParticleMaterial) this.explosionParticleMaterial.dispose();\r\n\r\n        console.log(\"Material resources disposed\");\r\n    }\r\n}","/**\r\n * Geometry Manager Module\r\n * \r\n * Handles pre-creation and management of geometries for combat effects\r\n */\r\n\r\nimport * as THREE from 'three';\r\n\r\nexport class GeometryManager {\r\n    constructor() {\r\n        this.precreateGeometries();\r\n    }\r\n\r\n    /**\r\n     * Pre-create geometries that will be reused across projectiles and effects\r\n     * This prevents geometry creation during combat which can cause stutters\r\n     */\r\n    precreateGeometries() {\r\n        console.log(\"Pre-creating geometries for combat effects\");\r\n        \r\n        // Create geometries and store them on window.game for global access\r\n        if (!window.game) window.game = {};\r\n        \r\n        // Projectile geometries - Changed to a thin cylinder for laser bolt\r\n        window.game.projectileGeometry = new THREE.CylinderGeometry(0.15, 0.15, 10, 8); // Thin, 10 units long cylinder\r\n        window.game.projectileGlowGeometry = new THREE.SphereGeometry(0.8, 12, 12); // Glow radius around the bolt\r\n        \r\n        // Pre-create standard muzzle flash geometry\r\n        window.game.muzzleFlashGeometry = new THREE.CylinderGeometry(0.5, 2, 15, 12, 1, true);\r\n        window.game.muzzleFlashGeometry.rotateX(Math.PI / 2);\r\n        window.game.muzzleFlashGeometry.translate(0, 0, 15 / 2);\r\n        \r\n        // Pre-create trail particle geometries with different sizes\r\n        window.game.trailParticleGeometries = [];\r\n        const numPoints = 20; // Same as in addProjectileTrail\r\n        for (let i = 0; i < numPoints; i++) {\r\n            const ratio = i / numPoints;\r\n            const size = 0.5 * (1 - ratio); // These might be unused or repurposed for simple impact sparks\r\n            window.game.trailParticleGeometries[i] = new THREE.SphereGeometry(size, 8, 8);\r\n        }\r\n        \r\n        // Pre-create line geometry for tracers\r\n        window.game.tracerGeometry = new THREE.BufferGeometry();\r\n        const points = [0, 0, 0, 0, 0, 1]; // Will be updated at runtime\r\n        window.game.tracerGeometry.setAttribute('position', new THREE.Float32BufferAttribute(points, 3));\r\n        \r\n        console.log(\"Combat geometries pre-created successfully\");\r\n    }\r\n\r\n    /**\r\n     * Store references to template materials on window.game\r\n     * @param {Object} materialManager - The material manager instance\r\n     */\r\n    storeMaterialReferences(materialManager) {\r\n        // Store references to template materials (which should now be pre-warmed)\r\n        // These materials are created and warmed in MaterialManager\r\n        window.game.projectileMaterial = materialManager.projectileMaterial;\r\n        window.game.projectileGlowMaterial = materialManager.projectileGlowMaterial;\r\n        window.game.trailParticleMaterial = materialManager.trailParticleMaterial; // Will be red\r\n        window.game.muzzleFlashMaterial = materialManager.muzzleFlashMaterial;\r\n        window.game.tracerLineMaterial = materialManager.tracerLineMaterial;\r\n        window.game.explosionParticleMaterial = materialManager.explosionParticleMaterial; // Added for consistency\r\n    }\r\n\r\n    /**\r\n     * Clean up geometry resources\r\n     */\r\n    dispose() {\r\n        if (window.game) {\r\n            if (window.game.projectileGeometry) window.game.projectileGeometry.dispose();\r\n            if (window.game.projectileGlowGeometry) window.game.projectileGlowGeometry.dispose();\r\n            if (window.game.muzzleFlashGeometry) window.game.muzzleFlashGeometry.dispose();\r\n            if (window.game.trailParticleGeometries) {\r\n                window.game.trailParticleGeometries.forEach(geom => geom.dispose());\r\n            }\r\n            if (window.game.tracerGeometry) window.game.tracerGeometry.dispose();\r\n        }\r\n        console.log(\"Geometry resources disposed\");\r\n    }\r\n}","/**\r\n * Projectile Effects Module\r\n * \r\n * Handles muzzle flashes, trails, and aiming tracers for projectiles\r\n */\r\n\r\nimport * as THREE from 'three';\r\n\r\nexport class ProjectileEffects {\r\n    constructor() {\r\n        // No state needed - all effects are pooled\r\n    }\r\n\r\n    /**\r\n     * Create a laser burst effect that travels forward with the projectile\r\n     * @param {THREE.Vector3} position Position for the effect\r\n     * @param {THREE.Vector3} direction Direction the effect should travel\r\n     * @param {Object} poolManager Pool manager for getting muzzle flash objects\r\n     */\r\n    createMuzzleFlash(position, direction, poolManager) {\r\n        if (!poolManager) {\r\n            console.warn(\"No pool manager available for muzzle flash\");\r\n            return null;\r\n        }\r\n\r\n        // Get a muzzle flash from the pool\r\n        const muzzleFlash = poolManager.getMuzzleFlash();\r\n        \r\n        // Position and orient the flash\r\n        muzzleFlash.position.copy(position);\r\n        // Orient the flash to point away from the ship, along the direction of fire\r\n        const lookAtPosition = position.clone().add(direction.clone().normalize().multiplyScalar(10)); // Look 10 units along direction\r\n        muzzleFlash.lookAt(lookAtPosition);\r\n        \r\n        // Store reference to initial position and direction for animation\r\n        muzzleFlash.userData.initialPosition = position.clone();\r\n        muzzleFlash.userData.direction = direction.clone();\r\n        \r\n        // Set up the flash light\r\n        const flashLight = muzzleFlash.userData.flashLight;\r\n        if (flashLight) {\r\n            flashLight.position.copy(position);\r\n            flashLight.intensity = 200;\r\n        }\r\n        \r\n        // The pool manager will automatically handle animation and cleanup via its update method\r\n        // which checks the progress and releases back to the pool when complete\r\n        \r\n        return muzzleFlash;\r\n    }\r\n\r\n    /**\r\n     * Add a dynamic particle trail to a projectile (Simplified for Lasers)\r\n     * @param {THREE.Mesh} projectile The projectile mesh\r\n     * @param {THREE.Vector3} direction Direction of travel\r\n     * @param {Object} poolManager Pool manager for getting trail components\r\n     */\r\n    addProjectileTrail(projectile, direction, poolManager) {\r\n        // Parameters for a subtle, short trail\r\n        const numPoints = 4; // Number of particles in the trail\r\n        const trailLength = 4.0; // Total length of the trail (shorter than laser bolt length for subtlety)\r\n        const particleLifetime = 150; // milliseconds\r\n\r\n        if (!poolManager) {\r\n            console.warn(\"PoolManager not available for projectile trail.\");\r\n            return;\r\n        }\r\n\r\n        const trailContainer = poolManager.getTrailContainer();\r\n        if (!trailContainer) {\r\n            console.warn(\"Failed to get trail container from pool.\");\r\n            return;\r\n        }\r\n        projectile.add(trailContainer);\r\n\r\n        const trailParticles = [];\r\n        trailContainer.userData.particles = trailParticles; // Store for release by PoolManager if needed\r\n        trailContainer.userData.isTrailActive = true; // Flag for animation loop\r\n\r\n        for (let i = 0; i < numPoints; i++) {\r\n            const ratio = i / (numPoints -1); // Distribute particles along the trail length\r\n            const particle = poolManager.getTrailParticle(i % window.game.trailParticleGeometries.length); // Cycle through available geometries\r\n            \r\n            if (!particle) {\r\n                console.warn(`Failed to get trail particle ${i} from pool.`);\r\n                continue;\r\n            }\r\n\r\n            const offset = direction.clone().multiplyScalar(-ratio * trailLength - 2.0); // Start trail slightly behind the projectile tip\r\n            particle.position.copy(offset);\r\n            \r\n            particle.userData.creationTime = performance.now();\r\n            particle.userData.initialOpacity = particle.material.opacity; // Should be from pre-warmed red material\r\n            particle.userData.initialScale = particle.scale.x; // Assuming uniform scale\r\n            \r\n            trailContainer.add(particle);\r\n            trailParticles.push(particle);\r\n        }\r\n        \r\n        projectile.userData.trail = trailContainer; // For cleanup by PoolManager\r\n\r\n        const animateTrail = () => {\r\n            if (!projectile.parent || !trailContainer.userData.isTrailActive) {\r\n                // Projectile removed or trail explicitly deactivated, stop animation and ensure cleanup\r\n                trailContainer.userData.isTrailActive = false;\r\n                // Particles will be cleaned up by releaseProjectile -> releaseTrail if not already done\r\n                return;\r\n            }\r\n\r\n            for (let i = trailParticles.length - 1; i >= 0; i--) {\r\n                const particle = trailParticles[i];\r\n                const elapsed = performance.now() - particle.userData.creationTime;\r\n                const progress = Math.min(elapsed / particleLifetime, 1.0);\r\n\r\n                if (progress >= 1.0) {\r\n                    poolManager.releaseTrailParticle(particle);\r\n                    trailParticles.splice(i, 1);\r\n                    if (particle.parent) particle.parent.remove(particle); // Ensure removal from container\r\n                } else {\r\n                    particle.material.opacity = particle.userData.initialOpacity * (1 - progress);\r\n                    const currentScale = particle.userData.initialScale * (1 - progress);\r\n                    particle.scale.set(currentScale, currentScale, currentScale);\r\n                }\r\n            }\r\n\r\n            if (trailParticles.length === 0) {\r\n                trailContainer.userData.isTrailActive = false; // All particles expired\r\n                // The container itself will be released when the projectile is released.\r\n                return;\r\n            }\r\n            \r\n            requestAnimationFrame(animateTrail);\r\n        };\r\n        \r\n        animateTrail();\r\n    }\r\n\r\n    /**\r\n     * New method to visualize projectile trajectory\r\n     * @param {THREE.Vector3} startPosition Starting position of the aiming line\r\n     * @param {THREE.Vector3} direction Direction the line should point\r\n     * @param {number} distance Distance of the aiming line\r\n     * @param {Object} poolManager Pool manager for getting tracer objects\r\n     */\r\n    createAimingTracer(startPosition, direction, distance = 3000, poolManager) {\r\n        if (!poolManager) {\r\n            console.warn(\"No pool manager available for aiming tracer\");\r\n            return null;\r\n        }\r\n\r\n        // Get a tracer from the pool\r\n        const tracer = poolManager.getTracer();\r\n        \r\n        // Calculate end position\r\n        const endPosition = startPosition.clone().add(direction.clone().multiplyScalar(distance));\r\n        \r\n        // Update the positions in the geometry\r\n        const positions = tracer.geometry.attributes.position.array;\r\n        positions[0] = startPosition.x;\r\n        positions[1] = startPosition.y;\r\n        positions[2] = startPosition.z;\r\n        positions[3] = endPosition.x;\r\n        positions[4] = endPosition.y;\r\n        positions[5] = endPosition.z;\r\n        \r\n        // Mark the position attribute as needing update\r\n        tracer.geometry.attributes.position.needsUpdate = true;\r\n        \r\n        // The pool manager will automatically handle animation and cleanup\r\n        \r\n        return tracer;\r\n    }\r\n}","/**\r\n * Effects Module - Handles trail/instancing/vfx glue to rendering\r\n * \r\n * This module contains all visual effects logic including material initialization,\r\n * explosions, tracers, muzzle flashes, and particle effects.\r\n */\r\n\r\nimport * as THREE from 'three';\r\nimport { ExplosionEffects } from './effects/explosionEffects.js';\r\nimport { MaterialManager } from './effects/materialManager.js';\r\nimport { GeometryManager } from './effects/geometryManager.js';\r\nimport { ProjectileEffects } from './effects/projectileEffects.js';\r\n\r\nexport class EffectsManager {\r\n    constructor(scene) {\r\n        this.scene = scene;\r\n        \r\n        // Initialize sub-managers\r\n        this.materialManager = new MaterialManager(scene);\r\n        this.geometryManager = new GeometryManager();\r\n        this.explosionEffects = new ExplosionEffects();\r\n        this.projectileEffects = new ProjectileEffects();\r\n        \r\n        // Store material references on window.game\r\n        this.geometryManager.storeMaterialReferences(this.materialManager);\r\n    }\r\n\r\n\r\n    /**\r\n     * Create an explosion effect at the given position\r\n     * @param {THREE.Vector3} position Position for the explosion\r\n     * @param {number} duration Duration of the explosion in milliseconds\r\n     * @param {boolean} isVisible Whether the explosion should be visible\r\n     */\r\n    createExplosionEffect(position, duration = 1000, isVisible = true, poolManager = null) {\r\n        return this.explosionEffects.createExplosionEffect(position, duration, isVisible, poolManager, this._addToScene.bind(this));\r\n    }\r\n\r\n    /**\r\n     * Create an instant plasma beam with hot glow\r\n     * @param {THREE.Vector3} startPos Starting position of the beam\r\n     * @param {THREE.Vector3} endPos End position of the beam (hit point or max range)\r\n     * @param {boolean} isHit Whether this beam hit a target\r\n     * @param {number} fadeTime Time in seconds for the beam to fade\r\n     */\r\n    createInstantTracer(startPos, endPos, isHit = false, fadeTime = 0.5) {\r\n        return this.explosionEffects.createInstantTracer(startPos, endPos, isHit, fadeTime, this._addToScene.bind(this));\r\n    }\r\n\r\n    /**\r\n     * Update active tracer beams - fade them out from start to end\r\n     * @param {number} deltaTime Time since last update\r\n     */\r\n    updateTracers(deltaTime) {\r\n        this.explosionEffects.updateTracers(deltaTime, this._removeFromScene.bind(this));\r\n    }\r\n\r\n    /**\r\n     * Create a laser burst effect that travels forward with the projectile\r\n     * @param {THREE.Vector3} position Position for the effect\r\n     * @param {THREE.Vector3} direction Direction the effect should travel\r\n     */\r\n    createMuzzleFlash(position, direction, poolManager) {\r\n        return this.projectileEffects.createMuzzleFlash(position, direction, poolManager);\r\n    }\r\n\r\n    /**\r\n     * Add a dynamic particle trail to a projectile (Simplified for Lasers)\r\n     * @param {THREE.Mesh} projectile The projectile mesh\r\n     * @param {THREE.Vector3} direction Direction of travel\r\n     * @param {Object} poolManager Pool manager for getting trail components\r\n     */\r\n    addProjectileTrail(projectile, direction, poolManager) {\r\n        this.projectileEffects.addProjectileTrail(projectile, direction, poolManager);\r\n    }\r\n\r\n    /**\r\n     * New method to visualize projectile trajectory\r\n     */\r\n    createAimingTracer(startPosition, direction, distance = 3000, poolManager) {\r\n        return this.projectileEffects.createAimingTracer(startPosition, direction, distance, poolManager);\r\n    }\r\n\r\n    /**\r\n     * Get material by type\r\n     */\r\n    getMaterial(type) {\r\n        return this.materialManager.getMaterial(type);\r\n    }\r\n\r\n    // --- Renderer facade helpers to centralize scene mutations ---\r\n    _addToScene(object) {\r\n        const renderer = window.game && window.game.renderer ? window.game.renderer : null;\r\n        if (renderer && typeof renderer._withGuard === 'function') {\r\n            renderer._withGuard(() => renderer.add(object));\r\n        } else if (this.scene && typeof this.scene.add === 'function') {\r\n            // Fallback for safety; may warn in dev via guard wrapper\r\n            this.scene.add(object);\r\n        }\r\n    }\r\n\r\n    _removeFromScene(object) {\r\n        const renderer = window.game && window.game.renderer ? window.game.renderer : null;\r\n        if (renderer && typeof renderer._withGuard === 'function') {\r\n            renderer._withGuard(() => this.scene.remove(object));\r\n        } else if (this.scene && typeof this.scene.remove === 'function') {\r\n            // Fallback for safety\r\n            this.scene.remove(object);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Clean up all effects resources\r\n     */\r\n    dispose() {\r\n        // Dispose sub-managers\r\n        this.explosionEffects.dispose();\r\n        this.materialManager.dispose();\r\n        this.geometryManager.dispose();\r\n\r\n        console.log(\"Effects resources disposed\");\r\n    }\r\n}","/**\r\n * AI and Spawners Module - Handles enemy pool/spawner wiring\r\n * \r\n * This module contains all logic related to enemy system configuration,\r\n * AI behavior, spawning mechanics, and enemy lifecycle management.\r\n */\r\n\r\nexport class AISpawnerManager {\r\n    constructor() {\r\n        this.registeredEnemyIds = new Set();\r\n    }\r\n\r\n    /**\r\n     * Configure enemy system after world is set up\r\n     */\r\n    configureEnemySystem(enemySystem) {\r\n        if (!enemySystem) {\r\n            console.warn(\"[AI_SPAWNER] No enemy system provided for configuration\");\r\n            return;\r\n        }\r\n\r\n        // Force enemy verification after world is set up\r\n        if (typeof enemySystem.lifecycle?.validateEnemyReferences === 'function') {\r\n            enemySystem.lifecycle.validateEnemyReferences(enemySystem.enemies);\r\n        }\r\n        \r\n        // IMPORTANT: Ensure any lingering enemies over the limit are cleaned up\r\n        if (enemySystem.enemies && enemySystem.enemies.size > enemySystem.maxEnemies) {\r\n            console.warn(`[AI_SPAWNER] Found ${enemySystem.enemies.size} enemies exceeding limit of ${enemySystem.maxEnemies} during setup`);\r\n            if (typeof enemySystem.enforceEnemyLimit === 'function') {\r\n                enemySystem.enforceEnemyLimit();\r\n            }\r\n        }\r\n        \r\n        // Force enemy system to generate spawn points based on player position\r\n        if (enemySystem.spawner && typeof enemySystem.spawner.generateSpawnPoints === 'function') {\r\n            enemySystem.spawner.generateSpawnPoints();\r\n        }\r\n        \r\n        console.log(`[AI_SPAWNER] Configured enemy system: Max enemies ${enemySystem.maxEnemies || 'unknown'}`);\r\n    }\r\n\r\n    /**\r\n     * Register an enemy entity for synchronization with EnemySystem\r\n     * @param {string} enemyId ID of the enemy entity\r\n     */\r\n    registerEnemy(enemyId) {\r\n        // Add enemy to our tracking set\r\n        this.registeredEnemyIds.add(enemyId);\r\n        console.log(`AI_SPAWNER: Registered enemy ${enemyId} for tracking (total: ${this.registeredEnemyIds.size})`);\r\n    }\r\n\r\n    /**\r\n     * Unregister an enemy entity\r\n     * @param {string} enemyId ID of the enemy entity\r\n     */\r\n    unregisterEnemy(enemyId) {\r\n        if (this.registeredEnemyIds.has(enemyId)) {\r\n            this.registeredEnemyIds.delete(enemyId);\r\n            console.log(`AI_SPAWNER: Unregistered enemy ${enemyId} (remaining: ${this.registeredEnemyIds.size})`);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Handle enemy destruction with proper cleanup\r\n     * @param {Object} enemy The enemy entity\r\n     * @param {string} reason Reason for destruction\r\n     */\r\n    handleEnemyDestruction(enemy, reason = 'combat') {\r\n        if (!enemy) return;\r\n\r\n        console.log(`[AI_SPAWNER] Handling enemy ${enemy.id} destruction (reason: ${reason})`);\r\n\r\n        // Unregister from our tracking\r\n        this.unregisterEnemy(enemy.id);\r\n\r\n        // Use system-specific methods if available\r\n        if (window.game && window.game.ecsWorld && window.game.ecsWorld.enemySystem) {\r\n            const enemySystem = window.game.ecsWorld.enemySystem;\r\n            \r\n            // Try returnEnemyToPool first which properly handles cleanup\r\n            if (typeof enemySystem.returnEnemyToPool === 'function') {\r\n                console.log(`[AI_SPAWNER] Using EnemySystem.returnEnemyToPool for enemy ${enemy.id}`);\r\n                enemySystem.returnEnemyToPool(enemy);\r\n            }\r\n            \r\n            // Force validation of references in EnemySystem\r\n            if (typeof enemySystem.validateEnemyReferences === 'function') {\r\n                enemySystem.validateEnemyReferences();\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Get the count of registered enemies\r\n     */\r\n    getEnemyCount() {\r\n        return this.registeredEnemyIds.size;\r\n    }\r\n\r\n    /**\r\n     * Get all registered enemy IDs\r\n     */\r\n    getRegisteredEnemyIds() {\r\n        return Array.from(this.registeredEnemyIds);\r\n    }\r\n\r\n    /**\r\n     * Clear all registered enemies\r\n     */\r\n    clearAllEnemies() {\r\n        const enemyCount = this.registeredEnemyIds.size;\r\n        this.registeredEnemyIds.clear();\r\n        console.log(`[AI_SPAWNER] Cleared ${enemyCount} registered enemies`);\r\n    }\r\n\r\n    /**\r\n     * Set up spawner parameters\r\n     */\r\n    configureSpawner(spawnerConfig = {}) {\r\n        const defaultConfig = {\r\n            maxEnemies: 10,\r\n            spawnRate: 0.1,\r\n            spawnDistance: 1000,\r\n            despawnDistance: 2000\r\n        };\r\n\r\n        const config = { ...defaultConfig, ...spawnerConfig };\r\n        \r\n        console.log(`[AI_SPAWNER] Spawner configured with:`, config);\r\n        \r\n        return config;\r\n    }\r\n\r\n    /**\r\n     * Handle AI behavior updates\r\n     */\r\n    updateAI(deltaTime, playerPosition) {\r\n        // This can be extended to handle custom AI logic\r\n        // For now, it serves as a placeholder for AI-specific updates\r\n        \r\n        // Update any custom AI behaviors here\r\n        // Example: pathfinding, decision making, behavior trees, etc.\r\n        \r\n        // The actual AI logic is typically handled by the EnemySystem\r\n        // but this method can coordinate high-level AI decisions\r\n    }\r\n\r\n    /**\r\n     * Handle spawning logic\r\n     */\r\n    updateSpawning(deltaTime, playerPosition, enemySystem) {\r\n        if (!enemySystem) return;\r\n\r\n        // Check if we need to spawn more enemies\r\n        const currentEnemyCount = this.registeredEnemyIds.size;\r\n        const maxEnemies = enemySystem.maxEnemies || 10;\r\n\r\n        if (currentEnemyCount < maxEnemies) {\r\n            // Let the enemy system handle the actual spawning\r\n            // This is just monitoring and coordination\r\n            console.log(`[AI_SPAWNER] Current enemies: ${currentEnemyCount}/${maxEnemies}`);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Validate enemy states and clean up orphaned entities\r\n     */\r\n    validateEnemyStates(world) {\r\n        if (!world) return;\r\n\r\n        const orphanedIds = [];\r\n        \r\n        for (const enemyId of this.registeredEnemyIds) {\r\n            const entity = world.getEntity(enemyId);\r\n            if (!entity) {\r\n                orphanedIds.push(enemyId);\r\n            }\r\n        }\r\n\r\n        // Clean up orphaned IDs\r\n        for (const orphanedId of orphanedIds) {\r\n            console.log(`[AI_SPAWNER] Cleaning up orphaned enemy ID: ${orphanedId}`);\r\n            this.registeredEnemyIds.delete(orphanedId);\r\n        }\r\n\r\n        if (orphanedIds.length > 0) {\r\n            console.log(`[AI_SPAWNER] Cleaned up ${orphanedIds.length} orphaned enemy references`);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Emergency cleanup of all AI and spawner resources\r\n     */\r\n    emergencyCleanup() {\r\n        console.log(`[AI_SPAWNER] Emergency cleanup initiated for ${this.registeredEnemyIds.size} enemies`);\r\n        \r\n        // Force cleanup through enemy system if available\r\n        if (window.game && window.game.ecsWorld && window.game.ecsWorld.enemySystem) {\r\n            const enemySystem = window.game.ecsWorld.enemySystem;\r\n            \r\n            for (const enemyId of this.registeredEnemyIds) {\r\n                try {\r\n                    const entity = enemySystem.world?.getEntity(enemyId);\r\n                    if (entity && typeof enemySystem.returnEnemyToPool === 'function') {\r\n                        enemySystem.returnEnemyToPool(entity);\r\n                    }\r\n                } catch (error) {\r\n                    console.error(`[AI_SPAWNER] Error during emergency cleanup of enemy ${enemyId}:`, error);\r\n                }\r\n            }\r\n        }\r\n        \r\n        // Clear our tracking\r\n        this.clearAllEnemies();\r\n        \r\n        console.log(\"[AI_SPAWNER] Emergency cleanup completed\");\r\n    }\r\n\r\n    /**\r\n     * Get spawner statistics\r\n     */\r\n    getSpawnerStats() {\r\n        return {\r\n            registeredEnemies: this.registeredEnemyIds.size,\r\n            enemyIds: Array.from(this.registeredEnemyIds)\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Set spawner enabled state\r\n     */\r\n    setSpawnerEnabled(enabled) {\r\n        if (window.game && window.game.ecsWorld && window.game.ecsWorld.enemySystem) {\r\n            const enemySystem = window.game.ecsWorld.enemySystem;\r\n            \r\n            if (typeof enemySystem.setEnabled === 'function') {\r\n                enemySystem.setEnabled(enabled);\r\n            } else {\r\n                enemySystem.enabled = enabled;\r\n            }\r\n            \r\n            console.log(`[AI_SPAWNER] Enemy spawner ${enabled ? 'enabled' : 'disabled'}`);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Force spawn point regeneration\r\n     */\r\n    regenerateSpawnPoints() {\r\n        if (window.game && window.game.ecsWorld && window.game.ecsWorld.enemySystem) {\r\n            const enemySystem = window.game.ecsWorld.enemySystem;\r\n            \r\n            if (enemySystem.spawner && typeof enemySystem.spawner.generateSpawnPoints === 'function') {\r\n                enemySystem.spawner.generateSpawnPoints();\r\n                console.log(\"[AI_SPAWNER] Forced spawn point regeneration\");\r\n            }\r\n        }\r\n    }\r\n}","/**\r\n * Combat Logic Module - Handles projectile firing and enemy collision detection\r\n * \r\n * This module contains the core combat mechanics including weapon firing,\r\n * enemy collision detection, and damage application.\r\n */\r\n\r\nimport * as THREE from 'three';\r\n\r\nexport class CombatLogic {\r\n    constructor(effectsManager, eventManager, aiSpawnerManager) {\r\n        this.effectsManager = effectsManager;\r\n        this.eventManager = eventManager;\r\n        this.aiSpawnerManager = aiSpawnerManager;\r\n    }\r\n\r\n    /**\r\n     * Fire the particle cannon with raycast-based enemy collision detection\r\n     */\r\n    fireParticleCannon(scene, spaceship, world, playerEntity, projectileDamage, lastFireTime, cooldown) {\r\n        if (!spaceship || !spaceship.mesh) return { success: false, newLastFireTime: lastFireTime };\r\n        \r\n        // Check cooldown - prevent firing too rapidly\r\n        const currentTime = performance.now();\r\n        if (currentTime - lastFireTime < cooldown) {\r\n            // Still in cooldown period\r\n            return { success: false, newLastFireTime: lastFireTime };\r\n        }\r\n        \r\n        console.log(\"*** COMBAT MODULE: Firing pulse cannon with railgun effect ***\");\r\n        \r\n        // Get ship transform data\r\n        const shipPosition = spaceship.mesh.position.clone();\r\n        \r\n        // IMPROVED AIMING: Use raycasting from camera through crosshair\r\n        const camera = scene.camera;\r\n        if (!camera) {\r\n            console.error(\"Camera not available for aiming\");\r\n            return { success: false, newLastFireTime: lastFireTime };\r\n        }\r\n        \r\n        // Create a raycaster from camera center (crosshair position)\r\n        const raycaster = new THREE.Raycaster();\r\n        const screenCenter = new THREE.Vector2(0, 0);\r\n        \r\n        // Set the raycaster from camera through crosshair\r\n        raycaster.setFromCamera(screenCenter, camera);\r\n        \r\n        // Get the ray direction in world space\r\n        const direction = raycaster.ray.direction.clone().normalize();\r\n        \r\n        // Maximum range for weapon\r\n        const maxRange = 5000;\r\n        \r\n        // Log the new direction approach\r\n        console.log(`Projectile direction (using camera ray): ${direction.x.toFixed(2)}, ${direction.y.toFixed(2)}, ${direction.z.toFixed(2)}`);\r\n        \r\n        // Calculate weapon positions\r\n        const weaponPositions = this.calculateWeaponPositions(shipPosition, direction);\r\n        \r\n        // Play projectile sound\r\n        if (window.game && window.game.audio) {\r\n            console.log(\"Playing ASMR projectile sound for particle cannon\");\r\n            window.game.audio.playSound('projectile');\r\n        }\r\n        \r\n        // Check for enemy collisions\r\n        const { leftHitPoint, rightHitPoint, leftHitEnemy, rightHitEnemy } = \r\n            this.checkEnemyCollisions(world, raycaster, shipPosition, playerEntity, projectileDamage);\r\n        \r\n        // Create instant tracer beams from weapon ports\r\n        const leftEndPoint = leftHitPoint || weaponPositions.leftWeaponPosition.clone().add(direction.clone().multiplyScalar(maxRange));\r\n        this.effectsManager.createInstantTracer(weaponPositions.leftWeaponPosition, leftEndPoint, leftHitEnemy, 0.4);\r\n        \r\n        const rightEndPoint = rightHitPoint || weaponPositions.rightWeaponPosition.clone().add(direction.clone().multiplyScalar(maxRange));\r\n        this.effectsManager.createInstantTracer(weaponPositions.rightWeaponPosition, rightEndPoint, rightHitEnemy, 0.4);\r\n        \r\n        // Create impact effects if we hit something\r\n        if (leftHitPoint && leftHitEnemy) {\r\n            this.effectsManager.createExplosionEffect(leftHitPoint, 0.5);\r\n        }\r\n        if (rightHitPoint && rightHitEnemy && rightHitPoint.distanceTo(leftHitPoint || rightHitPoint) > 10) {\r\n            // Only create second explosion if hit points are far enough apart\r\n            this.effectsManager.createExplosionEffect(rightHitPoint, 0.5);\r\n        }\r\n        \r\n        // Return successful firing with updated last fire time\r\n        return { success: true, newLastFireTime: currentTime };\r\n    }\r\n\r\n    /**\r\n     * Calculate weapon port positions for dual projectiles\r\n     */\r\n    calculateWeaponPositions(shipPosition, direction) {\r\n        // Calculate right vector for offset\r\n        const right = new THREE.Vector3().crossVectors(direction, new THREE.Vector3(0, 1, 0)).normalize();\r\n        \r\n        // Position offsets for dual projectiles\r\n        const leftOffset = new THREE.Vector3().copy(right).multiplyScalar(-1.5);\r\n        const rightOffset = new THREE.Vector3().copy(right).multiplyScalar(1.5);\r\n        \r\n        // Calculate weapon port positions (where the beams originate)\r\n        // Start beams 25 units in front of ship to avoid self-intersection when moving forward\r\n        const weaponForwardOffset = new THREE.Vector3().copy(direction).multiplyScalar(25);\r\n        \r\n        const leftWeaponPosition = new THREE.Vector3().copy(shipPosition)\r\n            .add(leftOffset)\r\n            .add(weaponForwardOffset);\r\n            \r\n        const rightWeaponPosition = new THREE.Vector3().copy(shipPosition)\r\n            .add(rightOffset)\r\n            .add(weaponForwardOffset);\r\n\r\n        return { leftWeaponPosition, rightWeaponPosition };\r\n    }\r\n\r\n    /**\r\n     * Check for enemy collisions using raycasting\r\n     */\r\n    checkEnemyCollisions(world, raycaster, shipPosition, playerEntity, projectileDamage) {\r\n        let leftHitPoint = null;\r\n        let rightHitPoint = null;\r\n        let leftHitEnemy = false;\r\n        let rightHitEnemy = false;\r\n        \r\n        // DIRECT ENEMY CHECK - Find any enemies in the scene and check for direct hits\r\n        console.log(\"DIRECT ENEMY CHECK: Searching for enemies to destroy\");\r\n        if (world && world.entityManager) {\r\n            const enemies = this.findEnemies(world);\r\n            \r\n            // Check for collision with each enemy - using raycasting for better precision\r\n            for (const enemy of enemies) {\r\n                if (!enemy) continue;\r\n                \r\n                const hitResult = this.checkSingleEnemyCollision(enemy, raycaster, shipPosition, playerEntity, projectileDamage);\r\n                if (hitResult.hit) {\r\n                    // For simplicity, assign hit to left weapon (could be enhanced for dual weapon targeting)\r\n                    if (!leftHitEnemy) {\r\n                        leftHitPoint = hitResult.hitPoint;\r\n                        leftHitEnemy = true;\r\n                    } else if (!rightHitEnemy) {\r\n                        rightHitPoint = hitResult.hitPoint;\r\n                        rightHitEnemy = true;\r\n                    }\r\n                }\r\n            }\r\n        } else {\r\n            console.log(\"No world or entityManager available for enemy check\");\r\n        }\r\n\r\n        return { leftHitPoint, rightHitPoint, leftHitEnemy, rightHitEnemy };\r\n    }\r\n\r\n    /**\r\n     * Find enemies in the world\r\n     */\r\n    findEnemies(world) {\r\n        let enemies = [];\r\n        \r\n        // Try to get enemies from tag map\r\n        try {\r\n            if (world.entityManager.entitiesByTag && world.entityManager.entitiesByTag.get('enemy')) {\r\n                enemies = world.entityManager.entitiesByTag.get('enemy');\r\n                console.log(`Found ${enemies.length} enemies via tag map`);\r\n            } else {\r\n                // Fallback to checking all entities\r\n                console.log(\"No enemy tag map, checking all entities\");\r\n                const allEntities = Array.from(world.entityManager.entities.values());\r\n                for (const entity of allEntities) {\r\n                    if (entity.hasTag && entity.hasTag('enemy')) {\r\n                        enemies.push(entity);\r\n                    } else if (entity.hasComponent && entity.hasComponent('EnemyAIComponent')) {\r\n                        enemies.push(entity);\r\n                    }\r\n                }\r\n                console.log(`Found ${enemies.length} enemies by checking all entities`);\r\n            }\r\n        } catch (error) {\r\n            console.error(\"Error finding enemies:\", error);\r\n        }\r\n\r\n        return enemies;\r\n    }\r\n\r\n    /**\r\n     * Check collision with a single enemy\r\n     */\r\n    checkSingleEnemyCollision(enemy, raycaster, shipPosition, playerEntity, projectileDamage) {\r\n        try {\r\n            // Get enemy position for debugging\r\n            let enemyPosition = null;\r\n            const enemyTransform = enemy.getComponent('TransformComponent');\r\n            if (enemyTransform) {\r\n                enemyPosition = enemyTransform.position;\r\n            } else {\r\n                console.log(\"Enemy missing transform component\");\r\n                return { hit: false };\r\n            }\r\n            \r\n            // Get enemy mesh component for collision detection\r\n            const enemyMeshComponent = enemy.getComponent('MeshComponent');\r\n            if (!enemyMeshComponent || !enemyMeshComponent.mesh) {\r\n                console.log(`Enemy ${enemy.id} has no mesh component or mesh`);\r\n                return { hit: false };\r\n            }\r\n            \r\n            // Debug mesh properties\r\n            console.log(`Testing ray intersection with enemy ${enemy.id}:`);\r\n            console.log(`- Position: (${enemyPosition.x.toFixed(1)}, ${enemyPosition.y.toFixed(1)}, ${enemyPosition.z.toFixed(1)})`);\r\n            console.log(`- Mesh visible: ${enemyMeshComponent.mesh.visible}`);\r\n            console.log(`- Mesh children: ${enemyMeshComponent.mesh.children ? enemyMeshComponent.mesh.children.length : 0}`);\r\n            \r\n            // Calculate distance from ship to enemy (for debugging)\r\n            const distanceToEnemy = shipPosition.distanceTo(enemyPosition);\r\n            console.log(`- Distance to enemy: ${distanceToEnemy.toFixed(1)}`);\r\n            \r\n            // Skip if mesh is not visible\r\n            if (!enemyMeshComponent.mesh.visible) {\r\n                console.log(`Mesh for enemy ${enemy.id} is not visible, skipping`);\r\n                return { hit: false };\r\n            }\r\n            \r\n            // Perform the precise mesh intersection test\r\n            const intersections = raycaster.intersectObject(enemyMeshComponent.mesh, true);\r\n            \r\n            if (intersections.length > 0) {\r\n                // We have a mesh intersection!\r\n                const intersection = intersections[0]; // closest intersection\r\n                \r\n                // Debug the hit\r\n                console.log(`*** MESH HIT on enemy ${enemy.id}! ***`);\r\n                console.log(`- Hit distance: ${intersection.distance.toFixed(2)}`);\r\n                console.log(`- Hit point: (${intersection.point.x.toFixed(1)}, ${intersection.point.y.toFixed(1)}, ${intersection.point.z.toFixed(1)})`);\r\n                \r\n                if (intersection.object) {\r\n                    console.log(`- Hit specific object: ${intersection.object.name || 'unnamed'}`);\r\n                }\r\n                \r\n                if (intersection.face) {\r\n                    console.log(`- Hit face normal: (${intersection.face.normal.x.toFixed(2)}, ${intersection.face.normal.y.toFixed(2)}, ${intersection.face.normal.z.toFixed(2)})`);\r\n                }\r\n                \r\n                // Apply damage and handle destruction\r\n                this.handleEnemyDamage(enemy, enemyPosition, projectileDamage, playerEntity);\r\n                \r\n                return { hit: true, hitPoint: intersection.point };\r\n            } else {\r\n                // Debug the miss\r\n                console.log(`Ray missed enemy ${enemy.id} - no mesh intersection`);\r\n                return { hit: false };\r\n            }\r\n        } catch (error) {\r\n            console.error(\"Error checking enemy collision:\", error);\r\n            return { hit: false };\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Handle enemy damage and destruction\r\n     */\r\n    handleEnemyDamage(enemy, enemyPosition, projectileDamage, playerEntity) {\r\n        // Force destroy enemy via all possible methods\r\n        // Method 1: Apply damage via health component\r\n        const health = enemy.getComponent('HealthComponent');\r\n        if (health) {\r\n            console.log(\"Applying damage to enemy\");\r\n            // Use the standardized projectile damage value\r\n            const damageResult = health.applyDamage(projectileDamage, 'particle', playerEntity);\r\n            \r\n            // Check if the damage was enough to destroy the enemy\r\n            if (health.health <= 0) {\r\n                console.log(\"Enemy health depleted, destroying entity\");\r\n                health.isDestroyed = true;\r\n                \r\n                // Create explosion effect for destroyed enemy\r\n                if (enemyPosition) {\r\n                    this.effectsManager.createExplosionEffect(enemyPosition.clone());\r\n                    \r\n                    // Play explosion sound if available\r\n                    if (window.game && window.game.audio) {\r\n                        window.game.audio.playSound('boink');\r\n                    }\r\n                }\r\n                \r\n                // Handle enemy destruction through AI spawner manager\r\n                this.aiSpawnerManager.handleEnemyDestruction(enemy, 'projectile');\r\n                \r\n                // Notify enemy system about destruction\r\n                this.eventManager.notifyEnemySystemDestruction(enemy, 'projectile');\r\n                \r\n                // Publish event about destruction\r\n                this.eventManager.publishEnemyDestroyed(enemy.world || window.game?.ecsWorld, enemy.id, 'playerProjectile', enemyPosition);\r\n                \r\n                // Method 2: Direct entity destruction only if health is depleted\r\n                try {\r\n                    // Use system-specific methods if available\r\n                    if (window.game && window.game.ecsWorld && window.game.ecsWorld.enemySystem) {\r\n                        const enemySystem = window.game.ecsWorld.enemySystem;\r\n                        // Try returnEnemyToPool first which properly handles cleanup\r\n                        if (typeof enemySystem.returnEnemyToPool === 'function') {\r\n                            console.log(`Using EnemySystem.returnEnemyToPool for enemy ${enemy.id}`);\r\n                            enemySystem.returnEnemyToPool(enemy);\r\n                        }\r\n                        // Force validation of references in EnemySystem\r\n                        if (typeof enemySystem.validateEnemyReferences === 'function') {\r\n                            enemySystem.validateEnemyReferences();\r\n                        }\r\n                    } else {\r\n                        // Fallback to direct destruction\r\n                        const world = enemy.world || window.game?.ecsWorld;\r\n                        if (world && typeof world.destroyEntity === 'function') {\r\n                            world.destroyEntity(enemy.id);\r\n                            console.log(\"Enemy destroyed via world.destroyEntity\");\r\n                        }\r\n                    }\r\n                } catch (e) {\r\n                    console.error(\"Failed to destroy enemy:\", e);\r\n                }\r\n            } else {\r\n                console.log(`Enemy hit but survived with ${health.health}/${health.maxHealth} health remaining`);\r\n                // Non-lethal hit - no visual effect\r\n            }\r\n        }\r\n    }\r\n}","/**\r\n * Combat module - Handles all combat-related functionality\r\n * \r\n * This module manages particle cannon firing and combat logic.\r\n * \r\n * REFACTORED: This module now uses submodules for better organization:\r\n * - worldSetup.js: ECS World construction and scene setup\r\n * - registerSystems.js: System registration in deterministic order\r\n * - events.js: Event subscriptions and MessageBus interactions\r\n * - effects.js: Visual effects, materials, and rendering helpers\r\n * - aiAndSpawners.js: Enemy pool/spawner management\r\n */\r\n\r\nimport { WorldSetup } from './combat/worldSetup.js';\r\nimport { SystemRegistrar } from './combat/registerSystems.js';\r\nimport { EventManager } from './combat/events.js';\r\nimport { EffectsManager } from './combat/effects.js';\r\nimport { AISpawnerManager } from './combat/aiAndSpawners.js';\r\nimport { CombatLogic } from './combat/combatLogic.js';\r\nimport * as THREE from 'three';\r\n\r\nexport class Combat {\r\n    constructor(scene, spaceship) {\r\n        this.scene = scene;\r\n        this.spaceship = spaceship;\r\n        \r\n        // Tuned these parameters for better gameplay\r\n        this.fireRate = 3; // shots per second\r\n        \r\n        // Track the last time we fired for rate limiting\r\n        this.lastFireTime = 0;\r\n        \r\n        // Reference size for spread calculation\r\n        this.aimingSpread = 0.05;\r\n        \r\n        // Weapon properties\r\n        this.isFiring = false;\r\n        this.cooldown = 1000 / this.fireRate; // milliseconds between shots\r\n        \r\n        // Combat properties\r\n        this.particleCannonDamage = 20; // Standard damage per particle cannon hit\r\n        \r\n        // Initialize submodules\r\n        this.worldSetup = new WorldSetup();\r\n        this.systemRegistrar = new SystemRegistrar();\r\n        this.eventManager = new EventManager();\r\n        this.effectsManager = new EffectsManager(scene);\r\n        this.aiSpawnerManager = new AISpawnerManager();\r\n        this.combatLogic = new CombatLogic(this.effectsManager, this.eventManager, this.aiSpawnerManager);\r\n        \r\n        // Pool manager removed - projectile system not in use\r\n        \r\n        // Initialize ECS world for advanced combat systems\r\n        this.initializeECSWorld();\r\n        \r\n    }\r\n    \r\n    // Material and geometry initialization moved to EffectsManager\r\n    \r\n    /**\r\n     * Initialize the ECS world asynchronously\r\n     * This is called from the constructor and runs in the background\r\n     */\r\n    async initializeECSWorld() {\r\n        try {\r\n            \r\n            // Use world setup module\r\n            this.world = await this.worldSetup.initializeECSWorld(this.scene, this.spaceship);\r\n            \r\n            // Continue with full world setup\r\n            await this.setupECSWorld();\r\n            \r\n        } catch (error) {\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Set up the ECS world and register combat systems\r\n     */\r\n    async setupECSWorld() {\r\n        // Skip if world was already set up\r\n        if (this.worldSetup.isWorldInitialized()) {\r\n            return;\r\n        }\r\n        \r\n        try {\r\n            // Register all systems using the system registrar\r\n            const systems = await this.systemRegistrar.registerAllSystems(this.world, this.scene);\r\n            \r\n            // Store system references for backwards compatibility\r\n            Object.assign(this, systems);\r\n            \r\n            // Set up event handlers\r\n            this.eventManager.setupEventHandlers(this.world, this.worldSetup.getPlayerEntity());\r\n            \r\n            // Set scene reference for cross-system access\r\n            this.worldSetup.setSceneReference(this.scene);\r\n            \r\n            // Initialize the world\r\n            this.worldSetup.initializeWorld();\r\n            \r\n            // Create/update player reference entity\r\n            this.playerEntity = await this.worldSetup.createPlayerReferenceEntity(this.spaceship);\r\n            \r\n            // Configure enemy system\r\n            if (this.enemySystem) {\r\n                this.aiSpawnerManager.configureEnemySystem(this.enemySystem);\r\n            }\r\n            \r\n            // Mark world as initialized\r\n            this.worldSetup.setWorldInitialized();\r\n            \r\n        } catch (error) {\r\n        }\r\n    }\r\n    \r\n    // Player entity creation moved to WorldSetup module\r\n    \r\n    /**\r\n     * Update combat systems and handle firing logic\r\n     * @param {number} deltaTime Time since last update in seconds\r\n     */\r\n    update(deltaTime) {\r\n        // Skip if disabled\r\n        if (!this.scene || !this.spaceship) return;\r\n        \r\n        // Skip enemy updates if intro sequence is active\r\n        const introActive = window.game && window.game.introSequenceActive;\r\n        \r\n        // Update the player reference entity position\r\n        this.updatePlayerReference();\r\n        \r\n        // Update the spaceship health from ECS\r\n        this.updateSpaceshipHealth();\r\n        \r\n        \r\n        // Update active tracer beams\r\n        this.effectsManager.updateTracers(deltaTime);\r\n        \r\n        // Pooled visual effects removed - using instant raycast only\r\n        \r\n        // Handle firing weapons\r\n        if (this.isFiring && !this.spaceship.isDocked) {\r\n            this.fireParticleCannon();\r\n        }\r\n        \r\n        // Update the ECS world with the current delta time\r\n        if (this.world && !introActive) {\r\n            this.world.update(deltaTime);\r\n        } else if (this.world && introActive) {\r\n            // During intro, only update non-enemy systems\r\n            if (this.world.systems) {\r\n                for (const system of this.world.systems) {\r\n                    // Skip enemy systems when intro is active\r\n                    if (system.constructor.name !== 'EnemySystem' && \r\n                        system.constructor.name !== 'EnemyAISystem') {\r\n                        system.update(deltaTime);\r\n                    }\r\n                }\r\n            }\r\n        } else if (!this.world) {\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Update the player reference entity with the current spaceship position\r\n     */\r\n    updatePlayerReference() {\r\n        this.worldSetup.updatePlayerReference(this.spaceship);\r\n    }\r\n    \r\n    /**\r\n     * Sync the spaceship hull/shield with the player entity's HealthComponent\r\n     */\r\n    updateSpaceshipHealth() {\r\n        this.worldSetup.updateSpaceshipHealth(this.spaceship);\r\n    }\r\n    \r\n    \r\n    /**\r\n     * Set firing state for the particle cannon\r\n     * @param {boolean} isFiring Whether the cannon should be firing\r\n     */\r\n    setFiring(isFiring) {\r\n        this.isFiring = isFiring;\r\n    }\r\n    \r\n    /**\r\n     * Create an explosion effect at the given position\r\n     * @param {THREE.Vector3} position Position for the explosion\r\n     * @param {number} duration Duration of the explosion in milliseconds\r\n     * @param {boolean} isVisible Whether the explosion should be visible\r\n     */\r\n    createExplosionEffect(position, duration = 1000, isVisible = true) {\r\n        return this.effectsManager.createExplosionEffect(position, duration, isVisible, null);\r\n    }\r\n    \r\n    // Tracer update logic moved to EffectsManager\r\n    \r\n    /**\r\n     * Register an enemy entity for synchronization with EnemySystem\r\n     * @param {string} enemyId ID of the enemy entity\r\n     */\r\n    registerEnemy(enemyId) {\r\n        this.aiSpawnerManager.registerEnemy(enemyId);\r\n    }\r\n    \r\n    /**\r\n     * Unregister an enemy entity\r\n     * @param {string} enemyId ID of the enemy entity\r\n     */\r\n    unregisterEnemy(enemyId) {\r\n        this.aiSpawnerManager.unregisterEnemy(enemyId);\r\n    }\r\n    \r\n    /**\r\n     * Fire the particle cannon with instant raycast damage\r\n     */\r\n    fireParticleCannon() {\r\n        const result = this.combatLogic.fireParticleCannon(\r\n            this.scene, \r\n            this.spaceship, \r\n            this.world, \r\n            this.playerEntity, \r\n            this.particleCannonDamage, \r\n            this.lastFireTime, \r\n            this.cooldown\r\n        );\r\n        \r\n        // Update last fire time\r\n        this.lastFireTime = result.newLastFireTime;\r\n        \r\n        return result.success;\r\n    }\r\n    \r\n    \r\n    /**\r\n     * Enable or disable all combat systems\r\n     * @param {boolean} enabled Whether combat systems should be enabled\r\n     */\r\n    setEnabled(enabled) {\r\n        \r\n        // Use system registrar to enable/disable systems\r\n        this.systemRegistrar.setSystemsEnabled(enabled);\r\n    }\r\n    \r\n    \r\n    // Aiming tracer creation moved to EffectsManager\r\n    createAimingTracer(startPosition, direction, distance = 3000) {\r\n        return this.effectsManager.createAimingTracer(startPosition, direction, distance, null);\r\n    }\r\n    \r\n    /**\r\n     * Create a laser burst effect that travels forward with the projectile\r\n     * @param {THREE.Vector3} position Position for the effect\r\n     * @param {THREE.Vector3} direction Direction the effect should travel\r\n     */\r\n    createMuzzleFlash(position, direction) {\r\n        return this.effectsManager.createMuzzleFlash(position, direction, null);\r\n    }\r\n    \r\n    /**\r\n     * Dispose Combat module resources\r\n     * Clean up all pools, geometries, and other resources\r\n     */\r\n    dispose() {\r\n\r\n        // Projectile system removed\r\n        \r\n        // Dispose submodules\r\n        if (this.effectsManager) {\r\n            this.effectsManager.dispose();\r\n        }\r\n        \r\n        if (this.eventManager) {\r\n            this.eventManager.cleanup();\r\n        }\r\n        \r\n        if (this.aiSpawnerManager) {\r\n            this.aiSpawnerManager.emergencyCleanup();\r\n        }\r\n        \r\n        // Mark as disposed\r\n        this.disposed = true;\r\n        \r\n    }\r\n\r\n    // Renderer facade helpers moved to EffectsManager\r\n    \r\n    /**\r\n     * Import and register a system\r\n     * @param {string} path The path to the system module\r\n     * @param {string} className The name of the system class\r\n     * @returns {Object} The system instance\r\n     */\r\n    async importAndRegisterSystem(path, className) {\r\n        return this.systemRegistrar.importAndRegisterSystem(path, className, this.world, this.scene);\r\n    }\r\n}\r\n\r\n// Helper to remove the addProjectileTrail method entirely if it exists as a standalone function in an unexpected way\r\n// This is unlikely given typical class structure but added for robustness\r\n// if (typeof Combat !== 'undefined' && Combat.prototype.addProjectileTrail) {\r\n// delete Combat.prototype.addProjectileTrail;\r\n;\r\n// }","/**\r\n * Utility functions for handling file paths, especially for GitHub Pages deployment\r\n */\r\n\r\n/**\r\n * Converts a relative path to an absolute path that works both locally and on GitHub Pages\r\n * @param {string} relativePath - The relative path to convert\r\n * @returns {string} - The absolute path adjusted for the current environment\r\n */\r\nexport function getAbsolutePath(relativePath) {\r\n    // Log for debugging\r\n    console.log(`Original path: ${relativePath}`);\r\n    \r\n    // For GitHub Pages or any hosted environment\r\n    if (window.location.hostname !== 'localhost' && window.location.hostname !== '127.0.0.1') {\r\n        // Get the base path from the current URL\r\n        const basePath = window.location.pathname.split('/').slice(0, -1).join('/');\r\n        \r\n        // Remove leading slash from relative path if it exists\r\n        const cleanPath = relativePath.startsWith('/') ? relativePath.substring(1) : relativePath;\r\n        \r\n        // Construct the full path\r\n        const fullPath = `${basePath}/${cleanPath}`;\r\n        \r\n        console.log(`Adjusted path for hosted environment: ${fullPath}`);\r\n        return fullPath;\r\n    }\r\n    \r\n    // For local development\r\n    console.log(`Using original path for local environment: ${relativePath}`);\r\n    return relativePath;\r\n} ","// lighting.js - Handles all lighting setup and management for the renderer\r\n\r\nimport * as THREE from 'three';\r\n\r\nexport class LightingManager {\r\n    constructor(scene, renderer, camera) {\r\n        this.scene = scene;\r\n        this.renderer = renderer;\r\n        this.camera = camera;\r\n        \r\n        // Light components\r\n        this.sunLight = null;\r\n        this.ambientLight = null;\r\n        this.rimLight = null;\r\n        this.fillLight = null;\r\n        \r\n        // Configuration for space scene with proper lighting\r\n        this.config = {\r\n            // Sun light - primary illumination\r\n            sun: {\r\n                color: 0xFFFFFF,  // Pure white sun\r\n                intensity: 3.0,    // Moderate intensity with new lighting model\r\n                position: new THREE.Vector3(1, 0.5, 0.5).normalize() // Direction vector\r\n            },\r\n            // Ambient - increased for better visibility\r\n            ambient: {\r\n                skyColor: 0x303045,    // Slightly brighter blue space\r\n                groundColor: 0x151520,  // Dark blue\r\n                intensity: 0.6         // More visible ambient\r\n            },\r\n            // Rim light - edge definition from opposite side\r\n            rim: {\r\n                color: 0x4466AA,       // Blue rim light\r\n                intensity: 0.5,        // Subtle rim\r\n                position: new THREE.Vector3(-1, -0.3, -0.5).normalize()\r\n            },\r\n            // Fill light - subtle shadow fill\r\n            fill: {\r\n                color: 0x334466,       // Dark blue fill\r\n                intensity: 0.3,        // Very subtle\r\n                position: new THREE.Vector3(0.5, -0.5, 1).normalize()\r\n            },\r\n            // Shadows\r\n            shadows: {\r\n                mapSize: 4096,\r\n                radius: 2,\r\n                blurSamples: 25,\r\n                bias: -0.0001,\r\n                normalBias: 0.02,\r\n                frustumSize: 10000,  // Large enough for nearby objects\r\n                near: 0.5,\r\n                far: 50000\r\n            },\r\n            // Tone mapping\r\n            toneMapping: {\r\n                exposure: 1.0,\r\n                type: THREE.ACESFilmicToneMapping\r\n            }\r\n        };\r\n    }\r\n\r\n    setupLighting() {\r\n        // Configure renderer for physically correct lighting\r\n        this.renderer.useLegacyLights = false;\r\n        this.renderer.shadowMap.enabled = true;\r\n        this.renderer.shadowMap.type = THREE.PCFSoftShadowMap;\r\n        this.renderer.shadowMap.autoUpdate = true;\r\n        this.renderer.toneMapping = this.config.toneMapping.type;\r\n        this.renderer.toneMappingExposure = this.config.toneMapping.exposure;\r\n        this.renderer.outputColorSpace = THREE.SRGBColorSpace;\r\n        \r\n        // Create main sun directional light\r\n        this.sunLight = new THREE.DirectionalLight(\r\n            this.config.sun.color,\r\n            this.config.sun.intensity * Math.PI  // Multiply by PI for physically correct\r\n        );\r\n        \r\n        // Set light direction - DirectionalLight shines FROM position TO target\r\n        // For sun at origin, light should come FROM origin outward\r\n        this.sunLight.position.set(0, 0, 0);  // At sun position\r\n        this.sunLight.target.position.set(10000, 5000, 5000);  // Pointing outward\r\n        \r\n        // Configure shadows\r\n        this.sunLight.castShadow = true;\r\n        this.sunLight.shadow.mapSize.width = this.config.shadows.mapSize;\r\n        this.sunLight.shadow.mapSize.height = this.config.shadows.mapSize;\r\n        \r\n        // Shadow camera setup - this is crucial for large scenes\r\n        const d = this.config.shadows.frustumSize;\r\n        this.sunLight.shadow.camera.left = -d;\r\n        this.sunLight.shadow.camera.right = d;\r\n        this.sunLight.shadow.camera.top = d;\r\n        this.sunLight.shadow.camera.bottom = -d;\r\n        this.sunLight.shadow.camera.near = this.config.shadows.near;\r\n        this.sunLight.shadow.camera.far = this.config.shadows.far;\r\n        \r\n        this.sunLight.shadow.bias = this.config.shadows.bias;\r\n        this.sunLight.shadow.normalBias = this.config.shadows.normalBias;\r\n        this.sunLight.shadow.radius = this.config.shadows.radius;\r\n        this.sunLight.shadow.blurSamples = this.config.shadows.blurSamples;\r\n        \r\n        this.scene.add(this.sunLight);\r\n        this.scene.add(this.sunLight.target);\r\n        \r\n        // Add hemisphere ambient light for basic visibility\r\n        this.ambientLight = new THREE.HemisphereLight(\r\n            this.config.ambient.skyColor,\r\n            this.config.ambient.groundColor,\r\n            this.config.ambient.intensity * Math.PI\r\n        );\r\n        this.scene.add(this.ambientLight);\r\n        \r\n        // Add rim light from opposite direction\r\n        this.rimLight = new THREE.DirectionalLight(\r\n            this.config.rim.color,\r\n            this.config.rim.intensity * Math.PI\r\n        );\r\n        this.rimLight.position.set(-10000, -3000, -5000);\r\n        this.scene.add(this.rimLight);\r\n        \r\n        // Add fill light\r\n        this.fillLight = new THREE.DirectionalLight(\r\n            this.config.fill.color,\r\n            this.config.fill.intensity * Math.PI\r\n        );\r\n        this.fillLight.position.set(5000, -5000, 10000);\r\n        this.scene.add(this.fillLight);\r\n        \r\n        console.log(\"Lighting setup complete with physically correct lights\");\r\n    }\r\n    \r\n    /**\r\n     * Update sun light direction based on sun position\r\n     * For DirectionalLight, we need to set the direction, not just position\r\n     */\r\n    updateSunPosition(sunWorldPosition) {\r\n        if (!this.sunLight) return;\r\n        \r\n        // DirectionalLight simulates parallel rays from infinite distance\r\n        // Position sets WHERE the light comes from\r\n        // Target sets WHERE the light points to\r\n        \r\n        // Since sun is at origin (0,0,0), we want light to come FROM the sun\r\n        // and illuminate everything around it\r\n        \r\n        // Elegant solution: Make directional light simulate sun rays\r\n        // Position it BEHIND the sun (opposite from camera) pointing through the sun\r\n        \r\n        if (this.camera) {\r\n            // Get vector from camera to sun\r\n            const sunToCamera = new THREE.Vector3().subVectors(this.camera.position, sunWorldPosition);\r\n            \r\n            // Position light behind sun (opposite side from camera)\r\n            // This makes light come through the sun toward the camera\r\n            const lightPosition = sunWorldPosition.clone().sub(sunToCamera.normalize().multiplyScalar(50000));\r\n            this.sunLight.position.copy(lightPosition);\r\n            \r\n            // Point light toward camera through the sun\r\n            // This illuminates everything between sun and camera correctly\r\n            this.sunLight.target.position.copy(this.camera.position);\r\n        } else {\r\n            // Fallback: standard position\r\n            this.sunLight.position.set(-10000, 5000, -5000);\r\n            this.sunLight.target.position.set(0, 0, 0);\r\n        }\r\n        this.sunLight.target.updateMatrixWorld();\r\n    }\r\n    \r\n    /**\r\n     * Adjust lighting intensity\r\n     */\r\n    adjustLightingIntensity(factor = 1.0) {\r\n        const clampedFactor = THREE.MathUtils.clamp(factor, 0.5, 2.0);\r\n        \r\n        if (this.sunLight) {\r\n            this.sunLight.intensity = this.config.sun.intensity * Math.PI * clampedFactor;\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Update exposure based on camera position\r\n     */\r\n    updateExposure(cameraPosition) {\r\n        // Keep exposure relatively constant\r\n        this.renderer.toneMappingExposure = this.config.toneMapping.exposure;\r\n    }\r\n    \r\n    /**\r\n     * Adjust for volumetric ray type (backward compatibility)\r\n     */\r\n    adjustLightingForRayType(useClaudeRays) {\r\n        // Keep lighting consistent\r\n        if (this.ambientLight) {\r\n            this.ambientLight.intensity = this.config.ambient.intensity * Math.PI;\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Set shadow quality\r\n     */\r\n    setShadowQuality(quality) {\r\n        const sizes = {\r\n            low: 2048,\r\n            medium: 4096,\r\n            high: 8192,\r\n            ultra: 16384\r\n        };\r\n        \r\n        const size = sizes[quality] || 4096;\r\n        \r\n        if (this.sunLight && this.sunLight.shadow) {\r\n            this.sunLight.shadow.mapSize.width = size;\r\n            this.sunLight.shadow.mapSize.height = size;\r\n            \r\n            if (this.sunLight.shadow.map) {\r\n                this.sunLight.shadow.map.dispose();\r\n                this.sunLight.shadow.map = null;\r\n            }\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Handle window resize\r\n     */\r\n    handleResize() {\r\n        // Handled by post-processing manager\r\n    }\r\n    \r\n    dispose() {\r\n        // Dispose shadows\r\n        if (this.sunLight && this.sunLight.shadow && this.sunLight.shadow.map) {\r\n            this.sunLight.shadow.map.dispose();\r\n        }\r\n        \r\n        // Remove lights from scene\r\n        [this.sunLight, this.ambientLight, this.rimLight, this.fillLight].forEach(light => {\r\n            if (light) {\r\n                if (light.target) {\r\n                    this.scene.remove(light.target);\r\n                }\r\n                this.scene.remove(light);\r\n            }\r\n        });\r\n    }\r\n}","// shaders.js - Custom shaders for volumetric lighting effects\r\n\r\nimport * as THREE from 'three';\r\nimport { ShaderPass } from 'three/addons/postprocessing/ShaderPass.js';\r\n\r\n/**\r\n * Create a volumetric light shader for realistic god ray effects\r\n * @returns {ShaderPass} Shader pass for new volumetric lighting\r\n */\r\nexport function createVolumetricLightShader() {\r\n    // New improved volumetric light ray shader\r\n    const godRayShader = {\r\n        uniforms: {\r\n            tDiffuse: { value: null },\r\n            lightPosition: { value: new THREE.Vector2(0.5, 0.5) },\r\n            intensity: { value: 0.45 },         // Increased from 0.3\r\n            decay: { value: 0.94 },             // Adjusted from 0.95 for better distance\r\n            density: { value: 0.6 },            // Increased from 0.5\r\n            weight: { value: 0.5 },             // Increased from 0.4\r\n            samples: { value: 100 },            // Sample count - higher = better quality but slower\r\n            sunColor: { value: new THREE.Color(0xFFFAF0) },   // Sun color\r\n            sunDistance: { value: 0.5 },        // Distance to sun (0-1 normalized)\r\n            sunVisibility: { value: 1.0 },      // Whether sun is in front of camera (0-1)\r\n            scattering: { value: 0.4 },         // Increased from 0.3\r\n            attenuationMultiplier: { value: 3.5 } // Reduced from 5.0 to allow rays to travel further\r\n        },\r\n        \r\n        vertexShader: `\r\n            varying vec2 vUv;\r\n            \r\n            void main() {\r\n                vUv = uv;\r\n                gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\r\n            }\r\n        `,\r\n        \r\n        fragmentShader: `\r\n            precision highp float;\r\n            \r\n            varying vec2 vUv;\r\n            uniform sampler2D tDiffuse;\r\n            uniform vec2 lightPosition;\r\n            uniform float intensity;\r\n            uniform float decay;\r\n            uniform float density;\r\n            uniform float weight;\r\n            uniform int samples;\r\n            uniform vec3 sunColor;\r\n            uniform float sunDistance;\r\n            uniform float sunVisibility;\r\n            uniform float scattering;\r\n            uniform float attenuationMultiplier;\r\n            \r\n            const int MAX_SAMPLES = 150;\r\n            \r\n            float illuminationDecay(float rayProgress, float dist) {\r\n                // rayProgress: 0.0 to a1.0 (how far along the ray)\r\n                // dist: normalized distance to sun (0 = close, 1 = far)\r\n                \r\n                // Base decay from exponential falloff\r\n                float baseFalloff = pow(decay, rayProgress * 100.0);\r\n                \r\n                // More decay the further the sun is \r\n                float distanceAttenuation = 1.0 - (dist * dist * attenuationMultiplier);\r\n                distanceAttenuation = max(0.0, distanceAttenuation);\r\n                \r\n                // Apply visibility factor\r\n                float visibilityFactor = sunVisibility;\r\n                \r\n                return baseFalloff * distanceAttenuation * visibilityFactor;\r\n            }\r\n            \r\n            void main() {\r\n                // Get the texture color (original scene)\r\n                vec4 sceneColor = texture2D(tDiffuse, vUv);\r\n                \r\n                // Calculate ray direction from pixel to light source\r\n                vec2 rayVector = (vUv - lightPosition);\r\n                float rayLength = length(rayVector);\r\n                vec2 rayDirection = normalize(rayVector);\r\n                \r\n                // Skip calculation if ray is too long (reduces artifacts far from sun)\r\n                if (rayLength > 1.0) {\r\n                    gl_FragColor = sceneColor;\r\n                    return;\r\n                }\r\n                \r\n                // Angle factor (rays stronger when looking near sun)\r\n                float angleFactor = 1.0 - rayLength;\r\n                angleFactor = pow(angleFactor, 0.8); // Adjust the power for ray spread\r\n                \r\n                // Calculate ray sampling parameters\r\n                vec2 sampleStep = -rayDirection * min(density, 1.0) / float(samples);\r\n                \r\n                // Use a tighter sampling box around the light source\r\n                // This creates more defined rays and reduces artifacts\r\n                float rayProgress = max(0.0, (1.0 - rayLength * 2.0)); // Start closer to light source\r\n                vec2 samplePosition = vUv - sampleStep * rayProgress * 10.0; // Start closer to current position\r\n                \r\n                // Clamp sample count for performance\r\n                int sampleCount = min(samples, MAX_SAMPLES);\r\n                \r\n                // Start with current scene color\r\n                vec4 finalColor = sceneColor;\r\n                \r\n                // Calculate scattering factor based on distance and angle\r\n                float scatterFactor = scattering * angleFactor * (1.0 - sunDistance * 0.5);\r\n                \r\n                // Sample the light path\r\n                // Use a fixed loop to avoid gradient instruction warnings\r\n                for (int i = 0; i < MAX_SAMPLES; i++) {\r\n                    // Early exit condition without break (to avoid varying iteration)\r\n                    float shouldSample = step(float(i), float(sampleCount) - 0.5);\r\n                    \r\n                    // Move along the ray\r\n                    samplePosition += sampleStep;\r\n                    \r\n                    // Sample at the current position\r\n                    // Note: texture2D in a loop with uniform iteration is fine\r\n                    vec4 sampledColor = texture2D(tDiffuse, samplePosition);\r\n                    \r\n                    // Calculate illumination decay factor\r\n                    float decayFactor = illuminationDecay(float(i) / float(sampleCount), sunDistance);\r\n                    \r\n                    // Create the ray sample with attenuation\r\n                    vec4 raySample = sampledColor * decayFactor * weight * shouldSample;\r\n                    \r\n                    // Apply sun color to the ray (tinted by scene color)\r\n                    raySample.rgb *= mix(sunColor, sampledColor.rgb, 0.3);\r\n                    \r\n                    // Apply scattering effect - brightens areas around sun\r\n                    float scatterAmount = step(float(i), float(sampleCount) / 3.0 - 0.5);\r\n                    raySample.rgb += sunColor * scatterFactor * decayFactor * 0.2 * \r\n                                     (1.0 - float(i) / max(float(sampleCount) / 3.0, 1.0)) * scatterAmount * shouldSample;\r\n                    \r\n                    // Add to accumulated color\r\n                    finalColor += raySample;\r\n                }\r\n                \r\n                // Apply master intensity factor\r\n                finalColor *= mix(1.0, intensity, sunVisibility);\r\n                \r\n                // Preserve original scene color with a blend factor\r\n                finalColor = mix(sceneColor, finalColor, min(0.95, intensity * sunVisibility));\r\n                \r\n                gl_FragColor = finalColor;\r\n            }\r\n        `\r\n    };\r\n    \r\n    // Create and return a shader pass\r\n    const shaderPass = new ShaderPass(godRayShader);\r\n    shaderPass.renderToScreen = false;\r\n    \r\n    return shaderPass;\r\n}\r\n\r\n/**\r\n * Create the original \"Claude Ray\" shader (the original implementation renamed)\r\n * @returns {ShaderPass} Shader pass for the original effect\r\n */\r\nexport function createClaudeRayShader() {\r\n    // Original volumetric light ray shader (renamed to Claude Rays)\r\n    const claudeRayShader = {\r\n        uniforms: {\r\n            tDiffuse: { value: null },\r\n            lightPosition: { value: new THREE.Vector2(0.5, 0.5) },\r\n            exposure: { value: 0.4 },    // Reduced from 0.6\r\n            decay: { value: 0.93 },\r\n            density: { value: 0.8 },     // Reduced from 0.96\r\n            weight: { value: 0.25 },     // Reduced from 0.4\r\n            lightColor: { value: new THREE.Color(0xFFFAF0) }  // Matches sun directional light\r\n        },\r\n        vertexShader: `\r\n            varying vec2 vUv;\r\n            void main() {\r\n                vUv = uv;\r\n                gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\r\n            }\r\n        `,\r\n        fragmentShader: `\r\n            precision highp float;\r\n            \r\n            varying vec2 vUv;\r\n            uniform sampler2D tDiffuse;\r\n            uniform vec2 lightPosition;\r\n            uniform float exposure;\r\n            uniform float decay;\r\n            uniform float density;\r\n            uniform float weight;\r\n            uniform vec3 lightColor;\r\n            \r\n            const int NUM_SAMPLES = 24; // Reduced from 30 for better balance of quality and performance\r\n            \r\n            void main() {\r\n                // Get the texture color\r\n                vec4 color = texture2D(tDiffuse, vUv);\r\n                \r\n                // Ray direction\r\n                vec2 texCoord = vUv;\r\n                vec2 deltaTextCoord = (texCoord - lightPosition) * density / float(NUM_SAMPLES);\r\n                \r\n                // Start illumination decay at 1.0\r\n                float illuminationDecay = 1.0;\r\n                \r\n                // Sample the light path with a fixed number of steps\r\n                for(int i = 0; i < NUM_SAMPLES; i++) {\r\n                    // Move along the ray\r\n                    texCoord -= deltaTextCoord;\r\n                    \r\n                    // Sample at the current position\r\n                    vec4 sampleColor = texture2D(tDiffuse, texCoord);\r\n                    \r\n                    // Apply decay and weight\r\n                    sampleColor *= illuminationDecay * weight;\r\n                    \r\n                    // Apply light color\r\n                    sampleColor.rgb *= lightColor;\r\n                    \r\n                    // Add to the final color\r\n                    color += sampleColor;\r\n                    \r\n                    // Reduce illumination for the next sample\r\n                    illuminationDecay *= decay;\r\n                }\r\n                \r\n                // Apply exposure\r\n                color *= exposure;\r\n                \r\n                // Output the final color\r\n                gl_FragColor = color;\r\n            }\r\n        `\r\n    };\r\n    \r\n    // Create and return a shader pass\r\n    const shaderPass = new ShaderPass(claudeRayShader);\r\n    shaderPass.renderToScreen = false;\r\n    \r\n    return shaderPass;\r\n}","// post.js - Post-processing effects management\r\n\r\nimport * as THREE from 'three';\r\nimport { EffectComposer } from 'three/addons/postprocessing/EffectComposer.js';\r\nimport { RenderPass } from 'three/addons/postprocessing/RenderPass.js';\r\nimport { UnrealBloomPass } from 'three/addons/postprocessing/UnrealBloomPass.js';\r\nimport { ShaderPass } from 'three/addons/postprocessing/ShaderPass.js';\r\nimport { FXAAShader } from 'three/addons/shaders/FXAAShader.js';\r\nimport { ColorCorrectionShader } from 'three/addons/shaders/ColorCorrectionShader.js';\r\nimport { FilmShader } from 'three/addons/shaders/FilmShader.js';\r\nimport { VignetteShader } from 'three/addons/shaders/VignetteShader.js';\r\nimport { createVolumetricLightShader, createClaudeRayShader } from './shaders.js';\r\n\r\nexport class PostProcessingManager {\r\n    constructor(renderer, scene, camera) {\r\n        this.renderer = renderer;\r\n        this.scene = scene;\r\n        this.camera = camera;\r\n        this.composer = null;\r\n        this.bloomPass = null;\r\n        this.filmPass = null;\r\n        this.colorCorrectionPass = null;\r\n        this.vignettePass = null;\r\n        this.claudeRayPass = null;\r\n        this.godRayPass = null;\r\n        this.useBasicRendering = false;\r\n        \r\n        // Volumetric lighting settings\r\n        this.volumetricLightEnabled = true;\r\n        this.useClaudeRays = false;\r\n    }\r\n\r\n    setupPostProcessing() {\r\n        try {\r\n            // Create a composer for post-processing effects\r\n            this.composer = new EffectComposer(this.renderer);\r\n            \r\n            // Add the render pass\r\n            const renderPass = new RenderPass(this.scene, this.camera);\r\n            this.composer.addPass(renderPass);\r\n            \r\n            // Add godray effect based on settings\r\n            this.setupGodRayEffects();\r\n            \r\n            this.setupBloomPass();\r\n            this.setupFXAAPass();\r\n            this.setupColorCorrectionPass();\r\n            this.setupFilmPass();\r\n            this.setupVignettePass();\r\n            \r\n            console.log(\"Post-processing setup complete\");\r\n        } catch (error) {\r\n            console.error(\"Error setting up post-processing:\", error);\r\n            console.log(\"Continuing with basic rendering without post-processing\");\r\n            // Set a flag to use basic rendering instead\r\n            this.useBasicRendering = true;\r\n        }\r\n    }\r\n\r\n    setupBloomPass() {\r\n        try {\r\n            // Add bloom effect for sun, engines, etc.\r\n            this.bloomPass = new UnrealBloomPass(\r\n                new THREE.Vector2(window.innerWidth, window.innerHeight),\r\n                0.2,    // strength (further reduced from 0.3)\r\n                0.2,    // radius (further reduced from 0.3)\r\n                0.95    // threshold (further increased from 0.9 to only affect the very brightest parts)\r\n            );\r\n            this.composer.addPass(this.bloomPass);\r\n        } catch (error) {\r\n            console.warn(\"Error setting up UnrealBloomPass:\", error);\r\n        }\r\n    }\r\n\r\n    setupFXAAPass() {\r\n        try {\r\n            // Add FXAA for edge aliasing\r\n            const fxaaPass = new ShaderPass(FXAAShader);\r\n            if (fxaaPass.material && fxaaPass.material.uniforms && fxaaPass.material.uniforms.resolution) {\r\n                const pixelRatio = this.renderer.getPixelRatio();\r\n                fxaaPass.material.uniforms.resolution.value.x = 1 / (window.innerWidth * pixelRatio);\r\n                fxaaPass.material.uniforms.resolution.value.y = 1 / (window.innerHeight * pixelRatio);\r\n                this.composer.addPass(fxaaPass);\r\n            } else {\r\n                console.warn(\"FXAAShader uniforms not as expected, skipping pass\");\r\n            }\r\n        } catch (error) {\r\n            console.warn(\"Error setting up FXAAShader:\", error);\r\n        }\r\n    }\r\n\r\n    setupColorCorrectionPass() {\r\n        try {\r\n            // Add color correction effects\r\n            this.colorCorrectionPass = new ShaderPass(ColorCorrectionShader);\r\n            if (this.colorCorrectionPass.uniforms && this.colorCorrectionPass.uniforms.powRGB && this.colorCorrectionPass.uniforms.mulRGB) {\r\n                this.colorCorrectionPass.uniforms.powRGB.value = new THREE.Vector3(1.1, 1.1, 1.2); // Slightly blue tint\r\n                this.colorCorrectionPass.uniforms.mulRGB.value = new THREE.Vector3(1.2, 1.1, 1.0); // Warmer highlights\r\n                this.composer.addPass(this.colorCorrectionPass);\r\n            } else {\r\n                console.warn(\"ColorCorrectionShader uniforms not as expected, skipping pass\");\r\n            }\r\n        } catch (error) {\r\n            console.warn(\"Error setting up ColorCorrectionShader:\", error);\r\n        }\r\n    }\r\n\r\n    setupFilmPass() {\r\n        try {\r\n            // Add CRT/film effect with static scanlines\r\n            this.filmPass = new ShaderPass(FilmShader);\r\n            if (this.filmPass.uniforms && this.filmPass.uniforms.nIntensity && \r\n                this.filmPass.uniforms.sIntensity && this.filmPass.uniforms.grayscale) {\r\n                this.filmPass.uniforms.nIntensity.value = 0.08; // Reduced noise for subtle grain\r\n                this.filmPass.uniforms.sIntensity.value = 0.03; // Static CRT scanlines\r\n                this.filmPass.uniforms.grayscale.value = 0; // Keep color\r\n                this.composer.addPass(this.filmPass);\r\n            } else {\r\n                console.warn(\"FilmShader uniforms not as expected, skipping pass\");\r\n            }\r\n        } catch (error) {\r\n            console.warn(\"Error setting up FilmShader:\", error);\r\n        }\r\n    }\r\n\r\n    setupVignettePass() {\r\n        try {\r\n            // Add vignette effect\r\n            this.vignettePass = new ShaderPass(VignetteShader);\r\n            if (this.vignettePass.uniforms && this.vignettePass.uniforms.offset && this.vignettePass.uniforms.darkness) {\r\n                this.vignettePass.uniforms.offset.value = 0.95;\r\n                this.vignettePass.uniforms.darkness.value = 1.6;\r\n                this.composer.addPass(this.vignettePass);\r\n            } else {\r\n                console.warn(\"VignetteShader uniforms not as expected, skipping pass\");\r\n            }\r\n        } catch (error) {\r\n            console.warn(\"Error setting up VignetteShader:\", error);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Setup for volumetric lighting (god rays) effects\r\n     * Handles both the new realistic godray effect and the original \"Claude Rays\"\r\n     */\r\n    setupGodRayEffects() {\r\n        try {\r\n            // Initialize flags for volumetric lighting effects\r\n            this.volumetricLightEnabled = true;     // Master toggle for any god ray effect\r\n            this.useClaudeRays = false;             // Toggle between new godRays (false) and Claude Rays (true)\r\n            \r\n            // Create the original \"Claude Rays\" effect (disabled by default)\r\n            this.claudeRayPass = createClaudeRayShader();\r\n            this.claudeRayPass.enabled = this.volumetricLightEnabled && this.useClaudeRays;\r\n            this.composer.addPass(this.claudeRayPass);\r\n            console.log(\"Claude Rays effect created (disabled by default)\");\r\n            \r\n            // Create the new improved volumetric lighting effect\r\n            this.godRayPass = createVolumetricLightShader();\r\n            this.godRayPass.enabled = this.volumetricLightEnabled && !this.useClaudeRays;\r\n            this.composer.addPass(this.godRayPass);\r\n            console.log(\"New volumetric light ray effect added to post-processing chain\");\r\n        } catch (error) {\r\n            console.warn(\"Error setting up volumetric light shaders:\", error);\r\n        }\r\n    }\r\n\r\n    // Allow dynamic adjustment of post-processing settings\r\n    adjustBloom(strength, radius, threshold) {\r\n        if (this.bloomPass) {\r\n            this.bloomPass.strength = strength !== undefined ? strength : this.bloomPass.strength;\r\n            this.bloomPass.radius = radius !== undefined ? radius : this.bloomPass.radius;\r\n            this.bloomPass.threshold = threshold !== undefined ? threshold : this.bloomPass.threshold;\r\n        }\r\n    }\r\n\r\n    // Update for dynamic visual effects\r\n    update(deltaTime) {\r\n        // Update film grain with time for animation\r\n        if (this.filmPass && this.filmPass.uniforms && this.filmPass.uniforms.time && this.filmPass.uniforms.time.value !== undefined) {\r\n            try {\r\n                this.filmPass.uniforms.time.value += deltaTime;\r\n            } catch (error) {\r\n                console.warn(\"Error updating film pass time:\", error);\r\n            }\r\n        }\r\n    }\r\n\r\n    handleResize() {\r\n        // Update composer size if it exists\r\n        if (this.composer) {\r\n            this.composer.setSize(window.innerWidth, window.innerHeight);\r\n        \r\n            // Update FXAA resolution\r\n            try {\r\n                const pixelRatio = this.renderer.getPixelRatio();\r\n                const fxaaPass = this.composer.passes.find(pass => \r\n                    pass.material && \r\n                    pass.material.uniforms && \r\n                    pass.material.uniforms.resolution &&\r\n                    pass.material.uniforms.resolution.value\r\n                );\r\n                \r\n                if (fxaaPass) {\r\n                    fxaaPass.material.uniforms.resolution.value.x = 1 / (window.innerWidth * pixelRatio);\r\n                    fxaaPass.material.uniforms.resolution.value.y = 1 / (window.innerHeight * pixelRatio);\r\n                }\r\n            } catch (error) {\r\n                console.warn(\"Error updating FXAA resolution:\", error);\r\n            }\r\n        }\r\n    }\r\n\r\n    render() {\r\n        if (this.composer && !this.useBasicRendering) {\r\n            this.composer.render();\r\n        } else {\r\n            this.renderer.render(this.scene, this.camera);\r\n        }\r\n    }\r\n\r\n    dispose() {\r\n        // Dispose of post-processing\r\n        if (this.composer) {\r\n            this.composer.passes.forEach(pass => {\r\n                if (pass.dispose) pass.dispose();\r\n                if (pass.material) {\r\n                    pass.material.dispose();\r\n                }\r\n            });\r\n        }\r\n    }\r\n}","// sceneApi.js - Scene manipulation helpers including _withGuard system\r\n\r\nimport * as THREE from 'three';\r\n\r\nexport class SceneApiManager {\r\n    constructor(scene) {\r\n        this.scene = scene;\r\n        this.setupSceneGuard();\r\n    }\r\n\r\n    setupSceneGuard() {\r\n        // Renderer facade guard\r\n        if (typeof window !== 'undefined') {\r\n            window.__rendererGuard = false;\r\n        }\r\n\r\n        // Wrap scene add/remove to warn on direct mutations\r\n        const originalAdd = this.scene.add.bind(this.scene);\r\n        const originalRemove = this.scene.remove.bind(this.scene);\r\n        \r\n        this.scene.add = (...args) => {\r\n            if (!window.__rendererGuard && window && window.DEBUG_MODE) {\r\n                console.warn('[RendererFacade] Direct scene.add detected outside renderer facade');\r\n            }\r\n            return originalAdd(...args);\r\n        };\r\n        \r\n        this.scene.remove = (...args) => {\r\n            if (!window.__rendererGuard && window && window.DEBUG_MODE) {\r\n                console.warn('[RendererFacade] Direct scene.remove detected outside renderer facade');\r\n            }\r\n            return originalRemove(...args);\r\n        };\r\n    }\r\n\r\n    // Add an object to the scene through guarded path\r\n    add(object) {\r\n        return this._withGuard(() => this.scene.add(object));\r\n    }\r\n\r\n    // Facade API for views\r\n    addView(entityId, viewDef) {\r\n        // For future: create mesh/instanced entry based on viewDef\r\n        // Placeholder; current rendering handled by systems\r\n    }\r\n\r\n    removeView(entityId) {\r\n        // Placeholder for centralized removal\r\n    }\r\n\r\n    updateView(entityId, props) {\r\n        // Placeholder for centralized updates\r\n    }\r\n\r\n    _withGuard(fn) {\r\n        const prev = window.__rendererGuard;\r\n        window.__rendererGuard = true;\r\n        try { \r\n            return fn(); \r\n        } finally { \r\n            window.__rendererGuard = prev; \r\n        }\r\n    }\r\n\r\n    /**\r\n     * Helper method to find the sun object in the scene\r\n     * @returns {THREE.Object3D|null} The sun object or null if not found\r\n     */\r\n    findSunObject() {\r\n        let sun = null;\r\n        \r\n        // First try by name\r\n        sun = this.scene.getObjectByName('sun');\r\n        \r\n        // If not found by name, try to find by traversing scene\r\n        if (!sun) {\r\n            this.scene.traverse(object => {\r\n                if (object.name === 'sun') {\r\n                    sun = object;\r\n                }\r\n            });\r\n        }\r\n        \r\n        return sun;\r\n    }\r\n\r\n    // Interpolate ECS meshes before compositing\r\n    interpolateMeshes(alpha) {\r\n        // If ECS world present on scene, interpolate known meshes\r\n        const world = this.scene && this.scene.ecsWorld ? this.scene.ecsWorld : null;\r\n        if (!world || !world.entityManager) return;\r\n        \r\n        try {\r\n            const entities = world.getEntitiesWithComponents(['TransformComponent', 'MeshComponent']);\r\n            for (const entity of entities) {\r\n                const t = entity.getComponent('TransformComponent');\r\n                const m = entity.getComponent('MeshComponent');\r\n                if (!t || !m || !m.mesh) continue;\r\n                \r\n                // slerp rotation\r\n                const q = new THREE.Quaternion().copy(t.prevQuaternion).slerp(t.quaternion, alpha);\r\n                // lerp position\r\n                const p = new THREE.Vector3().copy(t.prevPosition).lerp(t.position, alpha);\r\n                m.mesh.position.copy(p);\r\n                m.mesh.quaternion.copy(q);\r\n            }\r\n        } catch {}\r\n    }\r\n}","// helpers.js - Utility functions and instanced mesh management\r\n\r\nimport * as THREE from 'three';\r\n\r\nexport class RenderHelpers {\r\n    constructor(scene) {\r\n        this.scene = scene;\r\n        this.instancedMeshes = new Map();\r\n        \r\n        // Performance counters\r\n        this._frameDrawCalls = 0;\r\n        this._frameVisibleInstances = 0;\r\n        this.renderAlpha = 0;\r\n    }\r\n\r\n    /**\r\n     * Create an instanced mesh for efficient rendering of many similar objects\r\n     * @param {string} key Unique identifier for this instanced mesh type\r\n     * @param {THREE.BufferGeometry} geometry The geometry to instance\r\n     * @param {THREE.Material} material The material to use\r\n     * @param {number} maxCount Maximum number of instances\r\n     * @returns {THREE.InstancedMesh} The created instanced mesh\r\n     */\r\n    createInstancedMesh(key, geometry, material, maxCount) {\r\n        const instancedMesh = new THREE.InstancedMesh(geometry, material, maxCount);\r\n        instancedMesh.count = 0; // Start with 0 visible instances\r\n        instancedMesh.frustumCulled = true;\r\n        this.scene.add(instancedMesh);\r\n        \r\n        this.instancedMeshes.set(key, {\r\n            mesh: instancedMesh,\r\n            count: 0,\r\n            maxCount: maxCount,\r\n            dummy: new THREE.Object3D() // Reusable temporary Object3D for matrix calculations\r\n        });\r\n        \r\n        return instancedMesh;\r\n    }\r\n    \r\n    /**\r\n     * Add or update an instance in an instanced mesh\r\n     * @param {string} key The instanced mesh identifier\r\n     * @param {number} index Index of the instance to update (or next available)\r\n     * @param {THREE.Vector3} position Position of the instance\r\n     * @param {THREE.Quaternion} quaternion Rotation of the instance\r\n     * @param {THREE.Vector3} scale Scale of the instance\r\n     * @returns {number} The index of the instance\r\n     */\r\n    updateInstance(key, index, position, quaternion, scale) {\r\n        const instance = this.instancedMeshes.get(key);\r\n        if (!instance) return -1;\r\n        \r\n        // Determine index to use\r\n        const idx = (index !== undefined) ? index : instance.count;\r\n        \r\n        // If we're adding a new instance, increment the count\r\n        if (idx >= instance.count) {\r\n            if (idx >= instance.maxCount) return -1; // Can't exceed max count\r\n            instance.count = idx + 1;\r\n        }\r\n        \r\n        // Update matrix using dummy object\r\n        instance.dummy.position.copy(position);\r\n        if (quaternion) instance.dummy.quaternion.copy(quaternion);\r\n        if (scale) instance.dummy.scale.copy(scale);\r\n        instance.dummy.updateMatrix();\r\n        \r\n        // Apply to instanced mesh\r\n        instance.mesh.setMatrixAt(idx, instance.dummy.matrix);\r\n        instance.mesh.instanceMatrix.needsUpdate = true;\r\n        \r\n        return idx;\r\n    }\r\n    \r\n    /**\r\n     * Update instanced meshes\r\n     */\r\n    updateInstancedMeshes() {\r\n        for (const [key, instance] of this.instancedMeshes.entries()) {\r\n            if (instance.mesh.instanceMatrix.needsUpdate) {\r\n                instance.mesh.instanceMatrix.needsUpdate = false;\r\n            }\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Remove an instance from an instanced mesh\r\n     * @param {string} key The instanced mesh identifier\r\n     * @param {number} index Index of the instance to remove\r\n     */\r\n    removeInstance(key, index) {\r\n        const instance = this.instancedMeshes.get(key);\r\n        if (!instance || index >= instance.count) return;\r\n        \r\n        // Move the last instance to this slot if it's not the last one\r\n        if (index < instance.count - 1) {\r\n            // Get the matrix of the last instance\r\n            const matrix = new THREE.Matrix4();\r\n            instance.mesh.getMatrixAt(instance.count - 1, matrix);\r\n            \r\n            // Set it at the removed index\r\n            instance.mesh.setMatrixAt(index, matrix);\r\n        }\r\n        \r\n        // Decrease count\r\n        instance.count--;\r\n        instance.mesh.count = instance.count;\r\n        instance.mesh.instanceMatrix.needsUpdate = true;\r\n    }\r\n\r\n    /**\r\n     * Update performance counters and render stats\r\n     */\r\n    updatePerformanceCounters(renderer) {\r\n        // reset counters\r\n        this._frameDrawCalls = 0;\r\n        this._frameVisibleInstances = 0;\r\n\r\n        // count visible instances from instancedMeshes map\r\n        try {\r\n            for (const [, inst] of this.instancedMeshes) {\r\n                if (inst && inst.mesh) {\r\n                    this._frameVisibleInstances += inst.mesh.count || 0;\r\n                }\r\n            }\r\n        } catch {}\r\n\r\n        // track render start\r\n        const ctx = renderer.info;\r\n        const startCalls = ctx.render.calls;\r\n        \r\n        return startCalls;\r\n    }\r\n\r\n    /**\r\n     * Finalize performance counters after rendering\r\n     */\r\n    finalizePerformanceCounters(renderer, startCalls) {\r\n        const endCalls = renderer.info.render.calls;\r\n        this._frameDrawCalls = Math.max(0, endCalls - startCalls);\r\n\r\n        if (window.__perf) {\r\n            window.__perf.drawCalls = endCalls; // total since reset\r\n            window.__perf.visibleInstances = this._frameVisibleInstances;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Properly dispose of Three.js resources to prevent memory leaks\r\n     */\r\n    dispose() {\r\n        console.log(\"Disposing instanced meshes...\");\r\n        \r\n        // Dispose of instanced meshes\r\n        this.instancedMeshes.forEach(instance => {\r\n            if (instance.mesh) {\r\n                if (instance.mesh.geometry) instance.mesh.geometry.dispose();\r\n                if (instance.mesh.material) {\r\n                    if (Array.isArray(instance.mesh.material)) {\r\n                        instance.mesh.material.forEach(material => material.dispose());\r\n                    } else {\r\n                        instance.mesh.material.dispose();\r\n                    }\r\n                }\r\n                this.scene.remove(instance.mesh);\r\n            }\r\n        });\r\n        \r\n        this.instancedMeshes.clear();\r\n    }\r\n\r\n    /**\r\n     * Helper method to dispose of materials and their textures\r\n     * @param {THREE.Material} material The material to dispose\r\n     */\r\n    disposeMaterial(material) {\r\n        // Dispose textures\r\n        for (const propertyName in material) {\r\n            const property = material[propertyName];\r\n            if (property && property.isTexture) {\r\n                property.dispose();\r\n            }\r\n        }\r\n        \r\n        // Dispose the material itself\r\n        material.dispose();\r\n    }\r\n}","// volumetricLighting.js - Handles volumetric lighting effects and light position updates\r\n\r\nimport * as THREE from 'three';\r\n\r\nexport class VolumetricLightingManager {\r\n    constructor(postProcessingManager, sceneApiManager, camera) {\r\n        this.postProcessingManager = postProcessingManager;\r\n        this.sceneApiManager = sceneApiManager;\r\n        this.camera = camera;\r\n    }\r\n\r\n    /**\r\n     * Update volumetric light ray position if sun is present\r\n     */\r\n    update() {\r\n        if (this.postProcessingManager.volumetricLightEnabled) {\r\n            if (this.postProcessingManager.useClaudeRays) {\r\n                this.updateClaudeRayPosition();\r\n            } else {\r\n                this.updateVolumetricLightPosition();\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Update the light position for Claude Rays\r\n     */\r\n    updateClaudeRayPosition() {\r\n        try {\r\n            // Ensure we have the required objects\r\n            if (!this.postProcessingManager.claudeRayPass || !this.postProcessingManager.claudeRayPass.uniforms || !this.postProcessingManager.claudeRayPass.uniforms.lightPosition) {\r\n                return;\r\n            }\r\n            \r\n            if (!this.camera) {\r\n                return;\r\n            }\r\n            \r\n            // Try to find the sun in the scene\r\n            let sun = this.sceneApiManager.findSunObject();\r\n            \r\n            if (sun) {\r\n                // Get sun world position\r\n                const sunWorldPos = new THREE.Vector3();\r\n                sun.getWorldPosition(sunWorldPos);\r\n                \r\n                // Create a vector to hold the screen position\r\n                const screenVector = sunWorldPos.clone();\r\n                \r\n                // Project to camera space\r\n                screenVector.project(this.camera);\r\n                \r\n                // Convert to normalized device coordinates (NDC)\r\n                const x = (screenVector.x + 1) / 2;\r\n                const y = (screenVector.y + 1) / 2;\r\n                \r\n                // Update the shader uniform with the new position\r\n                this.postProcessingManager.claudeRayPass.uniforms.lightPosition.value.set(x, y);\r\n            } else {\r\n                // Default to center if sun not found\r\n                this.postProcessingManager.claudeRayPass.uniforms.lightPosition.value.set(0.5, 0.5);\r\n            }\r\n        } catch (error) {\r\n            console.warn('Error updating Claude Ray position:', error);\r\n            \r\n            // Set a default position in case of error\r\n            if (this.postProcessingManager.claudeRayPass && this.postProcessingManager.claudeRayPass.uniforms && this.postProcessingManager.claudeRayPass.uniforms.lightPosition) {\r\n                this.postProcessingManager.claudeRayPass.uniforms.lightPosition.value.set(0.5, 0.5);\r\n            }\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Update the light position for volumetric rays\r\n     */\r\n    updateVolumetricLightPosition() {\r\n        try {\r\n            // Ensure we have the required objects\r\n            if (!this.postProcessingManager.godRayPass || !this.postProcessingManager.godRayPass.uniforms || !this.postProcessingManager.godRayPass.uniforms.lightPosition) {\r\n                return;\r\n            }\r\n            \r\n            if (!this.camera) {\r\n                return;\r\n            }\r\n            \r\n            // Try to find the sun in the scene\r\n            let sun = this.sceneApiManager.findSunObject();\r\n            \r\n            if (sun) {\r\n                // Get sun world position\r\n                const sunWorldPos = new THREE.Vector3();\r\n                sun.getWorldPosition(sunWorldPos);\r\n                \r\n                // Create a vector to hold the screen position\r\n                const screenVector = sunWorldPos.clone();\r\n                \r\n                // Project to camera space\r\n                screenVector.project(this.camera);\r\n                \r\n                // Convert to normalized device coordinates (NDC)\r\n                const x = (screenVector.x + 1) / 2;\r\n                const y = (screenVector.y + 1) / 2;\r\n                \r\n                // Calculate distance from camera to sun for attenuation\r\n                const camToSunDistance = this.camera.position.distanceTo(sunWorldPos);\r\n                \r\n                // Update the shader uniforms\r\n                this.postProcessingManager.godRayPass.uniforms.lightPosition.value.set(x, y);\r\n                \r\n                // Update distance - normalized to 0-1 range for shader\r\n                // Base the max distance on the sun's size and visibility range\r\n                const maxDistance = 130000; // Increased from 100000 for longer rays\r\n                const normalizedDistance = Math.min(1.0, camToSunDistance / maxDistance);\r\n                this.postProcessingManager.godRayPass.uniforms.sunDistance.value = normalizedDistance;\r\n                \r\n                // Calculate if sun is in front of camera (dot product with camera direction)\r\n                const camDirection = new THREE.Vector3(0, 0, -1).applyQuaternion(this.camera.quaternion);\r\n                const sunDirection = new THREE.Vector3().subVectors(sunWorldPos, this.camera.position).normalize();\r\n                const dotProduct = camDirection.dot(sunDirection);\r\n                \r\n                // Sun is visible when dot product is positive (sun is in front of camera)\r\n                this.postProcessingManager.godRayPass.uniforms.sunVisibility.value = Math.max(0, dotProduct);\r\n            } else {\r\n                // Default to center if sun not found\r\n                this.postProcessingManager.godRayPass.uniforms.lightPosition.value.set(0.5, 0.5);\r\n                this.postProcessingManager.godRayPass.uniforms.sunDistance.value = 1.0; // Far away\r\n                this.postProcessingManager.godRayPass.uniforms.sunVisibility.value = 0.0; // Not visible\r\n            }\r\n        } catch (error) {\r\n            console.warn('Error updating volumetric light position:', error);\r\n            \r\n            // Set default values in case of error\r\n            if (this.postProcessingManager.godRayPass && this.postProcessingManager.godRayPass.uniforms) {\r\n                if (this.postProcessingManager.godRayPass.uniforms.lightPosition) {\r\n                    this.postProcessingManager.godRayPass.uniforms.lightPosition.value.set(0.5, 0.5);\r\n                }\r\n                if (this.postProcessingManager.godRayPass.uniforms.sunDistance) {\r\n                    this.postProcessingManager.godRayPass.uniforms.sunDistance.value = 1.0;\r\n                }\r\n                if (this.postProcessingManager.godRayPass.uniforms.sunVisibility) {\r\n                    this.postProcessingManager.godRayPass.uniforms.sunVisibility.value = 0.0;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Toggle the type of volumetric lighting effect\r\n     * @param {boolean} useClaudeRays - If true, use original Claude Rays; if false, use new god rays\r\n     */\r\n    setRayType(useClaudeRays) {\r\n        this.postProcessingManager.useClaudeRays = useClaudeRays;\r\n        \r\n        // Enable/disable appropriate shader passes\r\n        if (this.postProcessingManager.claudeRayPass) {\r\n            this.postProcessingManager.claudeRayPass.enabled = this.postProcessingManager.volumetricLightEnabled && this.postProcessingManager.useClaudeRays;\r\n        }\r\n        \r\n        if (this.postProcessingManager.godRayPass) {\r\n            this.postProcessingManager.godRayPass.enabled = this.postProcessingManager.volumetricLightEnabled && !this.postProcessingManager.useClaudeRays;\r\n        }\r\n        \r\n        console.log(`Using ${this.postProcessingManager.useClaudeRays ? 'Claude Rays' : 'Volumetric God Rays'} effect`);\r\n    }\r\n    \r\n    /**\r\n     * Toggle volumetric light rays effect (master toggle)\r\n     * @param {boolean} enabled Whether to enable or disable all ray effects\r\n     */\r\n    setVolumetricLightEnabled(enabled) {\r\n        this.postProcessingManager.volumetricLightEnabled = enabled;\r\n        \r\n        // Update enabled state of current ray effect\r\n        if (this.postProcessingManager.useClaudeRays && this.postProcessingManager.claudeRayPass) {\r\n            this.postProcessingManager.claudeRayPass.enabled = enabled;\r\n        } else if (this.postProcessingManager.godRayPass) {\r\n            this.postProcessingManager.godRayPass.enabled = enabled;\r\n        }\r\n        \r\n        console.log(`Volumetric lighting ${enabled ? 'enabled' : 'disabled'}`);\r\n    }\r\n    \r\n    /**\r\n     * Update volumetric light parameters for the new god ray shader\r\n     * @param {Object} params Parameters to update\r\n     */\r\n    updateVolumetricLightParams(params = {}) {\r\n        if (!this.postProcessingManager.godRayPass || !this.postProcessingManager.godRayPass.uniforms) return;\r\n        \r\n        const uniforms = this.postProcessingManager.godRayPass.uniforms;\r\n        \r\n        if (params.intensity !== undefined) uniforms.intensity.value = params.intensity;\r\n        if (params.decay !== undefined) uniforms.decay.value = params.decay;\r\n        if (params.density !== undefined) uniforms.density.value = params.density;\r\n        if (params.weight !== undefined) uniforms.weight.value = params.weight;\r\n        if (params.samples !== undefined) uniforms.samples.value = params.samples;\r\n        if (params.sunColor !== undefined) uniforms.sunColor.value = new THREE.Color(params.sunColor);\r\n        if (params.scattering !== undefined) uniforms.scattering.value = params.scattering;\r\n        if (params.attenuationMultiplier !== undefined) uniforms.attenuationMultiplier.value = params.attenuationMultiplier;\r\n    }\r\n    \r\n    /**\r\n     * Update Claude Ray parameters\r\n     * @param {Object} params Parameters to update\r\n     */\r\n    updateClaudeRayParams(params = {}) {\r\n        if (!this.postProcessingManager.claudeRayPass || !this.postProcessingManager.claudeRayPass.uniforms) return;\r\n        \r\n        const uniforms = this.postProcessingManager.claudeRayPass.uniforms;\r\n        \r\n        if (params.exposure !== undefined) uniforms.exposure.value = params.exposure;\r\n        if (params.decay !== undefined) uniforms.decay.value = params.decay;\r\n        if (params.density !== undefined) uniforms.density.value = params.density;\r\n        if (params.weight !== undefined) uniforms.weight.value = params.weight;\r\n        if (params.lightColor !== undefined) uniforms.lightColor.value = new THREE.Color(params.lightColor);\r\n    }\r\n    \r\n    /**\r\n     * Set overall volumetric light ray intensity with a single parameter\r\n     * @param {number} intensity Value from 0-1 controlling overall ray intensity\r\n     */\r\n    setVolumetricLightIntensity(intensity) {\r\n        if (this.postProcessingManager.useClaudeRays) {\r\n            // For Claude Rays\r\n            if (!this.postProcessingManager.claudeRayPass || !this.postProcessingManager.claudeRayPass.uniforms) return;\r\n            \r\n            // Clamp intensity between 0 and 1\r\n            intensity = Math.max(0, Math.min(1, intensity));\r\n            \r\n            // Scale the intensity to reasonable parameter ranges\r\n            const exposure = 0.2 + (intensity * 0.4);  // Range: 0.2-0.6\r\n            const weight = 0.15 + (intensity * 0.25);  // Range: 0.15-0.4\r\n            const density = 0.7 + (intensity * 0.3);   // Range: 0.7-1.0\r\n            \r\n            // Update the shader parameters\r\n            this.updateClaudeRayParams({\r\n                exposure: exposure,\r\n                weight: weight,\r\n                density: density\r\n            });\r\n        } else {\r\n            // For new god rays\r\n            if (!this.postProcessingManager.godRayPass || !this.postProcessingManager.godRayPass.uniforms) return;\r\n            \r\n            // Clamp intensity between 0 and 1\r\n            intensity = Math.max(0, Math.min(1, intensity));\r\n            \r\n            // Scale intensity for new shader parameters with higher base values\r\n            this.updateVolumetricLightParams({\r\n                intensity: 0.3 + (intensity * 0.4),  // Increased base intensity\r\n                weight: 0.35 + (intensity * 0.3),    // Increased from 0.3 + intensity * 0.2\r\n                density: 0.45 + (intensity * 0.25),  // Increased from 0.4 + intensity * 0.2\r\n                scattering: 0.25 + (intensity * 0.25) // Increased from 0.2 + intensity * 0.2\r\n            });\r\n        }\r\n        \r\n        console.log(`Volumetric light intensity set to ${intensity.toFixed(2)}`);\r\n    }\r\n}","// renderer.js - Main renderer orchestrator delegating to specialized submodules\r\n\r\nimport * as THREE from 'three';\r\nimport WebGL from 'three/addons/capabilities/WebGL.js';\r\nimport { LightingManager } from './renderer/lighting.js';\r\nimport { PostProcessingManager } from './renderer/post.js';\r\nimport { SceneApiManager } from './renderer/sceneApi.js';\r\nimport { RenderHelpers } from './renderer/helpers.js';\r\nimport { VolumetricLightingManager } from './renderer/volumetricLighting.js';\r\n\r\nexport class Renderer {\r\n    constructor() {\r\n        console.log(\"Initializing enhanced renderer...\");\r\n        \r\n        // Check for WebGL 2 support\r\n        if (!WebGL.isWebGL2Available()) {\r\n            const warning = WebGL.getWebGL2ErrorMessage();\r\n            document.body.appendChild(warning);\r\n            console.error(\"WebGL 2 is required but not available.\");\r\n            throw new Error(\"WebGL 2 not available\");\r\n        } else {\r\n            console.log(\"WebGL 2 is available.\");\r\n        }\r\n        \r\n        this.scene = new THREE.Scene();\r\n        this.camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 0.1, 400000);\r\n        \r\n        // Create renderer with HDR support\r\n        this.renderer = new THREE.WebGLRenderer({ \r\n            antialias: true,\r\n            powerPreference: \"high-performance\",\r\n            logarithmicDepthBuffer: true, // Better for space scenes with huge distance ranges\r\n            stencil: true, // Explicitly enable stencil buffer (default changed to false in r163)\r\n        });\r\n        \r\n        // Enable shadow mapping\r\n        this.renderer.shadowMap.enabled = true;\r\n        this.renderer.shadowMap.type = THREE.PCFSoftShadowMap;\r\n        \r\n        // Use the new physically correct lighting system (default in r155+)\r\n        this.renderer.useLegacyLights = false;\r\n        \r\n        // Set tone mapping for HDR rendering\r\n        this.renderer.toneMapping = THREE.ACESFilmicToneMapping;\r\n        this.renderer.toneMappingExposure = 1.0;\r\n        \r\n        this.setupRenderer();\r\n        \r\n        // Initialize submodules\r\n        this.lightingManager = new LightingManager(this.scene, this.renderer, this.camera);\r\n        this.postProcessingManager = new PostProcessingManager(this.renderer, this.scene, this.camera);\r\n        this.sceneApiManager = new SceneApiManager(this.scene);\r\n        this.renderHelpers = new RenderHelpers(this.scene);\r\n        this.volumetricLightingManager = new VolumetricLightingManager(this.postProcessingManager, this.sceneApiManager, this.camera);\r\n        \r\n        // Setup through submodules\r\n        this.lightingManager.setupLighting();\r\n        this.postProcessingManager.setupPostProcessing();\r\n        this.setupResizeHandler();\r\n        \r\n        // Store reference for sun to access\r\n        this.scene.lightingManager = this.lightingManager;\r\n        \r\n        // Interpolation alpha provided by main\r\n        this.renderAlpha = 0;\r\n        \r\n        console.log(\"Enhanced renderer initialized successfully\");\r\n    }\r\n    \r\n    setupRenderer() {\r\n        this.renderer.setSize(window.innerWidth, window.innerHeight);\r\n        this.renderer.setClearColor(0x000000);\r\n        document.body.appendChild(this.renderer.domElement);\r\n        \r\n        // Set the output color space to sRGB\r\n        this.renderer.outputColorSpace = THREE.SRGBColorSpace;\r\n        \r\n        // Position camera - brought closer for better visibility\r\n        this.camera.position.z = 10;\r\n        \r\n        // Make sure the camera can see far enough to show the skybox\r\n        this.camera.far = 400000;\r\n        this.camera.updateProjectionMatrix();\r\n\r\n        // Enhance shadow mapping for better quality eclipse effects\r\n        this.renderer.shadowMap.enabled = true;\r\n        this.renderer.shadowMap.type = THREE.PCFSoftShadowMap;\r\n        this.renderer.shadowMap.autoUpdate = true;\r\n    }\r\n    \r\n    // Post-processing setup is now handled by PostProcessingManager\r\n    \r\n    // Volumetric lighting setup is now handled by PostProcessingManager and VolumetricLightingManager\r\n    \r\n    // Lighting setup is now handled by LightingManager\r\n    \r\n    setupResizeHandler() {\r\n        window.addEventListener('resize', () => {\r\n            this.handleResize();\r\n        });\r\n    }\r\n    \r\n    // Explicitly define getter methods for scene and camera\r\n    getScene() {\r\n        return this.scene;\r\n    }\r\n    \r\n    getCamera() {\r\n        return this.camera;\r\n    }\r\n    \r\n    // Resize handler method\r\n    handleResize() {\r\n        this.camera.aspect = window.innerWidth / window.innerHeight;\r\n        this.camera.updateProjectionMatrix();\r\n        this.renderer.setSize(window.innerWidth, window.innerHeight);\r\n        \r\n        // Update lighting manager's post-processing\r\n        if (this.lightingManager) {\r\n            this.lightingManager.handleResize();\r\n        }\r\n        \r\n        // Update composer size if it exists\r\n        if (this.composer) {\r\n            this.composer.setSize(window.innerWidth, window.innerHeight);\r\n        \r\n            // Update FXAA resolution\r\n            try {\r\n                const pixelRatio = this.renderer.getPixelRatio();\r\n                const fxaaPass = this.composer.passes.find(pass => \r\n                    pass.material && \r\n                    pass.material.uniforms && \r\n                    pass.material.uniforms.resolution &&\r\n                    pass.material.uniforms.resolution.value\r\n                );\r\n                \r\n                if (fxaaPass) {\r\n                    fxaaPass.material.uniforms.resolution.value.x = 1 / (window.innerWidth * pixelRatio);\r\n                    fxaaPass.material.uniforms.resolution.value.y = 1 / (window.innerHeight * pixelRatio);\r\n                }\r\n            } catch (error) {\r\n                console.warn(\"Error updating FXAA resolution:\", error);\r\n            }\r\n        }\r\n    }\r\n    \r\n    // Add an object to the scene through guarded path\r\n    add(object) {\r\n        return this._withGuard(() => this.scene.add(object));\r\n    }\r\n    \r\n    // Allow dynamic adjustment of post-processing settings\r\n    adjustBloom(strength, radius, threshold) {\r\n        if (this.bloomPass) {\r\n            this.bloomPass.strength = strength !== undefined ? strength : this.bloomPass.strength;\r\n            this.bloomPass.radius = radius !== undefined ? radius : this.bloomPass.radius;\r\n            this.bloomPass.threshold = threshold !== undefined ? threshold : this.bloomPass.threshold;\r\n        }\r\n    }\r\n    \r\n    // Update for dynamic visual effects\r\n    update(deltaTime) {\r\n        // Update film grain with time for animation\r\n        if (this.filmPass && this.filmPass.uniforms && this.filmPass.uniforms.time && this.filmPass.uniforms.time.value !== undefined) {\r\n            try {\r\n                this.filmPass.uniforms.time.value += deltaTime;\r\n            } catch (error) {\r\n                console.warn(\"Error updating film pass time:\", error);\r\n            }\r\n        }\r\n        \r\n        // Update volumetric light ray position if sun is present\r\n        if (this.volumetricLightEnabled) {\r\n            if (this.useClaudeRays) {\r\n                this.updateClaudeRayPosition();\r\n            } else {\r\n                this.updateVolumetricLightPosition();\r\n            }\r\n        }\r\n        \r\n        // Update instanced meshes\r\n        this.updateInstancedMeshes();\r\n    }\r\n    \r\n    // Volumetric lighting position updates are now handled by VolumetricLightingManager\r\n    // Volumetric lighting position updates are now handled by VolumetricLightingManager\r\n    // Sun object finding is now handled by SceneApiManager\r\n    \r\n    // Override the render method to use the composer if available, otherwise fallback to basic rendering\r\n    render() {\r\n        // Update performance counters\r\n        const startCalls = this.renderHelpers.updatePerformanceCounters(this.renderer);\r\n        \r\n        // Delegate to post-processing manager\r\n        this.postProcessingManager.render();\r\n        \r\n        // Finalize performance counters\r\n        this.renderHelpers.finalizePerformanceCounters(this.renderer, startCalls);\r\n    }\r\n\r\n    // Interpolate ECS meshes before compositing\r\n    interpolateMeshes(alpha) {\r\n        this.renderAlpha = alpha;\r\n        this.sceneApiManager.interpolateMeshes(alpha);\r\n    }\r\n\r\n    // Facade API for views - delegated to SceneApiManager\r\n    addView(entityId, viewDef) {\r\n        this.sceneApiManager.addView(entityId, viewDef);\r\n    }\r\n\r\n    removeView(entityId) {\r\n        this.sceneApiManager.removeView(entityId);\r\n    }\r\n\r\n    _withGuard(fn) {\r\n        return this.sceneApiManager._withGuard(fn);\r\n    }\r\n\r\n    updateView(entityId, props) {\r\n        this.sceneApiManager.updateView(entityId, props);\r\n    }\r\n    \r\n    /**\r\n     * Create an instanced mesh for efficient rendering of many similar objects\r\n     */\r\n    createInstancedMesh(key, geometry, material, maxCount) {\r\n        return this.renderHelpers.createInstancedMesh(key, geometry, material, maxCount);\r\n    }\r\n    \r\n    /**\r\n     * Add or update an instance in an instanced mesh\r\n     */\r\n    updateInstance(key, index, position, quaternion, scale) {\r\n        return this.renderHelpers.updateInstance(key, index, position, quaternion, scale);\r\n    }\r\n    \r\n    /**\r\n     * Update instanced meshes\r\n     */\r\n    updateInstancedMeshes() {\r\n        this.renderHelpers.updateInstancedMeshes();\r\n    }\r\n    \r\n    /**\r\n     * Remove an instance from an instanced mesh\r\n     */\r\n    removeInstance(key, index) {\r\n        this.renderHelpers.removeInstance(key, index);\r\n    }\r\n    \r\n    /**\r\n     * Properly dispose of Three.js resources to prevent memory leaks\r\n     */\r\n    dispose() {\r\n        console.log(\"Disposing renderer resources...\");\r\n        \r\n        // Remove event listener\r\n        window.removeEventListener('resize', this.handleResize);\r\n        \r\n        // Dispose submodules\r\n        this.postProcessingManager.dispose();\r\n        this.lightingManager.dispose();\r\n        this.renderHelpers.dispose();\r\n        \r\n        // Dispose of scene objects\r\n        this.scene.traverse(object => {\r\n            if (object.geometry) object.geometry.dispose();\r\n            \r\n            if (object.material) {\r\n                if (Array.isArray(object.material)) {\r\n                    object.material.forEach(material => this.renderHelpers.disposeMaterial(material));\r\n                } else {\r\n                    this.renderHelpers.disposeMaterial(object.material);\r\n                }\r\n            }\r\n        });\r\n        \r\n        // Dispose of renderer\r\n        this.renderer.dispose();\r\n        \r\n        console.log(\"Renderer resources disposed\");\r\n    }\r\n    // Material disposal is now handled by RenderHelpers\r\n    // Shader creation is now handled by shaders.js module\r\n    // Shader creation is now handled by shaders.js module\r\n    \r\n    /**\r\n     * Toggle the type of volumetric lighting effect\r\n     */\r\n    setRayType(useClaudeRays) {\r\n        this.volumetricLightingManager.setRayType(useClaudeRays);\r\n        this.lightingManager.adjustLightingForRayType(useClaudeRays);\r\n    }\r\n    // Lighting adjustment is now handled by LightingManager\r\n    \r\n    /**\r\n     * Toggle volumetric light rays effect (master toggle)\r\n     */\r\n    setVolumetricLightEnabled(enabled) {\r\n        this.volumetricLightingManager.setVolumetricLightEnabled(enabled);\r\n    }\r\n    \r\n    /**\r\n     * Update volumetric light parameters for the new god ray shader\r\n     */\r\n    updateVolumetricLightParams(params = {}) {\r\n        this.volumetricLightingManager.updateVolumetricLightParams(params);\r\n    }\r\n    \r\n    /**\r\n     * Update Claude Ray parameters\r\n     */\r\n    updateClaudeRayParams(params = {}) {\r\n        this.volumetricLightingManager.updateClaudeRayParams(params);\r\n    }\r\n    \r\n    /**\r\n     * Set overall volumetric light ray intensity with a single parameter\r\n     */\r\n    setVolumetricLightIntensity(intensity) {\r\n        this.volumetricLightingManager.setVolumetricLightIntensity(intensity);\r\n    }\r\n}","// trail.js - Thruster exhaust effects for spaceship\r\n\r\nimport * as THREE from 'three';\r\n\r\nexport class TrailEffects {\r\n    constructor(scene, mesh) {\r\n        this.scene = scene;\r\n        this.mesh = mesh; // The spaceship mesh\r\n        this.thrusterEffects = [];\r\n        this.time = 0;\r\n        \r\n        // Initialize effects\r\n        this.createThrusterEffects();\r\n    }\r\n    \r\n    createThrusterEffects() {\r\n        // Create exhaust beam effect using multiple overlapping cylinders\r\n        const createExhaustBeam = (position, direction, config) => {\r\n            const { baseRadius, length, color, glowColor, type } = config;\r\n            const group = new THREE.Group();\r\n            \r\n            // Create multiple cylinder segments for tapered effect\r\n            const segments = 8;\r\n            const beams = [];\r\n            \r\n            for (let i = 0; i < segments; i++) {\r\n                const t = i / segments;\r\n                \r\n                // Taper the radius\r\n                const topRadius = baseRadius * (1 - t * 0.7);\r\n                const bottomRadius = baseRadius * (1 - (t + 1/segments) * 0.7);\r\n                const segmentLength = length / segments;\r\n                \r\n                // Create cylinder geometry\r\n                const geometry = new THREE.CylinderGeometry(\r\n                    topRadius,\r\n                    bottomRadius,\r\n                    segmentLength,\r\n                    12, // More segments for smoother look\r\n                    1,\r\n                    false\r\n                );\r\n                \r\n                // Create material with gradient\r\n                const material = new THREE.MeshBasicMaterial({\r\n                    color: new THREE.Color(color).lerp(new THREE.Color(glowColor), t),\r\n                    transparent: true,\r\n                    opacity: 1.0 - t * 0.3, // High opacity\r\n                    blending: THREE.AdditiveBlending,\r\n                    side: THREE.DoubleSide,\r\n                    depthTest: false // Always render on top\r\n                });\r\n                \r\n                const beam = new THREE.Mesh(geometry, material);\r\n                \r\n                // Position each segment along the exhaust direction\r\n                if (direction.z !== 0) {\r\n                    // Main/reverse thrusters - point along Z\r\n                    geometry.rotateX(Math.PI / 2);\r\n                    beam.position.z = direction.z * (i * segmentLength + segmentLength/2);\r\n                } else if (direction.x !== 0) {\r\n                    // Side thrusters - point along X (perpendicular to ship)\r\n                    geometry.rotateZ(Math.PI / 2);\r\n                    beam.position.x = direction.x * (i * segmentLength + segmentLength/2);\r\n                }\r\n                \r\n                beams.push({ mesh: beam, material });\r\n                group.add(beam);\r\n            }\r\n            \r\n            // Position the group at the thruster location\r\n            group.position.copy(position);\r\n            \r\n            group.visible = false;\r\n            \r\n            // Debug: log thruster creation  \r\n            // console.log(`Created ${type} thruster at position:`, position);\r\n            this.mesh.add(group);\r\n            \r\n            return { group, beams, type };\r\n        };\r\n        \r\n        // Main thruster - big blue/orange exhaust\r\n        this.thrusterEffects.push(createExhaustBeam(\r\n            new THREE.Vector3(0, 0, 1.2), // Back of ship (ship scale is 2.0)\r\n            new THREE.Vector3(0, 0, 1), // Points backward\r\n            {\r\n                baseRadius: 0.25, // Scaled for ship size\r\n                length: 2.5, // Good length for exhaust\r\n                color: 0xffaa00, // Orange core\r\n                glowColor: 0x0088ff, // Blue edges\r\n                type: 'main'\r\n            }\r\n        ));\r\n        \r\n        // RIGHT side thruster - fires when A pressed to push ship LEFT\r\n        this.thrusterEffects.push(createExhaustBeam(\r\n            new THREE.Vector3(0.7, 0, 0.2), // Right side of ship\r\n            new THREE.Vector3(1, 0, 0), // Shoots right (away from ship)\r\n            {\r\n                baseRadius: 0.15,\r\n                length: 1.0, // Shorter exhaust\r\n                color: 0xffaa00,\r\n                glowColor: 0x00aaff,\r\n                type: 'right_thruster' // RIGHT thruster\r\n            }\r\n        ));\r\n        \r\n        // LEFT side thruster - fires when D pressed to push ship RIGHT\r\n        this.thrusterEffects.push(createExhaustBeam(\r\n            new THREE.Vector3(-0.7, 0, 0.2), // Left side of ship\r\n            new THREE.Vector3(-1, 0, 0), // Shoots left (away from ship)\r\n            {\r\n                baseRadius: 0.15,\r\n                length: 1.0, // Shorter exhaust\r\n                color: 0xffaa00,\r\n                glowColor: 0x00aaff,\r\n                type: 'left_thruster' // LEFT thruster\r\n            }\r\n        ));\r\n        \r\n        // Reverse thruster\r\n        this.thrusterEffects.push(createExhaustBeam(\r\n            new THREE.Vector3(0, 0, -1.2), // Front of ship\r\n            new THREE.Vector3(0, 0, -1), // Points forward\r\n            {\r\n                baseRadius: 0.2,\r\n                length: 1.8,\r\n                color: 0xff8800,\r\n                glowColor: 0xff4400,\r\n                type: 'reverse'\r\n            }\r\n        ));\r\n    }\r\n    \r\n    updateParticles(thrust, velocity) {\r\n        this.time += 0.016;\r\n        \r\n        // Check window.inputIntent for keyboard controls\r\n        const intent = window.inputIntent || 0;\r\n        const leftPressed = thrust.left || ((intent & 4) !== 0);  // A key\r\n        const rightPressed = thrust.right || ((intent & 8) !== 0); // D key\r\n        \r\n        // Update each thruster effect\r\n        this.thrusterEffects.forEach(effect => {\r\n            const { group, beams, type } = effect;\r\n            \r\n            let shouldShow = false;\r\n            let intensity = 0;\r\n            \r\n            // Determine visibility based on thrust\r\n            switch(type) {\r\n                case 'main':\r\n                    shouldShow = thrust.forward || velocity.length() > 1.0;\r\n                    intensity = thrust.forward ? (thrust.boost ? 1.5 : 1.0) : 0.5;\r\n                    break;\r\n                case 'right_thruster':\r\n                    // RIGHT thruster fires when A pressed (to move ship LEFT)\r\n                    shouldShow = leftPressed; // A key\r\n                    intensity = thrust.boost ? 1.5 : 1.2;\r\n                    // if (shouldShow) console.log('RIGHT thruster firing to move LEFT');\r\n                    break;\r\n                case 'left_thruster':\r\n                    // LEFT thruster fires when D pressed (to move ship RIGHT)\r\n                    shouldShow = rightPressed; // D key\r\n                    intensity = thrust.boost ? 1.5 : 1.2;\r\n                    // if (shouldShow) console.log('LEFT thruster firing to move RIGHT');\r\n                    break;\r\n                case 'reverse':\r\n                    shouldShow = thrust.backward;\r\n                    intensity = thrust.boost ? 1.3 : 1.0;\r\n                    break;\r\n            }\r\n            \r\n            group.visible = shouldShow;\r\n            \r\n            if (shouldShow && beams) {\r\n                // Animate the exhaust\r\n                beams.forEach((beam, index) => {\r\n                    const t = index / beams.length;\r\n                    \r\n                    // Very subtle flicker\r\n                    const flicker = 0.95 + Math.sin(this.time * 10 + index) * 0.05;\r\n                    \r\n                    // Update opacity for animation - ensure visibility\r\n                    beam.material.opacity = Math.max(0.7, (1.0 - t * 0.2) * intensity * flicker);\r\n                    \r\n                    // Subtle scale animation\r\n                    beam.mesh.scale.x = beam.mesh.scale.y = 1.0 + Math.sin(this.time * 8 + index) * 0.05;\r\n                    beam.mesh.scale.z = 1.0 + intensity * 0.3; // Longer when boosting\r\n                });\r\n            }\r\n        });\r\n    }\r\n    \r\n    updateTrailVisibility(isMoving, thrust, velocity) {\r\n        // Update main thruster visibility based on movement\r\n        const mainEffect = this.thrusterEffects.find(e => e.type === 'main');\r\n        if (mainEffect) {\r\n            const shouldShow = thrust.forward || (isMoving && velocity.length() > 2.0);\r\n            mainEffect.group.visible = shouldShow;\r\n        }\r\n    }\r\n    \r\n    dispose() {\r\n        // Clean up all thruster effects\r\n        this.thrusterEffects.forEach(effect => {\r\n            if (effect.group) {\r\n                if (effect.group.parent) {\r\n                    effect.group.parent.remove(effect.group);\r\n                }\r\n                \r\n                // Dispose of all children\r\n                effect.group.traverse(child => {\r\n                    if (child.geometry) child.geometry.dispose();\r\n                    if (child.material) child.material.dispose();\r\n                });\r\n            }\r\n        });\r\n        \r\n        this.thrusterEffects = [];\r\n    }\r\n}","// shipModel.js - 3D model creation for spaceship\r\n// Extracted from spaceship.js to improve maintainability\r\n\r\nimport * as THREE from 'three';\r\n\r\nexport class ShipModel {\r\n    constructor(scene, shipScale = 2.0) {\r\n        this.scene = scene;\r\n        this.shipScale = shipScale;\r\n        this.mesh = null;\r\n        this.thrusters = [];\r\n        this.leftCannon = null;\r\n        this.rightCannon = null;\r\n        this.leftEmitter = null;\r\n        this.rightEmitter = null;\r\n        this.miningLaser = null;\r\n    }\r\n\r\n    /**\r\n     * Create the complete spaceship 3D model\r\n     * @returns {THREE.Group} The spaceship mesh group\r\n     */\r\n    createSpaceship() {\r\n        // Create spaceship group\r\n        this.mesh = new THREE.Group();\r\n        \r\n        // Scale the entire ship\r\n        this.mesh.scale.set(this.shipScale, this.shipScale, this.shipScale);\r\n        \r\n        // Set initial position to a safe location far from the sun\r\n        this.mesh.position.set(0, 2000, 0); // Position near stargate initially\r\n        \r\n        // Create the main body of the ship - sleek aerodynamic design using basic geometries\r\n        // Use a cylinder with a cone at the front instead of CapsuleGeometry\r\n        const bodyGroup = new THREE.Group();\r\n        \r\n        // Main hull cylinder\r\n        const cylinderGeometry = new THREE.CylinderGeometry(0.4, 0.5, 1.8, 12);\r\n        const bodyMaterial = new THREE.MeshPhongMaterial({ \r\n            color: 0xFFFFFF, // White base\r\n            specular: 0xFFD700, // Gold specular highlights\r\n            shininess: 100,\r\n            emissive: 0x222222,\r\n            emissiveIntensity: 0.1\r\n        });\r\n        \r\n        const bodyCylinder = new THREE.Mesh(cylinderGeometry, bodyMaterial);\r\n        bodyCylinder.rotation.x = Math.PI / 2; // Rotate to point forward\r\n        bodyGroup.add(bodyCylinder);\r\n        \r\n        // Front nose cone\r\n        const noseGeometry = new THREE.ConeGeometry(0.4, 0.8, 12);\r\n        const noseCone = new THREE.Mesh(noseGeometry, bodyMaterial);\r\n        noseCone.position.set(0, 0, -1.2);\r\n        noseCone.rotation.x = -Math.PI / 2; // Point forward\r\n        bodyGroup.add(noseCone);\r\n        \r\n        // Add the complete body to the ship\r\n        this.mesh.add(bodyGroup);\r\n        \r\n        // Add cockpit - glass dome\r\n        this._createCockpit();\r\n        \r\n        // Add dual front cannons\r\n        this._createCannons();\r\n        \r\n        // Add cannon emitters (glowing tips)\r\n        this._createEmitters();\r\n        \r\n        // Create mining laser emitter (use one of the cannons for mining)\r\n        this.miningLaser = this.leftEmitter;\r\n        \r\n        // Add curved wings\r\n        this._createWings();\r\n        \r\n        // Add gold accents to body\r\n        this._createGoldAccents();\r\n        \r\n        // Add thrusters\r\n        this._createThrusters();\r\n        \r\n        // Add to scene\r\n        this.scene.add(this.mesh);\r\n        \r\n        return this.mesh;\r\n    }\r\n\r\n    /**\r\n     * Create the cockpit glass dome\r\n     */\r\n    _createCockpit() {\r\n        const cockpitGeometry = new THREE.SphereGeometry(0.35, 16, 16, 0, Math.PI * 2, 0, Math.PI / 2);\r\n        const cockpitMaterial = new THREE.MeshPhongMaterial({ \r\n            color: 0x88CCFF,\r\n            specular: 0xFFFFFF,\r\n            shininess: 100,\r\n            transparent: true,\r\n            opacity: 0.7,\r\n            emissive: 0x0066FF,\r\n            emissiveIntensity: 0.1\r\n        });\r\n        const cockpit = new THREE.Mesh(cockpitGeometry, cockpitMaterial);\r\n        cockpit.position.set(0, 0.25, -0.2);\r\n        cockpit.rotation.x = -Math.PI / 2;\r\n        this.mesh.add(cockpit);\r\n    }\r\n\r\n    /**\r\n     * Create the dual front cannons\r\n     */\r\n    _createCannons() {\r\n        const cannonGeometry = new THREE.CylinderGeometry(0.08, 0.06, 2.0, 8);\r\n        const cannonMaterial = new THREE.MeshPhongMaterial({ \r\n            color: 0xFFD700, // Gold\r\n            specular: 0xFFFFFF,\r\n            shininess: 80,\r\n            emissive: 0xFFD700,\r\n            emissiveIntensity: 0.2\r\n        });\r\n        \r\n        // Left cannon\r\n        this.leftCannon = new THREE.Mesh(cannonGeometry, cannonMaterial);\r\n        this.leftCannon.position.set(0.2, 0, -1.5); // Left side of cockpit\r\n        this.leftCannon.rotation.x = Math.PI / 2; // Point forward\r\n        this.mesh.add(this.leftCannon);\r\n        \r\n        // Right cannon\r\n        this.rightCannon = new THREE.Mesh(cannonGeometry, cannonMaterial);\r\n        this.rightCannon.position.set(-0.2, 0, -1.5); // Right side of cockpit\r\n        this.rightCannon.rotation.x = Math.PI / 2; // Point forward\r\n        this.mesh.add(this.rightCannon);\r\n    }\r\n\r\n    /**\r\n     * Create the cannon emitters (glowing tips)\r\n     */\r\n    _createEmitters() {\r\n        const emitterGeometry = new THREE.SphereGeometry(0.08, 16, 16);\r\n        const emitterMaterial = new THREE.MeshPhongMaterial({ \r\n            color: 0xFF6600,\r\n            emissive: 0xFF3300,\r\n            emissiveIntensity: 1\r\n        });\r\n        \r\n        // Left emitter\r\n        this.leftEmitter = new THREE.Mesh(emitterGeometry, emitterMaterial);\r\n        this.leftEmitter.position.set(0.2, 0, -2.5); // Front of left cannon\r\n        this.mesh.add(this.leftEmitter);\r\n        \r\n        // Right emitter\r\n        this.rightEmitter = new THREE.Mesh(emitterGeometry, emitterMaterial);\r\n        this.rightEmitter.position.set(-0.2, 0, -2.5); // Front of right cannon\r\n        this.mesh.add(this.rightEmitter);\r\n    }\r\n\r\n    /**\r\n     * Create curved wings using custom geometry\r\n     */\r\n    _createWings() {\r\n        const createCurvedWing = (isLeft) => {\r\n            const wingGroup = new THREE.Group();\r\n            \r\n            // Create curved wing shape using multiple segments\r\n            const wingMaterial = new THREE.MeshPhongMaterial({ \r\n                color: 0xFFFFFF, // White\r\n                specular: 0xFFD700, // Gold specular \r\n                shininess: 80,\r\n                emissive: 0xFFFFFF,\r\n                emissiveIntensity: 0.1\r\n            });\r\n            \r\n            // Wing base connecting to ship body\r\n            const wingBaseGeom = new THREE.BoxGeometry(0.1, 0.2, 0.6);\r\n            const wingBase = new THREE.Mesh(wingBaseGeom, wingMaterial);\r\n            wingBase.position.set(isLeft ? 0.55 : -0.55, 0, 0.2);\r\n            wingGroup.add(wingBase);\r\n            \r\n            // Curved part of wing - using custom curved mesh\r\n            const wingCurveGeom = new THREE.BoxGeometry(0.8, 0.1, 0.5);\r\n            const wingCurve = new THREE.Mesh(wingCurveGeom, wingMaterial);\r\n            \r\n            // Rotate and position to create curved wing effect\r\n            wingCurve.position.set(isLeft ? 1 : -1, 0, 0.2);\r\n            wingCurve.rotation.z = isLeft ? Math.PI / 8 : -Math.PI / 8;\r\n            wingGroup.add(wingCurve);\r\n            \r\n            // Wing tip with gold accent\r\n            const wingTipGeom = new THREE.BoxGeometry(0.3, 0.08, 0.3);\r\n            const goldMaterial = new THREE.MeshPhongMaterial({ \r\n                color: 0xFFD700, // Gold\r\n                specular: 0xFFFFFF, \r\n                shininess: 100,\r\n                emissive: 0xFFD700,\r\n                emissiveIntensity: 0.3\r\n            });\r\n            \r\n            const wingTip = new THREE.Mesh(wingTipGeom, goldMaterial);\r\n            wingTip.position.set(isLeft ? 1.4 : -1.4, 0, 0.2);\r\n            wingTip.rotation.z = isLeft ? Math.PI / 6 : -Math.PI / 6;\r\n            wingGroup.add(wingTip);\r\n            \r\n            return wingGroup;\r\n        };\r\n        \r\n        // Add wings to ship\r\n        const leftWing = createCurvedWing(true);\r\n        this.mesh.add(leftWing);\r\n        \r\n        const rightWing = createCurvedWing(false);\r\n        this.mesh.add(rightWing);\r\n    }\r\n\r\n    /**\r\n     * Add gold accents to the ship body\r\n     */\r\n    _createGoldAccents() {\r\n        const addGoldAccent = (width, height, depth, x, y, z, rotX = 0, rotY = 0, rotZ = 0) => {\r\n            const accentGeom = new THREE.BoxGeometry(width, height, depth);\r\n            const goldMaterial = new THREE.MeshPhongMaterial({ \r\n                color: 0xFFD700, // Gold\r\n                specular: 0xFFFFFF,\r\n                shininess: 100,\r\n                emissive: 0xFFD700,\r\n                emissiveIntensity: 0.3\r\n            });\r\n            \r\n            const accent = new THREE.Mesh(accentGeom, goldMaterial);\r\n            accent.position.set(x, y, z);\r\n            accent.rotation.set(rotX, rotY, rotZ);\r\n            this.mesh.add(accent);\r\n            return accent;\r\n        };\r\n        \r\n        // Add gold accents along the body\r\n        addGoldAccent(0.8, 0.05, 0.1, 0, -0.25, -0.3);\r\n        addGoldAccent(0.8, 0.05, 0.1, 0, -0.25, 0.3);\r\n        addGoldAccent(0.05, 0.05, 1.0, 0.3, -0.25, 0);\r\n        addGoldAccent(0.05, 0.05, 1.0, -0.3, -0.25, 0);\r\n    }\r\n\r\n    /**\r\n     * Create thrusters for the spaceship\r\n     */\r\n    _createThrusters() {\r\n        const thrusterGeometry = new THREE.CylinderGeometry(0.2, 0.15, 0.5, 8);\r\n        const thrusterMaterial = new THREE.MeshPhongMaterial({ \r\n            color: 0xFFD700, // Gold\r\n            emissive: 0xFF5500,\r\n            emissiveIntensity: 0.5\r\n        });\r\n        \r\n        // Main thrusters (back)\r\n        const mainThruster = new THREE.Mesh(thrusterGeometry, thrusterMaterial);\r\n        mainThruster.position.z = 1.2; // Position at the back of the ship\r\n        mainThruster.rotation.x = Math.PI; // Point backward\r\n        this.mesh.add(mainThruster);\r\n        this.thrusters.push({ mesh: mainThruster, type: 'main' });\r\n        \r\n        // Front/Reverse thruster (new)\r\n        const reverseThruster = new THREE.Mesh(thrusterGeometry.clone(), thrusterMaterial.clone());\r\n        reverseThruster.position.z = -1.0; // Position at the front of the ship\r\n        reverseThruster.rotation.x = 0; // Point forward\r\n        reverseThruster.scale.set(0.6, 0.6, 0.6); // Make it slightly smaller than main thruster\r\n        this.mesh.add(reverseThruster);\r\n        this.thrusters.push({ mesh: reverseThruster, type: 'reverse' });\r\n        \r\n        // Side thrusters for lateral movement\r\n        const leftThruster = new THREE.Mesh(thrusterGeometry.clone(), thrusterMaterial.clone());\r\n        leftThruster.position.set(0.5, 0, 0.5);\r\n        leftThruster.rotation.z = Math.PI / 2; // Point to the right (for leftward thrust)\r\n        leftThruster.scale.set(0.5, 0.5, 0.5); // Make side thrusters smaller\r\n        this.mesh.add(leftThruster);\r\n        this.thrusters.push({ mesh: leftThruster, type: 'left' });\r\n        \r\n        const rightThruster = new THREE.Mesh(thrusterGeometry.clone(), thrusterMaterial.clone());\r\n        rightThruster.position.set(-0.5, 0, 0.5);\r\n        rightThruster.rotation.z = -Math.PI / 2; // Point to the left (for rightward thrust)\r\n        rightThruster.scale.set(0.5, 0.5, 0.5); // Make side thrusters smaller\r\n        this.mesh.add(rightThruster);\r\n        this.thrusters.push({ mesh: rightThruster, type: 'right' });\r\n    }\r\n\r\n    /**\r\n     * Get references to important mesh components\r\n     * @returns {object} Object containing mesh references\r\n     */\r\n    getComponents() {\r\n        return {\r\n            mesh: this.mesh,\r\n            thrusters: this.thrusters,\r\n            leftCannon: this.leftCannon,\r\n            rightCannon: this.rightCannon,\r\n            leftEmitter: this.leftEmitter,\r\n            rightEmitter: this.rightEmitter,\r\n            miningLaser: this.miningLaser\r\n        };\r\n    }\r\n}","// upgrades.js - Ship upgrade systems\r\n// Extracted from spaceship.js to improve maintainability\r\n\r\nimport * as THREE from 'three';\r\n\r\nexport class ShipUpgrades {\r\n    constructor(shipComponents) {\r\n        this.components = shipComponents; // { mesh, thrusters, leftCannon, rightCannon, leftEmitter, rightEmitter }\r\n        \r\n        // Upgrade levels and costs\r\n        this.fuelTankLevel = 1;\r\n        this.fuelUpgradeCost = 1000;\r\n        \r\n        this.engineLevel = 1;\r\n        this.engineUpgradeCost = 800;\r\n        \r\n        this.miningLevel = 1;\r\n        this.miningUpgradeCost = 1200;\r\n        \r\n        this.hullLevel = 1;\r\n        this.hullUpgradeCost = 1500;\r\n        \r\n        this.scannerLevel = 1;\r\n        this.scannerUpgradeCost = 600;\r\n    }\r\n\r\n    /**\r\n     * Upgrade the fuel tank capacity\r\n     * @param {object} spaceshipState Reference to spaceship state\r\n     * @returns {number} New fuel capacity\r\n     */\r\n    upgradeFuelTank(spaceshipState) {\r\n        console.log(\"Upgrading fuel tank\");\r\n        \r\n        // Double the fuel capacity\r\n        spaceshipState.maxFuel *= 2;\r\n        \r\n        // Increase the fuel level to match the new capacity\r\n        spaceshipState.fuel = spaceshipState.maxFuel;\r\n        \r\n        // Increase the upgrade level\r\n        this.fuelTankLevel++;\r\n        \r\n        // Calculate the new upgrade cost (4x the previous cost)\r\n        this.fuelUpgradeCost *= 4;\r\n        \r\n        return spaceshipState.maxFuel;\r\n    }\r\n\r\n    /**\r\n     * Upgrade the ship's engines\r\n     * @param {object} spaceshipState Reference to spaceship state\r\n     * @returns {number} New max velocity\r\n     */\r\n    upgradeEngine(spaceshipState) {\r\n        console.log(\"Upgrading engines\");\r\n        \r\n        // Increase max velocity by 25%\r\n        spaceshipState.maxVelocity *= 1.25;\r\n        \r\n        // Upgrade visual appearance of thrusters\r\n        this.components.thrusters.forEach(thruster => {\r\n            if (thruster.mesh && thruster.mesh.material) {\r\n                // Make thrusters more intense with each upgrade\r\n                thruster.mesh.material.emissiveIntensity += 0.2;\r\n                \r\n                // Change thruster color slightly with each upgrade to show progression\r\n                if (this.engineLevel % 2 === 0) { // Every even level\r\n                    thruster.mesh.material.emissive.setHex(0xff8800); // More orange\r\n                } else {\r\n                    thruster.mesh.material.emissive.setHex(0xffaa00); // More yellow\r\n                }\r\n            }\r\n        });\r\n        \r\n        // Increase the upgrade level\r\n        this.engineLevel++;\r\n        \r\n        // Calculate the new upgrade cost (2.5x the previous cost)\r\n        this.engineUpgradeCost = Math.floor(this.engineUpgradeCost * 2.5);\r\n        \r\n        return spaceshipState.maxVelocity;\r\n    }\r\n\r\n    /**\r\n     * Upgrade the mining laser system\r\n     * @param {object} spaceshipState Reference to spaceship state\r\n     * @returns {number} New mining efficiency\r\n     */\r\n    upgradeMiningLaser(spaceshipState) {\r\n        console.log(\"Upgrading mining laser\");\r\n        \r\n        // Increase mining efficiency by 30%\r\n        spaceshipState.miningEfficiency *= 1.3;\r\n        \r\n        // Upgrade visual appearance of mining laser emitters\r\n        if (this.components.leftEmitter && this.components.leftEmitter.material) {\r\n            // Increase the size of the left emitter\r\n            this.components.leftEmitter.scale.set(1.1, 1.1, 1.1);\r\n            \r\n            // Change the color based on level to show progression\r\n            const colors = [0xff0000, 0xff5500, 0xff9900, 0xffcc00, 0xffee00];\r\n            if (this.miningLevel < colors.length) {\r\n                this.components.leftEmitter.material.color.setHex(colors[this.miningLevel]);\r\n                this.components.leftEmitter.material.emissive.setHex(colors[this.miningLevel]);\r\n            }\r\n            \r\n            // Increase the emissive intensity\r\n            this.components.leftEmitter.material.emissiveIntensity += 0.2;\r\n        }\r\n        \r\n        // Also upgrade the right emitter to match\r\n        if (this.components.rightEmitter && this.components.rightEmitter.material) {\r\n            // Increase the size of the right emitter\r\n            this.components.rightEmitter.scale.set(1.1, 1.1, 1.1);\r\n            \r\n            // Change the color based on level to show progression\r\n            const colors = [0xff0000, 0xff5500, 0xff9900, 0xffcc00, 0xffee00];\r\n            if (this.miningLevel < colors.length) {\r\n                this.components.rightEmitter.material.color.setHex(colors[this.miningLevel]);\r\n                this.components.rightEmitter.material.emissive.setHex(colors[this.miningLevel]);\r\n            }\r\n            \r\n            // Increase the emissive intensity\r\n            this.components.rightEmitter.material.emissiveIntensity += 0.2;\r\n        }\r\n        \r\n        // Also update the cannons\r\n        if (this.components.leftCannon && this.components.leftCannon.material) {\r\n            // Make the cannons thicker with each upgrade\r\n            this.components.leftCannon.scale.x *= 1.1;\r\n            this.components.leftCannon.scale.y *= 1.1;\r\n        }\r\n        \r\n        if (this.components.rightCannon && this.components.rightCannon.material) {\r\n            // Make the cannons thicker with each upgrade\r\n            this.components.rightCannon.scale.x *= 1.1;\r\n            this.components.rightCannon.scale.y *= 1.1;\r\n        }\r\n        \r\n        // Increase the upgrade level\r\n        this.miningLevel++;\r\n        \r\n        // Calculate the new upgrade cost (3x the previous cost)\r\n        this.miningUpgradeCost = Math.floor(this.miningUpgradeCost * 3);\r\n        \r\n        return spaceshipState.miningEfficiency;\r\n    }\r\n\r\n    /**\r\n     * Upgrade the ship's hull armor\r\n     * @param {object} spaceshipState Reference to spaceship state\r\n     * @returns {number} New collision resistance\r\n     */\r\n    upgradeHull(spaceshipState) {\r\n        console.log(\"Upgrading hull\");\r\n        \r\n        // Increase collision resistance by 25%\r\n        spaceshipState.collisionResistance *= 1.25;\r\n        \r\n        // Modify ship appearance to show hull upgrade\r\n        const bodyGroup = this.components.mesh.children.find(child => child instanceof THREE.Group);\r\n        \r\n        if (bodyGroup && bodyGroup.children) {\r\n            // Update both the cylinder and cone parts of the ship body\r\n            bodyGroup.children.forEach(part => {\r\n                if (part instanceof THREE.Mesh && part.material) {\r\n                    // Change the hull color slightly to indicate higher grade material\r\n                    if (this.hullLevel % 2 === 0) {\r\n                        // Even levels: more blue tint\r\n                        part.material.color.setHex(0x30c0d0);\r\n                    } else {\r\n                        // Odd levels: more green tint\r\n                        part.material.color.setHex(0x30d0c0);\r\n                    }\r\n                    \r\n                    // Increase shininess with each level to suggest better armor\r\n                    part.material.shininess += 10;\r\n                }\r\n            });\r\n        }\r\n        \r\n        // Increase the upgrade level\r\n        this.hullLevel++;\r\n        \r\n        // Calculate the new upgrade cost (2x the previous cost)\r\n        this.hullUpgradeCost = Math.floor(this.hullUpgradeCost * 2);\r\n        \r\n        return spaceshipState.collisionResistance;\r\n    }\r\n\r\n    /**\r\n     * Upgrade the ship's scanner system\r\n     * @param {object} spaceshipState Reference to spaceship state\r\n     * @returns {number} New scanner range\r\n     */\r\n    upgradeScanner(spaceshipState) {\r\n        console.log(\"Upgrading scanner\");\r\n        \r\n        // Increase scanner range by 20%\r\n        spaceshipState.scanRange *= 1.2;\r\n        \r\n        // Add visual indicator for scanner upgrade (could add scan dish or antenna)\r\n        // This is a simplified version - in a real implementation, you'd want to\r\n        // add actual mesh components to the ship\r\n        \r\n        // Increase the upgrade level\r\n        this.scannerLevel++;\r\n        \r\n        // Calculate the new upgrade cost (1.8x the previous cost)\r\n        this.scannerUpgradeCost = Math.floor(this.scannerUpgradeCost * 1.8);\r\n        \r\n        return spaceshipState.scanRange;\r\n    }\r\n\r\n    /**\r\n     * Get all upgrade levels for external access\r\n     * @returns {object} All upgrade levels and costs\r\n     */\r\n    getUpgradeLevels() {\r\n        return {\r\n            fuelTankLevel: this.fuelTankLevel,\r\n            fuelUpgradeCost: this.fuelUpgradeCost,\r\n            engineLevel: this.engineLevel,\r\n            engineUpgradeCost: this.engineUpgradeCost,\r\n            miningLevel: this.miningLevel,\r\n            miningUpgradeCost: this.miningUpgradeCost,\r\n            hullLevel: this.hullLevel,\r\n            hullUpgradeCost: this.hullUpgradeCost,\r\n            scannerLevel: this.scannerLevel,\r\n            scannerUpgradeCost: this.scannerUpgradeCost\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Set upgrade levels from existing data (for loading saves)\r\n     * @param {object} upgrades Upgrade data to restore\r\n     */\r\n    setUpgradeLevels(upgrades) {\r\n        this.fuelTankLevel = upgrades.fuelTankLevel || 1;\r\n        this.fuelUpgradeCost = upgrades.fuelUpgradeCost || 1000;\r\n        this.engineLevel = upgrades.engineLevel || 1;\r\n        this.engineUpgradeCost = upgrades.engineUpgradeCost || 800;\r\n        this.miningLevel = upgrades.miningLevel || 1;\r\n        this.miningUpgradeCost = upgrades.miningUpgradeCost || 1200;\r\n        this.hullLevel = upgrades.hullLevel || 1;\r\n        this.hullUpgradeCost = upgrades.hullUpgradeCost || 1500;\r\n        this.scannerLevel = upgrades.scannerLevel || 1;\r\n        this.scannerUpgradeCost = upgrades.scannerUpgradeCost || 600;\r\n    }\r\n}","// docking.js - Ship docking and undocking systems\r\n// Extracted from spaceship.js to improve maintainability\r\n\r\nimport * as THREE from 'three';\r\n\r\nexport class ShipDocking {\r\n    constructor(mesh, scene) {\r\n        this.mesh = mesh;\r\n        this.scene = scene;\r\n        this.undockLocation = new THREE.Vector3(0, 10000, 0); // Middle of the stargate\r\n    }\r\n\r\n    /**\r\n     * Dock the spaceship at the stargate\r\n     * @param {object} spaceshipState Reference to spaceship state\r\n     * @param {function} syncCallback Callback to sync values to health component\r\n     */\r\n    dock(spaceshipState, syncCallback) {\r\n        console.log(\"Docking spaceship\");\r\n        console.log(\"Spaceship values before docking:\", {\r\n            shield: spaceshipState.shield,\r\n            maxShield: spaceshipState.maxShield,\r\n            hull: spaceshipState.hull,\r\n            maxHull: spaceshipState.maxHull,\r\n            isDocked: spaceshipState.isDocked\r\n        });\r\n        \r\n        spaceshipState.isDocked = true;\r\n        spaceshipState.velocity.set(0, 0, 0);\r\n        this.mesh.visible = false;\r\n        \r\n        console.log(\"Spaceship values after docking:\", {\r\n            shield: spaceshipState.shield,\r\n            maxShield: spaceshipState.maxShield,\r\n            hull: spaceshipState.hull,\r\n            maxHull: spaceshipState.maxHull,\r\n            isDocked: spaceshipState.isDocked\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Undock the spaceship from the stargate\r\n     * @param {object} spaceshipState Reference to spaceship state\r\n     * @param {function} syncCallback Callback to sync values to health component\r\n     * @returns {THREE.Vector3} New position of the ship\r\n     */\r\n    undock(spaceshipState, syncCallback) {\r\n        console.log(\"Undocking spaceship\");\r\n        console.log(\"Spaceship values before undocking:\", {\r\n            shield: spaceshipState.shield,\r\n            maxShield: spaceshipState.maxShield,\r\n            hull: spaceshipState.hull,\r\n            maxHull: spaceshipState.maxHull,\r\n            isDocked: spaceshipState.isDocked\r\n        });\r\n        \r\n        // Store shield value before undocking to diagnose reset issue\r\n        const shieldBeforeUndock = spaceshipState.shield;\r\n        \r\n        spaceshipState.isDocked = false;\r\n        this.mesh.visible = true;\r\n        \r\n        // Check if shield was reset and restore it\r\n        if (spaceshipState.shield !== shieldBeforeUndock) {\r\n            console.log(`SHIELD RESET DETECTED during undock! Value changed from ${shieldBeforeUndock} to ${spaceshipState.shield}`);\r\n            console.log(\"Restoring shield value to:\", shieldBeforeUndock);\r\n            spaceshipState.shield = shieldBeforeUndock;\r\n        }\r\n        \r\n        console.log(\"Spaceship values after undocking:\", {\r\n            shield: spaceshipState.shield,\r\n            maxShield: spaceshipState.maxShield,\r\n            hull: spaceshipState.hull,\r\n            maxHull: spaceshipState.maxHull,\r\n            isDocked: spaceshipState.isDocked\r\n        });\r\n        \r\n        // When undocking, attempt to sync shield and hull values to the HealthComponent\r\n        if (syncCallback) {\r\n            syncCallback();\r\n        }\r\n        \r\n        // Position the ship based on undock location\r\n        if (this.undockLocation) {\r\n            this.mesh.position.copy(this.undockLocation);\r\n            \r\n            // Point away from the stargate (down toward sun)\r\n            this.mesh.rotation.set(Math.PI/2, 0, 0);\r\n        } else {\r\n            // Original behavior - position just outside the docking bay\r\n            const stargatePosition = this.scene.getObjectByName('stargate').position.clone();\r\n            stargatePosition.z += 550; // Move in front of the docking bay\r\n            this.mesh.position.copy(stargatePosition);\r\n            \r\n            // Reset rotation to face away from the stargate\r\n            this.mesh.rotation.set(0, Math.PI, 0);\r\n        }\r\n        \r\n        spaceshipState.velocity.set(0, 0, 0); // This line resets velocity, but it's fine since we're undocking\r\n        \r\n        return this.mesh.position.clone();\r\n    }\r\n\r\n    /**\r\n     * Set the undocking location\r\n     * @param {THREE.Vector3} location New undocking position\r\n     */\r\n    setUndockLocation(location) {\r\n        this.undockLocation = location.clone();\r\n    }\r\n\r\n    /**\r\n     * Get the current undocking location\r\n     * @returns {THREE.Vector3} Current undocking position\r\n     */\r\n    getUndockLocation() {\r\n        return this.undockLocation.clone();\r\n    }\r\n}","// services.js - Ship service operations (refuel, repair)\r\n// Extracted from spaceship.js to improve maintainability\r\n\r\nexport class ShipServices {\r\n    constructor() {\r\n        // Service operations don't need complex initialization\r\n    }\r\n\r\n    /**\r\n     * Refuel the spaceship to maximum capacity\r\n     * @param {object} spaceshipState Reference to spaceship state\r\n     * @returns {number} Cost of refueling\r\n     */\r\n    refuel(spaceshipState) {\r\n        console.log(\"Refueling spaceship\");\r\n        spaceshipState.fuel = spaceshipState.maxFuel;\r\n        return 100; // Cost of refueling\r\n    }\r\n\r\n    /**\r\n     * Repair the ship's shield system\r\n     * @param {object} spaceshipState Reference to spaceship state\r\n     * @param {function} syncCallback Callback to sync values to health component\r\n     * @returns {number} Cost of shield repair\r\n     */\r\n    repairShield(spaceshipState, syncCallback) {\r\n        const oldShield = spaceshipState.shield;\r\n        console.log(`===== SHIELD REPAIR INITIATED =====`);\r\n        console.log(`Repairing shield: ${oldShield}  ${spaceshipState.maxShield}`);\r\n        \r\n        // CRITICAL FIX: Set and verify shield repair\r\n        spaceshipState.shield = spaceshipState.maxShield;\r\n        console.log(`Shield value is now: ${spaceshipState.shield} (Expected: ${spaceshipState.maxShield})`);\r\n        \r\n        // Log full spaceship state for debugging\r\n        console.log(\"Full spaceship state after shield repair:\", {\r\n            shield: spaceshipState.shield,\r\n            maxShield: spaceshipState.maxShield,\r\n            hull: spaceshipState.hull,\r\n            maxHull: spaceshipState.maxHull,\r\n            fuel: spaceshipState.fuel,\r\n            maxFuel: spaceshipState.maxFuel\r\n        });\r\n        console.log(`===== SHIELD REPAIR COMPLETED =====`);\r\n        \r\n        // Sync the updated shield value to the player entity's HealthComponent\r\n        // Use direct entity access for more reliable syncing\r\n        if (window.game && window.game.world) {\r\n            try {\r\n                const players = window.game.world.getEntitiesByTag('player');\r\n                if (players && players.length > 0) {\r\n                    const health = players[0].getComponent('HealthComponent');\r\n                    if (health) {\r\n                        // Update shield directly on the component\r\n                        const oldHealthShield = health.shield;\r\n                        health.shield = spaceshipState.shield;\r\n                        console.log(`Direct shield update on HealthComponent: ${oldHealthShield}  ${health.shield}`);\r\n                    }\r\n                }\r\n            } catch (e) {\r\n                console.error(\"Error during direct HealthComponent update:\", e);\r\n            }\r\n        }\r\n        \r\n        // Also use the normal sync method\r\n        if (syncCallback) {\r\n            syncCallback();\r\n        }\r\n        \r\n        return 150; // Cost of shield repair\r\n    }\r\n\r\n    /**\r\n     * Repair the ship's hull structure\r\n     * @param {object} spaceshipState Reference to spaceship state\r\n     * @param {function} syncCallback Callback to sync values to health component\r\n     * @returns {number} Cost of hull repair\r\n     */\r\n    repairHull(spaceshipState, syncCallback) {\r\n        const oldHull = spaceshipState.hull;\r\n        console.log(`===== HULL REPAIR INITIATED =====`);\r\n        console.log(`Repairing hull: ${oldHull}  ${spaceshipState.maxHull}`);\r\n        \r\n        // CRITICAL FIX: Set and verify hull repair\r\n        spaceshipState.hull = spaceshipState.maxHull;\r\n        console.log(`Hull value is now: ${spaceshipState.hull} (Expected: ${spaceshipState.maxHull})`);\r\n        \r\n        // Log full spaceship state for debugging\r\n        console.log(\"Full spaceship state after hull repair:\", {\r\n            shield: spaceshipState.shield,\r\n            maxShield: spaceshipState.maxShield,\r\n            hull: spaceshipState.hull,\r\n            maxHull: spaceshipState.maxHull,\r\n            fuel: spaceshipState.fuel,\r\n            maxFuel: spaceshipState.maxFuel\r\n        });\r\n        console.log(`===== HULL REPAIR COMPLETED =====`);\r\n        \r\n        // Sync the updated hull value to the player entity's HealthComponent\r\n        // Use direct entity access for more reliable syncing\r\n        if (window.game && window.game.world) {\r\n            try {\r\n                const players = window.game.world.getEntitiesByTag('player');\r\n                if (players && players.length > 0) {\r\n                    const health = players[0].getComponent('HealthComponent');\r\n                    if (health) {\r\n                        // Update hull directly on the component\r\n                        const oldHealthHull = health.health;\r\n                        health.health = spaceshipState.hull;\r\n                        console.log(`Direct hull update on HealthComponent: ${oldHealthHull}  ${health.health}`);\r\n                    }\r\n                }\r\n            } catch (e) {\r\n                console.error(\"Error during direct HealthComponent update:\", e);\r\n            }\r\n        }\r\n        \r\n        // Also use the normal sync method\r\n        if (syncCallback) {\r\n            syncCallback();\r\n        }\r\n        \r\n        return 200; // Cost of hull repair\r\n    }\r\n\r\n    /**\r\n     * Check if fuel consumption is allowed and consume fuel\r\n     * @param {object} spaceshipState Reference to spaceship state\r\n     * @param {object} thrustState Current thrust state\r\n     * @returns {boolean} True if we have fuel, false if empty\r\n     */\r\n    consumeFuel(spaceshipState, thrustState) {\r\n        // Consume fuel when thrusting\r\n        if (thrustState.forward || thrustState.backward || thrustState.left || thrustState.right) {\r\n            let consumptionRate = spaceshipState.fuelConsumptionRate;\r\n            \r\n            // Extra consumption when boosting\r\n            if (thrustState.boost) {\r\n                consumptionRate *= 3;\r\n            }\r\n            \r\n            spaceshipState.fuel = Math.max(0, spaceshipState.fuel - consumptionRate);\r\n        }\r\n        \r\n        // Return true if we have fuel, false if empty\r\n        return spaceshipState.fuel > 0;\r\n    }\r\n}","// visualEffects.js - Ship visual effects (mining laser, trails)\r\n// Extracted from spaceship.js to improve maintainability\r\n\r\nexport class ShipVisualEffects {\r\n    constructor(shipComponents) {\r\n        this.components = shipComponents; // { leftEmitter, rightEmitter }\r\n    }\r\n\r\n    /**\r\n     * Activate mining laser visual effects\r\n     */\r\n    activateMiningLaser() {\r\n        // Activate both emitters for a more powerful effect\r\n        if (this.components.leftEmitter && this.components.rightEmitter) {\r\n            // Left emitter\r\n            this.components.leftEmitter.material.emissiveIntensity = 1.5;\r\n            this.components.leftEmitter.scale.set(1.2, 1.2, 1.2);\r\n            \r\n            // Right emitter\r\n            this.components.rightEmitter.material.emissiveIntensity = 1.5;\r\n            this.components.rightEmitter.scale.set(1.2, 1.2, 1.2);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Deactivate mining laser visual effects\r\n     */\r\n    deactivateMiningLaser() {\r\n        // Deactivate both emitters\r\n        if (this.components.leftEmitter && this.components.rightEmitter) {\r\n            // Left emitter\r\n            this.components.leftEmitter.material.emissiveIntensity = 1;\r\n            this.components.leftEmitter.scale.set(1, 1, 1);\r\n            \r\n            // Right emitter\r\n            this.components.rightEmitter.material.emissiveIntensity = 1;\r\n            this.components.rightEmitter.scale.set(1, 1, 1);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Update trail visibility based on movement\r\n     * @param {boolean} isMoving Whether the ship is currently moving\r\n     * @param {object} thrustState Current thrust state\r\n     * @param {THREE.Vector3} velocity Current velocity\r\n     * @param {object} trailEffects Trail effects instance\r\n     */\r\n    updateTrailVisibility(isMoving, thrustState, velocity, trailEffects) {\r\n        // Delegate to trail effects module\r\n        if (trailEffects) {\r\n            trailEffects.updateTrailVisibility(isMoving, thrustState, velocity);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Update particle effects\r\n     * @param {object} thrustState Current thrust state\r\n     * @param {THREE.Vector3} velocity Current velocity\r\n     * @param {object} trailEffects Trail effects instance\r\n     */\r\n    updateParticles(thrustState, velocity, trailEffects) {\r\n        // Delegate to trail effects module\r\n        if (trailEffects) {\r\n            trailEffects.updateParticles(thrustState, velocity);\r\n        }\r\n    }\r\n}","// healthSync.js - ECS health component synchronization\r\n// Extracted from spaceship.js to improve maintainability\r\n\r\nexport class HealthSync {\r\n    constructor() {\r\n        // Health sync doesn't need complex initialization\r\n    }\r\n\r\n    /**\r\n     * Subscribe to player entity destruction events\r\n     * @param {MessageBus} messageBus The game's message bus\r\n     * @param {function} destructionCallback Callback when player is destroyed\r\n     */\r\n    subscribeToDestructionEvents(messageBus, destructionCallback) {\r\n        if (!messageBus) return;\r\n        \r\n        messageBus.subscribe('entity.destroyed', (message) => {\r\n            const entity = message.data.entity;\r\n            \r\n            // Check if this is the player entity\r\n            if (entity && entity.hasTag && entity.hasTag('player')) {\r\n                console.log(\"Player entity destroyed - updating spaceship state\");\r\n                \r\n                // Get health component data\r\n                const healthComponent = entity.getComponent('HealthComponent');\r\n                let hull = 0;\r\n                let shield = 0;\r\n                \r\n                if (healthComponent) {\r\n                    hull = healthComponent.health;\r\n                    shield = healthComponent.shield;\r\n                } else {\r\n                    // If no health component, just set to 0\r\n                    hull = 0;\r\n                    shield = 0;\r\n                }\r\n                \r\n                // Call destruction callback with updated values\r\n                destructionCallback(hull, shield);\r\n            }\r\n        });\r\n        \r\n        console.log(\"Spaceship subscribed to destruction events\");\r\n    }\r\n\r\n    /**\r\n     * Method to sync hull and shield values to the player entity's HealthComponent\r\n     * @param {object} spaceshipState Current spaceship state\r\n     */\r\n    syncValuesToHealthComponent(spaceshipState) {\r\n        console.log(\"Beginning shield and hull sync to HealthComponent\");\r\n        \r\n        console.log(\"Current spaceship values:\", {\r\n            shield: spaceshipState.shield,\r\n            maxShield: spaceshipState.maxShield,\r\n            hull: spaceshipState.hull,\r\n            maxHull: spaceshipState.maxHull\r\n        });\r\n        \r\n        // Store the values that need to be synced to the HealthComponent\r\n        const valuesForSync = {\r\n            shield: spaceshipState.shield,\r\n            maxShield: spaceshipState.maxShield,\r\n            hull: spaceshipState.hull,\r\n            maxHull: spaceshipState.maxHull\r\n        };\r\n        \r\n        console.log(`Preparing to sync values to player HealthComponent: Shield=${spaceshipState.shield}, Hull=${spaceshipState.hull}`);\r\n        \r\n        // Try using the MessageBus to broadcast the sync event\r\n        try {\r\n            if (window.game && window.game.messageBus) {\r\n                // Use the message bus to publish a sync event for any interested components\r\n                window.game.messageBus.publish('player.syncHealth', valuesForSync);\r\n                console.log(\"Published player.syncHealth event to game.messageBus with values:\", valuesForSync);\r\n            } else if (window.mainMessageBus) {\r\n                // Try using the global message bus\r\n                window.mainMessageBus.publish('player.syncHealth', valuesForSync);\r\n                console.log(\"Published player.syncHealth event to mainMessageBus with values:\", valuesForSync);\r\n            } else {\r\n                console.warn(\"No message bus available to sync health values\");\r\n            }\r\n        } catch (e) {\r\n            console.error(\"Error publishing sync event:\", e);\r\n        }\r\n        \r\n        // Also try direct access as a fallback\r\n        try {\r\n            if (window.game && window.game.world) {\r\n                const players = window.game.world.getEntitiesByTag('player');\r\n                console.log(`Found ${players ? players.length : 0} player entities for direct sync`);\r\n                \r\n                if (players && players.length > 0) {\r\n                    const player = players[0];\r\n                    const health = player.getComponent('HealthComponent');\r\n                    \r\n                    if (health) {\r\n                        // Log pre-sync state\r\n                        console.log(\"DIRECT SYNC - HealthComponent before sync:\", {\r\n                            shield: health.shield,\r\n                            maxShield: health.maxShield,\r\n                            health: health.health,\r\n                            maxHealth: health.maxHealth\r\n                        });\r\n                        \r\n                        console.log(\"DIRECT SYNC - Spaceship values to sync:\", {\r\n                            shield: spaceshipState.shield,\r\n                            maxShield: spaceshipState.maxShield,\r\n                            hull: spaceshipState.hull,\r\n                            maxHull: spaceshipState.maxHull\r\n                        });\r\n                        \r\n                        // Sync shield value\r\n                        const oldShield = health.shield;\r\n                        health.shield = spaceshipState.shield;\r\n                        health.maxShield = spaceshipState.maxShield;\r\n                        \r\n                        // Sync hull value\r\n                        const oldHealth = health.health;\r\n                        health.health = spaceshipState.hull;\r\n                        health.maxHealth = spaceshipState.maxHull;\r\n                        \r\n                        console.log(`Directly synced values to HealthComponent: Shield ${oldShield}  ${health.shield}, Hull ${oldHealth}  ${health.health}`);\r\n                        \r\n                        // Verify sync was successful\r\n                        console.log(\"DIRECT SYNC - HealthComponent after sync:\", {\r\n                            shield: health.shield,\r\n                            maxShield: health.maxShield,\r\n                            health: health.health,\r\n                            maxHealth: health.maxHealth\r\n                        });\r\n                    } else {\r\n                        console.warn(\"Player entity found but has no HealthComponent\");\r\n                    }\r\n                } else {\r\n                    console.warn(\"No player entities found for direct sync\");\r\n                }\r\n            }\r\n        } catch (e) {\r\n            console.error(\"Error directly syncing values to HealthComponent:\", e);\r\n        }\r\n    }\r\n}","// spaceship.js - Main spaceship class with delegation to specialized modules\r\n// Refactored to improve maintainability and reduce file size\r\n\r\nimport * as THREE from 'three';\r\nimport { TrailEffects } from '../trail.js';\r\nimport { ShipModel } from './model/shipModel.js';\r\nimport { ShipUpgrades } from './systems/upgrades.js';\r\nimport { ShipDocking } from './systems/docking.js';\r\nimport { ShipServices } from './systems/services.js';\r\nimport { ShipVisualEffects } from './effects/visualEffects.js';\r\nimport { HealthSync } from './sync/healthSync.js';\r\n\r\nexport class Spaceship {\r\n    constructor(scene) {\r\n        this.scene = scene;\r\n        this.mesh = null;\r\n        this.thrusters = [];\r\n        this.leftCannon = null;\r\n        this.rightCannon = null;\r\n        this.leftEmitter = null;\r\n        this.rightEmitter = null;\r\n        this.miningLaser = null;\r\n        this.velocity = new THREE.Vector3(0, 0, 0);\r\n        this.rotation = new THREE.Euler(0, 0, 0);\r\n        this.thrust = {\r\n            forward: false,\r\n            backward: false,\r\n            left: false,\r\n            right: false,\r\n            boost: false\r\n        };\r\n        this.trailEffects = null;\r\n        this.shipScale = 2.0;\r\n        \r\n        // Combat properties\r\n        this.hull = 100;\r\n        this.maxHull = 100;\r\n        this.shield = 50;\r\n        this.maxShield = 50;\r\n        this.isDestroyed = false;\r\n        \r\n        // Docking and fuel properties\r\n        this.fuel = 100;\r\n        this.maxFuel = 100;\r\n        this.fuelConsumptionRate = 0.01;\r\n        this.isDocked = true;\r\n        this.credits = 1000;\r\n        \r\n        // Initialize cargo (empty by default)\r\n        this.cargo = {\r\n            iron: 0,\r\n            gold: 0,\r\n            platinum: 0\r\n        };\r\n        \r\n        // Ship capabilities\r\n        this.maxVelocity = 25.0;\r\n        this.miningEfficiency = 1.0;\r\n        this.collisionResistance = 1.0;\r\n        this.scanRange = 1000;\r\n        this.deployableLaserCount = 0;\r\n        \r\n        // Initialize specialized modules\r\n        this._initializeModules();\r\n        \r\n        this.createSpaceship();\r\n        \r\n        // Initialize trail effects after spaceship mesh is created\r\n        this.trailEffects = new TrailEffects(this.scene, this.mesh);\r\n        \r\n        // Start the ship invisible since it's docked\r\n        if (this.mesh) {\r\n            this.mesh.visible = false;\r\n        }\r\n        \r\n    }\r\n\r\n    /**\r\n     * Initialize specialized modules for different aspects of the ship\r\n     */\r\n    _initializeModules() {\r\n        // Model creation module\r\n        this.shipModel = new ShipModel(this.scene, this.shipScale);\r\n        \r\n        // These will be initialized after mesh creation\r\n        this.shipUpgrades = null;\r\n        this.shipDocking = null;\r\n        this.shipServices = new ShipServices();\r\n        this.shipVisualEffects = null;\r\n        this.healthSync = new HealthSync();\r\n    }\r\n\r\n    /**\r\n     * Create the spaceship using the model module\r\n     */\r\n    createSpaceship() {\r\n        this.mesh = this.shipModel.createSpaceship();\r\n        const components = this.shipModel.getComponents();\r\n        \r\n        // Store component references\r\n        this.thrusters = components.thrusters;\r\n        this.leftCannon = components.leftCannon;\r\n        this.rightCannon = components.rightCannon;\r\n        this.leftEmitter = components.leftEmitter;\r\n        this.rightEmitter = components.rightEmitter;\r\n        this.miningLaser = components.miningLaser;\r\n        \r\n        // Initialize modules that need mesh components\r\n        this.shipUpgrades = new ShipUpgrades(components);\r\n        this.shipDocking = new ShipDocking(this.mesh, this.scene);\r\n        this.shipVisualEffects = new ShipVisualEffects(components);\r\n    }\r\n\r\n    // Methods for updating spaceship state in game loop\r\n    update(deltaTime) {\r\n        // Update any continuous effects or animations\r\n        if (this.updateParticles && !this.isDocked) {\r\n            this.updateParticles();\r\n        }\r\n    }\r\n\r\n    // VISUAL EFFECTS - Delegate to visual effects module\r\n    activateMiningLaser() { this.shipVisualEffects.activateMiningLaser(); }\r\n    deactivateMiningLaser() { this.shipVisualEffects.deactivateMiningLaser(); }\r\n    updateParticles() { this.shipVisualEffects.updateParticles(this.thrust, this.velocity, this.trailEffects); }\r\n    updateTrailVisibility(isMoving) { this.shipVisualEffects.updateTrailVisibility(isMoving, this.thrust, this.velocity, this.trailEffects); }\r\n\r\n    // DOCKING OPERATIONS - Delegate to docking module\r\n    dock() { this.shipDocking.dock(this, this.syncValuesToHealthComponent.bind(this)); }\r\n    undock() { return this.shipDocking.undock(this, this.syncValuesToHealthComponent.bind(this)); }\r\n\r\n    // SERVICE OPERATIONS - Delegate to services module\r\n    refuel() { return this.shipServices.refuel(this); }\r\n    repairShield() { return this.shipServices.repairShield(this, this.syncValuesToHealthComponent.bind(this)); }\r\n    repairHull() { return this.shipServices.repairHull(this, this.syncValuesToHealthComponent.bind(this)); }\r\n    consumeFuel() { return this.shipServices.consumeFuel(this, this.thrust); }\r\n\r\n    // UPGRADE OPERATIONS - Delegate to upgrades module\r\n    upgradeFuelTank() { return this.shipUpgrades.upgradeFuelTank(this); }\r\n    upgradeEngine() { return this.shipUpgrades.upgradeEngine(this); }\r\n    upgradeMiningLaser() { return this.shipUpgrades.upgradeMiningLaser(this); }\r\n    upgradeHull() { return this.shipUpgrades.upgradeHull(this); }\r\n    upgradeScanner() { return this.shipUpgrades.upgradeScanner(this); }\r\n\r\n    // Upgrade level access methods\r\n    get fuelTankLevel() { return this.shipUpgrades?.fuelTankLevel || 1; }\r\n    get fuelUpgradeCost() { return this.shipUpgrades?.fuelUpgradeCost || 1000; }\r\n    get engineLevel() { return this.shipUpgrades?.engineLevel || 1; }\r\n    get engineUpgradeCost() { return this.shipUpgrades?.engineUpgradeCost || 800; }\r\n    get miningLevel() { return this.shipUpgrades?.miningLevel || 1; }\r\n    get miningUpgradeCost() { return this.shipUpgrades?.miningUpgradeCost || 1200; }\r\n    get hullLevel() { return this.shipUpgrades?.hullLevel || 1; }\r\n    get hullUpgradeCost() { return this.shipUpgrades?.hullUpgradeCost || 1500; }\r\n    get scannerLevel() { return this.shipUpgrades?.scannerLevel || 1; }\r\n    get scannerUpgradeCost() { return this.shipUpgrades?.scannerUpgradeCost || 600; }\r\n\r\n    // HEALTH SYNCHRONIZATION - Delegate to health sync module\r\n    subscribeToDestructionEvents(messageBus) { this.healthSync.subscribeToDestructionEvents(messageBus, this.handleDestruction.bind(this)); }\r\n    syncValuesToHealthComponent() { this.healthSync.syncValuesToHealthComponent(this); }\r\n\r\n    /**\r\n     * Handle ship destruction effects\r\n     */\r\n    handleDestruction(hull, shield) {\r\n        this.isDestroyed = true;\r\n        this.hull = hull;\r\n        this.shield = shield;\r\n        \r\n        // Visual and behavioral changes for destroyed state\r\n        if (this.mesh) {\r\n            // Disable thrusters via trail effects\r\n            if (this.trailEffects) {\r\n                this.trailEffects.particleSystems.forEach(ps => {\r\n                    if (ps && ps.system) {\r\n                        ps.system.visible = false;\r\n                    }\r\n                });\r\n            }\r\n        }\r\n    }\r\n\r\n    // POSITION AND ROTATION ACCESS (for external systems)\r\n    get position() {\r\n        return this.mesh ? this.mesh.position : new THREE.Vector3(0, 0, 0);\r\n    }\r\n\r\n    get rotation() {\r\n        return this.mesh ? this.mesh.rotation : new THREE.Euler(0, 0, 0);\r\n    }\r\n\r\n    set position(newPosition) {\r\n        if (this.mesh) {\r\n            this.mesh.position.copy(newPosition);\r\n        }\r\n    }\r\n\r\n    set rotation(newRotation) {\r\n        if (this.mesh) {\r\n            this.mesh.rotation.copy(newRotation);\r\n        }\r\n    }\r\n\r\n    // UNDOCK LOCATION ACCESS\r\n    get undockLocation() {\r\n        return this.shipDocking?.getUndockLocation() || new THREE.Vector3(0, 10000, 0);\r\n    }\r\n\r\n    set undockLocation(location) {\r\n        if (this.shipDocking) {\r\n            this.shipDocking.setUndockLocation(location);\r\n        }\r\n    }\r\n}","// physics.js - Handles physics calculations and movement\r\n\r\nimport * as THREE from 'three';\r\n\r\nexport class Physics {\r\n    // Physics constants - significantly increased for super-fast movement\r\n    static THRUST_FORCE = 0.5;      // 5x increase from previous 0.1\r\n    static BOOST_MULTIPLIER = 4;    // Keep the same boost multiplier\r\n    static MAX_VELOCITY = 25.0;     // Default maximum velocity (will use spaceship's value if available)\r\n    static ROTATION_SPEED = 0.3;    // Increased for more responsive controls\r\n    static COLLISION_DISTANCE = 15; // Reduced from 70 to match actual ship size\r\n    static FRICTION = 0.01;         // Small friction to help with control (new)\r\n    \r\n    constructor(scene) {\r\n        this.scene = scene;\r\n        this.spaceship = null; // Will be set later\r\n        this.camera = null; // Will be set later\r\n        \r\n        // Virtual rotation state for pointer lock\r\n        this.rotationState = {\r\n            x: 0,\r\n            y: 0\r\n        };\r\n        \r\n        // Collision state\r\n        this.collided = false;\r\n        \r\n        // For collision detection\r\n        this.raycaster = new THREE.Raycaster();\r\n        this.direction = new THREE.Vector3(0, 0, -1);\r\n        this.collisionDistance = Physics.COLLISION_DISTANCE; // Use the class constant for consistency\r\n    }\r\n    \r\n    // Set spaceship reference\r\n    setSpaceship(spaceship) {\r\n        this.spaceship = spaceship;\r\n    }\r\n    \r\n    // Set camera reference\r\n    setCamera(camera) {\r\n        this.camera = camera;\r\n    }\r\n    \r\n    update(deltaTime) {\r\n        if (!this.spaceship || this.spaceship.isDestroyed) return;\r\n        \r\n        // Check if ship is docked - skip physics if docked\r\n        if (this.spaceship.isDocked) return;\r\n        \r\n        // Skip physics updates if intro sequence is active\r\n        if (window.game && window.game.introSequenceActive) {\r\n            return;\r\n        }\r\n        \r\n        // Use a normalized deltaTime to standardize physics at 60 FPS feel\r\n        // This is the key to frame rate independence\r\n        this.normalizedDeltaTime = deltaTime * 60;\r\n        \r\n        // Check if we have fuel\r\n        const hasFuel = this.spaceship.consumeFuel();\r\n        \r\n        // Apply thrust based on controls - only if we have fuel\r\n        let thrustVector = new THREE.Vector3(0, 0, 0);\r\n        let isThrusting = false;\r\n        \r\n        // Get the ship's forward direction\r\n        const shipForward = new THREE.Vector3(0, 0, -1);\r\n        shipForward.applyQuaternion(this.spaceship.mesh.quaternion);\r\n        \r\n        // Calculate dot product to determine how much we're moving forward\r\n        const forwardVelocity = shipForward.dot(this.spaceship.velocity);\r\n        \r\n        // Visual effects are now handled entirely by the trail module\r\n        // Physics only handles movement calculations\r\n        \r\n        if (hasFuel) {\r\n            // NOTE: Player authority migrating to ECS. Respect global inputIntent when available.\r\n            const intent = window.inputIntent || 0;\r\n            const forwardPressed = this.spaceship.thrust.forward || ((intent & 1) !== 0);\r\n            const backwardPressed = this.spaceship.thrust.backward || ((intent & 2) !== 0);\r\n            const leftPressed = this.spaceship.thrust.left || ((intent & 4) !== 0);\r\n            const rightPressed = this.spaceship.thrust.right || ((intent & 8) !== 0);\r\n            const boostPressed = this.spaceship.thrust.boost || ((intent & 16) !== 0);\r\n\r\n            // Forward thrust handling\r\n            if (forwardPressed) {\r\n                isThrusting = true;\r\n                const forwardThrust = new THREE.Vector3(0, 0, -Physics.THRUST_FORCE);\r\n                if (boostPressed) forwardThrust.multiplyScalar(Physics.BOOST_MULTIPLIER);\r\n                thrustVector.add(forwardThrust);\r\n                \r\n                // Visual effects handled by trail module\r\n            }\r\n            // Visual effects handled by trail module\r\n            \r\n            // Backward thrust handling\r\n            if (backwardPressed) {\r\n                isThrusting = true;\r\n                thrustVector.add(new THREE.Vector3(0, 0, Physics.THRUST_FORCE));\r\n                \r\n                // Visual effects handled by trail module\r\n            }\r\n            // Visual effects handled by trail module\r\n            \r\n            // Left thrust handling - A key pressed, move LEFT (negative X)\r\n            if (leftPressed) {\r\n                isThrusting = true;\r\n                thrustVector.add(new THREE.Vector3(-Physics.THRUST_FORCE, 0, 0));\r\n                \r\n                // Visual effects handled by trail module\r\n            }\r\n            // Visual effects handled by trail module\r\n            \r\n            // Right thrust handling - D key pressed, move RIGHT (positive X)\r\n            if (rightPressed) {\r\n                isThrusting = true;\r\n                thrustVector.add(new THREE.Vector3(Physics.THRUST_FORCE, 0, 0));\r\n                \r\n                // Visual effects handled by trail module\r\n            }\r\n            // Visual effects handled by trail module\r\n            \r\n            if (isThrusting) {\r\n                // Apply thrust in world space (only if actively thrusting)\r\n                thrustVector.applyQuaternion(this.spaceship.mesh.quaternion);\r\n                \r\n                // Apply thrust scaled by normalized delta time\r\n                thrustVector.multiplyScalar(this.normalizedDeltaTime);\r\n                this.spaceship.velocity.add(thrustVector);\r\n                \r\n                // Get the current max velocity from the spaceship\r\n                const maxVelocity = this.getMaxVelocity();\r\n                \r\n                // Cap velocity at maximum speed\r\n                if (this.spaceship.velocity.length() > maxVelocity) {\r\n                    this.spaceship.velocity.normalize().multiplyScalar(maxVelocity);\r\n                }\r\n            }\r\n        }\r\n        \r\n        // Add a small amount of \"space friction\" to make controls more manageable\r\n        // This isn't realistic physics but makes the game more enjoyable to play\r\n        if (!isThrusting && this.spaceship.velocity.length() > 0) {\r\n            const friction = Physics.FRICTION * this.normalizedDeltaTime;\r\n            if (this.spaceship.velocity.length() > friction) {\r\n                this.spaceship.velocity.multiplyScalar(1 - friction);\r\n            } else {\r\n                this.spaceship.velocity.set(0, 0, 0);\r\n            }\r\n        }\r\n        \r\n        // CRITICAL: Always update position based on current velocity (Newton's first law)\r\n        // Objects in motion stay in motion unless acted upon by a force\r\n        // Scale position update by normalized delta time\r\n        const positionDelta = this.spaceship.velocity.clone().multiplyScalar(this.normalizedDeltaTime);\r\n        this.spaceship.mesh.position.add(positionDelta);\r\n        \r\n        // Apply rotation based on rotationState\r\n        this.updateShipRotation();\r\n        \r\n        // Update camera position\r\n        this.updateCamera();\r\n        \r\n        // Update trail effects based on movement and thrust\r\n        if (this.spaceship.trailEffects) {\r\n            // Show effects based on ANY thrust or movement\r\n            const isThrusting = this.spaceship.thrust.forward || \r\n                               this.spaceship.thrust.backward || \r\n                               this.spaceship.thrust.left || \r\n                               this.spaceship.thrust.right;\r\n            const isMoving = this.spaceship.velocity.length() > 0.1;\r\n            \r\n            // Update trail effects directly\r\n            this.spaceship.trailEffects.updateTrailVisibility(isMoving, this.spaceship.thrust, this.spaceship.velocity);\r\n            this.spaceship.trailEffects.updateParticles(this.spaceship.thrust, this.spaceship.velocity);\r\n        }\r\n        \r\n        // Check for collisions with asteroids and planets\r\n        this.checkCollisions();\r\n    }\r\n    \r\n    // Helper method to get the max velocity from the spaceship or use the default\r\n    getMaxVelocity() {\r\n        return this.spaceship && this.spaceship.maxVelocity \r\n            ? this.spaceship.maxVelocity \r\n            : Physics.MAX_VELOCITY;\r\n    }\r\n    \r\n    updateShipRotation() {\r\n        if (!this.spaceship) return;\r\n        \r\n        // Cap y rotation to prevent flipping over (optional, can be adjusted or removed)\r\n        const maxY = Math.PI * 0.45; // Limit to ~45 degrees up/down\r\n        this.rotationState.y = Math.max(Math.min(this.rotationState.y, maxY), -maxY);\r\n        \r\n        // Create a quaternion for rotation\r\n        const euler = new THREE.Euler(this.rotationState.y, this.rotationState.x, 0, 'YXZ');\r\n        const targetQuaternion = new THREE.Quaternion().setFromEuler(euler);\r\n        \r\n        // Smoothly interpolate current rotation to target rotation\r\n        // Use rotation speed scaled by normalized delta time\r\n        this.spaceship.mesh.quaternion.slerp(targetQuaternion, Physics.ROTATION_SPEED * this.normalizedDeltaTime);\r\n    }\r\n    \r\n    updateCamera() {\r\n        if (!this.spaceship || !this.camera) return;\r\n        \r\n        // Skip camera updates if intro sequence is active\r\n        if (window.game && window.game.introSequenceActive) {\r\n            console.log(\"Skipping camera update - intro sequence active\");\r\n            return;\r\n        }\r\n        \r\n        // Update the camera to follow the spaceship with offset\r\n        // Camera moved much closer to ship for a zoomed-in view\r\n        const cameraOffset = new THREE.Vector3(0, 5, 25); // Brought much closer (was 0, 15, 75)\r\n        \r\n        // Apply spaceship rotation to camera offset\r\n        const rotatedOffset = cameraOffset.clone();\r\n        rotatedOffset.applyQuaternion(this.spaceship.mesh.quaternion);\r\n        \r\n        // Position camera behind and slightly above the spaceship\r\n        this.camera.position.copy(this.spaceship.mesh.position).add(rotatedOffset);\r\n        \r\n        // Look ahead of the spaceship\r\n        const lookAtPoint = new THREE.Vector3(0, 0, -60); // Adjusted lookAt point (was -200)\r\n        lookAtPoint.applyQuaternion(this.spaceship.mesh.quaternion);\r\n        lookAtPoint.add(this.spaceship.mesh.position);\r\n        \r\n        this.camera.lookAt(lookAtPoint);\r\n        \r\n        // Force visible frustum (debugging purposes)\r\n        this.camera.far = 400000; // Ensure far clip plane is beyond skybox\r\n        this.camera.updateProjectionMatrix();\r\n    }\r\n    \r\n    // Update rotation based on mouse movement deltas\r\n    updateRotation(deltaX, deltaY) {\r\n        // Update the rotation directly\r\n        this.rotationState.x -= deltaX;\r\n        this.rotationState.y -= deltaY;\r\n    }\r\n    \r\n    // Check for collisions with asteroids and planets\r\n    checkCollisions() {\r\n        if (!this.scene || !this.spaceship) return;\r\n        \r\n        // Set a smaller collision radius based on actual ship size\r\n        // This was previously Physics.COLLISION_DISTANCE (70) which was too large\r\n        const shipRadius = 15; // Reduced from 70 to match actual ship size\r\n        const shipPosition = this.spaceship.mesh.position.clone();\r\n        \r\n        // First check if we're colliding with our own projectiles and skip those\r\n        this.scene.traverse(object => {\r\n            if (object.type === 'Mesh' && \r\n                object.geometry.type?.includes('SphereGeometry') && \r\n                object.userData.isPlayerProjectile &&\r\n                object.userData.sourceId === 'player') {\r\n                \r\n                // Skip our own projectiles - don't even process them\r\n                return;\r\n            }\r\n        });\r\n        \r\n        // 1. Check collisions with asteroids\r\n        const asteroidMeshes = [];\r\n        \r\n        // Direct access to the asteroid belt if possible\r\n        const asteroidBelt = this.scene.children.find(child => child.name === 'asteroidBelt');\r\n        let asteroids = [];\r\n        \r\n        // If we can get direct access to asteroid belt object, use that for better performance\r\n        if (asteroidBelt && asteroidBelt.userData && asteroidBelt.userData.asteroids) {\r\n            asteroids = asteroidBelt.userData.asteroids;\r\n            asteroidMeshes.push(...asteroids.map(a => a.mesh));\r\n        } else {\r\n            // Otherwise do the more expensive scene traversal\r\n            this.scene.traverse(object => {\r\n                // Check for asteroids using geometry type\r\n                if (object.type === 'Mesh' && \r\n                    (object.geometry.type?.includes('IcosahedronGeometry') || \r\n                     object.geometry.type?.includes('TetrahedronGeometry') || \r\n                     object.geometry.type?.includes('OctahedronGeometry'))) {\r\n                    \r\n                    // Only consider objects within the asteroid belt range to avoid false positives\r\n                    const distFromCenter = Math.sqrt(\r\n                        object.position.x * object.position.x + \r\n                        object.position.z * object.position.z\r\n                    );\r\n                    \r\n                    // Only include objects in the appropriate distance range from the center\r\n                    // This helps avoid mistaking other geometric objects for asteroids\r\n                    if (distFromCenter > 16000 && distFromCenter < 32000) {\r\n                        asteroidMeshes.push(object);\r\n                    }\r\n                }\r\n            });\r\n        }\r\n        \r\n        // Check distance to each asteroid - precise collision detection\r\n        for (const asteroid of asteroidMeshes) {\r\n            // Skip null items or invisible asteroids\r\n            if (!asteroid || !asteroid.visible) continue;\r\n            \r\n            const distance = shipPosition.distanceTo(asteroid.position);\r\n            \r\n            // Use actual size from geometry if available - no artificial inflation\r\n            let asteroidRadius = 0;\r\n            \r\n            if (asteroid.geometry && asteroid.geometry.parameters && asteroid.geometry.parameters.radius) {\r\n                // Use the exact geometry radius without multiplication\r\n                asteroidRadius = asteroid.geometry.parameters.radius;\r\n            } else {\r\n                // Fallback size - more accurate estimation\r\n                asteroidRadius = 60; // 4x original value to match larger asteroids\r\n            }\r\n            \r\n            // If collision detected - uses the sum of actual ship and asteroid radii\r\n            if (distance < (shipRadius + asteroidRadius)) {\r\n                // Only log collision in debug mode\r\n                if (window.DEBUG_MODE) {\r\n                    console.log(\"Asteroid collision detected!\", \r\n                        \"Ship position:\", shipPosition,\r\n                        \"Asteroid position:\", asteroid.position,\r\n                        \"Distance:\", distance, \r\n                        \"Detection threshold:\", (shipRadius + asteroidRadius));\r\n                }\r\n                \r\n                this.handleCollision(asteroid, \"asteroid\");\r\n                return; // Exit after first collision\r\n            }\r\n        }\r\n        \r\n        // 2. Check collisions with planets\r\n        this.scene.traverse(object => {\r\n            // Check if this is a planet - they typically have larger scale\r\n            if (object.type === 'Mesh' && \r\n                object.geometry.type.includes('SphereGeometry') && \r\n                object.scale.x >= 1 && // To filter out particles and small objects\r\n                !object.userData.id?.startsWith('asteroid-') && // Not an asteroid\r\n                !object.userData.isPlayerProjectile && // Not a player projectile\r\n                object !== this.spaceship.mesh) { // Not the spaceship itself\r\n                \r\n                const distance = shipPosition.distanceTo(object.position);\r\n                \r\n                // For planets, we use the actual geometry radius without artificial inflation\r\n                const planetRadius = object.geometry.parameters.radius * object.scale.x;\r\n                \r\n                // If the object is the sun\r\n                if (object.material.emissive && \r\n                    object.material.emissive.r > 0.5 && \r\n                    object.material.emissive.g > 0.5) {\r\n                    // Sun collision: if we're within the exact combined radius\r\n                    if (distance < planetRadius + shipRadius) {\r\n                        this.handleCollision(object, \"sun\");\r\n                        return;\r\n                    }\r\n                } \r\n                // Regular planet collision\r\n                else if (distance < planetRadius + shipRadius) {\r\n                    this.handleCollision(object, \"planet\");\r\n                    return;\r\n                }\r\n            }\r\n        });\r\n    }\r\n    \r\n    handleCollision(object, type) {\r\n        if (this.collided || !this.scene) return; // Only handle the first collision\r\n        \r\n        this.collided = true;\r\n        \r\n        // Enhanced logging for collision diagnostics (only in debug mode)\r\n        if (window.DEBUG_MODE) {\r\n            console.log(\"=== COLLISION DETECTED ===\");\r\n            console.log(`Collision type: ${type}`);\r\n            console.log(`Ship velocity at impact: ${this.spaceship.velocity.length().toFixed(2)} units/frame`);\r\n            console.log(`Ship position: x=${this.spaceship.mesh.position.x.toFixed(0)}, y=${this.spaceship.mesh.position.y.toFixed(0)}, z=${this.spaceship.mesh.position.z.toFixed(0)}`);\r\n            console.log(`${type} position: x=${object.position.x.toFixed(0)}, y=${object.position.y.toFixed(0)}, z=${object.position.z.toFixed(0)}`);\r\n            console.log(`Hull resistance: ${this.spaceship.collisionResistance}`);\r\n        }\r\n        \r\n        // Apply hull resistance to see if we survive the collision\r\n        if (this.attemptCollisionRecovery(type)) {\r\n            if (window.DEBUG_MODE) console.log(\"Hull absorbed collision damage!\");\r\n            this.createRecoveryEffect();\r\n            \r\n            // Bounce away from the collision point\r\n            if (object && object.position) {\r\n                const bounceDirection = new THREE.Vector3()\r\n                    .subVectors(this.spaceship.mesh.position, object.position)\r\n                    .normalize();\r\n                \r\n                // Apply a bounce force\r\n                this.spaceship.velocity.copy(bounceDirection.multiplyScalar(5));\r\n            }\r\n            \r\n            // Play the \"boink\" sound for minor collisions\r\n            if (window.game && window.game.audio) {\r\n                window.game.audio.playSound('boink');\r\n            }\r\n            \r\n            // Reset collision state after a short delay\r\n            setTimeout(() => {\r\n                this.collided = false;\r\n                if (window.DEBUG_MODE) console.log(\"Collision state reset - ship ready for new collisions\");\r\n            }, 1000);\r\n            \r\n            return;\r\n        }\r\n        \r\n        // If we didn't recover, publish game over event instead of handling directly\r\n        // Stop the ship\r\n        this.spaceship.velocity.set(0, 0, 0);\r\n        \r\n        // Different explosion effects based on collision type\r\n        let explosionColor, explosionSize, explosionMessage, collisionType;\r\n        \r\n        if (type === \"sun\") {\r\n            // Solar collision - big, bright yellow explosion\r\n            explosionColor = 0xffff00;\r\n            explosionSize = 60; // 4x original size (was 15)\r\n            explosionMessage = \"Your ship was incinerated by the sun!\";\r\n            collisionType = \"SUN_DEATH\";\r\n        } else if (type === \"planet\") {\r\n            // Planet collision - large blue-tinted explosion\r\n            explosionColor = 0x33ccff;\r\n            explosionSize = 40; // 4x original size (was 10)\r\n            explosionMessage = \"Your ship crashed into a planet!\";\r\n            collisionType = \"COLLISION_PLANET\";\r\n        } else {\r\n            // Default asteroid collision - smaller orange explosion\r\n            explosionColor = 0xff6600;\r\n            explosionSize = 20; // 4x original size (was 5)\r\n            explosionMessage = \"Your ship was destroyed by an asteroid!\";\r\n            collisionType = \"COLLISION_ASTEROID\";\r\n        }\r\n        \r\n        // Create visual effect for the collision\r\n        const explosionGeometry = new THREE.SphereGeometry(explosionSize, 32, 32);\r\n        const explosionMaterial = new THREE.MeshBasicMaterial({\r\n            color: explosionColor,\r\n            transparent: true,\r\n            opacity: 0.8\r\n        });\r\n        const explosion = new THREE.Mesh(explosionGeometry, explosionMaterial);\r\n        explosion.position.copy(this.spaceship.mesh.position);\r\n        this.scene.add(explosion);\r\n        \r\n        // Animate the explosion\r\n        this.animateExplosion(explosion);\r\n        \r\n        // Mark the ship as destroyed internally\r\n        if (this.spaceship) {\r\n            this.spaceship.isDestroyed = true;\r\n        }\r\n        \r\n        \r\n        console.log(\"Physics: Initiating game over sequence for collision with\", type);\r\n        \r\n        // Use window.mainMessageBus if available\r\n        if (window.mainMessageBus) {\r\n            console.log(\"Physics: Using window.mainMessageBus\");\r\n            window.mainMessageBus.publish('game.over', {\r\n                reason: explosionMessage,\r\n                source: \"physics\",\r\n                collisionType: type,\r\n                type: collisionType\r\n            });\r\n        } else if (window.game && window.game.messageBus) {\r\n            // Use game message bus if main message bus not available\r\n            console.log(\"Physics: Using window.game.messageBus\");\r\n            window.game.messageBus.publish('game.over', {\r\n                reason: explosionMessage,\r\n                source: \"physics\",\r\n                collisionType: type,\r\n                type: collisionType\r\n            });\r\n        } else {\r\n            // Only use MessageBus.triggerGameOver if no direct access\r\n            import('../core/messageBus.js').then(module => {\r\n                const MessageBus = module.MessageBus;\r\n                console.log(\"Physics: Using MessageBus.triggerGameOver\");\r\n                \r\n                MessageBus.triggerGameOver(explosionMessage, \"physics\");\r\n            }).catch(err => {\r\n                console.error(\"Physics: Error importing MessageBus:\", err);\r\n            });\r\n        }\r\n    }\r\n    \r\n    // Method to attempt to recover from a collision based on hull resistance\r\n    attemptCollisionRecovery(collisionType) {\r\n        if (!this.spaceship || !this.spaceship.collisionResistance) \r\n            return false;\r\n        \r\n        // Get the hull resistance value\r\n        const resistance = this.spaceship.collisionResistance;\r\n        \r\n        // Different collision types have different chances of recovery\r\n        // Higher resistance increases chances\r\n        let recoveryChance = 0;\r\n        \r\n        switch (collisionType) {\r\n            case \"asteroid\":\r\n                // 50% base chance + 8% per hull level as requested\r\n                recoveryChance = 0.50 + (resistance - 1) * 0.08;\r\n                if (window.DEBUG_MODE) console.log(`Asteroid collision recovery chance: ${(recoveryChance * 100).toFixed(1)}%`);\r\n                break;\r\n            case \"planet\":\r\n                // Start with 10% chance, increased by hull resistance\r\n                recoveryChance = 0.1 + (resistance - 1) * 0.2;\r\n                if (window.DEBUG_MODE) console.log(`Planet collision recovery chance: ${(recoveryChance * 100).toFixed(1)}%`);\r\n                break;\r\n            case \"sun\":\r\n                // Almost no chance to survive sun collision\r\n                recoveryChance = (resistance - 1) * 0.05;\r\n                if (window.DEBUG_MODE) console.log(`Sun collision recovery chance: ${(recoveryChance * 100).toFixed(1)}%`);\r\n                break;\r\n            default:\r\n                recoveryChance = 0.2 + (resistance - 1) * 0.3;\r\n                if (window.DEBUG_MODE) console.log(`Generic collision recovery chance: ${(recoveryChance * 100).toFixed(1)}%`);\r\n        }\r\n        \r\n        // Random chance based on recovery probability\r\n        const recoveryRoll = Math.random();\r\n        const survived = recoveryRoll < recoveryChance;\r\n        \r\n        if (window.DEBUG_MODE) console.log(`Recovery roll: ${recoveryRoll.toFixed(3)}, needed ${recoveryChance.toFixed(3)} or lower to survive`);\r\n        \r\n        return survived;\r\n    }\r\n    \r\n    // Create a visual effect when the ship survives a collision\r\n    createRecoveryEffect() {\r\n        if (!this.spaceship || !this.scene) return;\r\n        \r\n        // Create a shield-like effect around the ship\r\n        const shieldGeometry = new THREE.SphereGeometry(60, 32, 32); // 4x original size (was 15)\r\n        const shieldMaterial = new THREE.MeshBasicMaterial({\r\n            color: 0x30cfd0,\r\n            transparent: true,\r\n            opacity: 0.6,\r\n            side: THREE.DoubleSide\r\n        });\r\n        \r\n        const shield = new THREE.Mesh(shieldGeometry, shieldMaterial);\r\n        shield.position.copy(this.spaceship.mesh.position);\r\n        this.scene.add(shield);\r\n        \r\n        // Animate the shield (expand and fade out)\r\n        let scale = 1;\r\n        const expandSpeed = 0.05;\r\n        const fadeSpeed = 0.02;\r\n        \r\n        const animateShield = () => {\r\n            if (scale > 2 || shield.material.opacity <= 0) {\r\n                this.scene.remove(shield);\r\n                return;\r\n            }\r\n            \r\n            scale += expandSpeed;\r\n            shield.scale.set(scale, scale, scale);\r\n            shield.material.opacity -= fadeSpeed;\r\n            \r\n            // Update shield position to follow ship\r\n            if (this.spaceship && this.spaceship.mesh) {\r\n                shield.position.copy(this.spaceship.mesh.position);\r\n            }\r\n            \r\n            requestAnimationFrame(animateShield);\r\n        };\r\n        \r\n        animateShield();\r\n    }\r\n    \r\n    animateExplosion(explosion) {\r\n        let scale = 1;\r\n        const expandSpeed = 0.5;\r\n        const fadeSpeed = 0.02;\r\n        \r\n        const animate = () => {\r\n            if (scale > 20 || explosion.material.opacity <= 0) {\r\n                this.scene.remove(explosion);\r\n                return;\r\n            }\r\n            \r\n            scale += expandSpeed;\r\n            explosion.scale.set(scale, scale, scale);\r\n            explosion.material.opacity -= fadeSpeed;\r\n            \r\n            requestAnimationFrame(animate);\r\n        };\r\n        \r\n        animate();\r\n    }\r\n}","// skybox.js - Creates and manages advanced procedural skybox with volumetric effects\r\n\r\nimport * as THREE from 'three';\r\n\r\nexport class Skybox {\r\n    constructor(scene) {\r\n        this.scene = scene;\r\n        this.skybox = null;\r\n        this.time = 0;\r\n        \r\n        // Create texture loader\r\n        this.textureLoader = new THREE.TextureLoader();\r\n        \r\n        // Load the Milky Way texture\r\n        this.milkyWayTexture = this.textureLoader.load('./assets/2k_stars_milky_way.jpg');\r\n        this.milkyWayTexture.colorSpace = THREE.SRGBColorSpace;\r\n        \r\n        // Store additional skybox textures\r\n        this.skyboxTextures = {};\r\n        \r\n        // Store initial parameters for the Solar System\r\n        this.solarSystemParams = {\r\n            starDensity: 1.0,\r\n            nebulaDensity: 0.5,\r\n            color: 0xFFFFFF,\r\n            texturePath: './assets/2k_stars_milky_way.jpg',\r\n            brightness: 1.0 // Default brightness for Solar System\r\n        };\r\n        \r\n        this.createProceduralSkybox(this.solarSystemParams);\r\n    }\r\n    \r\n    // Update skybox based on star system parameters\r\n    updateForSystem(params) {\r\n        if (!params) return;\r\n        \r\n        console.log(\"Updating skybox with parameters:\", params);\r\n        \r\n        // Special case for Solar System - ensure consistent appearance\r\n        if (params.isSolarSystem || \r\n            (params.color === 0xFFFFFF && params.starDensity === 1.0 && params.nebulaDensity === 0.5)) {\r\n            console.log(\"Detected Solar System skybox parameters, using stored solar system configuration\");\r\n            params = this.solarSystemParams;\r\n        }\r\n        \r\n        // Remove existing skybox\r\n        if (this.skybox) {\r\n            console.log(\"Removing existing skybox\");\r\n            this.scene.remove(this.skybox);\r\n        }\r\n        \r\n        // Reset time for consistent star pattern\r\n        if (params.resetTime) {\r\n            this.time = 0;\r\n        }\r\n        \r\n        // Create new skybox with system parameters\r\n        this.createProceduralSkybox(params);\r\n    }\r\n    \r\n    // Load texture if needed and return it\r\n    getTexture(texturePath) {\r\n        // Use default Milky Way texture if none specified\r\n        if (!texturePath) {\r\n            return this.milkyWayTexture;\r\n        }\r\n        \r\n        // Return Milky Way texture for the default Solar System texture\r\n        if (texturePath === './assets/2k_stars_milky_way.jpg') {\r\n            return this.milkyWayTexture;\r\n        }\r\n        \r\n        // Fix texture path for API server images\r\n        let adjustedTexturePath = texturePath;\r\n        \r\n        // Check if this is an image from our API server\r\n        if (texturePath.startsWith('/images/')) {\r\n            // If running on port 8000, adjust URL to point to port 8001\r\n            if (window.location.port === '8000') {\r\n                const serverHost = window.location.hostname;\r\n                adjustedTexturePath = `http://${serverHost}:8001${texturePath}`;\r\n                console.log(`Adjusted texture path to API server: ${adjustedTexturePath}`);\r\n            }\r\n        }\r\n        \r\n        // Load the texture if not already loaded\r\n        if (!this.skyboxTextures[texturePath]) {\r\n            console.log(`Loading new skybox texture: ${adjustedTexturePath}`);\r\n            this.skyboxTextures[texturePath] = this.textureLoader.load(adjustedTexturePath);\r\n            this.skyboxTextures[texturePath].colorSpace = THREE.SRGBColorSpace;\r\n        }\r\n        \r\n        return this.skyboxTextures[texturePath];\r\n    }\r\n    \r\n    createProceduralSkybox(params = {}) {\r\n        // Apply system parameters if provided\r\n        let starDensity = params?.starDensity || 1.0;\r\n        let nebulaDensity = params?.nebulaDensity || 0.5;\r\n        let skyboxColor = params?.color || 0x000000;\r\n        let brightness = params?.brightness !== undefined ? params.brightness : 1.0;\r\n        const size = 320000; // Very large size to contain entire game world (4x original)\r\n        const texturePath = params?.texturePath || './assets/2k_stars_milky_way.jpg';\r\n        \r\n        console.log(`Creating enhanced skybox with star density: ${starDensity}, nebula density: ${nebulaDensity}, color: 0x${skyboxColor.toString(16)}, texture: ${texturePath}, brightness: ${brightness}`);\r\n        \r\n        // Get the appropriate texture\r\n        const skyboxTexture = this.getTexture(texturePath);\r\n        \r\n        // Create advanced shader material for skybox with texture\r\n        const skyMaterial = new THREE.ShaderMaterial({\r\n            uniforms: {\r\n                time: { value: this.time || 0 },\r\n                milkyWayTexture: { value: skyboxTexture },\r\n                starDensity: { value: starDensity },\r\n                nebulaDensity: { value: nebulaDensity },\r\n                skyColor: { value: new THREE.Color(skyboxColor) },\r\n                brightness: { value: brightness }\r\n            },\r\n            vertexShader: `\r\n                varying vec2 vUv;\r\n                varying vec3 vPosition;\r\n                \r\n                void main() {\r\n                    vUv = uv;\r\n                    vPosition = position;\r\n                    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\r\n                }\r\n            `,\r\n            fragmentShader: `\r\n                uniform sampler2D milkyWayTexture;\r\n                uniform float time;\r\n                uniform float starDensity;\r\n                uniform float nebulaDensity;\r\n                uniform vec3 skyColor;\r\n                uniform float brightness;\r\n                \r\n                varying vec2 vUv;\r\n                varying vec3 vPosition;\r\n                \r\n                void main() {\r\n                    // Sample the Milky Way texture with adjusted brightness\r\n                    vec4 milkyWay = texture2D(milkyWayTexture, vUv);\r\n                    milkyWay.rgb *= 1.5 * brightness; // Apply brightness factor\r\n                    \r\n                    // Use only the Milky Way texture without procedural stars\r\n                    vec3 finalColor = milkyWay.rgb * nebulaDensity * 1.2 * brightness;\r\n                    \r\n                    // Reduced ambient light\r\n                    finalColor += vec3(0.05);\r\n                    \r\n                    // Subtle color tint\r\n                    finalColor = mix(finalColor, skyColor * 1.2 * brightness, 0.1);\r\n                    \r\n                    // Apply gamma correction for more natural brightness\r\n                    finalColor = pow(finalColor, vec3(0.9));\r\n                    \r\n                    gl_FragColor = vec4(finalColor, 1.0);\r\n                }\r\n            `,\r\n            side: THREE.BackSide\r\n        });\r\n        \r\n        // Create the skybox mesh\r\n        const skyboxGeometry = new THREE.BoxGeometry(size, size, size);\r\n        this.skybox = new THREE.Mesh(skyboxGeometry, skyMaterial);\r\n        \r\n        // Rotate the skybox to align the Milky Way with the galactic plane\r\n        this.skybox.rotation.x = Math.PI / 4;\r\n        this.skybox.rotation.y = Math.PI / 6;\r\n        \r\n        this.scene.add(this.skybox);\r\n        \r\n        // Store material for updates\r\n        this.skyMaterial = skyMaterial;\r\n        \r\n        console.log(\"Enhanced skybox created with texture\");\r\n    }\r\n    \r\n    update(deltaTime = 0.016, camera) {\r\n        // Update skybox animation\r\n        if (this.skyMaterial) {\r\n            this.time += deltaTime * 0.1; // Slower star movement\r\n            this.skyMaterial.uniforms.time.value = this.time;\r\n        }\r\n        \r\n        // Keep skybox centered on camera if it exists\r\n        if (this.skybox && camera) {\r\n            this.skybox.position.copy(camera.position);\r\n        }\r\n    }\r\n}","// sunShaders.js - Sun shader materials and effects\r\n\r\nimport * as THREE from 'three';\r\n\r\nexport class SunShaders {\r\n    static createSunMaterial() {\r\n        return new THREE.ShaderMaterial({\r\n            uniforms: {\r\n                time: { value: 0 },\r\n                sunColor: { value: new THREE.Color(0xff7700) },\r\n                surfaceDetail: { value: 1.2 },\r\n                surfaceDistortion: { value: 0.3 },\r\n                sunActivity: { value: 0.8 }\r\n            },\r\n            vertexShader: `\r\n                varying vec3 vNormal;\r\n                varying vec2 vUv;\r\n                varying vec3 vPosition;\r\n                \r\n                void main() {\r\n                    vUv = uv;\r\n                    vNormal = normalize(normalMatrix * normal);\r\n                    vPosition = position;\r\n                    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\r\n                }\r\n            `,\r\n            fragmentShader: `\r\n                uniform float time;\r\n                uniform vec3 sunColor;\r\n                uniform float surfaceDetail;\r\n                uniform float surfaceDistortion;\r\n                uniform float sunActivity;\r\n                \r\n                varying vec3 vNormal;\r\n                varying vec2 vUv;\r\n                varying vec3 vPosition;\r\n                \r\n                float hash(float n) { return fract(sin(n) * 43758.5453123); }\r\n                float hash(vec2 p) { return fract(sin(dot(p, vec2(127.1, 311.7))) * 43758.5453); }\r\n                \r\n                float noise(vec3 x) {\r\n                    vec3 p = floor(x);\r\n                    vec3 f = fract(x);\r\n                    f = f * f * (3.0 - 2.0 * f);\r\n                    \r\n                    float n = p.x + p.y * 157.0 + 113.0 * p.z;\r\n                    return mix(\r\n                        mix(mix(hash(n + 0.0), hash(n + 1.0), f.x),\r\n                            mix(hash(n + 157.0), hash(n + 158.0), f.x), f.y),\r\n                        mix(mix(hash(n + 113.0), hash(n + 114.0), f.x),\r\n                            mix(hash(n + 270.0), hash(n + 271.0), f.x), f.y),\r\n                        f.z);\r\n                }\r\n                \r\n                float fbm(vec3 x) {\r\n                    float v = 0.0;\r\n                    float a = 0.5;\r\n                    vec3 shift = vec3(100);\r\n                    \r\n                    for (int i = 0; i < 7; ++i) {\r\n                        v += a * noise(x);\r\n                        x = x * 2.0 + shift;\r\n                        a *= 0.5;\r\n                    }\r\n                    \r\n                    return v;\r\n                }\r\n                \r\n                void main() {\r\n                    vec3 surfacePos = vPosition * surfaceDetail * 0.01;\r\n                    float granulation = fbm(surfacePos + time * 0.15);\r\n                    \r\n                    float flareBase = fbm(surfacePos * 2.5 + time * 0.3);\r\n                    float flares = pow(flareBase, 1.8) * sunActivity;\r\n                    flares = smoothstep(0.65, 0.9, flares);\r\n                    \r\n                    float hotspots = fbm(surfacePos * 3.0 + time * 0.2) * fbm(surfacePos * 1.5 - time * 0.1);\r\n                    hotspots = pow(hotspots, 3.0) * 1.5;\r\n                    \r\n                    vec3 distortedNormal = vNormal;\r\n                    distortedNormal.x += noise(surfacePos * 6.0 + time * 0.15) * surfaceDistortion;\r\n                    distortedNormal.y += noise(surfacePos * 6.0 + time * 0.2) * surfaceDistortion;\r\n                    distortedNormal.z += noise(surfacePos * 6.0 + time * 0.17) * surfaceDistortion;\r\n                    distortedNormal = normalize(distortedNormal);\r\n                    \r\n                    float edgeBrightness = 1.0 - dot(distortedNormal, vec3(0.0, 0.0, 1.0));\r\n                    edgeBrightness = pow(edgeBrightness, 2.5) * 0.4;\r\n                    \r\n                    vec3 baseColor = sunColor;\r\n                    vec3 hotColor = vec3(1.0, 0.8, 0.4);\r\n                    vec3 flareColor = vec3(1.0, 0.6, 0.3);\r\n                    \r\n                    vec3 finalColor = baseColor * (1.0 + granulation * 0.4);\r\n                    finalColor = mix(finalColor, hotColor, hotspots);\r\n                    finalColor += flareColor * flares;\r\n                    finalColor += vec3(1.0, 0.9, 0.7) * edgeBrightness;\r\n                    \r\n                    gl_FragColor = vec4(finalColor, 1.0);\r\n                }\r\n            `,\r\n            side: THREE.FrontSide\r\n        });\r\n    }\r\n\r\n    static createCoronaMaterial() {\r\n        return new THREE.ShaderMaterial({\r\n            uniforms: {\r\n                time: { value: 0 },\r\n                coronaColor: { value: new THREE.Color(0xff9940) },\r\n                viewVector: { value: new THREE.Vector3(0, 0, 1) },\r\n                turbulence: { value: 0.6 }\r\n            },\r\n            vertexShader: `\r\n                uniform vec3 viewVector;\r\n                varying vec3 vNormal;\r\n                varying vec3 vPosition;\r\n                varying float vIntensity;\r\n                \r\n                void main() {\r\n                    vNormal = normalize(normalMatrix * normal);\r\n                    vPosition = position;\r\n                    \r\n                    vec3 viewDir = normalize(viewVector);\r\n                    vIntensity = pow(1.15 - dot(vNormal, viewDir), 1.5) * 0.8 + 0.2;\r\n                    \r\n                    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\r\n                }\r\n            `,\r\n            fragmentShader: `\r\n                uniform float time;\r\n                uniform vec3 coronaColor;\r\n                uniform float turbulence;\r\n                \r\n                varying vec3 vNormal;\r\n                varying vec3 vPosition;\r\n                varying float vIntensity;\r\n                \r\n                float hash(vec3 p) {\r\n                    p = fract(p * vec3(443.897, 441.423, 437.195));\r\n                    p += dot(p, p.yzx + 19.19);\r\n                    return fract((p.x + p.y) * p.z);\r\n                }\r\n                \r\n                float noise(vec3 p) {\r\n                    vec3 i = floor(p);\r\n                    vec3 f = fract(p);\r\n                    f = f*f*(3.0-2.0*f);\r\n                    \r\n                    return mix(\r\n                        mix(mix(hash(i), hash(i + vec3(1,0,0)), f.x),\r\n                            mix(hash(i + vec3(0,1,0)), hash(i + vec3(1,1,0)), f.x), f.y),\r\n                        mix(mix(hash(i + vec3(0,0,1)), hash(i + vec3(1,0,1)), f.x),\r\n                            mix(hash(i + vec3(0,1,1)), hash(i + vec3(1,1,1)), f.x), f.y), f.z);\r\n                }\r\n                \r\n                float fbm(vec3 p) {\r\n                    float f = 0.0;\r\n                    float weight = 0.5;\r\n                    for (int i = 0; i < 5; i++) {\r\n                        f += weight * noise(p);\r\n                        weight *= 0.5;\r\n                        p *= 2.0;\r\n                    }\r\n                    return f;\r\n                }\r\n                \r\n                void main() {\r\n                    float turbulenceFactor = fbm(vPosition * 0.005 + time * 0.15) * turbulence;\r\n                    float finalIntensity = vIntensity * (1.0 + turbulenceFactor);\r\n                    \r\n                    float wisps = fbm(vPosition * 0.01 - time * 0.05) * fbm(vPosition * 0.02 + time * 0.1);\r\n                    wisps = pow(wisps, 2.0) * 0.5;\r\n                    \r\n                    vec3 finalColor = coronaColor * (finalIntensity + wisps);\r\n                    \r\n                    if (finalIntensity > 0.7) {\r\n                        finalColor = mix(finalColor, vec3(1.0, 0.9, 0.7), (finalIntensity - 0.7) * 3.0);\r\n                    }\r\n                    \r\n                    float alpha = smoothstep(0.0, 0.15, finalIntensity + wisps * 0.5);\r\n                    \r\n                    gl_FragColor = vec4(finalColor, alpha * 0.9);\r\n                }\r\n            `,\r\n            transparent: true,\r\n            blending: THREE.AdditiveBlending,\r\n            depthWrite: false,\r\n            side: THREE.BackSide\r\n        });\r\n    }\r\n\r\n    static createOuterCoronaMaterial() {\r\n        return new THREE.ShaderMaterial({\r\n            uniforms: {\r\n                time: { value: 0 },\r\n                coronaColor: { value: new THREE.Color(0xff8800) },\r\n                viewVector: { value: new THREE.Vector3(0, 0, 1) }\r\n            },\r\n            vertexShader: `\r\n                uniform vec3 viewVector;\r\n                varying float vIntensity;\r\n                varying vec3 vPosition;\r\n                \r\n                void main() {\r\n                    vec3 vNormal = normalize(normalMatrix * normal);\r\n                    vec3 vNormel = normalize(viewVector);\r\n                    vIntensity = pow(1.05 - dot(vNormal, vNormel), 2.0) * 0.7 + 0.3;\r\n                    vPosition = position;\r\n                    \r\n                    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\r\n                }\r\n            `,\r\n            fragmentShader: `\r\n                uniform float time;\r\n                uniform vec3 coronaColor;\r\n                varying float vIntensity;\r\n                varying vec3 vPosition;\r\n                \r\n                float hash(vec3 p) {\r\n                    p = fract(p * vec3(443.897, 441.423, 437.195));\r\n                    p += dot(p, p.yzx + 19.19);\r\n                    return fract((p.x + p.y) * p.z);\r\n                }\r\n                \r\n                float noise(vec3 p) {\r\n                    vec3 i = floor(p);\r\n                    vec3 f = fract(p);\r\n                    f = f*f*(3.0-2.0*f);\r\n                    \r\n                    return mix(\r\n                        mix(mix(hash(i), hash(i + vec3(1,0,0)), f.x),\r\n                            mix(hash(i + vec3(0,1,0)), hash(i + vec3(1,1,0)), f.x), f.y),\r\n                        mix(mix(hash(i + vec3(0,0,1)), hash(i + vec3(1,0,1)), f.x),\r\n                            mix(hash(i + vec3(0,1,1)), hash(i + vec3(1,1,1)), f.x), f.y), f.z);\r\n                }\r\n                \r\n                void main() {\r\n                    float noiseVal = noise(vPosition * 0.002 + time * 0.1);\r\n                    float pulseIntensity = vIntensity * (1.0 + 0.2 * sin(time + noiseVal * 5.0));\r\n                    \r\n                    pulseIntensity += noiseVal * 0.2;\r\n                    \r\n                    vec3 glow = coronaColor * pulseIntensity;\r\n                    gl_FragColor = vec4(glow, pulseIntensity * 0.4);\r\n                }\r\n            `,\r\n            transparent: true,\r\n            blending: THREE.AdditiveBlending,\r\n            depthWrite: false,\r\n            side: THREE.BackSide\r\n        });\r\n    }\r\n}","// sunFlares.js - Sun lens flare and particle effects\r\n\r\nimport * as THREE from 'three';\r\n\r\nexport class SunFlares {\r\n    constructor(scene, sunGroup) {\r\n        this.scene = scene;\r\n        this.sunGroup = sunGroup;\r\n        this.lensFlares = [];\r\n        this.createFireballFlares();\r\n    }\r\n\r\n    createFireballFlares() {\r\n        const flareTextures = [\r\n            'https://cdn.jsdelivr.net/gh/mrdoob/three.js@r128/examples/textures/lensflare/lensflare0.png',\r\n            'https://cdn.jsdelivr.net/gh/mrdoob/three.js@r128/examples/textures/lensflare/lensflare2.png',\r\n            'https://cdn.jsdelivr.net/gh/mrdoob/three.js@r128/examples/textures/lensflare/lensflare3.png'\r\n        ];\r\n        \r\n        const textureLoader = new THREE.TextureLoader();\r\n        \r\n        this.clearFlares();\r\n        \r\n        // Create main central flare\r\n        const mainFlareTexture = textureLoader.load(flareTextures[0]);\r\n        mainFlareTexture.colorSpace = THREE.SRGBColorSpace;\r\n        const mainFlare = new THREE.Sprite(new THREE.SpriteMaterial({\r\n            map: mainFlareTexture,\r\n            color: 0xffaa55,\r\n            transparent: true,\r\n            blending: THREE.AdditiveBlending,\r\n            depthTest: false\r\n        }));\r\n        mainFlare.scale.set(700, 700, 1.0);\r\n        this.sunGroup.add(mainFlare);\r\n        this.lensFlares.push(mainFlare);\r\n        \r\n        // Create smaller surrounding flares\r\n        const flareCount = 8;\r\n        const radius = 300;\r\n        \r\n        for (let i = 0; i < flareCount; i++) {\r\n            const textureIndex = 1 + (i % 2);\r\n            const flareTexture = textureLoader.load(flareTextures[textureIndex]);\r\n            flareTexture.colorSpace = THREE.SRGBColorSpace;\r\n            \r\n            const flare = new THREE.Sprite(new THREE.SpriteMaterial({\r\n                map: flareTexture,\r\n                color: i % 3 === 0 ? 0xffcc77 : (i % 3 === 1 ? 0xff8855 : 0xff6622),\r\n                transparent: true,\r\n                blending: THREE.AdditiveBlending,\r\n                depthTest: false\r\n            }));\r\n            \r\n            const angle = (i / flareCount) * Math.PI * 2;\r\n            const x = Math.cos(angle) * radius;\r\n            const y = Math.sin(angle) * radius;\r\n            flare.position.set(x, y, 0);\r\n            \r\n            const size = 200 + Math.random() * 200;\r\n            flare.scale.set(size, size, 1.0);\r\n            \r\n            this.sunGroup.add(flare);\r\n            this.lensFlares.push(flare);\r\n            \r\n            if (i % 2 === 0) {\r\n                const smallFlareTexture = textureLoader.load(flareTextures[i % 3]);\r\n                smallFlareTexture.colorSpace = THREE.SRGBColorSpace;\r\n                \r\n                const smallFlare = new THREE.Sprite(new THREE.SpriteMaterial({\r\n                    map: smallFlareTexture,\r\n                    color: 0xffaa22,\r\n                    transparent: true,\r\n                    blending: THREE.AdditiveBlending,\r\n                    depthTest: false\r\n                }));\r\n                \r\n                const farRadius = radius * 2;\r\n                const farAngle = angle + (Math.random() * 0.2 - 0.1);\r\n                const farX = Math.cos(farAngle) * farRadius;\r\n                const farY = Math.sin(farAngle) * farRadius;\r\n                smallFlare.position.set(farX, farY, 0);\r\n                \r\n                const smallSize = 100 + Math.random() * 150;\r\n                smallFlare.scale.set(smallSize, smallSize, 1.0);\r\n                \r\n                this.sunGroup.add(smallFlare);\r\n                this.lensFlares.push(smallFlare);\r\n            }\r\n        }\r\n    }\r\n\r\n    clearFlares() {\r\n        this.lensFlares.forEach(flare => {\r\n            if (flare.parent) flare.parent.remove(flare);\r\n        });\r\n        this.lensFlares = [];\r\n    }\r\n\r\n    updateFlareColors(color) {\r\n        this.lensFlares.forEach((flare, index) => {\r\n            if (flare && flare.material) {\r\n                const flareColor = new THREE.Color(color);\r\n                if (index % 3 === 0) {\r\n                    flareColor.r = Math.min(1.0, flareColor.r * 1.2);\r\n                } else if (index % 3 === 1) {\r\n                    flareColor.g = Math.min(1.0, flareColor.g * 1.1);\r\n                }\r\n                flare.material.color = flareColor;\r\n            }\r\n        });\r\n    }\r\n\r\n    update(time, camera) {\r\n        if (!camera) return;\r\n\r\n        const viewVector = new THREE.Vector3().subVectors(\r\n            camera.position,\r\n            this.sunGroup.position\r\n        ).normalize();\r\n\r\n        this.lensFlares.forEach((flare, index) => {\r\n            if (!flare) return;\r\n            \r\n            const pulseSpeed = 0.5 + (index % 3) * 0.3;\r\n            const pulseFactor = 0.9 + Math.sin(time * pulseSpeed + index) * 0.1;\r\n            \r\n            if (index === 0) {\r\n                const mainScale = 700 * pulseFactor;\r\n                flare.scale.set(mainScale, mainScale, 1.0);\r\n            } else {\r\n                const originalSize = 200 + (index % 3) * 100;\r\n                const size = originalSize * pulseFactor;\r\n                flare.scale.set(size, size, 1.0);\r\n                \r\n                if (flare.userData.originalPos) {\r\n                    const orbit = 0.1 + (index % 5) * 0.05;\r\n                    const orbitSpeed = 0.3 + (index % 4) * 0.1;\r\n                    flare.position.x = flare.userData.originalPos.x + Math.sin(time * orbitSpeed) * orbit * originalSize;\r\n                    flare.position.y = flare.userData.originalPos.y + Math.cos(time * orbitSpeed) * orbit * originalSize;\r\n                } else {\r\n                    flare.userData.originalPos = flare.position.clone();\r\n                }\r\n            }\r\n            \r\n            const angleToCam = viewVector.dot(new THREE.Vector3(0, 0, -1).applyQuaternion(camera.quaternion));\r\n            \r\n            if (angleToCam > 0.5) {\r\n                const opacity = Math.min(1.0, (angleToCam - 0.5) / 0.3 + 0.3);\r\n                flare.material.opacity = opacity;\r\n                flare.visible = true;\r\n            } else {\r\n                const reducedOpacity = Math.max(0.1, (angleToCam + 0.5) / 1.0) * 0.5;\r\n                flare.material.opacity = reducedOpacity;\r\n                flare.visible = true;\r\n            }\r\n        });\r\n    }\r\n}","// sunLighting.js - Sun lighting system and visual effects\r\n\r\nimport * as THREE from 'three';\r\n\r\nexport class SunLighting {\r\n    constructor(scene, sunGroup, lightingManager) {\r\n        this.scene = scene;\r\n        this.sunGroup = sunGroup;\r\n        this.lightingManager = lightingManager; // Reference to main lighting manager\r\n        \r\n        // Light configuration for visual sun glow only\r\n        this.config = {\r\n            // Point light for actual sun illumination\r\n            pointLight: {\r\n                intensity: 3000,  // High intensity for space scene\r\n                distance: 100000,  // Very long range\r\n                decay: 2\r\n            },\r\n            // Flicker parameters for realism\r\n            flicker: {\r\n                intensity: 1.0,\r\n                direction: 0.01,\r\n                minIntensity: 0.95,\r\n                maxIntensity: 1.05,\r\n                speed: 0.015\r\n            }\r\n        };\r\n        \r\n        this.sunFlickerIntensity = this.config.flicker.intensity;\r\n        this.sunFlickerDirection = this.config.flicker.direction;\r\n        this.createLights();\r\n    }\r\n\r\n    createLights() {\r\n        // Add point light for close-range glow effect only\r\n        // This creates the visual glow around the sun mesh\r\n        this.sunPointLight = new THREE.PointLight(\r\n            0xFFFAF0,\r\n            this.config.pointLight.intensity,\r\n            this.config.pointLight.distance,\r\n            this.config.pointLight.decay\r\n        );\r\n        this.sunGroup.add(this.sunPointLight);\r\n        \r\n        // We no longer create our own directional light\r\n        // The main LightingManager handles all scene lighting\r\n        // This prevents conflicting light sources\r\n    }\r\n\r\n    updateForStarType(starType, color, temperature, lightIntensityMultiplier = 1.0) {\r\n        // Update point light color for glow\r\n        if (this.sunPointLight) {\r\n            this.sunPointLight.color.setHex(color);\r\n            \r\n            // Subtle intensity variation based on star type\r\n            const baseIntensity = this.config.pointLight.intensity;\r\n            const tempFactor = temperature / 30000; // Normalized temperature factor\r\n            this.sunPointLight.intensity = baseIntensity * (0.8 + tempFactor * 0.4) * lightIntensityMultiplier;\r\n            this.sunPointLight._intensityMultiplier = lightIntensityMultiplier;\r\n        }\r\n        \r\n        // Update main scene lighting color through lighting manager\r\n        if (this.lightingManager && this.lightingManager.sunLight) {\r\n            // Blend the star color with warm white for realistic sun lighting\r\n            const blendedColor = new THREE.Color(color);\r\n            const warmWhite = new THREE.Color(0xFFF5F0);\r\n            blendedColor.lerp(warmWhite, 0.5); // 50% blend for natural look\r\n            \r\n            this.lightingManager.sunLight.color.copy(blendedColor);\r\n        }\r\n    }\r\n\r\n    update(deltaTime, camera, sunType) {\r\n        // Update subtle flickering effect for realism\r\n        this.sunFlickerIntensity += this.sunFlickerDirection * this.config.flicker.speed;\r\n        \r\n        if (this.sunFlickerIntensity > this.config.flicker.maxIntensity) {\r\n            this.sunFlickerIntensity = this.config.flicker.maxIntensity;\r\n            this.sunFlickerDirection = -Math.random() * this.config.flicker.speed;\r\n        } else if (this.sunFlickerIntensity < this.config.flicker.minIntensity) {\r\n            this.sunFlickerIntensity = this.config.flicker.minIntensity;\r\n            this.sunFlickerDirection = Math.random() * this.config.flicker.speed;\r\n        }\r\n        \r\n        // Apply flickering to point light (glow effect)\r\n        if (this.sunPointLight) {\r\n            const intensityMultiplier = this.sunPointLight._intensityMultiplier || 1.0;\r\n            const baseIntensity = this.config.pointLight.intensity;\r\n            \r\n            // Subtle variation based on star type\r\n            const typeBonus = sunType === 'G' ? 1.1 : \r\n                             (sunType === 'O' || sunType === 'B') ? 1.3 : \r\n                             (sunType === 'M') ? 0.9 : 1.0;\r\n            \r\n            this.sunPointLight.intensity = baseIntensity * this.sunFlickerIntensity * intensityMultiplier * typeBonus;\r\n        }\r\n        \r\n        // Update main scene sun light position through lighting manager\r\n        if (this.lightingManager) {\r\n            this.lightingManager.updateSunPosition(this.sunGroup.position);\r\n            \r\n            // Apply subtle flicker to main sun light\r\n            if (this.lightingManager.sunLight) {\r\n                const baseIntensity = this.lightingManager.config.sun.intensity;\r\n                this.lightingManager.sunLight.intensity = baseIntensity * this.sunFlickerIntensity;\r\n            }\r\n            \r\n            // Update exposure based on camera distance\r\n            if (camera) {\r\n                this.lightingManager.updateExposure(camera.position);\r\n            }\r\n        }\r\n    }\r\n\r\n    toggleShadowHelper(enabled) {\r\n        // Shadow helper is now managed by the main LightingManager\r\n        // This method is kept for backward compatibility\r\n        if (enabled && this.lightingManager && this.lightingManager.sunLight) {\r\n            console.log(\"Shadow debugging should be enabled through the main LightingManager\");\r\n        }\r\n    }\r\n    \r\n    dispose() {\r\n        if (this.sunPointLight) {\r\n            this.sunGroup.remove(this.sunPointLight);\r\n            this.sunPointLight.dispose();\r\n        }\r\n    }\r\n}","// sun.js - Creates and manages the sun object (central star) with volumetric rendering\r\n\r\nimport * as THREE from 'three';\r\nimport { SunShaders } from './sun/sunShaders.js';\r\nimport { SunFlares } from './sun/sunFlares.js';\r\nimport { SunLighting } from './sun/sunLighting.js';\r\n\r\nexport class Sun {\r\n    constructor(scene) {\r\n        this.scene = scene;\r\n        this.sun = null;\r\n        this.time = 0;\r\n        this.sunType = 'G'; // Default sun type (G-type like our Sun)\r\n        this.createSun();\r\n    }\r\n    \r\n    createSun() {\r\n        // Create a group to hold all sun-related elements\r\n        this.sun = new THREE.Group();\r\n        this.sun.name = 'sun';\r\n        this.scene.add(this.sun);\r\n        \r\n        // Create the core sun sphere with shader material\r\n        const sunGeometry = new THREE.SphereGeometry(1000, 64, 64);\r\n        this.sunMaterial = SunShaders.createSunMaterial();\r\n        const sunCoreMesh = new THREE.Mesh(sunGeometry, this.sunMaterial);\r\n        this.sun.add(sunCoreMesh);\r\n        \r\n        // Add corona layers\r\n        const coronaGeometry = new THREE.SphereGeometry(2000, 64, 64);\r\n        this.coronaMaterial = SunShaders.createCoronaMaterial();\r\n        const coronaMesh = new THREE.Mesh(coronaGeometry, this.coronaMaterial);\r\n        this.sun.add(coronaMesh);\r\n        \r\n        const outerCoronaGeometry = new THREE.SphereGeometry(3000, 32, 32);\r\n        this.outerCoronaMaterial = SunShaders.createOuterCoronaMaterial();\r\n        const outerCoronaMesh = new THREE.Mesh(outerCoronaGeometry, this.outerCoronaMaterial);\r\n        this.sun.add(outerCoronaMesh);\r\n        \r\n        // Initialize subsystems\r\n        // Get lighting manager from scene if available\r\n        const lightingManager = this.scene.lightingManager || null;\r\n        this.lighting = new SunLighting(this.scene, this.sun, lightingManager);\r\n        this.flares = new SunFlares(this.scene, this.sun);\r\n    }\r\n    \r\n    // Update sun based on star type (O, B, A, F, G, K, M)\r\n    updateSunType(type, lightIntensityMultiplier = 1.0) {\r\n        this.sunType = type || 'G';\r\n        let color, temperature, activity;\r\n        \r\n        // Set sun properties based on star classification\r\n        switch(this.sunType) {\r\n            case 'O': color = 0x9db4ff; temperature = 30000; activity = 0.8; break;\r\n            case 'B': color = 0xaabfff; temperature = 20000; activity = 0.75; break;\r\n            case 'A': color = 0xcad7ff; temperature = 10000; activity = 0.7; break;\r\n            case 'F': color = 0xf8f7ff; temperature = 7000; activity = 0.65; break;\r\n            case 'G': color = 0xfff4ea; temperature = 5500; activity = 0.6; break;\r\n            case 'K': color = 0xffd2a1; temperature = 4000; activity = 0.5; break;\r\n            case 'M': color = 0xffcc6f; temperature = 3000; activity = 0.4; break;\r\n            default: color = 0xfff4ea; temperature = 5500; activity = 0.6;\r\n        }\r\n        \r\n        // Update material colors and parameters\r\n        if (this.sunMaterial) {\r\n            this.sunMaterial.uniforms.sunColor.value.setHex(color);\r\n            this.sunMaterial.uniforms.sunActivity.value = activity;\r\n        }\r\n        \r\n        if (this.coronaMaterial) {\r\n            const coronaColor = new THREE.Color(color);\r\n            coronaColor.r = Math.min(1.0, coronaColor.r * 1.2);\r\n            coronaColor.g = Math.min(1.0, coronaColor.g * 1.1);\r\n            this.coronaMaterial.uniforms.coronaColor.value = coronaColor;\r\n        }\r\n        \r\n        if (this.outerCoronaMaterial) {\r\n            const outerCoronaColor = new THREE.Color(color);\r\n            outerCoronaColor.r = Math.min(1.0, outerCoronaColor.r * 1.3);\r\n            outerCoronaColor.g = Math.min(1.0, outerCoronaColor.g * 1.2);\r\n            outerCoronaColor.b = Math.min(1.0, outerCoronaColor.b * 1.1);\r\n            this.outerCoronaMaterial.uniforms.coronaColor.value = outerCoronaColor;\r\n        }\r\n        \r\n        // Update lighting and flares\r\n        this.lighting.updateForStarType(this.sunType, color, temperature, lightIntensityMultiplier);\r\n        this.flares.updateFlareColors(color);\r\n        \r\n        console.log(`Updated sun to type ${this.sunType}, color: ${color.toString(16)}, intensity multiplier: ${lightIntensityMultiplier}`);\r\n    }\r\n    \r\n    getRadius() {\r\n        return 3000;\r\n    }\r\n    \r\n    getPosition() {\r\n        return new THREE.Vector3(0, 0, 0);\r\n    }\r\n    \r\n    update(deltaTime = 0.016) {\r\n        if (!this.sun) return;\r\n        \r\n        // Update time for all shaders\r\n        this.time += deltaTime * 0.4;\r\n        \r\n        if (this.sunMaterial && this.sunMaterial.uniforms.time) {\r\n            this.sunMaterial.uniforms.time.value = this.time;\r\n        }\r\n        \r\n        if (this.coronaMaterial && this.coronaMaterial.uniforms.time) {\r\n            this.coronaMaterial.uniforms.time.value = this.time;\r\n        }\r\n        \r\n        if (this.outerCoronaMaterial && this.outerCoronaMaterial.uniforms.time) {\r\n            this.outerCoronaMaterial.uniforms.time.value = this.time;\r\n        }\r\n        \r\n        // Update camera-relative uniforms\r\n        if (this.scene && this.scene.camera) {\r\n            const viewVector = new THREE.Vector3().subVectors(\r\n                this.scene.camera.position,\r\n                this.sun.position\r\n            ).normalize();\r\n            \r\n            if (this.coronaMaterial && this.coronaMaterial.uniforms.viewVector) {\r\n                this.coronaMaterial.uniforms.viewVector.value = viewVector;\r\n            }\r\n            \r\n            if (this.outerCoronaMaterial && this.outerCoronaMaterial.uniforms.viewVector) {\r\n                this.outerCoronaMaterial.uniforms.viewVector.value = viewVector;\r\n            }\r\n        }\r\n        \r\n        // Update subsystems\r\n        this.lighting.update(deltaTime, this.scene.camera, this.sunType);\r\n        this.flares.update(this.time, this.scene.camera);\r\n    }\r\n    \r\n    // Toggle shadow camera helper for debugging\r\n    toggleShadowHelper(enabled) {\r\n        this.lighting.toggleShadowHelper(enabled);\r\n    }\r\n}","// planetGenerator.js - Procedural planet generation logic\r\n\r\nexport class PlanetGenerator {\r\n    static generatePlanetsForSystem(systemId, starSystemGenerator) {\r\n        console.log(`Generating new planets for system: ${systemId}`);\r\n        \r\n        // Check if this is a custom system with predefined planets\r\n        if (starSystemGenerator && starSystemGenerator.customPlanetData && starSystemGenerator.customPlanetData[systemId]) {\r\n            const customPlanets = starSystemGenerator.customPlanetData[systemId];\r\n            console.log(`Using ${customPlanets.length} custom planets for system: ${systemId}`);\r\n            \r\n            customPlanets.forEach(planet => {\r\n                if (planet.textureUrl) {\r\n                    console.log(`Custom planet ${planet.name} has texture URL: ${planet.textureUrl}`);\r\n                } else {\r\n                    console.log(`Custom planet ${planet.name} does not have a texture URL`);\r\n                }\r\n            });\r\n            \r\n            return starSystemGenerator.customPlanetData[systemId];\r\n        }\r\n        \r\n        // Planet name word banks for procedural generation\r\n        const prefixes = [\r\n            'New', 'Alpha', 'Beta', 'Gamma', 'Delta', 'Nova', 'Proxima', 'Ultima',\r\n            'Astro', 'Cosmo', 'Stella', 'Terra', 'Astra', 'Prime', 'Orb'\r\n        ];\r\n        \r\n        const suffixes = [\r\n            'sphere', 'world', 'orb', 'terra', 'oid', 'globus', 'ium', 'ian',\r\n            'aria', 'anth', 'urus', 'alos', 'onos', 'era', 'ax', 'is', 'os'\r\n        ];\r\n        \r\n        const starClass = systemId.includes('System-') ? systemId.split('-')[1][0] : 'M';\r\n        const planetCount = 2 + Math.floor(Math.random() * 7); // 2-8 planets\r\n        const planetData = [];\r\n        \r\n        // Determine system characteristics based on star class\r\n        let sizeMultiplier = 1.0;\r\n        let distanceMultiplier = 1.0;\r\n        let colorPalette = [];\r\n        \r\n        switch (starClass) {\r\n            case 'O':\r\n                sizeMultiplier = 1.8;\r\n                distanceMultiplier = 1.6;\r\n                colorPalette = [0x6666ff, 0x9999ff, 0xccccff, 0xaaaaff, 0x8888dd];\r\n                break;\r\n            case 'B':\r\n                sizeMultiplier = 1.5;\r\n                distanceMultiplier = 1.3;\r\n                colorPalette = [0x99aaff, 0xaabbff, 0xccccff, 0xddddff, 0xbbaacc];\r\n                break;\r\n            case 'A':\r\n                sizeMultiplier = 1.3;\r\n                distanceMultiplier = 1.1;\r\n                colorPalette = [0xccccff, 0xddddff, 0xeeeeff, 0xffffff, 0xddccdd];\r\n                break;\r\n            case 'F':\r\n                sizeMultiplier = 1.1;\r\n                distanceMultiplier = 1.0;\r\n                colorPalette = [0x99aaff, 0xaaccaa, 0xccddcc, 0xffccaa, 0xeeeecc];\r\n                break;\r\n            case 'G':\r\n                sizeMultiplier = 1.0;\r\n                distanceMultiplier = 1.0;\r\n                colorPalette = [0xaaaaaa, 0x4169e1, 0xc65d45, 0xd6b27e, 0xf0e5c9];\r\n                break;\r\n            case 'K':\r\n                sizeMultiplier = 0.8;\r\n                distanceMultiplier = 0.9;\r\n                colorPalette = [0xe6cc9c, 0xccaa88, 0xddbb99, 0xbb9977, 0xcc8866];\r\n                break;\r\n            case 'M':\r\n                sizeMultiplier = 0.6;\r\n                distanceMultiplier = 0.7;\r\n                colorPalette = [0xcc6644, 0xdd7755, 0xee8866, 0xff9977, 0xbb5533];\r\n                break;\r\n            default:\r\n                colorPalette = [0xaaaaaa, 0x4169e1, 0xc65d45, 0xd6b27e, 0xf0e5c9];\r\n        }\r\n        \r\n        // Generate each planet\r\n        for (let i = 0; i < planetCount; i++) {\r\n            const prefix = prefixes[Math.floor(Math.random() * prefixes.length)];\r\n            const suffix = suffixes[Math.floor(Math.random() * suffixes.length)];\r\n            const name = `${prefix}${suffix}`;\r\n            \r\n            const sizeClass = Math.random();\r\n            let size;\r\n            if (sizeClass < 0.5) {\r\n                size = (240 + Math.random() * 200) * sizeMultiplier;\r\n            } else if (sizeClass < 0.8) {\r\n                size = (440 + Math.random() * 280) * sizeMultiplier;\r\n            } else {\r\n                size = (720 + Math.random() * 360) * sizeMultiplier;\r\n            }\r\n            \r\n            const baseDistance = 4800 + (i * 8000);\r\n            const distanceVariation = baseDistance * 0.2;\r\n            const distance = (baseDistance + (Math.random() * distanceVariation - distanceVariation/2)) * distanceMultiplier;\r\n            \r\n            const speed = 0.002 / (distance / 1000);\r\n            const color = colorPalette[Math.floor(Math.random() * colorPalette.length)];\r\n            const rings = size > 600 ? Math.random() < 0.4 : false;\r\n            const axialTilt = Math.random() * Math.PI * 0.5;\r\n            const orbitalTilt = Math.random() * Math.PI * 0.2;\r\n            \r\n            planetData.push({\r\n                name,\r\n                size: Math.floor(size),\r\n                distance: Math.floor(distance),\r\n                speed,\r\n                color,\r\n                rings,\r\n                axialTilt,\r\n                orbitalTilt\r\n            });\r\n        }\r\n        \r\n        return planetData;\r\n    }\r\n\r\n    static createHomeSolarSystemPlanets() {\r\n        return [\r\n            { name: \"Mercury\", size: 220, distance: 4800, speed: 0.0016, color: 0xaaaaaa, rings: false },\r\n            { name: \"Venus\", size: 400, distance: 8000, speed: 0.0013, color: 0xe6cc9c, rings: false },\r\n            { name: \"Earth\", size: 420, distance: 12000, speed: 0.0010, color: 0x4169e1, rings: false },\r\n            { name: \"Mars\", size: 320, distance: 16800, speed: 0.0008, color: 0xc65d45, rings: false },\r\n            { name: \"Jupiter\", size: 1000, distance: 30000, speed: 0.0004, color: 0xd6b27e, rings: true },\r\n            { name: \"Saturn\", size: 880, distance: 40000, speed: 0.0003, color: 0xf0e5c9, rings: true },\r\n            { name: \"Uranus\", size: 720, distance: 56000, speed: 0.0002, color: 0xcaecf1, rings: true },\r\n            { name: \"Neptune\", size: 700, distance: 72000, speed: 0.00016, color: 0x5fa3db, rings: false },\r\n        ];\r\n    }\r\n}","// planetTextures.js - Planet texture loading and management\r\n\r\nimport * as THREE from 'three';\r\n\r\nconst textureLoader = new THREE.TextureLoader();\r\n\r\n// Load all planet textures\r\nexport const planetTextures = {\r\n    mercury: textureLoader.load('./assets/2k_mercury.jpg'),\r\n    venus: {\r\n        surface: textureLoader.load('./assets/2k_venus_surface.jpg'),\r\n        atmosphere: textureLoader.load('./assets/2k_venus_atmosphere.jpg')\r\n    },\r\n    earth: textureLoader.load('./assets/2k_earth_daymap.jpg'),\r\n    mars: textureLoader.load('./assets/2k_mars.jpg'),\r\n    jupiter: textureLoader.load('./assets/2k_jupiter.jpg'),\r\n    saturn: {\r\n        surface: textureLoader.load('./assets/2k_saturn.jpg'),\r\n        rings: textureLoader.load('./assets/2k_saturn_ring_alpha.png')\r\n    },\r\n    uranus: textureLoader.load('./assets/2k_uranus.jpg'),\r\n    neptune: textureLoader.load('./assets/2k_neptune.jpg')\r\n};\r\n\r\n// Set the correct color space for all planet textures\r\nplanetTextures.mercury.colorSpace = THREE.SRGBColorSpace;\r\nplanetTextures.venus.surface.colorSpace = THREE.SRGBColorSpace;\r\nplanetTextures.venus.atmosphere.colorSpace = THREE.SRGBColorSpace;\r\nplanetTextures.earth.colorSpace = THREE.SRGBColorSpace;\r\nplanetTextures.mars.colorSpace = THREE.SRGBColorSpace;\r\nplanetTextures.jupiter.colorSpace = THREE.SRGBColorSpace;\r\nplanetTextures.saturn.surface.colorSpace = THREE.SRGBColorSpace;\r\nplanetTextures.saturn.rings.colorSpace = THREE.SRGBColorSpace;\r\nplanetTextures.uranus.colorSpace = THREE.SRGBColorSpace;\r\nplanetTextures.neptune.colorSpace = THREE.SRGBColorSpace;\r\n\r\n// Load the custom procedural textures (p1-p22)\r\nexport const proceduralTextures = [];\r\nfor (let i = 1; i <= 22; i++) {\r\n    const texture = textureLoader.load(`./assets/p${i}.jpeg`);\r\n    texture.colorSpace = THREE.SRGBColorSpace;\r\n    proceduralTextures.push(texture);\r\n}","// planetMaterials.js - Planet material creation and management\r\n\r\nimport * as THREE from 'three';\r\nimport { planetTextures, proceduralTextures } from './planetTextures.js';\r\n\r\nconst textureLoader = new THREE.TextureLoader();\r\n\r\nexport class PlanetMaterials {\r\n    static createMaterialForPlanet(planet) {\r\n        // Check if this is a custom planet with its own texture\r\n        if (planet.textureUrl) {\r\n            console.log(`Creating planet ${planet.name} with custom texture: ${planet.textureUrl}`);\r\n            \r\n            // Fix texture path for API server images\r\n            let adjustedTextureUrl = planet.textureUrl;\r\n            \r\n            if (planet.textureUrl.startsWith('/images/')) {\r\n                if (window.location.port === '8000') {\r\n                    const serverHost = window.location.hostname;\r\n                    adjustedTextureUrl = `http://${serverHost}:8001${planet.textureUrl}`;\r\n                    console.log(`Adjusted planet texture path to API server: ${adjustedTextureUrl}`);\r\n                }\r\n            }\r\n            \r\n            const customTexture = textureLoader.load(adjustedTextureUrl);\r\n            customTexture.colorSpace = THREE.SRGBColorSpace;\r\n            \r\n            return new THREE.MeshStandardMaterial({\r\n                map: customTexture,\r\n                roughness: 0.5,\r\n                metalness: 0.0,\r\n                flatShading: false,\r\n                emissive: new THREE.Color(planet.color || 0x222222),\r\n                emissiveIntensity: 0.3\r\n            });\r\n        }\r\n\r\n        // Use standard planet textures based on planet name\r\n        switch(planet.name) {\r\n            case \"Mercury\":\r\n                return new THREE.MeshStandardMaterial({\r\n                    map: planetTextures.mercury,\r\n                    roughness: 0.95,\r\n                    metalness: 0.0,\r\n                    flatShading: false,\r\n                    emissive: new THREE.Color(0x2a2a2a),\r\n                    emissiveIntensity: 0.15\r\n                });\r\n                \r\n            case \"Venus\":\r\n                return new THREE.MeshStandardMaterial({\r\n                    map: planetTextures.venus.surface,\r\n                    roughness: 0.85,\r\n                    metalness: 0.0,\r\n                    flatShading: false,\r\n                    emissive: new THREE.Color(0x443322),\r\n                    emissiveIntensity: 0.2\r\n                });\r\n                \r\n            case \"Earth\":\r\n                return new THREE.MeshStandardMaterial({\r\n                    map: planetTextures.earth,\r\n                    roughness: 0.75,\r\n                    metalness: 0.0,\r\n                    flatShading: false,\r\n                    emissive: new THREE.Color(0x112233),\r\n                    emissiveIntensity: 0.18\r\n                });\r\n                \r\n            case \"Mars\":\r\n                return new THREE.MeshStandardMaterial({\r\n                    map: planetTextures.mars,\r\n                    roughness: 0.9,\r\n                    metalness: 0.0,\r\n                    flatShading: false,\r\n                    emissive: new THREE.Color(0x442211),\r\n                    emissiveIntensity: 0.18\r\n                });\r\n                \r\n            case \"Jupiter\":\r\n                return new THREE.MeshStandardMaterial({\r\n                    map: planetTextures.jupiter,\r\n                    roughness: 0.8,\r\n                    metalness: 0.0,\r\n                    flatShading: false,\r\n                    emissive: new THREE.Color(0x332211),\r\n                    emissiveIntensity: 0.15\r\n                });\r\n                \r\n            case \"Saturn\":\r\n                return new THREE.MeshStandardMaterial({\r\n                    map: planetTextures.saturn.surface,\r\n                    roughness: 0.85,\r\n                    metalness: 0.0,\r\n                    flatShading: false,\r\n                    emissive: new THREE.Color(0x332211),\r\n                    emissiveIntensity: 0.15\r\n                });\r\n                \r\n            case \"Uranus\":\r\n                return new THREE.MeshStandardMaterial({\r\n                    map: planetTextures.uranus,\r\n                    roughness: 0.85,\r\n                    metalness: 0.0,\r\n                    flatShading: false,\r\n                    emissive: new THREE.Color(0x112233),\r\n                    emissiveIntensity: 0.14\r\n                });\r\n                \r\n            case \"Neptune\":\r\n                return new THREE.MeshStandardMaterial({\r\n                    map: planetTextures.neptune,\r\n                    roughness: 0.85,\r\n                    metalness: 0.0,\r\n                    flatShading: false,\r\n                    emissive: new THREE.Color(0x112244),\r\n                    emissiveIntensity: 0.14\r\n                });\r\n                \r\n            default:\r\n                // For other planets, use a procedural texture from the collection\r\n                const textureIndex = Math.floor(Math.random() * proceduralTextures.length);\r\n                return new THREE.MeshStandardMaterial({\r\n                    map: proceduralTextures[textureIndex],\r\n                    roughness: 0.85,\r\n                    metalness: 0.0,\r\n                    color: new THREE.Color(planet.color),\r\n                    flatShading: false,\r\n                    emissive: new THREE.Color(0x222222),\r\n                    emissiveIntensity: 0.15\r\n                });\r\n        }\r\n    }\r\n\r\n    static createRingMaterial(planet) {\r\n        if (planet.name === \"Saturn\") {\r\n            return new THREE.MeshStandardMaterial({\r\n                map: planetTextures.saturn.rings,\r\n                side: THREE.DoubleSide,\r\n                transparent: true,\r\n                opacity: 0.8,\r\n                roughness: 0.8,\r\n                metalness: 0.1,\r\n                emissive: new THREE.Color(0xf0e5c9),\r\n                emissiveIntensity: 0.2,\r\n                emissiveMap: planetTextures.saturn.rings\r\n            });\r\n        } else {\r\n            return new THREE.MeshStandardMaterial({\r\n                color: planet.color,\r\n                side: THREE.DoubleSide,\r\n                transparent: true,\r\n                opacity: 0.4,\r\n                roughness: 0.7,\r\n                metalness: 0.2,\r\n                emissive: new THREE.Color(planet.color),\r\n                emissiveIntensity: 0.3\r\n            });\r\n        }\r\n    }\r\n}","// planetFactory.js - Planet mesh creation and ring generation\r\n\r\nimport * as THREE from 'three';\r\nimport { PlanetMaterials } from './planetMaterials.js';\r\n\r\nexport class PlanetFactory {\r\n    static createPlanetMesh(planet) {\r\n        const planetGeometry = new THREE.SphereGeometry(planet.size, 32, 32);\r\n        const planetMaterial = PlanetMaterials.createMaterialForPlanet(planet);\r\n        const planetMesh = new THREE.Mesh(planetGeometry, planetMaterial);\r\n        \r\n        // Position the planet at its orbital distance\r\n        const angle = Math.random() * Math.PI * 2;\r\n        const orbitalTilt = planet.orbitalTilt || 0;\r\n        const axialTilt = planet.axialTilt || 0;\r\n        \r\n        // Position planet with orbital tilt\r\n        planetMesh.position.x = Math.cos(angle) * planet.distance;\r\n        planetMesh.position.y = Math.sin(orbitalTilt) * planet.distance;\r\n        planetMesh.position.z = Math.sin(angle) * Math.cos(orbitalTilt) * planet.distance;\r\n        \r\n        // Apply axial tilt to planet rotation\r\n        planetMesh.rotation.x = axialTilt;\r\n        \r\n        // Enable shadows for eclipse effects\r\n        planetMesh.castShadow = true;\r\n        planetMesh.receiveShadow = true;\r\n        \r\n        // Create planet rings if specified\r\n        if (planet.rings) {\r\n            const ringMesh = PlanetFactory.createRingMesh(planet);\r\n            planetMesh.add(ringMesh);\r\n        }\r\n        \r\n        return {\r\n            mesh: planetMesh,\r\n            distance: planet.distance,\r\n            speed: planet.speed,\r\n            angle: angle,\r\n            orbitalTilt: orbitalTilt\r\n        };\r\n    }\r\n\r\n    static createRingMesh(planet) {\r\n        let ringGeometry, ringMaterial;\r\n        \r\n        if (planet.name === \"Saturn\") {\r\n            ringGeometry = new THREE.RingGeometry(planet.size * 1.4, planet.size * 2.0, 32);\r\n        } else {\r\n            ringGeometry = new THREE.RingGeometry(planet.size * 1.3, planet.size * 1.8, 32);\r\n        }\r\n        \r\n        ringMaterial = PlanetMaterials.createRingMaterial(planet);\r\n        const ringMesh = new THREE.Mesh(ringGeometry, ringMaterial);\r\n        \r\n        // Rotate rings to be flat (perpendicular to y-axis)\r\n        ringMesh.rotation.x = Math.PI / 2;\r\n        \r\n        // Enable shadows for rings\r\n        ringMesh.castShadow = true;\r\n        ringMesh.receiveShadow = true;\r\n        \r\n        return ringMesh;\r\n    }\r\n}","// planets.js - Creates and manages the planets in the solar system\r\n\r\nimport * as THREE from 'three';\r\nimport { PlanetGenerator } from './planets/planetGenerator.js';\r\nimport { PlanetFactory } from './planets/planetFactory.js';\r\n\r\nexport class Planets {\r\n    constructor(scene, starSystemGenerator) {\r\n        this.scene = scene;\r\n        this.starSystemGenerator = starSystemGenerator;\r\n        this.planets = [];\r\n        this.planetRegions = {};\r\n        this.currentSystemId = 'Solar System'; // Default to our Solar System\r\n        this.systemPlanets = {};\r\n        \r\n        // Initialize our solar system planets\r\n        this.createHomeSolarSystem();\r\n    }\r\n    \r\n    // Create our home solar system (the only non-procedural system)\r\n    createHomeSolarSystem() {\r\n        const solarSystemPlanets = PlanetGenerator.createHomeSolarSystemPlanets();\r\n        this.systemPlanets['Solar System'] = solarSystemPlanets;\r\n        this.createPlanetsForSystem('Solar System');\r\n    }\r\n    \r\n    // Create planet objects for the current system\r\n    createPlanetsForSystem(systemId) {\r\n        // Clear existing planets\r\n        this.clearPlanets();\r\n        \r\n        // Update current system\r\n        this.currentSystemId = systemId;\r\n        \r\n        // If we already have planet data for this system, use it\r\n        if (this.systemPlanets[systemId]) {\r\n            this.createPlanetsFromData(this.systemPlanets[systemId]);\r\n            return;\r\n        }\r\n        \r\n        // Otherwise, we need to generate planets for this system\r\n        const generatedPlanets = this.generatePlanetsForSystem(systemId);\r\n        this.systemPlanets[systemId] = generatedPlanets;\r\n        this.createPlanetsFromData(generatedPlanets);\r\n    }\r\n    \r\n    // Generate procedural planets for a new star system\r\n    generatePlanetsForSystem(systemId) {\r\n        return PlanetGenerator.generatePlanetsForSystem(systemId, this.starSystemGenerator);\r\n    }\r\n    \r\n    // Create planet objects from data array\r\n    createPlanetsFromData(planetData) {\r\n        this.clearPlanets();\r\n        \r\n        planetData.forEach(planet => {\r\n            const planetObj = PlanetFactory.createPlanetMesh(planet);\r\n            \r\n            // Add the planet to the scene\r\n            this.scene.add(planetObj.mesh);\r\n            \r\n            // Store planet data for orbiting\r\n            this.planets.push(planetObj);\r\n            \r\n            // Store planet regions for game mechanics\r\n            this.planetRegions[planet.name] = {\r\n                name: planet.name,\r\n                position: planetObj.mesh.position.clone(),\r\n                radius: planet.size * 2\r\n            };\r\n        });\r\n    }\r\n    \r\n    // Clear all existing planets\r\n    clearPlanets() {\r\n        // Remove planets from scene and clear arrays\r\n        this.planets.forEach(planet => {\r\n            this.scene.remove(planet.mesh);\r\n        });\r\n        \r\n        this.planets = [];\r\n        this.planetRegions = {};\r\n    }\r\n    \r\n    // Set up planet system for specified star system\r\n    updateForSystem(systemId) {\r\n        console.log(`Updating planets for system: ${systemId}`);\r\n        \r\n        // Generate and create planets for this system if we haven't already\r\n        this.createPlanetsForSystem(systemId);\r\n        \r\n        // Return true to indicate success\r\n        return true;\r\n    }\r\n    \r\n    getPlanetRegions() {\r\n        return this.planetRegions;\r\n    }\r\n    \r\n    getPlanets() {\r\n        return this.planets;\r\n    }\r\n    \r\n    update(deltaTime) {\r\n        this.planets.forEach(planet => {\r\n            planet.angle += planet.speed * deltaTime;\r\n            \r\n            planet.mesh.position.x = Math.cos(planet.angle) * planet.distance;\r\n            planet.mesh.position.z = Math.sin(planet.angle) * Math.cos(planet.orbitalTilt) * planet.distance;\r\n            planet.mesh.position.y = Math.sin(planet.angle) * Math.sin(planet.orbitalTilt) * planet.distance;\r\n            \r\n            planet.mesh.rotation.y += deltaTime * 0.1;\r\n            \r\n            // Update planet regions for location tracking\r\n            if (planet.mesh) {\r\n                Object.values(this.planetRegions).forEach(region => {\r\n                    if (region && region.position) {\r\n                        const distance = region.position.distanceTo(planet.mesh.position);\r\n                        if (distance < 5000) {\r\n                            region.position.copy(planet.mesh.position);\r\n                        }\r\n                    }\r\n                });\r\n            }\r\n        });\r\n    }\r\n}","// stargate.js - Creates and manages the stargate\r\n\r\nimport * as THREE from 'three';\r\n\r\nexport class Stargate {\r\n    constructor(scene) {\r\n        this.scene = scene;\r\n        this.stargate = null;\r\n        this.navLights = [];\r\n        this.portalParticles = [];\r\n        this.createStargate();\r\n    }\r\n    \r\n    createStargate() {\r\n        // Create a stargate group\r\n        const stargateGroup = new THREE.Group();\r\n        stargateGroup.name = 'stargate';\r\n        \r\n        // Main ring - matte black\r\n        const ringGeometry = new THREE.TorusGeometry(1000, 200, 32, 100);\r\n        const ringMaterial = new THREE.MeshStandardMaterial({\r\n          color: 0x111111,\r\n          roughness: 0.9,\r\n          metalness: 0.1,\r\n          emissive: 0x000000\r\n        });\r\n        const ring = new THREE.Mesh(ringGeometry, ringMaterial);\r\n        stargateGroup.add(ring);\r\n        \r\n        // Neon turquoise accent rings\r\n        const createAccentRing = (radius, tubeRadius, position = {x: 0, y: 0, z: 0}, rotation = {x: 0, y: 0, z: 0}) => {\r\n          const geometry = new THREE.TorusGeometry(radius, tubeRadius, 16, 100);\r\n          const material = new THREE.MeshStandardMaterial({\r\n            color: 0x00ffff,\r\n            emissive: 0x00ffff,\r\n            emissiveIntensity: 1.5,\r\n            roughness: 0.2,\r\n            metalness: 0.8\r\n          });\r\n          const accentRing = new THREE.Mesh(geometry, material);\r\n          accentRing.position.set(position.x, position.y, position.z);\r\n          accentRing.rotation.set(rotation.x, rotation.y, rotation.z);\r\n          return accentRing;\r\n        };\r\n        \r\n        // Add accent rings on outer edges - make them brighter\r\n        const outerRing1 = createAccentRing(1060, 10);\r\n        const outerRing2 = createAccentRing(940, 10);\r\n        // Add an inner ring to enhance portal effect\r\n        const innerRing = createAccentRing(850, 5);\r\n        stargateGroup.add(outerRing1);\r\n        stargateGroup.add(outerRing2);\r\n        stargateGroup.add(innerRing);\r\n        \r\n        // Create enhanced turquoise portal in the center\r\n        this.createPortalEffect(stargateGroup);\r\n        \r\n        // Add neon accent details\r\n        const detailsGroup = this.createNeonDetails();\r\n        stargateGroup.add(detailsGroup);\r\n        \r\n        // Position the stargate at 2x height from the original position\r\n        stargateGroup.position.set(0, 10000, 0);\r\n        stargateGroup.rotation.x = Math.PI / 2; // Horizontal orientation\r\n        \r\n        // Add to scene\r\n        this.scene.add(stargateGroup);\r\n        this.stargate = stargateGroup;\r\n        \r\n        // Create a counter-rotating inner ring for additional portal effect\r\n        this.createCounterRotatingRing(stargateGroup);\r\n    }\r\n    \r\n    createCounterRotatingRing(parentGroup) {\r\n        // Create a separate rotating group for the inner portal structure\r\n        const innerStructure = new THREE.Group();\r\n        \r\n        // Add a thin ring that rotates opposite to the main stargate\r\n        const thinRingGeometry = new THREE.TorusGeometry(820, 3, 16, 100);\r\n        const thinRingMaterial = new THREE.MeshStandardMaterial({\r\n            color: 0x00ffff,\r\n            emissive: 0x00ffff,\r\n            emissiveIntensity: 2,\r\n            roughness: 0.1,\r\n            metalness: 0.9,\r\n            transparent: true,\r\n            opacity: 0.7\r\n        });\r\n        \r\n        // Create 3 counter-rotating rings\r\n        for (let i = 0; i < 3; i++) {\r\n            const ring = new THREE.Mesh(thinRingGeometry, thinRingMaterial.clone());\r\n            ring.rotation.x = Math.PI * i / 3;\r\n            ring.rotation.y = Math.PI * i / 3;\r\n            innerStructure.add(ring);\r\n        }\r\n        \r\n        parentGroup.add(innerStructure);\r\n        this.counterRotatingRing = innerStructure;\r\n    }\r\n    \r\n    createPortalEffect(parentGroup) {\r\n        // Enhanced custom shader material for the portal\r\n        const portalShaderMaterial = new THREE.ShaderMaterial({\r\n          uniforms: {\r\n            time: { value: 0 },\r\n            resolution: { value: new THREE.Vector2(1024, 1024) },\r\n            baseColor: { value: new THREE.Color(0x00ffff) }\r\n          },\r\n          vertexShader: `\r\n            varying vec2 vUv;\r\n            \r\n            void main() {\r\n              vUv = uv;\r\n              gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\r\n            }\r\n          `,\r\n          fragmentShader: `\r\n            uniform float time;\r\n            uniform vec2 resolution;\r\n            uniform vec3 baseColor;\r\n            varying vec2 vUv;\r\n            \r\n            // Simple noise function\r\n            float noise(vec2 p) {\r\n              return fract(sin(dot(p, vec2(12.9898, 78.233))) * 43758.5453);\r\n            }\r\n            \r\n            // Smoothed noise\r\n            float smoothNoise(vec2 p) {\r\n              vec2 ip = floor(p);\r\n              vec2 fp = fract(p);\r\n              \r\n              vec2 u = fp * fp * (3.0 - 2.0 * fp);\r\n              \r\n              float a = noise(ip);\r\n              float b = noise(ip + vec2(1.0, 0.0));\r\n              float c = noise(ip + vec2(0.0, 1.0));\r\n              float d = noise(ip + vec2(1.0, 1.0));\r\n              \r\n              return mix(mix(a, b, u.x), mix(c, d, u.x), u.y);\r\n            }\r\n            \r\n            // Fractal Brownian Motion\r\n            float fbm(vec2 p) {\r\n              float value = 0.0;\r\n              float amplitude = 0.5;\r\n              float frequency = 3.0;\r\n              \r\n              for (int i = 0; i < 6; i++) {\r\n                value += amplitude * smoothNoise(p * frequency);\r\n                amplitude *= 0.5;\r\n                frequency *= 2.0;\r\n              }\r\n              \r\n              return value;\r\n            }\r\n            \r\n            void main() {\r\n              // Convert uv to be centered at (0.5, 0.5) with range -1 to 1\r\n              vec2 centeredUV = (vUv - 0.5) * 2.0;\r\n              float dist = length(centeredUV);\r\n              \r\n              // Create angle for rotation\r\n              float angle = atan(centeredUV.y, centeredUV.x);\r\n              \r\n              // Enhanced swirling effect parameters - more aggressive\r\n              float swirl = sin(angle * 6.0 + time * 2.0) * 0.5 + 0.5;\r\n              float pulse = sin(time * 0.8) * 0.5 + 0.5;\r\n              \r\n              // Create more distorted coordinates for noise - enhances warp feel\r\n              vec2 distortedUV = vec2(\r\n                centeredUV.x + sin(time * 0.7 + centeredUV.y * 5.0) * 0.2,\r\n                centeredUV.y + cos(time * 0.6 + centeredUV.x * 5.0) * 0.2\r\n              );\r\n              \r\n              // Create noise patterns - more contrast\r\n              float noiseValue = fbm(distortedUV * 3.0 + time * 0.3);\r\n              float ripple = sin(dist * 20.0 - time * 3.0) * 0.5 + 0.5;\r\n              \r\n              // Combine effects with more intensity\r\n              float alpha = smoothstep(0.9, 0.0, dist);\r\n              float intensity = mix(noiseValue, ripple, 0.7) * swirl * pulse;\r\n              \r\n              // Enhanced portal colors - bright cyan to deep blue\r\n              vec3 darkColor = vec3(0.0, 0.1, 0.3);\r\n              vec3 brightColor = vec3(0.0, 1.0, 1.0) * 2.0;\r\n              vec3 accentColor = vec3(0.3, 0.8, 1.0);\r\n              \r\n              // More complex color mixing\r\n              vec3 finalColor = mix(darkColor, brightColor, intensity);\r\n              finalColor = mix(finalColor, accentColor, ripple * swirl);\r\n              \r\n              // Enhanced edge glow for portal effect\r\n              float edgeGlow = smoothstep(0.8, 0.4, dist) * smoothstep(0.0, 0.6, dist);\r\n              finalColor = mix(finalColor, brightColor, edgeGlow * pulse);\r\n              \r\n              // Add portal event horizon effect\r\n              float eventHorizon = smoothstep(0.8, 0.78, dist) * 2.0;\r\n              finalColor += vec3(0.0, 1.0, 1.0) * eventHorizon;\r\n              \r\n              gl_FragColor = vec4(finalColor, alpha);\r\n            }\r\n          `,\r\n          transparent: true,\r\n          side: THREE.DoubleSide\r\n        });\r\n        \r\n        // Create portal disc using the shader material\r\n        const portalGeometry = new THREE.CircleGeometry(800, 128);\r\n        const portal = new THREE.Mesh(portalGeometry, portalShaderMaterial);\r\n        parentGroup.add(portal);\r\n        \r\n        // Enhanced portal glow light\r\n        const portalLight = new THREE.PointLight(0x00ffff, 400, 2000, 2);\r\n        portalLight.position.set(0, 0, 0);\r\n        parentGroup.add(portalLight);\r\n        \r\n        // Add some more volumetric effects around the portal\r\n        const createPortalWisps = () => {\r\n          const wispGeometry = new THREE.TorusGeometry(650, 10, 8, 100);\r\n          const wispMaterial = new THREE.MeshStandardMaterial({\r\n            color: 0x00ffff,\r\n            emissive: 0x00ffff,\r\n            emissiveIntensity: 2,\r\n            transparent: true,\r\n            opacity: 0.3,\r\n            side: THREE.DoubleSide\r\n          });\r\n        \r\n          const wisp = new THREE.Mesh(wispGeometry, wispMaterial);\r\n          wisp.rotation.x = Math.random() * Math.PI;\r\n          wisp.rotation.y = Math.random() * Math.PI;\r\n          \r\n          // Store animation parameters - more dramatic for enhanced effect\r\n          wisp.userData = {\r\n            rotationSpeed: {\r\n              x: (Math.random() - 0.5) * 0.02,  // 10x faster rotation\r\n              y: (Math.random() - 0.5) * 0.02,\r\n              z: (Math.random() - 0.5) * 0.02\r\n            },\r\n            pulseSpeed: 0.5 + Math.random() * 0.3\r\n          };\r\n          \r\n          this.portalParticles.push(wisp);\r\n          return wisp;\r\n        };\r\n        \r\n        // Add more wisps for enhanced effect\r\n        for (let i = 0; i < 8; i++) {\r\n          parentGroup.add(createPortalWisps());\r\n        }\r\n        \r\n        // Store the shader material for animation updates\r\n        this.portalShaderMaterial = portalShaderMaterial;\r\n        this.portalLight = portalLight;\r\n    }\r\n  \r\n    createNeonDetails() {\r\n        const detailsGroup = new THREE.Group();\r\n        \r\n        // Create evenly spaced neon accents around the ring\r\n        const createNeonAccent = (angle) => {\r\n          const accentGroup = new THREE.Group();\r\n          \r\n          // Neon light beam\r\n          const beamGeometry = new THREE.CylinderGeometry(10, 10, 300, 8);\r\n          const beamMaterial = new THREE.MeshStandardMaterial({\r\n            color: 0x00ffff,\r\n            emissive: 0x00ffff,\r\n            emissiveIntensity: 1,\r\n            transparent: true,\r\n            opacity: 0.8\r\n          });\r\n          const beam = new THREE.Mesh(beamGeometry, beamMaterial);\r\n          beam.rotation.x = Math.PI / 2; // Align with ring\r\n          \r\n          // Light source for glow\r\n          const light = new THREE.PointLight(0x00ffff, 100, 400, 2);\r\n          light.position.set(0, 0, 0);\r\n          \r\n          accentGroup.add(beam);\r\n          accentGroup.add(light);\r\n          \r\n          // Position on the ring\r\n          accentGroup.position.x = Math.cos(angle) * 1000;\r\n          accentGroup.position.y = Math.sin(angle) * 1000;\r\n          accentGroup.rotation.z = angle - Math.PI / 2; // Orient toward center\r\n          \r\n          // Store for animation\r\n          light.userData = {\r\n            originalIntensity: light.intensity,\r\n            phase: Math.random() * Math.PI * 2\r\n          };\r\n          \r\n          this.navLights.push({ light, lightMesh: beam });\r\n          \r\n          return accentGroup;\r\n        };\r\n        \r\n        // Add 8 neon accents evenly around the ring\r\n        for (let i = 0; i < 8; i++) {\r\n          const angle = (i / 8) * Math.PI * 2;\r\n          detailsGroup.add(createNeonAccent(angle));\r\n        }\r\n        \r\n        return detailsGroup;\r\n    }\r\n    \r\n    getPosition() {\r\n        // Updated to 2x height from the sun\r\n        return new THREE.Vector3(0, 10000, 0);\r\n    }\r\n    \r\n    getRegionInfo() {\r\n        // Updated center position to match new height\r\n        return {\r\n            center: new THREE.Vector3(0, 10000, 0),\r\n            radius: 2000\r\n        };\r\n    }\r\n    \r\n    update() {\r\n        // Animate navigation lights with pulsing effect\r\n        if (this.navLights) {\r\n          this.navLights.forEach(({ light, lightMesh }) => {\r\n                const time = Date.now() * 0.001;\r\n                const flicker = 0.7 + 0.3 * Math.sin(time * 2 + light.userData.phase);\r\n                \r\n                light.intensity = light.userData.originalIntensity * flicker;\r\n                \r\n            // Also update the light beam material\r\n            if (lightMesh.material) {\r\n              lightMesh.material.emissiveIntensity = flicker;\r\n              lightMesh.material.opacity = 0.5 + (flicker * 0.5);\r\n            }\r\n          });\r\n        }\r\n        \r\n        // Update shader time for the portal effect\r\n        if (this.portalShaderMaterial) {\r\n          this.portalShaderMaterial.uniforms.time.value = Date.now() * 0.001;\r\n          \r\n          // Make portal light pulse with time\r\n          if (this.portalLight) {\r\n            const time = Date.now() * 0.001;\r\n            this.portalLight.intensity = 400 + Math.sin(time * 2.0) * 150;\r\n          }\r\n        }\r\n        \r\n        // Animate the portal wisp effects\r\n        if (this.portalParticles) {\r\n          this.portalParticles.forEach(particle => {\r\n            const time = Date.now() * 0.001;\r\n            \r\n            // Apply rotation based on stored rotation speeds\r\n            if (particle.userData.rotationSpeed) {\r\n              particle.rotation.x += particle.userData.rotationSpeed.x;\r\n              particle.rotation.y += particle.userData.rotationSpeed.y;\r\n              particle.rotation.z += particle.userData.rotationSpeed.z;\r\n            }\r\n            \r\n            // Apply subtle scale pulsing if present\r\n            if (particle.userData.pulseSpeed) {\r\n              const pulse = 0.9 + 0.2 * Math.sin(time * particle.userData.pulseSpeed);\r\n              particle.scale.set(pulse, pulse, pulse);\r\n            }\r\n          });\r\n        }\r\n        \r\n        // Update counter-rotating ring\r\n        if (this.counterRotatingRing) {\r\n          this.counterRotatingRing.rotation.x += 0.006; // Counter rotate\r\n          this.counterRotatingRing.rotation.y += 0.009;\r\n          this.counterRotatingRing.rotation.z -= 0.003;\r\n        }\r\n        \r\n        // Rotate the stargate on all three axes for a more dynamic spinning effect (30x faster)\r\n        if (this.stargate) {\r\n          this.stargate.rotation.x += 0.003;   // 30x faster rotation on X axis (was 0.0001)\r\n          this.stargate.rotation.y += 0.0045;  // 30x faster rotation on Y axis (was 0.00015)\r\n          this.stargate.rotation.z += 0.006;   // 30x faster rotation on Z axis (was 0.0002)\r\n        }\r\n    }\r\n} ","// systemConfig.js - Star system configuration and constants\r\n\r\nexport const STAR_CLASSES = ['O', 'B', 'A', 'F', 'G', 'K', 'M'];\r\n\r\nexport const SYSTEM_CLASSIFICATIONS = [\r\n    'Resource-Rich', \r\n    'Ancient', \r\n    'Unstable', \r\n    'Barren', \r\n    'Hazardous', \r\n    'Peaceful'\r\n];\r\n\r\nexport const SKYBOX_TEXTURES = [\r\n    './assets/s1.jpg',\r\n    './assets/s2.jpg',\r\n    './assets/s3.jpg',\r\n    './assets/s4.jpg',\r\n    './assets/s5.jpg',\r\n    './assets/s6.jpg',\r\n    './assets/s7.jpg',\r\n    './assets/s8.jpg',\r\n    './assets/s9.jpg'\r\n];\r\n\r\nexport const RESOURCE_DISTRIBUTION = {\r\n    'O': { iron: 0.3, gold: 0.4, platinum: 0.3 },\r\n    'B': { iron: 0.2, gold: 0.3, platinum: 0.5 },\r\n    'A': { iron: 0.2, gold: 0.5, platinum: 0.3 },\r\n    'F': { iron: 0.3, gold: 0.4, platinum: 0.3 },\r\n    'G': { iron: 0.4, gold: 0.3, platinum: 0.3 },\r\n    'K': { iron: 0.5, gold: 0.3, platinum: 0.2 },\r\n    'M': { iron: 0.6, gold: 0.2, platinum: 0.2 }\r\n};\r\n\r\nexport const CLASSIFICATION_MULTIPLIERS = {\r\n    'Resource-Rich': { iron: 2.0, gold: 2.0, platinum: 2.0 },\r\n    'Ancient': { iron: 1.0, gold: 1.5, platinum: 2.5 },\r\n    'Unstable': { iron: 1.0, gold: 1.0, platinum: 3.0 },\r\n    'Barren': { iron: 0.5, gold: 0.5, platinum: 0.5 },\r\n    'Hazardous': { iron: 1.5, gold: 1.5, platinum: 1.5 },\r\n    'Peaceful': { iron: 1.0, gold: 1.0, platinum: 1.0 },\r\n    'Home System': { iron: 1.0, gold: 1.0, platinum: 1.0 }\r\n};\r\n\r\nexport const STAR_COLORS = {\r\n    'O': 0x9bb0ff, // Blue\r\n    'B': 0xaabfff, // Blue-white\r\n    'A': 0xcad7ff, // White\r\n    'F': 0xf8f7ff, // Yellow-white\r\n    'G': 0xfff4ea, // Yellow (like our sun)\r\n    'K': 0xffd2a1, // Orange\r\n    'M': 0xffcc6f  // Red\r\n};\r\n\r\nexport const SKYBOX_COLORS = {\r\n    'O': 0x0000ff, // Blue tint\r\n    'B': 0x4444ff, // Blue-white tint\r\n    'A': 0x8888ff, // White-blue tint\r\n    'F': 0xddddff, // Yellow-white tint\r\n    'G': 0xffffdd, // Yellow tint\r\n    'K': 0xffddaa, // Orange tint\r\n    'M': 0xff8866  // Red tint\r\n};","// systemNames.js - System name generation and descriptions\r\n\r\nexport class SystemNames {\r\n    static generateSystemName(starClass) {\r\n        const prefixes = [\r\n            'Alpha', 'Beta', 'Gamma', 'Delta', 'Epsilon', 'Zeta', 'Eta', 'Theta',\r\n            'Proxima', 'Nova', 'Sirius', 'Vega', 'Rigel', 'Antares', 'Arcturus'\r\n        ];\r\n        \r\n        const suffixes = [\r\n            'Prime', 'Major', 'Minor', 'A', 'B', 'I', 'II', 'III', 'IV', 'V'\r\n        ];\r\n        \r\n        const prefix = prefixes[Math.floor(Math.random() * prefixes.length)];\r\n        const suffix = Math.random() > 0.7 ? ` ${suffixes[Math.floor(Math.random() * suffixes.length)]}` : '';\r\n        const number = Math.floor(Math.random() * 999) + 1;\r\n        \r\n        return `${prefix} ${starClass}${number}${suffix}`;\r\n    }\r\n\r\n    static generateSpecialFeatures(classification) {\r\n        const features = [];\r\n        \r\n        switch (classification) {\r\n            case 'Resource-Rich':\r\n                features.push('Dense Asteroid Fields', 'Rich Mineral Veins');\r\n                break;\r\n            case 'Ancient':\r\n                features.push('Abandoned Structures', 'Ancient Artifacts');\r\n                break;\r\n            case 'Unstable':\r\n                features.push('Solar Flares', 'Radiation Bursts');\r\n                break;\r\n            case 'Barren':\r\n                features.push('Minimal Resources', 'Few Planets');\r\n                break;\r\n            case 'Hazardous':\r\n                features.push('Asteroid Storms', 'Energy Anomalies');\r\n                break;\r\n            case 'Peaceful':\r\n                features.push('Stable Environment', 'Optimal Mining Conditions');\r\n                break;\r\n        }\r\n        \r\n        return features;\r\n    }\r\n\r\n    static generateDescription(starClass, classification) {\r\n        const starDescriptions = {\r\n            'O': \"A rare, hot blue star system with intense radiation.\",\r\n            'B': \"A blue-white star system with high energy output.\",\r\n            'A': \"A white star system with moderate radiation levels.\",\r\n            'F': \"A yellow-white star system with mild conditions.\",\r\n            'G': \"A yellow star system similar to our Solar System.\",\r\n            'K': \"An orange star system with reduced energy output.\",\r\n            'M': \"A common red dwarf system with low energy output.\"\r\n        };\r\n        \r\n        const classDescriptions = {\r\n            'Resource-Rich': \"The system is known for its abundant resources and dense asteroid fields.\",\r\n            'Ancient': \"This ancient system contains remnants of long-lost civilizations.\",\r\n            'Unstable': \"Be cautious as unpredictable stellar activity occurs in this system.\",\r\n            'Barren': \"Resources are scarce in this mostly empty star system.\",\r\n            'Hazardous': \"Environmental hazards make mining operations difficult but rewarding.\",\r\n            'Peaceful': \"This system offers stable and optimal conditions for mining operations.\",\r\n            'Home System': \"Our home system, containing Earth and the origin of humanity.\"\r\n        };\r\n        \r\n        return `${starDescriptions[starClass]} ${classDescriptions[classification]}`;\r\n    }\r\n}","// systemUtils.js - Utility functions for star system generation\r\n\r\nimport * as THREE from 'three';\r\nimport { STAR_CLASSES, SYSTEM_CLASSIFICATIONS, SKYBOX_TEXTURES } from './systemConfig.js';\r\n\r\nexport class SystemUtils {\r\n    static getRandomStarClass() {\r\n        const weights = [1, 2, 5, 10, 15, 20, 50]; // More M class stars, fewer O class\r\n        const total = weights.reduce((sum, weight) => sum + weight, 0);\r\n        let random = Math.random() * total;\r\n        \r\n        for (let i = 0; i < weights.length; i++) {\r\n            if (random < weights[i]) {\r\n                return STAR_CLASSES[i];\r\n            }\r\n            random -= weights[i];\r\n        }\r\n        \r\n        return STAR_CLASSES[SystemUtils.getRandomInt(0, STAR_CLASSES.length - 1)];\r\n    }\r\n\r\n    static getRandomClassification() {\r\n        return SYSTEM_CLASSIFICATIONS[SystemUtils.getRandomInt(0, SYSTEM_CLASSIFICATIONS.length - 1)];\r\n    }\r\n\r\n    static getRandomSkyboxTexture() {\r\n        return SKYBOX_TEXTURES[SystemUtils.getRandomInt(0, SKYBOX_TEXTURES.length - 1)];\r\n    }\r\n\r\n    static generateMapPosition() {\r\n        const radius = 150 + Math.random() * 100;\r\n        const angle = Math.random() * Math.PI * 2;\r\n        \r\n        const x = Math.cos(angle) * radius;\r\n        const y = Math.sin(angle) * radius;\r\n        \r\n        return new THREE.Vector3(x, y, 0);\r\n    }\r\n\r\n    static getRandomInt(min, max) {\r\n        return Math.floor(Math.random() * (max - min + 1)) + min;\r\n    }\r\n\r\n    static getRandomFloat(min, max) {\r\n        return Math.random() * (max - min) + min;\r\n    }\r\n\r\n    static getRandomColor() {\r\n        return Math.floor(Math.random() * 0xFFFFFF);\r\n    }\r\n}","// systemFactory.js - Star system creation and configuration\r\n\r\nimport * as THREE from 'three';\r\nimport { \r\n    STAR_CLASSES, \r\n    SYSTEM_CLASSIFICATIONS, \r\n    SKYBOX_TEXTURES, \r\n    RESOURCE_DISTRIBUTION,\r\n    CLASSIFICATION_MULTIPLIERS,\r\n    STAR_COLORS,\r\n    SKYBOX_COLORS\r\n} from './systemConfig.js';\r\nimport { SystemNames } from './systemNames.js';\r\nimport { SystemUtils } from './systemUtils.js';\r\n\r\nexport class SystemFactory {\r\n    static createSolarSystem() {\r\n        return {\r\n            id: 'Solar System',\r\n            name: 'Solar System',\r\n            starClass: 'G',\r\n            classification: 'Home System',\r\n            starColor: 0xFFFF00,\r\n            planetCount: 8,\r\n            asteroidDensity: 1.0,\r\n            specialFeatures: ['Earth'],\r\n            description: 'Our home system, with Earth as the starting location.',\r\n            connections: [],\r\n            position: new THREE.Vector3(0, 0, 0),\r\n            skyboxParams: {\r\n                starDensity: 1.0,\r\n                nebulaDensity: 0.5,\r\n                color: 0xFFFFFF,\r\n                texturePath: './assets/2k_stars_milky_way.jpg',\r\n                brightness: 1.0\r\n            },\r\n            resourceMultipliers: {\r\n                iron: 1.0, \r\n                gold: 1.0, \r\n                platinum: 1.0\r\n            }\r\n        };\r\n    }\r\n\r\n    static createRandomSystem(id) {\r\n        const starClass = SystemUtils.getRandomStarClass();\r\n        const classification = SystemUtils.getRandomClassification();\r\n        const starColor = STAR_COLORS[starClass] || 0xffffff;\r\n        const resourceMult = SystemFactory.calculateResourceMultipliers(starClass, classification);\r\n        const skyboxTexture = SystemUtils.getRandomSkyboxTexture();\r\n        \r\n        return {\r\n            id: id,\r\n            name: SystemNames.generateSystemName(starClass),\r\n            starClass: starClass,\r\n            classification: classification,\r\n            starColor: starColor,\r\n            planetCount: SystemUtils.getRandomInt(2, 10),\r\n            asteroidDensity: SystemUtils.getRandomFloat(0.5, 2.5),\r\n            specialFeatures: SystemNames.generateSpecialFeatures(classification),\r\n            description: SystemNames.generateDescription(starClass, classification),\r\n            connections: [],\r\n            position: SystemUtils.generateMapPosition(),\r\n            skyboxParams: {\r\n                starDensity: SystemUtils.getRandomFloat(0.7, 1.5),\r\n                nebulaDensity: SystemUtils.getRandomFloat(0.3, 1.2),\r\n                color: SKYBOX_COLORS[starClass] || 0xffffff,\r\n                texturePath: skyboxTexture,\r\n                brightness: 0.8\r\n            },\r\n            resourceMultipliers: resourceMult\r\n        };\r\n    }\r\n\r\n    static calculateResourceMultipliers(starClass, classification) {\r\n        const baseDistribution = RESOURCE_DISTRIBUTION[starClass];\r\n        const classMultiplier = CLASSIFICATION_MULTIPLIERS[classification];\r\n        \r\n        return {\r\n            iron: baseDistribution.iron * classMultiplier.iron,\r\n            gold: baseDistribution.gold * classMultiplier.gold, \r\n            platinum: baseDistribution.platinum * classMultiplier.platinum\r\n        };\r\n    }\r\n\r\n    static createCustomSystem(systemData) {\r\n        if (!systemData || !systemData.id || !systemData.name) {\r\n            console.error('Invalid system data', systemData);\r\n            return null;\r\n        }\r\n\r\n        return {\r\n            id: systemData.id,\r\n            name: systemData.name,\r\n            starClass: systemData.starClass || SystemUtils.getRandomStarClass(),\r\n            classification: systemData.classification || 'Custom',\r\n            starColor: systemData.starColor || STAR_COLORS[systemData.starClass || 'G'],\r\n            planetCount: systemData.planetData ? systemData.planetData.length : 0,\r\n            asteroidDensity: systemData.asteroidDensity || 1.0,\r\n            specialFeatures: systemData.specialFeatures || ['User Created'],\r\n            description: systemData.description || 'A custom star system created by the user',\r\n            connections: [],\r\n            position: systemData.position || SystemUtils.generateMapPosition(),\r\n            skyboxParams: {\r\n                starDensity: systemData.skyboxParams?.starDensity || 1.0,\r\n                nebulaDensity: systemData.skyboxParams?.nebulaDensity || 0.8,\r\n                color: systemData.skyboxParams?.color || SKYBOX_COLORS[systemData.starClass || 'G'],\r\n                texturePath: systemData.skyboxUrl || SystemUtils.getRandomSkyboxTexture(),\r\n                brightness: systemData.skyboxParams?.brightness || 0.8,\r\n                isCustomTexture: !!systemData.skyboxUrl\r\n            },\r\n            resourceMultipliers: systemData.resourceMultipliers || {\r\n                iron: 1.0,\r\n                gold: 1.0,\r\n                platinum: 1.0\r\n            },\r\n            isCustomSystem: true\r\n        };\r\n    }\r\n}","// starSystemGenerator.js - Procedural generation of star systems\r\n\r\nimport * as THREE from 'three';\r\nimport { SystemFactory } from './generator/systemFactory.js';\r\nimport { SystemUtils } from './generator/systemUtils.js';\r\n\r\nexport class StarSystemGenerator {\r\n    constructor(scene) {\r\n        this.scene = scene;\r\n        this.systems = {};\r\n        this.currentSystem = null;\r\n        this.warpGates = {};\r\n        this.initializeSystems();\r\n    }\r\n    \r\n    // Initialize star systems with Solar System as default\r\n    initializeSystems() {\r\n        console.log(\"Initializing star systems...\");\r\n        \r\n        this.systems['Solar System'] = SystemFactory.createSolarSystem();\r\n        this.generateRandomSystems(5);\r\n        this.createSystemConnections();\r\n        this.setCurrentSystem('Solar System');\r\n        \r\n        console.log(\"Star systems initialized\");\r\n    }\r\n    \r\n    // Generate random star systems\r\n    generateRandomSystems(count) {\r\n        for (let i = 0; i < count; i++) {\r\n            const id = `System-${i+1}`;\r\n            this.systems[id] = SystemFactory.createRandomSystem(id);\r\n        }\r\n    }\r\n    \r\n    // Create connections between systems\r\n    createSystemConnections() {\r\n        const systemIds = Object.keys(this.systems);\r\n        \r\n        // Connect Solar System to at least two random systems\r\n        const solarConnections = this.getRandomSystemsExcept('Solar System', 2);\r\n        for (const targetId of solarConnections) {\r\n            this.createConnection('Solar System', targetId);\r\n        }\r\n        \r\n        // Ensure each system has at least one connection\r\n        for (const systemId of systemIds) {\r\n            const system = this.systems[systemId];\r\n            if (system.connections.length === 0) {\r\n                const targetId = this.getRandomSystemExcept(systemId);\r\n                this.createConnection(systemId, targetId);\r\n            }\r\n        }\r\n        \r\n        // Add additional random connections\r\n        const extraConnectionCount = Math.floor(systemIds.length / 2);\r\n        for (let i = 0; i < extraConnectionCount; i++) {\r\n            const sourceId = systemIds[SystemUtils.getRandomInt(0, systemIds.length - 1)];\r\n            const targetId = this.getRandomSystemExcept(sourceId);\r\n            \r\n            if (!this.systems[sourceId].connections.includes(targetId)) {\r\n                this.createConnection(sourceId, targetId);\r\n            }\r\n        }\r\n    }\r\n    \r\n    // Create a connection between two systems\r\n    createConnection(sourceId, targetId) {\r\n        this.systems[sourceId].connections.push(targetId);\r\n        this.systems[targetId].connections.push(sourceId);\r\n        \r\n        if (!this.warpGates[sourceId]) {\r\n            this.warpGates[sourceId] = [];\r\n        }\r\n        if (!this.warpGates[targetId]) {\r\n            this.warpGates[targetId] = [];\r\n        }\r\n        \r\n        this.warpGates[sourceId].push(targetId);\r\n        this.warpGates[targetId].push(sourceId);\r\n        \r\n        console.log(`Created connection between ${sourceId} and ${targetId}`);\r\n    }\r\n    \r\n    // Get list of connections for current system\r\n    getCurrentSystemConnections() {\r\n        if (!this.currentSystem) return [];\r\n        return this.systems[this.currentSystem].connections;\r\n    }\r\n    \r\n    // Get resource distribution for current system\r\n    getCurrentSystemResources() {\r\n        if (!this.currentSystem) return { iron: 1, gold: 1, platinum: 1 };\r\n        \r\n        const system = this.systems[this.currentSystem];\r\n        return system.resourceMultipliers;\r\n    }\r\n    \r\n    // Set the current active system\r\n    setCurrentSystem(systemId) {\r\n        if (this.systems[systemId]) {\r\n            this.currentSystem = systemId;\r\n            console.log(`Traveled to system: ${systemId}`);\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n    \r\n    // Travel to a connected system\r\n    travelToSystem(targetSystemId) {\r\n        // Verify the target system exists\r\n        if (!this.systems[targetSystemId]) {\r\n            console.error(`System ${targetSystemId} does not exist`);\r\n            return false;\r\n        }\r\n        \r\n        // Verify there is a connection from current to target\r\n        const connections = this.getCurrentSystemConnections();\r\n        if (!connections.includes(targetSystemId)) {\r\n            console.error(`No connection from ${this.currentSystem} to ${targetSystemId}`);\r\n            return false;\r\n        }\r\n        \r\n        // Check if the ship is docked\r\n        if (window.game && window.game.spaceship && window.game.spaceship.isDocked) {\r\n            console.log(\"Player is docked during interstellar travel\");\r\n        }\r\n        \r\n        // Log current system params\r\n        if (this.systems[this.currentSystem]) {\r\n            const currentParams = this.systems[this.currentSystem].skyboxParams;\r\n            console.log(`${this.currentSystem} skybox params before travel: \r\n                         color=${currentParams.color.toString(16)}, \r\n                         starDensity=${currentParams.starDensity}, \r\n                         nebulaDensity=${currentParams.nebulaDensity}, \r\n                         texture=${currentParams.texturePath}`);\r\n        }\r\n        \r\n        // Log target system params\r\n        if (this.systems[targetSystemId]) {\r\n            const targetParams = this.systems[targetSystemId].skyboxParams;\r\n            console.log(`Traveling to ${targetSystemId} with skybox params: \r\n                         color=${targetParams.color.toString(16)}, \r\n                         starDensity=${targetParams.starDensity}, \r\n                         nebulaDensity=${targetParams.nebulaDensity}, \r\n                         texture=${targetParams.texturePath}`);\r\n        }\r\n        \r\n        // Set the new current system\r\n        this.setCurrentSystem(targetSystemId);\r\n        return true;\r\n    }\r\n    \r\n    // Get all star systems for the map\r\n    getAllSystems() {\r\n        return this.systems;\r\n    }\r\n    \r\n    // Get current system data\r\n    getCurrentSystemData() {\r\n        if (!this.currentSystem) return null;\r\n        return this.systems[this.currentSystem];\r\n    }\r\n    \r\n    // Helper methods\r\n    \r\n    getRandomSystemsExcept(exceptId, count) {\r\n        const systemIds = Object.keys(this.systems).filter(id => id !== exceptId);\r\n        const selected = [];\r\n        \r\n        for (let i = 0; i < Math.min(count, systemIds.length); i++) {\r\n            const index = SystemUtils.getRandomInt(0, systemIds.length - 1);\r\n            selected.push(systemIds[index]);\r\n            systemIds.splice(index, 1);\r\n        }\r\n        \r\n        return selected;\r\n    }\r\n    \r\n    getRandomSystemExcept(exceptId) {\r\n        const systemIds = Object.keys(this.systems).filter(id => id !== exceptId);\r\n        const index = SystemUtils.getRandomInt(0, systemIds.length - 1);\r\n        return systemIds[index];\r\n    }\r\n    \r\n    // Add custom system\r\n    addCustomSystem(systemData) {\r\n        const customSystem = SystemFactory.createCustomSystem(systemData);\r\n        if (!customSystem) {\r\n            return false;\r\n        }\r\n        \r\n        if (this.systems[systemData.id]) {\r\n            console.warn(`System with ID ${systemData.id} already exists, overwriting`);\r\n        }\r\n        \r\n        console.log(`Adding custom system: ${systemData.name} (${systemData.id})`);\r\n        \r\n        // Store custom planet data if provided\r\n        if (systemData.planetData && Array.isArray(systemData.planetData)) {\r\n            this.storePlanetData(systemData.id, systemData.planetData);\r\n        }\r\n        \r\n        this.systems[systemData.id] = customSystem;\r\n        \r\n        // Create connections\r\n        this.createConnection('Solar System', systemData.id);\r\n        \r\n        const randomSystem = this.getRandomSystemExcept(systemData.id, 'Solar System');\r\n        if (randomSystem) {\r\n            this.createConnection(systemData.id, randomSystem);\r\n        }\r\n        \r\n        console.log(`Custom system ${systemData.name} added successfully with connections to Solar System and ${randomSystem || 'no other system'}`);\r\n        \r\n        return true;\r\n    }\r\n    \r\n    // Store custom planet data\r\n    storePlanetData(systemId, planetData) {\r\n        if (!Array.isArray(planetData)) {\r\n            console.error('Planet data must be an array');\r\n            return;\r\n        }\r\n        \r\n        const standardizedPlanets = [];\r\n        \r\n        for (let i = 0; i < planetData.length; i++) {\r\n            const planet = planetData[i];\r\n            \r\n            standardizedPlanets.push({\r\n                name: planet.name || `Planet-${i+1}`,\r\n                size: planet.size || (300 + Math.random() * 500),\r\n                distance: planet.distance || (4800 + (i * 8000) + (Math.random() * 2000)),\r\n                speed: planet.speed || (0.001 + (Math.random() * 0.001)),\r\n                color: planet.color || SystemUtils.getRandomColor(),\r\n                rings: planet.rings !== undefined ? planet.rings : Math.random() > 0.7,\r\n                textureUrl: planet.textureUrl || null,\r\n                axialTilt: planet.axialTilt || (Math.random() * Math.PI * 0.5),\r\n                orbitalTilt: planet.orbitalTilt || (Math.random() * Math.PI * 0.2)\r\n            });\r\n        }\r\n        \r\n        if (!this.customPlanetData) {\r\n            this.customPlanetData = {};\r\n        }\r\n        \r\n        this.customPlanetData[systemId] = standardizedPlanets;\r\n        console.log(`Stored ${standardizedPlanets.length} planets for system ${systemId}`);\r\n    }\r\n\r\n    /**\r\n     * Returns player to stargate after interstellar travel\r\n     * Should be called after travel to ensure proper docking state\r\n     */\r\n    returnFromTravel() {\r\n        console.log(\"StarSystemGenerator: Handling return from interstellar travel\");\r\n        \r\n        // Check if game and spaceship are available\r\n        if (!window.game || !window.game.spaceship) {\r\n            console.error(\"StarSystemGenerator: Cannot return from travel - game or spaceship not found\");\r\n            return false;\r\n        }\r\n        \r\n        // Ensure the player is docked after travel\r\n        if (!window.game.spaceship.isDocked) {\r\n            console.log(\"StarSystemGenerator: Setting ship to docked state after travel\");\r\n            window.game.spaceship.dock();\r\n        }\r\n        \r\n        // Reposition ship near stargate\r\n        const dockingSystem = window.game.controls?.dockingSystem;\r\n        if (dockingSystem) {\r\n            console.log(\"StarSystemGenerator: Repositioning ship near stargate\");\r\n            dockingSystem.positionNearStargate();\r\n            \r\n            // Show stargate UI\r\n            if (typeof dockingSystem.showStargateUI === 'function') {\r\n                console.log(\"StarSystemGenerator: Showing stargate UI via docking system\");\r\n                dockingSystem.showStargateUI();\r\n                return true;\r\n            }\r\n        }\r\n        \r\n        // Fallback - try to find UI or stargate interface directly\r\n        if (window.game.ui?.stargateInterface?.showStargateUI) {\r\n            console.log(\"StarSystemGenerator: Showing stargate UI via game.ui.stargateInterface\");\r\n            window.game.ui.stargateInterface.showStargateUI();\r\n            return true;\r\n        }\r\n        \r\n        console.warn(\"StarSystemGenerator: Could not fully complete return from travel\");\r\n        return false;\r\n    }\r\n}","// sceneInitializer.js - Handles scene setup and initialization logic\r\n\r\nimport { Skybox } from '../skybox.js';\r\nimport { Sun } from '../sun.js';\r\nimport { Planets } from '../planets.js';\r\nimport { Stargate } from '../stargate.js';\r\nimport { StarSystemGenerator } from '../starSystemGenerator.js';\r\n\r\nexport class SceneInitializer {\r\n    constructor(scene) {\r\n        this.scene = scene;\r\n        this.componentsLoaded = false;\r\n    }\r\n\r\n    // Initialize essential components first\r\n    initializeEssentialComponents() {\r\n        console.log(\"Initializing essential environment components...\");\r\n        \r\n        // Initialize only essential components first\r\n        this.skybox = new Skybox(this.scene);\r\n        this.sun = new Sun(this.scene);\r\n        \r\n        // Initialize star system generator\r\n        this.starSystemGenerator = new StarSystemGenerator(this.scene);\r\n        \r\n        // Initialize planets with reference to starSystemGenerator - needed for basic gameplay\r\n        this.planets = new Planets(this.scene, this.starSystemGenerator);\r\n        \r\n        // Initialize stargate - needed for docking UI\r\n        this.stargate = new Stargate(this.scene);\r\n        \r\n        console.log(\"Essential environment components initialized\");\r\n        \r\n        return {\r\n            skybox: this.skybox,\r\n            sun: this.sun,\r\n            starSystemGenerator: this.starSystemGenerator,\r\n            planets: this.planets,\r\n            stargate: this.stargate\r\n        };\r\n    }\r\n\r\n    // Load remaining non-essential components asynchronously\r\n    async loadRemainingComponents() {\r\n        console.log(\"Loading remaining environment components...\");\r\n        \r\n        // Initialize asteroid belt - slightly defer to prioritize UI loading\r\n        const { AsteroidBelt } = await import('../asteroidBelt.js');\r\n        this.asteroidBelt = new AsteroidBelt(this.scene);\r\n        \r\n        // Initialize space anomalies\r\n        const { SpaceAnomalies } = await import('../spaceAnomalies.js');\r\n        this.spaceAnomalies = new SpaceAnomalies(this.scene);\r\n        \r\n        // Initialize system transition effects\r\n        const { SystemTransition } = await import('../systemTransition.js');\r\n        this.systemTransition = new SystemTransition(this.scene, this.scene.camera);\r\n        \r\n        // Initialize the custom system creator\r\n        const { CustomSystemCreator } = await import('../../ui/customSystemCreator.js');\r\n        this.customSystemCreator = new CustomSystemCreator(this.starSystemGenerator, this);\r\n        console.log(\"Custom system creator initialized:\", this.customSystemCreator);\r\n        \r\n        this.componentsLoaded = true;\r\n        console.log(\"All environment components initialized\");\r\n        \r\n        return {\r\n            asteroidBelt: this.asteroidBelt,\r\n            spaceAnomalies: this.spaceAnomalies,\r\n            systemTransition: this.systemTransition,\r\n            customSystemCreator: this.customSystemCreator\r\n        };\r\n    }\r\n\r\n    // Initialize VibeVerse portals - requires spaceship reference\r\n    async initializePortals(spaceship) {\r\n        const { VibeVersePortals } = await import('../vibeVersePortals.js');\r\n        this.vibeVersePortals = new VibeVersePortals(this.scene, spaceship);\r\n        console.log(\"VibeVerse portals initialized\");\r\n        return this.vibeVersePortals;\r\n    }\r\n\r\n    dispose() {\r\n        // Dispose all components\r\n        if (this.skybox) this.skybox.dispose();\r\n        if (this.sun) this.sun.dispose();\r\n        if (this.planets) this.planets.dispose();\r\n        if (this.asteroidBelt) this.asteroidBelt.dispose();\r\n        if (this.stargate) this.stargate.dispose();\r\n        if (this.spaceAnomalies) this.spaceAnomalies.clearAllAnomalies();\r\n        if (this.vibeVersePortals) this.vibeVersePortals.dispose();\r\n    }\r\n}","// regionManager.js - Handles celestial object regions and location tracking\r\n\r\nexport class RegionManager {\r\n    constructor() {\r\n        this.planetRegions = {};\r\n    }\r\n\r\n    // Basic region setup for essential components only\r\n    setupInitialRegions(sun, stargate, planets) {\r\n        console.log(\"Setting up essential environment regions\");\r\n        \r\n        // Initialize the planetRegions object\r\n        this.planetRegions = {};\r\n        \r\n        // Safely get planet regions if the method exists\r\n        if (planets && typeof planets.getPlanetRegions === 'function') {\r\n            try {\r\n                this.planetRegions = planets.getPlanetRegions();\r\n            } catch (error) {\r\n                console.warn(\"Error getting planet regions:\", error);\r\n            }\r\n        } else {\r\n            console.warn(\"planets.getPlanetRegions is not available, using empty object instead\");\r\n        }\r\n        \r\n        // Add sun region\r\n        this.planetRegions[\"Sun\"] = {\r\n            center: sun.getPosition(),\r\n            radius: sun.getRadius()\r\n        };\r\n        \r\n        // Add stargate region\r\n        const stargateRegion = stargate.getRegionInfo();\r\n        this.planetRegions[\"Stargate\"] = {\r\n            center: stargateRegion.center,\r\n            radius: stargateRegion.radius\r\n        };\r\n    }\r\n\r\n    // Complete region setup with all components\r\n    setupRegions(sun, stargate, planets, asteroidBelt, spaceAnomalies) {\r\n        console.log(\"Setting up environment regions\");\r\n        \r\n        // Initialize or reset the planetRegions object\r\n        this.planetRegions = {};\r\n        \r\n        // Safely get planet regions if the method exists\r\n        if (planets && typeof planets.getPlanetRegions === 'function') {\r\n            try {\r\n                this.planetRegions = planets.getPlanetRegions();\r\n            } catch (error) {\r\n                console.warn(\"Error getting planet regions in setupRegions:\", error);\r\n            }\r\n        } else {\r\n            console.warn(\"planets.getPlanetRegions is not available in setupRegions, using empty object\");\r\n        }\r\n        \r\n        // Add sun region\r\n        this.planetRegions[\"Sun\"] = {\r\n            center: sun.getPosition(),\r\n            radius: sun.getRadius()\r\n        };\r\n        \r\n        // Add asteroid belt region\r\n        const asteroidBeltRegion = asteroidBelt.getRegionInfo();\r\n        this.planetRegions[\"Asteroid Belt\"] = {\r\n            center: asteroidBeltRegion.center,\r\n            minRadius: asteroidBeltRegion.innerRadius,\r\n            maxRadius: asteroidBeltRegion.outerRadius\r\n        };\r\n        \r\n        // Add stargate region\r\n        const stargateRegion = stargate.getRegionInfo();\r\n        this.planetRegions[\"Stargate\"] = {\r\n            center: stargateRegion.center,\r\n            radius: stargateRegion.radius\r\n        };\r\n        \r\n        // Add space anomalies region\r\n        const anomaliesRegion = spaceAnomalies.getRegionInfo();\r\n        this.planetRegions[\"Space Anomalies\"] = {\r\n            center: anomaliesRegion.center,\r\n            minRadius: anomaliesRegion.innerRadius,\r\n            maxRadius: anomaliesRegion.outerRadius\r\n        };\r\n    }\r\n\r\n    // Get the player's current location based on position\r\n    getPlayerLocation(playerPosition, spaceAnomalies, asteroids, componentsLoaded) {\r\n        if (!playerPosition) {\r\n            return \"Unknown Location\";\r\n        }\r\n        \r\n        // Check if near stargate\r\n        const stargateRegion = this.planetRegions[\"Stargate\"];\r\n        if (stargateRegion) {\r\n            const distanceToStargate = playerPosition.distanceTo(stargateRegion.center);\r\n            if (distanceToStargate <= stargateRegion.radius) {\r\n                return \"Stargate\";\r\n            }\r\n        }\r\n        \r\n        // Check if near an anomaly - only if spaceAnomalies is loaded\r\n        if (componentsLoaded && spaceAnomalies) {\r\n            const closestAnomaly = spaceAnomalies.findClosestAnomaly(playerPosition, 2000);\r\n            if (closestAnomaly) {\r\n                const distance = playerPosition.distanceTo(closestAnomaly.position);\r\n                if (distance < 800) {\r\n                    let anomalyType = '';\r\n                    switch (closestAnomaly.type) {\r\n                        case 'vortex':\r\n                            anomalyType = 'Vortex';\r\n                            break;\r\n                        case 'crystalCluster':\r\n                            anomalyType = 'Crystal Cluster';\r\n                            break;\r\n                        case 'nebulaNexus':\r\n                            anomalyType = 'Nebula Nexus';\r\n                            break;\r\n                        case 'quantumFlux':\r\n                            anomalyType = 'Quantum Flux';\r\n                            break;\r\n                        case 'darkMatter':\r\n                            anomalyType = 'Dark Matter';\r\n                            break;\r\n                    }\r\n                    \r\n                    // Indicate if orb is still available\r\n                    const orbStatus = closestAnomaly.orbCollected ? 'Depleted' : 'Active';\r\n                    return `${anomalyType} Anomaly (${orbStatus})`;\r\n                }\r\n            }\r\n        }\r\n        \r\n        // Check planets\r\n        for (const [name, region] of Object.entries(this.planetRegions)) {\r\n            if (name === \"Asteroid Belt\" && componentsLoaded && asteroids) {\r\n                // Special case for asteroid belt - only if loaded\r\n                const distance = playerPosition.distanceTo(region.center);\r\n                if (region.minRadius && region.maxRadius && \r\n                    distance >= region.minRadius && \r\n                    distance <= region.maxRadius) {\r\n                    // Count nearby asteroids (useful for mining)\r\n                    const nearbyAsteroids = asteroids.filter(asteroid => {\r\n                        return playerPosition.distanceTo(asteroid.mesh.position) < 500;\r\n                    });\r\n                    \r\n                    if (nearbyAsteroids.length > 0) {\r\n                        return `Asteroid Field (${nearbyAsteroids.length} nearby)`;\r\n                    }\r\n                    return \"Asteroid Belt\";\r\n                }\r\n            } else if (name === \"Space Anomalies\" && componentsLoaded) {\r\n                // Special case for space anomalies region - only if loaded\r\n                const distance = playerPosition.distanceTo(region.center);\r\n                if (region.minRadius && region.maxRadius && \r\n                    distance >= region.minRadius && \r\n                    distance <= region.maxRadius) {\r\n                    return \"Space Anomaly Field\";\r\n                }\r\n            } else if (name !== \"Sun\" && name !== \"Stargate\" && region.center && region.radius) {\r\n                const distance = playerPosition.distanceTo(region.center);\r\n                if (distance <= region.radius) {\r\n                    return `Near ${name}`;\r\n                }\r\n            }\r\n        }\r\n        \r\n        // Check sun\r\n        const sunRegion = this.planetRegions[\"Sun\"];\r\n        if (sunRegion) {\r\n            const distanceToSun = playerPosition.distanceTo(sunRegion.center);\r\n            if (distanceToSun <= sunRegion.radius) {\r\n                return \"Near Sun\";\r\n            }\r\n        }\r\n        \r\n        // Deep space\r\n        return \"Deep Space\";\r\n    }\r\n\r\n    getPlanetRegions() {\r\n        return this.planetRegions;\r\n    }\r\n}","// systemTransitionManager.js - Handles system transitions and travel logic\r\n\r\nexport class SystemTransitionManager {\r\n    constructor() {\r\n        this.currentSystemId = 'Solar System'; // Default starting system\r\n    }\r\n\r\n    // Set up handlers for star system transitions\r\n    setupSystemTransitionHandlers(starSystemGenerator, asteroidBelt) {\r\n        // Apply resource multipliers from current system to asteroid belt\r\n        if (starSystemGenerator && asteroidBelt) {\r\n            const resources = starSystemGenerator.getCurrentSystemResources();\r\n            asteroidBelt.setResourceMultipliers(resources);\r\n        }\r\n    }\r\n\r\n    // Travel to a new star system\r\n    travelToSystem(systemId, starSystemGenerator, systemTransition, updateEnvironmentCallback) {\r\n        if (!starSystemGenerator || !systemTransition) return false;\r\n        \r\n        // Check if the system exists and is connected to the current one\r\n        if (!starSystemGenerator.travelToSystem(systemId)) {\r\n            console.error(`Cannot travel to system ${systemId}`);\r\n            return false;\r\n        }\r\n        \r\n        console.log(`Starting transition to system: ${systemId}`);\r\n        \r\n        // Start the transition effect\r\n        systemTransition.startTransition(() => {\r\n            // This callback is called when transition is complete\r\n            console.log(`Transition complete, updating environment for: ${systemId}`);\r\n            \r\n            // Update the environment based on the new system\r\n            updateEnvironmentCallback(systemId);\r\n            \r\n            // Display welcome notification\r\n            this.showSystemWelcomeNotification(systemId, starSystemGenerator);\r\n            \r\n            // If player is docked, make sure the stargate interface is correctly displayed\r\n            if (window.game && window.game.spaceship && window.game.spaceship.isDocked) {\r\n                console.log(\"Player is docked after arriving in new system, showing interface\");\r\n                \r\n                // Handle docking system to enforce proper dock state\r\n                if (window.game.controls && window.game.controls.dockingSystem) {\r\n                    setTimeout(() => {\r\n                        // Trigger the docking system's docking method directly\r\n                        window.game.controls.dockingSystem.dockWithStargate();\r\n                    }, 500); // Small delay to ensure everything is ready\r\n                }\r\n            }\r\n        });\r\n        \r\n        return true;\r\n    }\r\n\r\n    // Update environment visuals and properties for the new system\r\n    updateEnvironmentForSystem(systemId, starSystemGenerator, skybox, sun, planets, asteroidBelt, spaceAnomalies, regionManager) {\r\n        const systemData = starSystemGenerator.getAllSystems()[systemId];\r\n        if (!systemData) {\r\n            console.error(`No system data found for ${systemId}`);\r\n            return;\r\n        }\r\n        \r\n        console.log(`Updating environment for system: ${systemId}`, systemData);\r\n        \r\n        // Update current system ID\r\n        this.currentSystemId = systemId;\r\n        \r\n        // Update skybox based on system properties\r\n        if (skybox && skybox.updateForSystem) {\r\n            // Special case for Solar System - always enforce white skybox\r\n            if (systemId === 'Solar System') {\r\n                const solarSystemParams = {\r\n                    starDensity: 1.0,\r\n                    nebulaDensity: 0.5,\r\n                    color: 0xFFFFFF,  // Ensure white color for Solar System\r\n                    isSolarSystem: true,  // Flag this as Solar System\r\n                    resetTime: true  // Reset the time for consistent appearance\r\n                };\r\n                console.log(`Updating skybox for Solar System with enforced white color`);\r\n                skybox.updateForSystem(solarSystemParams);\r\n            } else {\r\n                console.log(`Updating skybox for ${systemId} with params:`, systemData.skyboxParams);\r\n                skybox.updateForSystem(systemData.skyboxParams);\r\n            }\r\n        } else {\r\n            console.warn(\"Skybox or updateForSystem method not available\");\r\n        }\r\n        \r\n        // Update star (sun) color and properties\r\n        if (sun) {\r\n            // First check if it's a custom system with an intensity multiplier\r\n            const lightIntensityMultiplier = systemData.lightIntensityMultiplier || 1.0;\r\n            \r\n            // Check which update method to use\r\n            if (sun.updateSunType && systemData.starClass) {\r\n                console.log(`Updating sun type for ${systemId} to ${systemData.starClass} with intensity multiplier: ${lightIntensityMultiplier}`);\r\n                sun.updateSunType(systemData.starClass, lightIntensityMultiplier);\r\n            } else if (sun.updateColor) {\r\n                console.log(`Updating sun color for ${systemId} to:`, systemData.starColor.toString(16));\r\n                sun.updateColor(systemData.starColor);\r\n                \r\n                // Store the multiplier for use in the update method\r\n                if (sun.sunLight) {\r\n                    sun.sunLight._intensityMultiplier = lightIntensityMultiplier;\r\n                }\r\n            } else {\r\n                console.warn(\"Sun update methods not available\");\r\n            }\r\n        } else {\r\n            console.warn(\"Sun not available\");\r\n        }\r\n        \r\n        // Update planets for this system\r\n        if (planets && planets.updateForSystem) {\r\n            console.log(`Updating planets for ${systemId}`);\r\n            planets.updateForSystem(systemId);\r\n            \r\n            // Safely update planet regions if the method exists\r\n            if (typeof planets.getPlanetRegions === 'function') {\r\n                try {\r\n                    regionManager.planetRegions = planets.getPlanetRegions();\r\n                } catch (error) {\r\n                    console.warn(`Error getting planet regions for system ${systemId}:`, error);\r\n                }\r\n            } else {\r\n                console.warn(`planets.getPlanetRegions is not available for system ${systemId}`);\r\n            }\r\n        } else {\r\n            console.warn(\"Planets or updateForSystem method not available\");\r\n        }\r\n        \r\n        // Update asteroid belt based on system properties\r\n        if (asteroidBelt) {\r\n            // Dispose of old asteroids before creating new ones\r\n            if (asteroidBelt.dispose) {\r\n                console.log(`Disposing old asteroids before updating for ${systemId}`);\r\n                asteroidBelt.dispose();\r\n            }\r\n            \r\n            // Recreate asteroid belt for new system\r\n            if (asteroidBelt.createAsteroidBelt) {\r\n                console.log(`Creating new asteroids for ${systemId}`);\r\n                asteroidBelt.createAsteroidBelt();\r\n            }\r\n            \r\n            // Apply resource multipliers from system\r\n            if (asteroidBelt.setResourceMultipliers) {\r\n                console.log(`Updating asteroid resources for ${systemId}:`, systemData.resourceMultipliers);\r\n                asteroidBelt.setResourceMultipliers(systemData.resourceMultipliers);\r\n            }\r\n            \r\n            // Update asteroid density if the method exists\r\n            if (asteroidBelt.updateDensity) {\r\n                console.log(`Updating asteroid density for ${systemId}:`, systemData.asteroidDensity);\r\n                asteroidBelt.updateDensity(systemData.asteroidDensity);\r\n            }\r\n        } else {\r\n            console.warn(\"AsteroidBelt not available\");\r\n        }\r\n        \r\n        // Update space anomalies for this system\r\n        if (spaceAnomalies && spaceAnomalies.updateForSystem) {\r\n            console.log(`Updating space anomalies for ${systemId}`);\r\n            spaceAnomalies.updateForSystem(systemData);\r\n        } else {\r\n            console.warn(\"SpaceAnomalies or updateForSystem method not available\");\r\n        }\r\n        \r\n        console.log(`Environment updated for ${systemId}`);\r\n    }\r\n\r\n    // Show welcome notification when arriving at a new system\r\n    showSystemWelcomeNotification(systemId, starSystemGenerator) {\r\n        const system = starSystemGenerator.getAllSystems()[systemId];\r\n        if (!system) return;\r\n        \r\n        // Create welcome notification\r\n        const notification = document.createElement('div');\r\n        notification.style.position = 'fixed';\r\n        notification.style.top = '25%';\r\n        notification.style.left = '50%';\r\n        notification.style.transform = 'translate(-50%, -50%)';\r\n        notification.style.backgroundColor = 'rgba(0, 0, 0, 0.8)';\r\n        notification.style.color = '#fff';\r\n        notification.style.padding = '20px 40px';\r\n        notification.style.borderRadius = '10px';\r\n        notification.style.border = `2px solid #${system.starColor.toString(16).padStart(6, '0')}`;\r\n        notification.style.boxShadow = `0 0 30px #${system.starColor.toString(16).padStart(6, '0')}`;\r\n        notification.style.fontFamily = 'Courier New, monospace';\r\n        notification.style.fontSize = '18px';\r\n        notification.style.zIndex = '9999';\r\n        notification.style.textAlign = 'center';\r\n        \r\n        // Special welcome for Earth/Solar System\r\n        if (systemId === 'Solar System') {\r\n            notification.innerHTML = `\r\n                <h2 style=\"color: #30cfd0; margin-top: 0;\">Welcome to the Solar System</h2>\r\n                <p>Your home system, with Earth as your starting location.</p>\r\n                <p style=\"font-size: 14px; margin-bottom: 0; color: #aaa;\">Safe travels, commander.</p>\r\n            `;\r\n        } else {\r\n            notification.innerHTML = `\r\n                <h2 style=\"color: #${system.starColor.toString(16).padStart(6, '0')}; margin-top: 0;\">Welcome to ${system.name}</h2>\r\n                <p>${system.description}</p>\r\n                <p style=\"font-size: 14px; margin-bottom: 0; color: #aaa;\">Classification: ${system.classification} - Star Class: ${system.starClass}</p>\r\n            `;\r\n        }\r\n        \r\n        // Add to DOM\r\n        document.body.appendChild(notification);\r\n        \r\n        // Remove after a few seconds\r\n        setTimeout(() => {\r\n            notification.style.opacity = '0';\r\n            notification.style.transition = 'opacity 1s';\r\n            \r\n            setTimeout(() => {\r\n                notification.remove();\r\n            }, 1000);\r\n        }, 5000);\r\n    }\r\n\r\n    getCurrentSystemId() {\r\n        return this.currentSystemId;\r\n    }\r\n}","// asteroidBelt.js - Creates and manages the asteroid belt\r\n\r\nimport * as THREE from 'three';\r\n\r\nexport class AsteroidBelt {\r\n    constructor(scene) {\r\n        this.scene = scene;\r\n        this.asteroids = [];\r\n        this.innerRadius = 20000;\r\n        this.outerRadius = 28000;\r\n        this.width = 1800;\r\n        this.resourceMultipliers = { iron: 1.0, gold: 1.0, platinum: 1.0 };\r\n        \r\n        this.createAsteroidBelt();\r\n    }\r\n    \r\n    createAsteroidBelt() {\r\n        const asteroidCount = 1000;\r\n        \r\n        for (let i = 0; i < asteroidCount; i++) {\r\n            // Random asteroid size - Much larger for better visibility\r\n            const size = Math.random() * 120 + 120; // Dramatically increased size for visibility\r\n            \r\n            // Use different geometries for variety\r\n            let geometry;\r\n            const type = Math.floor(Math.random() * 3);\r\n            if (type === 0) {\r\n                geometry = new THREE.IcosahedronGeometry(size, 0);\r\n            } else if (type === 1) {\r\n                geometry = new THREE.TetrahedronGeometry(size, 0);\r\n            } else {\r\n                geometry = new THREE.OctahedronGeometry(size, 0);\r\n            }\r\n            \r\n            // Deform the geometry to make it look more like an asteroid\r\n            const positions = geometry.attributes.position;\r\n            for (let j = 0; j < positions.count; j++) {\r\n                const vertex = new THREE.Vector3();\r\n                vertex.fromBufferAttribute(positions, j);\r\n                \r\n                // Add some random bumps\r\n                vertex.x += (Math.random() - 0.5) * 0.4 * size;\r\n                vertex.y += (Math.random() - 0.5) * 0.4 * size;\r\n                vertex.z += (Math.random() - 0.5) * 0.4 * size;\r\n                \r\n                positions.setXYZ(j, vertex.x, vertex.y, vertex.z);\r\n            }\r\n            \r\n            // Update geometry\r\n            geometry.computeVertexNormals();\r\n            \r\n            // Material with different color variations - brighter for better visibility\r\n            const color = new THREE.Color();\r\n            const resourceRoll = Math.random();\r\n            let resourceType = null;\r\n            \r\n            // Determine resource type based on probability\r\n            if (resourceRoll < 0.7) {\r\n                // 70% iron asteroids (common) - brightened\r\n                color.setHSL(0.02, 0.30, 0.35 + Math.random() * 0.2); // Much brighter\r\n                resourceType = 'iron';\r\n            } else if (resourceRoll < 0.93) {\r\n                // 23% gold asteroids (uncommon) - brightened\r\n                color.setHSL(0.12, 0.7, 0.5 + Math.random() * 0.2); // Much brighter\r\n                resourceType = 'gold';\r\n            } else {\r\n                // 7% platinum asteroids (rare) - brightened\r\n                color.setHSL(0.1, 0.3, 0.7 + Math.random() * 0.15); // Much brighter\r\n                resourceType = 'platinum';\r\n            }\r\n            \r\n            // Enhanced material with higher emissive properties for better visibility\r\n            const material = new THREE.MeshStandardMaterial({\r\n                color: color,\r\n                roughness: 0.6 + Math.random() * 0.2, // Reduced roughness\r\n                metalness: 0.4 + Math.random() * 0.4, // Increased metalness\r\n                flatShading: true,\r\n                emissive: color.clone().multiplyScalar(0.3), // Add emissive glow\r\n                emissiveIntensity: 0.2 // Subtle glow for better visibility\r\n            });\r\n            \r\n            // Create the mesh\r\n            const mesh = new THREE.Mesh(geometry, material);\r\n            \r\n            // Position in asteroid belt with variation using torus pattern\r\n            const angle = Math.random() * Math.PI * 2;\r\n            const radius = this.innerRadius + Math.random() * (this.outerRadius - this.innerRadius);\r\n            const heightVariation = (Math.random() - 0.5) * this.width;\r\n            \r\n            mesh.position.set(\r\n                Math.cos(angle) * radius,\r\n                heightVariation,\r\n                Math.sin(angle) * radius\r\n            );\r\n            \r\n            // Apply random axial tilt (rotation on local axis)\r\n            mesh.rotation.set(\r\n                Math.random() * Math.PI,\r\n                Math.random() * Math.PI,\r\n                Math.random() * Math.PI\r\n            );\r\n            \r\n            // Setup orbital parameters\r\n            const orbitSpeed = 0.00005 + Math.random() * 0.00005; // Realistic asteroid orbital speed\r\n            const orbitRadius = radius; // Use initial radius\r\n            \r\n            // Add random orbital tilt\r\n            const orbitTilt = Math.random() * Math.PI * 0.15; // Reduced to ~27 degrees max tilt\r\n            \r\n            // Add to scene\r\n            this.scene.add(mesh);\r\n            \r\n            // Add to asteroids array with metadata\r\n            const baseResourceAmount = 50 + Math.random() * 50; // Base amount before multipliers\r\n            this.asteroids.push({\r\n                mesh: mesh,\r\n                size: size,\r\n                orbitSpeed: orbitSpeed,\r\n                orbitRadius: orbitRadius,\r\n                orbitAngle: angle,\r\n                orbitTilt: orbitTilt,\r\n                initialHeight: heightVariation, // Store initial height variation\r\n                rotationSpeed: {\r\n                    x: (Math.random() - 0.5) * 0.005,\r\n                    y: (Math.random() - 0.5) * 0.005,\r\n                    z: (Math.random() - 0.5) * 0.005\r\n                },\r\n                resourceType: resourceType,\r\n                baseResourceAmount: baseResourceAmount, // Base amount\r\n                resourceAmount: baseResourceAmount, // Current amount\r\n                maxResourceAmount: baseResourceAmount, // Max capacity\r\n                minable: true\r\n            });\r\n        }\r\n    }\r\n    \r\n    getRegionInfo() {\r\n        return {\r\n            center: new THREE.Vector3(0, 0, 0),\r\n            innerRadius: this.innerRadius,\r\n            outerRadius: this.outerRadius\r\n        };\r\n    }\r\n    \r\n    getAsteroids() {\r\n        return this.asteroids;\r\n    }\r\n    \r\n    // Set resource multipliers based on the current star system\r\n    setResourceMultipliers(multipliers) {\r\n        if (!multipliers) return;\r\n        this.resourceMultipliers = multipliers;\r\n        \r\n        // Update existing asteroids with new resource distributions\r\n        this.updateAsteroidResources();\r\n        console.log(\"Updated asteroid belt with resource multipliers:\", multipliers);\r\n    }\r\n    \r\n    // Update asteroid resources based on current system\r\n    updateAsteroidResources() {\r\n        this.asteroids.forEach(asteroid => {\r\n            if (asteroid.resourceType) {\r\n                // Apply system-specific multipliers to resource amounts\r\n                switch (asteroid.resourceType) {\r\n                    case 'iron':\r\n                        asteroid.resourceAmount = asteroid.baseResourceAmount * this.resourceMultipliers.iron;\r\n                        break;\r\n                    case 'gold':\r\n                        asteroid.resourceAmount = asteroid.baseResourceAmount * this.resourceMultipliers.gold;\r\n                        break;\r\n                    case 'platinum':\r\n                        asteroid.resourceAmount = asteroid.baseResourceAmount * this.resourceMultipliers.platinum;\r\n                        break;\r\n                }\r\n            }\r\n        });\r\n    }\r\n    \r\n    // Update asteroid density based on system characteristics\r\n    updateForSystem(params) {\r\n        if (!params) return;\r\n        \r\n        // Update density if provided\r\n        if (params.asteroidDensity) {\r\n            this.updateDensity(params.asteroidDensity);\r\n        }\r\n        \r\n        // Update resource distribution if provided\r\n        if (params.resourceMultipliers) {\r\n            this.setResourceMultipliers(params.resourceMultipliers);\r\n        }\r\n    }\r\n    \r\n    // Update asteroid density\r\n    updateDensity(densityMultiplier = 1.0) {\r\n        if (densityMultiplier < 0.5) densityMultiplier = 0.5; // Minimum density\r\n        if (densityMultiplier > 3.0) densityMultiplier = 3.0; // Maximum density\r\n        \r\n        // Adjust asteroid visibility based on density\r\n        this.asteroids.forEach((asteroid, index) => {\r\n            // Use index to ensure consistent visibility\r\n            const shouldBeVisible = (index % 10) < (densityMultiplier * 5);\r\n            asteroid.mesh.visible = shouldBeVisible;\r\n            // Also update the minable flag to prevent targeting invisible asteroids\r\n            asteroid.minable = shouldBeVisible;\r\n        });\r\n    }\r\n    \r\n    // Helper function to find the closest asteroid to a point (for mining)\r\n    findClosestAsteroid(position, maxDistance = 1600) {\r\n        let closestAsteroid = null;\r\n        let closestDistance = maxDistance;\r\n        \r\n        this.asteroids.forEach(asteroid => {\r\n            // Skip asteroids that aren't minable or visible\r\n            if (!asteroid.minable || !asteroid.mesh.visible) return;\r\n            \r\n            const distance = position.distanceTo(asteroid.mesh.position);\r\n            if (distance < closestDistance) {\r\n                closestDistance = distance;\r\n                closestAsteroid = asteroid;\r\n            }\r\n        });\r\n        \r\n        return closestAsteroid;\r\n    }\r\n    \r\n    removeAsteroid(asteroid) {\r\n        // Remove the asteroid from the scene\r\n        this.scene.remove(asteroid.mesh);\r\n        \r\n        // Properly dispose of geometry and material to prevent memory leaks\r\n        if (asteroid.mesh.geometry) {\r\n            asteroid.mesh.geometry.dispose();\r\n        }\r\n        \r\n        if (asteroid.mesh.material) {\r\n            // Dispose of textures if they exist\r\n            if (asteroid.mesh.material.map) asteroid.mesh.material.map.dispose();\r\n            if (asteroid.mesh.material.emissiveMap) asteroid.mesh.material.emissiveMap.dispose();\r\n            if (asteroid.mesh.material.normalMap) asteroid.mesh.material.normalMap.dispose();\r\n            if (asteroid.mesh.material.roughnessMap) asteroid.mesh.material.roughnessMap.dispose();\r\n            if (asteroid.mesh.material.metalnessMap) asteroid.mesh.material.metalnessMap.dispose();\r\n            asteroid.mesh.material.dispose();\r\n        }\r\n        \r\n        // Remove from asteroid array\r\n        const index = this.asteroids.findIndex(a => a === asteroid);\r\n        if (index !== -1) {\r\n            this.asteroids.splice(index, 1);\r\n        }\r\n    }\r\n    \r\n    update(deltaTime = 0.016) {\r\n        \r\n        // Update asteroid positions and rotations with orbital tilt\r\n        this.asteroids.forEach(asteroid => {\r\n            // Rotate the asteroid (axial rotation)\r\n            asteroid.mesh.rotation.x += asteroid.rotationSpeed.x;\r\n            asteroid.mesh.rotation.y += asteroid.rotationSpeed.y;\r\n            asteroid.mesh.rotation.z += asteroid.rotationSpeed.z;\r\n            \r\n            // Orbit around sun with tilt\r\n            asteroid.orbitAngle += asteroid.orbitSpeed;\r\n            \r\n            // Calculate orbit position with tilt\r\n            const flatX = Math.cos(asteroid.orbitAngle) * asteroid.orbitRadius;\r\n            const flatZ = Math.sin(asteroid.orbitAngle) * asteroid.orbitRadius;\r\n            \r\n            // Apply orbit tilt if it exists\r\n            if (asteroid.orbitTilt) {\r\n                // Apply orbital tilt by rotating the position around the X axis\r\n                const tiltY = flatZ * Math.sin(asteroid.orbitTilt);\r\n                const tiltZ = flatZ * Math.cos(asteroid.orbitTilt);\r\n                \r\n                asteroid.mesh.position.x = flatX;\r\n                asteroid.mesh.position.z = tiltZ;\r\n                asteroid.mesh.position.y = tiltY + asteroid.initialHeight; // Use stored initial height variation\r\n            } else {\r\n                // Regular orbit\r\n                asteroid.mesh.position.x = flatX;\r\n                asteroid.mesh.position.z = flatZ;\r\n                asteroid.mesh.position.y = asteroid.initialHeight;\r\n            }\r\n        });\r\n    }\r\n    \r\n    // Clean up all asteroids (for system transitions)\r\n    dispose() {\r\n        // Remove and dispose of all asteroids\r\n        while (this.asteroids.length > 0) {\r\n            const asteroid = this.asteroids[0];\r\n            this.removeAsteroid(asteroid);\r\n        }\r\n        \r\n        // Clear the array completely\r\n        this.asteroids = [];\r\n    }\r\n}","// systemTransition.js - Handles the visual transition between star systems\r\n\r\nimport * as THREE from 'three';\r\n\r\nexport class SystemTransition {\r\n    constructor(scene, camera) {\r\n        this.scene = scene;\r\n        this.camera = camera;\r\n        this.isTransitioning = false;\r\n        this.transitionDuration = 3000; // milliseconds\r\n        this.onTransitionComplete = null;\r\n        \r\n        // Create transition elements\r\n        this.setupTransitionElements();\r\n    }\r\n    \r\n    setupTransitionElements() {\r\n        // Warp tunnel effect\r\n        this.warpTunnel = new THREE.Points(\r\n            new THREE.BufferGeometry(),\r\n            new THREE.PointsMaterial({\r\n                color: 0x30cfd0,\r\n                size: 2,\r\n                blending: THREE.AdditiveBlending,\r\n                transparent: true,\r\n                sizeAttenuation: true\r\n            })\r\n        );\r\n        \r\n        // Create particles for warp effect\r\n        this.createWarpParticles();\r\n        \r\n        // Flash overlay for transition effect\r\n        this.createOverlay();\r\n    }\r\n    \r\n    createWarpParticles() {\r\n        // Number of particles\r\n        const particleCount = 2000;\r\n        \r\n        // Create position array\r\n        const positions = new Float32Array(particleCount * 3);\r\n        \r\n        // Initialize particle positions in a tunnel shape\r\n        for (let i = 0; i < particleCount; i++) {\r\n            const i3 = i * 3;\r\n            \r\n            // Polar coordinates for tunnel shape\r\n            const radius = 50 + Math.random() * 50;\r\n            const theta = Math.random() * Math.PI * 2;\r\n            const length = -500 - Math.random() * 3000; // Negative z is forward\r\n            \r\n            // Convert to Cartesian\r\n            positions[i3] = radius * Math.cos(theta);     // x\r\n            positions[i3 + 1] = radius * Math.sin(theta); // y\r\n            positions[i3 + 2] = length;                   // z\r\n        }\r\n        \r\n        // Add to buffer geometry\r\n        this.warpTunnel.geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));\r\n        \r\n        // Store original positions for resetting\r\n        this.originalPositions = new Float32Array(positions);\r\n    }\r\n    \r\n    createOverlay() {\r\n        // Create a DOM overlay for the flash effect\r\n        this.overlay = document.createElement('div');\r\n        this.overlay.id = 'warp-overlay';\r\n        this.overlay.style.position = 'fixed';\r\n        this.overlay.style.top = '0';\r\n        this.overlay.style.left = '0';\r\n        this.overlay.style.width = '100%';\r\n        this.overlay.style.height = '100%';\r\n        this.overlay.style.backgroundColor = '#30cfd0';\r\n        this.overlay.style.opacity = '0';\r\n        this.overlay.style.transition = 'opacity 0.5s';\r\n        this.overlay.style.pointerEvents = 'none';\r\n        this.overlay.style.zIndex = '9999';\r\n        \r\n        // Add to DOM but hide initially\r\n        document.body.appendChild(this.overlay);\r\n    }\r\n    \r\n    // Start a transition between systems\r\n    startTransition(onComplete) {\r\n        if (this.isTransitioning) return;\r\n        \r\n        console.log(\"Starting system transition...\");\r\n        this.isTransitioning = true;\r\n        \r\n        // Store callback\r\n        this.onTransitionComplete = onComplete;\r\n        \r\n        // Add warp tunnel to scene\r\n        this.scene.add(this.warpTunnel);\r\n        \r\n        // Position the camera for the transition\r\n        this.initialCameraPosition = this.camera.position.clone();\r\n        this.initialCameraRotation = this.camera.rotation.clone();\r\n        \r\n        // Start transition animation\r\n        this.startTime = Date.now();\r\n        \r\n        // Show overlay\r\n        this.showOverlay();\r\n        \r\n        // Start animation\r\n        this.animate();\r\n    }\r\n    \r\n    // Animation loop for transition\r\n    animate() {\r\n        if (!this.isTransitioning) return;\r\n        \r\n        const currentTime = Date.now();\r\n        const elapsed = currentTime - this.startTime;\r\n        const progress = Math.min(elapsed / this.transitionDuration, 1.0);\r\n        \r\n        // Update warp effect\r\n        this.updateWarpEffect(progress);\r\n        \r\n        // Check if transition is complete\r\n        if (progress >= 1.0) {\r\n            this.completeTransition();\r\n            return;\r\n        }\r\n        \r\n        // Continue animation\r\n        requestAnimationFrame(this.animate.bind(this));\r\n    }\r\n    \r\n    // Update warp tunnel effect\r\n    updateWarpEffect(progress) {\r\n        // Get positions\r\n        const positions = this.warpTunnel.geometry.attributes.position.array;\r\n        \r\n        // Adjust warp speed based on progress\r\n        const warpSpeed = 3 + progress * 20;\r\n        \r\n        // Update particle positions\r\n        for (let i = 0; i < positions.length; i += 3) {\r\n            // Move particles toward camera\r\n            positions[i + 2] += warpSpeed; // z value\r\n            \r\n            // Reset particles that go past the camera\r\n            if (positions[i + 2] > 100) {\r\n                // Reset to original position with an offset to create continuous tunnel\r\n                positions[i] = this.originalPositions[i];\r\n                positions[i + 1] = this.originalPositions[i + 1];\r\n                positions[i + 2] = this.originalPositions[i + 2] - 500; // Return to end of tunnel\r\n            }\r\n        }\r\n        \r\n        // Update buffer geometry\r\n        this.warpTunnel.geometry.attributes.position.needsUpdate = true;\r\n        \r\n        // Update camera animation - slight movement to enhance effect\r\n        if (this.camera) {\r\n            this.camera.rotation.z += 0.0005 * Math.sin(progress * Math.PI);\r\n        }\r\n    }\r\n    \r\n    // Show overlay with flash effect\r\n    showOverlay() {\r\n        if (!this.overlay) return;\r\n        \r\n        // Start with low opacity\r\n        this.overlay.style.opacity = '0.2';\r\n        \r\n        // Schedule flash toward end of transition\r\n        setTimeout(() => {\r\n            this.overlay.style.opacity = '1';\r\n            \r\n            // Fade out after flash\r\n            setTimeout(() => {\r\n                this.overlay.style.opacity = '0';\r\n            }, 500);\r\n        }, this.transitionDuration - 1000);\r\n    }\r\n    \r\n    // Complete the transition\r\n    completeTransition() {\r\n        console.log(\"System transition complete\");\r\n        this.isTransitioning = false;\r\n        \r\n        // Remove warp tunnel from scene\r\n        this.scene.remove(this.warpTunnel);\r\n        \r\n        // Reset camera position and rotation\r\n        if (this.camera && this.initialCameraPosition && this.initialCameraRotation) {\r\n            this.camera.position.copy(this.initialCameraPosition);\r\n            this.camera.rotation.copy(this.initialCameraRotation);\r\n        }\r\n        \r\n        // Call completion callback if provided\r\n        if (this.onTransitionComplete && typeof this.onTransitionComplete === 'function') {\r\n            // Use setTimeout to make sure this executes after the animation frame\r\n            setTimeout(() => {\r\n                console.log(\"Executing transition completion callback\");\r\n                this.onTransitionComplete();\r\n            }, 100);\r\n        }\r\n    }\r\n}","// apiClient.js - Client for interacting with the skybox generation API\r\n\r\nexport class ApiClient {\r\n    constructor() {\r\n        // API configuration\r\n        this.apiBaseUrl = this.getApiBaseUrl();\r\n        \r\n        // In-memory token storage (no localStorage)\r\n        this.token = null;\r\n        this.tokenExpiry = null;\r\n        \r\n        // Default client ID\r\n        this.clientId = 'game_client';\r\n        \r\n        // For token refresh\r\n        this.isRefreshing = false;\r\n        this.refreshCallbacks = [];\r\n        \r\n        console.log(`API Client initialized with base URL: ${this.apiBaseUrl}`);\r\n    }\r\n    \r\n    // Get base URL from environment or use default\r\n    getApiBaseUrl() {\r\n        // For local development\r\n        if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {\r\n            return 'http://localhost:8001';\r\n        }\r\n        \r\n        // For production - Use the Heroku app URL\r\n        return 'https://aminer-skybox-generator-833fe937a945.herokuapp.com';\r\n    }\r\n    \r\n    // Check if token is valid and not expired\r\n    hasValidToken() {\r\n        if (!this.token || !this.tokenExpiry) {\r\n            return false;\r\n        }\r\n        \r\n        const expiryTime = new Date(this.tokenExpiry).getTime();\r\n        const currentTime = new Date().getTime();\r\n        \r\n        // Consider token expired if less than 5 minutes remain\r\n        const fiveMinutesInMs = 5 * 60 * 1000;\r\n        return (expiryTime - currentTime) > fiveMinutesInMs;\r\n    }\r\n    \r\n    // Clear token from memory\r\n    clearToken() {\r\n        this.token = null;\r\n        this.tokenExpiry = null;\r\n    }\r\n    \r\n    // Get a new token from the API\r\n    async getToken() {\r\n        // Prevent multiple simultaneous refresh attempts\r\n        if (this.isRefreshing) {\r\n            return new Promise((resolve) => {\r\n                this.refreshCallbacks.push((success) => resolve(success));\r\n            });\r\n        }\r\n        \r\n        this.isRefreshing = true;\r\n        \r\n        try {\r\n            const response = await fetch(`${this.apiBaseUrl}/token`, {\r\n                method: 'POST',\r\n                headers: {\r\n                    'Content-Type': 'application/json'\r\n                },\r\n                body: JSON.stringify({ client_id: this.clientId })\r\n            });\r\n            \r\n            if (!response.ok) {\r\n                const errorData = await response.json();\r\n                const errorMessage = errorData.detail || 'Failed to get token';\r\n                console.error(`Token error (${response.status}): ${errorMessage}`);\r\n                \r\n                // Execute callbacks with failure\r\n                this.refreshCallbacks.forEach(cb => cb(false));\r\n                this.refreshCallbacks = [];\r\n                this.isRefreshing = false;\r\n                \r\n                throw new Error(errorMessage);\r\n            }\r\n            \r\n            const data = await response.json();\r\n            \r\n            // Save token in memory\r\n            this.token = data.access_token;\r\n            \r\n            // Set expiry (tokens are valid for 1 hour)\r\n            const expiryDate = new Date();\r\n            expiryDate.setHours(expiryDate.getHours() + 1);\r\n            this.tokenExpiry = expiryDate.toISOString();\r\n            \r\n            // Execute callbacks with success\r\n            this.refreshCallbacks.forEach(cb => cb(true));\r\n            this.refreshCallbacks = [];\r\n            this.isRefreshing = false;\r\n            \r\n            return true;\r\n        } catch (error) {\r\n            console.error('Error getting token:', error);\r\n            \r\n            // Execute callbacks with failure\r\n            this.refreshCallbacks.forEach(cb => cb(false));\r\n            this.refreshCallbacks = [];\r\n            this.isRefreshing = false;\r\n            \r\n            return false;\r\n        }\r\n    }\r\n    \r\n    // Handle API response errors\r\n    async handleApiResponse(response) {\r\n        if (response.status === 401) {\r\n            // Token has expired or is invalid\r\n            this.clearToken();\r\n            \r\n            // Try to get a new token and retry the request\r\n            const success = await this.getToken();\r\n            if (!success) {\r\n                throw new Error('Authentication failed. Please reload the application.');\r\n            }\r\n            \r\n            // Return false to indicate a retry is needed\r\n            return false;\r\n        }\r\n        \r\n        if (response.status === 429) {\r\n            // Rate limit exceeded\r\n            throw new Error('Rate limit exceeded. Please try again later.');\r\n        }\r\n        \r\n        if (!response.ok) {\r\n            const errorData = await response.json();\r\n            throw new Error(errorData.message || errorData.detail || `Error: ${response.status} ${response.statusText}`);\r\n        }\r\n        \r\n        // Return true to indicate success\r\n        return true;\r\n    }\r\n    \r\n    // Generate a skybox based on the system name and description\r\n    async generateSkybox(systemName, description) {\r\n        // Get a new token if current one is invalid\r\n        if (!this.hasValidToken()) {\r\n            const success = await this.getToken();\r\n            if (!success) {\r\n                throw new Error('Failed to authenticate with the API');\r\n            }\r\n        }\r\n        \r\n        // Make request to generate skybox\r\n        const response = await fetch(`${this.apiBaseUrl}/generate-skybox`, {\r\n            method: 'POST',\r\n            headers: {\r\n                'Content-Type': 'application/json',\r\n                'Authorization': `Bearer ${this.token}`\r\n            },\r\n            body: JSON.stringify({\r\n                system_name: systemName,\r\n                skybox_description: description\r\n            })\r\n        });\r\n        \r\n        // Handle response errors\r\n        const isValid = await this.handleApiResponse(response);\r\n        if (!isValid) {\r\n            // Retry the request with the new token\r\n            return this.generateSkybox(systemName, description);\r\n        }\r\n        \r\n        return await response.json();\r\n    }\r\n    \r\n    // Generate a planet texture based on the planet name and description\r\n    async generatePlanet(planetName, description) {\r\n        // Get a new token if current one is invalid\r\n        if (!this.hasValidToken()) {\r\n            const success = await this.getToken();\r\n            if (!success) {\r\n                throw new Error('Failed to authenticate with the API');\r\n            }\r\n        }\r\n        \r\n        // Make request to generate planet\r\n        const response = await fetch(`${this.apiBaseUrl}/generate-planet`, {\r\n            method: 'POST',\r\n            headers: {\r\n                'Content-Type': 'application/json',\r\n                'Authorization': `Bearer ${this.token}`\r\n            },\r\n            body: JSON.stringify({\r\n                planet_name: planetName,\r\n                planet_description: description\r\n            })\r\n        });\r\n        \r\n        // Handle response errors\r\n        const isValid = await this.handleApiResponse(response);\r\n        if (!isValid) {\r\n            // Retry the request with the new token\r\n            return this.generatePlanet(planetName, description);\r\n        }\r\n        \r\n        return await response.json();\r\n    }\r\n    \r\n    // Convert a relative image path to a full URL\r\n    getFullImageUrl(relativeUrl) {\r\n        // If it's already a full URL, return as is\r\n        if (relativeUrl.startsWith('http')) {\r\n            return relativeUrl;\r\n        }\r\n        \r\n        // Remove leading slash if present\r\n        const cleanPath = relativeUrl.startsWith('/') ? relativeUrl.substring(1) : relativeUrl;\r\n        \r\n        // Get the API base URL\r\n        const baseUrl = this.apiBaseUrl;\r\n        \r\n        // Join with API base URL\r\n        return `${baseUrl}/${cleanPath}`;\r\n    }\r\n} ","// styles.js - CSS styles for the custom system creator\r\n\r\nexport class StyleManager {\r\n    constructor(isMobile = false) {\r\n        this.isMobile = isMobile;\r\n        this.stylesInjected = false;\r\n    }\r\n\r\n    injectStyles() {\r\n        if (this.stylesInjected) return;\r\n\r\n        this.injectBaseStyles();\r\n        \r\n        if (this.isMobile) {\r\n            this.injectMobileStyles();\r\n        }\r\n\r\n        this.stylesInjected = true;\r\n    }\r\n\r\n    injectBaseStyles() {\r\n        if (!document.getElementById('custom-system-creator-styles')) {\r\n            const style = document.createElement('style');\r\n            style.id = 'custom-system-creator-styles';\r\n            style.textContent = `\r\n                .property-row {\r\n                    display: flex;\r\n                    align-items: center;\r\n                    margin-bottom: 10px;\r\n                }\r\n                \r\n                .property-row label {\r\n                    flex: 0 0 150px;\r\n                    margin-right: 10px;\r\n                }\r\n                \r\n                .property-row .slider {\r\n                    flex: 1;\r\n                    height: 10px;\r\n                    background: #2a2a2a;\r\n                    outline: none;\r\n                    border-radius: 5px;\r\n                }\r\n                \r\n                .property-row .slider-value {\r\n                    flex: 0 0 60px;\r\n                    margin-left: 10px;\r\n                    text-align: right;\r\n                }\r\n                \r\n                .planet-properties {\r\n                    background: rgba(0, 0, 0, 0.2);\r\n                    padding: 15px;\r\n                    border-radius: 5px;\r\n                    margin-top: 10px;\r\n                    margin-bottom: 15px;\r\n                }\r\n                \r\n                .help-text {\r\n                    font-size: 12px;\r\n                    color: #aaa;\r\n                    margin-top: 5px;\r\n                }\r\n                \r\n                select.form-control {\r\n                    width: 100%;\r\n                    padding: 8px;\r\n                    border-radius: 4px;\r\n                    background: #25303e;\r\n                    color: white;\r\n                    border: 1px solid #3a5472;\r\n                }\r\n                \r\n                /* Active slider styles */\r\n                .slider-active {\r\n                    background: #3a5472 !important;\r\n                }\r\n                \r\n                /* Add smooth transitions */\r\n                #custom-system-creator button {\r\n                    transition: all 0.2s ease;\r\n                }\r\n                \r\n                #custom-system-creator button:active {\r\n                    transform: scale(0.95);\r\n                }\r\n\r\n                /* Modal open styles */\r\n                .modal-open {\r\n                    overflow: hidden;\r\n                    position: fixed;\r\n                    width: 100%;\r\n                    height: 100%;\r\n                }\r\n            `;\r\n            document.head.appendChild(style);\r\n        }\r\n    }\r\n\r\n    injectMobileStyles() {\r\n        if (!document.getElementById('custom-system-creator-mobile-styles')) {\r\n            const style = document.createElement('style');\r\n            style.id = 'custom-system-creator-mobile-styles';\r\n            style.innerHTML = `\r\n                @media (max-width: 900px) {\r\n                    /* Mobile-specific styles for CustomSystemCreator */\r\n                    #custom-system-creator .modal-content {\r\n                        border-radius: 10px;\r\n                        padding-bottom: 120px;\r\n                    }\r\n                    \r\n                    #custom-system-creator .form-group {\r\n                        margin-bottom: 24px;\r\n                    }\r\n                    \r\n                    #custom-system-creator label {\r\n                        font-size: 16px;\r\n                        margin-bottom: 10px;\r\n                        display: block;\r\n                    }\r\n                    \r\n                    #custom-system-creator .property-row {\r\n                        flex-direction: column;\r\n                        align-items: flex-start;\r\n                        margin-bottom: 20px;\r\n                    }\r\n                    \r\n                    #custom-system-creator .property-row label {\r\n                        margin-bottom: 10px;\r\n                        width: 100%;\r\n                    }\r\n                    \r\n                    #custom-system-creator .slider {\r\n                        width: 100%;\r\n                        margin: 10px 0;\r\n                    }\r\n                    \r\n                    #custom-system-creator .slider-value {\r\n                        margin-top: 5px;\r\n                        align-self: flex-end;\r\n                    }\r\n                    \r\n                    #custom-system-creator .planet-input {\r\n                        padding: 20px;\r\n                        margin-bottom: 30px;\r\n                    }\r\n                    \r\n                    #custom-system-creator input[type=\"text\"],\r\n                    #custom-system-creator textarea,\r\n                    #custom-system-creator select {\r\n                        font-size: 16px !important;\r\n                        padding: 14px !important;\r\n                    }\r\n                    \r\n                    #custom-system-creator .planet-preview {\r\n                        flex: 0 0 100%;\r\n                        margin-bottom: 15px;\r\n                    }\r\n                    \r\n                    #custom-system-creator .form-actions {\r\n                        text-align: center;\r\n                    }\r\n                    \r\n                    /* Better slider for touch */\r\n                    #custom-system-creator input[type=\"range\"] {\r\n                        -webkit-appearance: none;\r\n                        height: 30px;\r\n                        background: #0d1e2f;\r\n                        border-radius: 15px;\r\n                        padding: 0;\r\n                        outline: none;\r\n                    }\r\n                    \r\n                    #custom-system-creator input[type=\"range\"]::-webkit-slider-thumb {\r\n                        -webkit-appearance: none;\r\n                        width: 30px;\r\n                        height: 30px;\r\n                        border-radius: 50%;\r\n                        background: #4a9dff;\r\n                        cursor: pointer;\r\n                    }\r\n                    \r\n                    #custom-system-creator input[type=\"range\"]::-moz-range-thumb {\r\n                        width: 30px;\r\n                        height: 30px;\r\n                        border-radius: 50%;\r\n                        background: #4a9dff;\r\n                        cursor: pointer;\r\n                        border: none;\r\n                    }\r\n                    \r\n                    /* Touch ripple effect for buttons */\r\n                    .ripple {\r\n                        position: relative;\r\n                        overflow: hidden;\r\n                        transform: translate3d(0, 0, 0);\r\n                    }\r\n                    \r\n                    .ripple:after {\r\n                        content: \"\";\r\n                        display: block;\r\n                        position: absolute;\r\n                        width: 100%;\r\n                        height: 100%;\r\n                        top: 0;\r\n                        left: 0;\r\n                        pointer-events: none;\r\n                        background-image: radial-gradient(circle, #fff 10%, transparent 10.01%);\r\n                        background-repeat: no-repeat;\r\n                        background-position: 50%;\r\n                        transform: scale(10, 10);\r\n                        opacity: 0;\r\n                        transition: transform .5s, opacity 1s;\r\n                    }\r\n                    \r\n                    .ripple:active:after {\r\n                        transform: scale(0, 0);\r\n                        opacity: .3;\r\n                        transition: 0s;\r\n                    }\r\n                    \r\n                    /* Character counter for text areas */\r\n                    .char-counter {\r\n                        font-size: 12px;\r\n                        color: #aaa;\r\n                        text-align: right;\r\n                        margin-top: 5px;\r\n                    }\r\n                    \r\n                    .char-counter.warning {\r\n                        color: #ff9900;\r\n                    }\r\n                    \r\n                    .char-counter.error {\r\n                        color: #ff3030;\r\n                    }\r\n                }\r\n            `;\r\n            document.head.appendChild(style);\r\n        }\r\n    }\r\n\r\n    getMobileStyles(type = '') {\r\n        const styles = {\r\n            modalContent: this.isMobile ? 'width: 94%; max-height: 85vh; overflow-y: auto; -webkit-overflow-scrolling: touch; padding-bottom: 100px; overscroll-behavior: contain;' : '',\r\n            closeBtn: this.isMobile ? 'font-size: 28px; padding: 12px; min-height: 48px; min-width: 48px;' : '',\r\n            modalBody: this.isMobile ? 'padding-bottom: 150px;' : '',\r\n            input: this.isMobile ? 'font-size: 16px; padding: 14px; height: 48px;' : '',\r\n            textarea: this.isMobile ? 'font-size: 16px; padding: 14px;' : '',\r\n            select: this.isMobile ? 'font-size: 16px; padding: 14px; height: 48px;' : '',\r\n            slider: this.isMobile ? 'height: 30px; margin: 10px 0;' : '',\r\n            checkbox: this.isMobile ? 'transform: scale(1.7); margin: 0 15px; min-height: 24px; min-width: 24px;' : '',\r\n            checkboxRow: this.isMobile ? 'margin-top: 15px;' : '',\r\n            primaryBtn: this.isMobile ? 'min-height: 54px; padding: 16px; font-size: 18px; margin-top: 20px; width: 100%;' : '',\r\n            secondaryBtn: this.isMobile ? 'min-height: 50px; padding: 14px; font-size: 16px; width: 100%; margin: 15px 0;' : '',\r\n            removeBtn: this.isMobile ? 'min-height: 50px; padding: 14px; font-size: 16px; right: 15px; top: 15px;' : '',\r\n            previewContainer: this.isMobile ? 'flex-direction: column;' : '',\r\n            skyboxPreview: this.isMobile ? 'width: 100%; margin-bottom: 20px;' : '',\r\n            planetsPreview: this.isMobile ? 'width: 100%;' : '',\r\n            formActions: this.isMobile ? 'padding-bottom: 30px;' : ''\r\n        };\r\n\r\n        return type ? styles[type] : styles;\r\n    }\r\n\r\n    getTextareaRows(defaultRows) {\r\n        return this.isMobile ? Math.max(2, defaultRows - 1) : defaultRows;\r\n    }\r\n\r\n    cleanup() {\r\n        const stylesToRemove = [\r\n            'custom-system-creator-styles',\r\n            'custom-system-creator-mobile-styles',\r\n            'modal-open-style'\r\n        ];\r\n\r\n        stylesToRemove.forEach(id => {\r\n            const style = document.getElementById(id);\r\n            if (style) {\r\n                style.remove();\r\n            }\r\n        });\r\n\r\n        this.stylesInjected = false;\r\n    }\r\n}","// validation.js - Form validation, constraints, error handling\r\n\r\nexport class ValidationManager {\r\n    constructor(isMobile = false) {\r\n        this.isMobile = isMobile;\r\n    }\r\n\r\n    validateSystemForm(systemNameInput, skyboxDescription) {\r\n        const systemName = systemNameInput.value.trim();\r\n        const skyboxDesc = skyboxDescription.value.trim();\r\n\r\n        if (!systemName) {\r\n            return { isValid: false, message: 'Please enter a system name.' };\r\n        }\r\n\r\n        if (!skyboxDesc) {\r\n            return { isValid: false, message: 'Please enter a skybox description.' };\r\n        }\r\n\r\n        if (systemName.length < 3) {\r\n            return { isValid: false, message: 'System name must be at least 3 characters long.' };\r\n        }\r\n\r\n        if (skyboxDesc.length < 10) {\r\n            return { isValid: false, message: 'Skybox description must be at least 10 characters long.' };\r\n        }\r\n\r\n        return { isValid: true };\r\n    }\r\n\r\n    validatePlanetData(planetDiv, planetIndex) {\r\n        const nameInput = planetDiv.querySelector(`input[id^=\"planet-name-\"]`);\r\n        const descInput = planetDiv.querySelector(`textarea[id^=\"planet-description-\"]`);\r\n\r\n        if (!nameInput || !descInput) {\r\n            return { isValid: false, message: `Planet ${planetIndex} is missing required fields.` };\r\n        }\r\n\r\n        const planetName = nameInput.value.trim();\r\n        const planetDesc = descInput.value.trim();\r\n\r\n        if (!planetName) {\r\n            return { isValid: false, message: `Please enter a name for Planet ${planetIndex}.` };\r\n        }\r\n\r\n        if (!planetDesc) {\r\n            return { isValid: false, message: `Please enter a description for Planet ${planetIndex}.` };\r\n        }\r\n\r\n        if (planetName.length < 2) {\r\n            return { isValid: false, message: `Planet ${planetIndex} name must be at least 2 characters long.` };\r\n        }\r\n\r\n        if (planetDesc.length < 5) {\r\n            return { isValid: false, message: `Planet ${planetIndex} description must be at least 5 characters long.` };\r\n        }\r\n\r\n        return { isValid: true };\r\n    }\r\n\r\n    collectPlanetData(planetInputs) {\r\n        const planets = [];\r\n        const errors = [];\r\n\r\n        for (let i = 0; i < planetInputs.length; i++) {\r\n            const planetDiv = planetInputs[i];\r\n            const planetIndex = i + 1;\r\n\r\n            const validation = this.validatePlanetData(planetDiv, planetIndex);\r\n            if (!validation.isValid) {\r\n                errors.push(validation.message);\r\n                continue;\r\n            }\r\n\r\n            const nameInput = planetDiv.querySelector(`input[id^=\"planet-name-\"]`);\r\n            const descInput = planetDiv.querySelector(`textarea[id^=\"planet-description-\"]`);\r\n            const sizeInput = planetDiv.querySelector(`input[id^=\"planet-size-\"]`);\r\n            const distanceInput = planetDiv.querySelector(`input[id^=\"planet-distance-\"]`);\r\n            const speedInput = planetDiv.querySelector(`input[id^=\"planet-speed-\"]`);\r\n            const ringsInput = planetDiv.querySelector(`input[id^=\"planet-rings-\"]`);\r\n\r\n            // Calculate speed from slider (1-10 to 0.001-0.002)\r\n            const speedValue = parseFloat(speedInput.value);\r\n            const orbitSpeed = 0.001 + (speedValue - 1) * (0.001 / 9);\r\n\r\n            planets.push({\r\n                name: nameInput.value.trim(),\r\n                description: descInput.value.trim(),\r\n                size: parseInt(sizeInput.value),\r\n                distance: parseInt(distanceInput.value),\r\n                speed: orbitSpeed,\r\n                rings: ringsInput.checked\r\n            });\r\n        }\r\n\r\n        return { planets, errors };\r\n    }\r\n\r\n    addCharacterCounter(textarea, maxChars) {\r\n        if (!textarea || !this.isMobile) return;\r\n\r\n        // Create counter element\r\n        const counter = document.createElement('div');\r\n        counter.className = 'char-counter';\r\n\r\n        // Update counter text\r\n        const updateCounter = () => {\r\n            const remaining = maxChars - textarea.value.length;\r\n            counter.textContent = `${remaining} characters remaining`;\r\n\r\n            // Change color based on remaining characters\r\n            counter.className = 'char-counter';\r\n            if (remaining < 30) {\r\n                counter.classList.add('warning');\r\n            }\r\n            if (remaining < 10) {\r\n                counter.classList.add('error');\r\n            }\r\n\r\n            // Enforce character limit\r\n            if (remaining < 0) {\r\n                textarea.value = textarea.value.substring(0, maxChars);\r\n                counter.textContent = \"0 characters remaining\";\r\n            }\r\n        };\r\n\r\n        // Add event listeners\r\n        textarea.addEventListener('input', updateCounter);\r\n        textarea.addEventListener('keydown', (e) => {\r\n            // Allow deletion even at max characters\r\n            if (textarea.value.length >= maxChars &&\r\n                e.key !== 'Backspace' &&\r\n                e.key !== 'Delete' &&\r\n                e.key !== 'ArrowLeft' &&\r\n                e.key !== 'ArrowRight' &&\r\n                !e.ctrlKey &&\r\n                !e.metaKey) {\r\n                e.preventDefault();\r\n            }\r\n        });\r\n\r\n        // Set initial counter\r\n        updateCounter();\r\n\r\n        // Add counter after textarea\r\n        textarea.parentNode.insertBefore(counter, textarea.nextSibling);\r\n\r\n        // Set maxlength attribute (fallback)\r\n        textarea.setAttribute('maxlength', maxChars.toString());\r\n    }\r\n\r\n    setupCharacterCounters(skyboxDescription, planetDescriptions) {\r\n        if (!this.isMobile) return;\r\n\r\n        // Skybox description\r\n        this.addCharacterCounter(skyboxDescription, 250);\r\n\r\n        // Add counter to first planet and set up event listener for future planets\r\n        const firstPlanetDesc = document.getElementById('planet-description-1');\r\n        if (firstPlanetDesc) {\r\n            this.addCharacterCounter(firstPlanetDesc, 150);\r\n        }\r\n    }\r\n\r\n    validatePlanetCount(planetInputs) {\r\n        if (planetInputs.length === 0) {\r\n            return { isValid: false, message: 'Please add at least one planet to your system.' };\r\n        }\r\n\r\n        if (planetInputs.length > 8) {\r\n            return { isValid: false, message: 'Maximum of 8 planets allowed per system.' };\r\n        }\r\n\r\n        return { isValid: true };\r\n    }\r\n\r\n    showMobileAlert(message, playUISound = null) {\r\n        if (this.isMobile) {\r\n            // Create a custom alert overlay for mobile\r\n            const alertOverlay = document.createElement('div');\r\n            alertOverlay.style.position = 'fixed';\r\n            alertOverlay.style.top = '0';\r\n            alertOverlay.style.left = '0';\r\n            alertOverlay.style.width = '100%';\r\n            alertOverlay.style.height = '100%';\r\n            alertOverlay.style.backgroundColor = 'rgba(0, 0, 0, 0.7)';\r\n            alertOverlay.style.display = 'flex';\r\n            alertOverlay.style.justifyContent = 'center';\r\n            alertOverlay.style.alignItems = 'center';\r\n            alertOverlay.style.zIndex = '10000';\r\n\r\n            const alertBox = document.createElement('div');\r\n            alertBox.style.backgroundColor = '#0a1a2a';\r\n            alertBox.style.color = '#c5d8f1';\r\n            alertBox.style.padding = '20px';\r\n            alertBox.style.borderRadius = '10px';\r\n            alertBox.style.maxWidth = '80%';\r\n            alertBox.style.textAlign = 'center';\r\n            alertBox.style.border = '2px solid #2c5a8c';\r\n\r\n            const messageEl = document.createElement('p');\r\n            messageEl.textContent = message;\r\n            messageEl.style.marginBottom = '20px';\r\n            messageEl.style.fontSize = '16px';\r\n\r\n            const okButton = document.createElement('button');\r\n            okButton.textContent = 'OK';\r\n            okButton.style.padding = '12px 30px';\r\n            okButton.style.fontSize = '16px';\r\n            okButton.style.backgroundColor = '#2c5a8c';\r\n            okButton.style.color = 'white';\r\n            okButton.style.border = 'none';\r\n            okButton.style.borderRadius = '5px';\r\n            okButton.style.minHeight = '48px';\r\n            okButton.style.minWidth = '120px';\r\n\r\n            alertBox.appendChild(messageEl);\r\n            alertBox.appendChild(okButton);\r\n            alertOverlay.appendChild(alertBox);\r\n            document.body.appendChild(alertOverlay);\r\n\r\n            // Play sound if available\r\n            if (playUISound) {\r\n                playUISound();\r\n            }\r\n\r\n            // Handle button click and touch\r\n            okButton.addEventListener('click', () => {\r\n                document.body.removeChild(alertOverlay);\r\n            });\r\n\r\n            okButton.addEventListener('touchend', (e) => {\r\n                e.preventDefault();\r\n                document.body.removeChild(alertOverlay);\r\n                if (playUISound) {\r\n                    playUISound();\r\n                }\r\n            });\r\n\r\n        } else {\r\n            // Fall back to regular alert for desktop\r\n            alert(message);\r\n        }\r\n    }\r\n}","// systemData.js - System data structures, presets, configurations\r\n\r\nexport class SystemDataManager {\r\n    constructor() {\r\n        this.starClasses = this.getStarClasses();\r\n        this.planetDefaults = this.getPlanetDefaults();\r\n    }\r\n\r\n    getStarClasses() {\r\n        return [\r\n            { value: 'O', label: 'O - Blue Giant (Hot, Blue)', color: 0x9bb0ff },\r\n            { value: 'B', label: 'B - Blue-White', color: 0xaabfff },\r\n            { value: 'A', label: 'A - White', color: 0xcad7ff },\r\n            { value: 'F', label: 'F - Yellow-White', color: 0xf8f7ff },\r\n            { value: 'G', label: 'G - Yellow (Sun-like)', color: 0xfff4ea, selected: true },\r\n            { value: 'K', label: 'K - Orange', color: 0xffd2a1 },\r\n            { value: 'M', label: 'M - Red Dwarf', color: 0xffcc6f }\r\n        ];\r\n    }\r\n\r\n    getPlanetDefaults() {\r\n        return {\r\n            size: { min: 300, max: 1000, default: 450 },\r\n            distance: { min: 4000, max: 60000, default: 8000 },\r\n            speed: { min: 1, max: 10, default: 5 },\r\n            rings: false\r\n        };\r\n    }\r\n\r\n    getStarColorForClass(starClass) {\r\n        const starClassData = this.starClasses.find(sc => sc.value === starClass);\r\n        return starClassData ? starClassData.color : 0xfff4ea; // Default to G-class if undefined\r\n    }\r\n\r\n    createSystemData(systemName, starClass, skyboxUrl, planets, lightIntensityMultiplier = 0.8) {\r\n        return {\r\n            id: `Custom-${Date.now()}`,\r\n            name: systemName,\r\n            starClass: starClass,\r\n            classification: 'Custom',\r\n            description: `Custom star system with ${planets.length} planets`,\r\n            skyboxUrl: skyboxUrl,\r\n            lightIntensityMultiplier: lightIntensityMultiplier,\r\n            planetData: planets.map((planet, i) => {\r\n                return {\r\n                    name: planet.name,\r\n                    textureUrl: planet.textureUrl || null,\r\n                    size: planet.size,\r\n                    distance: planet.distance,\r\n                    speed: planet.speed,\r\n                    color: this.getStarColorForClass(starClass),\r\n                    rings: planet.rings\r\n                };\r\n            })\r\n        };\r\n    }\r\n\r\n    calculatePlanetDistance(planetIndex, baseDistance = 4000, increment = 6000) {\r\n        return baseDistance + planetIndex * increment;\r\n    }\r\n\r\n    convertSpeedSliderToOrbitSpeed(sliderValue) {\r\n        // Convert 1-10 range to 0.001-0.002 range\r\n        return 0.001 + (sliderValue - 1) * (0.001 / 9);\r\n    }\r\n\r\n    getDefaultPlanetData(planetIndex) {\r\n        return {\r\n            name: '',\r\n            description: '',\r\n            size: this.planetDefaults.size.default,\r\n            distance: this.calculatePlanetDistance(planetIndex),\r\n            speed: this.convertSpeedSliderToOrbitSpeed(this.planetDefaults.speed.default),\r\n            rings: this.planetDefaults.rings\r\n        };\r\n    }\r\n\r\n    getSystemPresets() {\r\n        return {\r\n            solar: {\r\n                name: 'Sol System',\r\n                starClass: 'G',\r\n                skyboxDescription: 'Deep space with distant stars and nebulae',\r\n                planets: [\r\n                    {\r\n                        name: 'Mercury',\r\n                        description: 'A small, rocky planet closest to the star',\r\n                        size: 350,\r\n                        distance: 4000,\r\n                        speed: 0.002,\r\n                        rings: false\r\n                    },\r\n                    {\r\n                        name: 'Venus',\r\n                        description: 'A hot, cloudy planet with a thick atmosphere',\r\n                        size: 420,\r\n                        distance: 6000,\r\n                        speed: 0.0018,\r\n                        rings: false\r\n                    },\r\n                    {\r\n                        name: 'Earth',\r\n                        description: 'A blue planet with oceans and continents',\r\n                        size: 450,\r\n                        distance: 8000,\r\n                        speed: 0.0015,\r\n                        rings: false\r\n                    }\r\n                ]\r\n            },\r\n            binary: {\r\n                name: 'Binary System',\r\n                starClass: 'F',\r\n                skyboxDescription: 'A system with twin stars casting complex shadows',\r\n                planets: [\r\n                    {\r\n                        name: 'Proxima',\r\n                        description: 'A tidally locked world with extreme temperature differences',\r\n                        size: 380,\r\n                        distance: 12000,\r\n                        speed: 0.001,\r\n                        rings: false\r\n                    },\r\n                    {\r\n                        name: 'Gemini Prime',\r\n                        description: 'A large gas giant with spectacular ring systems',\r\n                        size: 800,\r\n                        distance: 25000,\r\n                        speed: 0.0008,\r\n                        rings: true\r\n                    }\r\n                ]\r\n            },\r\n            exotic: {\r\n                name: 'Exotic System',\r\n                starClass: 'O',\r\n                skyboxDescription: 'A violent nebula with intense radiation and stellar phenomena',\r\n                planets: [\r\n                    {\r\n                        name: 'Crystalline',\r\n                        description: 'A planet of living crystal formations and energy storms',\r\n                        size: 600,\r\n                        distance: 15000,\r\n                        speed: 0.0012,\r\n                        rings: true\r\n                    }\r\n                ]\r\n            }\r\n        };\r\n    }\r\n\r\n    validateSystemData(systemData) {\r\n        const errors = [];\r\n\r\n        if (!systemData.name || systemData.name.trim().length < 3) {\r\n            errors.push('System name must be at least 3 characters long');\r\n        }\r\n\r\n        if (!systemData.starClass || !this.starClasses.find(sc => sc.value === systemData.starClass)) {\r\n            errors.push('Invalid star class selected');\r\n        }\r\n\r\n        if (!systemData.planetData || systemData.planetData.length === 0) {\r\n            errors.push('System must have at least one planet');\r\n        }\r\n\r\n        if (systemData.planetData && systemData.planetData.length > 8) {\r\n            errors.push('System cannot have more than 8 planets');\r\n        }\r\n\r\n        systemData.planetData?.forEach((planet, index) => {\r\n            if (!planet.name || planet.name.trim().length < 2) {\r\n                errors.push(`Planet ${index + 1} name must be at least 2 characters long`);\r\n            }\r\n\r\n            if (planet.size < this.planetDefaults.size.min || planet.size > this.planetDefaults.size.max) {\r\n                errors.push(`Planet ${index + 1} size must be between ${this.planetDefaults.size.min} and ${this.planetDefaults.size.max}`);\r\n            }\r\n\r\n            if (planet.distance < this.planetDefaults.distance.min || planet.distance > this.planetDefaults.distance.max) {\r\n                errors.push(`Planet ${index + 1} distance must be between ${this.planetDefaults.distance.min} and ${this.planetDefaults.distance.max}`);\r\n            }\r\n        });\r\n\r\n        return {\r\n            isValid: errors.length === 0,\r\n            errors: errors\r\n        };\r\n    }\r\n}","// formView.js - Form creation, input fields, UI layout\r\n\r\nexport class FormViewManager {\r\n    constructor(isMobile = false, styleManager = null) {\r\n        this.isMobile = isMobile;\r\n        this.styleManager = styleManager;\r\n        this.scrollTimeout = null;\r\n    }\r\n\r\n    createMainContainer() {\r\n        const container = document.createElement('div');\r\n        container.id = 'custom-system-creator';\r\n        container.className = 'modal-container';\r\n        container.style.display = 'none';\r\n        return container;\r\n    }\r\n\r\n    createModalContent() {\r\n        const styles = this.styleManager?.getMobileStyles() || {};\r\n        \r\n        return `\r\n            <div class=\"modal-content\" style=\"${styles.modalContent}\">\r\n                <div class=\"modal-header\">\r\n                    <h2>Create New Star System</h2>\r\n                    <button id=\"close-system-creator\" class=\"close-btn\" style=\"${styles.closeBtn}\">&times;</button>\r\n                </div>\r\n                <div class=\"modal-body\" style=\"${styles.modalBody}\">\r\n                    <div id=\"system-creator-form\">\r\n                        ${this.createSystemForm()}\r\n                        ${this.createPlanetSection()}\r\n                        ${this.createFormActions()}\r\n                    </div>\r\n                    ${this.createProgressSection()}\r\n                    ${this.createPreviewSection()}\r\n                </div>\r\n            </div>\r\n        `;\r\n    }\r\n\r\n    createSystemForm() {\r\n        const styles = this.styleManager?.getMobileStyles() || {};\r\n        \r\n        return `\r\n            <div class=\"form-group\">\r\n                <label for=\"system-name\">System Name:</label>\r\n                <input type=\"text\" id=\"system-name\" placeholder=\"Enter a name for your star system\" style=\"${styles.input}\">\r\n            </div>\r\n            \r\n            <div class=\"form-group\">\r\n                <label for=\"skybox-description\">Skybox Description:</label>\r\n                <textarea id=\"skybox-description\" rows=\"${this.styleManager?.getTextareaRows(4) || 4}\" placeholder=\"Describe the skybox/space environment (e.g., 'A vibrant nebula with blue and purple clouds, dotted with bright stars')\" style=\"${styles.textarea}\"></textarea>\r\n            </div>\r\n            \r\n            <div class=\"form-group\">\r\n                <label for=\"star-class\">Star Class:</label>\r\n                <select id=\"star-class\" class=\"form-control\" style=\"${styles.select}\">\r\n                    <option value=\"O\">O - Blue Giant (Hot, Blue)</option>\r\n                    <option value=\"B\">B - Blue-White</option>\r\n                    <option value=\"A\">A - White</option>\r\n                    <option value=\"F\">F - Yellow-White</option>\r\n                    <option value=\"G\" selected>G - Yellow (Sun-like)</option>\r\n                    <option value=\"K\">K - Orange</option>\r\n                    <option value=\"M\">M - Red Dwarf</option>\r\n                </select>\r\n                <p class=\"help-text\">Different star classes affect the lighting and appearance of your system.</p>\r\n            </div>\r\n        `;\r\n    }\r\n\r\n    createPlanetSection() {\r\n        const styles = this.styleManager?.getMobileStyles() || {};\r\n        \r\n        return `\r\n            <div id=\"planet-descriptions\">\r\n                <div class=\"form-group planet-input\">\r\n                    ${this.createPlanetForm(1, styles)}\r\n                </div>\r\n            </div>\r\n            \r\n            <button id=\"add-planet-btn\" class=\"secondary-btn\" style=\"${styles.secondaryBtn}\">+ Add Another Planet</button>\r\n        `;\r\n    }\r\n\r\n    createPlanetForm(index, styles = {}) {\r\n        return `\r\n            <h3>Planet ${index}</h3>\r\n            <label for=\"planet-name-${index}\">Planet Name:</label>\r\n            <input type=\"text\" id=\"planet-name-${index}\" placeholder=\"Enter a name for this planet\" style=\"${styles.input}\">\r\n            \r\n            <label for=\"planet-description-${index}\">Planet Description:</label>\r\n            <textarea id=\"planet-description-${index}\" rows=\"${this.styleManager?.getTextareaRows(3) || 3}\" placeholder=\"Describe the planet (e.g., 'A rocky planet with large oceans and ice caps')\" style=\"${styles.textarea}\" maxlength=\"150\"></textarea>\r\n            \r\n            <div class=\"planet-properties\">\r\n                ${this.createPlanetSliders(index, styles)}\r\n                ${this.createPlanetRings(index, styles)}\r\n            </div>\r\n            \r\n            ${index > 1 ? this.createRemoveButton(styles) : ''}\r\n        `;\r\n    }\r\n\r\n    createPlanetSliders(index, styles = {}) {\r\n        return `\r\n            <div class=\"property-row\">\r\n                <label for=\"planet-size-${index}\">Size:</label>\r\n                <input type=\"range\" id=\"planet-size-${index}\" min=\"300\" max=\"1000\" value=\"450\" class=\"slider\" style=\"${styles.slider}\">\r\n                <span class=\"slider-value\" id=\"planet-size-value-${index}\">450</span>\r\n            </div>\r\n            \r\n            <div class=\"property-row\">\r\n                <label for=\"planet-distance-${index}\">Distance from Star:</label>\r\n                <input type=\"range\" id=\"planet-distance-${index}\" min=\"4000\" max=\"60000\" value=\"${4000 + index * 6000}\" class=\"slider\" style=\"${styles.slider}\">\r\n                <span class=\"slider-value\" id=\"planet-distance-value-${index}\">${4000 + index * 6000}</span>\r\n            </div>\r\n            \r\n            <div class=\"property-row\">\r\n                <label for=\"planet-speed-${index}\">Orbit Speed:</label>\r\n                <input type=\"range\" id=\"planet-speed-${index}\" min=\"1\" max=\"10\" value=\"5\" class=\"slider\" style=\"${styles.slider}\">\r\n                <span class=\"slider-value\" id=\"planet-speed-value-${index}\">0.0015</span>\r\n            </div>\r\n        `;\r\n    }\r\n\r\n    createPlanetRings(index, styles = {}) {\r\n        return `\r\n            <div class=\"property-row\" style=\"${styles.checkboxRow}\">\r\n                <label for=\"planet-rings-${index}\">Has Rings:</label>\r\n                <input type=\"checkbox\" id=\"planet-rings-${index}\" style=\"${styles.checkbox}\">\r\n            </div>\r\n        `;\r\n    }\r\n\r\n    createRemoveButton(styles = {}) {\r\n        const rippleClass = this.isMobile ? 'ripple' : '';\r\n        return `<button class=\"remove-planet-btn danger-btn ${rippleClass}\" style=\"${styles.removeBtn}\">Remove</button>`;\r\n    }\r\n\r\n    createFormActions() {\r\n        const styles = this.styleManager?.getMobileStyles() || {};\r\n        \r\n        return `\r\n            <div class=\"form-actions\">\r\n                <button id=\"generate-system-btn\" class=\"primary-btn\" style=\"${styles.primaryBtn}\">Generate System</button>\r\n            </div>\r\n        `;\r\n    }\r\n\r\n    createProgressSection() {\r\n        return `\r\n            <div id=\"generation-progress\" style=\"display: none;\">\r\n                <h3>Generating your star system...</h3>\r\n                <div class=\"progress-bar\">\r\n                    <div class=\"progress-fill\"></div>\r\n                </div>\r\n                <p id=\"generation-status\">Initializing...</p>\r\n            </div>\r\n        `;\r\n    }\r\n\r\n    createPreviewSection() {\r\n        const styles = this.styleManager?.getMobileStyles() || {};\r\n        \r\n        return `\r\n            <div id=\"system-preview\" style=\"display: none;\">\r\n                <h3>Preview</h3>\r\n                <div class=\"preview-container\" style=\"${styles.previewContainer}\">\r\n                    <div class=\"skybox-preview\" style=\"${styles.skyboxPreview}\">\r\n                        <h4>Skybox</h4>\r\n                        <img id=\"skybox-preview-img\" src=\"\" alt=\"Skybox Preview\">\r\n                    </div>\r\n                    <div class=\"planets-preview\" id=\"planets-preview\" style=\"${styles.planetsPreview}\">\r\n                        <!-- Planet previews will be added here dynamically -->\r\n                    </div>\r\n                </div>\r\n                <div class=\"form-actions\" style=\"${styles.formActions}\">\r\n                    <button id=\"travel-to-system-btn\" class=\"primary-btn\" style=\"${styles.primaryBtn}\">Travel to System</button>\r\n                    <button id=\"regenerate-system-btn\" class=\"secondary-btn\" style=\"${styles.secondaryBtn}\">Regenerate</button>\r\n                </div>\r\n            </div>\r\n        `;\r\n    }\r\n\r\n    addPlanetInput(planetDescriptions, setupSliderListeners, updatePlanetNumbers, playUISound) {\r\n        const planetInputs = planetDescriptions.getElementsByClassName('planet-input');\r\n        const newIndex = planetInputs.length + 1;\r\n        const styles = this.styleManager?.getMobileStyles() || {};\r\n\r\n        const planetDiv = document.createElement('div');\r\n        planetDiv.className = 'form-group planet-input';\r\n        planetDiv.innerHTML = this.createPlanetForm(newIndex, styles);\r\n\r\n        planetDescriptions.appendChild(planetDiv);\r\n\r\n        // Set up event listeners for the sliders\r\n        setupSliderListeners(newIndex);\r\n\r\n        // Add event listener to remove button\r\n        const removeBtn = planetDiv.querySelector('.remove-planet-btn');\r\n        if (removeBtn) {\r\n            this.setupRemoveButton(removeBtn, planetDiv, updatePlanetNumbers, playUISound);\r\n        }\r\n\r\n        // Add mobile-specific enhancements\r\n        if (this.isMobile) {\r\n            this.enhanceMobileInteraction(planetDiv);\r\n        }\r\n\r\n        // Scroll to new planet on mobile\r\n        this.scrollToNewPlanet(planetDescriptions);\r\n\r\n        return planetDiv;\r\n    }\r\n\r\n    setupRemoveButton(removeBtn, planetDiv, updatePlanetNumbers, playUISound) {\r\n        const removeHandler = (e) => {\r\n            if (e) e.preventDefault();\r\n            planetDiv.remove();\r\n            updatePlanetNumbers();\r\n            if (playUISound) playUISound();\r\n        };\r\n\r\n        removeBtn.addEventListener('click', removeHandler);\r\n\r\n        if (this.isMobile) {\r\n            removeBtn.addEventListener('touchend', removeHandler);\r\n        }\r\n    }\r\n\r\n    enhanceMobileInteraction(planetDiv) {\r\n        // Add touch events to sliders for better mobile interaction\r\n        const sliders = planetDiv.querySelectorAll('input[type=\"range\"]');\r\n        sliders.forEach(slider => {\r\n            slider.addEventListener('touchstart', () => {\r\n                slider.classList.add('slider-active');\r\n            });\r\n\r\n            slider.addEventListener('touchend', () => {\r\n                slider.classList.remove('slider-active');\r\n            });\r\n        });\r\n\r\n        // Add character counter to planet description\r\n        const planetDesc = planetDiv.querySelector(`textarea[id^=\"planet-description-\"]`);\r\n        if (planetDesc && this.validationManager) {\r\n            this.validationManager.addCharacterCounter(planetDesc, 150);\r\n        }\r\n    }\r\n\r\n    scrollToNewPlanet(planetDescriptions) {\r\n        if (!this.isMobile) return;\r\n\r\n        // Clear any existing scroll timeout\r\n        if (this.scrollTimeout) {\r\n            clearTimeout(this.scrollTimeout);\r\n        }\r\n\r\n        // Use a safer scrolling approach\r\n        this.scrollTimeout = setTimeout(() => {\r\n            try {\r\n                const modalContent = document.querySelector('#custom-system-creator .modal-content');\r\n                const newPlanet = planetDescriptions.lastElementChild;\r\n\r\n                if (modalContent && newPlanet) {\r\n                    const planetPos = newPlanet.offsetTop;\r\n                    const scrollPos = planetPos - (modalContent.clientHeight / 4);\r\n\r\n                    modalContent.scrollTo({\r\n                        top: scrollPos,\r\n                        behavior: 'smooth'\r\n                    });\r\n                }\r\n            } catch (err) {\r\n                console.warn(\"Error during scroll:\", err);\r\n            }\r\n        }, 100);\r\n    }\r\n\r\n    updatePlanetNumbers(planetDescriptions) {\r\n        const planetInputs = planetDescriptions.getElementsByClassName('planet-input');\r\n        for (let i = 0; i < planetInputs.length; i++) {\r\n            const planetDiv = planetInputs[i];\r\n            const planetHeader = planetDiv.querySelector('h3');\r\n            if (planetHeader) {\r\n                planetHeader.textContent = `Planet ${i + 1}`;\r\n            }\r\n        }\r\n    }\r\n\r\n    addRippleEffect(container) {\r\n        if (!this.isMobile) return;\r\n\r\n        const buttons = container.querySelectorAll('button');\r\n        buttons.forEach(button => {\r\n            if (!button.classList.contains('ripple')) {\r\n                button.classList.add('ripple');\r\n            }\r\n        });\r\n    }\r\n\r\n    setupSliderListeners(index) {\r\n        // Size slider\r\n        const sizeSlider = document.getElementById(`planet-size-${index}`);\r\n        const sizeValue = document.getElementById(`planet-size-value-${index}`);\r\n\r\n        if (sizeSlider && sizeValue) {\r\n            sizeSlider.addEventListener('input', () => {\r\n                sizeValue.textContent = sizeSlider.value;\r\n            });\r\n        }\r\n\r\n        // Distance slider\r\n        const distanceSlider = document.getElementById(`planet-distance-${index}`);\r\n        const distanceValue = document.getElementById(`planet-distance-value-${index}`);\r\n\r\n        if (distanceSlider && distanceValue) {\r\n            distanceSlider.addEventListener('input', () => {\r\n                distanceValue.textContent = distanceSlider.value;\r\n            });\r\n        }\r\n\r\n        // Speed slider\r\n        const speedSlider = document.getElementById(`planet-speed-${index}`);\r\n        const speedValue = document.getElementById(`planet-speed-value-${index}`);\r\n\r\n        if (speedSlider && speedValue) {\r\n            speedSlider.addEventListener('input', () => {\r\n                // Convert 1-10 range to 0.001-0.002 range\r\n                const speed = 0.001 + (speedSlider.value - 1) * (0.001 / 9);\r\n                speedValue.textContent = speed.toFixed(4);\r\n            });\r\n        }\r\n\r\n        // Add mobile visual feedback\r\n        if (this.isMobile) {\r\n            const sliders = [sizeSlider, distanceSlider, speedSlider].filter(Boolean);\r\n            sliders.forEach(slider => {\r\n                slider.addEventListener('touchstart', () => {\r\n                    slider.classList.add('slider-active');\r\n                });\r\n\r\n                slider.addEventListener('touchend', () => {\r\n                    slider.classList.remove('slider-active');\r\n                });\r\n            });\r\n        }\r\n    }\r\n\r\n    cleanup() {\r\n        if (this.scrollTimeout) {\r\n            clearTimeout(this.scrollTimeout);\r\n            this.scrollTimeout = null;\r\n        }\r\n    }\r\n}","// preview.js - System preview rendering and visualization\r\n\r\nexport class PreviewManager {\r\n    constructor(isMobile = false) {\r\n        this.isMobile = isMobile;\r\n    }\r\n\r\n    showSystemPreview(generatedSkyboxUrl, generatedPlanetUrls, apiClient) {\r\n        this.updateSkyboxPreview(generatedSkyboxUrl, apiClient);\r\n        this.updatePlanetPreviews(generatedPlanetUrls, apiClient);\r\n        this.showPreviewUI();\r\n    }\r\n\r\n    updateSkyboxPreview(skyboxUrl, apiClient) {\r\n        const skyboxPreviewImg = document.getElementById('skybox-preview-img');\r\n        if (skyboxPreviewImg && skyboxUrl && apiClient) {\r\n            skyboxPreviewImg.src = apiClient.getFullImageUrl(skyboxUrl);\r\n        }\r\n    }\r\n\r\n    updatePlanetPreviews(planetUrls, apiClient) {\r\n        const planetsPreview = document.getElementById('planets-preview');\r\n        if (!planetsPreview) return;\r\n\r\n        planetsPreview.innerHTML = '';\r\n        \r\n        if (!planetUrls || !Array.isArray(planetUrls)) return;\r\n\r\n        planetUrls.forEach(planet => {\r\n            const planetDiv = document.createElement('div');\r\n            planetDiv.className = 'planet-preview';\r\n            \r\n            const planetImageSrc = apiClient && planet.url ? \r\n                apiClient.getFullImageUrl(planet.url) : \r\n                planet.url || '';\r\n\r\n            planetDiv.innerHTML = `\r\n                <h4>${planet.name || 'Unknown Planet'}</h4>\r\n                <img src=\"${planetImageSrc}\" alt=\"${planet.name || 'Planet'}\" loading=\"lazy\">\r\n            `;\r\n            \r\n            planetsPreview.appendChild(planetDiv);\r\n        });\r\n    }\r\n\r\n    showPreviewUI() {\r\n        const generationProgress = document.getElementById('generation-progress');\r\n        const systemPreview = document.getElementById('system-preview');\r\n\r\n        if (generationProgress) {\r\n            generationProgress.style.display = 'none';\r\n        }\r\n\r\n        if (systemPreview) {\r\n            systemPreview.style.display = 'block';\r\n        }\r\n\r\n        // If on mobile, scroll to top of preview\r\n        if (this.isMobile) {\r\n            setTimeout(() => {\r\n                if (systemPreview) {\r\n                    systemPreview.scrollIntoView({ behavior: 'smooth', block: 'start' });\r\n                }\r\n            }, 50);\r\n        }\r\n    }\r\n\r\n    hidePreview() {\r\n        const systemPreview = document.getElementById('system-preview');\r\n        const systemForm = document.getElementById('system-creator-form');\r\n\r\n        if (systemPreview) {\r\n            systemPreview.style.display = 'none';\r\n        }\r\n\r\n        if (systemForm) {\r\n            systemForm.style.display = 'block';\r\n        }\r\n    }\r\n\r\n    showProgress(message = 'Initializing...') {\r\n        const systemForm = document.getElementById('system-creator-form');\r\n        const generationProgress = document.getElementById('generation-progress');\r\n        const generationStatus = document.getElementById('generation-status');\r\n\r\n        if (systemForm) {\r\n            systemForm.style.display = 'none';\r\n        }\r\n\r\n        if (generationProgress) {\r\n            generationProgress.style.display = 'block';\r\n        }\r\n\r\n        if (generationStatus) {\r\n            generationStatus.textContent = message;\r\n        }\r\n    }\r\n\r\n    hideProgress() {\r\n        const generationProgress = document.getElementById('generation-progress');\r\n        const systemForm = document.getElementById('system-creator-form');\r\n\r\n        if (generationProgress) {\r\n            generationProgress.style.display = 'none';\r\n        }\r\n\r\n        if (systemForm) {\r\n            systemForm.style.display = 'block';\r\n        }\r\n    }\r\n\r\n    updateGenerationStatus(message) {\r\n        const generationStatus = document.getElementById('generation-status');\r\n        if (generationStatus) {\r\n            generationStatus.textContent = message;\r\n            console.log('Generation status:', message);\r\n        }\r\n    }\r\n\r\n    createPlanetPreviewElement(planet, apiClient) {\r\n        const planetDiv = document.createElement('div');\r\n        planetDiv.className = 'planet-preview';\r\n        \r\n        const imageUrl = apiClient && planet.url ? \r\n            apiClient.getFullImageUrl(planet.url) : \r\n            planet.url || '';\r\n\r\n        // Add error handling for image loading\r\n        const img = document.createElement('img');\r\n        img.src = imageUrl;\r\n        img.alt = planet.name || 'Planet';\r\n        img.loading = 'lazy';\r\n        \r\n        img.onerror = () => {\r\n            img.style.display = 'none';\r\n            const errorMsg = document.createElement('div');\r\n            errorMsg.className = 'image-error';\r\n            errorMsg.textContent = 'Image failed to load';\r\n            errorMsg.style.padding = '20px';\r\n            errorMsg.style.textAlign = 'center';\r\n            errorMsg.style.color = '#999';\r\n            planetDiv.appendChild(errorMsg);\r\n        };\r\n\r\n        const title = document.createElement('h4');\r\n        title.textContent = planet.name || 'Unknown Planet';\r\n\r\n        planetDiv.appendChild(title);\r\n        planetDiv.appendChild(img);\r\n\r\n        return planetDiv;\r\n    }\r\n\r\n    clearPreviews() {\r\n        const skyboxPreviewImg = document.getElementById('skybox-preview-img');\r\n        const planetsPreview = document.getElementById('planets-preview');\r\n\r\n        if (skyboxPreviewImg) {\r\n            skyboxPreviewImg.src = '';\r\n        }\r\n\r\n        if (planetsPreview) {\r\n            planetsPreview.innerHTML = '';\r\n        }\r\n    }\r\n\r\n    isPreviewVisible() {\r\n        const systemPreview = document.getElementById('system-preview');\r\n        return systemPreview && systemPreview.style.display !== 'none';\r\n    }\r\n\r\n    isProgressVisible() {\r\n        const generationProgress = document.getElementById('generation-progress');\r\n        return generationProgress && generationProgress.style.display !== 'none';\r\n    }\r\n\r\n    resetToForm() {\r\n        this.hidePreview();\r\n        this.hideProgress();\r\n        this.clearPreviews();\r\n    }\r\n}","// eventHandlers.js - Form events, button clicks, interactions\r\n\r\nexport class EventHandlerManager {\r\n    constructor(customSystemCreator, isMobile = false) {\r\n        this.customSystemCreator = customSystemCreator;\r\n        this.isMobile = isMobile;\r\n        this.handlers = new Map();\r\n    }\r\n\r\n    setupAllEventHandlers(container, elements) {\r\n        this.setupCloseHandlers(elements.closeBtn);\r\n        this.setupFormHandlers(elements);\r\n        this.setupKeyboardHandlers();\r\n        this.setupContainerHandlers(container);\r\n        \r\n        if (this.isMobile) {\r\n            this.setupMobileHandlers(container, elements);\r\n        }\r\n    }\r\n\r\n    setupCloseHandlers(closeBtn) {\r\n        const closeHandler = (e) => {\r\n            if (e) e.preventDefault();\r\n            this.customSystemCreator.hide();\r\n            this.customSystemCreator.playUISound();\r\n        };\r\n\r\n        closeBtn.addEventListener('click', closeHandler);\r\n        \r\n        if (this.isMobile) {\r\n            closeBtn.addEventListener('touchend', closeHandler);\r\n        }\r\n    }\r\n\r\n    setupFormHandlers(elements) {\r\n        // Add Planet button\r\n        const addPlanetHandler = (e) => {\r\n            if (e) e.preventDefault();\r\n            this.customSystemCreator.addPlanetInput();\r\n            this.customSystemCreator.playUISound();\r\n        };\r\n\r\n        elements.addPlanetBtn.addEventListener('click', addPlanetHandler);\r\n        \r\n        if (this.isMobile) {\r\n            elements.addPlanetBtn.addEventListener('touchend', addPlanetHandler);\r\n        }\r\n\r\n        // Generate System button\r\n        const generateHandler = (e) => {\r\n            if (e) e.preventDefault();\r\n            this.customSystemCreator.generateSystem();\r\n            this.customSystemCreator.playUISound();\r\n        };\r\n\r\n        elements.generateSystemBtn.addEventListener('click', generateHandler);\r\n        \r\n        if (this.isMobile) {\r\n            elements.generateSystemBtn.addEventListener('touchend', generateHandler);\r\n        }\r\n\r\n        // Travel to System button\r\n        const travelHandler = (e) => {\r\n            if (e) e.preventDefault();\r\n            this.customSystemCreator.travelToSystem();\r\n            this.customSystemCreator.playUISound();\r\n        };\r\n\r\n        elements.travelToSystemBtn.addEventListener('click', travelHandler);\r\n        \r\n        if (this.isMobile) {\r\n            elements.travelToSystemBtn.addEventListener('touchend', travelHandler);\r\n        }\r\n\r\n        // Regenerate button\r\n        const regenerateHandler = (e) => {\r\n            if (e) e.preventDefault();\r\n            elements.systemPreview.style.display = 'none';\r\n            elements.systemForm.style.display = 'block';\r\n            this.customSystemCreator.playUISound();\r\n        };\r\n\r\n        elements.regenerateSystemBtn.addEventListener('click', regenerateHandler);\r\n        \r\n        if (this.isMobile) {\r\n            elements.regenerateSystemBtn.addEventListener('touchend', regenerateHandler);\r\n        }\r\n    }\r\n\r\n    setupKeyboardHandlers() {\r\n        const escapeHandler = (e) => {\r\n            if (e.key === 'Escape' && this.customSystemCreator.isVisible) {\r\n                this.customSystemCreator.hide();\r\n            }\r\n        };\r\n\r\n        document.addEventListener('keydown', escapeHandler);\r\n        this.handlers.set('escape', escapeHandler);\r\n    }\r\n\r\n    setupContainerHandlers(container) {\r\n        // Click outside to close\r\n        const clickOutsideHandler = (e) => {\r\n            if (e.target === container) {\r\n                this.customSystemCreator.hide();\r\n            }\r\n        };\r\n\r\n        container.addEventListener('click', clickOutsideHandler);\r\n        this.handlers.set('clickOutside', clickOutsideHandler);\r\n    }\r\n\r\n    setupMobileHandlers(container, elements) {\r\n        // Touch start on container to close (mobile)\r\n        const touchCloseHandler = (e) => {\r\n            if (e.target === container) {\r\n                e.preventDefault();\r\n                this.customSystemCreator.hide();\r\n            }\r\n        };\r\n\r\n        container.addEventListener('touchstart', touchCloseHandler, { passive: false });\r\n        this.handlers.set('touchClose', touchCloseHandler);\r\n\r\n        // Improve scroll handling\r\n        container.addEventListener('touchmove', (e) => {\r\n            e.stopPropagation();\r\n        }, { passive: true });\r\n\r\n        // Improve scroll performance\r\n        const modalContent = container.querySelector('.modal-content');\r\n        if (modalContent) {\r\n            modalContent.addEventListener('touchstart', () => {}, { passive: true });\r\n            modalContent.addEventListener('touchmove', () => {}, { passive: true });\r\n        }\r\n\r\n        // Add body scroll prevention\r\n        this.setupBodyScrollPrevention();\r\n    }\r\n\r\n    setupBodyScrollPrevention() {\r\n        const preventScroll = (e) => {\r\n            if (this.customSystemCreator.isVisible) {\r\n                e.preventDefault();\r\n            }\r\n        };\r\n\r\n        document.body.addEventListener('touchmove', preventScroll, { passive: false });\r\n        this.handlers.set('preventScroll', preventScroll);\r\n    }\r\n\r\n    setupSliderHandlers(index, formViewManager) {\r\n        if (formViewManager && typeof formViewManager.setupSliderListeners === 'function') {\r\n            formViewManager.setupSliderListeners(index);\r\n        }\r\n    }\r\n\r\n    setupRemoveButtonHandler(removeBtn, planetDiv, updatePlanetNumbers) {\r\n        const removeHandler = (e) => {\r\n            if (e) e.preventDefault();\r\n            planetDiv.remove();\r\n            updatePlanetNumbers();\r\n            this.customSystemCreator.playUISound();\r\n        };\r\n\r\n        removeBtn.addEventListener('click', removeHandler);\r\n\r\n        if (this.isMobile) {\r\n            removeBtn.addEventListener('touchend', removeHandler);\r\n            \r\n            // Add touch feedback for sliders in this planet\r\n            const sliders = planetDiv.querySelectorAll('input[type=\"range\"]');\r\n            sliders.forEach(slider => {\r\n                slider.addEventListener('touchstart', () => {\r\n                    slider.classList.add('slider-active');\r\n                });\r\n                \r\n                slider.addEventListener('touchend', () => {\r\n                    slider.classList.remove('slider-active');\r\n                });\r\n            });\r\n        }\r\n    }\r\n\r\n    addDynamicEventHandlers(element, handlers = {}) {\r\n        Object.entries(handlers).forEach(([event, handler]) => {\r\n            if (typeof handler === 'function') {\r\n                element.addEventListener(event, handler);\r\n                \r\n                // Store handler for cleanup\r\n                if (!this.handlers.has(element)) {\r\n                    this.handlers.set(element, new Map());\r\n                }\r\n                this.handlers.get(element).set(event, handler);\r\n            }\r\n        });\r\n    }\r\n\r\n    removeDynamicEventHandlers(element) {\r\n        if (this.handlers.has(element)) {\r\n            const elementHandlers = this.handlers.get(element);\r\n            elementHandlers.forEach((handler, event) => {\r\n                element.removeEventListener(event, handler);\r\n            });\r\n            this.handlers.delete(element);\r\n        }\r\n    }\r\n\r\n    cleanup() {\r\n        // Remove all registered event handlers\r\n        this.handlers.forEach((handler, key) => {\r\n            if (typeof key === 'string') {\r\n                // Global handlers like escape key\r\n                switch (key) {\r\n                    case 'escape':\r\n                        document.removeEventListener('keydown', handler);\r\n                        break;\r\n                    case 'preventScroll':\r\n                        document.body.removeEventListener('touchmove', handler);\r\n                        break;\r\n                }\r\n            } else if (key instanceof Element) {\r\n                // Element-specific handlers\r\n                if (handler instanceof Map) {\r\n                    handler.forEach((handlerFunc, event) => {\r\n                        key.removeEventListener(event, handlerFunc);\r\n                    });\r\n                } else {\r\n                    // Single handler\r\n                    key.removeEventListener('click', handler);\r\n                    key.removeEventListener('touchend', handler);\r\n                    key.removeEventListener('touchstart', handler);\r\n                    key.removeEventListener('touchmove', handler);\r\n                }\r\n            }\r\n        });\r\n\r\n        this.handlers.clear();\r\n    }\r\n\r\n    // Utility method to add mobile-friendly event listeners\r\n    addMobileFriendlyListener(element, eventType, handler, options = {}) {\r\n        const wrappedHandler = (e) => {\r\n            if (this.isMobile && e.type === 'touchend') {\r\n                e.preventDefault();\r\n            }\r\n            handler(e);\r\n        };\r\n\r\n        element.addEventListener(eventType, wrappedHandler, options);\r\n\r\n        if (this.isMobile && eventType === 'click') {\r\n            element.addEventListener('touchend', wrappedHandler, options);\r\n        }\r\n\r\n        // Store for cleanup\r\n        if (!this.handlers.has(element)) {\r\n            this.handlers.set(element, new Map());\r\n        }\r\n        this.handlers.get(element).set(eventType, wrappedHandler);\r\n\r\n        return wrappedHandler;\r\n    }\r\n\r\n    // Method to handle form validation events\r\n    setupValidationHandlers(elements, validationManager) {\r\n        if (!validationManager) return;\r\n\r\n        // Real-time validation for system name\r\n        elements.systemNameInput.addEventListener('blur', () => {\r\n            const validation = validationManager.validateSystemForm(\r\n                elements.systemNameInput, \r\n                elements.skyboxDescription\r\n            );\r\n            \r\n            if (!validation.isValid && elements.systemNameInput.value.trim()) {\r\n                this.showFieldError(elements.systemNameInput, validation.message);\r\n            } else {\r\n                this.clearFieldError(elements.systemNameInput);\r\n            }\r\n        });\r\n\r\n        // Real-time validation for skybox description\r\n        elements.skyboxDescription.addEventListener('blur', () => {\r\n            const validation = validationManager.validateSystemForm(\r\n                elements.systemNameInput, \r\n                elements.skyboxDescription\r\n            );\r\n            \r\n            if (!validation.isValid && elements.skyboxDescription.value.trim()) {\r\n                this.showFieldError(elements.skyboxDescription, validation.message);\r\n            } else {\r\n                this.clearFieldError(elements.skyboxDescription);\r\n            }\r\n        });\r\n    }\r\n\r\n    showFieldError(field, message) {\r\n        this.clearFieldError(field);\r\n        \r\n        const errorDiv = document.createElement('div');\r\n        errorDiv.className = 'field-error';\r\n        errorDiv.textContent = message;\r\n        errorDiv.style.color = '#ff3030';\r\n        errorDiv.style.fontSize = '12px';\r\n        errorDiv.style.marginTop = '5px';\r\n        \r\n        field.parentNode.insertBefore(errorDiv, field.nextSibling);\r\n        field.style.borderColor = '#ff3030';\r\n    }\r\n\r\n    clearFieldError(field) {\r\n        const existingError = field.parentNode.querySelector('.field-error');\r\n        if (existingError) {\r\n            existingError.remove();\r\n        }\r\n        field.style.borderColor = '';\r\n    }\r\n}","// helpers.js - Utility functions and data formatting\r\n\r\nexport class HelperManager {\r\n    constructor() {\r\n        this.scrollTimeout = null;\r\n    }\r\n\r\n    detectMobile() {\r\n        return ('ontouchstart' in window) || \r\n               (navigator.maxTouchPoints > 0) || \r\n               (navigator.msMaxTouchPoints > 0) ||\r\n               (window.innerWidth < 900);\r\n    }\r\n\r\n    playUISound() {\r\n        // Play UI sound if audio is available\r\n        if (window.game && window.game.audio) {\r\n            window.game.audio.playSound('boink');\r\n        }\r\n    }\r\n\r\n    formatSliderValue(value, type = 'default') {\r\n        switch (type) {\r\n            case 'speed':\r\n                // Convert 1-10 range to 0.001-0.002 range\r\n                const speed = 0.001 + (value - 1) * (0.001 / 9);\r\n                return speed.toFixed(4);\r\n            case 'size':\r\n            case 'distance':\r\n                return parseInt(value).toString();\r\n            default:\r\n                return value.toString();\r\n        }\r\n    }\r\n\r\n    calculateDefaultDistance(planetIndex, baseDistance = 4000, increment = 6000) {\r\n        return baseDistance + planetIndex * increment;\r\n    }\r\n\r\n    convertSpeedSliderValue(sliderValue) {\r\n        // Convert 1-10 range to 0.001-0.002 range\r\n        return 0.001 + (sliderValue - 1) * (0.001 / 9);\r\n    }\r\n\r\n    cleanupScrolling() {\r\n        if (this.scrollTimeout) {\r\n            clearTimeout(this.scrollTimeout);\r\n            this.scrollTimeout = null;\r\n        }\r\n    }\r\n\r\n    safeScrollTo(element, options = {}) {\r\n        if (!element) return;\r\n\r\n        this.cleanupScrolling();\r\n\r\n        this.scrollTimeout = setTimeout(() => {\r\n            try {\r\n                if (typeof element.scrollIntoView === 'function') {\r\n                    element.scrollIntoView({\r\n                        behavior: 'smooth',\r\n                        block: 'start',\r\n                        ...options\r\n                    });\r\n                }\r\n            } catch (err) {\r\n                console.warn('Error during scroll:', err);\r\n            }\r\n        }, 100);\r\n    }\r\n\r\n    generateUniqueId(prefix = 'custom') {\r\n        return `${prefix}-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\r\n    }\r\n\r\n    debounce(func, wait, immediate = false) {\r\n        let timeout;\r\n        return function executedFunction(...args) {\r\n            const later = () => {\r\n                timeout = null;\r\n                if (!immediate) func(...args);\r\n            };\r\n            const callNow = immediate && !timeout;\r\n            clearTimeout(timeout);\r\n            timeout = setTimeout(later, wait);\r\n            if (callNow) func(...args);\r\n        };\r\n    }\r\n\r\n    throttle(func, limit) {\r\n        let inThrottle;\r\n        return function(...args) {\r\n            if (!inThrottle) {\r\n                func.apply(this, args);\r\n                inThrottle = true;\r\n                setTimeout(() => inThrottle = false, limit);\r\n            }\r\n        };\r\n    }\r\n\r\n    sanitizeInput(input, maxLength = null) {\r\n        if (typeof input !== 'string') return '';\r\n        \r\n        let sanitized = input.trim();\r\n        \r\n        if (maxLength && sanitized.length > maxLength) {\r\n            sanitized = sanitized.substring(0, maxLength);\r\n        }\r\n        \r\n        return sanitized;\r\n    }\r\n\r\n    validateURL(url) {\r\n        try {\r\n            new URL(url);\r\n            return true;\r\n        } catch {\r\n            return false;\r\n        }\r\n    }\r\n\r\n    formatFileSize(bytes) {\r\n        if (bytes === 0) return '0 Bytes';\r\n        \r\n        const k = 1024;\r\n        const sizes = ['Bytes', 'KB', 'MB', 'GB'];\r\n        const i = Math.floor(Math.log(bytes) / Math.log(k));\r\n        \r\n        return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];\r\n    }\r\n\r\n    deepClone(obj) {\r\n        if (obj === null || typeof obj !== 'object') return obj;\r\n        if (obj instanceof Date) return new Date(obj.getTime());\r\n        if (obj instanceof Array) return obj.map(item => this.deepClone(item));\r\n        if (typeof obj === 'object') {\r\n            const clonedObj = {};\r\n            Object.keys(obj).forEach(key => {\r\n                clonedObj[key] = this.deepClone(obj[key]);\r\n            });\r\n            return clonedObj;\r\n        }\r\n    }\r\n\r\n    createElement(tag, className = '', content = '', attributes = {}) {\r\n        const element = document.createElement(tag);\r\n        \r\n        if (className) {\r\n            element.className = className;\r\n        }\r\n        \r\n        if (content) {\r\n            element.textContent = content;\r\n        }\r\n        \r\n        Object.entries(attributes).forEach(([key, value]) => {\r\n            element.setAttribute(key, value);\r\n        });\r\n        \r\n        return element;\r\n    }\r\n\r\n    removeElement(element) {\r\n        if (element && element.parentNode) {\r\n            element.parentNode.removeChild(element);\r\n        }\r\n    }\r\n\r\n    findElementById(id, container = document) {\r\n        return container.getElementById ? container.getElementById(id) : container.querySelector(`#${id}`);\r\n    }\r\n\r\n    findElementsByClass(className, container = document) {\r\n        return container.getElementsByClassName ? \r\n            Array.from(container.getElementsByClassName(className)) :\r\n            Array.from(container.querySelectorAll(`.${className}`));\r\n    }\r\n\r\n    addEventListenerSafe(element, event, handler, options = {}) {\r\n        if (element && typeof element.addEventListener === 'function') {\r\n            element.addEventListener(event, handler, options);\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    removeEventListenerSafe(element, event, handler, options = {}) {\r\n        if (element && typeof element.removeEventListener === 'function') {\r\n            element.removeEventListener(event, handler, options);\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    getElementDimensions(element) {\r\n        if (!element) return { width: 0, height: 0 };\r\n        \r\n        const rect = element.getBoundingClientRect();\r\n        return {\r\n            width: rect.width,\r\n            height: rect.height,\r\n            top: rect.top,\r\n            left: rect.left,\r\n            bottom: rect.bottom,\r\n            right: rect.right\r\n        };\r\n    }\r\n\r\n    isElementVisible(element) {\r\n        if (!element) return false;\r\n        \r\n        const style = window.getComputedStyle(element);\r\n        return style.display !== 'none' && \r\n               style.visibility !== 'hidden' && \r\n               style.opacity !== '0';\r\n    }\r\n\r\n    scrollToTop(container, smooth = true) {\r\n        if (!container) return;\r\n        \r\n        if (smooth && container.scrollTo) {\r\n            container.scrollTo({\r\n                top: 0,\r\n                behavior: 'smooth'\r\n            });\r\n        } else {\r\n            container.scrollTop = 0;\r\n        }\r\n    }\r\n\r\n    addClassSafe(element, className) {\r\n        if (element && element.classList) {\r\n            element.classList.add(className);\r\n        }\r\n    }\r\n\r\n    removeClassSafe(element, className) {\r\n        if (element && element.classList) {\r\n            element.classList.remove(className);\r\n        }\r\n    }\r\n\r\n    toggleClassSafe(element, className) {\r\n        if (element && element.classList) {\r\n            element.classList.toggle(className);\r\n        }\r\n    }\r\n\r\n    hasClassSafe(element, className) {\r\n        return element && element.classList && element.classList.contains(className);\r\n    }\r\n\r\n    setStyleSafe(element, property, value) {\r\n        if (element && element.style) {\r\n            element.style[property] = value;\r\n        }\r\n    }\r\n\r\n    getStyleSafe(element, property) {\r\n        if (element && element.style) {\r\n            return element.style[property];\r\n        }\r\n        return null;\r\n    }\r\n\r\n    forceReflow(element) {\r\n        if (element) {\r\n            void element.offsetHeight; // Force reflow\r\n        }\r\n    }\r\n\r\n    waitForElement(selector, timeout = 5000) {\r\n        return new Promise((resolve, reject) => {\r\n            const element = document.querySelector(selector);\r\n            if (element) {\r\n                resolve(element);\r\n                return;\r\n            }\r\n\r\n            const observer = new MutationObserver((mutations, obs) => {\r\n                const element = document.querySelector(selector);\r\n                if (element) {\r\n                    obs.disconnect();\r\n                    resolve(element);\r\n                }\r\n            });\r\n\r\n            observer.observe(document.body, {\r\n                childList: true,\r\n                subtree: true\r\n            });\r\n\r\n            setTimeout(() => {\r\n                observer.disconnect();\r\n                reject(new Error(`Element ${selector} not found within ${timeout}ms`));\r\n            }, timeout);\r\n        });\r\n    }\r\n\r\n    async waitFor(condition, timeout = 5000, interval = 100) {\r\n        const startTime = Date.now();\r\n        \r\n        while (Date.now() - startTime < timeout) {\r\n            if (condition()) {\r\n                return true;\r\n            }\r\n            await new Promise(resolve => setTimeout(resolve, interval));\r\n        }\r\n        \r\n        throw new Error('Condition not met within timeout');\r\n    }\r\n\r\n    cleanup() {\r\n        this.cleanupScrolling();\r\n    }\r\n}","// customSystemCreator.js - Refactored UI for creating custom star systems with AI-generated assets\r\n\r\nimport { ApiClient } from '../utils/apiClient.js';\r\nimport { StyleManager } from './components/customSystem/styles.js';\r\nimport { ValidationManager } from './components/customSystem/validation.js';\r\nimport { SystemDataManager } from './components/customSystem/systemData.js';\r\nimport { FormViewManager } from './components/customSystem/formView.js';\r\nimport { PreviewManager } from './components/customSystem/preview.js';\r\nimport { EventHandlerManager } from './components/customSystem/eventHandlers.js';\r\nimport { HelperManager } from './components/customSystem/helpers.js';\r\n\r\nexport class CustomSystemCreator {\r\n    constructor(starSystemGenerator, environment) {\r\n        this.starSystemGenerator = starSystemGenerator;\r\n        this.environment = environment;\r\n        this.apiClient = new ApiClient();\r\n        this.isVisible = false;\r\n        this.isGenerating = false;\r\n        this.generatedSkyboxUrl = null;\r\n        this.generatedPlanetUrls = [];\r\n        this.systemData = null;\r\n        \r\n        // Initialize helper utilities\r\n        this.helpers = new HelperManager();\r\n        this.isMobile = this.helpers.detectMobile();\r\n        \r\n        // Initialize managers\r\n        this.styleManager = new StyleManager(this.isMobile);\r\n        this.validationManager = new ValidationManager(this.isMobile);\r\n        this.systemDataManager = new SystemDataManager();\r\n        this.formViewManager = new FormViewManager(this.isMobile, this.styleManager);\r\n        this.previewManager = new PreviewManager(this.isMobile);\r\n        this.eventHandlerManager = new EventHandlerManager(this, this.isMobile);\r\n        \r\n        // Initialize UI\r\n        this.createUI();\r\n        this.setupEventHandlers();\r\n        this.setupSliderListeners(1);\r\n    }\r\n    \r\n    createUI() {\r\n        // Inject styles\r\n        this.styleManager.injectStyles();\r\n        \r\n        // Create main container\r\n        this.container = this.formViewManager.createMainContainer();\r\n        this.container.innerHTML = this.formViewManager.createModalContent();\r\n        \r\n        // Add to document\r\n        document.body.appendChild(this.container);\r\n        \r\n        // Capture references to elements\r\n        this.captureElementReferences();\r\n        \r\n        // Add mobile enhancements\r\n        if (this.isMobile) {\r\n            this.setupMobileEnhancements();\r\n        }\r\n    }\r\n    \r\n    captureElementReferences() {\r\n        this.systemNameInput = document.getElementById('system-name');\r\n        this.skyboxDescription = document.getElementById('skybox-description');\r\n        this.planetDescriptions = document.getElementById('planet-descriptions');\r\n        this.addPlanetBtn = document.getElementById('add-planet-btn');\r\n        this.generateSystemBtn = document.getElementById('generate-system-btn');\r\n        this.generationProgress = document.getElementById('generation-progress');\r\n        this.generationStatus = document.getElementById('generation-status');\r\n        this.systemForm = document.getElementById('system-creator-form');\r\n        this.systemPreview = document.getElementById('system-preview');\r\n        this.skyboxPreviewImg = document.getElementById('skybox-preview-img');\r\n        this.planetsPreview = document.getElementById('planets-preview');\r\n        this.travelToSystemBtn = document.getElementById('travel-to-system-btn');\r\n        this.regenerateSystemBtn = document.getElementById('regenerate-system-btn');\r\n        this.closeBtn = document.getElementById('close-system-creator');\r\n    }\r\n    \r\n    setupMobileEnhancements() {\r\n        this.formViewManager.addRippleEffect(this.container);\r\n        this.validationManager.setupCharacterCounters(this.skyboxDescription, this.planetDescriptions);\r\n    }\r\n    \r\n    setupEventHandlers() {\r\n        const elements = {\r\n            closeBtn: this.closeBtn,\r\n            addPlanetBtn: this.addPlanetBtn,\r\n            generateSystemBtn: this.generateSystemBtn,\r\n            travelToSystemBtn: this.travelToSystemBtn,\r\n            regenerateSystemBtn: this.regenerateSystemBtn,\r\n            systemForm: this.systemForm,\r\n            systemPreview: this.systemPreview,\r\n            systemNameInput: this.systemNameInput,\r\n            skyboxDescription: this.skyboxDescription\r\n        };\r\n        \r\n        this.eventHandlerManager.setupAllEventHandlers(this.container, elements);\r\n        this.eventHandlerManager.setupValidationHandlers(elements, this.validationManager);\r\n    }\r\n    \r\n    addPlanetInput() {\r\n        const planetDiv = this.formViewManager.addPlanetInput(\r\n            this.planetDescriptions,\r\n            this.setupSliderListeners.bind(this),\r\n            this.updatePlanetNumbers.bind(this),\r\n            this.playUISound.bind(this)\r\n        );\r\n        \r\n        // Add character counter for new planet description if mobile\r\n        if (this.isMobile) {\r\n            const planetDesc = planetDiv.querySelector(`textarea[id^=\"planet-description-\"]`);\r\n            if (planetDesc) {\r\n                this.validationManager.addCharacterCounter(planetDesc, 150);\r\n            }\r\n        }\r\n    }\r\n    \r\n    setupSliderListeners(index) {\r\n        this.formViewManager.setupSliderListeners(index);\r\n    }\r\n    \r\n    updatePlanetNumbers() {\r\n        this.formViewManager.updatePlanetNumbers(this.planetDescriptions);\r\n    }\r\n    \r\n    async generateSystem() {\r\n        // Validate inputs\r\n        const systemValidation = this.validationManager.validateSystemForm(\r\n            this.systemNameInput, \r\n            this.skyboxDescription\r\n        );\r\n        \r\n        if (!systemValidation.isValid) {\r\n            this.validationManager.showMobileAlert(systemValidation.message, this.playUISound.bind(this));\r\n            return;\r\n        }\r\n        \r\n        const planetInputs = this.planetDescriptions.getElementsByClassName('planet-input');\r\n        const planetValidation = this.validationManager.validatePlanetCount(planetInputs);\r\n        \r\n        if (!planetValidation.isValid) {\r\n            this.validationManager.showMobileAlert(planetValidation.message, this.playUISound.bind(this));\r\n            return;\r\n        }\r\n        \r\n        // Collect and validate planet data\r\n        const { planets, errors } = this.validationManager.collectPlanetData(planetInputs);\r\n        \r\n        if (errors.length > 0) {\r\n            this.validationManager.showMobileAlert(errors[0], this.playUISound.bind(this));\r\n            return;\r\n        }\r\n        \r\n        // Show progress UI\r\n        this.previewManager.showProgress('Initializing...');\r\n        this.isGenerating = true;\r\n        \r\n        try {\r\n            // Check for auth token or get one\r\n            if (!this.apiClient.hasValidToken()) {\r\n                this.previewManager.updateGenerationStatus('Authenticating...');\r\n                await this.apiClient.getToken();\r\n            }\r\n            \r\n            // Generate skybox\r\n            this.previewManager.updateGenerationStatus('Generating skybox...');\r\n            const skyboxResponse = await this.apiClient.generateSkybox(\r\n                this.systemNameInput.value.trim(), \r\n                this.skyboxDescription.value.trim()\r\n            );\r\n            \r\n            if (!skyboxResponse.success || !skyboxResponse.image_paths?.length) {\r\n                throw new Error(skyboxResponse.message || 'Failed to generate skybox');\r\n            }\r\n            \r\n            this.generatedSkyboxUrl = skyboxResponse.image_paths[0];\r\n            \r\n            // Generate planets\r\n            this.generatedPlanetUrls = [];\r\n            for (let i = 0; i < planets.length; i++) {\r\n                const planet = planets[i];\r\n                this.previewManager.updateGenerationStatus(\r\n                    `Generating planet ${i+1} of ${planets.length}: ${planet.name}...`\r\n                );\r\n                \r\n                const planetResponse = await this.apiClient.generatePlanet(planet.name, planet.description);\r\n                \r\n                if (planetResponse.success && planetResponse.image_paths?.length) {\r\n                    this.generatedPlanetUrls.push({\r\n                        name: planet.name,\r\n                        url: planetResponse.image_paths[0]\r\n                    });\r\n                }\r\n            }\r\n            \r\n            // Create system data\r\n            const starClass = document.getElementById('star-class').value;\r\n            this.systemData = this.systemDataManager.createSystemData(\r\n                this.systemNameInput.value.trim(),\r\n                starClass,\r\n                this.generatedSkyboxUrl,\r\n                planets.map((planet, i) => ({\r\n                    ...planet,\r\n                    textureUrl: this.generatedPlanetUrls[i]?.url || null\r\n                }))\r\n            );\r\n            \r\n            // Show preview\r\n            this.previewManager.showSystemPreview(\r\n                this.generatedSkyboxUrl, \r\n                this.generatedPlanetUrls, \r\n                this.apiClient\r\n            );\r\n            \r\n        } catch (error) {\r\n            console.error('Error generating system:', error);\r\n            this.validationManager.showMobileAlert(\r\n                `Failed to generate system: ${error.message}`, \r\n                this.playUISound.bind(this)\r\n            );\r\n            this.previewManager.hideProgress();\r\n        }\r\n        \r\n        this.isGenerating = false;\r\n    }\r\n    \r\n    travelToSystem() {\r\n        if (!this.systemData) {\r\n            this.validationManager.showMobileAlert(\r\n                'No system data available. Please generate a system first.',\r\n                this.playUISound.bind(this)\r\n            );\r\n            return;\r\n        }\r\n        \r\n        try {\r\n            const success = this.starSystemGenerator.addCustomSystem(this.systemData);\r\n            \r\n            if (!success) {\r\n                throw new Error('Failed to add custom system');\r\n            }\r\n            \r\n            this.hide();\r\n            \r\n            if (this.environment?.travelToSystem) {\r\n                this.environment.travelToSystem(this.systemData.id);\r\n            } else {\r\n                console.error('Environment or travelToSystem method not available');\r\n            }\r\n            \r\n        } catch (error) {\r\n            console.error('Error traveling to custom system:', error);\r\n            this.validationManager.showMobileAlert(\r\n                `Failed to travel to custom system: ${error.message}`,\r\n                this.playUISound.bind(this)\r\n            );\r\n        }\r\n    }\r\n    \r\n    playUISound() {\r\n        this.helpers.playUISound();\r\n    }\r\n    \r\n    show() {\r\n        if (!this.container) return;\r\n        \r\n        this.cleanupBeforeHiding();\r\n        this.container.style.display = 'flex';\r\n        this.isVisible = true;\r\n        \r\n        // Reset UI state\r\n        this.previewManager.resetToForm();\r\n        this.playUISound();\r\n        \r\n        // Handle mobile-specific setup\r\n        if (this.isMobile) {\r\n            this.setupMobileShow();\r\n        } else {\r\n            this.setupDesktopShow();\r\n        }\r\n    }\r\n    \r\n    setupMobileShow() {\r\n        const modalContent = this.container.querySelector('.modal-content');\r\n        if (modalContent) {\r\n            this.helpers.scrollToTop(modalContent);\r\n            this.helpers.setStyleSafe(modalContent, 'overflowY', 'auto');\r\n            this.helpers.setStyleSafe(modalContent, 'webkitOverflowScrolling', 'touch');\r\n            this.helpers.setStyleSafe(modalContent, 'overscrollBehavior', 'contain');\r\n        }\r\n        \r\n        this.helpers.addClassSafe(document.body, 'modal-open');\r\n        \r\n        // Delayed focus to avoid iOS keyboard issues\r\n        setTimeout(() => {\r\n            if (this.systemNameInput) {\r\n                this.systemNameInput.focus();\r\n            }\r\n        }, 300);\r\n    }\r\n    \r\n    setupDesktopShow() {\r\n        setTimeout(() => {\r\n            if (this.systemNameInput) {\r\n                this.systemNameInput.focus();\r\n            }\r\n        }, 300);\r\n    }\r\n    \r\n    hide() {\r\n        if (!this.container || this.isGenerating) return;\r\n        \r\n        this.cleanupBeforeHiding();\r\n        this.container.style.display = 'none';\r\n        this.isVisible = false;\r\n        this.playUISound();\r\n        \r\n        // Return to stargate UI\r\n        setTimeout(() => {\r\n            if (window.game?.ui?.stargateInterface) {\r\n                console.log(\"CustomSystemCreator: Returning to stargate UI\");\r\n                window.game.ui.stargateInterface.showStargateUI();\r\n            } else {\r\n                const stargateUI = document.getElementById('stargate-ui');\r\n                if (stargateUI) {\r\n                    stargateUI.style.display = 'block';\r\n                    console.log(\"CustomSystemCreator: Showed stargate UI via direct DOM access\");\r\n                } else {\r\n                    console.warn(\"CustomSystemCreator: Could not find stargate UI to return to\");\r\n                }\r\n            }\r\n        }, 100);\r\n    }\r\n    \r\n    toggle() {\r\n        if (this.isVisible) {\r\n            this.hide();\r\n        } else {\r\n            this.show();\r\n        }\r\n    }\r\n    \r\n    cleanupBeforeHiding() {\r\n        if (this.isGenerating) {\r\n            this.isGenerating = false;\r\n            this.previewManager.hideProgress();\r\n        }\r\n        \r\n        this.helpers.cleanupScrolling();\r\n        this.helpers.setStyleSafe(document.body, 'pointerEvents', 'auto');\r\n        \r\n        if (this.isMobile) {\r\n            this.helpers.setStyleSafe(document.body, 'touchAction', 'auto');\r\n            this.helpers.removeClassSafe(document.body, 'modal-open');\r\n            this.helpers.forceReflow(this.container);\r\n        }\r\n    }\r\n    \r\n    destroy() {\r\n        this.cleanupBeforeHiding();\r\n        this.eventHandlerManager.cleanup();\r\n        this.styleManager.cleanup();\r\n        this.helpers.cleanup();\r\n        this.formViewManager.cleanup();\r\n        \r\n        if (this.container?.parentNode) {\r\n            this.container.parentNode.removeChild(this.container);\r\n        }\r\n    }\r\n}","// vibeVersePortals.js - Implements VibeVerse portal entrance and exit\r\n\r\nimport * as THREE from 'three';\r\n\r\nexport class VibeVersePortals {\r\n    constructor(scene, spaceship) {\r\n        this.scene = scene;\r\n        this.spaceship = spaceship;\r\n        this.startPortalGroup = null;\r\n        this.exitPortalGroup = null;\r\n        this.startPortalBox = null;\r\n        this.exitPortalBox = null;\r\n        this.startPortalParticleSystem = null;\r\n        this.exitPortalParticleSystem = null;\r\n        \r\n        // Check if we should create a start portal\r\n        this.shouldCreateStartPortal = new URLSearchParams(window.location.search).has('portal');\r\n        \r\n        // Get reference URL if it exists\r\n        this.refUrl = new URLSearchParams(window.location.search).get('ref') || '';\r\n        \r\n        // Initialize portals\r\n        this.init();\r\n    }\r\n    \r\n    init() {\r\n        // Create start portal if needed (based on URL parameter)\r\n        if (this.shouldCreateStartPortal) {\r\n            this.createStartPortal();\r\n        }\r\n        \r\n        // Exit portal removed - no longer creating it\r\n    }\r\n    \r\n    createStartPortal() {\r\n        // Create a portal group\r\n        this.startPortalGroup = new THREE.Group();\r\n        this.startPortalGroup.name = 'startPortal';\r\n        \r\n        // Create portal ring - INCREASED SIZE\r\n        const ringGeometry = new THREE.TorusGeometry(150, 15, 32, 100);\r\n        const ringMaterial = new THREE.MeshStandardMaterial({\r\n            color: 0xff0000,\r\n            emissive: 0xff0000,\r\n            emissiveIntensity: 0.5,\r\n            roughness: 0.3,\r\n            metalness: 0.7\r\n        });\r\n        const ring = new THREE.Mesh(ringGeometry, ringMaterial);\r\n        this.startPortalGroup.add(ring);\r\n        \r\n        // Create portal surface (semi-transparent) - INCREASED SIZE\r\n        const surfaceGeometry = new THREE.CircleGeometry(135, 32);\r\n        const surfaceMaterial = new THREE.MeshBasicMaterial({\r\n            color: 0xff0000,\r\n            transparent: true,\r\n            opacity: 0.3,\r\n            side: THREE.DoubleSide\r\n        });\r\n        const surface = new THREE.Mesh(surfaceGeometry, surfaceMaterial);\r\n        surface.position.z = 0.1; // Slight offset to avoid z-fighting\r\n        this.startPortalGroup.add(surface);\r\n        \r\n        // Create particle system\r\n        const particleCount = 500;\r\n        const particleGeometry = new THREE.BufferGeometry();\r\n        const positions = new Float32Array(particleCount * 3);\r\n        \r\n        // Position particles in a ring pattern - ADJUSTED FOR LARGER SIZE\r\n        for (let i = 0; i < particleCount; i++) {\r\n            const angle = (i / particleCount) * Math.PI * 2;\r\n            const radius = 135 + (Math.random() * 30 - 15); // Random variation around the ring\r\n            \r\n            positions[i * 3] = Math.cos(angle) * radius;\r\n            positions[i * 3 + 1] = Math.sin(angle) * radius;\r\n            positions[i * 3 + 2] = (Math.random() - 0.5) * 15; // Small variation in z\r\n        }\r\n        \r\n        particleGeometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));\r\n        \r\n        const particleMaterial = new THREE.PointsMaterial({\r\n            color: 0xff5555,\r\n            size: 3.5, // Increased particle size\r\n            blending: THREE.AdditiveBlending,\r\n            transparent: true\r\n        });\r\n        \r\n        this.startPortalParticleSystem = new THREE.Points(particleGeometry, particleMaterial);\r\n        this.startPortalGroup.add(this.startPortalParticleSystem);\r\n        \r\n        // Position the portal higher above the stargate and centered on y-axis\r\n        this.startPortalGroup.position.set(0, 15000, 0); // Centered above stargate\r\n        this.startPortalGroup.rotation.x = Math.PI / 2; // Face straight down\r\n        \r\n        // Add to scene\r\n        this.scene.add(this.startPortalGroup);\r\n        \r\n        // Create collision box\r\n        this.startPortalBox = new THREE.Box3().setFromObject(this.startPortalGroup);\r\n        \r\n        console.log(\"Start portal created at position:\", this.startPortalGroup.position);\r\n    }\r\n    \r\n    createExitPortal() {\r\n        // Create a portal group\r\n        this.exitPortalGroup = new THREE.Group();\r\n        this.exitPortalGroup.name = 'exitPortal';\r\n        \r\n        // Create portal ring - INCREASED SIZE\r\n        const ringGeometry = new THREE.TorusGeometry(150, 15, 32, 100);\r\n        const ringMaterial = new THREE.MeshStandardMaterial({\r\n            color: 0x00ff00,\r\n            emissive: 0x00ff00,\r\n            emissiveIntensity: 0.5,\r\n            roughness: 0.3,\r\n            metalness: 0.7\r\n        });\r\n        const ring = new THREE.Mesh(ringGeometry, ringMaterial);\r\n        this.exitPortalGroup.add(ring);\r\n        \r\n        // Create portal surface (semi-transparent) - INCREASED SIZE\r\n        const surfaceGeometry = new THREE.CircleGeometry(135, 32);\r\n        const surfaceMaterial = new THREE.MeshBasicMaterial({\r\n            color: 0x00ff00,\r\n            transparent: true,\r\n            opacity: 0.3,\r\n            side: THREE.DoubleSide\r\n        });\r\n        const surface = new THREE.Mesh(surfaceGeometry, surfaceMaterial);\r\n        surface.position.z = 0.1; // Slight offset to avoid z-fighting\r\n        this.exitPortalGroup.add(surface);\r\n        \r\n        // Create particle system\r\n        const particleCount = 500;\r\n        const particleGeometry = new THREE.BufferGeometry();\r\n        const positions = new Float32Array(particleCount * 3);\r\n        \r\n        // Position particles in a ring pattern - ADJUSTED FOR LARGER SIZE\r\n        for (let i = 0; i < particleCount; i++) {\r\n            const angle = (i / particleCount) * Math.PI * 2;\r\n            const radius = 135 + (Math.random() * 30 - 15); // Random variation around the ring\r\n            \r\n            positions[i * 3] = Math.cos(angle) * radius;\r\n            positions[i * 3 + 1] = Math.sin(angle) * radius;\r\n            positions[i * 3 + 2] = (Math.random() - 0.5) * 15; // Small variation in z\r\n        }\r\n        \r\n        particleGeometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));\r\n        \r\n        const particleMaterial = new THREE.PointsMaterial({\r\n            color: 0x55ff55,\r\n            size: 3.5, // Increased particle size\r\n            blending: THREE.AdditiveBlending,\r\n            transparent: true\r\n        });\r\n        \r\n        this.exitPortalParticleSystem = new THREE.Points(particleGeometry, particleMaterial);\r\n        this.exitPortalGroup.add(this.exitPortalParticleSystem);\r\n        \r\n        // Create text label for the portal - INCREASED SIZE\r\n        const canvas = document.createElement('canvas');\r\n        canvas.width = 1024; // Increased size\r\n        canvas.height = 256; // Increased size\r\n        const ctx = canvas.getContext('2d');\r\n        ctx.fillStyle = 'black';\r\n        ctx.fillRect(0, 0, canvas.width, canvas.height);\r\n        ctx.font = '72px Arial'; // Increased font size\r\n        ctx.fillStyle = '#00ff00';\r\n        ctx.textAlign = 'center';\r\n        ctx.textBaseline = 'middle';\r\n        ctx.fillText('VIBEVERSE PORTAL', canvas.width / 2, canvas.height / 2);\r\n        \r\n        const texture = new THREE.CanvasTexture(canvas);\r\n        const labelGeometry = new THREE.PlaneGeometry(200, 50); // Increased size\r\n        const labelMaterial = new THREE.MeshBasicMaterial({\r\n            map: texture,\r\n            transparent: true,\r\n            side: THREE.DoubleSide\r\n        });\r\n        \r\n        const label = new THREE.Mesh(labelGeometry, labelMaterial);\r\n        label.position.set(0, 200, 0); // Position above the portal (increased)\r\n        this.exitPortalGroup.add(label);\r\n        \r\n        // Position the portal higher above the stargate and centered on y-axis\r\n        this.exitPortalGroup.position.set(0, 16000, 0); // Centered above stargate, bit higher than start portal\r\n        this.exitPortalGroup.rotation.x = Math.PI / 2; // Face straight down\r\n        \r\n        // Add to scene\r\n        this.scene.add(this.exitPortalGroup);\r\n        \r\n        // Create collision box\r\n        this.exitPortalBox = new THREE.Box3().setFromObject(this.exitPortalGroup);\r\n        \r\n        console.log(\"Exit portal created at position:\", this.exitPortalGroup.position);\r\n    }\r\n    \r\n    animateStartPortal(deltaTime) {\r\n        if (!this.startPortalGroup || !this.startPortalParticleSystem) return;\r\n        \r\n        // Rotate particle system\r\n        this.startPortalParticleSystem.rotation.z += deltaTime * 0.5;\r\n        \r\n        // Update collision box (only periodically to save performance)\r\n        if (Math.random() < 0.05) {\r\n            this.startPortalBox.setFromObject(this.startPortalGroup);\r\n        }\r\n    }\r\n    \r\n    animateExitPortal(deltaTime) {\r\n        if (!this.exitPortalGroup || !this.exitPortalParticleSystem) return;\r\n        \r\n        // Rotate particle system\r\n        this.exitPortalParticleSystem.rotation.z += deltaTime * 0.5;\r\n        \r\n        // Update collision box (only periodically to save performance)\r\n        if (Math.random() < 0.05) {\r\n            this.exitPortalBox.setFromObject(this.exitPortalGroup);\r\n        }\r\n    }\r\n    \r\n    checkPortalInteractions(deltaTime) {\r\n        if (!this.spaceship || !this.spaceship.mesh) return;\r\n        \r\n        // Create a box for the spaceship (used for collision detection)\r\n        const shipBox = new THREE.Box3().setFromObject(this.spaceship.mesh);\r\n        \r\n        // Check start portal interaction (if it exists)\r\n        if (this.startPortalGroup && this.startPortalBox) {\r\n            const distance = this.spaceship.mesh.position.distanceTo(this.startPortalGroup.position);\r\n            \r\n            // If player is close to the start portal - INCREASED DETECTION RANGE\r\n            if (distance < 400) { // Increased from 200 to match much larger portal size\r\n                // Check for collision\r\n                if (shipBox.intersectsBox(this.startPortalBox)) {\r\n                    this.handleStartPortalEntry();\r\n                }\r\n            }\r\n        }\r\n        \r\n        // Exit portal interaction removed\r\n    }\r\n    \r\n    handleStartPortalEntry() {\r\n        // Prevent multiple redirects\r\n        if (this._isRedirecting) return;\r\n        this._isRedirecting = true;\r\n        \r\n        console.log(\"Player entered start portal\");\r\n        \r\n        // Get the reference URL from the query parameter\r\n        let targetUrl = this.refUrl;\r\n        \r\n        // Make sure the URL has the https:// prefix\r\n        if (targetUrl && !targetUrl.startsWith('http')) {\r\n            targetUrl = 'https://' + targetUrl;\r\n        }\r\n        \r\n        // If no target URL, do nothing\r\n        if (!targetUrl) {\r\n            console.error(\"No target URL specified for portal\");\r\n            this._isRedirecting = false;\r\n            return;\r\n        }\r\n        \r\n        // Parse current URL parameters (excluding 'ref')\r\n        const currentParams = new URLSearchParams(window.location.search);\r\n        currentParams.delete('ref');\r\n        currentParams.delete('portal');\r\n        \r\n        // Create a URL object for the target\r\n        let finalUrl;\r\n        try {\r\n            finalUrl = new URL(targetUrl);\r\n            \r\n            // Append any other current parameters to the target URL\r\n            for (const [key, value] of currentParams.entries()) {\r\n                finalUrl.searchParams.append(key, value);\r\n            }\r\n        } catch (e) {\r\n            console.error(\"Invalid target URL:\", targetUrl);\r\n            this._isRedirecting = false;\r\n            return;\r\n        }\r\n        \r\n        console.log(\"Redirecting to:\", finalUrl.toString());\r\n        \r\n        // Short delay before redirecting\r\n        setTimeout(() => {\r\n            window.location.href = finalUrl.toString();\r\n        }, 100);\r\n    }\r\n    \r\n    handleExitPortalEntry() {\r\n        // Prevent multiple redirects\r\n        if (this._isRedirecting) return;\r\n        this._isRedirecting = true;\r\n        \r\n        console.log(\"Player entered exit portal\");\r\n        \r\n        // Construct next page URL\r\n        let nextPage = 'https://portal.pieter.com';\r\n        \r\n        // Get current parameters\r\n        const currentParams = new URLSearchParams(window.location.search);\r\n        \r\n        // Create URL object\r\n        const url = new URL(nextPage);\r\n        \r\n        // Add required parameters\r\n        url.searchParams.append('portal', 'true');\r\n        url.searchParams.append('username', this.getUsername());\r\n        url.searchParams.append('color', 'white'); // Default color\r\n        url.searchParams.append('speed', this.getPlayerSpeed());\r\n        \r\n        // Copy other parameters from current URL\r\n        for (const [key, value] of currentParams.entries()) {\r\n            if (!['portal', 'username', 'color', 'speed'].includes(key)) {\r\n                url.searchParams.append(key, value);\r\n            }\r\n        }\r\n        \r\n        console.log(\"Redirecting to:\", url.toString());\r\n        \r\n        // Short delay before redirecting\r\n        setTimeout(() => {\r\n            window.location.href = url.toString();\r\n        }, 100);\r\n    }\r\n    \r\n    getUsername() {\r\n        // Get username from game state if available\r\n        if (window.game && window.game.selfUsername) {\r\n            return window.game.selfUsername;\r\n        }\r\n        \r\n        // Fallback: generate a random username\r\n        return `Miner${Math.floor(Math.random() * 10000)}`;\r\n    }\r\n    \r\n    getPlayerSpeed() {\r\n        // Get current speed from game state if available\r\n        if (window.game && window.game.currentSpeed) {\r\n            return window.game.currentSpeed.toString();\r\n        }\r\n        \r\n        // Try to get speed from spaceship if available\r\n        if (this.spaceship && this.spaceship.velocity) {\r\n            return this.spaceship.velocity.length().toString();\r\n        }\r\n        \r\n        // Fallback: default speed\r\n        return '10';\r\n    }\r\n    \r\n    update(deltaTime) {\r\n        // Animate start portal only (if it exists)\r\n        this.animateStartPortal(deltaTime);\r\n        \r\n        // Check for portal interactions\r\n        this.checkPortalInteractions(deltaTime);\r\n    }\r\n    \r\n    dispose() {\r\n        // Clean up resources\r\n        if (this.startPortalGroup) {\r\n            this.scene.remove(this.startPortalGroup);\r\n        }\r\n        \r\n        if (this.exitPortalGroup) {\r\n            this.scene.remove(this.exitPortalGroup);\r\n        }\r\n        \r\n        // Clear references\r\n        this.startPortalGroup = null;\r\n        this.exitPortalGroup = null;\r\n        this.startPortalBox = null;\r\n        this.exitPortalBox = null;\r\n        this.startPortalParticleSystem = null;\r\n        this.exitPortalParticleSystem = null;\r\n    }\r\n} ","// vortex.js - Vortex anomaly with spiraling rings\r\n\r\nimport * as THREE from 'three';\r\n\r\nexport class VortexAnomaly {\r\n    constructor(scene, anomalyScale = 4, orbScale = 4) {\r\n        this.scene = scene;\r\n        this.anomalyScale = anomalyScale;\r\n        this.orbScale = orbScale;\r\n    }\r\n\r\n    create(position, createEnergyOrbCallback, getRandomOrbRarityCallback, addToSceneCallback) {\r\n        // Create a spiraling vortex structure with central orb\r\n        const anomalyGroup = new THREE.Group();\r\n        anomalyGroup.position.copy(position);\r\n        \r\n        // Apply scale to make anomaly 4x bigger\r\n        anomalyGroup.scale.set(this.anomalyScale, this.anomalyScale, this.anomalyScale);\r\n        \r\n        // Create the structural elements - spiral rings\r\n        const ringCount = 6;\r\n        const rings = [];\r\n        \r\n        // Create multiple rings with decreasing radius\r\n        for (let i = 0; i < ringCount; i++) {\r\n            const radius = 400 - (i * 50);\r\n            const geometry = new THREE.TorusGeometry(radius, 15, 16, 100); // Increased tube radius from 10 to 15\r\n            \r\n            // Bright blue-cyan color scheme for better visibility\r\n            const hue = 0.5 + (i * 0.05); // Blue to cyan gradient\r\n            const color = new THREE.Color().setHSL(hue, 0.9, 0.6); // Increased saturation and lightness\r\n            \r\n            const material = new THREE.MeshStandardMaterial({\r\n                color: color,\r\n                emissive: color.clone().multiplyScalar(0.5),\r\n                emissiveIntensity: 1.0,\r\n                metalness: 0.8,\r\n                roughness: 0.2,\r\n                transparent: true,\r\n                opacity: 0.95\r\n            });\r\n            \r\n            const ring = new THREE.Mesh(geometry, material);\r\n            \r\n            // Rotate each ring at different angles to create spiral effect\r\n            ring.rotation.x = Math.PI / 2 + (i * 0.2);\r\n            ring.rotation.y = i * 0.3;\r\n            \r\n            anomalyGroup.add(ring);\r\n            rings.push({\r\n                mesh: ring,\r\n                rotationSpeed: {\r\n                    x: 0.005 + (i * 0.002),\r\n                    y: 0.003 + (i * 0.001),\r\n                    z: 0.001 + (i * 0.0005)\r\n                }\r\n            });\r\n        }\r\n        \r\n        // Create energy orb in the center\r\n        const orbRarity = getRandomOrbRarityCallback();\r\n        const orb = createEnergyOrbCallback(orbRarity);\r\n        anomalyGroup.add(orb.mesh);\r\n        \r\n        // Add to scene\r\n        addToSceneCallback(anomalyGroup);\r\n        \r\n        // Return anomaly data\r\n        return {\r\n            type: 'vortex',\r\n            mesh: anomalyGroup,\r\n            position: position.clone(),\r\n            rings: rings,\r\n            orb: orb,\r\n            collisionRadius: 350, // Overall collision size\r\n            orbCollected: false,\r\n            rotationSpeed: new THREE.Vector3(0.001, 0.002, 0.0015)\r\n        };\r\n    }\r\n\r\n    update(anomaly, deltaTime) {\r\n        // Rotate each ring\r\n        anomaly.rings.forEach(ring => {\r\n            ring.mesh.rotation.x += ring.rotationSpeed.x * deltaTime;\r\n            ring.mesh.rotation.y += ring.rotationSpeed.y * deltaTime;\r\n            ring.mesh.rotation.z += ring.rotationSpeed.z * deltaTime;\r\n        });\r\n    }\r\n\r\n    cleanup(anomaly) {\r\n        // Clean up rings\r\n        if (anomaly.rings) {\r\n            anomaly.rings.forEach(ring => {\r\n                if (ring.mesh && ring.mesh.geometry) {\r\n                    ring.mesh.geometry.dispose();\r\n                }\r\n                if (ring.mesh && ring.mesh.material) {\r\n                    if (Array.isArray(ring.mesh.material)) {\r\n                        ring.mesh.material.forEach(m => m.dispose());\r\n                    } else {\r\n                        ring.mesh.material.dispose();\r\n                    }\r\n                }\r\n            });\r\n        }\r\n    }\r\n}","// crystalCluster.js - Crystal cluster anomaly with floating crystals\r\n\r\nimport * as THREE from 'three';\r\n\r\nexport class CrystalClusterAnomaly {\r\n    constructor(scene, anomalyScale = 4, orbScale = 4) {\r\n        this.scene = scene;\r\n        this.anomalyScale = anomalyScale;\r\n        this.orbScale = orbScale;\r\n    }\r\n\r\n    create(position, createEnergyOrbCallback, getRandomOrbRarityCallback, addToSceneCallback) {\r\n        // Create a crystalline structure with floating crystals and central orb\r\n        const anomalyGroup = new THREE.Group();\r\n        anomalyGroup.position.copy(position);\r\n        \r\n        // Apply scale to make anomaly 4x bigger\r\n        anomalyGroup.scale.set(this.anomalyScale, this.anomalyScale, this.anomalyScale);\r\n        \r\n        // Create main crystal structure using multiple crystal forms\r\n        const crystals = [];\r\n        const crystalCount = 20;\r\n        \r\n        for (let i = 0; i < crystalCount; i++) {\r\n            // Random crystal size\r\n            const size = 50 + Math.random() * 100; // Increased from 30+80 to 50+100\r\n            \r\n            // Create crystal geometry - mix of different polyhedra\r\n            let geometry;\r\n            const crystalType = Math.floor(Math.random() * 3);\r\n            \r\n            if (crystalType === 0) {\r\n                // Octahedron - diamond-like crystal\r\n                geometry = new THREE.OctahedronGeometry(size, 0);\r\n            } else if (crystalType === 1) {\r\n                // Dodecahedron - more complex crystal\r\n                geometry = new THREE.DodecahedronGeometry(size, 0);\r\n            } else {\r\n                // Prism-like crystal using stretched tetrahedron\r\n                geometry = new THREE.TetrahedronGeometry(size, 0);\r\n                \r\n                // Stretch it to make it more crystal-like\r\n                const positions = geometry.attributes.position;\r\n                for (let j = 0; j < positions.count; j++) {\r\n                    const vertex = new THREE.Vector3();\r\n                    vertex.fromBufferAttribute(positions, j);\r\n                    \r\n                    // Stretch along one axis\r\n                    vertex.y *= 2.5;\r\n                    \r\n                    positions.setXYZ(j, vertex.x, vertex.y, vertex.z);\r\n                }\r\n                geometry.computeVertexNormals();\r\n            }\r\n            \r\n            // Create a semi-transparent crystalline material with bright teal colors\r\n            const hue = 0.45 + Math.random() * 0.1; // Teal/aqua/green color palette\r\n            const saturation = 0.9 + Math.random() * 0.1; // Increased saturation\r\n            const lightness = 0.6 + Math.random() * 0.2; // Increased lightness\r\n            \r\n            const color = new THREE.Color().setHSL(hue, saturation, lightness);\r\n            \r\n            const material = new THREE.MeshStandardMaterial({\r\n                color: color,\r\n                metalness: 0.9,\r\n                roughness: 0.1,\r\n                transparent: true,\r\n                opacity: 0.9,\r\n                emissive: color.clone(),\r\n                emissiveIntensity: 0.5\r\n            });\r\n            \r\n            const crystal = new THREE.Mesh(geometry, material);\r\n            \r\n            // Position crystal in a spherical arrangement\r\n            const radius = 200 + Math.random() * 100;\r\n            const theta = Math.random() * Math.PI * 2;\r\n            const phi = Math.random() * Math.PI;\r\n            \r\n            crystal.position.set(\r\n                radius * Math.sin(phi) * Math.cos(theta),\r\n                radius * Math.sin(phi) * Math.sin(theta),\r\n                radius * Math.cos(phi)\r\n            );\r\n            \r\n            // Random rotation\r\n            crystal.rotation.set(\r\n                Math.random() * Math.PI * 2,\r\n                Math.random() * Math.PI * 2,\r\n                Math.random() * Math.PI * 2\r\n            );\r\n            \r\n            anomalyGroup.add(crystal);\r\n            \r\n            // Store crystal data for animation\r\n            crystals.push({\r\n                mesh: crystal,\r\n                initialPosition: crystal.position.clone(),\r\n                floatPhase: Math.random() * Math.PI * 2,\r\n                floatSpeed: 0.3 + Math.random() * 0.3,\r\n                floatAmplitude: 5 + Math.random() * 10,\r\n                rotationSpeed: {\r\n                    x: (Math.random() - 0.5) * 0.01,\r\n                    y: (Math.random() - 0.5) * 0.01,\r\n                    z: (Math.random() - 0.5) * 0.01\r\n                }\r\n            });\r\n        }\r\n        \r\n        // Create energy orb in the center\r\n        const orbRarity = getRandomOrbRarityCallback();\r\n        const orb = createEnergyOrbCallback(orbRarity);\r\n        anomalyGroup.add(orb.mesh);\r\n        \r\n        // Add to scene\r\n        addToSceneCallback(anomalyGroup);\r\n        \r\n        // Return anomaly data\r\n        return {\r\n            type: 'crystalCluster',\r\n            mesh: anomalyGroup,\r\n            position: position.clone(),\r\n            crystals: crystals,\r\n            orb: orb,\r\n            collisionRadius: 300, // Overall collision size\r\n            orbCollected: false,\r\n            rotationSpeed: new THREE.Vector3(0.0005, 0.001, 0.0005)\r\n        };\r\n    }\r\n\r\n    update(anomaly, deltaTime) {\r\n        // Animate floating crystals\r\n        anomaly.crystals.forEach(crystal => {\r\n            // Update float phase\r\n            crystal.floatPhase += deltaTime * crystal.floatSpeed;\r\n            \r\n            // Create floating motion\r\n            const floatOffset = Math.sin(crystal.floatPhase) * crystal.floatAmplitude;\r\n            crystal.mesh.position.y = crystal.initialPosition.y + floatOffset;\r\n            \r\n            // Rotate the crystal\r\n            crystal.mesh.rotation.x += crystal.rotationSpeed.x;\r\n            crystal.mesh.rotation.y += crystal.rotationSpeed.y;\r\n            crystal.mesh.rotation.z += crystal.rotationSpeed.z;\r\n        });\r\n    }\r\n\r\n    cleanup(anomaly) {\r\n        // Clean up crystals\r\n        if (anomaly.crystals) {\r\n            anomaly.crystals.forEach(crystal => {\r\n                if (crystal.mesh && crystal.mesh.geometry) {\r\n                    crystal.mesh.geometry.dispose();\r\n                }\r\n                if (crystal.mesh && crystal.mesh.material) {\r\n                    if (Array.isArray(crystal.mesh.material)) {\r\n                        crystal.mesh.material.forEach(m => m.dispose());\r\n                    } else {\r\n                        crystal.mesh.material.dispose();\r\n                    }\r\n                }\r\n            });\r\n        }\r\n    }\r\n}","// nebulaNexus.js - Nebula nexus anomaly with crystalline rings and energy arcs\r\n\r\nimport * as THREE from 'three';\r\n\r\nexport class NebulaNexusAnomaly {\r\n    constructor(scene, anomalyScale = 4, orbScale = 4) {\r\n        this.scene = scene;\r\n        this.anomalyScale = anomalyScale;\r\n        this.orbScale = orbScale;\r\n    }\r\n\r\n    create(position, createEnergyOrbCallback, getRandomOrbRarityCallback, addToSceneCallback) {\r\n        // Create a crystalline ring structure with central orb\r\n        // Completely redesigned from particle-based nebula to solid structure\r\n        const anomalyGroup = new THREE.Group();\r\n        anomalyGroup.position.copy(position);\r\n        \r\n        // Apply scale to make anomaly 4x bigger\r\n        anomalyGroup.scale.set(this.anomalyScale, this.anomalyScale, this.anomalyScale);\r\n        \r\n        // Create a series of rotating rings with crystal formations\r\n        const ringCount = 3;\r\n        const rings = [];\r\n        \r\n        // Create multiple crystal-studded rings\r\n        for (let i = 0; i < ringCount; i++) {\r\n            // Create a ring\r\n            const ringRadius = 200 + i * 60;\r\n            const ringGeometry = new THREE.TorusGeometry(ringRadius, 8, 16, 50);\r\n            \r\n            // Create a vibrant material for the ring\r\n            const ringHue = 0.6 + i * 0.1; // Blue to purple gradient\r\n            const ringColor = new THREE.Color().setHSL(ringHue, 1.0, 0.6);\r\n            \r\n            const ringMaterial = new THREE.MeshStandardMaterial({\r\n                color: ringColor,\r\n                emissive: ringColor.clone().multiplyScalar(0.5),\r\n                emissiveIntensity: 1.0,\r\n                metalness: 0.9,\r\n                roughness: 0.1,\r\n                transparent: false,\r\n                opacity: 1.0\r\n            });\r\n            \r\n            const ring = new THREE.Mesh(ringGeometry, ringMaterial);\r\n            \r\n            // Position ring with different orientation\r\n            ring.rotation.x = Math.PI/2 + (i * Math.PI/3);\r\n            ring.rotation.y = i * Math.PI/4;\r\n            \r\n            anomalyGroup.add(ring);\r\n            \r\n            // Add crystals along the ring\r\n            const crystalCount = 10 + i * 5;\r\n            const crystals = [];\r\n            \r\n            for (let j = 0; j < crystalCount; j++) {\r\n                // Crystal position along the ring\r\n                const angle = (j / crystalCount) * Math.PI * 2;\r\n                \r\n                // Create crystal geometry\r\n                const crystalSize = 15 + Math.random() * 10;\r\n                const crystalGeometry = new THREE.OctahedronGeometry(crystalSize, 0);\r\n                \r\n                // Create crystal material with complementary color\r\n                const crystalHue = (ringHue + 0.5) % 1.0; // Complementary color\r\n                const crystalColor = new THREE.Color().setHSL(crystalHue, 1.0, 0.7);\r\n                \r\n                const crystalMaterial = new THREE.MeshStandardMaterial({\r\n                    color: crystalColor,\r\n                    emissive: crystalColor.clone(),\r\n                    emissiveIntensity: 0.8,\r\n                    metalness: 0.9,\r\n                    roughness: 0.1,\r\n                    transparent: false,\r\n                    opacity: 1.0\r\n                });\r\n                \r\n                const crystal = new THREE.Mesh(crystalGeometry, crystalMaterial);\r\n                \r\n                // Position crystal on the ring\r\n                crystal.position.x = ringRadius * Math.cos(angle);\r\n                crystal.position.y = 0;\r\n                crystal.position.z = ringRadius * Math.sin(angle);\r\n                \r\n                // Random rotation\r\n                crystal.rotation.x = Math.random() * Math.PI;\r\n                crystal.rotation.y = Math.random() * Math.PI;\r\n                crystal.rotation.z = Math.random() * Math.PI;\r\n                \r\n                ring.add(crystal);\r\n                \r\n                crystals.push({\r\n                    mesh: crystal,\r\n                    initialPosition: crystal.position.clone(),\r\n                    pulsePhase: Math.random() * Math.PI * 2,\r\n                    pulseSpeed: 0.5 + Math.random() * 0.5\r\n                });\r\n            }\r\n            \r\n            rings.push({\r\n                mesh: ring,\r\n                crystals: crystals,\r\n                rotationSpeed: 0.1 - (i * 0.03), // Outer rings rotate slower\r\n                rotationAxis: new THREE.Vector3(\r\n                    Math.random() - 0.5,\r\n                    Math.random() - 0.5,\r\n                    Math.random() - 0.5\r\n                ).normalize()\r\n            });\r\n        }\r\n        \r\n        // Create an inner sphere with energy effect\r\n        const coreRadius = 80;\r\n        const coreGeometry = new THREE.SphereGeometry(coreRadius, 32, 32);\r\n        const coreColor = new THREE.Color().setHSL(0.15, 1.0, 0.6); // Gold color\r\n        \r\n        const coreMaterial = new THREE.MeshStandardMaterial({\r\n            color: coreColor,\r\n            emissive: coreColor,\r\n            emissiveIntensity: 1.0,\r\n            metalness: 1.0,\r\n            roughness: 0.3,\r\n            transparent: true,\r\n            opacity: 0.9\r\n        });\r\n        \r\n        const core = new THREE.Mesh(coreGeometry, coreMaterial);\r\n        anomalyGroup.add(core);\r\n        \r\n        // Add energy arcs from core to rings\r\n        const arcCount = 8;\r\n        const arcs = [];\r\n        \r\n        for (let i = 0; i < arcCount; i++) {\r\n            const curve = new THREE.CubicBezierCurve3(\r\n                new THREE.Vector3(0, 0, 0),\r\n                new THREE.Vector3(\r\n                    (Math.random() - 0.5) * 200,\r\n                    (Math.random() - 0.5) * 200,\r\n                    (Math.random() - 0.5) * 200\r\n                ),\r\n                new THREE.Vector3(\r\n                    (Math.random() - 0.5) * 300,\r\n                    (Math.random() - 0.5) * 300,\r\n                    (Math.random() - 0.5) * 300\r\n                ),\r\n                new THREE.Vector3(\r\n                    (Math.random() - 0.5) * 400,\r\n                    (Math.random() - 0.5) * 400,\r\n                    (Math.random() - 0.5) * 400\r\n                )\r\n            );\r\n            \r\n            const points = curve.getPoints(20);\r\n            const arcGeometry = new THREE.BufferGeometry().setFromPoints(points);\r\n            \r\n            const arcColor = new THREE.Color().setHSL(0.15, 1.0, 0.6); // Gold color\r\n            const arcMaterial = new THREE.LineBasicMaterial({\r\n                color: arcColor,\r\n                linewidth: 3,\r\n                transparent: true,\r\n                opacity: 0.8\r\n            });\r\n            \r\n            const arc = new THREE.Line(arcGeometry, arcMaterial);\r\n            anomalyGroup.add(arc);\r\n            \r\n            arcs.push({\r\n                mesh: arc,\r\n                curve: curve,\r\n                updatePhase: Math.random() * Math.PI * 2,\r\n                updateSpeed: 0.2 + Math.random() * 0.3\r\n            });\r\n        }\r\n        \r\n        // Create energy orb in the center\r\n        const orbRarity = getRandomOrbRarityCallback();\r\n        const orb = createEnergyOrbCallback(orbRarity);\r\n        anomalyGroup.add(orb.mesh);\r\n        \r\n        // Add to scene\r\n        addToSceneCallback(anomalyGroup);\r\n        \r\n        // Return anomaly data\r\n        return {\r\n            type: 'nebulaNexus',\r\n            mesh: anomalyGroup,\r\n            position: position.clone(),\r\n            rings: rings,\r\n            core: {\r\n                mesh: core,\r\n                pulsePhase: 0,\r\n                pulseSpeed: 0.5\r\n            },\r\n            arcs: arcs,\r\n            orb: orb,\r\n            collisionRadius: 250,\r\n            orbCollected: false,\r\n            rotationSpeed: new THREE.Vector3(0.0003, 0.0004, 0.0002)\r\n        };\r\n    }\r\n\r\n    update(anomaly, deltaTime) {\r\n        // Animate core\r\n        anomaly.core.pulsePhase += deltaTime * anomaly.core.pulseSpeed;\r\n        const scale = 1.0 + 0.2 * Math.sin(anomaly.core.pulsePhase);\r\n        anomaly.core.mesh.scale.set(scale, scale, scale);\r\n        \r\n        // Animate rings and crystals\r\n        anomaly.rings.forEach(ring => {\r\n            // Rotate each ring\r\n            const rotationMatrix = new THREE.Matrix4().makeRotationAxis(\r\n                ring.rotationAxis,\r\n                ring.rotationSpeed * deltaTime\r\n            );\r\n            ring.mesh.applyMatrix4(rotationMatrix);\r\n            \r\n            // Animate crystals on the ring\r\n            ring.crystals.forEach(crystal => {\r\n                crystal.pulsePhase += deltaTime * crystal.pulseSpeed;\r\n                const crystalScale = 1.0 + 0.3 * Math.sin(crystal.pulsePhase);\r\n                crystal.mesh.scale.set(crystalScale, crystalScale, crystalScale);\r\n            });\r\n        });\r\n        \r\n        // Animate energy arcs\r\n        anomaly.arcs.forEach(arc => {\r\n            arc.updatePhase += deltaTime * arc.updateSpeed;\r\n            \r\n            // Update arc control points for dynamic movement\r\n            const controlPoint1 = arc.curve.v1;\r\n            const controlPoint2 = arc.curve.v2;\r\n            \r\n            controlPoint1.x = Math.sin(arc.updatePhase) * 200;\r\n            controlPoint1.y = Math.cos(arc.updatePhase * 0.7) * 200;\r\n            controlPoint1.z = Math.sin(arc.updatePhase * 1.3) * 200;\r\n            \r\n            controlPoint2.x = Math.sin(arc.updatePhase * 0.8 + 1) * 300;\r\n            controlPoint2.y = Math.cos(arc.updatePhase * 1.2 + 2) * 300;\r\n            controlPoint2.z = Math.sin(arc.updatePhase * 0.9 + 3) * 300;\r\n            \r\n            // Update arc geometry\r\n            const points = arc.curve.getPoints(20);\r\n            arc.mesh.geometry.setFromPoints(points);\r\n            arc.mesh.geometry.attributes.position.needsUpdate = true;\r\n        });\r\n    }\r\n\r\n    cleanup(anomaly) {\r\n        // Clean up rings, core, and arcs\r\n        if (anomaly.rings) {\r\n            anomaly.rings.forEach(ring => {\r\n                if (ring.mesh && ring.mesh.geometry) {\r\n                    ring.mesh.geometry.dispose();\r\n                }\r\n                if (ring.mesh && ring.mesh.material) {\r\n                    if (Array.isArray(ring.mesh.material)) {\r\n                        ring.mesh.material.forEach(m => m.dispose());\r\n                    } else {\r\n                        ring.mesh.material.dispose();\r\n                    }\r\n                }\r\n            });\r\n        }\r\n        if (anomaly.core && anomaly.core.mesh) {\r\n            if (anomaly.core.mesh.geometry) anomaly.core.mesh.geometry.dispose();\r\n            if (anomaly.core.mesh.material) {\r\n                if (Array.isArray(anomaly.core.mesh.material)) {\r\n                    anomaly.core.mesh.material.forEach(m => m.dispose());\r\n                } else {\r\n                    anomaly.core.mesh.material.dispose();\r\n                }\r\n            }\r\n        }\r\n        if (anomaly.arcs) {\r\n            anomaly.arcs.forEach(arc => {\r\n                if (arc.mesh && arc.mesh.geometry) {\r\n                    arc.mesh.geometry.dispose();\r\n                }\r\n                if (arc.mesh && arc.mesh.material) {\r\n                    if (Array.isArray(arc.mesh.material)) {\r\n                        arc.mesh.material.forEach(m => m.dispose());\r\n                    } else {\r\n                        arc.mesh.material.dispose();\r\n                    }\r\n                }\r\n            });\r\n        }\r\n    }\r\n}","// quantumFlux.js - Quantum flux anomaly with rotating cube frames\r\n\r\nimport * as THREE from 'three';\r\n\r\nexport class QuantumFluxAnomaly {\r\n    constructor(scene, anomalyScale = 4, orbScale = 4) {\r\n        this.scene = scene;\r\n        this.anomalyScale = anomalyScale;\r\n        this.orbScale = orbScale;\r\n    }\r\n\r\n    create(position, createEnergyOrbCallback, getRandomOrbRarityCallback, addToSceneCallback) {\r\n        // Create a quantum flux anomaly with rotating cube frames\r\n        const anomalyGroup = new THREE.Group();\r\n        anomalyGroup.position.copy(position);\r\n        \r\n        // Apply scale to make anomaly 4x bigger\r\n        anomalyGroup.scale.set(this.anomalyScale, this.anomalyScale, this.anomalyScale);\r\n        \r\n        // Create rotating cubic frames\r\n        const frames = [];\r\n        const frameCount = 5;\r\n        \r\n        for (let i = 0; i < frameCount; i++) {\r\n            // Create cubic wireframe box\r\n            const size = 250 - i * 40;\r\n            const geometry = new THREE.BoxGeometry(size, size, size);\r\n            \r\n            // Add a solid but transparent box inside the wireframe for better visibility\r\n            const innerGeometry = new THREE.BoxGeometry(size * 0.98, size * 0.98, size * 0.98);\r\n            \r\n            // Extract only edges to create wireframe\r\n            const edges = new THREE.EdgesGeometry(geometry);\r\n            \r\n            // Use extremely vibrant electric colors\r\n            const hue = 0.3 + i * 0.1; // Shift from green to blue\r\n            const color = new THREE.Color().setHSL(hue, 1.0, 0.6);\r\n            \r\n            const material = new THREE.LineBasicMaterial({ \r\n                color: color,\r\n                linewidth: 2,\r\n                transparent: false, // Changed to non-transparent for better visibility\r\n                opacity: 1.0\r\n            });\r\n            \r\n            // Inner box with semi-transparent material\r\n            const innerMaterial = new THREE.MeshBasicMaterial({\r\n                color: color,\r\n                transparent: true,\r\n                opacity: 0.1,\r\n                side: THREE.DoubleSide\r\n            });\r\n            \r\n            const frame = new THREE.LineSegments(edges, material);\r\n            const innerBox = new THREE.Mesh(innerGeometry, innerMaterial);\r\n            \r\n            // Add both to group and store for animation\r\n            anomalyGroup.add(frame);\r\n            anomalyGroup.add(innerBox);\r\n            \r\n            frames.push({\r\n                mesh: frame,\r\n                innerBox: innerBox,\r\n                rotationAxis: new THREE.Vector3(\r\n                    Math.random() - 0.5,\r\n                    Math.random() - 0.5,\r\n                    Math.random() - 0.5\r\n                ).normalize(),\r\n                rotationSpeed: 0.01 + i * 0.005,\r\n                pulsePhase: Math.random() * Math.PI * 2\r\n            });\r\n        }\r\n        \r\n        // Add energy particles inside\r\n        const particleCount = 200;\r\n        const particleGeometry = new THREE.BufferGeometry();\r\n        const particlePositions = new Float32Array(particleCount * 3);\r\n        const particleSizes = new Float32Array(particleCount);\r\n        \r\n        for (let i = 0; i < particleCount; i++) {\r\n            const i3 = i * 3;\r\n            \r\n            // Position particles within the inner cube\r\n            const radius = 100 * Math.random();\r\n            const theta = Math.random() * Math.PI * 2;\r\n            const phi = Math.random() * Math.PI;\r\n            \r\n            particlePositions[i3] = radius * Math.sin(phi) * Math.cos(theta);\r\n            particlePositions[i3 + 1] = radius * Math.sin(phi) * Math.sin(theta);\r\n            particlePositions[i3 + 2] = radius * Math.cos(phi);\r\n            \r\n            // Vary particle sizes\r\n            particleSizes[i] = 2 + Math.random() * 3;\r\n        }\r\n        \r\n        particleGeometry.setAttribute('position', new THREE.BufferAttribute(particlePositions, 3));\r\n        particleGeometry.setAttribute('size', new THREE.BufferAttribute(particleSizes, 1));\r\n        \r\n        const particleMaterial = new THREE.PointsMaterial({\r\n            color: 0xff00ff, // Magenta\r\n            size: 6,\r\n            blending: THREE.AdditiveBlending,\r\n            transparent: true,\r\n            opacity: 0.9\r\n        });\r\n        \r\n        const particles = new THREE.Points(particleGeometry, particleMaterial);\r\n        anomalyGroup.add(particles);\r\n        \r\n        // Create energy orb in the center\r\n        const orbRarity = getRandomOrbRarityCallback();\r\n        const orb = createEnergyOrbCallback(orbRarity);\r\n        anomalyGroup.add(orb.mesh);\r\n        \r\n        // Add to scene\r\n        addToSceneCallback(anomalyGroup);\r\n        \r\n        // Return anomaly data\r\n        return {\r\n            type: 'quantumFlux',\r\n            mesh: anomalyGroup,\r\n            position: position.clone(),\r\n            frames: frames,\r\n            particles: {\r\n                mesh: particles,\r\n                positions: particlePositions,\r\n                initialPositions: particlePositions.slice(), // Clone for reference\r\n                velocities: Array(particleCount).fill().map(() => new THREE.Vector3(\r\n                    (Math.random() - 0.5) * 0.5,\r\n                    (Math.random() - 0.5) * 0.5,\r\n                    (Math.random() - 0.5) * 0.5\r\n                ))\r\n            },\r\n            orb: orb,\r\n            collisionRadius: 230, // Overall collision size\r\n            orbCollected: false,\r\n            rotationSpeed: new THREE.Vector3(0.0001, 0.0002, 0.0001)\r\n        };\r\n    }\r\n\r\n    update(anomaly, deltaTime) {\r\n        // Animate rotating frames\r\n        anomaly.frames.forEach(frame => {\r\n            // Rotate around custom axis\r\n            const rotationMatrix = new THREE.Matrix4().makeRotationAxis(\r\n                frame.rotationAxis,\r\n                frame.rotationSpeed * deltaTime\r\n            );\r\n            frame.mesh.applyMatrix4(rotationMatrix);\r\n            \r\n            // Also rotate the inner box if it exists\r\n            if (frame.innerBox) {\r\n                frame.innerBox.applyMatrix4(rotationMatrix);\r\n            }\r\n            \r\n            // Pulse effect\r\n            frame.pulsePhase += deltaTime;\r\n            const pulseScale = 1.0 + 0.05 * Math.sin(frame.pulsePhase);\r\n            frame.mesh.scale.set(pulseScale, pulseScale, pulseScale);\r\n            \r\n            // Also pulse the inner box if it exists\r\n            if (frame.innerBox) {\r\n                frame.innerBox.scale.set(pulseScale, pulseScale, pulseScale);\r\n            }\r\n        });\r\n        \r\n        // Animate particles\r\n        const positions = anomaly.particles.positions;\r\n        const velocities = anomaly.particles.velocities;\r\n        \r\n        for (let i = 0; i < positions.length / 3; i++) {\r\n            const i3 = i * 3;\r\n            \r\n            // Update position based on velocity\r\n            positions[i3] += velocities[i].x;\r\n            positions[i3 + 1] += velocities[i].y;\r\n            positions[i3 + 2] += velocities[i].z;\r\n            \r\n            // Contain particles within the inner cube\r\n            const maxDist = 120;\r\n            const pos = new THREE.Vector3(positions[i3], positions[i3 + 1], positions[i3 + 2]);\r\n            \r\n            if (pos.length() > maxDist) {\r\n                // Reflect particles at boundary\r\n                pos.normalize().multiplyScalar(maxDist);\r\n                positions[i3] = pos.x;\r\n                positions[i3 + 1] = pos.y;\r\n                positions[i3 + 2] = pos.z;\r\n                \r\n                // Reflect velocity\r\n                velocities[i].reflect(pos.normalize());\r\n            }\r\n        }\r\n        \r\n        // Update the geometry\r\n        anomaly.particles.mesh.geometry.attributes.position.needsUpdate = true;\r\n    }\r\n\r\n    cleanup(anomaly) {\r\n        // Clean up frames and particles\r\n        if (anomaly.frames) {\r\n            anomaly.frames.forEach(frame => {\r\n                if (frame.mesh && frame.mesh.geometry) {\r\n                    frame.mesh.geometry.dispose();\r\n                }\r\n                if (frame.mesh && frame.mesh.material) {\r\n                    if (Array.isArray(frame.mesh.material)) {\r\n                        frame.mesh.material.forEach(m => m.dispose());\r\n                    } else {\r\n                        frame.mesh.material.dispose();\r\n                    }\r\n                }\r\n                if (frame.innerBox) {\r\n                    if (frame.innerBox.geometry) frame.innerBox.geometry.dispose();\r\n                    if (frame.innerBox.material) {\r\n                        if (Array.isArray(frame.innerBox.material)) {\r\n                            frame.innerBox.material.forEach(m => m.dispose());\r\n                        } else {\r\n                            frame.innerBox.material.dispose();\r\n                        }\r\n                    }\r\n                }\r\n            });\r\n        }\r\n        if (anomaly.particles && anomaly.particles.mesh) {\r\n            if (anomaly.particles.mesh.geometry) anomaly.particles.mesh.geometry.dispose();\r\n            if (anomaly.particles.mesh.material) {\r\n                if (Array.isArray(anomaly.particles.mesh.material)) {\r\n                    anomaly.particles.mesh.material.forEach(m => m.dispose());\r\n                } else {\r\n                    anomaly.particles.mesh.material.dispose();\r\n                }\r\n            }\r\n        }\r\n    }\r\n}","// darkMatter.js - Dark matter anomaly with gravitational lensing effects\r\n\r\nimport * as THREE from 'three';\r\n\r\nexport class DarkMatterAnomaly {\r\n    constructor(scene, anomalyScale = 4, orbScale = 4) {\r\n        this.scene = scene;\r\n        this.anomalyScale = anomalyScale;\r\n        this.orbScale = orbScale;\r\n    }\r\n\r\n    create(position, createEnergyOrbCallback, getRandomOrbRarityCallback, addToSceneCallback) {\r\n        // Create a dark matter anomaly with gravitational lensing effects\r\n        const anomalyGroup = new THREE.Group();\r\n        anomalyGroup.position.copy(position);\r\n        \r\n        // Apply scale to make anomaly 4x bigger\r\n        anomalyGroup.scale.set(this.anomalyScale, this.anomalyScale, this.anomalyScale);\r\n        \r\n        // Create the dark matter core - a sphere with dark, distortion-like material\r\n        const coreRadius = 100;\r\n        const coreGeometry = new THREE.SphereGeometry(coreRadius, 32, 32);\r\n        const coreMaterial = new THREE.MeshStandardMaterial({\r\n            color: 0x330033,\r\n            emissive: 0x880088,\r\n            emissiveIntensity: 1.5,\r\n            metalness: 1.0,\r\n            roughness: 0.0,\r\n            transparent: true,\r\n            opacity: 0.95\r\n        });\r\n        \r\n        const core = new THREE.Mesh(coreGeometry, coreMaterial);\r\n        \r\n        // Add a glow effect around the core\r\n        const glowGeometry = new THREE.SphereGeometry(coreRadius * 1.2, 32, 32);\r\n        const glowMaterial = new THREE.MeshBasicMaterial({\r\n            color: 0x9900ff,\r\n            transparent: true,\r\n            opacity: 0.3,\r\n            side: THREE.BackSide\r\n        });\r\n        \r\n        const glow = new THREE.Mesh(glowGeometry, glowMaterial);\r\n        core.add(glow);\r\n        \r\n        anomalyGroup.add(core);\r\n        \r\n        // Create gravitational distortion rings\r\n        const rings = [];\r\n        const ringCount = 4;\r\n        \r\n        for (let i = 0; i < ringCount; i++) {\r\n            const radius = 150 + i * 60;\r\n            const tubeRadius = 4 + i * 2;\r\n            const geometry = new THREE.TorusGeometry(radius, tubeRadius, 16, 100);\r\n            \r\n            // Use dark/purple color scheme with increasing brightness outward\r\n            const color = new THREE.Color().setHSL(0.75, 0.9, 0.1 + i * 0.15);\r\n            \r\n            const material = new THREE.MeshStandardMaterial({\r\n                color: color,\r\n                emissive: color.clone().multiplyScalar(0.7),\r\n                emissiveIntensity: 0.5 + i * 0.2,\r\n                metalness: 0.8,\r\n                roughness: 0.2,\r\n                transparent: true,\r\n                opacity: 0.85\r\n            });\r\n            \r\n            const ring = new THREE.Mesh(geometry, material);\r\n            \r\n            // Position with random orientation\r\n            ring.rotation.x = Math.random() * Math.PI;\r\n            ring.rotation.y = Math.random() * Math.PI;\r\n            ring.rotation.z = Math.random() * Math.PI;\r\n            \r\n            anomalyGroup.add(ring);\r\n            rings.push({\r\n                mesh: ring,\r\n                rotationAxis: new THREE.Vector3(\r\n                    Math.random() - 0.5,\r\n                    Math.random() - 0.5,\r\n                    Math.random() - 0.5\r\n                ).normalize(),\r\n                rotationSpeed: 0.002 + i * 0.001,\r\n                warpPhase: Math.random() * Math.PI * 2,\r\n                warpSpeed: 0.5 + Math.random() * 0.5\r\n            });\r\n        }\r\n        \r\n        // Create distortion particles\r\n        const particleCount = 300;\r\n        const particleGeometry = new THREE.BufferGeometry();\r\n        const particlePositions = new Float32Array(particleCount * 3);\r\n        const particleSizes = new Float32Array(particleCount);\r\n        \r\n        for (let i = 0; i < particleCount; i++) {\r\n            const i3 = i * 3;\r\n            \r\n            // Distribute particles in a spherical shell\r\n            const radius = 120 + Math.random() * 250;\r\n            const theta = Math.random() * Math.PI * 2;\r\n            const phi = Math.random() * Math.PI;\r\n            \r\n            particlePositions[i3] = radius * Math.sin(phi) * Math.cos(theta);\r\n            particlePositions[i3 + 1] = radius * Math.sin(phi) * Math.sin(theta);\r\n            particlePositions[i3 + 2] = radius * Math.cos(phi);\r\n            \r\n            // Vary particle sizes\r\n            particleSizes[i] = 1 + Math.random() * 3;\r\n        }\r\n        \r\n        particleGeometry.setAttribute('position', new THREE.BufferAttribute(particlePositions, 3));\r\n        particleGeometry.setAttribute('size', new THREE.BufferAttribute(particleSizes, 1));\r\n        \r\n        const particleMaterial = new THREE.PointsMaterial({\r\n            color: 0x8800ff,\r\n            size: 5,\r\n            blending: THREE.AdditiveBlending,\r\n            transparent: true,\r\n            opacity: 0.8\r\n        });\r\n        \r\n        const particles = new THREE.Points(particleGeometry, particleMaterial);\r\n        anomalyGroup.add(particles);\r\n        \r\n        // Create energy orb in the center\r\n        const orbRarity = getRandomOrbRarityCallback();\r\n        const orb = createEnergyOrbCallback(orbRarity);\r\n        anomalyGroup.add(orb.mesh);\r\n        \r\n        // Add to scene\r\n        addToSceneCallback(anomalyGroup);\r\n        \r\n        // Return anomaly data\r\n        return {\r\n            type: 'darkMatter',\r\n            mesh: anomalyGroup,\r\n            position: position.clone(),\r\n            core: {\r\n                mesh: core,\r\n                pulsePhase: 0\r\n            },\r\n            rings: rings,\r\n            particles: {\r\n                mesh: particles,\r\n                positions: particlePositions,\r\n                initialPositions: particlePositions.slice(),\r\n                phases: Array(particleCount).fill().map(() => Math.random() * Math.PI * 2)\r\n            },\r\n            orb: orb,\r\n            collisionRadius: 200, // Overall collision size\r\n            orbCollected: false,\r\n            rotationSpeed: new THREE.Vector3(0.0002, 0.0003, 0.0001)\r\n        };\r\n    }\r\n\r\n    update(anomaly, deltaTime) {\r\n        // Animate core\r\n        anomaly.core.pulsePhase += deltaTime * 0.5;\r\n        const corePulse = 1.0 + 0.1 * Math.sin(anomaly.core.pulsePhase);\r\n        anomaly.core.mesh.scale.set(corePulse, corePulse, corePulse);\r\n        \r\n        // Animate rings\r\n        anomaly.rings.forEach(ring => {\r\n            // Rotate along custom axis\r\n            const rotationMatrix = new THREE.Matrix4().makeRotationAxis(\r\n                ring.rotationAxis,\r\n                ring.rotationSpeed * deltaTime\r\n            );\r\n            ring.mesh.applyMatrix4(rotationMatrix);\r\n            \r\n            // Warp effect\r\n            ring.warpPhase += deltaTime * ring.warpSpeed;\r\n            const warpX = 1.0 + 0.1 * Math.sin(ring.warpPhase);\r\n            const warpY = 1.0 + 0.1 * Math.sin(ring.warpPhase + Math.PI/3);\r\n            const warpZ = 1.0 + 0.1 * Math.sin(ring.warpPhase + Math.PI*2/3);\r\n            ring.mesh.scale.set(warpX, warpY, warpZ);\r\n        });\r\n        \r\n        // Animate particles\r\n        const positions = anomaly.particles.positions;\r\n        const initialPositions = anomaly.particles.initialPositions;\r\n        const phases = anomaly.particles.phases;\r\n        \r\n        for (let i = 0; i < positions.length / 3; i++) {\r\n            const i3 = i * 3;\r\n            \r\n            // Update phase\r\n            phases[i] += deltaTime;\r\n            \r\n            // Create gravitational distortion effect\r\n            const dist = Math.sqrt(\r\n                initialPositions[i3] * initialPositions[i3] +\r\n                initialPositions[i3 + 1] * initialPositions[i3 + 1] +\r\n                initialPositions[i3 + 2] * initialPositions[i3 + 2]\r\n            );\r\n            \r\n            const orbitSpeed = 0.5 + (300 / (dist + 10)); // Faster closer to center\r\n            phases[i] += deltaTime * orbitSpeed;\r\n            \r\n            // Create orbiting motion with radial oscillation\r\n            const radialPulse = 1.0 + 0.2 * Math.sin(phases[i] * 0.5);\r\n            \r\n            // Apply the distortion\r\n            const pos = new THREE.Vector3(\r\n                initialPositions[i3],\r\n                initialPositions[i3 + 1],\r\n                initialPositions[i3 + 2]\r\n            );\r\n            \r\n            // Rotate based on phase\r\n            const rotY = phases[i] * 0.2;\r\n            const rotZ = phases[i] * 0.1;\r\n            \r\n            pos.applyAxisAngle(new THREE.Vector3(0, 1, 0), rotY);\r\n            pos.applyAxisAngle(new THREE.Vector3(0, 0, 1), rotZ);\r\n            \r\n            // Apply radial pulse\r\n            pos.multiplyScalar(radialPulse);\r\n            \r\n            positions[i3] = pos.x;\r\n            positions[i3 + 1] = pos.y;\r\n            positions[i3 + 2] = pos.z;\r\n        }\r\n        \r\n        // Update the geometry\r\n        anomaly.particles.mesh.geometry.attributes.position.needsUpdate = true;\r\n    }\r\n\r\n    cleanup(anomaly) {\r\n        // Clean up core, rings, and particles\r\n        if (anomaly.core && anomaly.core.mesh) {\r\n            if (anomaly.core.mesh.geometry) anomaly.core.mesh.geometry.dispose();\r\n            if (anomaly.core.mesh.material) {\r\n                if (Array.isArray(anomaly.core.mesh.material)) {\r\n                    anomaly.core.mesh.material.forEach(m => m.dispose());\r\n                } else {\r\n                    anomaly.core.mesh.material.dispose();\r\n                }\r\n            }\r\n        }\r\n        if (anomaly.rings) {\r\n            anomaly.rings.forEach(ring => {\r\n                if (ring.mesh && ring.mesh.geometry) {\r\n                    ring.mesh.geometry.dispose();\r\n                }\r\n                if (ring.mesh && ring.mesh.material) {\r\n                    if (Array.isArray(ring.mesh.material)) {\r\n                        ring.mesh.material.forEach(m => m.dispose());\r\n                    } else {\r\n                        ring.mesh.material.dispose();\r\n                    }\r\n                }\r\n            });\r\n        }\r\n        if (anomaly.particles && anomaly.particles.mesh) {\r\n            if (anomaly.particles.mesh.geometry) anomaly.particles.mesh.geometry.dispose();\r\n            if (anomaly.particles.mesh.material) {\r\n                if (Array.isArray(anomaly.particles.mesh.material)) {\r\n                    anomaly.particles.mesh.material.forEach(m => m.dispose());\r\n                } else {\r\n                    anomaly.particles.mesh.material.dispose();\r\n                }\r\n            }\r\n        }\r\n    }\r\n}","// anomalyRegistry.js - Registry and factory for space anomalies\r\n\r\nimport { VortexAnomaly } from './vortex.js';\r\nimport { CrystalClusterAnomaly } from './crystalCluster.js';\r\nimport { NebulaNexusAnomaly } from './nebulaNexus.js';\r\nimport { QuantumFluxAnomaly } from './quantumFlux.js';\r\nimport { DarkMatterAnomaly } from './darkMatter.js';\r\n\r\nexport class AnomalyRegistry {\r\n    constructor(scene, anomalyScale = 4, orbScale = 4) {\r\n        this.scene = scene;\r\n        this.anomalyScale = anomalyScale;\r\n        this.orbScale = orbScale;\r\n        \r\n        // Initialize anomaly implementations\r\n        this.anomalyTypes = {\r\n            'vortex': new VortexAnomaly(scene, anomalyScale, orbScale),\r\n            'crystalCluster': new CrystalClusterAnomaly(scene, anomalyScale, orbScale),\r\n            'nebulaNexus': new NebulaNexusAnomaly(scene, anomalyScale, orbScale),\r\n            'quantumFlux': new QuantumFluxAnomaly(scene, anomalyScale, orbScale),\r\n            'darkMatter': new DarkMatterAnomaly(scene, anomalyScale, orbScale)\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Create an anomaly of the specified type\r\n     * @param {string} type - The type of anomaly to create\r\n     * @param {THREE.Vector3} position - Position where the anomaly should be created\r\n     * @param {Function} createEnergyOrbCallback - Callback to create energy orbs\r\n     * @param {Function} getRandomOrbRarityCallback - Callback to get random orb rarity\r\n     * @param {Function} addToSceneCallback - Callback to add objects to the scene\r\n     * @returns {Object} The created anomaly data\r\n     */\r\n    createAnomaly(type, position, createEnergyOrbCallback, getRandomOrbRarityCallback, addToSceneCallback) {\r\n        const anomalyClass = this.anomalyTypes[type];\r\n        if (!anomalyClass) {\r\n            throw new Error(`Unknown anomaly type: ${type}`);\r\n        }\r\n\r\n        return anomalyClass.create(position, createEnergyOrbCallback, getRandomOrbRarityCallback, addToSceneCallback);\r\n    }\r\n\r\n    /**\r\n     * Update an anomaly of the specified type\r\n     * @param {Object} anomaly - The anomaly to update\r\n     * @param {number} deltaTime - Time since last update\r\n     */\r\n    updateAnomaly(anomaly, deltaTime) {\r\n        const anomalyClass = this.anomalyTypes[anomaly.type];\r\n        if (anomalyClass && typeof anomalyClass.update === 'function') {\r\n            anomalyClass.update(anomaly, deltaTime);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Clean up an anomaly of the specified type\r\n     * @param {Object} anomaly - The anomaly to clean up\r\n     */\r\n    cleanupAnomaly(anomaly) {\r\n        const anomalyClass = this.anomalyTypes[anomaly.type];\r\n        if (anomalyClass && typeof anomalyClass.cleanup === 'function') {\r\n            anomalyClass.cleanup(anomaly);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Get all available anomaly type names\r\n     * @returns {string[]} Array of anomaly type names\r\n     */\r\n    getAvailableTypes() {\r\n        return Object.keys(this.anomalyTypes);\r\n    }\r\n\r\n    /**\r\n     * Check if an anomaly type is supported\r\n     * @param {string} type - The anomaly type to check\r\n     * @returns {boolean} True if the type is supported\r\n     */\r\n    isTypeSupported(type) {\r\n        return type in this.anomalyTypes;\r\n    }\r\n}","// spaceAnomalies.js - Creates and manages space anomalies with collectible energy orbs\r\n\r\nimport * as THREE from 'three';\r\nimport { AnomalyRegistry } from './anomalies/anomalyRegistry.js';\r\n\r\nexport class SpaceAnomalies {\r\n    constructor(scene) {\r\n        this.scene = scene;\r\n        this.anomalies = [];\r\n        \r\n        // Anomalies are outside the asteroid belt\r\n        this.minRadius = 32000; // Beyond asteroid belt\r\n        this.maxRadius = 45000; // Not too far into deep space\r\n        this.width = 3000; // Height variation\r\n        \r\n        // Scale factors for size\r\n        this.anomalyScale = 4; // Make anomalies 4x bigger\r\n        this.orbScale = 4;     // Make orbs 4x bigger\r\n        \r\n        // Orb rarity and values\r\n        this.orbValues = {\r\n            common: 100,    // Green orb - 100 credits\r\n            uncommon: 500,  // Blue orb - 500 credits\r\n            rare: 1500,     // Purple orb - 1500 credits\r\n            epic: 5000,     // Orange orb - 5000 credits\r\n            legendary: 15000 // Red orb - 15000 credits\r\n        };\r\n        \r\n        // Initialize timer system for dynamic anomaly spawning\r\n        this.spawnTimer = 0;\r\n        this.checkInterval = 60; // Check every 60 seconds (1 minute)\r\n        this.spawnChance = 0.5; // 50% chance to spawn a new anomaly\r\n        this.despawnChance = 0.3; // 30% chance for an anomaly to despawn\r\n        \r\n        // Initialize anomaly registry\r\n        this.anomalyRegistry = new AnomalyRegistry(scene, this.anomalyScale, this.orbScale);\r\n        this.anomalyTypes = this.anomalyRegistry.getAvailableTypes();\r\n        \r\n        // Maximum number of anomalies that can exist simultaneously\r\n        this.maxAnomalies = 5;\r\n        \r\n        // Notify about active anomalies\r\n        this.updateAnomalyCountDisplay();\r\n    }\r\n\r\n    // --- Renderer facade helpers ---\r\n    _getRenderer() {\r\n        return (window.game && window.game.renderer) ? window.game.renderer : null;\r\n    }\r\n\r\n    _addToScene(object) {\r\n        const renderer = this._getRenderer();\r\n        if (renderer && typeof renderer._withGuard === 'function') {\r\n            renderer._withGuard(() => renderer.add(object));\r\n        } else if (this.scene && typeof this.scene.add === 'function') {\r\n            this.scene.add(object);\r\n        }\r\n    }\r\n\r\n    _removeFromScene(object) {\r\n        const renderer = this._getRenderer();\r\n        if (!object) return;\r\n        if (renderer && typeof renderer._withGuard === 'function') {\r\n            renderer._withGuard(() => this.scene.remove(object));\r\n        } else if (this.scene && typeof this.scene.remove === 'function') {\r\n            this.scene.remove(object);\r\n        }\r\n    }\r\n    \r\n    // Method to check and potentially spawn/despawn anomalies\r\n    checkAnomalySpawning(deltaTime) {\r\n        // Increment timer\r\n        this.spawnTimer += deltaTime;\r\n        \r\n        // Check if it's time to evaluate spawn/despawn\r\n        if (this.spawnTimer >= this.checkInterval) {\r\n            // Reset timer\r\n            this.spawnTimer -= this.checkInterval;\r\n            \r\n            // Check for potential new anomaly spawn\r\n            if (this.anomalies.length < this.maxAnomalies && Math.random() < this.spawnChance) {\r\n                // Determine which anomaly type to spawn\r\n                const availableTypes = this.anomalyTypes.filter(type => \r\n                    !this.anomalies.some(anomaly => anomaly.type === type)\r\n                );\r\n                \r\n                if (availableTypes.length > 0) {\r\n                    const typeToSpawn = availableTypes[Math.floor(Math.random() * availableTypes.length)];\r\n                    this.spawnAnomaly(typeToSpawn);\r\n                    \r\n                    // Update HUD with new count\r\n                    this.updateAnomalyCountDisplay();\r\n                }\r\n            }\r\n            \r\n            // Check each existing anomaly for potential despawn\r\n            const anomaliesToRemove = [];\r\n            this.anomalies.forEach(anomaly => {\r\n                if (Math.random() < this.despawnChance) {\r\n                    anomaliesToRemove.push(anomaly);\r\n                }\r\n            });\r\n            \r\n            // Remove marked anomalies\r\n            if (anomaliesToRemove.length > 0) {\r\n                anomaliesToRemove.forEach(anomaly => {\r\n                    this.despawnAnomaly(anomaly);\r\n                });\r\n                \r\n                // Update HUD with new count\r\n                this.updateAnomalyCountDisplay();\r\n            }\r\n        }\r\n    }\r\n    \r\n    // Spawn a specific type of anomaly\r\n    spawnAnomaly(type) {\r\n        console.log(`Spawning ${type} anomaly`);\r\n        \r\n        if (!this.anomalyRegistry.isTypeSupported(type)) {\r\n            console.error(`Unknown anomaly type: ${type}`);\r\n            return;\r\n        }\r\n        \r\n        const position = this.getRandomAnomalyPosition();\r\n        const anomaly = this.anomalyRegistry.createAnomaly(\r\n            type,\r\n            position,\r\n            (rarity) => this.createEnergyOrb(rarity),\r\n            () => this.getRandomOrbRarity(),\r\n            (object) => this._addToScene(object)\r\n        );\r\n        \r\n        this.anomalies.push(anomaly);\r\n    }\r\n    \r\n    // Despawn and cleanup a specific anomaly\r\n    despawnAnomaly(anomaly) {\r\n        console.log(`Despawning ${anomaly.type} anomaly`);\r\n        \r\n        // Remove from scene\r\n        this._removeFromScene(anomaly.mesh);\r\n        \r\n        // Use the registry to clean up the anomaly\r\n        this.anomalyRegistry.cleanupAnomaly(anomaly);\r\n        \r\n        // Clean up the orb\r\n        if (anomaly.orb && anomaly.orb.mesh) {\r\n            if (anomaly.orb.mesh.geometry) anomaly.orb.mesh.geometry.dispose();\r\n            if (anomaly.orb.mesh.material) {\r\n                if (Array.isArray(anomaly.orb.mesh.material)) {\r\n                    anomaly.orb.mesh.material.forEach(m => m.dispose());\r\n                } else {\r\n                    anomaly.orb.mesh.material.dispose();\r\n                }\r\n            }\r\n        }\r\n        \r\n        // Remove from anomalies array\r\n        const index = this.anomalies.indexOf(anomaly);\r\n        if (index !== -1) {\r\n            this.anomalies.splice(index, 1);\r\n        }\r\n    }\r\n    \r\n    // Update HUD to show active anomaly count\r\n    updateAnomalyCountDisplay() {\r\n        // Find the anomaly count element in the HUD\r\n        const anomalyCountEl = document.getElementById('anomaly-count');\r\n        if (anomalyCountEl) {\r\n            anomalyCountEl.textContent = this.anomalies.length.toString();\r\n        }\r\n    }\r\n    \r\n    // Get the number of active anomalies\r\n    getActiveAnomalyCount() {\r\n        return this.anomalies.length;\r\n    }\r\n    \r\n    // Modified update method to include anomaly spawning/despawning checks\r\n    update(deltaTime) {\r\n        // Check for spawning/despawning anomalies\r\n        this.checkAnomalySpawning(deltaTime);\r\n        \r\n        // Get player position if available (from global reference)\r\n        let playerPosition = null;\r\n        if (window.game && window.game.spaceship && window.game.spaceship.mesh) {\r\n            playerPosition = window.game.spaceship.mesh.position;\r\n        }\r\n        \r\n        // Update existing anomalies\r\n        for (let i = 0; i < this.anomalies.length; i++) {\r\n            const anomaly = this.anomalies[i];\r\n            \r\n            // Skip if orb is already collected\r\n            if (anomaly.orbCollected) {\r\n                // Simple rotation for collected anomalies\r\n                if (anomaly.mesh && anomaly.rotationSpeed) {\r\n                    anomaly.mesh.rotation.x += anomaly.rotationSpeed.x * deltaTime;\r\n                    anomaly.mesh.rotation.y += anomaly.rotationSpeed.y * deltaTime;\r\n                    anomaly.mesh.rotation.z += anomaly.rotationSpeed.z * deltaTime;\r\n                }\r\n                continue;\r\n            }\r\n            \r\n            // Check if player is nearby to enhance effects\r\n            let playerNearby = false;\r\n            if (playerPosition) {\r\n                const distance = playerPosition.distanceTo(anomaly.position);\r\n                playerNearby = distance < (anomaly.orb.size * 3) * this.orbScale; // Only enhance effects based on orb distance\r\n            }\r\n            \r\n            // Rotate the entire anomaly slowly\r\n            if (anomaly.mesh && anomaly.rotationSpeed) {\r\n                anomaly.mesh.rotation.x += anomaly.rotationSpeed.x * deltaTime;\r\n                anomaly.mesh.rotation.y += anomaly.rotationSpeed.y * deltaTime;\r\n                anomaly.mesh.rotation.z += anomaly.rotationSpeed.z * deltaTime;\r\n            }\r\n            \r\n            // Animate anomaly using registry\r\n            this.anomalyRegistry.updateAnomaly(anomaly, deltaTime);\r\n            \r\n            // Update orb effects based on player proximity\r\n            this.updateOrbEffects(anomaly, playerNearby);\r\n        }\r\n    }\r\n    \r\n    createEnergyOrb(rarity) {\r\n        // Create an energy orb with glow effects based on rarity\r\n        \r\n        // Determine orb color and properties based on rarity\r\n        let color, size, intensity, pulseSpeed;\r\n        \r\n        switch(rarity) {\r\n            case 'legendary':\r\n                color = new THREE.Color(0xff0000); // Red\r\n                size = 30 * this.orbScale;  // 4x bigger\r\n                intensity = 0.9;\r\n                pulseSpeed = 2.0;\r\n                break;\r\n            case 'epic':\r\n                color = new THREE.Color(0xff6600); // Orange\r\n                size = 25 * this.orbScale;  // 4x bigger\r\n                intensity = 0.8;\r\n                pulseSpeed = 1.8;\r\n                break;\r\n            case 'rare':\r\n                color = new THREE.Color(0x9900ff); // Purple\r\n                size = 22 * this.orbScale;  // 4x bigger\r\n                intensity = 0.7;\r\n                pulseSpeed = 1.5;\r\n                break;\r\n            case 'uncommon':\r\n                color = new THREE.Color(0x0066ff); // Blue\r\n                size = 20 * this.orbScale;  // 4x bigger\r\n                intensity = 0.6;\r\n                pulseSpeed = 1.2;\r\n                break;\r\n            default: // common\r\n                color = new THREE.Color(0x00ff66); // Green\r\n                size = 18 * this.orbScale;  // 4x bigger\r\n                intensity = 0.5;\r\n                pulseSpeed = 1.0;\r\n                break;\r\n        }\r\n        \r\n        // Create the core orb\r\n        const orbGeometry = new THREE.SphereGeometry(size, 32, 32);\r\n        const orbMaterial = new THREE.MeshStandardMaterial({\r\n            color: color,\r\n            emissive: color,\r\n            emissiveIntensity: intensity,\r\n            metalness: 0.8,\r\n            roughness: 0.2,\r\n            transparent: true,\r\n            opacity: 0.9\r\n        });\r\n        \r\n        const orb = new THREE.Mesh(orbGeometry, orbMaterial);\r\n        \r\n        // Create outer glow\r\n        const glowSize = size * 1.5;\r\n        const glowGeometry = new THREE.SphereGeometry(glowSize, 32, 32);\r\n        const glowMaterial = new THREE.MeshBasicMaterial({\r\n            color: color,\r\n            transparent: true,\r\n            opacity: 0.3,\r\n            side: THREE.BackSide,\r\n            blending: THREE.AdditiveBlending\r\n        });\r\n        \r\n        const glow = new THREE.Mesh(glowGeometry, glowMaterial);\r\n        orb.add(glow);\r\n        \r\n        // Return orb data\r\n        return {\r\n            mesh: orb,\r\n            rarity: rarity,\r\n            value: this.orbValues[rarity],\r\n            size: size,\r\n            color: color,\r\n            pulsePhase: 0,\r\n            pulseSpeed: pulseSpeed,\r\n            glow: glow\r\n        };\r\n    }\r\n    \r\n    \r\n    getRandomAnomalyPosition() {\r\n        // Get random position outside asteroid belt\r\n        const angle = Math.random() * Math.PI * 2;\r\n        const radius = this.minRadius + Math.random() * (this.maxRadius - this.minRadius);\r\n        const heightVariation = (Math.random() - 0.5) * this.width;\r\n        \r\n        return new THREE.Vector3(\r\n            Math.cos(angle) * radius,\r\n            heightVariation,\r\n            Math.sin(angle) * radius\r\n        );\r\n    }\r\n    \r\n    getRandomOrbRarity() {\r\n        // Determine orb rarity based on probabilities\r\n        const roll = Math.random();\r\n        \r\n        if (roll < 0.005) {\r\n            return 'legendary'; // 0.5% chance\r\n        } else if (roll < 0.025) {\r\n            return 'epic'; // 2% chance\r\n        } else if (roll < 0.1) {\r\n            return 'rare'; // 7.5% chance\r\n        } else if (roll < 0.3) {\r\n            return 'uncommon'; // 20% chance\r\n        } else {\r\n            return 'common'; // 70% chance\r\n        }\r\n    }\r\n    \r\n    getRegionInfo() {\r\n        return {\r\n            center: new THREE.Vector3(0, 0, 0),\r\n            innerRadius: this.minRadius,\r\n            outerRadius: this.maxRadius\r\n        };\r\n    }\r\n    \r\n    findClosestAnomaly(position, maxDistance = 8000) {\r\n        let closestAnomaly = null;\r\n        let closestDistance = maxDistance;\r\n        \r\n        this.anomalies.forEach(anomaly => {\r\n            // Calculate distance to this anomaly\r\n            const distance = position.distanceTo(anomaly.position);\r\n            \r\n            if (distance < closestDistance) {\r\n                closestDistance = distance;\r\n                closestAnomaly = anomaly;\r\n            }\r\n        });\r\n        \r\n        return closestAnomaly;\r\n    }\r\n    \r\n    collectOrb(anomaly) {\r\n        if (!anomaly || anomaly.orbCollected) {\r\n            return null; // Already collected or invalid anomaly\r\n        }\r\n        \r\n        // Get orb data before marking as collected\r\n        const orbData = {\r\n            rarity: anomaly.orb.rarity,\r\n            value: this.orbValues[anomaly.orb.rarity] || 100 // Default to 100 if rarity not found\r\n        };\r\n        \r\n        // Mark as collected and update visuals\r\n        anomaly.orbCollected = true;\r\n        \r\n        // Hide the orb\r\n        if (anomaly.orb && anomaly.orb.mesh) {\r\n            anomaly.orb.mesh.visible = false;\r\n            \r\n            // Also hide glow if present\r\n            if (anomaly.orb.glow) {\r\n                anomaly.orb.glow.visible = false;\r\n            }\r\n        }\r\n        \r\n        return orbData; // Return data for player inventory and notification\r\n    }\r\n    \r\n    checkCollision(position, anomaly) {\r\n        if (!position || !anomaly || !anomaly.position) return false;\r\n        \r\n        // Calculate distance from player to anomaly center\r\n        const distance = position.distanceTo(anomaly.position);\r\n        \r\n        // Check if within orb collection radius - we only want orb collisions, not anomaly collision\r\n        // Use the original collision radius for orb collection, scaled by orbScale\r\n        // This ensures we're only checking for the orb and not the anomaly itself\r\n        return distance < (anomaly.orb.size * 2) * this.orbScale;\r\n    }\r\n    \r\n    updateOrbEffects(anomaly, playerNearby) {\r\n        if (!anomaly || !anomaly.orb || anomaly.orbCollected) return;\r\n        \r\n        // Enhance orb effects when player is nearby to make collection more obvious\r\n        if (playerNearby) {\r\n            // If player is nearby, make the orb pulse more dramatically\r\n            const scale = 1.5 + Math.sin(performance.now() * 0.005) * 0.5;\r\n            anomaly.orb.mesh.scale.set(scale, scale, scale);\r\n            \r\n            // Increase emission intensity\r\n            if (anomaly.orb.mesh.material) {\r\n                anomaly.orb.mesh.material.emissiveIntensity = 2.0;\r\n            }\r\n        } else {\r\n            // Reset to normal effects when player is not nearby\r\n            const scale = 1.0 + Math.sin(performance.now() * 0.002) * 0.2;\r\n            anomaly.orb.mesh.scale.set(scale, scale, scale);\r\n            \r\n            // Normal emission intensity\r\n            if (anomaly.orb.mesh.material) {\r\n                anomaly.orb.mesh.material.emissiveIntensity = 0.8;\r\n            }\r\n        }\r\n    }\r\n    \r\n    \r\n    updateForSystem(systemData) {\r\n        console.log(\"Updating space anomalies for new star system\");\r\n        \r\n        // Clear any existing anomalies\r\n        this.clearAllAnomalies();\r\n        \r\n        // Reset the timer to immediately check for spawning in the new system\r\n        this.spawnTimer = this.checkInterval;\r\n        \r\n        // Update HUD\r\n        this.updateAnomalyCountDisplay();\r\n    }\r\n    \r\n    clearAllAnomalies() {\r\n        // Clone the array to avoid modification during iteration\r\n        const anomaliesToRemove = [...this.anomalies];\r\n        \r\n        // Remove each anomaly\r\n        anomaliesToRemove.forEach(anomaly => {\r\n            this.despawnAnomaly(anomaly);\r\n        });\r\n        \r\n        // Ensure the array is empty\r\n        this.anomalies = [];\r\n        \r\n        // Update HUD\r\n        this.updateAnomalyCountDisplay();\r\n    }\r\n} ","// environment.js - Main environment class that integrates all environment components\r\n\r\nimport { SceneInitializer } from './environment/core/sceneInitializer.js';\r\nimport { RegionManager } from './environment/core/regionManager.js';\r\nimport { SystemTransitionManager } from './environment/core/systemTransitionManager.js';\r\nimport { AsteroidBelt } from './environment/asteroidBelt.js';\r\nimport { SystemTransition } from './environment/systemTransition.js';\r\nimport { CustomSystemCreator } from './ui/customSystemCreator.js';\r\nimport { VibeVersePortals } from './environment/vibeVersePortals.js';\r\nimport { SpaceAnomalies } from './environment/spaceAnomalies.js';\r\n\r\nexport class Environment {\r\n    constructor(scene) {\r\n        this.scene = scene;\r\n        this.componentsLoaded = false;\r\n        \r\n        // Initialize core managers\r\n        this.sceneInitializer = new SceneInitializer(scene);\r\n        this.regionManager = new RegionManager();\r\n        this.transitionManager = new SystemTransitionManager();\r\n        \r\n        // Initialize essential components\r\n        const essentialComponents = this.sceneInitializer.initializeEssentialComponents();\r\n        Object.assign(this, essentialComponents);\r\n        \r\n        // Store references for easier access\r\n        this.asteroids = [];\r\n        this.currentSystemId = this.transitionManager.getCurrentSystemId();\r\n        \r\n        // Setup initial regions for location tracking (minimal setup)\r\n        this.regionManager.setupInitialRegions(this.sun, this.stargate, this.planets);\r\n        \r\n        // Schedule loading of remaining components after a short delay to not block startup\r\n        setTimeout(async () => {\r\n            const remainingComponents = await this.sceneInitializer.loadRemainingComponents();\r\n            Object.assign(this, remainingComponents);\r\n            \r\n            // Connect asteroids from asteroidBelt to environment\r\n            if (this.asteroidBelt) {\r\n                this.asteroids = this.asteroidBelt.getAsteroids();\r\n            }\r\n            \r\n            this.componentsLoaded = true;\r\n        }, 500);\r\n    }\r\n    \r\n    \r\n    // Called after spaceship is created - we need this to initialize portals\r\n    async setSpaceship(spaceship) {\r\n        this.spaceship = spaceship;\r\n        this.vibeVersePortals = await this.sceneInitializer.initializePortals(spaceship);\r\n    }\r\n    \r\n    // Travel to a new star system\r\n    travelToSystem(systemId) {\r\n        return this.transitionManager.travelToSystem(\r\n            systemId, \r\n            this.starSystemGenerator, \r\n            this.systemTransition, \r\n            (systemId) => this.updateEnvironmentForSystem(systemId)\r\n        );\r\n    }\r\n    \r\n    // Update environment visuals and properties for the new system\r\n    updateEnvironmentForSystem(systemId) {\r\n        this.transitionManager.updateEnvironmentForSystem(\r\n            systemId, \r\n            this.starSystemGenerator, \r\n            this.skybox, \r\n            this.sun, \r\n            this.planets, \r\n            this.asteroidBelt, \r\n            this.spaceAnomalies, \r\n            this.regionManager\r\n        );\r\n        this.currentSystemId = this.transitionManager.getCurrentSystemId();\r\n    }\r\n    \r\n    // Get the player's current location based on position\r\n    getPlayerLocation(playerPosition) {\r\n        return this.regionManager.getPlayerLocation(\r\n            playerPosition, \r\n            this.spaceAnomalies, \r\n            this.asteroids, \r\n            this.componentsLoaded\r\n        );\r\n    }\r\n\r\n    // Get planet regions for external access\r\n    getPlanetRegions() {\r\n        return this.regionManager.getPlanetRegions();\r\n    }\r\n    \r\n    // Find the closest asteroid to a position\r\n    findClosestAsteroid(position, maxDistance) {\r\n        if (this.componentsLoaded && this.asteroidBelt && this.asteroidBelt.findClosestAsteroid) {\r\n            return this.asteroidBelt.findClosestAsteroid(position, maxDistance);\r\n        }\r\n        return null;\r\n    }\r\n    \r\n    // Find the closest space anomaly\r\n    findClosestAnomaly(position, maxDistance) {\r\n        if (this.componentsLoaded && this.spaceAnomalies && this.spaceAnomalies.findClosestAnomaly) {\r\n            return this.spaceAnomalies.findClosestAnomaly(position, maxDistance);\r\n        }\r\n        return null;\r\n    }\r\n    \r\n    // Check if position collides with any anomaly\r\n    checkAnomalyCollision(position) {\r\n        if (!this.componentsLoaded || !this.spaceAnomalies) return null;\r\n        \r\n        const closestAnomaly = this.spaceAnomalies.findClosestAnomaly(position, 8000);\r\n        if (closestAnomaly && this.spaceAnomalies.checkCollision(position, closestAnomaly)) {\r\n            return closestAnomaly;\r\n        }\r\n        \r\n        return null;\r\n    }\r\n    \r\n    // Collect energy orb from anomaly\r\n    collectAnomalyOrb(anomaly) {\r\n        if (this.componentsLoaded && this.spaceAnomalies && this.spaceAnomalies.collectOrb) {\r\n            return this.spaceAnomalies.collectOrb(anomaly);\r\n        }\r\n    }\r\n    \r\n    update(deltaTime = 0.016, camera) {\r\n        // Update skybox if it has an update method\r\n        if (this.skybox && typeof this.skybox.update === 'function') {\r\n            this.skybox.update(deltaTime);\r\n        }\r\n        \r\n        // Update sun if it has an update method\r\n        if (this.sun && typeof this.sun.update === 'function') {\r\n            this.sun.update(deltaTime);\r\n        }\r\n        \r\n        // Update planets if they have an update method\r\n        if (this.planets && typeof this.planets.update === 'function') {\r\n            this.planets.update(deltaTime);\r\n        }\r\n        \r\n        // Update system transition effects if active - this needs to run regardless of componentsLoaded\r\n        if (this.systemTransition && typeof this.systemTransition.update === 'function') {\r\n            this.systemTransition.update(deltaTime);\r\n        }\r\n        \r\n        // Only update non-essential components if they're loaded\r\n        if (this.componentsLoaded) {\r\n            // Update asteroids\r\n            if (this.asteroidBelt && typeof this.asteroidBelt.update === 'function') {\r\n                this.asteroidBelt.update(deltaTime);\r\n            }\r\n            \r\n            // Update stargate\r\n            if (this.stargate && typeof this.stargate.update === 'function') {\r\n                this.stargate.update(deltaTime);\r\n            }\r\n            \r\n            // Update space anomalies\r\n            if (this.spaceAnomalies && typeof this.spaceAnomalies.update === 'function') {\r\n                this.spaceAnomalies.update(deltaTime, camera);\r\n            }\r\n            \r\n            // Update vibe verse portals\r\n            if (this.vibeVersePortals && typeof this.vibeVersePortals.update === 'function') {\r\n                this.vibeVersePortals.update(deltaTime);\r\n            }\r\n        }\r\n    }\r\n    \r\n    dispose() {\r\n        // Delegate disposal to scene initializer\r\n        if (this.sceneInitializer) {\r\n            this.sceneInitializer.dispose();\r\n        }\r\n    }\r\n} ","// inputHandler.js - Handles keyboard and mouse input\r\n\r\nexport class InputHandler {\r\n    constructor(spaceship, physics) {\r\n        this.spaceship = spaceship;\r\n        this.physics = physics;\r\n        this.isPointerLocked = false;\r\n        this.mouseSensitivity = 0.001; // Lower sensitivity for more precise control\r\n        \r\n        this.setupKeyboardControls();\r\n        this.setupPointerLock();\r\n    }\r\n    \r\n    setupKeyboardControls() {\r\n        // Keyboard controls\r\n        document.addEventListener('keydown', e => {\r\n            // Ignore inputs when docked or intro sequence is active\r\n            if (this.spaceship.isDocked || (window.game && window.game.introSequenceActive)) return;\r\n            \r\n            switch (e.key.toLowerCase()) {\r\n                case 'w': window.inputIntent = (window.inputIntent||0) | 1; break;\r\n                case 's': window.inputIntent = (window.inputIntent||0) | 2; break;\r\n                case 'a': window.inputIntent = (window.inputIntent||0) | 4; break;\r\n                case 'd': window.inputIntent = (window.inputIntent||0) | 8; break;\r\n                case 'shift': window.inputIntent = (window.inputIntent||0) | 16; break;\r\n            }\r\n        });\r\n        \r\n        document.addEventListener('keyup', e => {\r\n            // Still process key up events when intro is active to prevent stuck keys\r\n            if (window.game && window.game.introSequenceActive) {\r\n                // Force reset all thrusters during intro sequence\r\n                this.spaceship.thrust.forward = false;\r\n                this.spaceship.thrust.backward = false;\r\n                this.spaceship.thrust.right = false;\r\n                this.spaceship.thrust.left = false;\r\n                this.spaceship.thrust.boost = false;\r\n                return;\r\n            }\r\n            \r\n            const clearBit = (bit) => { window.inputIntent = (window.inputIntent||0) & ~bit; };\r\n            switch (e.key.toLowerCase()) {\r\n                case 'w': clearBit(1); break;\r\n                case 's': clearBit(2); break;\r\n                case 'a': clearBit(4); break;\r\n                case 'd': clearBit(8); break;\r\n                case 'shift': clearBit(16); break;\r\n            }\r\n        });\r\n    }\r\n    \r\n    setupPointerLock() {\r\n        // Get the canvas element (it's the first canvas in the document)\r\n        const canvas = document.querySelector('canvas');\r\n        \r\n        // Request pointer lock when clicking on the canvas\r\n        canvas.addEventListener('pointerdown', (e) => {\r\n            e.preventDefault(); // Prevent default to avoid unwanted behavior\r\n            if (!this.isPointerLocked && !this.spaceship.isDocked) {\r\n                canvas.requestPointerLock();\r\n            }\r\n        });\r\n        \r\n        // Set up pointer lock change event\r\n        document.addEventListener('pointerlockchange', () => {\r\n            if (document.pointerLockElement === canvas) {\r\n                // Pointer is locked\r\n                this.isPointerLocked = true;\r\n                document.addEventListener('pointermove', this.handlePointerMove.bind(this));\r\n            } else {\r\n                // Pointer is unlocked\r\n                this.isPointerLocked = false;\r\n                document.removeEventListener('pointermove', this.handlePointerMove.bind(this));\r\n            }\r\n        });\r\n        \r\n        // Add instructions for pointer lock\r\n        const instructionsElement = document.createElement('div');\r\n        instructionsElement.id = 'pointer-lock-instructions';\r\n        instructionsElement.innerHTML = `\r\n            Click on the game to enable mouse rotation\r\n        `;\r\n        instructionsElement.style.position = 'absolute';\r\n        instructionsElement.style.top = '60px';\r\n        instructionsElement.style.left = '50%';\r\n        instructionsElement.style.transform = 'translateX(-50%)';\r\n        instructionsElement.style.backgroundColor = 'rgba(0, 0, 0, 0.5)';\r\n        instructionsElement.style.padding = '10px 20px';\r\n        instructionsElement.style.borderRadius = '20px';\r\n        instructionsElement.style.border = '1px solid #30cfd0';\r\n        instructionsElement.style.boxShadow = '0 0 10px #30cfd0';\r\n        instructionsElement.style.color = '#fff';\r\n        instructionsElement.style.fontFamily = 'Courier New, monospace';\r\n        instructionsElement.style.zIndex = '999';\r\n        instructionsElement.style.textAlign = 'center';\r\n        document.body.appendChild(instructionsElement);\r\n        \r\n        // Hide instructions when pointer is locked\r\n        document.addEventListener('pointerlockchange', () => {\r\n            instructionsElement.style.display = document.pointerLockElement ? 'none' : 'block';\r\n        });\r\n    }\r\n    \r\n    handlePointerMove(e) {\r\n        // Skip mouse movement handling during intro sequence\r\n        if (window.game && window.game.introSequenceActive) return;\r\n        \r\n        if (!this.isPointerLocked) return;\r\n        \r\n        // Use movementX and movementY for rotation\r\n        // These values represent the mouse movement since the last event\r\n        const movementX = e.movementX || 0;\r\n        const movementY = e.movementY || 0;\r\n        \r\n        // Update the physics rotation based on these movements\r\n        this.physics.updateRotation(\r\n            movementX * this.mouseSensitivity, \r\n            movementY * this.mouseSensitivity\r\n        );\r\n    }\r\n    \r\n    isLocked() {\r\n        return this.isPointerLocked;\r\n    }\r\n    \r\n    exitPointerLock() {\r\n        if (document.exitPointerLock) {\r\n            document.exitPointerLock();\r\n        }\r\n    }\r\n}","// gamepadHandler.js - Handles gamepad/controller input\r\n// Supports Xbox, PlayStation, and generic controllers\r\n\r\nexport class GamepadHandler {\r\n    constructor(spaceship, physics, controls) {\r\n        this.spaceship = spaceship;\r\n        this.physics = physics;\r\n        this.controls = controls; // Reference to main controls for mining/targeting/etc\r\n        \r\n        // Gamepad state\r\n        this.gamepads = {};\r\n        this.activeGamepadIndex = null;\r\n        this.enabled = true;\r\n        this.vibrationEnabled = true;\r\n        \r\n        // Dead zones for analog sticks (prevents drift)\r\n        this.deadZone = 0.15;\r\n        this.triggerDeadZone = 0.15; // Increased to prevent accidental activation\r\n        \r\n        // Sensitivity settings\r\n        this.lookSensitivity = 1.0;  // Right stick look sensitivity (reduced from 2.0)\r\n        this.movementSensitivity = 1.0;  // Left stick movement sensitivity\r\n        \r\n        // Smoothing for accurate aiming\r\n        this.rotationSmoothing = {\r\n            targetX: 0,\r\n            targetY: 0,\r\n            currentX: 0,\r\n            currentY: 0,\r\n            smoothingFactor: 0.15  // Lower = smoother, higher = more responsive\r\n        }\r\n        \r\n        // Button mapping (Xbox layout as default)\r\n        this.buttonMap = {\r\n            // Face buttons\r\n            A: 0,          // Jump/Accept\r\n            B: 1,          // Cancel/Back\r\n            X: 2,          // Reload/Interact\r\n            Y: 3,          // Switch weapon\r\n            \r\n            // Bumpers and triggers\r\n            LB: 4,         // Previous target\r\n            RB: 5,         // Next target\r\n            LT: 6,         // Mining laser\r\n            RT: 7,         // Fire weapon\r\n            \r\n            // Special buttons\r\n            BACK: 8,       // Menu/Settings\r\n            START: 9,      // Pause\r\n            L3: 10,        // Left stick click - boost\r\n            R3: 11,        // Right stick click - toggle targeting\r\n            \r\n            // D-Pad\r\n            DPAD_UP: 12,   // Deploy turret\r\n            DPAD_DOWN: 13, // Deploy shield\r\n            DPAD_LEFT: 14, // Previous weapon\r\n            DPAD_RIGHT: 15 // Next weapon\r\n        };\r\n        \r\n        // Axis mapping\r\n        this.axisMap = {\r\n            LEFT_STICK_X: 0,   // Strafe left/right\r\n            LEFT_STICK_Y: 1,   // Move forward/backward\r\n            RIGHT_STICK_X: 2,  // Look left/right (yaw)\r\n            RIGHT_STICK_Y: 3,  // Look up/down (pitch)\r\n            LT: 4,             // Left trigger (some controllers)\r\n            RT: 5              // Right trigger (some controllers)\r\n        };\r\n        \r\n        // Button state tracking (for press/release detection)\r\n        this.buttonStates = {};\r\n        this.previousButtonStates = {};\r\n        \r\n        // Trigger states for firing\r\n        this.wasFiring = false;\r\n        \r\n        // Initialize controller support\r\n        this.init();\r\n        \r\n        // Debug mode for testing\r\n        this.debugMode = false; // Disabled now that we found the correct mapping\r\n        this.debugDisplay = null;\r\n    }\r\n    \r\n    init() {\r\n        // Check for gamepad support\r\n        if (!('getGamepads' in navigator)) {\r\n            console.warn('Gamepad API not supported in this browser');\r\n            return;\r\n        }\r\n        \r\n        // Listen for gamepad connections\r\n        window.addEventListener('gamepadconnected', (e) => {\r\n            console.log(`Gamepad connected: ${e.gamepad.id} (index: ${e.gamepad.index})`);\r\n            this.onGamepadConnected(e.gamepad);\r\n        });\r\n        \r\n        // Listen for gamepad disconnections\r\n        window.addEventListener('gamepaddisconnected', (e) => {\r\n            console.log(`Gamepad disconnected: ${e.gamepad.id} (index: ${e.gamepad.index})`);\r\n            this.onGamepadDisconnected(e.gamepad);\r\n        });\r\n        \r\n        // Check for already connected gamepads\r\n        this.scanForGamepads();\r\n        \r\n        console.log('Gamepad handler initialized - ready for controller input');\r\n    }\r\n    \r\n    scanForGamepads() {\r\n        const gamepads = navigator.getGamepads();\r\n        for (let i = 0; i < gamepads.length; i++) {\r\n            if (gamepads[i]) {\r\n                this.onGamepadConnected(gamepads[i]);\r\n            }\r\n        }\r\n    }\r\n    \r\n    onGamepadConnected(gamepad) {\r\n        this.gamepads[gamepad.index] = gamepad;\r\n        \r\n        // Set as active if no active gamepad\r\n        if (this.activeGamepadIndex === null) {\r\n            this.activeGamepadIndex = gamepad.index;\r\n            this.showNotification(`Controller connected: ${this.getGamepadName(gamepad)}`);\r\n            \r\n            // Vibrate to confirm connection\r\n            this.vibrate(0.3, 200);\r\n        }\r\n    }\r\n    \r\n    onGamepadDisconnected(gamepad) {\r\n        delete this.gamepads[gamepad.index];\r\n        \r\n        // If this was the active gamepad, find another\r\n        if (this.activeGamepadIndex === gamepad.index) {\r\n            this.activeGamepadIndex = null;\r\n            this.showNotification('Controller disconnected');\r\n            \r\n            // Try to find another connected gamepad\r\n            for (let index in this.gamepads) {\r\n                this.activeGamepadIndex = parseInt(index);\r\n                this.showNotification(`Switched to controller: ${this.getGamepadName(this.gamepads[index])}`);\r\n                break;\r\n            }\r\n        }\r\n    }\r\n    \r\n    getGamepadName(gamepad) {\r\n        // Simplify gamepad names for display\r\n        const name = gamepad.id.toLowerCase();\r\n        if (name.includes('xbox')) return 'Xbox Controller';\r\n        if (name.includes('playstation') || name.includes('dualshock')) return 'PlayStation Controller';\r\n        if (name.includes('switch') || name.includes('pro controller')) return 'Switch Pro Controller';\r\n        return 'Generic Controller';\r\n    }\r\n    \r\n    update(deltaTime) {\r\n        if (!this.enabled || this.activeGamepadIndex === null) return;\r\n        \r\n        // Get fresh gamepad state (must call this each frame)\r\n        const gamepads = navigator.getGamepads();\r\n        const gamepad = gamepads[this.activeGamepadIndex];\r\n        \r\n        if (!gamepad) return;\r\n        \r\n        // Update debug display if enabled\r\n        if (this.debugMode) {\r\n            this.updateDebugDisplay(gamepad);\r\n        }\r\n        \r\n        // Skip input during intro sequence or when docked\r\n        if ((window.game && window.game.introSequenceActive) || this.spaceship.isDocked) {\r\n            // Reset all controls\r\n            this.resetControls();\r\n            return;\r\n        }\r\n        \r\n        // Store previous button states for edge detection\r\n        this.previousButtonStates = {...this.buttonStates};\r\n        \r\n        // Update current button states\r\n        gamepad.buttons.forEach((button, index) => {\r\n            this.buttonStates[index] = button.pressed;\r\n        });\r\n        \r\n        // Handle movement (left stick)\r\n        this.handleMovement(gamepad);\r\n        \r\n        // Handle camera look (right stick)\r\n        this.handleCameraLook(gamepad, deltaTime);\r\n        \r\n        // Handle buttons\r\n        this.handleButtons(gamepad);\r\n        \r\n        // Handle triggers\r\n        this.handleTriggers(gamepad);\r\n    }\r\n    \r\n    handleMovement(gamepad) {\r\n        // Left stick - movement\r\n        const leftX = this.applyDeadZone(gamepad.axes[this.axisMap.LEFT_STICK_X]);\r\n        const leftY = this.applyDeadZone(gamepad.axes[this.axisMap.LEFT_STICK_Y]);\r\n        \r\n        // Reset movement\r\n        this.spaceship.thrust.forward = false;\r\n        this.spaceship.thrust.backward = false;\r\n        this.spaceship.thrust.left = false;\r\n        this.spaceship.thrust.right = false;\r\n        \r\n        // Apply movement based on stick position\r\n        // Y-axis is inverted (up is negative)\r\n        if (leftY < -0.1) {\r\n            this.spaceship.thrust.forward = true;\r\n            this.spaceship.thrustPower = Math.abs(leftY); // Variable thrust\r\n        } else if (leftY > 0.1) {\r\n            this.spaceship.thrust.backward = true;\r\n            this.spaceship.thrustPower = Math.abs(leftY);\r\n        }\r\n        \r\n        // X-axis strafing\r\n        // FIXED: thrust.left actually moves RIGHT, thrust.right moves LEFT in physics\r\n        // So we need to reverse the mapping\r\n        if (leftX < -0.1) {\r\n            this.spaceship.thrust.right = true; // Left stick left = move left (uses right thrust)\r\n            this.spaceship.strafePower = Math.abs(leftX);\r\n        } else if (leftX > 0.1) {\r\n            this.spaceship.thrust.left = true; // Right stick right = move right (uses left thrust)\r\n            this.spaceship.strafePower = Math.abs(leftX);\r\n        }\r\n        \r\n        // Left stick click - boost\r\n        if (gamepad.buttons[this.buttonMap.L3].pressed) {\r\n            this.spaceship.thrust.boost = true;\r\n        } else {\r\n            this.spaceship.thrust.boost = false;\r\n        }\r\n    }\r\n    \r\n    handleCameraLook(gamepad, deltaTime) {\r\n        // YOUR CONTROLLER: Right stick is on axes 3 (horizontal) and 4 (vertical)\r\n        const rightStickX = this.applyDeadZone(gamepad.axes[3] || 0); // Horizontal movement\r\n        const rightStickY = this.applyDeadZone(gamepad.axes[4] || 0); // Vertical movement\r\n        \r\n        // Apply response curve for finer control\r\n        // This makes small movements even smaller (for precision aiming)\r\n        // and keeps large movements responsive (for quick turns)\r\n        const applyCurve = (value) => {\r\n            const sign = Math.sign(value);\r\n            const abs = Math.abs(value);\r\n            // Quadratic curve for the first 50%, linear for the rest\r\n            if (abs < 0.5) {\r\n                return sign * abs * abs * 2; // Quadratic (slower near center)\r\n            } else {\r\n                return sign * (abs * 0.5 + 0.25); // Linear (faster at edges)\r\n            }\r\n        };\r\n        \r\n        const curvedX = applyCurve(rightStickX);\r\n        const curvedY = applyCurve(rightStickY);\r\n        \r\n        // Update target rotation speeds\r\n        const baseSpeed = 0.0015; // Reduced base speed for better control\r\n        this.rotationSmoothing.targetX = curvedX * baseSpeed * this.lookSensitivity * 60;\r\n        this.rotationSmoothing.targetY = curvedY * baseSpeed * this.lookSensitivity * 60;\r\n        \r\n        // Apply exponential smoothing for smoother rotation\r\n        const smoothing = this.rotationSmoothing.smoothingFactor;\r\n        this.rotationSmoothing.currentX += (this.rotationSmoothing.targetX - this.rotationSmoothing.currentX) * smoothing;\r\n        this.rotationSmoothing.currentY += (this.rotationSmoothing.targetY - this.rotationSmoothing.currentY) * smoothing;\r\n        \r\n        // Only update rotation if there's meaningful input\r\n        if (Math.abs(this.rotationSmoothing.currentX) > 0.0001 || Math.abs(this.rotationSmoothing.currentY) > 0.0001) {\r\n            this.physics.updateRotation(this.rotationSmoothing.currentX, this.rotationSmoothing.currentY);\r\n        } else {\r\n            // Reset smoothing when stick is centered\r\n            this.rotationSmoothing.currentX = 0;\r\n            this.rotationSmoothing.currentY = 0;\r\n        }\r\n    }\r\n    \r\n    handleButtons(gamepad) {\r\n        // A button - Toggle targeting system\r\n        if (this.wasButtonPressed(this.buttonMap.A)) {\r\n            if (this.controls && this.controls.targetingSystem) {\r\n                this.controls.targetingSystem.toggleLockOn();\r\n            }\r\n        }\r\n        \r\n        // B button - Toggle mining (tap to start/stop)\r\n        if (this.wasButtonPressed(this.buttonMap.B)) {\r\n            if (this.controls && this.controls.miningSystem && this.controls.targetingSystem) {\r\n                if (this.controls.miningSystem.isMining) {\r\n                    // Currently mining - stop it\r\n                    this.controls.miningSystem.stopMining();\r\n                } else {\r\n                    // Not mining - try to start\r\n                    const target = this.controls.targetingSystem.getCurrentTarget();\r\n                    if (target) {\r\n                        this.controls.miningSystem.setTargetAsteroid(target);\r\n                        this.controls.miningSystem.startMining();\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        \r\n        // X button - Dock when near stargate\r\n        if (this.wasButtonPressed(this.buttonMap.X)) {\r\n            if (this.controls && this.controls.dockingSystem && this.controls.dockingSystem.canDock()) {\r\n                this.controls.dockingSystem.initiateDocking();\r\n            }\r\n        }\r\n        \r\n        // Y button - Deploy turret\r\n        if (this.wasButtonPressed(this.buttonMap.Y)) {\r\n            if (window.game && window.game.deployTurret) {\r\n                window.game.deployTurret();\r\n            }\r\n        }\r\n        \r\n        // Bumpers - Cycle targets\r\n        if (this.wasButtonPressed(this.buttonMap.LB)) {\r\n            // Previous target\r\n            if (this.controls && this.controls.targetingSystem) {\r\n                this.controls.targetingSystem.cycleLockOnTarget(-1);\r\n            }\r\n        }\r\n        \r\n        if (this.wasButtonPressed(this.buttonMap.RB)) {\r\n            // Next target\r\n            if (this.controls && this.controls.targetingSystem) {\r\n                const target = this.controls.targetingSystem.cycleLockOnTarget(1);\r\n                if (target && this.controls.miningSystem) {\r\n                    this.controls.miningSystem.setTargetAsteroid(target);\r\n                }\r\n            }\r\n        }\r\n        \r\n        // Right stick click - Could be used for something else later\r\n        \r\n        // D-Pad for quick actions\r\n        if (this.wasButtonPressed(this.buttonMap.DPAD_UP)) {\r\n            // Deploy turret\r\n            if (window.game && window.game.deployTurret) {\r\n                window.game.deployTurret();\r\n            }\r\n        }\r\n        \r\n        if (this.wasButtonPressed(this.buttonMap.DPAD_DOWN)) {\r\n            // Deploy shield drone\r\n            if (window.game && window.game.deployShieldDrone) {\r\n                window.game.deployShieldDrone();\r\n            }\r\n        }\r\n        \r\n        // Start button - Pause/Menu\r\n        if (this.wasButtonPressed(this.buttonMap.START)) {\r\n            if (window.game && window.game.togglePause) {\r\n                window.game.togglePause();\r\n            }\r\n        }\r\n    }\r\n    \r\n    handleTriggers(gamepad) {\r\n        // Check triggers - most controllers use buttons 6 and 7\r\n        let rtValue = 0;\r\n        let ltValue = 0;\r\n        \r\n        // Standard button mapping for triggers\r\n        if (gamepad.buttons[7]) {\r\n            rtValue = gamepad.buttons[7].value;\r\n        }\r\n        if (gamepad.buttons[6]) {\r\n            ltValue = gamepad.buttons[6].value;\r\n        }\r\n        \r\n        // Some controllers report triggers as axes 4 and 5\r\n        const axis4 = gamepad.axes[4] || 0;\r\n        const axis5 = gamepad.axes[5] || 0;\r\n        if (rtValue < 0.01 && Math.abs(axis5) > 0.01) {\r\n            rtValue = (axis5 + 1) / 2; // Convert from -1,1 to 0,1\r\n        }\r\n        if (ltValue < 0.01 && Math.abs(axis4) > 0.01) {\r\n            ltValue = (axis4 + 1) / 2; // Convert from -1,1 to 0,1\r\n        }\r\n        \r\n        // RIGHT TRIGGER - Fire weapons\r\n        if (rtValue > this.triggerDeadZone) {\r\n            if (!this.wasFiring) {\r\n                // Start firing\r\n                if (window.game && window.game.combat) {\r\n                    window.game.combat.setFiring(true);\r\n                    this.wasFiring = true;\r\n                }\r\n            }\r\n        } else {\r\n            if (this.wasFiring) {\r\n                // Stop firing\r\n                if (window.game && window.game.combat) {\r\n                    window.game.combat.setFiring(false);\r\n                    this.wasFiring = false;\r\n                }\r\n            }\r\n        }\r\n        \r\n        // LEFT TRIGGER - Alternative mining button (optional)\r\n        // Disabled for now to avoid conflicts - use B button instead\r\n    }\r\n    \r\n    applyDeadZone(value) {\r\n        if (Math.abs(value) < this.deadZone) {\r\n            return 0;\r\n        }\r\n        // Scale the value to use full range after dead zone\r\n        const sign = value > 0 ? 1 : -1;\r\n        return sign * ((Math.abs(value) - this.deadZone) / (1 - this.deadZone));\r\n    }\r\n    \r\n    wasButtonPressed(buttonIndex) {\r\n        // Returns true only on the frame the button was pressed (not held)\r\n        return this.buttonStates[buttonIndex] && !this.previousButtonStates[buttonIndex];\r\n    }\r\n    \r\n    wasButtonReleased(buttonIndex) {\r\n        // Returns true only on the frame the button was released\r\n        return !this.buttonStates[buttonIndex] && this.previousButtonStates[buttonIndex];\r\n    }\r\n    \r\n    vibrate(intensity = 0.5, duration = 100) {\r\n        if (!this.vibrationEnabled || this.activeGamepadIndex === null) return;\r\n        \r\n        const gamepads = navigator.getGamepads();\r\n        const gamepad = gamepads[this.activeGamepadIndex];\r\n        \r\n        if (gamepad && gamepad.vibrationActuator) {\r\n            gamepad.vibrationActuator.playEffect('dual-rumble', {\r\n                startDelay: 0,\r\n                duration: duration,\r\n                weakMagnitude: intensity * 0.5,\r\n                strongMagnitude: intensity\r\n            });\r\n        }\r\n    }\r\n    \r\n    resetControls() {\r\n        // Reset all spaceship controls\r\n        this.spaceship.thrust.forward = false;\r\n        this.spaceship.thrust.backward = false;\r\n        this.spaceship.thrust.left = false;\r\n        this.spaceship.thrust.right = false;\r\n        this.spaceship.thrust.boost = false;\r\n        this.spaceship.thrustPower = 1.0;\r\n        this.spaceship.strafePower = 1.0;\r\n    }\r\n    \r\n    showNotification(message) {\r\n        // Show a temporary notification for gamepad events\r\n        const notification = document.createElement('div');\r\n        notification.style.position = 'fixed';\r\n        notification.style.bottom = '100px';\r\n        notification.style.left = '50%';\r\n        notification.style.transform = 'translateX(-50%)';\r\n        notification.style.backgroundColor = 'rgba(0, 0, 0, 0.8)';\r\n        notification.style.color = '#30cfd0';\r\n        notification.style.padding = '10px 20px';\r\n        notification.style.borderRadius = '5px';\r\n        notification.style.border = '1px solid #30cfd0';\r\n        notification.style.fontFamily = 'monospace';\r\n        notification.style.fontSize = '14px';\r\n        notification.style.zIndex = '10000';\r\n        notification.textContent = ' ' + message;\r\n        \r\n        document.body.appendChild(notification);\r\n        \r\n        // Fade out and remove after 3 seconds\r\n        setTimeout(() => {\r\n            notification.style.transition = 'opacity 0.5s';\r\n            notification.style.opacity = '0';\r\n            setTimeout(() => notification.remove(), 500);\r\n        }, 3000);\r\n    }\r\n    \r\n    // Settings methods\r\n    setLookSensitivity(value) {\r\n        this.lookSensitivity = Math.max(0.1, Math.min(5.0, value));\r\n    }\r\n    \r\n    setMovementSensitivity(value) {\r\n        this.movementSensitivity = Math.max(0.1, Math.min(2.0, value));\r\n    }\r\n    \r\n    setDeadZone(value) {\r\n        this.deadZone = Math.max(0.05, Math.min(0.3, value));\r\n    }\r\n    \r\n    setVibration(enabled) {\r\n        this.vibrationEnabled = enabled;\r\n    }\r\n    \r\n    isConnected() {\r\n        return this.activeGamepadIndex !== null;\r\n    }\r\n    \r\n    // Debug methods for testing\r\n    toggleDebug() {\r\n        this.debugMode = !this.debugMode;\r\n        \r\n        if (this.debugMode) {\r\n            this.createDebugDisplay();\r\n        } else {\r\n            this.removeDebugDisplay();\r\n        }\r\n    }\r\n    \r\n    createDebugDisplay() {\r\n        if (this.debugDisplay) return;\r\n        \r\n        this.debugDisplay = document.createElement('div');\r\n        this.debugDisplay.id = 'gamepad-debug';\r\n        this.debugDisplay.style.position = 'fixed';\r\n        this.debugDisplay.style.top = '10px';\r\n        this.debugDisplay.style.right = '10px';\r\n        this.debugDisplay.style.backgroundColor = 'rgba(0, 0, 0, 0.8)';\r\n        this.debugDisplay.style.color = '#0f0';\r\n        this.debugDisplay.style.padding = '10px';\r\n        this.debugDisplay.style.fontFamily = 'monospace';\r\n        this.debugDisplay.style.fontSize = '12px';\r\n        this.debugDisplay.style.borderRadius = '5px';\r\n        this.debugDisplay.style.border = '1px solid #0f0';\r\n        this.debugDisplay.style.zIndex = '10001';\r\n        this.debugDisplay.style.maxWidth = '300px';\r\n        this.debugDisplay.style.pointerEvents = 'none';\r\n        \r\n        document.body.appendChild(this.debugDisplay);\r\n    }\r\n    \r\n    removeDebugDisplay() {\r\n        if (this.debugDisplay) {\r\n            this.debugDisplay.remove();\r\n            this.debugDisplay = null;\r\n        }\r\n    }\r\n    \r\n    updateDebugDisplay(gamepad) {\r\n        if (!this.debugDisplay) {\r\n            this.createDebugDisplay();\r\n        }\r\n        \r\n        // Show ALL axes to debug mapping issues\r\n        let html = `<strong> Gamepad Debug</strong><br>`;\r\n        html += `Controller: ${gamepad.id}<br>`;\r\n        html += `Mapping: ${gamepad.mapping || 'non-standard'}<br>`;\r\n        html += `<br><strong>All Axes (${gamepad.axes.length}):</strong><br>`;\r\n        \r\n        for (let i = 0; i < gamepad.axes.length; i++) {\r\n            const value = gamepad.axes[i].toFixed(2);\r\n            const isRightX = i === this.rightStickXAxis;\r\n            const isRightY = i === this.rightStickYAxis;\r\n            const label = isRightX ? ' (R-X)' : isRightY ? ' (R-Y)' : '';\r\n            html += `[${i}]: ${value}${label} `;\r\n            if (i % 2 === 1) html += '<br>';\r\n        }\r\n        \r\n        html += `<br><strong>Detected Mapping:</strong><br>`;\r\n        html += `Left Stick: axes[0,1]<br>`;\r\n        html += `Right Stick: axes[${this.rightStickXAxis},${this.rightStickYAxis}]<br>`;\r\n        \r\n        const rightX = gamepad.axes[this.rightStickXAxis]?.toFixed(2) || '0';\r\n        const rightY = gamepad.axes[this.rightStickYAxis]?.toFixed(2) || '0';\r\n        html += `Right Values: X=${rightX} Y=${rightY}<br>`;\r\n        \r\n        const rt = gamepad.buttons[7]?.value.toFixed(2) || '0';\r\n        const lt = gamepad.buttons[6]?.value.toFixed(2) || '0';\r\n        html += `<br><strong>Triggers:</strong><br>`;\r\n        html += `LT: ${lt} | RT: ${rt}<br>`;\r\n        \r\n        html += `<br><strong>Active:</strong><br>`;\r\n        // Show active controls\r\n        if (this.spaceship.thrust.forward) html += ' Forward ';\r\n        if (this.spaceship.thrust.backward) html += ' Backward ';\r\n        if (this.spaceship.thrust.left) html += ' Right ';\r\n        if (this.spaceship.thrust.right) html += ' Left ';\r\n        if (this.spaceship.thrust.boost) html += ' Boost ';\r\n        \r\n        html += `<br><small>Press F8 to swap X/Y axes</small>`;\r\n        \r\n        this.debugDisplay.innerHTML = html;\r\n    }\r\n    \r\n    // Method to swap right stick axes if they're incorrect\r\n    swapRightStickAxes() {\r\n        const temp = this.rightStickXAxis;\r\n        this.rightStickXAxis = this.rightStickYAxis;\r\n        this.rightStickYAxis = temp;\r\n        console.log(`Swapped right stick axes: X is now axis ${this.rightStickXAxis}, Y is now axis ${this.rightStickYAxis}`);\r\n        this.axisDetectionMode = false; // Disable auto-detection after manual swap\r\n    }\r\n}","// laserControl.js - Handles laser beam visuals and control\r\n\r\nimport * as THREE from 'three';\r\n\r\nexport class LaserControl {\r\n    constructor(scene, spaceship) {\r\n        this.scene = scene;\r\n        this.spaceship = spaceship;\r\n    }\r\n\r\n    /**\r\n     * Update laser beam position and appearance\r\n     */\r\n    updateLaserBeam(targetAsteroid) {\r\n        const laserBeam = document.getElementById('laser-beam');\r\n        if (!laserBeam || !targetAsteroid || !this.spaceship.mesh) return;\r\n        \r\n        // Create a vector pointing from the ship to the asteroid\r\n        const shipPosition = this.spaceship.mesh.position.clone();\r\n        const asteroidPosition = targetAsteroid.mesh.position.clone();\r\n        \r\n        // Add a small offset to the ship position to start from the FRONT of the mining laser\r\n        // The ship's coordinate system has -Z as the forward direction, so use negative Z\r\n        const shipOffset = new THREE.Vector3(0, 0, -60); // 4x the original offset (-15)\r\n        shipOffset.applyQuaternion(this.spaceship.mesh.quaternion);\r\n        shipPosition.add(shipOffset);\r\n        \r\n        // Convert 3D positions to screen coordinates\r\n        const tempVector = new THREE.Vector3();\r\n        \r\n        // Get the camera\r\n        const camera = this.scene.camera;\r\n        if (!camera) return;\r\n        \r\n        // Convert ship position to screen space\r\n        tempVector.copy(shipPosition);\r\n        tempVector.project(camera);\r\n        const shipX = (tempVector.x * 0.5 + 0.5) * window.innerWidth;\r\n        const shipY = (-(tempVector.y * 0.5) + 0.5) * window.innerHeight;\r\n        \r\n        // Convert asteroid position to screen space\r\n        tempVector.copy(asteroidPosition);\r\n        tempVector.project(camera);\r\n        const asteroidX = (tempVector.x * 0.5 + 0.5) * window.innerWidth;\r\n        const asteroidY = (-(tempVector.y * 0.5) + 0.5) * window.innerHeight;\r\n        \r\n        // Calculate distance and angle\r\n        const dx = asteroidX - shipX;\r\n        const dy = asteroidY - shipY;\r\n        const distance = Math.sqrt(dx * dx + dy * dy);\r\n        const angle = Math.atan2(dy, dx);\r\n        \r\n        // Update laser beam style\r\n        laserBeam.style.width = `${distance}px`;\r\n        laserBeam.style.left = `${shipX}px`;\r\n        laserBeam.style.top = `${shipY}px`;\r\n        laserBeam.style.transform = `rotate(${angle}rad)`;\r\n        \r\n        // Animate the laser beam for a more dynamic effect\r\n        const intensity = 0.8 + Math.sin(Date.now() * 0.01) * 0.2;\r\n        laserBeam.style.opacity = intensity.toString();\r\n        \r\n        // Make laser thickness vary with mining efficiency\r\n        const efficiency = this.spaceship.miningEfficiency || 1.0;\r\n        const thickness = Math.max(2, Math.ceil(2 * Math.sqrt(efficiency)));\r\n        laserBeam.style.height = `${thickness}px`;\r\n        \r\n        // Create multiple beams for a more powerful effect\r\n        if (!laserBeam.hasChildNodes()) {\r\n            // Create 2 additional beams for a thicker laser effect\r\n            for (let i = 0; i < 2; i++) {\r\n                const additionalBeam = document.createElement('div');\r\n                additionalBeam.style.position = 'absolute';\r\n                additionalBeam.style.left = '0';\r\n                additionalBeam.style.top = `${i === 0 ? -1 : 1}px`;\r\n                additionalBeam.style.width = '100%';\r\n                additionalBeam.style.height = '1px';\r\n                additionalBeam.style.backgroundColor = '#ff6060';\r\n                additionalBeam.style.opacity = '0.7';\r\n                laserBeam.appendChild(additionalBeam);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Create or get laser beam element\r\n     */\r\n    setupLaserBeam(targetAsteroid) {\r\n        // Get or create laser beam element\r\n        let laserBeam = document.getElementById('laser-beam');\r\n        \r\n        // If laser beam element doesn't exist, create it\r\n        if (!laserBeam) {\r\n            console.log(\"LaserControl: Creating laser beam element\");\r\n            laserBeam = document.createElement('div');\r\n            laserBeam.id = 'laser-beam';\r\n            laserBeam.style.position = 'absolute';\r\n            laserBeam.style.height = '2px';\r\n            laserBeam.style.backgroundColor = '#ff3030';\r\n            laserBeam.style.transformOrigin = '0 0';\r\n            laserBeam.style.zIndex = '100';\r\n            laserBeam.style.pointerEvents = 'none';\r\n            document.body.appendChild(laserBeam);\r\n        }\r\n        \r\n        // Show mining laser beam\r\n        if (laserBeam) {\r\n            laserBeam.style.display = 'block';\r\n            \r\n            // Adjust laser color based on resource type and mining level\r\n            if (targetAsteroid.resourceType) {\r\n                const resourceType = targetAsteroid.resourceType.toLowerCase();\r\n                let laserColor = '#ff3030'; // Default red for iron\r\n                let glowColor = '#ff0000';\r\n                \r\n                if (resourceType === 'gold') {\r\n                    laserColor = '#ffcc00'; // Gold color\r\n                    glowColor = '#ffaa00';\r\n                } else if (resourceType === 'platinum') {\r\n                    laserColor = '#66ffff'; // Cyan color for platinum\r\n                    glowColor = '#00ffff';\r\n                }\r\n                \r\n                // Adjust intensity based on mining efficiency - brighter for higher efficiency\r\n                const efficiency = this.spaceship.miningEfficiency || 1.0;\r\n                if (efficiency > 1.0) {\r\n                    // Make the laser more intense as mining level increases\r\n                    const laserIntensity = Math.min(1.0 + (efficiency - 1.0) * 0.5, 3.0);\r\n                    laserBeam.style.boxShadow = `0 0 ${10 * laserIntensity}px ${glowColor}, 0 0 ${20 * laserIntensity}px ${glowColor}`;\r\n                } else {\r\n                    laserBeam.style.boxShadow = `0 0 10px ${glowColor}, 0 0 20px ${glowColor}`;\r\n                }\r\n                \r\n                laserBeam.style.backgroundColor = laserColor;\r\n            } else {\r\n                // Default red laser\r\n                laserBeam.style.backgroundColor = '#ff3030'; \r\n                laserBeam.style.boxShadow = '0 0 10px #ff0000, 0 0 20px #ff0000';\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Hide laser beam\r\n     */\r\n    hideLaserBeam() {\r\n        const laserBeam = document.getElementById('laser-beam');\r\n        if (laserBeam) {\r\n            laserBeam.style.display = 'none';\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Activate spaceship's mining laser\r\n     */\r\n    activateSpaceshipLaser() {\r\n        if (this.spaceship && typeof this.spaceship.activateMiningLaser === 'function') {\r\n            this.spaceship.activateMiningLaser();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Deactivate spaceship's mining laser\r\n     */\r\n    deactivateSpaceshipLaser() {\r\n        if (this.spaceship && typeof this.spaceship.deactivateMiningLaser === 'function') {\r\n            this.spaceship.deactivateMiningLaser();\r\n        }\r\n    }\r\n}","// targetValidation.js - Handles target validation and range checking\r\n\r\nexport class TargetValidation {\r\n    constructor(spaceship, miningDistance = 6000) {\r\n        this.spaceship = spaceship;\r\n        this.miningDistance = miningDistance;\r\n    }\r\n\r\n    /**\r\n     * Validate asteroid target\r\n     */\r\n    validateAsteroid(asteroid) {\r\n        try {\r\n            console.log(\"TargetValidation: validating asteroid\", asteroid);\r\n            \r\n            // Validate asteroid before setting it as the target\r\n            if (!asteroid || !asteroid.mesh || !asteroid.mesh.position) {\r\n                console.error(\"TargetValidation: Invalid asteroid provided\");\r\n                return false;\r\n            }\r\n\r\n            return true;\r\n        } catch (error) {\r\n            console.error(\"TargetValidation: Error validating asteroid:\", error);\r\n            return false;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Check if target is in mining range\r\n     */\r\n    isInRange(asteroid) {\r\n        if (!asteroid || !asteroid.mesh || !this.spaceship || !this.spaceship.mesh) {\r\n            return false;\r\n        }\r\n\r\n        const distance = this.spaceship.mesh.position.distanceTo(asteroid.mesh.position);\r\n        return distance <= this.miningDistance;\r\n    }\r\n\r\n    /**\r\n     * Get distance to target\r\n     */\r\n    getDistanceToTarget(asteroid) {\r\n        if (!asteroid || !asteroid.mesh || !this.spaceship || !this.spaceship.mesh) {\r\n            return Infinity;\r\n        }\r\n\r\n        return this.spaceship.mesh.position.distanceTo(asteroid.mesh.position);\r\n    }\r\n\r\n    /**\r\n     * Validate spaceship for mining\r\n     */\r\n    validateSpaceship() {\r\n        if (!this.spaceship || !this.spaceship.mesh || !this.spaceship.mesh.position) {\r\n            console.error(\"TargetValidation: Spaceship is missing mesh or position\");\r\n            return false;\r\n        }\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Check if asteroid is valid for mining start\r\n     */\r\n    canStartMining(asteroid) {\r\n        if (!this.validateAsteroid(asteroid)) {\r\n            return { valid: false, reason: \"Invalid asteroid\" };\r\n        }\r\n\r\n        if (!this.validateSpaceship()) {\r\n            return { valid: false, reason: \"Invalid spaceship\" };\r\n        }\r\n\r\n        const distance = this.getDistanceToTarget(asteroid);\r\n        if (distance > this.miningDistance) {\r\n            return { \r\n                valid: false, \r\n                reason: \"Out of range\",\r\n                distance: distance,\r\n                maxRange: this.miningDistance\r\n            };\r\n        }\r\n\r\n        return { valid: true };\r\n    }\r\n}","// resourceExtraction.js - Handles resource extraction and notification\r\n\r\nexport class ResourceExtraction {\r\n    constructor() {\r\n        this.resources = {\r\n            iron: 0,\r\n            gold: 0,\r\n            platinum: 0\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Add all resources from the mined asteroid to the player's inventory at once\r\n     */\r\n    addAsteroidResources(targetAsteroid, efficiency = 1.0) {\r\n        if (!targetAsteroid) return false;\r\n        \r\n        // Get the resource type from the asteroid\r\n        const resourceType = targetAsteroid.resourceType || 'iron'; // Default to iron if no type specified\r\n        \r\n        // Get mining efficiency for resource extraction bonus\r\n        const bonusChance = (efficiency - 1.0) * 0.5; // Chance for bonus resources based on efficiency\r\n        \r\n        // Calculate base amount based on asteroid type\r\n        let amount = 0;\r\n        switch (resourceType.toLowerCase()) {\r\n            case 'iron':\r\n                amount = Math.floor(Math.random() * 5) + 10; // 10-14 iron\r\n                break;\r\n            case 'gold':\r\n                amount = Math.floor(Math.random() * 3) + 5; // 5-7 gold\r\n                break;\r\n            case 'platinum':\r\n                amount = Math.floor(Math.random() * 2) + 2; // 2-3 platinum\r\n                break;\r\n            default:\r\n                amount = 10; // Default to 10 iron\r\n        }\r\n        \r\n        // Apply bonus resources based on mining efficiency\r\n        if (efficiency > 1.0 && Math.random() < bonusChance) {\r\n            amount = Math.ceil(amount * 1.2); // 20% bonus\r\n        }\r\n        \r\n        // Update resource counts\r\n        switch (resourceType.toLowerCase()) {\r\n            case 'iron':\r\n                this.resources.iron += amount;\r\n                break;\r\n            case 'gold':\r\n                this.resources.gold += amount;\r\n                break;\r\n            case 'platinum':\r\n                this.resources.platinum += amount;\r\n                break;\r\n            default:\r\n                this.resources.iron += amount;\r\n        }\r\n        \r\n        console.log(`ResourceExtraction: Added ${amount} ${resourceType} from asteroid`);\r\n        \r\n        // Show resource gain notification\r\n        this.showResourceGainNotification(amount, resourceType);\r\n        \r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Show a notification for resources gained\r\n     */\r\n    showResourceGainNotification(amount, resourceType) {\r\n        // Get color based on resource type\r\n        let color = '#a0a0a0'; // Default gray for iron\r\n        if (resourceType === 'gold') {\r\n            color = '#ffcc00';\r\n        } else if (resourceType === 'platinum') {\r\n            color = '#66ffff';\r\n        }\r\n        \r\n        // Create notification element\r\n        const notification = document.createElement('div');\r\n        notification.textContent = `+${amount} ${resourceType.toUpperCase()}`;\r\n        notification.style.position = 'absolute';\r\n        notification.style.top = '40%';\r\n        notification.style.left = '50%';\r\n        notification.style.transform = 'translate(-50%, -50%)';\r\n        notification.style.color = color;\r\n        notification.style.fontSize = '24px';\r\n        notification.style.fontWeight = 'bold';\r\n        notification.style.textShadow = '0 0 8px black';\r\n        notification.style.zIndex = '1000';\r\n        notification.style.opacity = '1';\r\n        notification.style.transition = 'all 1.5s ease-out';\r\n        \r\n        document.body.appendChild(notification);\r\n        \r\n        // Animate the notification\r\n        setTimeout(() => {\r\n            notification.style.opacity = '0';\r\n            notification.style.top = '30%';\r\n            \r\n            // Remove after animation\r\n            setTimeout(() => {\r\n                if (document.body.contains(notification)) {\r\n                    document.body.removeChild(notification);\r\n                }\r\n            }, 1500);\r\n        }, 100);\r\n    }\r\n\r\n    /**\r\n     * Get current resource counts\r\n     */\r\n    getResources() {\r\n        return { ...this.resources };\r\n    }\r\n\r\n    /**\r\n     * Get resource count for specific type\r\n     */\r\n    getResource(type) {\r\n        return this.resources[type.toLowerCase()] || 0;\r\n    }\r\n}","// uiUpdates.js - Handles UI updates and progress displays\r\n\r\nexport class UIUpdates {\r\n    constructor() {}\r\n\r\n    /**\r\n     * Update target info UI elements\r\n     */\r\n    updateTargetInfo(asteroid, spaceship, miningDistance) {\r\n        if (!asteroid || !asteroid.mesh || !spaceship || !spaceship.mesh) return;\r\n        \r\n        try {\r\n            // Check if targeting system is active\r\n            const targetingSystem = window.gameInstance?.controls?.targetingSystem || window.game?.controls?.targetingSystem;\r\n            const isTargetingEnabled = targetingSystem && targetingSystem.isLockOnEnabled();\r\n            \r\n            if (!isTargetingEnabled) return;\r\n\r\n            // Update distance calculation\r\n            const distance = spaceship.mesh.position.distanceTo(asteroid.mesh.position);\r\n            const inRange = distance <= miningDistance;\r\n            \r\n            // Update UI elements if they exist\r\n            const targetDistance = document.getElementById('target-distance');\r\n            if (targetDistance) {\r\n                const rangeStatus = inRange ? ' [IN RANGE]' : ' [OUT OF RANGE]';\r\n                const rangeColor = inRange ? '#00ff00' : '#ff4400';\r\n                targetDistance.innerHTML = `Distance: ${Math.round(distance)} units<span style=\"color: ${rangeColor}\">${rangeStatus}</span>`;\r\n            }\r\n            \r\n            // Update target info color\r\n            const targetInfo = document.getElementById('target-info');\r\n            if (targetInfo) {\r\n                targetInfo.style.color = inRange ? '#30cfd0' : '#ff4400';\r\n                targetInfo.style.display = 'block';\r\n            }\r\n            \r\n            // Update target name to show range status\r\n            const targetName = document.getElementById('target-name');\r\n            if (targetName && asteroid.resourceType) {\r\n                const resourceType = asteroid.resourceType.toUpperCase();\r\n                if (!inRange) {\r\n                    targetName.textContent = `${resourceType} Asteroid - OUT OF RANGE`;\r\n                    targetName.style.color = '#ff4400';\r\n                } else {\r\n                    targetName.textContent = `${resourceType} Asteroid`;\r\n                    targetName.style.color = '#30cfd0';\r\n                }\r\n            }\r\n        } catch (error) {\r\n            console.error(\"UIUpdates: Error updating target info:\", error);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Update mining status with time estimate\r\n     */\r\n    updateMiningStatusWithTime(asteroid, miningSpeed, efficiency = 1.0) {\r\n        const miningStatusElement = document.getElementById('mining-status');\r\n        if (!miningStatusElement || !asteroid || !asteroid.resourceType) return;\r\n        \r\n        // Calculate approximate time to mine based on resource type\r\n        const resourceType = asteroid.resourceType.toLowerCase();\r\n        const secondsRequired = Math.round(1 / miningSpeed);\r\n        \r\n        let efficiencyText = \"\";\r\n        if (efficiency > 1.0) {\r\n            efficiencyText = ` [${Math.round(efficiency * 100)}% efficiency]`;\r\n        }\r\n        \r\n        miningStatusElement.textContent = `MINING ${resourceType.toUpperCase()} (${secondsRequired}s)${efficiencyText}`;\r\n        miningStatusElement.style.color = '#ff4400';\r\n    }\r\n\r\n    /**\r\n     * Reset mining status display\r\n     */\r\n    resetMiningStatus() {\r\n        const miningStatusElement = document.getElementById('mining-status');\r\n        if (miningStatusElement) {\r\n            miningStatusElement.textContent = 'INACTIVE';\r\n            miningStatusElement.style.color = '#30cfd0';\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Create or update mining progress bar\r\n     */\r\n    setupMiningProgressBar() {\r\n        let miningProgressContainer = document.getElementById('mining-progress-container');\r\n        if (!miningProgressContainer) {\r\n            console.log(\"UIUpdates: Creating mining progress container\");\r\n            miningProgressContainer = document.createElement('div');\r\n            miningProgressContainer.id = 'mining-progress-container';\r\n            miningProgressContainer.style.position = 'absolute';\r\n            miningProgressContainer.style.bottom = '20px';\r\n            miningProgressContainer.style.left = '50%';\r\n            miningProgressContainer.style.transform = 'translateX(-50%)';\r\n            miningProgressContainer.style.width = '200px';\r\n            miningProgressContainer.style.height = '10px';\r\n            miningProgressContainer.style.backgroundColor = 'rgba(0, 0, 0, 0.5)';\r\n            miningProgressContainer.style.border = '1px solid #30cfd0';\r\n            miningProgressContainer.style.zIndex = '1000';\r\n            document.body.appendChild(miningProgressContainer);\r\n            \r\n            const progressBar = document.createElement('div');\r\n            progressBar.id = 'mining-progress-bar';\r\n            progressBar.style.width = '0%';\r\n            progressBar.style.height = '100%';\r\n            progressBar.style.backgroundColor = '#30cfd0';\r\n            miningProgressContainer.appendChild(progressBar);\r\n        } else {\r\n            miningProgressContainer.style.display = 'block';\r\n            const progressBar = document.getElementById('mining-progress-bar');\r\n            if (progressBar) {\r\n                progressBar.style.width = '0%';\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Update mining progress bar\r\n     */\r\n    updateMiningProgress(progress) {\r\n        const progressBar = document.getElementById('mining-progress-bar');\r\n        if (progressBar) {\r\n            progressBar.style.width = `${progress * 100}%`;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Hide mining progress bar\r\n     */\r\n    hideMiningProgressBar() {\r\n        const miningProgressContainer = document.getElementById('mining-progress-container');\r\n        if (miningProgressContainer) {\r\n            miningProgressContainer.style.display = 'none';\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Show out of range message\r\n     */\r\n    showOutOfRangeMessage() {\r\n        const targetingSystem = window.gameInstance?.controls?.targetingSystem || window.game?.controls?.targetingSystem;\r\n        const isTargetingEnabled = targetingSystem && targetingSystem.isLockOnEnabled();\r\n        \r\n        const targetInfo = document.getElementById('target-info');\r\n        if (targetInfo && isTargetingEnabled) {\r\n            targetInfo.textContent = 'TARGET OUT OF RANGE';\r\n            targetInfo.style.color = '#ff4400';\r\n            targetInfo.style.display = 'block';\r\n            \r\n            // Hide after 2 seconds\r\n            setTimeout(() => {\r\n                if (!targetingSystem || !targetingSystem.isLockOnEnabled()) {\r\n                    targetInfo.style.display = 'none';\r\n                }\r\n            }, 2000);\r\n        }\r\n    }\r\n}","// visualEffects.js - Handles visual effects for mining operations\r\n\r\nimport * as THREE from 'three';\r\n\r\nexport class VisualEffects {\r\n    constructor(scene) {\r\n        this.scene = scene;\r\n        this.miningParticles = null;\r\n        this.setupMiningParticles();\r\n    }\r\n\r\n    /**\r\n     * Setup mining particles effect\r\n     */\r\n    setupMiningParticles() {\r\n        // Create particle effect for mining impact\r\n        const particleCount = 100;\r\n        const particles = new THREE.BufferGeometry();\r\n        const particleMaterial = new THREE.PointsMaterial({\r\n            color: 0xff5500,\r\n            size: 1.5,\r\n            blending: THREE.AdditiveBlending,\r\n            transparent: true,\r\n            opacity: 0.8\r\n        });\r\n        \r\n        const positions = new Float32Array(particleCount * 3);\r\n        for (let i = 0; i < particleCount; i++) {\r\n            positions[i * 3] = 0;\r\n            positions[i * 3 + 1] = 0;\r\n            positions[i * 3 + 2] = 0;\r\n        }\r\n        \r\n        particles.setAttribute('position', new THREE.BufferAttribute(positions, 3));\r\n        this.miningParticles = new THREE.Points(particles, particleMaterial);\r\n        this.miningParticles.visible = false;\r\n        this.scene.add(this.miningParticles);\r\n    }\r\n\r\n    /**\r\n     * Show mining particles with appropriate color\r\n     */\r\n    showMiningParticles(asteroid, efficiency = 1.0) {\r\n        if (!this.miningParticles) return;\r\n        \r\n        this.miningParticles.visible = true;\r\n        \r\n        // Adjust particle color based on resource type\r\n        if (asteroid.resourceType && this.miningParticles.material) {\r\n            const resourceType = asteroid.resourceType.toLowerCase();\r\n            \r\n            if (resourceType === 'iron') {\r\n                this.miningParticles.material.color.set(0xff5500); // Orange\r\n            } else if (resourceType === 'gold') {\r\n                this.miningParticles.material.color.set(0xffcc00); // Yellow\r\n            } else if (resourceType === 'platinum') {\r\n                this.miningParticles.material.color.set(0x66ffff); // Light blue\r\n            }\r\n            \r\n            // Adjust particle size based on mining efficiency\r\n            if (efficiency > 1.0) {\r\n                this.miningParticles.material.size = 1.5 * Math.sqrt(efficiency);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Hide mining particles\r\n     */\r\n    hideMiningParticles() {\r\n        if (this.miningParticles) {\r\n            this.miningParticles.visible = false;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Update mining particles animation\r\n     */\r\n    updateMiningParticles(efficiency = 1.0) {\r\n        if (!this.miningParticles || !this.miningParticles.visible) return;\r\n        \r\n        const positions = this.miningParticles.geometry.attributes.position.array;\r\n        \r\n        // Particles move faster with higher efficiency\r\n        const particleSpeed = 0.3 * efficiency;\r\n        \r\n        for (let i = 0; i < positions.length; i += 3) {\r\n            // Move particles outward slightly\r\n            const dir = new THREE.Vector3(positions[i], positions[i+1], positions[i+2]);\r\n            dir.normalize().multiplyScalar(particleSpeed);\r\n            \r\n            positions[i] += dir.x;\r\n            positions[i+1] += dir.y;\r\n            positions[i+2] += dir.z;\r\n            \r\n            // Reset particles that move too far\r\n            const dist = Math.sqrt(\r\n                positions[i] * positions[i] + \r\n                positions[i+1] * positions[i+1] + \r\n                positions[i+2] * positions[i+2]\r\n            );\r\n            \r\n            if (dist > 36) {\r\n                positions[i] = (Math.random() - 0.5) * 24;\r\n                positions[i+1] = (Math.random() - 0.5) * 24;\r\n                positions[i+2] = (Math.random() - 0.5) * 24;\r\n            }\r\n        }\r\n        this.miningParticles.geometry.attributes.position.needsUpdate = true;\r\n    }\r\n\r\n    /**\r\n     * Update particles position to asteroid location\r\n     */\r\n    setParticlesPosition(position) {\r\n        if (this.miningParticles && this.miningParticles.visible) {\r\n            this.miningParticles.position.copy(position);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Create asteroid break effect\r\n     */\r\n    createAsteroidBreakEffect(position) {\r\n        // Create particle effect for asteroid breaking\r\n        const particleCount = 50;\r\n        const particles = new THREE.BufferGeometry();\r\n        const particleMaterial = new THREE.PointsMaterial({\r\n            color: 0xaaaaaa,\r\n            size: 12,\r\n            blending: THREE.AdditiveBlending,\r\n            transparent: true,\r\n            opacity: 0.8\r\n        });\r\n        \r\n        const positions = new Float32Array(particleCount * 3);\r\n        const velocities = [];\r\n        \r\n        for (let i = 0; i < particleCount; i++) {\r\n            // Start at asteroid position\r\n            positions[i * 3] = position.x;\r\n            positions[i * 3 + 1] = position.y;\r\n            positions[i * 3 + 2] = position.z;\r\n            \r\n            // Random velocity in all directions\r\n            velocities.push({\r\n                x: (Math.random() - 0.5) * 8,\r\n                y: (Math.random() - 0.5) * 8,\r\n                z: (Math.random() - 0.5) * 8\r\n            });\r\n        }\r\n        \r\n        particles.setAttribute('position', new THREE.BufferAttribute(positions, 3));\r\n        const particleSystem = new THREE.Points(particles, particleMaterial);\r\n        this.scene.add(particleSystem);\r\n        \r\n        // Animate particles\r\n        let frameCount = 0;\r\n        const animateParticles = () => {\r\n            frameCount++;\r\n            \r\n            // Update particle positions\r\n            const positions = particleSystem.geometry.attributes.position.array;\r\n            \r\n            for (let i = 0; i < particleCount; i++) {\r\n                positions[i * 3] += velocities[i].x;\r\n                positions[i * 3 + 1] += velocities[i].y;\r\n                positions[i * 3 + 2] += velocities[i].z;\r\n            }\r\n            \r\n            particleSystem.geometry.attributes.position.needsUpdate = true;\r\n            \r\n            // Fade out over time\r\n            particleSystem.material.opacity = Math.max(0, 0.8 - frameCount * 0.02);\r\n            \r\n            // Remove after 40 frames\r\n            if (frameCount < 40) {\r\n                requestAnimationFrame(animateParticles);\r\n            } else {\r\n                this.scene.remove(particleSystem);\r\n            }\r\n        };\r\n        \r\n        animateParticles();\r\n    }\r\n\r\n    /**\r\n     * Cleanup resources\r\n     */\r\n    cleanup() {\r\n        if (this.miningParticles) {\r\n            if (this.miningParticles.geometry) this.miningParticles.geometry.dispose();\r\n            if (this.miningParticles.material) this.miningParticles.material.dispose();\r\n            this.scene.remove(this.miningParticles);\r\n            this.miningParticles = null;\r\n        }\r\n    }\r\n}","// miningSystem.js - Handles asteroid mining functionality\r\n\r\nimport * as THREE from 'three';\r\nimport { LaserControl } from './mining/laserControl.js';\r\nimport { TargetValidation } from './mining/targetValidation.js';\r\nimport { ResourceExtraction } from './mining/resourceExtraction.js';\r\nimport { UIUpdates } from './mining/uiUpdates.js';\r\nimport { VisualEffects } from './mining/visualEffects.js';\r\n\r\nexport class MiningSystem {\r\n    constructor(spaceship, scene) {\r\n        this.spaceship = spaceship;\r\n        this.scene = scene;\r\n        this.isMining = false;\r\n        this.targetAsteroid = null;\r\n        this.miningProgress = 0;\r\n        this.lastDestroyedAsteroid = null;\r\n        \r\n        // Mining speeds for single-action mining that takes 7.5, 22.5, and 45 seconds respectively\r\n        // Values are in progress per second (1 / seconds_required)\r\n        this.miningSpeedByType = {\r\n            iron: 0.133,     // 1/7.5 seconds to complete\r\n            gold: 0.044,     // 1/22.5 seconds to complete\r\n            platinum: 0.022  // 1/45 seconds to complete\r\n        };\r\n        this.miningSpeed = 0.133; // Default speed, will be set based on asteroid type\r\n        this.miningDistance = 6000; // Maximum mining distance\r\n        this.miningCooldown = 0;\r\n        \r\n        // Initialize component modules\r\n        this.laserControl = new LaserControl(scene, spaceship);\r\n        this.targetValidation = new TargetValidation(spaceship, this.miningDistance);\r\n        this.resourceExtraction = new ResourceExtraction();\r\n        this.uiUpdates = new UIUpdates();\r\n        this.visualEffects = new VisualEffects(scene);\r\n    }\r\n    \r\n    // Helper method to get the mining efficiency from the spaceship\r\n    getMiningEfficiency() {\r\n        return this.spaceship && this.spaceship.miningEfficiency \r\n            ? this.spaceship.miningEfficiency \r\n            : 1.0; // Default value if spaceship property not available\r\n    }\r\n    \r\n    // Expose resources from the resource extraction module\r\n    get resources() {\r\n        return this.resourceExtraction.getResources();\r\n    }\r\n    \r\n    setTargetAsteroid(asteroid) {\r\n        try {\r\n            console.log(\"MiningSystem: setTargetAsteroid called\", asteroid);\r\n            \r\n            // Validate asteroid using validation module\r\n            if (!this.targetValidation.validateAsteroid(asteroid)) {\r\n                return false;\r\n            }\r\n            \r\n            this.targetAsteroid = asteroid;\r\n            \r\n            // Set mining speed based on asteroid resource type and apply efficiency modifier\r\n            if (asteroid && asteroid.resourceType) {\r\n                const resourceType = asteroid.resourceType.toLowerCase();\r\n                const baseSpeed = this.miningSpeedByType[resourceType] || this.miningSpeedByType.iron;\r\n                const efficiency = this.getMiningEfficiency();\r\n                \r\n                this.miningSpeed = baseSpeed * efficiency;\r\n                console.log(`Mining ${resourceType} asteroid with speed: ${this.miningSpeed} (efficiency: ${efficiency}x)`);\r\n                \r\n                // Update UI using UI module\r\n                this.uiUpdates.updateTargetInfo(asteroid, this.spaceship, this.miningDistance);\r\n            } else {\r\n                // Default to iron speed if no resource type is specified\r\n                this.miningSpeed = this.miningSpeedByType.iron * this.getMiningEfficiency();\r\n            }\r\n            \r\n            return true;\r\n        } catch (error) {\r\n            console.error(\"MiningSystem: Error in setTargetAsteroid:\", error);\r\n            return false;\r\n        }\r\n    }\r\n    \r\n    startMining() {\r\n        try {\r\n            console.log(\"MiningSystem: startMining called\");\r\n            \r\n            // Don't allow mining if no asteroid is targeted\r\n            if (!this.targetAsteroid) {\r\n                console.error(\"MiningSystem: Cannot start mining - no target asteroid set\");\r\n                return;\r\n            }\r\n\r\n            // Validate mining conditions using validation module\r\n            const canMine = this.targetValidation.canStartMining(this.targetAsteroid);\r\n            if (!canMine.valid) {\r\n                if (canMine.reason === \"Out of range\") {\r\n                    this.uiUpdates.showOutOfRangeMessage();\r\n                }\r\n                console.log(`MiningSystem: ${canMine.reason}`);\r\n                return;\r\n            }\r\n            \r\n            // Set mining state to active\r\n            this.isMining = true;\r\n            this.miningProgress = 0;\r\n            console.log(\"MiningSystem: Mining state activated\");\r\n            \r\n            // Setup laser beam using laser control module\r\n            this.laserControl.setupLaserBeam(this.targetAsteroid);\r\n            \r\n            // Show mining particles using visual effects module\r\n            this.visualEffects.showMiningParticles(this.targetAsteroid, this.getMiningEfficiency());\r\n            \r\n            // Setup mining progress bar using UI module\r\n            this.uiUpdates.setupMiningProgressBar();\r\n            \r\n            // Activate the spaceship's laser emitter\r\n            this.laserControl.activateSpaceshipLaser();\r\n            \r\n            // Update mining status display with timing info\r\n            this.updateMiningStatusWithTime();\r\n            \r\n            // Trigger laser sound\r\n            if (window.game && window.game.audio) {\r\n                window.game.audio.playSound('mining-laser');\r\n            } else if (window.game && window.game.audio) {\r\n                window.game.audio.playSound('laser');\r\n            }\r\n            \r\n            console.log(\"MiningSystem: Mining successfully started\");\r\n        } catch (error) {\r\n            console.error(\"MiningSystem: Error in startMining:\", error);\r\n            this.isMining = false;\r\n        }\r\n    }\r\n    \r\n    // Update the mining status with time estimate\r\n    updateMiningStatusWithTime() {\r\n        this.uiUpdates.updateMiningStatusWithTime(\r\n            this.targetAsteroid, \r\n            this.miningSpeed, \r\n            this.getMiningEfficiency()\r\n        );\r\n    }\r\n    \r\n    stopMining() {\r\n        if (!this.isMining) return;\r\n        \r\n        this.isMining = false;\r\n        this.miningProgress = 0;\r\n        \r\n        // Hide laser beam using laser control module\r\n        this.laserControl.hideLaserBeam();\r\n        \r\n        // Hide mining particles using visual effects module\r\n        this.visualEffects.hideMiningParticles();\r\n        \r\n        // Hide mining progress bar using UI module\r\n        this.uiUpdates.hideMiningProgressBar();\r\n        \r\n        // Deactivate the spaceship's laser emitter\r\n        this.laserControl.deactivateSpaceshipLaser();\r\n        \r\n        // Reset mining status display\r\n        this.uiUpdates.resetMiningStatus();\r\n        \r\n        // Stop laser sound\r\n        if (window.game && window.game.audio) {\r\n            window.game.audio.stopSound('mining-laser');\r\n        }\r\n    }\r\n    \r\n    update(deltaTime = 1/60) {\r\n        // Update mining cooldown\r\n        if (this.miningCooldown > 0) {\r\n            this.miningCooldown--;\r\n        }\r\n        \r\n        // Update mining if active\r\n        if (this.isMining) {\r\n            this.updateMining(deltaTime);\r\n        }\r\n        \r\n        // Update mining particles if visible\r\n        this.visualEffects.updateMiningParticles(this.getMiningEfficiency());\r\n        \r\n        // Update target info if we have a target but aren't mining\r\n        if (this.targetAsteroid && !this.isMining) {\r\n            this.uiUpdates.updateTargetInfo(this.targetAsteroid, this.spaceship, this.miningDistance);\r\n        }\r\n    }\r\n    \r\n    updateMining(deltaTime = 1/60) {\r\n        // Make sure we have a target asteroid\r\n        if (!this.targetAsteroid || !this.isMining) {\r\n            this.stopMining();\r\n            return;\r\n        }\r\n        \r\n        // Check if asteroid is in range - if not, stop mining and require new click\r\n        const distance = this.spaceship.mesh.position.distanceTo(this.targetAsteroid.mesh.position);\r\n        if (distance > this.miningDistance) {\r\n            this.stopMining();\r\n            return;\r\n        }\r\n        \r\n        // Update mining progress using deltaTime for frame-rate independence\r\n        this.miningProgress += this.miningSpeed * deltaTime;\r\n        \r\n        // Update laser beam position\r\n        this.laserControl.updateLaserBeam(this.targetAsteroid);\r\n        \r\n        // Update mining particles position\r\n        this.visualEffects.setParticlesPosition(this.targetAsteroid.mesh.position);\r\n        \r\n        // Complete mining when progress reaches 1.0\r\n        if (this.miningProgress >= 1.0) {\r\n            // Add resources from asteroid in one batch\r\n            this.resourceExtraction.addAsteroidResources(this.targetAsteroid, this.getMiningEfficiency());\r\n            \r\n            // Create asteroid break effect\r\n            this.visualEffects.createAsteroidBreakEffect(this.targetAsteroid.mesh.position);\r\n            \r\n            // Store reference to the destroyed asteroid\r\n            this.lastDestroyedAsteroid = this.targetAsteroid;\r\n            \r\n            // Remove asteroid from scene\r\n            this.scene.remove(this.targetAsteroid.mesh);\r\n            \r\n            // Stop mining\r\n            this.stopMining();\r\n            this.targetAsteroid = null;\r\n        }\r\n        \r\n        // Update the progress bar\r\n        this.uiUpdates.updateMiningProgress(this.miningProgress);\r\n    }\r\n    \r\n    \r\n    \r\n    \r\n    \r\n    \r\n    // New method to retrieve the last destroyed asteroid and reset the property\r\n    getLastDestroyedAsteroid() {\r\n        const destroyedAsteroid = this.lastDestroyedAsteroid;\r\n        this.lastDestroyedAsteroid = null; // Reset after getting it\r\n        return destroyedAsteroid;\r\n    }\r\n    \r\n} ","// targetingSystem.js - Handles asteroid targeting and lock-on\r\n\r\nimport * as THREE from 'three';\r\n\r\nexport class TargetingSystem {\r\n    constructor(spaceship, scene, environment) {\r\n        this.spaceship = spaceship;\r\n        this.scene = scene;\r\n        this.environment = environment;\r\n        \r\n        this.lockOnEnabled = false;\r\n        this.nearbyAsteroids = [];\r\n        this.currentLockOnIndex = -1;\r\n        this.targetAsteroid = null;\r\n        this.scanRadius = this.getScanRadius(); // Get initial scan radius from spaceship\r\n        \r\n        this.createTargetReticle();\r\n        // Create off-screen indicators\r\n        this.createOffScreenIndicators();\r\n    }\r\n    \r\n    createTargetReticle() {\r\n        // Create the target indicator geometry (outer ring)\r\n        const ringGeometry = new THREE.RingGeometry(150, 180, 32);\r\n        const ringMaterial = new THREE.MeshBasicMaterial({\r\n            color: 0xff3030,\r\n            side: THREE.DoubleSide,\r\n            transparent: true,\r\n            opacity: 0.7\r\n        });\r\n        \r\n        this.targetReticle = new THREE.Mesh(ringGeometry, ringMaterial);\r\n        this.targetReticle.visible = false;\r\n        this.scene.add(this.targetReticle);\r\n        \r\n        // Add inner ring for additional visual interest\r\n        const innerRingGeometry = new THREE.RingGeometry(75, 90, 32);\r\n        const innerRingMaterial = new THREE.MeshBasicMaterial({\r\n            color: 0xff6060,\r\n            side: THREE.DoubleSide,\r\n            transparent: true,\r\n            opacity: 0.5\r\n        });\r\n        \r\n        const innerRing = new THREE.Mesh(innerRingGeometry, innerRingMaterial);\r\n        this.targetReticle.add(innerRing);\r\n    }\r\n    \r\n    // Helper method to get the current scan radius from the spaceship\r\n    getScanRadius() {\r\n        // Increase default scan radius by 5x (from 1000 to 5000)\r\n        return this.spaceship && this.spaceship.scanRange \r\n            ? this.spaceship.scanRange * 5 \r\n            : 5000; // Default value increased by 5x\r\n    }\r\n    \r\n    toggleLockOn() {\r\n        this.lockOnEnabled = !this.lockOnEnabled;\r\n        \r\n        if (this.lockOnEnabled) {\r\n            // Update scan radius before scanning\r\n            this.scanRadius = this.getScanRadius();\r\n            \r\n            // Scan for nearby asteroids\r\n            this.scanForAsteroids();\r\n            \r\n            // Only show targeting UI if we're actually enabling targeting\r\n            const targetInfoElement = document.getElementById('target-info');\r\n            if (targetInfoElement) {\r\n                targetInfoElement.style.display = 'block';\r\n                targetInfoElement.style.color = '#30cfd0';\r\n                \r\n                // Update the content to show we're scanning\r\n                const targetName = document.getElementById('target-name');\r\n                if (targetName) {\r\n                    targetName.textContent = 'Scanning for targets...';\r\n                }\r\n            }\r\n            \r\n            // Automatically select the closest target\r\n            if (this.nearbyAsteroids.length > 0) {\r\n                this.findNearestTarget();\r\n            }\r\n        } else {\r\n            // Clear target and hide UI\r\n            this.nearbyAsteroids = [];\r\n            this.currentLockOnIndex = -1;\r\n            this.targetAsteroid = null;\r\n            this.targetReticle.visible = false;\r\n            \r\n            // Hide off-screen indicators\r\n            this.hideOffScreenIndicators();\r\n            \r\n            // Hide targeting UI\r\n            const targetInfoElement = document.getElementById('target-info');\r\n            if (targetInfoElement) {\r\n                targetInfoElement.style.display = 'none';\r\n            }\r\n        }\r\n        \r\n        return this.lockOnEnabled;\r\n    }\r\n    \r\n    scanForAsteroids() {\r\n        this.nearbyAsteroids = [];\r\n        const shipPosition = this.spaceship.mesh.position;\r\n        \r\n        // Create raycaster for line-of-sight validation\r\n        const raycaster = new THREE.Raycaster();\r\n        \r\n        // Find all asteroids within scan radius\r\n        const asteroids = this.environment.asteroids;\r\n        asteroids.forEach(asteroid => {\r\n            // Skip asteroids that aren't minable or visible\r\n            if (!asteroid.minable || !asteroid.mesh.visible) return;\r\n            \r\n            const distance = shipPosition.distanceTo(asteroid.mesh.position);\r\n            if (distance <= this.scanRadius) {\r\n                // Perform raycasting to verify line of sight\r\n                const direction = new THREE.Vector3()\r\n                    .subVectors(asteroid.mesh.position, shipPosition)\r\n                    .normalize();\r\n                \r\n                raycaster.set(shipPosition, direction);\r\n                raycaster.far = distance;\r\n                \r\n                // Check for intersections with all asteroids\r\n                const intersects = raycaster.intersectObjects(\r\n                    asteroids.filter(a => a.mesh && a.mesh.visible).map(a => a.mesh)\r\n                );\r\n                \r\n                // If the first intersection is our target asteroid, it's visible\r\n                if (intersects.length > 0 && intersects[0].object === asteroid.mesh) {\r\n                    this.nearbyAsteroids.push({\r\n                        asteroid: asteroid,\r\n                        distance: distance\r\n                    });\r\n                }\r\n            }\r\n        });\r\n        \r\n        // Sort by distance\r\n        this.nearbyAsteroids.sort((a, b) => a.distance - b.distance);\r\n        \r\n        // Extract just the asteroid objects after sorting\r\n        this.nearbyAsteroids = this.nearbyAsteroids.map(item => item.asteroid);\r\n        \r\n        // Set current target if we found asteroids\r\n        if (this.nearbyAsteroids.length > 0) {\r\n            this.currentLockOnIndex = 0;\r\n            this.updateLockedOnTarget();\r\n            \r\n            // Update UI to show number of detected asteroids\r\n            const targetNameElement = document.getElementById('target-name');\r\n            if (targetNameElement) {\r\n                targetNameElement.textContent = \r\n                    `Target 1/${this.nearbyAsteroids.length} (${Math.round(this.nearbyAsteroids[0].mesh.position.distanceTo(shipPosition))} units)`;\r\n            }\r\n            \r\n            return true;\r\n        } else {\r\n            // No targets found\r\n            const targetNameElement = document.getElementById('target-name');\r\n            if (targetNameElement) {\r\n                targetNameElement.textContent = 'No targets in range';\r\n            }\r\n            this.targetReticle.visible = false;\r\n            this.targetAsteroid = null;\r\n            \r\n            return false;\r\n        }\r\n    }\r\n    \r\n    cycleLockOnTarget() {\r\n        if (!this.lockOnEnabled || this.nearbyAsteroids.length === 0) return null;\r\n        \r\n        // Move to next target\r\n        this.currentLockOnIndex = (this.currentLockOnIndex + 1) % this.nearbyAsteroids.length;\r\n        return this.updateLockedOnTarget();\r\n    }\r\n    \r\n    updateLockedOnTarget() {\r\n        this.targetAsteroid = this.nearbyAsteroids[this.currentLockOnIndex];\r\n        \r\n        if (this.targetAsteroid) {\r\n            // Don't update UI here - let the mining system handle it\r\n            // This prevents overwriting the mining system's detailed info\r\n            console.log(`Target locked: ${this.targetAsteroid.resourceType} asteroid`);\r\n            \r\n            // Position the targeting indicator\r\n            this.targetReticle.position.copy(this.targetAsteroid.mesh.position);\r\n            this.targetReticle.visible = true;\r\n            \r\n            // Make the indicator look at the camera\r\n            const lookAtPos = new THREE.Vector3().copy(this.scene.camera.position);\r\n            this.targetReticle.lookAt(lookAtPos);\r\n            \r\n            // Ensure proper scale and visibility\r\n            this.targetReticle.scale.set(1, 1, 1);\r\n            this.targetReticle.material.opacity = 0.8;\r\n            if (this.targetReticle.children.length > 0) {\r\n                this.targetReticle.children[0].material.opacity = 0.8;\r\n            }\r\n        }\r\n        \r\n        return this.targetAsteroid;\r\n    }\r\n    \r\n    getCurrentTarget() {\r\n        try {\r\n            console.log(\"TargetingSystem: getCurrentTarget called\");\r\n            \r\n            // Check if we have a valid target\r\n            if (!this.targetAsteroid) {\r\n                console.log(\"TargetingSystem: No current target\");\r\n                return null;\r\n            }\r\n            \r\n            // Validate the target is still valid\r\n            if (!this.targetAsteroid.mesh || !this.targetAsteroid.mesh.position) {\r\n                console.error(\"TargetingSystem: Current target is invalid, clearing target\");\r\n                this.targetAsteroid = null;\r\n                return null;\r\n            }\r\n            \r\n            console.log(\"TargetingSystem: Returning current target:\", this.targetAsteroid);\r\n            return this.targetAsteroid;\r\n        } catch (error) {\r\n            console.error(\"TargetingSystem: Error in getCurrentTarget:\", error);\r\n            return null;\r\n        }\r\n    }\r\n    \r\n    isLockOnEnabled() {\r\n        return this.lockOnEnabled === true;\r\n    }\r\n    \r\n    findNearestTarget() {\r\n        try {\r\n            if (!this.spaceship || !this.spaceship.mesh || !this.spaceship.mesh.position) {\r\n                return null;\r\n            }\r\n            \r\n            // Get all asteroids\r\n            let asteroids = [];\r\n            \r\n            // Try to get asteroids from the game environment\r\n            const game = window.gameInstance || window.game;\r\n            if (game && game.environment && Array.isArray(game.environment.asteroids)) {\r\n                asteroids = game.environment.asteroids;\r\n            } else {\r\n                return null;\r\n            }\r\n            \r\n            if (asteroids.length === 0) {\r\n                return null;\r\n            }\r\n            \r\n            // Find the closest asteroid with proper validation\r\n            let closestAsteroid = null;\r\n            let closestDistance = Infinity;\r\n            \r\n            for (const asteroid of asteroids) {\r\n                // Validate asteroid has required properties and is visible and minable\r\n                if (!asteroid || !asteroid.mesh || !asteroid.mesh.position || !asteroid.mesh.visible || !asteroid.minable) {\r\n                    continue;\r\n                }\r\n                \r\n                const distance = this.spaceship.mesh.position.distanceTo(asteroid.mesh.position);\r\n                \r\n                if (distance < closestDistance) {\r\n                    closestDistance = distance;\r\n                    closestAsteroid = asteroid;\r\n                }\r\n            }\r\n            \r\n            if (closestAsteroid) {\r\n                console.log(\"TargetingSystem: Found nearest target:\", closestAsteroid);\r\n                \r\n                // Select this target\r\n                this.setTarget(closestAsteroid);\r\n                \r\n                return closestAsteroid;\r\n            } else {\r\n                console.log(\"TargetingSystem: No valid asteroid found after checking all asteroids\");\r\n                return null;\r\n            }\r\n        } catch (error) {\r\n            console.error(\"TargetingSystem: Error in findNearestTarget:\", error);\r\n            return null;\r\n        }\r\n    }\r\n    \r\n    update() {\r\n        // Only update scan radius every 30 frames for performance\r\n        if (!this.scanRadiusCounter) this.scanRadiusCounter = 0;\r\n        this.scanRadiusCounter++;\r\n        if (this.scanRadiusCounter >= 30) {\r\n            this.scanRadiusCounter = 0;\r\n            this.scanRadius = this.getScanRadius();\r\n        }\r\n        \r\n        // If targeting is enabled, periodically rescan for new asteroids\r\n        if (this.lockOnEnabled) {\r\n            // Rescan every 120 frames (about every 2 seconds at 60fps) for better performance\r\n            if (!this.rescanCounter) this.rescanCounter = 0;\r\n            this.rescanCounter++;\r\n            \r\n            if (this.rescanCounter >= 120) {\r\n                this.rescanCounter = 0;\r\n                const previousCount = this.nearbyAsteroids.length;\r\n                this.scanForAsteroids();\r\n                \r\n                // If we found new asteroids and don't have a target, auto-select one\r\n                if (this.nearbyAsteroids.length > 0 && !this.targetAsteroid) {\r\n                    this.findNearestTarget();\r\n                }\r\n            }\r\n        }\r\n        \r\n        // Update lock-on targeting visuals (optimized)\r\n        if (this.lockOnEnabled && this.targetAsteroid) {\r\n            // Update target indicator position\r\n            this.targetReticle.position.copy(this.targetAsteroid.mesh.position);\r\n            \r\n            // Make indicator face the camera (less frequently)\r\n            if (!this.lookAtCounter) this.lookAtCounter = 0;\r\n            this.lookAtCounter++;\r\n            if (this.lookAtCounter >= 10) {  // Every 10 frames instead of every frame\r\n                this.lookAtCounter = 0;\r\n                this.targetReticle.lookAt(this.scene.camera.position);\r\n            }\r\n            \r\n            // Simple rotation animation (more efficient)\r\n            this.targetReticle.rotation.z += 0.005;  // Reduced rotation speed\r\n            if (this.targetReticle.children.length > 0) {\r\n                this.targetReticle.children[0].rotation.z -= 0.01;\r\n            }\r\n            \r\n            // Simplified pulsing (no Date.now() calls)\r\n            if (!this.pulseTime) this.pulseTime = 0;\r\n            this.pulseTime += 0.02;  // Fixed time step\r\n            const pulseValue = Math.sin(this.pulseTime);\r\n            const opacity = 0.7 + 0.2 * pulseValue;  // Less dramatic pulsing\r\n            this.targetReticle.material.opacity = opacity;\r\n            \r\n            // Update UI less frequently for performance\r\n            if (!this.uiUpdateCounter) this.uiUpdateCounter = 0;\r\n            this.uiUpdateCounter++;\r\n            if (this.uiUpdateCounter >= 30) {  // Update UI every 30 frames (~0.5 seconds)\r\n                this.uiUpdateCounter = 0;\r\n                \r\n                // Update distance in UI\r\n                const targetDistanceElement = document.getElementById('target-distance');\r\n                if (targetDistanceElement) {\r\n                    const distance = Math.round(this.spaceship.mesh.position.distanceTo(this.targetAsteroid.mesh.position));\r\n                    targetDistanceElement.textContent = `Distance: ${distance} units`;\r\n                }\r\n                \r\n                // Check if target is destroyed or too far away\r\n                if (!this.targetAsteroid.mesh.parent || \r\n                    this.spaceship.mesh.position.distanceTo(this.targetAsteroid.mesh.position) > this.scanRadius) {\r\n                    this.scanForAsteroids();\r\n                }\r\n            }\r\n            \r\n            // Always show the reticle when targeting\r\n            this.targetReticle.visible = true;\r\n            \r\n            // Simplified off-screen indicator (check less frequently)\r\n            if (this.uiUpdateCounter === 15) {  // Check half-way through UI update cycle\r\n                const isOnScreen = this.isTargetOnScreen();\r\n                if (!isOnScreen) {\r\n                    const screenPosition = this.getScreenPosition(this.targetAsteroid.mesh.position);\r\n                    const targetDirection = this.getTargetDirection();\r\n                    this.showOffScreenIndicator(screenPosition, targetDirection);\r\n                } else {\r\n                    this.hideOffScreenIndicators();\r\n                }\r\n            }\r\n        }\r\n    }\r\n    \r\n    setTarget(target) {\r\n        try {\r\n            console.log(\"TargetingSystem: setTarget called\", target);\r\n            \r\n            // Validate the target\r\n            if (!target) {\r\n                console.error(\"TargetingSystem: Cannot set null target\");\r\n                return;\r\n            }\r\n            \r\n            if (!target.mesh || !target.mesh.position) {\r\n                console.error(\"TargetingSystem: Target is missing mesh or position properties\", target);\r\n                return;\r\n            }\r\n            \r\n            // Set the target\r\n            this.targetAsteroid = target;\r\n            \r\n            // Update UI elements\r\n            if (this.targetDisplay) {\r\n                this.targetDisplay.style.display = 'block';\r\n            }\r\n            \r\n            if (this.targetInfoElement) {\r\n                // Format target info\r\n                const distance = this.calculateDistanceToTarget();\r\n                let resourceType = target.resourceType || 'Unknown';\r\n                \r\n                // Capitalize first letter\r\n                resourceType = resourceType.charAt(0).toUpperCase() + resourceType.slice(1);\r\n                \r\n                // Update target info text\r\n                this.targetInfoElement.textContent = `${resourceType} Asteroid - ${distance.toFixed(0)}m`;\r\n                this.targetInfoElement.style.color = '#30cfd0';\r\n                this.targetInfoElement.style.display = 'block';\r\n            }\r\n            \r\n            console.log(\"TargetingSystem: Target successfully set\", this.targetAsteroid);\r\n            \r\n            // Enable lock-on\r\n            this.lockOnEnabled = true;\r\n            \r\n            return true;\r\n        } catch (error) {\r\n            console.error(\"TargetingSystem: Error in setTarget:\", error);\r\n            return false;\r\n        }\r\n    }\r\n    \r\n    calculateDistanceToTarget() {\r\n        try {\r\n            if (!this.targetAsteroid || !this.targetAsteroid.mesh || !this.targetAsteroid.mesh.position) {\r\n                console.error(\"TargetingSystem: Cannot calculate distance - invalid target asteroid\");\r\n                return Infinity;\r\n            }\r\n            \r\n            if (!this.spaceship || !this.spaceship.mesh || !this.spaceship.mesh.position) {\r\n                console.error(\"TargetingSystem: Cannot calculate distance - invalid spaceship\");\r\n                return Infinity;\r\n            }\r\n            \r\n            const distance = this.spaceship.mesh.position.distanceTo(this.targetAsteroid.mesh.position);\r\n            return distance;\r\n        } catch (error) {\r\n            console.error(\"TargetingSystem: Error calculating distance to target:\", error);\r\n            return Infinity;\r\n        }\r\n    }\r\n    \r\n    // Add methods for off-screen indicators\r\n    createOffScreenIndicators() {\r\n        // Create container for off-screen indicators\r\n        this.offScreenContainer = document.createElement('div');\r\n        this.offScreenContainer.id = 'off-screen-indicators';\r\n        this.offScreenContainer.style.position = 'absolute';\r\n        this.offScreenContainer.style.top = '0';\r\n        this.offScreenContainer.style.left = '0';\r\n        this.offScreenContainer.style.width = '100%';\r\n        this.offScreenContainer.style.height = '100%';\r\n        this.offScreenContainer.style.pointerEvents = 'none';\r\n        this.offScreenContainer.style.display = 'none';\r\n        document.body.appendChild(this.offScreenContainer);\r\n        \r\n        // Create the arrow indicator\r\n        this.offScreenIndicator = document.createElement('div');\r\n        this.offScreenIndicator.style.position = 'absolute';\r\n        this.offScreenIndicator.style.width = '30px';\r\n        this.offScreenIndicator.style.height = '30px';\r\n        this.offScreenIndicator.innerHTML = `\r\n            <svg width=\"30\" height=\"30\" viewBox=\"0 0 30 30\">\r\n                <polygon points=\"15,0 30,30 15,22 0,30\" fill=\"#ff3030\" />\r\n            </svg>\r\n        `;\r\n        this.offScreenIndicator.style.transformOrigin = 'center center';\r\n        this.offScreenIndicator.style.display = 'none';\r\n        this.offScreenContainer.appendChild(this.offScreenIndicator);\r\n    }\r\n    \r\n    hideOffScreenIndicators() {\r\n        if (this.offScreenContainer) {\r\n            this.offScreenContainer.style.display = 'none';\r\n        }\r\n        if (this.offScreenIndicator) {\r\n            this.offScreenIndicator.style.display = 'none';\r\n        }\r\n    }\r\n    \r\n    showOffScreenIndicator(screenPosition, targetDirection) {\r\n        if (!this.offScreenContainer || !this.offScreenIndicator) return;\r\n        \r\n        // Show container\r\n        this.offScreenContainer.style.display = 'block';\r\n        this.offScreenIndicator.style.display = 'block';\r\n        \r\n        // Calculate angle for the arrow to point at target\r\n        const angle = Math.atan2(targetDirection.y, targetDirection.x) * (180 / Math.PI);\r\n        \r\n        // Position at the edge of screen\r\n        const margin = 50; // Margin from the screen edge\r\n        const halfWidth = window.innerWidth / 2;\r\n        const halfHeight = window.innerHeight / 2;\r\n        \r\n        // Normalize direction vector\r\n        const normalizedDir = new THREE.Vector2(targetDirection.x, targetDirection.y).normalize();\r\n        \r\n        // Calculate intersection with screen edge\r\n        let edgeX, edgeY;\r\n        \r\n        // Check if we're intersecting with the vertical or horizontal edge\r\n        const slopeRatio = Math.abs(normalizedDir.y / normalizedDir.x);\r\n        const screenRatio = halfHeight / halfWidth;\r\n        \r\n        if (slopeRatio > screenRatio) {\r\n            // Intersect with top/bottom edge\r\n            edgeY = normalizedDir.y > 0 ? halfHeight - margin : -halfHeight + margin;\r\n            edgeX = edgeY / normalizedDir.y * normalizedDir.x;\r\n        } else {\r\n            // Intersect with left/right edge\r\n            edgeX = normalizedDir.x > 0 ? halfWidth - margin : -halfWidth + margin;\r\n            edgeY = edgeX / normalizedDir.x * normalizedDir.y;\r\n        }\r\n        \r\n        // Position the indicator at the edge of the screen\r\n        this.offScreenIndicator.style.left = (halfWidth + edgeX) + 'px';\r\n        this.offScreenIndicator.style.top = (halfHeight + edgeY) + 'px';\r\n        this.offScreenIndicator.style.transform = `rotate(${angle}deg)`;\r\n    }\r\n    \r\n    // Helper methods for screen position calculations\r\n    isTargetOnScreen() {\r\n        if (!this.targetAsteroid || !this.targetAsteroid.mesh) return false;\r\n        \r\n        const screenPosition = this.getScreenPosition(this.targetAsteroid.mesh.position);\r\n        \r\n        // Check if position is within screen bounds with some margin\r\n        const margin = 0.1; // 10% margin\r\n        return screenPosition.x >= -1 + margin && \r\n               screenPosition.x <= 1 - margin && \r\n               screenPosition.y >= -1 + margin && \r\n               screenPosition.y <= 1 - margin;\r\n    }\r\n    \r\n    getScreenPosition(worldPosition) {\r\n        // Create a copy of the position\r\n        const tempVector = new THREE.Vector3().copy(worldPosition);\r\n        \r\n        // Project to screen space\r\n        tempVector.project(this.scene.camera);\r\n        \r\n        return new THREE.Vector2(tempVector.x, tempVector.y);\r\n    }\r\n    \r\n    getTargetDirection() {\r\n        // Get normalized direction vector from screen center to target\r\n        const screenPosition = this.getScreenPosition(this.targetAsteroid.mesh.position);\r\n        \r\n        // Create a direction vector from screen center to target position\r\n        return new THREE.Vector2(screenPosition.x, screenPosition.y);\r\n    }\r\n} ","// proximityDetector.js - Handles stargate proximity detection\r\n\r\nexport class ProximityDetector {\r\n    constructor() {\r\n        this.nearStargate = false;\r\n    }\r\n\r\n    // Check if spaceship is within docking range of stargate\r\n    checkStargateProximity(spaceship, stargate, ui) {\r\n        if (spaceship.isDocked) return;\r\n        \r\n        if (!stargate || !spaceship || !spaceship.mesh) return;\r\n        \r\n        const stargatePosition = stargate.getPosition();\r\n        if (!stargatePosition) return;\r\n        \r\n        const distance = spaceship.mesh.position.distanceTo(stargatePosition);\r\n        \r\n        if (distance < 2000) { // Within docking range (4x the original 500)\r\n            this.nearStargate = true;\r\n            if (ui && ui.stargateInterface) {\r\n                ui.stargateInterface.showDockingPrompt();\r\n            }\r\n            // Also show the dock button in touch controls for mobile\r\n            if (ui && ui.controls && ui.controls.isMobile && \r\n                ui.controls.touchControls) {\r\n                ui.controls.touchControls.showDockButton();\r\n            }\r\n        } else {\r\n            this.nearStargate = false;\r\n            if (ui && ui.stargateInterface) {\r\n                ui.stargateInterface.hideDockingPrompt();\r\n            }\r\n            // Also hide the dock button in touch controls for mobile\r\n            if (ui && ui.controls && ui.controls.isMobile && \r\n                ui.controls.touchControls) {\r\n                ui.controls.touchControls.hideDockButton();\r\n            }\r\n        }\r\n    }\r\n\r\n    isNearStargate() {\r\n        return this.nearStargate;\r\n    }\r\n}","// dockingLogic.js - Core docking and undocking logic\r\n\r\nexport class DockingLogic {\r\n    constructor() {\r\n        this.isDocked = false;\r\n        this.dockingAvailable = false;\r\n        this.autoPointerLockOnUndock = true;\r\n        this.preUndockShieldValue = 0;\r\n    }\r\n\r\n    // Method to detect mobile devices\r\n    isMobileDevice() {\r\n        return ('ontouchstart' in window) || \r\n               (navigator.maxTouchPoints > 0) || \r\n               (navigator.msMaxTouchPoints > 0) ||\r\n               (window.innerWidth < 900);\r\n    }\r\n\r\n    dockWithStargate(spaceship, stargate, ui) {\r\n        console.log(\"Docking with stargate\");\r\n        \r\n        // Only update ship state if it's not already docked\r\n        if (!spaceship.isDocked) {\r\n            // Dock the ship\r\n            spaceship.dock();\r\n            this.isDocked = true;\r\n            \r\n            // Publish the player.docked event for enemy system and other systems to respond\r\n            if (spaceship.world && spaceship.world.messageBus) {\r\n                spaceship.world.messageBus.publish('player.docked', {\r\n                    playerPosition: spaceship.mesh.position.clone(),\r\n                    stargate: stargate\r\n                });\r\n                console.log(\"Published player.docked event\");\r\n            }\r\n        } else {\r\n            console.log(\"Ship is already docked, just showing UI\");\r\n        }\r\n        \r\n        // Mobile-specific preparation - ensure all classes that might block UI visibility are removed\r\n        if (this.isMobileDevice()) {\r\n            console.log(\"Mobile device detected - preparing for stargate UI\");\r\n            document.body.classList.remove('undocking', 'modal-open');\r\n            \r\n            // Reset any problematic styles that might prevent UI from showing\r\n            document.body.style.position = 'static';\r\n            document.body.style.touchAction = 'auto';\r\n            document.body.style.pointerEvents = 'auto';\r\n            document.body.style.overflow = 'auto';\r\n        }\r\n        \r\n        // Show the stargate UI\r\n        if (ui && ui.stargateInterface) {\r\n            console.log(\"Showing stargate UI...\");\r\n            ui.stargateInterface.showStargateUI();\r\n            \r\n            // Double-check visibility on mobile with a small delay\r\n            if (this.isMobileDevice()) {\r\n                setTimeout(() => {\r\n                    const stargateUI = document.getElementById('stargate-ui');\r\n                    if (stargateUI && stargateUI.style.display !== 'block') {\r\n                        console.log(\"Forcing stargate UI display\");\r\n                        stargateUI.style.display = 'block';\r\n                    }\r\n                }, 100);\r\n            }\r\n        }\r\n        \r\n        // Hide game UI elements\r\n        if (ui) {\r\n            ui.hideUI();\r\n        }\r\n        \r\n        // Exit pointer lock so cursor is visible for UI interactions\r\n        if (document.pointerLockElement) {\r\n            document.exitPointerLock();\r\n            console.log(\"Exited pointer lock for UI interaction\");\r\n        }\r\n    }\r\n\r\n    // Helper to wrap steps in requestAnimationFrame for smoother UI updates\r\n    async performStep(stepFunction, stepName) {\r\n        return new Promise(resolve => {\r\n            requestAnimationFrame(() => {\r\n                try {\r\n                    stepFunction();\r\n                    console.log(`Completed step: ${stepName}`);\r\n                } catch (err) {\r\n                    console.error(`Error during step ${stepName}:`, err);\r\n                }\r\n                resolve();\r\n            });\r\n        });\r\n    }\r\n\r\n    // Helper to yield control to the browser\r\n    async yieldToBrowser() {\r\n        return new Promise(resolve => requestAnimationFrame(resolve));\r\n    }\r\n\r\n    // Optimized method to reset mobile styles\r\n    resetMobileStyles() {\r\n        // Immediately remove problematic classes for Android\r\n        if (this.isMobileDevice()) {\r\n            document.body.classList.remove('undocking', 'modal-open');\r\n        }\r\n        \r\n        // Batch style changes to minimize reflows\r\n        requestAnimationFrame(() => {\r\n            // FIX: More aggressive style clearing for Android\r\n            document.body.style.cssText = '';\r\n            document.body.style.overflow = 'auto';\r\n            document.body.style.position = 'static';\r\n            document.body.style.height = 'auto';\r\n            document.body.style.width = 'auto';\r\n            document.body.style.touchAction = 'auto';\r\n            document.body.style.pointerEvents = 'auto';\r\n            document.body.style.webkitOverflowScrolling = 'touch';\r\n            \r\n            // FIX: Ensure all restrictive classes are removed to prevent touch event issues\r\n            document.body.classList.remove('modal-open', 'undocking');\r\n            \r\n            // Reset scrollable containers in a single pass\r\n            document.querySelectorAll('.modal-content, #stargate-ui, #star-map').forEach(container => {\r\n                if (container && container.style) {\r\n                    container.style.cssText = 'overflow: auto; -webkit-overflow-scrolling: touch;';\r\n                    container.scrollTop = 0;\r\n                }\r\n            });\r\n        });\r\n    }\r\n\r\n    // Helper method to request pointer lock\r\n    requestPointerLock() {\r\n        // Find the canvas element (it should be the first one in the document)\r\n        const canvas = document.querySelector('canvas');\r\n        if (canvas && !document.pointerLockElement) {\r\n            // Request pointer lock with a slight delay to ensure UI transitions are complete\r\n            setTimeout(() => {\r\n                canvas.requestPointerLock();\r\n                console.log(\"Requested pointer lock for ship control\");\r\n            }, 200);\r\n        }\r\n    }\r\n\r\n    async undockFromStargate(spaceship, ui, closeAllModalsCallback, hideStargateUICallback, showGameUICallback) {\r\n        if (!spaceship.isDocked) {\r\n            console.log(\"Not docked, can't undock\");\r\n            return;\r\n        }\r\n\r\n        // FIX: For Android, immediately remove any classes that might block touch events\r\n        if (this.isMobileDevice()) {\r\n            document.body.classList.remove('undocking');\r\n            this.resetMobileStyles();\r\n        }\r\n\r\n        // Show loading indicator\r\n        const loadingIndicator = document.createElement('div');\r\n        loadingIndicator.className = 'undocking-indicator';\r\n        loadingIndicator.textContent = 'Undocking...';\r\n        document.body.appendChild(loadingIndicator);\r\n\r\n        try {\r\n            console.log(\"Starting undock sequence...\");\r\n            \r\n            // Store shield value before any changes\r\n            this.preUndockShieldValue = spaceship.shield;\r\n            console.log(`Storing pre-undock shield value: ${this.preUndockShieldValue}`);\r\n\r\n            // Step 1: Close all modals\r\n            await this.performStep(() => closeAllModalsCallback(), \"Closing modals\");\r\n            await this.yieldToBrowser();\r\n\r\n            // Step 2: Handle mobile-specific cleanup\r\n            if (this.isMobileDevice()) {\r\n                await this.performStep(() => this.resetMobileStyles(), \"Resetting mobile styles\");\r\n                await this.yieldToBrowser();\r\n            }\r\n\r\n            // Step 3: Hide stargate UI and show game UI\r\n            await this.performStep(() => hideStargateUICallback(), \"Hiding stargate UI\");\r\n            await this.yieldToBrowser();\r\n            \r\n            await this.performStep(() => showGameUICallback(), \"Showing game UI\");\r\n            await this.yieldToBrowser();\r\n\r\n            // Step 4: Perform core undock logic\r\n            console.log(\"Performing core undock...\");\r\n            const newPosition = spaceship.undock();\r\n            \r\n            // Step 5: Sync health values immediately\r\n            console.log(\"Syncing health values...\");\r\n            \r\n            // Check for shield reset issue\r\n            if (spaceship.shield === 0 && this.preUndockShieldValue > 0) {\r\n                console.log(`Fixing shield reset: Restoring to ${this.preUndockShieldValue}`);\r\n                spaceship.shield = this.preUndockShieldValue;\r\n            }\r\n\r\n            // Sync values immediately without setTimeout\r\n            spaceship.syncValuesToHealthComponent();\r\n\r\n            // Publish undocked event with correct state\r\n            const healthData = {\r\n                shield: spaceship.shield,\r\n                maxShield: spaceship.maxShield,\r\n                hull: spaceship.hull,\r\n                maxHull: spaceship.maxHull\r\n            };\r\n\r\n            // Publish to appropriate message bus\r\n            const messageBus = window.game?.messageBus || window.mainMessageBus;\r\n            if (messageBus) {\r\n                messageBus.publish('player.undocked', healthData);\r\n                console.log(\"Published player.undocked event with health values:\", healthData);\r\n            }\r\n\r\n            // Reset docking status\r\n            this.dockingAvailable = false;\r\n\r\n            // Request pointer lock if needed (non-mobile only)\r\n            if (this.autoPointerLockOnUndock && !this.isMobileDevice()) {\r\n                await this.performStep(() => this.requestPointerLock(), \"Requesting pointer lock\");\r\n            }\r\n\r\n            console.log(\"Undock sequence complete\");\r\n            \r\n        } catch (error) {\r\n            console.error(\"Error during undocking:\", error);\r\n        } finally {\r\n            // Clean up loading indicator\r\n            if (document.body.contains(loadingIndicator)) {\r\n                document.body.removeChild(loadingIndicator);\r\n            }\r\n            \r\n            // FIX: More aggressive cleanup for Android devices\r\n            if (this.isMobileDevice()) {\r\n                // Clear all restrictive classes\r\n                document.body.classList.remove('undocking', 'modal-open');\r\n                \r\n                // Force resetMobileStyles again to ensure all touch restrictions are removed\r\n                this.resetMobileStyles();\r\n                \r\n                // Ensure specific problematic styles are cleared\r\n                document.body.style.pointerEvents = '';\r\n                document.body.style.touchAction = '';\r\n                document.body.style.overflowY = '';\r\n                document.body.style.position = '';\r\n            } else {\r\n                document.body.classList.remove('undocking');\r\n            }\r\n        }\r\n    }\r\n}","// uiIntegration.js - Handles UI integration for docking system\r\n\r\nexport class UIIntegration {\r\n    constructor() {\r\n        this.resources = null;\r\n    }\r\n\r\n    setupDockingControls(proximityDetector, dockingLogic, spaceship, ui) {\r\n        // Add docking key handler (Q key)\r\n        document.addEventListener('keydown', e => {\r\n            if (e.key.toLowerCase() === 'q') {\r\n                if (proximityDetector.isNearStargate() && !spaceship.isDocked) {\r\n                    console.log(\"Q key pressed: Docking with stargate\");\r\n                    dockingLogic.dockWithStargate(spaceship, ui.stargate, ui);\r\n                } else if (spaceship.isDocked) {\r\n                    console.log(\"Q key pressed while docked: No action (use Undock button)\");\r\n                } else if (!proximityDetector.isNearStargate()) {\r\n                    console.log(\"Q key pressed but not near stargate\");\r\n                }\r\n            }\r\n        });\r\n        \r\n        // Set up stargate UI button handlers\r\n        this.setupStargateUIControls(spaceship, ui);\r\n    }\r\n\r\n    setupStargateUIControls(spaceship, ui) {\r\n        // Set up refuel button\r\n        const refuelBtn = document.getElementById('refuel-btn');\r\n        if (refuelBtn) {\r\n            refuelBtn.addEventListener('click', () => {\r\n                if (spaceship.credits >= 100) {\r\n                    spaceship.credits -= spaceship.refuel();\r\n                    this.updateStargateUI(spaceship, ui);\r\n                }\r\n            });\r\n        }\r\n        \r\n        // Set up shield repair button\r\n        const repairShieldBtn = document.getElementById('repair-shield-btn');\r\n        if (repairShieldBtn) {\r\n            repairShieldBtn.addEventListener('click', () => {\r\n                if (spaceship.credits >= 150) {\r\n                    spaceship.credits -= spaceship.repairShield();\r\n                    this.updateStargateUI(spaceship, ui);\r\n                }\r\n            });\r\n        }\r\n        \r\n        // Set up hull repair button\r\n        const repairHullBtn = document.getElementById('repair-hull-btn');\r\n        if (repairHullBtn) {\r\n            repairHullBtn.addEventListener('click', () => {\r\n                if (spaceship.credits >= 200) {\r\n                    spaceship.credits -= spaceship.repairHull();\r\n                    this.updateStargateUI(spaceship, ui);\r\n                }\r\n            });\r\n        }\r\n        \r\n        // Set up undock button - this will be handled by the main docking system\r\n        this.setupUndockButton();\r\n        \r\n        // Set up resource selling buttons\r\n        this.setupSellingButtons(spaceship, ui);\r\n        \r\n        // Set up upgrade buttons\r\n        this.setupUpgradeButtons(spaceship, ui);\r\n    }\r\n\r\n    setupUndockButton() {\r\n        const undockBtn = document.getElementById('undock-btn');\r\n        if (undockBtn) {\r\n            // The undock handler will be set up by the main docking system\r\n            // This is just for mobile-specific touch handling\r\n            undockBtn.addEventListener('touchstart', (e) => {\r\n                console.log(\"Touch started on undock button\");\r\n                e.stopPropagation();\r\n            }, { passive: false });\r\n        }\r\n    }\r\n\r\n    setupSellingButtons(spaceship, ui) {\r\n        const sellIronBtn = document.getElementById('sell-iron');\r\n        if (sellIronBtn) {\r\n            sellIronBtn.addEventListener('click', () => {\r\n                if (this.resources.iron > 0) {\r\n                    spaceship.credits += this.resources.iron * 10;\r\n                    this.resources.iron = 0;\r\n                    this.updateStargateUI(spaceship, ui);\r\n                }\r\n            });\r\n        }\r\n        \r\n        const sellGoldBtn = document.getElementById('sell-gold');\r\n        if (sellGoldBtn) {\r\n            sellGoldBtn.addEventListener('click', () => {\r\n                if (this.resources.gold > 0) {\r\n                    spaceship.credits += this.resources.gold * 50;\r\n                    this.resources.gold = 0;\r\n                    this.updateStargateUI(spaceship, ui);\r\n                }\r\n            });\r\n        }\r\n        \r\n        const sellPlatinumBtn = document.getElementById('sell-platinum');\r\n        if (sellPlatinumBtn) {\r\n            sellPlatinumBtn.addEventListener('click', () => {\r\n                if (this.resources.platinum > 0) {\r\n                    spaceship.credits += this.resources.platinum * 200;\r\n                    this.resources.platinum = 0;\r\n                    this.updateStargateUI(spaceship, ui);\r\n                }\r\n            });\r\n        }\r\n    }\r\n\r\n    setupUpgradeButtons(spaceship, ui) {\r\n        // Fuel tank upgrade button handler\r\n        this.setupUpgradeButton('upgrade-fuel-tank', \r\n            () => spaceship.fuelUpgradeCost,\r\n            () => spaceship.upgradeFuelTank(),\r\n            spaceship, ui);\r\n        \r\n        // Engine upgrade button handler\r\n        this.setupUpgradeButton('upgrade-engine', \r\n            () => spaceship.engineUpgradeCost,\r\n            () => spaceship.upgradeEngine(),\r\n            spaceship, ui);\r\n        \r\n        // Mining laser upgrade button handler\r\n        this.setupUpgradeButton('upgrade-mining', \r\n            () => spaceship.miningUpgradeCost,\r\n            () => spaceship.upgradeMiningLaser(),\r\n            spaceship, ui);\r\n        \r\n        // Hull upgrade button handler\r\n        this.setupUpgradeButton('upgrade-hull', \r\n            () => spaceship.hullUpgradeCost,\r\n            () => spaceship.upgradeHull(),\r\n            spaceship, ui);\r\n        \r\n        // Scanner upgrade button handler\r\n        this.setupUpgradeButton('upgrade-scanner', \r\n            () => spaceship.scannerUpgradeCost,\r\n            () => spaceship.upgradeScanner(),\r\n            spaceship, ui);\r\n    }\r\n\r\n    // Helper method to set up an upgrade button with a given cost getter and upgrade function\r\n    setupUpgradeButton(buttonId, costGetter, upgradeFunction, spaceship, ui) {\r\n        const button = document.getElementById(buttonId);\r\n        if (button) {\r\n            button.addEventListener('click', () => {\r\n                const cost = costGetter();\r\n                if (spaceship.credits >= cost) {\r\n                    spaceship.credits -= cost;\r\n                    upgradeFunction();\r\n                    \r\n                    // Update the mining system's efficiency if we upgraded the mining laser\r\n                    if (buttonId === 'upgrade-mining' && this.updateMiningSystem) {\r\n                        this.updateMiningSystem(spaceship, ui);\r\n                    }\r\n                    \r\n                    // Update UI\r\n                    this.updateStargateUI(spaceship, ui);\r\n                }\r\n            });\r\n        }\r\n    }\r\n\r\n    // Method to update the mining system when mining efficiency is upgraded\r\n    updateMiningSystem(spaceship, ui) {\r\n        // Find the mining system through the Controls object to pass the new efficiency\r\n        if (ui && ui.controls && ui.controls.miningSystem) {\r\n            // Apply the mining efficiency to the mining speed\r\n            const miningSystem = ui.controls.miningSystem;\r\n            \r\n            // Update mining speeds for each resource type based on the new efficiency\r\n            Object.keys(miningSystem.miningSpeedByType).forEach(resourceType => {\r\n                const baseSpeed = miningSystem.miningSpeedByType[resourceType];\r\n                miningSystem.miningSpeedByType[resourceType] = \r\n                    baseSpeed * spaceship.miningEfficiency;\r\n            });\r\n            \r\n            console.log(\"Mining system updated with new efficiency:\", spaceship.miningEfficiency);\r\n        }\r\n    }\r\n\r\n    updateStargateUI(spaceship, ui) {\r\n        if (ui && ui.stargateInterface) {\r\n            ui.stargateInterface.updateStargateUI(spaceship, this.resources);\r\n        }\r\n    }\r\n\r\n    // Optimized method to hide UI elements using a single reflow\r\n    hideStargateUI(ui) {\r\n        if (ui && ui.stargateInterface) {\r\n            // Use CSS class for better performance\r\n            document.body.classList.add('undocking');\r\n            ui.stargateInterface.hideStargateUI();\r\n            console.log(\"Hiding stargate interface\");\r\n        }\r\n    }\r\n\r\n    // Optimized method to show game UI elements using a single reflow\r\n    showGameUI(ui) {\r\n        if (ui) {\r\n            // Use CSS class for better performance\r\n            document.body.classList.remove('undocking');\r\n            ui.showUI();\r\n            console.log(\"Showing game UI\");\r\n        }\r\n    }\r\n\r\n    // Method to close any open modal UI that might conflict with undocking\r\n    closeAllModals() {\r\n        try {\r\n            // Close custom system creator if it's open\r\n            const customSystemCreator = document.getElementById('custom-system-creator');\r\n            if (customSystemCreator && window.getComputedStyle(customSystemCreator).display !== 'none') {\r\n                console.log(\"Closing custom system creator before undocking\");\r\n                // See if we can find the close button and simulate a click\r\n                const closeBtn = customSystemCreator.querySelector('#close-system-creator');\r\n                if (closeBtn) {\r\n                    closeBtn.click();\r\n                } else {\r\n                    // Otherwise just hide it directly\r\n                    customSystemCreator.style.display = 'none';\r\n                }\r\n                \r\n                // Force game objects to clean up their modal state\r\n                if (window.game && window.game.ui) {\r\n                    // Check for star map\r\n                    if (window.game.ui.starMap && typeof window.game.ui.starMap.hide === 'function') {\r\n                        window.game.ui.starMap.hide();\r\n                    }\r\n                    \r\n                    // Check for custom system creator\r\n                    if (window.game.ui.customSystemCreator && typeof window.game.ui.customSystemCreator.hide === 'function') {\r\n                        window.game.ui.customSystemCreator.hide();\r\n                    }\r\n                    \r\n                    // Cleanup any modal state on the body\r\n                    document.body.classList.remove('modal-open');\r\n                }\r\n            }\r\n            \r\n            // Close star map if open\r\n            const starMap = document.getElementById('star-map');\r\n            if (starMap && window.getComputedStyle(starMap).display !== 'none') {\r\n                console.log(\"Closing star map before undocking\");\r\n                const closeStarMapBtn = starMap.querySelector('#close-star-map');\r\n                if (closeStarMapBtn) {\r\n                    closeStarMapBtn.click();\r\n                } else {\r\n                    starMap.style.display = 'none';\r\n                }\r\n            }\r\n            \r\n            // Close any other modals\r\n            const allModals = document.querySelectorAll('.modal-container');\r\n            allModals.forEach(modal => {\r\n                if (window.getComputedStyle(modal).display !== 'none') {\r\n                    console.log(\"Closing modal before undocking:\", modal.id || 'unnamed modal');\r\n                    modal.style.display = 'none';\r\n                }\r\n            });\r\n        } catch (err) {\r\n            console.warn(\"Error while closing modals:\", err);\r\n        }\r\n    }\r\n\r\n    // Setter for resources to allow dependency injection\r\n    setResources(resources) {\r\n        this.resources = resources;\r\n    }\r\n}","// dockingSystem.js - Handles stargate docking and trading\r\n\r\nimport { ProximityDetector } from './docking/proximityDetector.js';\r\nimport { DockingLogic } from './docking/dockingLogic.js';\r\nimport { UIIntegration } from './docking/uiIntegration.js';\r\n\r\nexport class DockingSystem {\r\n    constructor(spaceship, stargate, ui) {\r\n        this.spaceship = spaceship;\r\n        this.stargate = stargate;\r\n        this.ui = ui;\r\n        \r\n        // Initialize component modules\r\n        this.proximityDetector = new ProximityDetector();\r\n        this.dockingLogic = new DockingLogic();\r\n        this.uiIntegration = new UIIntegration();\r\n        \r\n        this.isDocked = this.spaceship.isDocked; // Initialize with spaceship's docked state\r\n        \r\n        // Preemptively set a safe undocking position\r\n        if (this.spaceship && this.spaceship.undockLocation && this.stargate) {\r\n            // Position in the middle of the stargate\r\n            this.spaceship.undockLocation.set(0, 10000, 0);\r\n        }\r\n        \r\n        console.log(\"Initializing docking system, ship is \" + (this.isDocked ? \"docked\" : \"undocked\"));\r\n        this.setupDockingControls();\r\n        \r\n        // If we're starting docked, publish the player.docked event immediately\r\n        if (this.isDocked && this.spaceship.world && this.spaceship.world.messageBus) {\r\n            this.spaceship.world.messageBus.publish('player.docked', {\r\n                playerPosition: this.spaceship.mesh ? this.spaceship.mesh.position.clone() : null,\r\n                stargate: this.stargate\r\n            });\r\n            console.log(\"Published initial player.docked event\");\r\n        }\r\n    }\r\n    \r\n    setupDockingControls() {\r\n        // Delegate to UI integration module\r\n        this.uiIntegration.setupDockingControls(\r\n            this.proximityDetector, \r\n            this.dockingLogic, \r\n            this.spaceship, \r\n            this.ui\r\n        );\r\n        \r\n        // Set up undock button handler specifically\r\n        this.setupUndockButton();\r\n    }\r\n    \r\n    setupStargateUIControls() {\r\n        // Delegate to UI integration module\r\n        this.uiIntegration.setupStargateUIControls(this.spaceship, this.ui);\r\n    }\r\n    \r\n    setupUndockButton() {\r\n        const undockBtn = document.getElementById('undock-btn');\r\n        if (undockBtn) {\r\n            // Use both click and touchend events for better Android compatibility\r\n            const handleUndock = (e) => {\r\n                // Prevent any default action that might interfere\r\n                e.preventDefault();\r\n                e.stopPropagation();\r\n                \r\n                // Log which event triggered the undock\r\n                console.log(`Undock button ${e.type} event triggered`);\r\n\r\n                // Add a small delay to ensure the event completes on Android\r\n                if (this.dockingLogic.isMobileDevice()) {\r\n                    // For Android, remove the overlay classes immediately\r\n                    document.body.classList.remove('undocking', 'modal-open');\r\n                    // Set a brief timeout to allow touch event to complete\r\n                    setTimeout(() => {\r\n                        this.undockFromStargate();\r\n                    }, 50);\r\n                } else {\r\n                    this.undockFromStargate();\r\n                }\r\n            };\r\n            \r\n            // Add both event listeners for better compatibility\r\n            undockBtn.addEventListener('click', handleUndock);\r\n            undockBtn.addEventListener('touchend', handleUndock);\r\n        }\r\n    }\r\n    \r\n    dockWithStargate() {\r\n        this.dockingLogic.dockWithStargate(this.spaceship, this.stargate, this.ui);\r\n        this.isDocked = true;\r\n        \r\n        // Update the stargate UI with current values\r\n        this.updateStargateUI();\r\n    }\r\n    \r\n    async undockFromStargate() {\r\n        await this.dockingLogic.undockFromStargate(\r\n            this.spaceship, \r\n            this.ui,\r\n            () => this.uiIntegration.closeAllModals(),\r\n            () => this.uiIntegration.hideStargateUI(this.ui),\r\n            () => this.uiIntegration.showGameUI(this.ui)\r\n        );\r\n        this.isDocked = false;\r\n    }\r\n    \r\n    updateStargateUI() {\r\n        this.uiIntegration.updateStargateUI(this.spaceship, this.ui);\r\n    }\r\n    \r\n    checkStargateProximity() {\r\n        this.proximityDetector.checkStargateProximity(this.spaceship, this.stargate, this.ui);\r\n        this.nearStargate = this.proximityDetector.isNearStargate();\r\n    }\r\n    \r\n    update() {\r\n        // Check if near stargate for docking\r\n        this.checkStargateProximity();\r\n    }\r\n    \r\n    // Setter for resources to allow dependency injection\r\n    setResources(resources) {\r\n        this.resources = resources;\r\n        this.uiIntegration.setResources(resources);\r\n    }\r\n}","// joystickZones.js - Joystick UI zone creation and management\r\n\r\nexport class JoystickZones {\r\n    constructor() {\r\n        this.leftJoystickZone = null;\r\n        this.rightJoystickZone = null;\r\n    }\r\n\r\n    createJoystickZones() {\r\n        this.createLeftJoystickZone();\r\n        this.createRightJoystickZone();\r\n        return {\r\n            leftZone: this.leftJoystickZone,\r\n            rightZone: this.rightJoystickZone\r\n        };\r\n    }\r\n\r\n    createLeftJoystickZone() {\r\n        // Create left joystick zone (thrust control)\r\n        const leftJoystickZone = document.createElement('div');\r\n        leftJoystickZone.id = 'leftJoystickZone';\r\n        leftJoystickZone.style.position = 'absolute';\r\n        leftJoystickZone.style.bottom = '50px';\r\n        leftJoystickZone.style.left = '50px';\r\n        leftJoystickZone.style.width = '100px';\r\n        leftJoystickZone.style.height = '100px';\r\n        leftJoystickZone.style.zIndex = '1000';\r\n        \r\n        // Prevent default browser behavior to avoid scrolling when using joysticks\r\n        leftJoystickZone.addEventListener('touchstart', (e) => e.preventDefault(), { passive: false });\r\n        leftJoystickZone.addEventListener('touchmove', (e) => e.preventDefault(), { passive: false });\r\n        leftJoystickZone.addEventListener('touchend', (e) => e.preventDefault(), { passive: false });\r\n        \r\n        document.body.appendChild(leftJoystickZone);\r\n        this.leftJoystickZone = leftJoystickZone;\r\n        \r\n        return leftJoystickZone;\r\n    }\r\n\r\n    createRightJoystickZone() {\r\n        // Create right joystick zone (rotation control)\r\n        const rightJoystickZone = document.createElement('div');\r\n        rightJoystickZone.id = 'rightJoystickZone';\r\n        rightJoystickZone.style.position = 'absolute';\r\n        rightJoystickZone.style.bottom = '50px';\r\n        rightJoystickZone.style.right = '50px';\r\n        rightJoystickZone.style.width = '100px';\r\n        rightJoystickZone.style.height = '100px';\r\n        rightJoystickZone.style.zIndex = '1000';\r\n        \r\n        // Prevent default browser behavior to avoid scrolling when using joysticks\r\n        rightJoystickZone.addEventListener('touchstart', (e) => e.preventDefault(), { passive: false });\r\n        rightJoystickZone.addEventListener('touchmove', (e) => e.preventDefault(), { passive: false });\r\n        rightJoystickZone.addEventListener('touchend', (e) => e.preventDefault(), { passive: false });\r\n        \r\n        document.body.appendChild(rightJoystickZone);\r\n        this.rightJoystickZone = rightJoystickZone;\r\n        \r\n        return rightJoystickZone;\r\n    }\r\n\r\n    hideZones() {\r\n        if (this.leftJoystickZone) this.leftJoystickZone.style.display = 'none';\r\n        if (this.rightJoystickZone) this.rightJoystickZone.style.display = 'none';\r\n    }\r\n\r\n    showZones() {\r\n        if (this.leftJoystickZone) this.leftJoystickZone.style.display = 'block';\r\n        if (this.rightJoystickZone) this.rightJoystickZone.style.display = 'block';\r\n    }\r\n\r\n    getLeftZone() {\r\n        return this.leftJoystickZone;\r\n    }\r\n\r\n    getRightZone() {\r\n        return this.rightJoystickZone;\r\n    }\r\n}","// actionButtons.js - Action button creation and styling\r\n\r\nexport class ActionButtons {\r\n    constructor() {\r\n        this.buttons = {\r\n            fire: null,\r\n            mine: null,\r\n            target: null,\r\n            dock: null,\r\n            deployLaser: null\r\n        };\r\n        this.containers = {\r\n            left: null,\r\n            right: null\r\n        };\r\n    }\r\n\r\n    createActionButtons() {\r\n        this.createButtonContainers();\r\n        this.createFireButton();\r\n        this.createMineButton();\r\n        this.createTargetButton();\r\n        this.createDockButton();\r\n        this.createDeployLaserButton();\r\n        \r\n        return this.buttons;\r\n    }\r\n\r\n    createButtonContainers() {\r\n        // Create a container for left side action buttons\r\n        const leftActionButtonsContainer = document.createElement('div');\r\n        leftActionButtonsContainer.id = 'mobile-action-buttons-left';\r\n        leftActionButtonsContainer.style.position = 'absolute';\r\n        leftActionButtonsContainer.style.bottom = '170px';\r\n        leftActionButtonsContainer.style.left = '20px';\r\n        leftActionButtonsContainer.style.display = 'flex';\r\n        leftActionButtonsContainer.style.flexDirection = 'column';\r\n        leftActionButtonsContainer.style.gap = '15px';\r\n        leftActionButtonsContainer.style.zIndex = '1000';\r\n        document.body.appendChild(leftActionButtonsContainer);\r\n        this.containers.left = leftActionButtonsContainer;\r\n        \r\n        // Create a container for right side action buttons\r\n        const rightActionButtonsContainer = document.createElement('div');\r\n        rightActionButtonsContainer.id = 'mobile-action-buttons-right';\r\n        rightActionButtonsContainer.style.position = 'absolute';\r\n        rightActionButtonsContainer.style.bottom = '170px';\r\n        rightActionButtonsContainer.style.right = '20px';\r\n        rightActionButtonsContainer.style.display = 'flex';\r\n        rightActionButtonsContainer.style.flexDirection = 'column';\r\n        rightActionButtonsContainer.style.gap = '15px';\r\n        rightActionButtonsContainer.style.zIndex = '1000';\r\n        document.body.appendChild(rightActionButtonsContainer);\r\n        this.containers.right = rightActionButtonsContainer;\r\n    }\r\n\r\n    createFireButton() {\r\n        this.buttons.fire = this.createActionButton(this.containers.left, 'FIRE', 'rgba(255, 80, 80, 0.8)');\r\n        return this.buttons.fire;\r\n    }\r\n\r\n    createMineButton() {\r\n        this.buttons.mine = this.createActionButton(this.containers.left, 'MINE', 'rgba(120, 220, 232, 0.8)');\r\n        return this.buttons.mine;\r\n    }\r\n\r\n    createTargetButton() {\r\n        this.buttons.target = this.createActionButton(this.containers.right, 'TARGET', 'rgba(255, 215, 0, 0.8)');\r\n        return this.buttons.target;\r\n    }\r\n\r\n    createDockButton() {\r\n        // Create dock button (only shown when near stargate)\r\n        this.buttons.dock = this.createActionButton(null, 'DOCK', 'rgba(51, 153, 255, 0.8)');\r\n        this.buttons.dock.style.position = 'absolute';\r\n        this.buttons.dock.style.top = '50%';\r\n        this.buttons.dock.style.left = '50%';\r\n        this.buttons.dock.style.transform = 'translate(-50%, -50%)';\r\n        this.buttons.dock.style.width = '100px';  // Make dock button larger\r\n        this.buttons.dock.style.height = '100px'; // Make dock button larger\r\n        this.buttons.dock.style.fontSize = '20px'; // Larger text\r\n        this.buttons.dock.style.boxShadow = '0 0 25px rgba(51, 153, 255, 0.8)'; // Stronger glow\r\n        this.buttons.dock.style.zIndex = '10000'; \r\n        this.buttons.dock.style.display = 'none';\r\n        document.body.appendChild(this.buttons.dock);\r\n        return this.buttons.dock;\r\n    }\r\n\r\n    createDeployLaserButton() {\r\n        this.buttons.deployLaser = this.createActionButton(this.containers.right, 'DEPLOY', 'rgba(255, 100, 100, 0.8)');\r\n        return this.buttons.deployLaser;\r\n    }\r\n\r\n    createActionButton(parent, text, color) {\r\n        const button = document.createElement('div');\r\n        button.className = 'mobile-action-button';\r\n        button.textContent = text;\r\n        button.style.width = '60px';\r\n        button.style.height = '60px'; \r\n        button.style.borderRadius = '50%';\r\n        button.style.backgroundColor = 'rgba(10, 20, 30, 0.7)';\r\n        button.style.border = `2px solid ${color}`;\r\n        button.style.color = color;\r\n        button.style.display = 'flex';\r\n        button.style.justifyContent = 'center';\r\n        button.style.alignItems = 'center';\r\n        button.style.fontFamily = '\"Rajdhani\", sans-serif';\r\n        button.style.fontSize = '16px';\r\n        button.style.fontWeight = 'bold';\r\n        button.style.boxShadow = `0 0 10px ${color}`;\r\n        button.style.userSelect = 'none';\r\n        button.style.touchAction = 'manipulation';\r\n        button.style.cursor = 'pointer';\r\n        \r\n        // Add hardware acceleration for better performance on mobile\r\n        button.style.transform = 'translateZ(0)';\r\n        button.style.webkitTapHighlightColor = 'transparent';\r\n        button.style.backfaceVisibility = 'hidden';\r\n        \r\n        if (parent) {\r\n            parent.appendChild(button);\r\n        }\r\n        \r\n        return button;\r\n    }\r\n\r\n    showDockButton() {\r\n        if (this.buttons.dock) {\r\n            // FIX: Make sure display is set before other properties\r\n            this.buttons.dock.style.display = 'flex';\r\n            \r\n            // FIX: Ensure critical styles are explicitly set\r\n            this.buttons.dock.style.zIndex = '10000'; // Very high z-index\r\n            this.buttons.dock.style.position = 'absolute';\r\n            this.buttons.dock.style.top = '50%';\r\n            this.buttons.dock.style.left = '50%';\r\n            \r\n            console.log(\"Showing dock button - near stargate\");\r\n            \r\n            // Add pulsing animation to make it more noticeable\r\n            if (!this.buttons.dock.style.animation) {\r\n                this.buttons.dock.style.animation = 'pulse 1.5s infinite';\r\n                \r\n                // Add the pulse keyframes if they don't exist\r\n                if (!document.getElementById('mobile-pulse-animation')) {\r\n                    const style = document.createElement('style');\r\n                    style.id = 'mobile-pulse-animation';\r\n                    style.textContent = `\r\n                        @keyframes pulse {\r\n                            0% { transform: translate(-50%, -50%) scale(1); }\r\n                            50% { transform: translate(-50%, -50%) scale(1.1); }\r\n                            100% { transform: translate(-50%, -50%) scale(1); }\r\n                        }\r\n                    `;\r\n                    document.head.appendChild(style);\r\n                }\r\n            }\r\n            \r\n            // FIX: Log dock button visibility for debugging\r\n            console.log(\"Dock button shown with styles:\", {\r\n                display: this.buttons.dock.style.display,\r\n                zIndex: this.buttons.dock.style.zIndex,\r\n                position: this.buttons.dock.style.position,\r\n                width: this.buttons.dock.style.width,\r\n                height: this.buttons.dock.style.height\r\n            });\r\n        }\r\n    }\r\n\r\n    hideDockButton() {\r\n        if (this.buttons.dock) {\r\n            this.buttons.dock.style.display = 'none';\r\n        }\r\n    }\r\n\r\n    hideButtons() {\r\n        if (this.containers.left) this.containers.left.style.display = 'none';\r\n        if (this.containers.right) this.containers.right.style.display = 'none';\r\n        this.hideDockButton();\r\n    }\r\n\r\n    showButtons() {\r\n        if (this.containers.left) this.containers.left.style.display = 'flex';\r\n        if (this.containers.right) this.containers.right.style.display = 'flex';\r\n    }\r\n\r\n    // Helper method to add events to buttons\r\n    addButtonEvents(button, startHandler, endHandler = null) {\r\n        if (!button) {\r\n            console.error(\"ActionButtons: Cannot add events to null button\");\r\n            return;\r\n        }\r\n        \r\n        // For continuous actions (like firing and mining)\r\n        if (endHandler) {\r\n            // Touch events with passive: false to allow preventDefault\r\n            button.addEventListener('touchstart', (e) => {\r\n                e.preventDefault();\r\n                button.style.transform = 'scale(0.95) translateZ(0)';\r\n                startHandler();\r\n            }, { passive: false });\r\n            \r\n            button.addEventListener('touchend', (e) => {\r\n                e.preventDefault();\r\n                button.style.transform = 'scale(1) translateZ(0)';\r\n                endHandler();\r\n            }, { passive: false });\r\n            \r\n            // Add pointer events\r\n            button.addEventListener('pointerdown', (e) => {\r\n                e.preventDefault();\r\n                if (e.pointerType === 'touch') return; // Skip if touch (handled by touch events)\r\n                button.style.transform = 'scale(0.95) translateZ(0)';\r\n                startHandler();\r\n            });\r\n            \r\n            button.addEventListener('pointerup', (e) => {\r\n                e.preventDefault();\r\n                if (e.pointerType === 'touch') return; // Skip if touch (handled by touch events)\r\n                button.style.transform = 'scale(1) translateZ(0)';\r\n                endHandler();\r\n            });\r\n            \r\n            // Keep mouse events for backward compatibility\r\n            button.addEventListener('mousedown', (e) => {\r\n                button.style.transform = 'scale(0.95) translateZ(0)';\r\n                startHandler();\r\n            });\r\n            \r\n            button.addEventListener('mouseup', (e) => {\r\n                button.style.transform = 'scale(1) translateZ(0)';\r\n                endHandler();\r\n            });\r\n        }\r\n        // For single actions (like targeting and docking)\r\n        else {\r\n            // Touch events\r\n            button.addEventListener('touchstart', (e) => {\r\n                e.preventDefault();\r\n                button.style.transform = 'scale(0.95) translateZ(0)';\r\n                \r\n                // For dock button specifically, add debug logging\r\n                if (button === this.buttons.dock) {\r\n                    console.log(\"Dock button touchstart event fired\");\r\n                }\r\n            }, { passive: false });\r\n            \r\n            button.addEventListener('touchend', (e) => {\r\n                e.preventDefault();\r\n                button.style.transform = 'scale(1) translateZ(0)';\r\n                \r\n                // For dock button specifically, add debug logging\r\n                if (button === this.buttons.dock) {\r\n                    console.log(\"Dock button touchend event fired, calling handler\");\r\n                }\r\n                \r\n                startHandler();\r\n            }, { passive: false });\r\n            \r\n            // Add pointer events\r\n            button.addEventListener('pointerdown', (e) => {\r\n                e.preventDefault();\r\n                if (e.pointerType === 'touch') return; // Skip if touch (handled by touch events)\r\n                button.style.transform = 'scale(0.95) translateZ(0)';\r\n                \r\n                // For dock button specifically, add debug logging\r\n                if (button === this.buttons.dock) {\r\n                    console.log(\"Dock button pointerdown event fired\");\r\n                }\r\n            });\r\n            \r\n            button.addEventListener('pointerup', (e) => {\r\n                e.preventDefault();\r\n                if (e.pointerType === 'touch') return; // Skip if touch (handled by touch events)\r\n                button.style.transform = 'scale(1) translateZ(0)';\r\n                \r\n                // For dock button specifically, add debug logging\r\n                if (button === this.buttons.dock) {\r\n                    console.log(\"Dock button pointerup event fired, calling handler\");\r\n                }\r\n                \r\n                startHandler();\r\n            });\r\n            \r\n            // Keep mouse events for backward compatibility\r\n            button.addEventListener('mousedown', (e) => {\r\n                button.style.transform = 'scale(0.95) translateZ(0)';\r\n            });\r\n            \r\n            button.addEventListener('mouseup', (e) => {\r\n                button.style.transform = 'scale(1) translateZ(0)';\r\n                startHandler();\r\n            });\r\n        }\r\n    }\r\n}","// joystickHandler.js - Nipple.js integration and joystick input handling\r\n\r\nexport class JoystickHandler {\r\n    constructor(spaceship, physics) {\r\n        this.spaceship = spaceship;\r\n        this.physics = physics;\r\n        this.leftJoystick = null;\r\n        this.rightJoystick = null;\r\n        this.threshold = 0.1;\r\n        this.isNippleLoaded = false;\r\n    }\r\n\r\n    async loadNippleJS() {\r\n        return new Promise((resolve, reject) => {\r\n            // Check if nipple.js is already loaded\r\n            if (window.nipplejs) {\r\n                this.isNippleLoaded = true;\r\n                resolve();\r\n                return;\r\n            }\r\n            \r\n            // Create script element\r\n            const script = document.createElement('script');\r\n            script.src = 'https://cdnjs.cloudflare.com/ajax/libs/nipplejs/0.10.1/nipplejs.min.js';\r\n            script.async = true;\r\n            \r\n            // Set up event handlers\r\n            script.onload = () => {\r\n                this.isNippleLoaded = true;\r\n                resolve();\r\n            };\r\n            script.onerror = () => reject(new Error('Failed to load nipple.js'));\r\n            \r\n            // Add script to document\r\n            document.head.appendChild(script);\r\n        });\r\n    }\r\n\r\n    initializeJoysticks(leftZone, rightZone) {\r\n        if (!window.nipplejs || !this.isNippleLoaded) {\r\n            console.error('nipplejs is not loaded');\r\n            return false;\r\n        }\r\n        \r\n        // Initialize left joystick (thrust control)\r\n        this.leftJoystick = window.nipplejs.create({\r\n            zone: leftZone,\r\n            mode: 'static',\r\n            position: { left: '50%', top: '50%' },\r\n            color: 'rgba(120, 220, 232, 0.8)',\r\n            size: 100,\r\n            threshold: this.threshold,\r\n            dynamicPage: true, // Better performance for scrolling\r\n            fadeTime: 100, // Faster fade for better performance\r\n            lockX: false, // Allow X-axis movement\r\n            lockY: false  // Allow Y-axis movement\r\n        });\r\n        \r\n        // Initialize right joystick (rotation control)\r\n        this.rightJoystick = window.nipplejs.create({\r\n            zone: rightZone,\r\n            mode: 'static',\r\n            position: { left: '50%', top: '50%' },\r\n            color: 'rgba(120, 220, 232, 0.8)',\r\n            size: 100,\r\n            threshold: this.threshold,\r\n            dynamicPage: true, // Better performance for scrolling\r\n            fadeTime: 100, // Faster fade for better performance\r\n            lockX: false, // Allow X-axis movement\r\n            lockY: false  // Allow Y-axis movement\r\n        });\r\n        \r\n        // Set up event handlers for joysticks\r\n        this.setupJoystickEvents();\r\n        return true;\r\n    }\r\n\r\n    setupJoystickEvents() {\r\n        if (!this.leftJoystick || !this.rightJoystick) {\r\n            console.error('Joysticks not initialized');\r\n            return;\r\n        }\r\n\r\n        // Left joystick events (thrust)\r\n        this.leftJoystick.on('move', (evt, data) => {\r\n            this.handleThrustJoystick(data);\r\n        }).on('end', () => {\r\n            this.resetThrust();\r\n        });\r\n        \r\n        // Right joystick events (rotation)\r\n        this.rightJoystick.on('move', (evt, data) => {\r\n            this.handleRotationJoystick(data);\r\n        }).on('end', () => {\r\n            // Do nothing on end - rotation is not continuous\r\n        });\r\n    }\r\n\r\n    handleThrustJoystick(data) {\r\n        if (this.spaceship.isDocked) return;\r\n        \r\n        // Reset thrust directions\r\n        this.resetThrust();\r\n        \r\n        const force = data.force > 2 ? 2 : data.force; // Normalize force between 0-2\r\n        const angle = data.angle.radian;\r\n        \r\n        // Correct direction mapping based on standard joystick angles:\r\n        // In nipple.js, 0 radians = right, /2 = up,  = left, 3/2 = down\r\n        \r\n        // Up/North - Forward (around /2 or 1.57 radians)\r\n        if (angle > 1.0 && angle < 2.0) {\r\n            this.spaceship.thrust.forward = true;\r\n        }\r\n        // Down/South - Backward (around 3/2 or 4.71 radians)\r\n        else if (angle > 4.0 && angle < 5.5) {\r\n            this.spaceship.thrust.backward = true;\r\n        }\r\n        \r\n        // Left/West - Left (around  or 3.14 radians)\r\n        if (angle > 2.5 && angle < 4.0) {\r\n            this.spaceship.thrust.left = true;  // Fixed: left joystick should trigger left thrust\r\n        }\r\n        // Right/East - Right (around 0 or 2 radians)\r\n        else if ((angle >= 0 && angle < 1.0) || angle > 5.5) {\r\n            this.spaceship.thrust.right = true;  // Fixed: right joystick should trigger right thrust\r\n        }\r\n        \r\n        // Enable boost if force is high\r\n        this.spaceship.thrust.boost = force > 1.5;\r\n    }\r\n\r\n    handleRotationJoystick(data) {\r\n        if (this.spaceship.isDocked) return;\r\n        \r\n        // Extract the X and Y components of the joystick vector\r\n        // Reduce sensitivity by lowering the multiplier from 0.05 to 0.015\r\n        const xMove = data.vector.x * data.force * 0.015;\r\n        // Invert the Y value to fix up/down control direction\r\n        const yMove = -data.vector.y * data.force * 0.015;\r\n        \r\n        // Update rotation via physics\r\n        this.physics.updateRotation(xMove, yMove);\r\n    }\r\n\r\n    resetThrust() {\r\n        if (!this.spaceship) return;\r\n        \r\n        this.spaceship.thrust.forward = false;\r\n        this.spaceship.thrust.backward = false;\r\n        this.spaceship.thrust.left = false;\r\n        this.spaceship.thrust.right = false;\r\n        this.spaceship.thrust.boost = false;\r\n    }\r\n\r\n    destroy() {\r\n        if (this.leftJoystick) {\r\n            this.leftJoystick.destroy();\r\n            this.leftJoystick = null;\r\n        }\r\n        if (this.rightJoystick) {\r\n            this.rightJoystick.destroy();\r\n            this.rightJoystick = null;\r\n        }\r\n    }\r\n}","// gestureDetector.js - Touch gesture recognition for mobile controls\r\n\r\nexport class GestureDetector {\r\n    constructor() {\r\n        this.isEnabled = false;\r\n        this.gestureCallbacks = new Map();\r\n        this.touchStartTime = 0;\r\n        this.touchStartPos = { x: 0, y: 0 };\r\n        this.touchEndPos = { x: 0, y: 0 };\r\n        this.swipeThreshold = 50; // minimum distance for swipe\r\n        this.tapTimeout = 300; // maximum time for tap\r\n    }\r\n\r\n    enable() {\r\n        if (this.isEnabled) return;\r\n        \r\n        this.isEnabled = true;\r\n        \r\n        // Add global touch event listeners for gesture detection\r\n        document.addEventListener('touchstart', this.handleTouchStart.bind(this), { passive: false });\r\n        document.addEventListener('touchmove', this.handleTouchMove.bind(this), { passive: false });\r\n        document.addEventListener('touchend', this.handleTouchEnd.bind(this), { passive: false });\r\n    }\r\n\r\n    disable() {\r\n        if (!this.isEnabled) return;\r\n        \r\n        this.isEnabled = false;\r\n        \r\n        // Remove global touch event listeners\r\n        document.removeEventListener('touchstart', this.handleTouchStart.bind(this));\r\n        document.removeEventListener('touchmove', this.handleTouchMove.bind(this));\r\n        document.removeEventListener('touchend', this.handleTouchEnd.bind(this));\r\n    }\r\n\r\n    handleTouchStart(event) {\r\n        if (!this.isEnabled) return;\r\n        \r\n        // Ignore if touch is on a UI element (joystick or button)\r\n        if (this.isTouchOnUIElement(event.target)) return;\r\n        \r\n        const touch = event.touches[0];\r\n        this.touchStartTime = Date.now();\r\n        this.touchStartPos = {\r\n            x: touch.clientX,\r\n            y: touch.clientY\r\n        };\r\n    }\r\n\r\n    handleTouchMove(event) {\r\n        if (!this.isEnabled) return;\r\n        \r\n        // Ignore if touch is on a UI element\r\n        if (this.isTouchOnUIElement(event.target)) return;\r\n        \r\n        // Prevent default to avoid scrolling during gesture detection\r\n        event.preventDefault();\r\n    }\r\n\r\n    handleTouchEnd(event) {\r\n        if (!this.isEnabled) return;\r\n        \r\n        // Ignore if touch is on a UI element\r\n        if (this.isTouchOnUIElement(event.target)) return;\r\n        \r\n        const touch = event.changedTouches[0];\r\n        this.touchEndPos = {\r\n            x: touch.clientX,\r\n            y: touch.clientY\r\n        };\r\n        \r\n        const touchDuration = Date.now() - this.touchStartTime;\r\n        const distance = this.calculateDistance(this.touchStartPos, this.touchEndPos);\r\n        \r\n        // Detect gesture type\r\n        if (touchDuration <= this.tapTimeout && distance < this.swipeThreshold) {\r\n            this.triggerGesture('tap', {\r\n                position: this.touchEndPos,\r\n                duration: touchDuration\r\n            });\r\n        } else if (distance >= this.swipeThreshold) {\r\n            const direction = this.getSwipeDirection(this.touchStartPos, this.touchEndPos);\r\n            this.triggerGesture('swipe', {\r\n                direction: direction,\r\n                distance: distance,\r\n                duration: touchDuration,\r\n                startPos: this.touchStartPos,\r\n                endPos: this.touchEndPos\r\n            });\r\n        }\r\n    }\r\n\r\n    isTouchOnUIElement(target) {\r\n        // Check if touch is on joystick zones or action buttons\r\n        const uiSelectors = [\r\n            '#leftJoystickZone',\r\n            '#rightJoystickZone',\r\n            '#mobile-action-buttons-left',\r\n            '#mobile-action-buttons-right',\r\n            '.mobile-action-button'\r\n        ];\r\n        \r\n        for (const selector of uiSelectors) {\r\n            if (target.closest && target.closest(selector)) {\r\n                return true;\r\n            }\r\n        }\r\n        \r\n        return false;\r\n    }\r\n\r\n    calculateDistance(pos1, pos2) {\r\n        const dx = pos2.x - pos1.x;\r\n        const dy = pos2.y - pos1.y;\r\n        return Math.sqrt(dx * dx + dy * dy);\r\n    }\r\n\r\n    getSwipeDirection(startPos, endPos) {\r\n        const dx = endPos.x - startPos.x;\r\n        const dy = endPos.y - startPos.y;\r\n        \r\n        if (Math.abs(dx) > Math.abs(dy)) {\r\n            return dx > 0 ? 'right' : 'left';\r\n        } else {\r\n            return dy > 0 ? 'down' : 'up';\r\n        }\r\n    }\r\n\r\n    triggerGesture(gestureType, data) {\r\n        const callback = this.gestureCallbacks.get(gestureType);\r\n        if (callback && typeof callback === 'function') {\r\n            callback(data);\r\n        }\r\n    }\r\n\r\n    // Register callbacks for specific gestures\r\n    onGesture(gestureType, callback) {\r\n        this.gestureCallbacks.set(gestureType, callback);\r\n    }\r\n\r\n    // Remove gesture callback\r\n    offGesture(gestureType) {\r\n        this.gestureCallbacks.delete(gestureType);\r\n    }\r\n\r\n    // Clear all gesture callbacks\r\n    clearGestures() {\r\n        this.gestureCallbacks.clear();\r\n    }\r\n}","// miningHandler.js - Mining action handlers for touch controls\r\n\r\nexport class MiningHandler {\r\n    constructor(spaceship) {\r\n        this.spaceship = spaceship;\r\n        this.miningSystem = null;\r\n        this.targetingSystem = null;\r\n    }\r\n\r\n    setMiningSystem(miningSystem) {\r\n        this.miningSystem = miningSystem;\r\n    }\r\n\r\n    setTargetingSystem(targetingSystem) {\r\n        this.targetingSystem = targetingSystem;\r\n    }\r\n\r\n    handleMiningStart() {\r\n        try {\r\n            console.log(\"MiningHandler: handleMiningStart called\");\r\n            \r\n            // First ensure we have targeting and mining systems\r\n            if (!this.targetingSystem) {\r\n                console.error(\"MiningHandler: Targeting system not available\");\r\n                return;\r\n            }\r\n            \r\n            if (!this.miningSystem) {\r\n                console.error(\"MiningHandler: Mining system not available\");\r\n                return;\r\n            }\r\n            \r\n            // First, get the current target\r\n            let targetAsteroid = this.targetingSystem.getCurrentTarget();\r\n            console.log(\"MiningHandler: Initial target:\", targetAsteroid);\r\n            \r\n            // If no target is selected, enable targeting and find nearest\r\n            if (!targetAsteroid) {\r\n                console.log(\"MiningHandler: No target selected, enabling targeting and finding nearest target\");\r\n                \r\n                // Enable targeting if not already enabled\r\n                if (!this.targetingSystem.isLockOnEnabled()) {\r\n                    this.targetingSystem.toggleLockOn();\r\n                }\r\n                \r\n                // Find nearest target\r\n                targetAsteroid = this.targetingSystem.findNearestTarget();\r\n                console.log(\"MiningHandler: Found nearest target:\", targetAsteroid);\r\n                \r\n                if (!targetAsteroid) {\r\n                    console.log(\"MiningHandler: No targets in range after scan\");\r\n                    return;\r\n                }\r\n            }\r\n            \r\n            // Essential validation: make sure we have a valid target asteroid with required properties\r\n            if (!targetAsteroid || !targetAsteroid.mesh || !targetAsteroid.mesh.position) {\r\n                console.error(\"MiningHandler: Target asteroid is missing required properties\", targetAsteroid);\r\n                \r\n                // Try a different approach - get all asteroids from environment\r\n                const game = window.gameInstance || window.game;\r\n                if (game && game.environment && game.environment.asteroids && game.environment.asteroids.length > 0) {\r\n                    console.log(\"MiningHandler: Attempting to get asteroid directly from environment\");\r\n                    // Find closest asteroid\r\n                    let closestDist = Infinity;\r\n                    let closestAsteroid = null;\r\n                    \r\n                    for (const asteroid of game.environment.asteroids) {\r\n                        if (asteroid && asteroid.mesh && asteroid.mesh.position && this.spaceship && this.spaceship.mesh) {\r\n                            const dist = asteroid.mesh.position.distanceTo(this.spaceship.mesh.position);\r\n                            if (dist < closestDist) {\r\n                                closestDist = dist;\r\n                                closestAsteroid = asteroid;\r\n                            }\r\n                        }\r\n                    }\r\n                    \r\n                    if (closestAsteroid) {\r\n                        console.log(\"MiningHandler: Found closest asteroid from environment:\", closestAsteroid);\r\n                        targetAsteroid = closestAsteroid;\r\n                    } else {\r\n                        console.error(\"MiningHandler: Could not find any valid asteroids in environment\");\r\n                        return;\r\n                    }\r\n                } else {\r\n                    console.error(\"MiningHandler: Could not access environment to find asteroids\");\r\n                    return;\r\n                }\r\n            }\r\n            \r\n            console.log(\"MiningHandler: Target asteroid found:\", targetAsteroid);\r\n            \r\n            // Extra validation to make absolutely sure we have a valid targetAsteroid\r\n            if (!targetAsteroid || !targetAsteroid.mesh || !targetAsteroid.mesh.position) {\r\n                console.error(\"MiningHandler: Target asteroid is still invalid after fallback attempts\");\r\n                return;\r\n            }\r\n            \r\n            // Explicitly set the target asteroid for mining\r\n            this.miningSystem.setTargetAsteroid(targetAsteroid);\r\n            \r\n            // Log asteroid details\r\n            console.log(\"MiningHandler: Target set for mining:\", {\r\n                resourceType: targetAsteroid.resourceType || \"unknown\",\r\n                position: targetAsteroid.mesh ? targetAsteroid.mesh.position.toArray() : \"no mesh\",\r\n                distance: targetAsteroid.mesh && this.spaceship && this.spaceship.mesh ? \r\n                    targetAsteroid.mesh.position.distanceTo(this.spaceship.mesh.position) : \"unknown\"\r\n            });\r\n            \r\n            // Start mining\r\n            console.log(\"MiningHandler: Starting mining operation\");\r\n            this.miningSystem.startMining();\r\n            \r\n            // Check if mining actually started\r\n            console.log(\"MiningHandler: Mining started:\", this.miningSystem.isMining);\r\n            \r\n        } catch (error) {\r\n            console.error(\"MiningHandler: Error in handleMiningStart:\", error);\r\n        }\r\n    }\r\n\r\n    handleMiningEnd() {\r\n        try {\r\n            console.log(\"MiningHandler: handleMiningEnd called\");\r\n            \r\n            // Make sure we have the mining system\r\n            if (!this.miningSystem) {\r\n                console.error(\"MiningHandler: Mining system not available for stopping\");\r\n                return;\r\n            }\r\n            \r\n            // Stop mining\r\n            this.miningSystem.stopMining();\r\n            console.log(\"MiningHandler: Mining stopped\");\r\n            \r\n        } catch (e) {\r\n            console.error(\"MiningHandler: Error stopping mining:\", e);\r\n        }\r\n    }\r\n}","// weaponHandler.js - Weapon firing handlers for touch controls\r\n\r\nexport class WeaponHandler {\r\n    constructor() {\r\n        this.weaponSystem = null;\r\n    }\r\n\r\n    setWeaponSystem(weaponSystem) {\r\n        this.weaponSystem = weaponSystem;\r\n    }\r\n\r\n    handleFiringStart() {\r\n        try {\r\n            // First try local reference to weapon system (which is actually the Combat class)\r\n            if (this.weaponSystem) {\r\n                // Attempt to use the setFiring method from the Combat class\r\n                if (typeof this.weaponSystem.setFiring === 'function') {\r\n                    this.weaponSystem.setFiring(true);\r\n                } else {\r\n                    // Fallback to the older isWeaponActive property\r\n                    this.weaponSystem.isWeaponActive = true;\r\n                }\r\n                \r\n                // Try to play sound if available\r\n                const game = window.gameInstance || window.game;\r\n                if (game && game.audio) {\r\n                    game.audio.playSound('laser');\r\n                }\r\n                return;\r\n            }\r\n            \r\n            // Fallback to global game reference\r\n            const game = window.gameInstance || window.game;\r\n            if (!game) {\r\n                console.error(\"WeaponHandler: No game reference found\");\r\n                return;\r\n            }\r\n            \r\n            // Try direct combat object on game first (preferred)\r\n            if (game.combat) {\r\n                game.combat.setFiring(true);\r\n                \r\n                // Play laser sound if available\r\n                if (game.audio) {\r\n                    game.audio.playSound('laser');\r\n                }\r\n                return;\r\n            }\r\n            \r\n            // Legacy fallbacks\r\n            if (game.weaponSystem) {\r\n                if (typeof game.weaponSystem.setFiring === 'function') {\r\n                    game.weaponSystem.setFiring(true);\r\n                } else {\r\n                    game.weaponSystem.isWeaponActive = true;\r\n                }\r\n                \r\n                // Play laser sound if available\r\n                if (game.audio) {\r\n                    game.audio.playSound('laser');\r\n                }\r\n                return;\r\n            }\r\n            \r\n            // Try through controls\r\n            if (game.controls && game.controls.weaponSystem) {\r\n                if (typeof game.controls.weaponSystem.setFiring === 'function') {\r\n                    game.controls.weaponSystem.setFiring(true);\r\n                } else {\r\n                    game.controls.weaponSystem.isWeaponActive = true;\r\n                }\r\n                \r\n                // Play laser sound if available\r\n                if (game.audio) {\r\n                    game.audio.playSound('laser');\r\n                }\r\n                return;\r\n            }\r\n            \r\n            console.error(\"WeaponHandler: No weapon system or combat system found\");\r\n        } catch (e) {\r\n            console.error(\"WeaponHandler: Error in handleFiringStart:\", e);\r\n        }\r\n    }\r\n\r\n    handleFiringEnd() {\r\n        try {\r\n            // First try local reference to weapon system (which is actually the Combat class)\r\n            if (this.weaponSystem) {\r\n                // Attempt to use the setFiring method from the Combat class\r\n                if (typeof this.weaponSystem.setFiring === 'function') {\r\n                    this.weaponSystem.setFiring(false);\r\n                } else {\r\n                    // Fallback to the older isWeaponActive property\r\n                    this.weaponSystem.isWeaponActive = false;\r\n                }\r\n                \r\n                // Try to stop sound if available\r\n                const game = window.gameInstance || window.game;\r\n                if (game && game.audio) {\r\n                    game.audio.stopSound('laser');\r\n                }\r\n                return;\r\n            }\r\n            \r\n            // Fallback to global game reference\r\n            const game = window.gameInstance || window.game;\r\n            if (!game) {\r\n                console.error(\"WeaponHandler: No game reference found\");\r\n                return;\r\n            }\r\n            \r\n            // Try direct combat object on game first (preferred)\r\n            if (game.combat) {\r\n                game.combat.setFiring(false);\r\n                \r\n                // Stop laser sound if available\r\n                if (game.audio) {\r\n                    game.audio.stopSound('laser');\r\n                }\r\n                return;\r\n            }\r\n            \r\n            // Legacy fallbacks\r\n            if (game.weaponSystem) {\r\n                if (typeof game.weaponSystem.setFiring === 'function') {\r\n                    game.weaponSystem.setFiring(false);\r\n                } else {\r\n                    game.weaponSystem.isWeaponActive = false;\r\n                }\r\n                \r\n                // Stop laser sound if available\r\n                if (game.audio) {\r\n                    game.audio.stopSound('laser');\r\n                }\r\n                return;\r\n            }\r\n            \r\n            // Try through controls\r\n            if (game.controls && game.controls.weaponSystem) {\r\n                if (typeof game.controls.weaponSystem.setFiring === 'function') {\r\n                    game.controls.weaponSystem.setFiring(false);\r\n                } else {\r\n                    game.controls.weaponSystem.isWeaponActive = false;\r\n                }\r\n                \r\n                // Stop laser sound if available\r\n                if (game.audio) {\r\n                    game.audio.stopSound('laser');\r\n                }\r\n                return;\r\n            }\r\n            \r\n            console.error(\"WeaponHandler: No weapon system or combat system found\");\r\n        } catch (e) {\r\n            console.error(\"WeaponHandler: Error in handleFiringEnd:\", e);\r\n        }\r\n    }\r\n}","// systemActions.js - System action handlers (docking, targeting, deployment) for touch controls\r\n\r\nexport class SystemActions {\r\n    constructor() {\r\n        this.dockingSystem = null;\r\n        this.targetingSystem = null;\r\n    }\r\n\r\n    setDockingSystem(dockingSystem) {\r\n        this.dockingSystem = dockingSystem;\r\n    }\r\n\r\n    setTargetingSystem(targetingSystem) {\r\n        this.targetingSystem = targetingSystem;\r\n    }\r\n\r\n    handleDocking() {\r\n        if (!this.dockingSystem) {\r\n            console.error(\"SystemActions: Docking system not available\");\r\n            return;\r\n        }\r\n        \r\n        console.log(\"SystemActions: Dock button pressed, attempting to dock with stargate\");\r\n        \r\n        // Call docking method\r\n        this.dockingSystem.dockWithStargate();\r\n    }\r\n\r\n    handleTargeting() {\r\n        if (!this.targetingSystem) {\r\n            console.error(\"SystemActions: Targeting system not available\");\r\n            return;\r\n        }\r\n        \r\n        // Toggle targeting system\r\n        this.targetingSystem.toggleLockOn();\r\n    }\r\n\r\n    /**\r\n     * Handle deploying a laser turret\r\n     */\r\n    handleDeployLaser() {\r\n        console.log(\"SystemActions: Deploying laser turret\");\r\n        \r\n        // Publish deploy laser event\r\n        if (window.mainMessageBus) {\r\n            window.mainMessageBus.publish('input.deployLaser', {});\r\n        }\r\n    }\r\n\r\n    // Helper method to check if dock should be visible\r\n    shouldShowDock(spaceship) {\r\n        if (!this.dockingSystem || !spaceship) {\r\n            // Fallback to window.game if the direct reference isn't set yet\r\n            const game = window.gameInstance || window.game;\r\n            if (game && game.controls && game.controls.dockingSystem && spaceship) {\r\n                const dockingSystem = game.controls.dockingSystem;\r\n                return dockingSystem.nearStargate && !spaceship.isDocked;\r\n            }\r\n            return false;\r\n        }\r\n        \r\n        return this.dockingSystem.nearStargate && !spaceship.isDocked;\r\n    }\r\n}","// touchControls.js - Main coordinator for touch controls on mobile devices\r\n\r\nimport { JoystickZones } from './ui/joystickZones.js';\r\nimport { ActionButtons } from './ui/actionButtons.js';\r\nimport { JoystickHandler } from './input/joystickHandler.js';\r\nimport { GestureDetector } from './input/gestureDetector.js';\r\nimport { MiningHandler } from './actions/miningHandler.js';\r\nimport { WeaponHandler } from './actions/weaponHandler.js';\r\nimport { SystemActions } from './actions/systemActions.js';\r\n\r\nexport class TouchControls {\r\n    constructor(spaceship, physics) {\r\n        this.spaceship = spaceship;\r\n        this.physics = physics;\r\n        this.isInitialized = false;\r\n        \r\n        // Initialize UI modules\r\n        this.joystickZones = new JoystickZones();\r\n        this.actionButtons = new ActionButtons();\r\n        \r\n        // Initialize input modules\r\n        this.joystickHandler = new JoystickHandler(spaceship, physics);\r\n        this.gestureDetector = new GestureDetector();\r\n        \r\n        // Initialize action modules\r\n        this.miningHandler = new MiningHandler(spaceship);\r\n        this.weaponHandler = new WeaponHandler();\r\n        this.systemActions = new SystemActions();\r\n        \r\n        // Create crosshair and setup controls\r\n        this.createCrosshair();\r\n        this.initializeAsync();\r\n    }\r\n    \r\n    async initializeAsync() {\r\n        try {\r\n            await this.joystickHandler.loadNippleJS();\r\n            this.setupTouchControls();\r\n        } catch (err) {\r\n            console.error('Failed to load nipple.js:', err);\r\n        }\r\n    }\r\n    \r\n    // Method to set the systems we need to interact with\r\n    setControlSystems(controls) {\r\n        console.log(\"TouchControls: Setting control systems\");\r\n        \r\n        if (!controls) {\r\n            console.error(\"TouchControls: Controls object is null or undefined\");\r\n            return;\r\n        }\r\n        \r\n        // Set systems for action handlers\r\n        this.miningHandler.setMiningSystem(controls.miningSystem);\r\n        this.miningHandler.setTargetingSystem(controls.targetingSystem);\r\n        this.weaponHandler.setWeaponSystem(controls.weaponSystem);\r\n        this.systemActions.setDockingSystem(controls.dockingSystem);\r\n        this.systemActions.setTargetingSystem(controls.targetingSystem);\r\n        \r\n        // Log system connections\r\n        const systemStatus = {\r\n            hasMiningSystem: !!controls.miningSystem,\r\n            hasTargetingSystem: !!controls.targetingSystem,\r\n            hasDockingSystem: !!controls.dockingSystem,\r\n            hasWeaponSystem: !!controls.weaponSystem\r\n        };\r\n        \r\n        console.log(\"TouchControls: Systems connected\", systemStatus);\r\n        \r\n        // Store reference to spaceship from controls if not already set\r\n        if (!this.spaceship && controls.spaceship) {\r\n            this.spaceship = controls.spaceship;\r\n            console.log(\"TouchControls: Spaceship reference set from controls\");\r\n        }\r\n        \r\n        return this; // For method chaining\r\n    }\r\n    \r\n    createCrosshair() {\r\n        // Create a small crosshair in the center of the screen\r\n        const crosshair = document.createElement('div');\r\n        crosshair.id = 'mobile-crosshair';\r\n        crosshair.style.position = 'absolute';\r\n        crosshair.style.top = '50%';\r\n        crosshair.style.left = '50%';\r\n        crosshair.style.transform = 'translate(-50%, -50%)';\r\n        crosshair.style.width = '10px';\r\n        crosshair.style.height = '10px';\r\n        crosshair.style.pointerEvents = 'none';\r\n        crosshair.style.zIndex = '999';\r\n        \r\n        // Create crosshair shape with a plus sign\r\n        crosshair.innerHTML = `\r\n            <div style=\"position: absolute; top: 50%; left: 0; width: 100%; height: 1px; background-color: rgba(120, 220, 232, 0.8);\"></div>\r\n            <div style=\"position: absolute; top: 0; left: 50%; width: 1px; height: 100%; background-color: rgba(120, 220, 232, 0.8);\"></div>\r\n            <div style=\"position: absolute; top: 50%; left: 50%; width: 3px; height: 3px; background-color: rgba(120, 220, 232, 0.8); border-radius: 50%; transform: translate(-50%, -50%);\"></div>\r\n        `;\r\n        \r\n        document.body.appendChild(crosshair);\r\n    }\r\n    \r\n    setupTouchControls() {\r\n        // Create UI zones and buttons\r\n        const zones = this.joystickZones.createJoystickZones();\r\n        const buttons = this.actionButtons.createActionButtons();\r\n        \r\n        // Initialize joysticks after a short delay to ensure DOM is ready\r\n        setTimeout(() => {\r\n            const success = this.joystickHandler.initializeJoysticks(zones.leftZone, zones.rightZone);\r\n            if (success) {\r\n                this.setupButtonEvents(buttons);\r\n                this.isInitialized = true;\r\n            }\r\n        }, 100);\r\n    }\r\n    \r\n    setupButtonEvents(buttons) {\r\n        // Setup fire button events\r\n        this.actionButtons.addButtonEvents(\r\n            buttons.fire,\r\n            () => this.weaponHandler.handleFiringStart(),\r\n            () => this.weaponHandler.handleFiringEnd()\r\n        );\r\n        \r\n        // Setup mine button events\r\n        this.actionButtons.addButtonEvents(\r\n            buttons.mine,\r\n            () => this.miningHandler.handleMiningStart(),\r\n            () => this.miningHandler.handleMiningEnd()\r\n        );\r\n        \r\n        // Setup target button events\r\n        this.actionButtons.addButtonEvents(\r\n            buttons.target,\r\n            () => this.systemActions.handleTargeting()\r\n        );\r\n        \r\n        // Setup dock button events\r\n        this.actionButtons.addButtonEvents(\r\n            buttons.dock,\r\n            () => {\r\n                this.systemActions.handleDocking();\r\n                this.actionButtons.hideDockButton();\r\n            }\r\n        );\r\n        \r\n        // Setup deploy laser button events\r\n        this.actionButtons.addButtonEvents(\r\n            buttons.deployLaser,\r\n            () => this.systemActions.handleDeployLaser()\r\n        );\r\n    }\r\n    \r\n    hide() {\r\n        this.joystickZones.hideZones();\r\n        this.actionButtons.hideButtons();\r\n        this.gestureDetector.disable();\r\n    }\r\n    \r\n    show() {\r\n        // Only show controls when not docked and not in intro sequence\r\n        if ((this.spaceship && this.spaceship.isDocked) || \r\n            (window.game && window.game.introSequenceActive)) {\r\n            console.log(\"TouchControls: Not showing controls during docked state or intro sequence\");\r\n            return;\r\n        }\r\n        \r\n        this.joystickZones.showZones();\r\n        this.actionButtons.showButtons();\r\n        this.gestureDetector.enable();\r\n    }\r\n    \r\n    update() {\r\n        // Update dock button visibility based on proximity to stargate\r\n        if (this.systemActions.shouldShowDock(this.spaceship)) {\r\n            this.actionButtons.showDockButton();\r\n        } else {\r\n            this.actionButtons.hideDockButton();\r\n        }\r\n    }\r\n    \r\n    // Compatibility methods for existing API\r\n    showDockButton() {\r\n        this.actionButtons.showDockButton();\r\n    }\r\n    \r\n    hideDockButton() {\r\n        this.actionButtons.hideDockButton();\r\n    }\r\n}","// touchControls.js - Touch controls for mobile devices using nipple.js\r\n// This is a compatibility wrapper for the refactored touch controls\r\n\r\nimport { TouchControls as RefactoredTouchControls } from './touch/touchControls.js';\r\n\r\nexport class TouchControls extends RefactoredTouchControls {\r\n    constructor(spaceship, physics) {\r\n        super(spaceship, physics);\r\n        \r\n        // Maintain compatibility properties for legacy code\r\n        this.leftJoystick = null;\r\n        this.rightJoystick = null;\r\n        this.dockButton = null;\r\n        this.mineButton = null;\r\n        this.fireButton = null;\r\n        this.targetButton = null;\r\n        this.threshold = 0.1;\r\n        \r\n        // Store references to systems we need to interact with\r\n        this.miningSystem = null;\r\n        this.targetingSystem = null;\r\n        this.dockingSystem = null;\r\n        this.weaponSystem = null;\r\n    }\r\n    \r\n    // Override setControlSystems to maintain compatibility and store legacy references\r\n    setControlSystems(controls) {\r\n        // Call parent implementation\r\n        const result = super.setControlSystems(controls);\r\n        \r\n        // Store legacy references for backward compatibility\r\n        this.miningSystem = controls.miningSystem;\r\n        this.targetingSystem = controls.targetingSystem;\r\n        this.dockingSystem = controls.dockingSystem;\r\n        this.weaponSystem = controls.weaponSystem;\r\n        \r\n        return result;\r\n    }\r\n} ","/**\r\n * mobileDetector.js - Utility for detecting mobile devices and touch capabilities\r\n */\r\n\r\nexport class MobileDetector {\r\n    /**\r\n     * Check if the current device is a mobile device\r\n     * @returns {boolean} True if the device is mobile\r\n     */\r\n    static isMobile() {\r\n        // Store result in cache to avoid recalculation\r\n        if (this._isMobileCache !== undefined) {\r\n            return this._isMobileCache;\r\n        }\r\n        \r\n        // Check for mobile user agent\r\n        const userAgentCheck = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|Mobile|Tablet|Android|iP(ad|hone|od)/i.test(navigator.userAgent);\r\n        \r\n        // Check for touch capabilities - more comprehensive check\r\n        const touchCheck = (\r\n            'ontouchstart' in window || \r\n            navigator.maxTouchPoints > 0 || \r\n            navigator.msMaxTouchPoints > 0 ||\r\n            (window.DocumentTouch && document instanceof DocumentTouch)\r\n        );\r\n        \r\n        // Check screen width and orientation\r\n        const screenCheck = window.innerWidth < 900; // More generous width threshold\r\n        \r\n        // Check if viewport meta tag has mobile-optimized settings\r\n        const viewportCheck = (() => {\r\n            const viewport = document.querySelector('meta[name=viewport]');\r\n            if (viewport) {\r\n                return viewport.content.includes('width=device-width');\r\n            }\r\n            return false;\r\n        })();\r\n        \r\n        // Check for specific mobile browser features\r\n        const mobileFeatureCheck = 'orientation' in window || 'onorientationchange' in window;\r\n        \r\n        // Check if device motion/orientation events are supported (typically mobile)\r\n        const motionCheck = 'DeviceMotionEvent' in window || 'DeviceOrientationEvent' in window;\r\n        \r\n        // Improve detection of tablets - they are also considered mobile for our purposes\r\n        const isTablet = (() => {\r\n            // iPads now report as desktop in newer iOS, so we need specific checks\r\n            const isIpad = navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1;\r\n            // Android tablets often have larger screens\r\n            const isAndroidTablet = /android/i.test(navigator.userAgent) && !/mobile/i.test(navigator.userAgent);\r\n            \r\n            return isIpad || isAndroidTablet;\r\n        })();\r\n        \r\n        // More comprehensive detection logic - a device is mobile if:\r\n        // 1. It matches mobile user agent patterns, OR\r\n        // 2. It has touch capabilities AND either:\r\n        //    a. Has a small-to-medium screen size, OR\r\n        //    b. Has mobile browser features, OR\r\n        //    c. Supports device motion/orientation, OR\r\n        //    d. Is detected as a tablet\r\n        this._isMobileCache = userAgentCheck || \r\n            (touchCheck && (screenCheck || mobileFeatureCheck || motionCheck || viewportCheck || isTablet));\r\n        \r\n        console.log(`MobileDetector: Device detected as ${this._isMobileCache ? 'mobile' : 'desktop'}`);\r\n        console.log(`- UA: ${userAgentCheck}, touch: ${touchCheck}, screen: ${screenCheck}`);\r\n        console.log(`- features: ${mobileFeatureCheck}, motion: ${motionCheck}, tablet: ${isTablet}`);\r\n        \r\n        return this._isMobileCache;\r\n    }\r\n    \r\n    /**\r\n     * Reset the mobile detection cache (useful after device orientation changes)\r\n     */\r\n    static resetCache() {\r\n        this._isMobileCache = undefined;\r\n    }\r\n    \r\n    /**\r\n     * Check if the device supports touch events\r\n     * @returns {boolean} True if touch is supported\r\n     */\r\n    static hasTouch() {\r\n        return ('ontouchstart' in window) || \r\n               (navigator.maxTouchPoints > 0) || \r\n               (navigator.msMaxTouchPoints > 0) ||\r\n               (window.DocumentTouch && document instanceof DocumentTouch);\r\n    }\r\n    \r\n    /**\r\n     * Get device orientation\r\n     * @returns {string} 'portrait' or 'landscape'\r\n     */\r\n    static getOrientation() {\r\n        return window.innerHeight > window.innerWidth ? 'portrait' : 'landscape';\r\n    }\r\n    \r\n    /**\r\n     * Add handler for orientation changes\r\n     * @param {Function} handler Function to call when orientation changes\r\n     */\r\n    static addOrientationChangeHandler(handler) {\r\n        // Track previous orientation\r\n        let prevOrientation = this.getOrientation();\r\n        \r\n        // Use both resize and orientationchange for better compatibility\r\n        const checkOrientation = () => {\r\n            const currentOrientation = this.getOrientation();\r\n            if (currentOrientation !== prevOrientation) {\r\n                prevOrientation = currentOrientation;\r\n                // Reset mobile detection cache\r\n                this.resetCache();\r\n                // Call handler with new orientation\r\n                handler(currentOrientation);\r\n            }\r\n        };\r\n        \r\n        window.addEventListener('resize', checkOrientation);\r\n        \r\n        // Add orientationchange listener if available\r\n        if ('onorientationchange' in window) {\r\n            window.addEventListener('orientationchange', checkOrientation);\r\n        }\r\n    }\r\n} ","// controls.js - Main controls module that integrates all control components\r\n\r\nimport { InputHandler } from './controls/inputHandler.js';\r\nimport { GamepadHandler } from './controls/gamepadHandler.js';\r\nimport { MiningSystem } from './controls/miningSystem.js';\r\nimport { TargetingSystem } from './controls/targetingSystem.js';\r\nimport { DockingSystem } from './controls/dockingSystem.js';\r\nimport { TouchControls } from './controls/touchControls.js';\r\nimport { MobileDetector } from '../utils/mobileDetector.js';\r\n\r\nexport class Controls {\r\n    constructor(spaceship, physics, environment, ui) {\r\n        console.log(\"Initializing controls systems...\");\r\n        \r\n        this.spaceship = spaceship;\r\n        this.physics = physics;\r\n        this.environment = environment;\r\n        this.ui = ui;\r\n        this.isMobile = MobileDetector.isMobile();\r\n        this._wasDocked = spaceship ? spaceship.isDocked : false;\r\n        this.weaponSystem = null; // Initialize weaponSystem reference\r\n        \r\n        // Set scene reference for components that need it\r\n        this.scene = physics.scene;\r\n        \r\n        // Initialize controls components\r\n        if (!this.isMobile) {\r\n            console.log(\"Initializing keyboard/mouse controls\");\r\n            this.inputHandler = new InputHandler(spaceship, physics);\r\n            \r\n            // Initialize gamepad support for desktop\r\n            console.log(\"Initializing gamepad support\");\r\n            this.gamepadHandler = new GamepadHandler(spaceship, physics, this);\r\n        } else {\r\n            console.log(\"Initializing touch controls for mobile\");\r\n            this.touchControls = new TouchControls(spaceship, physics);\r\n            // Create a placeholder input handler with minimal functionality\r\n            // This prevents errors where other systems expect inputHandler to exist\r\n            this.inputHandler = {\r\n                isLocked: () => false,\r\n                exitPointerLock: () => {}\r\n            };\r\n        }\r\n        \r\n        this.miningSystem = new MiningSystem(spaceship, this.scene);\r\n        this.targetingSystem = new TargetingSystem(spaceship, this.scene, environment);\r\n        \r\n        // Initialize docking system with all needed references\r\n        this.dockingSystem = new DockingSystem(spaceship, environment.stargate, ui);\r\n        \r\n        // Share the resources reference between components\r\n        this.resources = this.miningSystem.resources;\r\n        this.dockingSystem.setResources(this.resources);\r\n        \r\n        // Initialize orb inventory\r\n        if (!this.resources.orbs) {\r\n            this.resources.orbs = {\r\n                common: 0,\r\n                uncommon: 0,\r\n                rare: 0,\r\n                epic: 0,\r\n                legendary: 0\r\n            };\r\n        }\r\n        \r\n        // Pass control systems to touch controls if on mobile\r\n        if (this.isMobile && this.touchControls) {\r\n            this.touchControls.setControlSystems(this);\r\n        }\r\n        \r\n        // Connect upgrade systems - share references for easier updates\r\n        this.connectUpgradeEffects();\r\n        \r\n        // Set up event handlers - different for mobile vs desktop\r\n        this.setupEventHandlers();\r\n        \r\n        // Initialize anomaly orb collection state\r\n        this.lastAnomalyCheck = 0;\r\n        this.currentAnomaly = null;\r\n        this.showingAnomalyNotification = false;\r\n        \r\n        console.log(\"Control systems initialized\");\r\n    }\r\n    \r\n    // New method to connect upgrade effects between systems\r\n    connectUpgradeEffects() {\r\n        // Give the docking system a way to update the mining system\r\n        this.dockingSystem.updateMiningSystem = () => {\r\n            // Update mining speeds based on spaceship's mining efficiency\r\n            if (this.miningSystem && this.spaceship) {\r\n                const efficiency = this.spaceship.miningEfficiency;\r\n                \r\n                // Update base mining speeds for each resource type\r\n                Object.keys(this.miningSystem.miningSpeedByType).forEach(resourceType => {\r\n                    // Store original base speeds if not already stored\r\n                    if (!this.miningSystem._originalMiningSpeedByType) {\r\n                        this.miningSystem._originalMiningSpeedByType = { ...this.miningSystem.miningSpeedByType };\r\n                    }\r\n                    \r\n                    // Apply efficiency to the original base speed\r\n                    const originalSpeed = this.miningSystem._originalMiningSpeedByType[resourceType];\r\n                    this.miningSystem.miningSpeedByType[resourceType] = originalSpeed * efficiency;\r\n                });\r\n                \r\n                console.log(\"Mining speeds updated with efficiency:\", efficiency);\r\n                \r\n                // Update current mining speed if mining is in progress\r\n                if (this.miningSystem.targetAsteroid) {\r\n                    this.miningSystem.setTargetAsteroid(this.miningSystem.targetAsteroid);\r\n                }\r\n            }\r\n        };\r\n    }\r\n    \r\n    setupEventHandlers() {\r\n        // Skip adding keyboard controls if on mobile\r\n        if (this.isMobile) {\r\n            console.log(\"Mobile device detected, touch handlers are set in TouchControls class\");\r\n            return;\r\n        }\r\n        \r\n        // Add key event handlers for targeting and mining\r\n        document.addEventListener('keydown', e => {\r\n            switch (e.key.toLowerCase()) {\r\n                case 'e': \r\n                    // Toggle targeting system (changed from 't' to 'e')\r\n                    this.targetingSystem.toggleLockOn();\r\n                    break;\r\n                case 'f7':\r\n                    // Decrease gamepad sensitivity\r\n                    if (this.gamepadHandler) {\r\n                        this.gamepadHandler.lookSensitivity = Math.max(0.2, this.gamepadHandler.lookSensitivity - 0.2);\r\n                        console.log(`Gamepad sensitivity: ${this.gamepadHandler.lookSensitivity.toFixed(1)}`);\r\n                        this.showSensitivityNotification(this.gamepadHandler.lookSensitivity);\r\n                    }\r\n                    e.preventDefault();\r\n                    break;\r\n                case 'f8':\r\n                    // Increase gamepad sensitivity\r\n                    if (this.gamepadHandler) {\r\n                        this.gamepadHandler.lookSensitivity = Math.min(3.0, this.gamepadHandler.lookSensitivity + 0.2);\r\n                        console.log(`Gamepad sensitivity: ${this.gamepadHandler.lookSensitivity.toFixed(1)}`);\r\n                        this.showSensitivityNotification(this.gamepadHandler.lookSensitivity);\r\n                    }\r\n                    e.preventDefault();\r\n                    break;\r\n                case 'f9':\r\n                    // Toggle gamepad debug display\r\n                    if (this.gamepadHandler) {\r\n                        this.gamepadHandler.toggleDebug();\r\n                        console.log('Gamepad debug display toggled');\r\n                    }\r\n                    e.preventDefault();\r\n                    break;\r\n                case 'tab': \r\n                    // Cycle through targets if targeting is enabled\r\n                    if (this.targetingSystem.isLockOnEnabled()) {\r\n                        const target = this.targetingSystem.cycleLockOnTarget();\r\n                        if (target) {\r\n                            this.miningSystem.setTargetAsteroid(target);\r\n                        }\r\n                    }\r\n                    e.preventDefault(); // Prevent tab from changing focus\r\n                    break;\r\n                case 'r': // Changed from 'e' to 'r' (an unused key)\r\n                    // Toggle mining if targeting is enabled and we have a target\r\n                    if (this.targetingSystem.isLockOnEnabled()) {\r\n                        const target = this.targetingSystem.getCurrentTarget();\r\n                        if (target) {\r\n                            this.miningSystem.setTargetAsteroid(target);\r\n                            if (this.miningSystem.isMining) {\r\n                                this.miningSystem.stopMining();\r\n                            } else {\r\n                                this.miningSystem.startMining();\r\n                            }\r\n                        }\r\n                    }\r\n                    break;\r\n                case 't': \r\n                    // Deploy a laser turret\r\n                    console.log(\"Deploying laser turret\");\r\n                    if (window.mainMessageBus) {\r\n                        window.mainMessageBus.publish('input.deployLaser', {});\r\n                    }\r\n                    break;\r\n                case 'g': \r\n                    // Pick up an item\r\n                    console.log(\"Attempting to pick up an item\");\r\n                    if (window.mainMessageBus) {\r\n                        window.mainMessageBus.publish('input.pickupInteract', {});\r\n                    }\r\n                    break;\r\n            }\r\n        });\r\n        \r\n        // Add mouse click for mining\r\n        document.addEventListener('mousedown', e => {\r\n            if (e.button === 0 && this.inputHandler.isLocked()) { // Left mouse button\r\n                // Fire particle cannon\r\n                if (window.game && window.game.combat) {\r\n                    window.game.combat.setFiring(true);\r\n                }\r\n            }\r\n        });\r\n        \r\n        // Add mouseup to stop mining when button is released\r\n        document.addEventListener('mouseup', e => {\r\n            if (e.button === 0) { // Left mouse button\r\n                // Stop firing\r\n                if (window.game && window.game.combat) {\r\n                    window.game.combat.setFiring(false);\r\n                }\r\n            }\r\n        });\r\n    }\r\n    \r\n    setupStargateUIControls() {\r\n        if (this.dockingSystem) {\r\n            this.dockingSystem.setupStargateUIControls();\r\n        }\r\n    }\r\n    \r\n    // Method to dock with stargate (called from main.js on game start)\r\n    dockWithStargate() {\r\n        if (this.dockingSystem) {\r\n            this.dockingSystem.dockWithStargate();\r\n            \r\n            // Hide touch controls when docked\r\n            if (this.isMobile && this.touchControls) {\r\n                this.touchControls.hide();\r\n            }\r\n        } else {\r\n            console.error(\"Docking system not initialized\");\r\n        }\r\n    }\r\n    \r\n    // Collect energy orb from space anomaly\r\n    collectEnergyOrb() {\r\n        if (!this.environment || !this.spaceship) return;\r\n        \r\n        // Check if player is near an anomaly with an active orb\r\n        const anomaly = this.environment.checkAnomalyCollision(this.spaceship.mesh.position);\r\n        if (!anomaly) {\r\n            return; // No anomaly in range, silently return\r\n        }\r\n        \r\n        // Try to collect the orb\r\n        const orbData = this.environment.collectAnomalyOrb(anomaly);\r\n        if (!orbData) {\r\n            // Orb already collected, notification handled in checkForAnomalyOrbs\r\n            return;\r\n        }\r\n        \r\n        // Initialize orbs inventory if needed\r\n        if (!this.resources.orbs) {\r\n            this.resources.orbs = {\r\n                common: 0,\r\n                uncommon: 0,\r\n                rare: 0,\r\n                epic: 0,\r\n                legendary: 0\r\n            };\r\n        }\r\n        \r\n        // Add orb to inventory\r\n        this.resources.orbs[orbData.rarity]++;\r\n        \r\n        // Show notification with value and rarity\r\n        let rarityColor;\r\n        switch(orbData.rarity) {\r\n            case 'legendary':\r\n                rarityColor = \"#ff0000\"; // Red\r\n                break;\r\n            case 'epic':\r\n                rarityColor = \"#ff6600\"; // Orange\r\n                break;\r\n            case 'rare':\r\n                rarityColor = \"#9900ff\"; // Purple\r\n                break;\r\n            case 'uncommon':\r\n                rarityColor = \"#0066ff\"; // Blue\r\n                break;\r\n            default: // common\r\n                rarityColor = \"#00ff66\"; // Green\r\n                break;\r\n        }\r\n        \r\n        const capitalizedRarity = orbData.rarity.charAt(0).toUpperCase() + orbData.rarity.slice(1);\r\n        \r\n        // Show message with appropriate styling\r\n        this.showAnomalyMessage(\r\n            `Collected ${capitalizedRarity} Energy Orb (${orbData.value} CR)`,\r\n            rarityColor\r\n        );\r\n        \r\n        // Trigger collection effect\r\n        this.triggerOrbCollectionEffect(anomaly);\r\n        \r\n        // Play sound if audio manager is available\r\n        if (window.game && window.game.audio) {\r\n            // Play different sounds based on rarity\r\n            switch(orbData.rarity) {\r\n                case 'legendary':\r\n                    window.game.audio.playSoundEffect('powerup_legendary', 0.8);\r\n                    break;\r\n                case 'epic':\r\n                    window.game.audio.playSoundEffect('powerup_epic', 0.7);\r\n                    break;\r\n                case 'rare':\r\n                    window.game.audio.playSoundEffect('powerup_rare', 0.6);\r\n                    break;\r\n                case 'uncommon':\r\n                    window.game.audio.playSoundEffect('powerup_uncommon', 0.5);\r\n                    break;\r\n                default: // common\r\n                    window.game.audio.playSoundEffect('powerup_common', 0.4);\r\n                    break;\r\n            }\r\n        }\r\n    }\r\n    \r\n    // Create a visual effect when collecting an orb\r\n    triggerOrbCollectionEffect(anomaly) {\r\n        // Check if we have access to the scene and visual effects\r\n        if (!this.scene || !anomaly) return;\r\n        \r\n        // Create an explosion effect at the anomaly orb position\r\n        if (window.game && window.game.combat) {\r\n            const position = anomaly.position.clone();\r\n            \r\n            // Use explosion effect from combat system\r\n            window.game.combat.createExplosionEffect(position, 2000, true);\r\n            \r\n            // Also publish an event for additional effects\r\n            if (window.mainMessageBus) {\r\n                window.mainMessageBus.publish('vfx.explosion', {\r\n                    position: position,\r\n                    color: anomaly.orb.color,\r\n                    size: anomaly.orb.size * 2,\r\n                    duration: 2000\r\n                });\r\n            }\r\n        }\r\n    }\r\n    \r\n    // Show a notification when anomaly is found or orb is collected\r\n    showAnomalyMessage(message, color) {\r\n        if (this.showingAnomalyNotification) return; // Don't stack notifications\r\n        \r\n        this.showingAnomalyNotification = true;\r\n        \r\n        // Create notification element\r\n        const notification = document.createElement('div');\r\n        notification.style.position = 'fixed';\r\n        notification.style.top = '30%';\r\n        notification.style.left = '50%';\r\n        notification.style.transform = 'translate(-50%, -50%)';\r\n        notification.style.backgroundColor = 'rgba(0, 0, 0, 0.8)';\r\n        notification.style.color = color || '#ffffff';\r\n        notification.style.padding = '15px 30px';\r\n        notification.style.borderRadius = '10px';\r\n        notification.style.border = `2px solid ${color || '#ffffff'}`;\r\n        notification.style.boxShadow = `0 0 15px ${color || '#ffffff'}`;\r\n        notification.style.fontFamily = 'Courier New, monospace';\r\n        notification.style.fontSize = '18px';\r\n        notification.style.zIndex = '1000';\r\n        notification.style.textAlign = 'center';\r\n        notification.style.pointerEvents = 'none'; // Don't block mouse events\r\n        \r\n        // Set notification text\r\n        notification.textContent = message;\r\n        \r\n        // Add to DOM\r\n        document.body.appendChild(notification);\r\n        \r\n        // Remove after a few seconds\r\n        setTimeout(() => {\r\n            notification.style.opacity = '0';\r\n            notification.style.transition = 'opacity 0.8s';\r\n            \r\n            setTimeout(() => {\r\n                notification.remove();\r\n                this.showingAnomalyNotification = false;\r\n            }, 800);\r\n        }, 3000);\r\n    }\r\n    \r\n    showSensitivityNotification(sensitivity) {\r\n        // Create notification element\r\n        const notification = document.createElement('div');\r\n        notification.textContent = `Gamepad Sensitivity: ${sensitivity.toFixed(1)}`;\r\n        notification.style.position = 'fixed';\r\n        notification.style.top = '100px';\r\n        notification.style.left = '50%';\r\n        notification.style.transform = 'translateX(-50%)';\r\n        notification.style.backgroundColor = 'rgba(0, 0, 0, 0.8)';\r\n        notification.style.color = '#30cfd0';\r\n        notification.style.padding = '10px 20px';\r\n        notification.style.borderRadius = '5px';\r\n        notification.style.border = '1px solid #30cfd0';\r\n        notification.style.fontFamily = 'monospace';\r\n        notification.style.fontSize = '16px';\r\n        notification.style.zIndex = '10000';\r\n        notification.style.pointerEvents = 'none';\r\n        \r\n        document.body.appendChild(notification);\r\n        \r\n        // Fade out and remove after 2 seconds\r\n        setTimeout(() => {\r\n            notification.style.transition = 'opacity 0.5s';\r\n            notification.style.opacity = '0';\r\n            setTimeout(() => notification.remove(), 500);\r\n        }, 2000);\r\n    }\r\n    \r\n    /**\r\n     * Update control systems\r\n     * @param {number} deltaTime Time since last update in seconds\r\n     */\r\n    update(deltaTime = 1/60) {\r\n        // Skip ALL updates if intro sequence is active\r\n        if (window.game && window.game.introSequenceActive) {\r\n            return;\r\n        }\r\n        \r\n        // Check if docking status changed\r\n        if (this.spaceship) {\r\n            const wasDocked = this._wasDocked;\r\n            const isDocked = this.spaceship.isDocked;\r\n            \r\n            // If docking status changed, update touch controls visibility\r\n            if (this.isMobile && this.touchControls && wasDocked !== isDocked) {\r\n                if (isDocked) {\r\n                    this.touchControls.hide();\r\n                } else {\r\n                    this.touchControls.show();\r\n                }\r\n                this._wasDocked = isDocked;\r\n            }\r\n        }\r\n        \r\n        // Skip updates if docked\r\n        if (this.spaceship && this.spaceship.isDocked) {\r\n            // Only update the docking system when docked\r\n            if (this.dockingSystem) {\r\n                this.dockingSystem.update();\r\n            }\r\n            return;\r\n        }\r\n        \r\n        // Update gamepad input if available\r\n        if (this.gamepadHandler) {\r\n            this.gamepadHandler.update(deltaTime);\r\n        }\r\n        \r\n        // Update all control systems\r\n        if (this.targetingSystem) {\r\n            this.targetingSystem.update();\r\n        }\r\n        \r\n        if (this.miningSystem) {\r\n            // Pass deltaTime to ensure frame-rate independent mining\r\n            this.miningSystem.update(deltaTime);\r\n            \r\n            // Check if mining has destroyed an asteroid\r\n            const destroyedAsteroid = this.miningSystem.getLastDestroyedAsteroid();\r\n            if (destroyedAsteroid && this.environment && this.environment.asteroidBelt) {\r\n                // Remove the asteroid from the environment\r\n                this.environment.asteroidBelt.removeAsteroid(destroyedAsteroid);\r\n            }\r\n        }\r\n        \r\n        if (this.dockingSystem) {\r\n            this.dockingSystem.update();\r\n        }\r\n        \r\n        // Update touch controls if on mobile\r\n        if (this.isMobile && this.touchControls) {\r\n            this.touchControls.update();\r\n        }\r\n        \r\n        if (this.deploymentSystem) {\r\n            this.deploymentSystem.update();\r\n        }\r\n        \r\n        // Check for and automatically collect anomaly orbs\r\n        this.checkForAnomalyOrbs();\r\n    }\r\n    \r\n    // Check if the player is near an anomaly orb and collect it if close enough\r\n    checkForAnomalyOrbs() {\r\n        if (!this.environment || !this.spaceship) return;\r\n        \r\n        // Limit check frequency to avoid performance impact\r\n        const now = performance.now();\r\n        if (now - this.lastAnomalyCheck < 500) return; // Check every 500ms\r\n        this.lastAnomalyCheck = now;\r\n        \r\n        // Check if player is within an anomaly's orb collection radius\r\n        const anomaly = this.environment.checkAnomalyCollision(this.spaceship.mesh.position);\r\n        \r\n        // If player is within collection radius of an anomaly with an uncollected orb\r\n        if (anomaly && !anomaly.orbCollected) {\r\n            // Automatically collect the orb\r\n            this.collectEnergyOrb();\r\n            \r\n            // Reset current anomaly when orb is collected\r\n            this.currentAnomaly = null;\r\n        } else if (anomaly && anomaly !== this.currentAnomaly && anomaly.orbCollected) {\r\n            // If player enters a depleted anomaly, show notification\r\n            this.currentAnomaly = anomaly;\r\n            this.showAnomalyMessage(\"Energy orb already collected\", \"#ff3333\");\r\n        } else if (!anomaly) {\r\n            // Reset current anomaly when player leaves the collection radius\r\n            this.currentAnomaly = null;\r\n        }\r\n    }\r\n    \r\n    // Getter for isMining status (used by UI)\r\n    get isMining() {\r\n        return this.miningSystem ? this.miningSystem.isMining : false;\r\n    }\r\n    \r\n    // Getter for mining progress (used by UI)\r\n    get miningProgress() {\r\n        return this.miningSystem ? this.miningSystem.miningProgress : 0;\r\n    }\r\n} ","// styles.js - CSS styles and animations for HUD elements\r\n\r\nexport class HUDStyles {\r\n    static initializeStyles() {\r\n        // Add Google Font for futuristic UI\r\n        const fontLink = document.createElement('link');\r\n        fontLink.href = 'https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;600&family=Electrolize&display=swap';\r\n        fontLink.rel = 'stylesheet';\r\n        document.head.appendChild(fontLink);\r\n\r\n        // Add main HUD animations and styles\r\n        const style = document.createElement('style');\r\n        style.textContent = `\r\n            @keyframes pulse {\r\n                0% { opacity: 0.7; }\r\n                50% { opacity: 1; }\r\n                100% { opacity: 0.7; }\r\n            }\r\n            \r\n            @keyframes radar-ping {\r\n                0% { transform: translate(-50%, -50%) scale(0); opacity: 0.5; }\r\n                100% { transform: translate(-50%, -50%) scale(3); opacity: 0; }\r\n            }\r\n            \r\n            @keyframes text-flicker {\r\n                0% { opacity: 1; }\r\n                3% { opacity: 0.4; }\r\n                6% { opacity: 1; }\r\n                9% { opacity: 0.4; }\r\n                12% { opacity: 1; }\r\n                35% { opacity: 1; }\r\n                38% { opacity: 0.4; }\r\n                41% { opacity: 1; }\r\n                100% { opacity: 1; }\r\n            }\r\n            \r\n            @keyframes blink {\r\n                0% { opacity: 1; }\r\n                49% { opacity: 1; }\r\n                50% { opacity: 0; }\r\n                100% { opacity: 0; }\r\n            }\r\n\r\n            @keyframes pulse-horde {\r\n                0% { box-shadow: 0 0 5px rgba(255, 30, 30, 0.5); }\r\n                50% { box-shadow: 0 0 10px rgba(255, 30, 30, 0.8); }\r\n                100% { box-shadow: 0 0 5px rgba(255, 30, 30, 0.5); }\r\n            }\r\n        `;\r\n        document.head.appendChild(style);\r\n    }\r\n\r\n    static getMainContainerStyles() {\r\n        return {\r\n            position: 'absolute',\r\n            top: '0',\r\n            left: '0',\r\n            width: '100%',\r\n            height: '100%',\r\n            pointerEvents: 'none',\r\n            fontFamily: '\"Rajdhani\", \"Electrolize\", sans-serif',\r\n            fontWeight: '400',\r\n            color: 'rgba(120, 220, 232, 0.9)',\r\n            textShadow: '0 0 10px rgba(120, 220, 232, 0.5)',\r\n            opacity: '0',\r\n            transition: 'opacity 0.5s ease'\r\n        };\r\n    }\r\n\r\n    static getPanelStyles() {\r\n        return {\r\n            backgroundColor: 'rgba(6, 22, 31, 0.7)',\r\n            backdropFilter: 'blur(5px)',\r\n            borderRadius: '10px',\r\n            border: '1px solid rgba(120, 220, 232, 0.3)',\r\n            boxShadow: '0 0 15px rgba(120, 220, 232, 0.2), inset 0 0 10px rgba(120, 220, 232, 0.1)',\r\n            overflow: 'hidden'\r\n        };\r\n    }\r\n\r\n    static getPanelHeaderStyles() {\r\n        return {\r\n            fontWeight: '600',\r\n            fontSize: '14px',\r\n            textTransform: 'uppercase',\r\n            letterSpacing: '2px',\r\n            marginBottom: '15px',\r\n            paddingBottom: '8px',\r\n            borderBottom: '1px solid rgba(120, 220, 232, 0.3)',\r\n            display: 'flex',\r\n            justifyContent: 'space-between',\r\n            alignItems: 'center'\r\n        };\r\n    }\r\n\r\n    static getStatusIndicatorStyles() {\r\n        return {\r\n            width: '8px',\r\n            height: '8px',\r\n            borderRadius: '50%',\r\n            backgroundColor: 'rgba(120, 220, 232, 0.8)',\r\n            boxShadow: '0 0 5px rgba(120, 220, 232, 0.8)',\r\n            animation: 'pulse 2s infinite'\r\n        };\r\n    }\r\n\r\n    static getPanelRowStyles() {\r\n        return {\r\n            display: 'flex',\r\n            justifyContent: 'space-between',\r\n            alignItems: 'center',\r\n            margin: '10px 0'\r\n        };\r\n    }\r\n\r\n    static getButtonStyles() {\r\n        return {\r\n            width: '100%',\r\n            marginTop: '15px',\r\n            padding: '8px',\r\n            backgroundColor: 'rgba(120, 220, 232, 0.15)',\r\n            border: '1px solid rgba(120, 220, 232, 0.5)',\r\n            borderRadius: '5px',\r\n            color: 'rgba(120, 220, 232, 0.9)',\r\n            fontSize: '12px',\r\n            fontFamily: '\"Rajdhani\", sans-serif',\r\n            cursor: 'pointer',\r\n            transition: 'all 0.2s ease',\r\n            textTransform: 'uppercase',\r\n            letterSpacing: '1px',\r\n            fontWeight: '600',\r\n            outline: 'none',\r\n            pointerEvents: 'auto'\r\n        };\r\n    }\r\n\r\n    static getBarContainerStyles() {\r\n        return {\r\n            height: '10px',\r\n            backgroundColor: 'rgba(10, 30, 40, 0.5)',\r\n            borderRadius: '5px',\r\n            overflow: 'hidden'\r\n        };\r\n    }\r\n\r\n    static getBarStyles() {\r\n        return {\r\n            width: '100%',\r\n            height: '100%',\r\n            boxShadow: 'inset 0 0 5px rgba(255, 255, 255, 0.5)',\r\n            transition: 'width 0.3s ease'\r\n        };\r\n    }\r\n\r\n    static getScanlineEffectStyles() {\r\n        return {\r\n            position: 'absolute',\r\n            top: '0',\r\n            left: '0',\r\n            width: '100%',\r\n            height: '100%',\r\n            background: 'linear-gradient(transparent 50%, rgba(120, 220, 232, 0.03) 50%)',\r\n            backgroundSize: '100% 4px',\r\n            zIndex: '1000',\r\n            pointerEvents: 'none',\r\n            opacity: '0.5'\r\n        };\r\n    }\r\n\r\n    static getActiveScanlineStyles() {\r\n        return {\r\n            position: 'absolute',\r\n            left: '0',\r\n            width: '100%',\r\n            height: '3px',\r\n            background: 'linear-gradient(90deg, transparent 0%, rgba(120, 220, 232, 0.1) 50%, transparent 100%)',\r\n            boxShadow: '0 0 10px rgba(120, 220, 232, 0.3)',\r\n            zIndex: '1001',\r\n            top: '0',\r\n            opacity: '0.7',\r\n            pointerEvents: 'none'\r\n        };\r\n    }\r\n\r\n    static createGlitchAnimation() {\r\n        const timestamp = Date.now();\r\n        const glitchAnimation = `\r\n            @keyframes glitch-${timestamp} {\r\n                0% { transform: translate(0, 0) skew(0deg); filter: hue-rotate(0deg); }\r\n                1% { transform: translate(2px, 2px) skew(1deg); filter: hue-rotate(90deg); }\r\n                2% { transform: translate(-2px, -3px) skew(-1deg); filter: hue-rotate(180deg); }\r\n                3% { transform: translate(0, 0) skew(0deg); filter: hue-rotate(0deg); }\r\n                12% { clip-path: inset(0 0 0 0); }\r\n                13% { clip-path: inset(10% 0 0 0); }\r\n                14% { clip-path: inset(0 0 0 0); }\r\n                15% { clip-path: inset(0 0 10% 0); }\r\n                16% { clip-path: inset(0 0 0 0); }\r\n                100% { transform: translate(0, 0) skew(0deg); filter: hue-rotate(0deg); }\r\n            }\r\n        `;\r\n        \r\n        // Add animation to document\r\n        const style = document.createElement('style');\r\n        style.textContent = glitchAnimation;\r\n        document.head.appendChild(style);\r\n        \r\n        // Return animation name for usage\r\n        return `glitch-${timestamp}`;\r\n    }\r\n\r\n    static applyStyles(element, styles) {\r\n        Object.assign(element.style, styles);\r\n    }\r\n\r\n    static addCornerElements(panel) {\r\n        // Top left corner\r\n        const topLeft = document.createElement('div');\r\n        HUDStyles.applyStyles(topLeft, {\r\n            position: 'absolute',\r\n            top: '0',\r\n            left: '0',\r\n            width: '10px',\r\n            height: '10px',\r\n            borderTop: '2px solid rgba(120, 220, 232, 0.8)',\r\n            borderLeft: '2px solid rgba(120, 220, 232, 0.8)'\r\n        });\r\n        panel.appendChild(topLeft);\r\n        \r\n        // Top right corner\r\n        const topRight = document.createElement('div');\r\n        HUDStyles.applyStyles(topRight, {\r\n            position: 'absolute',\r\n            top: '0',\r\n            right: '0',\r\n            width: '10px',\r\n            height: '10px',\r\n            borderTop: '2px solid rgba(120, 220, 232, 0.8)',\r\n            borderRight: '2px solid rgba(120, 220, 232, 0.8)'\r\n        });\r\n        panel.appendChild(topRight);\r\n        \r\n        // Bottom left corner\r\n        const bottomLeft = document.createElement('div');\r\n        HUDStyles.applyStyles(bottomLeft, {\r\n            position: 'absolute',\r\n            bottom: '0',\r\n            left: '0',\r\n            width: '10px',\r\n            height: '10px',\r\n            borderBottom: '2px solid rgba(120, 220, 232, 0.8)',\r\n            borderLeft: '2px solid rgba(120, 220, 232, 0.8)'\r\n        });\r\n        panel.appendChild(bottomLeft);\r\n        \r\n        // Bottom right corner\r\n        const bottomRight = document.createElement('div');\r\n        HUDStyles.applyStyles(bottomRight, {\r\n            position: 'absolute',\r\n            bottom: '0',\r\n            right: '0',\r\n            width: '10px',\r\n            height: '10px',\r\n            borderBottom: '2px solid rgba(120, 220, 232, 0.8)',\r\n            borderRight: '2px solid rgba(120, 220, 232, 0.8)'\r\n        });\r\n        panel.appendChild(bottomRight);\r\n    }\r\n}","// displays.js - Resource displays, health bars, fuel gauges, and data panels\r\n\r\nimport { HUDStyles } from './styles.js';\r\n\r\nexport class HUDDisplays {\r\n    static createFlightPanel(parent) {\r\n        const flightPanel = document.createElement('div');\r\n        flightPanel.id = 'flight-panel';\r\n        flightPanel.className = 'hud-panel';\r\n        \r\n        HUDStyles.applyStyles(flightPanel, {\r\n            position: 'absolute',\r\n            bottom: '20px',\r\n            left: '20px',\r\n            width: '260px',\r\n            padding: '15px',\r\n            ...HUDStyles.getPanelStyles()\r\n        });\r\n        \r\n        parent.appendChild(flightPanel);\r\n        \r\n        // Panel header\r\n        const panelHeader = document.createElement('div');\r\n        panelHeader.className = 'panel-header';\r\n        panelHeader.innerHTML = '<span>FLIGHT SYSTEMS</span>';\r\n        HUDStyles.applyStyles(panelHeader, HUDStyles.getPanelHeaderStyles());\r\n        flightPanel.appendChild(panelHeader);\r\n        \r\n        // Add status indicator\r\n        const statusIndicator = document.createElement('div');\r\n        statusIndicator.className = 'status-indicator';\r\n        HUDStyles.applyStyles(statusIndicator, HUDStyles.getStatusIndicatorStyles());\r\n        panelHeader.appendChild(statusIndicator);\r\n        \r\n        // Create fuel gauge\r\n        HUDDisplays.createFuelGauge(flightPanel);\r\n        \r\n        // Credits display\r\n        HUDDisplays.createPanelRow(flightPanel, 'CREDITS', 'credits', '1000 CR');\r\n        \r\n        // Controls button\r\n        HUDDisplays.createControlsButton(flightPanel);\r\n        \r\n        // Add holographic decorative elements\r\n        HUDStyles.addCornerElements(flightPanel);\r\n        \r\n        return flightPanel;\r\n    }\r\n\r\n    static createStatusPanel(parent) {\r\n        const statusPanel = document.createElement('div');\r\n        statusPanel.id = 'status-panel';\r\n        statusPanel.className = 'hud-panel';\r\n        \r\n        HUDStyles.applyStyles(statusPanel, {\r\n            position: 'absolute',\r\n            bottom: '20px',\r\n            right: '20px',\r\n            width: '260px',\r\n            padding: '15px',\r\n            ...HUDStyles.getPanelStyles()\r\n        });\r\n        \r\n        parent.appendChild(statusPanel);\r\n        \r\n        // Panel header\r\n        const panelHeader = document.createElement('div');\r\n        panelHeader.className = 'panel-header';\r\n        panelHeader.innerHTML = '<span>SHIP STATUS</span>';\r\n        HUDStyles.applyStyles(panelHeader, HUDStyles.getPanelHeaderStyles());\r\n        statusPanel.appendChild(panelHeader);\r\n        \r\n        // Add status indicator\r\n        const statusIndicator = document.createElement('div');\r\n        statusIndicator.className = 'status-indicator';\r\n        HUDStyles.applyStyles(statusIndicator, HUDStyles.getStatusIndicatorStyles());\r\n        panelHeader.appendChild(statusIndicator);\r\n        \r\n        // Ship shield bar\r\n        HUDDisplays.createShieldBar(statusPanel);\r\n        \r\n        // Ship hull integrity bar\r\n        HUDDisplays.createHullBar(statusPanel);\r\n        \r\n        // Add holographic decorative elements\r\n        HUDStyles.addCornerElements(statusPanel);\r\n        \r\n        // Add sound control button\r\n        HUDDisplays.createSoundToggleButton(statusPanel);\r\n        \r\n        return statusPanel;\r\n    }\r\n\r\n    static createLocationPanel(parent) {\r\n        const locationPanel = document.createElement('div');\r\n        locationPanel.id = 'location-panel';\r\n        locationPanel.className = 'hud-panel';\r\n        \r\n        HUDStyles.applyStyles(locationPanel, {\r\n            position: 'absolute',\r\n            top: '20px',\r\n            left: '20px',\r\n            padding: '10px 20px',\r\n            backgroundColor: 'rgba(6, 22, 31, 0.7)',\r\n            backdropFilter: 'blur(5px)',\r\n            borderRadius: '8px',\r\n            border: '1px solid rgba(120, 220, 232, 0.3)',\r\n            boxShadow: '0 0 15px rgba(120, 220, 232, 0.2)',\r\n            fontSize: '14px'\r\n        });\r\n        \r\n        parent.appendChild(locationPanel);\r\n        \r\n        // Location name with icon\r\n        locationPanel.innerHTML = `\r\n            <div style=\"display:flex; align-items:center; gap:10px;\">\r\n                <svg width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                    <path d=\"M12 2C8.13 2 5 5.13 5 9C5 14.25 12 22 12 22C12 22 19 14.25 19 9C19 5.13 15.87 2 12 2ZM12 11.5C10.62 11.5 9.5 10.38 9.5 9C9.5 7.62 10.62 6.5 12 6.5C13.38 6.5 14.5 7.62 14.5 9C14.5 10.38 13.38 11.5 12 11.5Z\" \r\n                          fill=\"rgba(120, 220, 232, 0.8)\"/>\r\n                </svg>\r\n                <span id=\"current-system\" style=\"font-weight:600; letter-spacing:1px;\">SOLAR SYSTEM</span>\r\n            </div>\r\n            <div id=\"location-coordinates\" style=\"margin-top:5px; font-size:12px; opacity:0.8;\">X: 0 Y: 0 Z: 0</div>\r\n            <div id=\"fps-display\" style=\"margin-top:5px; font-size:12px; opacity:0.8;\">FPS: 0</div>\r\n            <div style=\"margin-top:5px; display:flex; align-items:center; gap:10px; font-size:12px; opacity:0.8;\">\r\n                <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                    <path d=\"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z\" \r\n                          fill=\"rgba(120, 220, 232, 0.8)\"/>\r\n                    <path d=\"M12 6c-3.31 0-6 2.69-6 6s2.69 6 6 6 6-2.69 6-6-2.69-6-6-6zm0 10c-2.21 0-4-1.79-4-4s1.79-4 4-4 4 1.79 4 4-1.79 4-4 4z\" \r\n                          fill=\"rgba(120, 220, 232, 0.5)\"/>\r\n                </svg>\r\n                <span>ANOMALIES: <span id=\"anomaly-count\" style=\"font-weight:600;\">0</span></span>\r\n            </div>\r\n        `;\r\n        \r\n        // Add decorative corner effects\r\n        HUDStyles.addCornerElements(locationPanel);\r\n        \r\n        return locationPanel;\r\n    }\r\n\r\n    static createResourcePanel(parent) {\r\n        const resourcePanel = document.createElement('div');\r\n        resourcePanel.id = 'resource-panel';\r\n        resourcePanel.className = 'hud-panel';\r\n        \r\n        HUDStyles.applyStyles(resourcePanel, {\r\n            position: 'absolute',\r\n            top: '20px',\r\n            right: '20px',\r\n            width: '180px',\r\n            padding: '10px 15px',\r\n            backgroundColor: 'rgba(6, 22, 31, 0.7)',\r\n            backdropFilter: 'blur(5px)',\r\n            borderRadius: '8px',\r\n            border: '1px solid rgba(120, 220, 232, 0.3)',\r\n            boxShadow: '0 0 15px rgba(120, 220, 232, 0.2)',\r\n            fontSize: '14px'\r\n        });\r\n        \r\n        parent.appendChild(resourcePanel);\r\n        \r\n        // Panel header\r\n        const resourceHeader = document.createElement('div');\r\n        resourceHeader.className = 'panel-header';\r\n        resourceHeader.innerHTML = '<span>CARGO BAY</span>';\r\n        HUDStyles.applyStyles(resourceHeader, {\r\n            fontWeight: '600',\r\n            fontSize: '12px',\r\n            textTransform: 'uppercase',\r\n            letterSpacing: '1px',\r\n            marginBottom: '8px',\r\n            paddingBottom: '5px',\r\n            borderBottom: '1px solid rgba(120, 220, 232, 0.3)',\r\n            display: 'flex',\r\n            justifyContent: 'space-between',\r\n            alignItems: 'center'\r\n        });\r\n        resourcePanel.appendChild(resourceHeader);\r\n        \r\n        // Add resources\r\n        HUDDisplays.createResourceRow(resourcePanel, 'IRON', 'iron-amount', 'rgba(180, 180, 180, 0.8)');\r\n        HUDDisplays.createResourceRow(resourcePanel, 'GOLD', 'gold-amount', 'rgba(255, 215, 0, 0.8)');\r\n        HUDDisplays.createResourceRow(resourcePanel, 'PLATINUM', 'platinum-amount', 'rgba(229, 228, 226, 0.8)');\r\n        \r\n        // Add capacity meter\r\n        HUDDisplays.createCapacityMeter(resourcePanel);\r\n        \r\n        // Add decorative corner elements\r\n        HUDStyles.addCornerElements(resourcePanel);\r\n        \r\n        return resourcePanel;\r\n    }\r\n\r\n    static createFuelGauge(panel) {\r\n        const fuelRow = document.createElement('div');\r\n        fuelRow.className = 'panel-row';\r\n        HUDStyles.applyStyles(fuelRow, HUDStyles.getPanelRowStyles());\r\n        panel.appendChild(fuelRow);\r\n        \r\n        const fuelLabel = document.createElement('span');\r\n        fuelLabel.className = 'row-label';\r\n        fuelLabel.textContent = 'FUEL';\r\n        fuelLabel.style.width = '40%';\r\n        fuelRow.appendChild(fuelLabel);\r\n        \r\n        // Add fuel value display\r\n        const fuelValue = document.createElement('span');\r\n        fuelValue.id = 'fuel-value';\r\n        fuelValue.className = 'row-value';\r\n        fuelValue.textContent = '100 / 100';\r\n        HUDStyles.applyStyles(fuelValue, {\r\n            position: 'absolute',\r\n            right: '15px',\r\n            top: '-18px',\r\n            fontSize: '12px',\r\n            color: 'rgba(120, 220, 232, 0.9)'\r\n        });\r\n        \r\n        const fuelBarContainer = document.createElement('div');\r\n        HUDStyles.applyStyles(fuelBarContainer, {\r\n            width: '60%',\r\n            position: 'relative',\r\n            ...HUDStyles.getBarContainerStyles()\r\n        });\r\n        fuelBarContainer.appendChild(fuelValue);\r\n        fuelRow.appendChild(fuelBarContainer);\r\n        \r\n        const fuelBar = document.createElement('div');\r\n        fuelBar.id = 'fuel-bar';\r\n        HUDStyles.applyStyles(fuelBar, {\r\n            backgroundColor: 'rgba(120, 220, 232, 0.8)',\r\n            ...HUDStyles.getBarStyles()\r\n        });\r\n        fuelBarContainer.appendChild(fuelBar);\r\n    }\r\n\r\n    static createShieldBar(panel) {\r\n        const shieldRow = document.createElement('div');\r\n        shieldRow.className = 'panel-row';\r\n        HUDStyles.applyStyles(shieldRow, HUDStyles.getPanelRowStyles());\r\n        panel.appendChild(shieldRow);\r\n        \r\n        const shieldLabel = document.createElement('span');\r\n        shieldLabel.className = 'row-label';\r\n        shieldLabel.textContent = 'SHIELD';\r\n        shieldLabel.style.width = '50%';\r\n        shieldRow.appendChild(shieldLabel);\r\n        \r\n        const shieldBarContainer = document.createElement('div');\r\n        HUDStyles.applyStyles(shieldBarContainer, {\r\n            width: '50%',\r\n            ...HUDStyles.getBarContainerStyles()\r\n        });\r\n        shieldRow.appendChild(shieldBarContainer);\r\n        \r\n        const shieldBar = document.createElement('div');\r\n        shieldBar.id = 'shield-bar';\r\n        HUDStyles.applyStyles(shieldBar, {\r\n            backgroundColor: 'rgba(51, 153, 255, 0.8)',\r\n            ...HUDStyles.getBarStyles()\r\n        });\r\n        shieldBarContainer.appendChild(shieldBar);\r\n    }\r\n\r\n    static createHullBar(panel) {\r\n        const hullRow = document.createElement('div');\r\n        hullRow.className = 'panel-row';\r\n        HUDStyles.applyStyles(hullRow, HUDStyles.getPanelRowStyles());\r\n        panel.appendChild(hullRow);\r\n        \r\n        const hullLabel = document.createElement('span');\r\n        hullLabel.className = 'row-label';\r\n        hullLabel.textContent = 'HULL INTEGRITY';\r\n        hullLabel.style.width = '50%';\r\n        hullRow.appendChild(hullLabel);\r\n        \r\n        const hullBarContainer = document.createElement('div');\r\n        HUDStyles.applyStyles(hullBarContainer, {\r\n            width: '50%',\r\n            ...HUDStyles.getBarContainerStyles()\r\n        });\r\n        hullRow.appendChild(hullBarContainer);\r\n        \r\n        const hullBar = document.createElement('div');\r\n        hullBar.id = 'hull-bar';\r\n        HUDStyles.applyStyles(hullBar, {\r\n            backgroundColor: 'rgba(120, 220, 232, 0.8)',\r\n            ...HUDStyles.getBarStyles()\r\n        });\r\n        hullBarContainer.appendChild(hullBar);\r\n    }\r\n\r\n    static createResourceRow(panel, name, id, hexColor) {\r\n        const row = document.createElement('div');\r\n        HUDStyles.applyStyles(row, {\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            justifyContent: 'space-between',\r\n            margin: '5px 0'\r\n        });\r\n        \r\n        // Hex icon with resource color\r\n        const hexIcon = document.createElement('div');\r\n        HUDStyles.applyStyles(hexIcon, {\r\n            width: '12px',\r\n            height: '14px',\r\n            clipPath: 'polygon(25% 0%, 75% 0%, 100% 50%, 75% 100%, 25% 100%, 0% 50%)',\r\n            backgroundColor: hexColor,\r\n            marginRight: '8px'\r\n        });\r\n        \r\n        const label = document.createElement('div');\r\n        HUDStyles.applyStyles(label, {\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            width: '50%',\r\n            fontSize: '12px'\r\n        });\r\n        label.appendChild(hexIcon);\r\n        label.appendChild(document.createTextNode(name));\r\n        \r\n        const value = document.createElement('div');\r\n        value.id = id;\r\n        HUDStyles.applyStyles(value, {\r\n            width: '50%',\r\n            textAlign: 'right',\r\n            fontWeight: '600',\r\n            fontSize: '12px'\r\n        });\r\n        value.textContent = '0';\r\n        \r\n        row.appendChild(label);\r\n        row.appendChild(value);\r\n        panel.appendChild(row);\r\n    }\r\n\r\n    static createCapacityMeter(panel) {\r\n        const capacityRow = document.createElement('div');\r\n        HUDStyles.applyStyles(capacityRow, {\r\n            marginTop: '8px',\r\n            display: 'flex',\r\n            justifyContent: 'space-between',\r\n            alignItems: 'center',\r\n            borderTop: '1px solid rgba(120, 220, 232, 0.3)',\r\n            paddingTop: '8px'\r\n        });\r\n        panel.appendChild(capacityRow);\r\n        \r\n        const capacityLabel = document.createElement('div');\r\n        capacityLabel.textContent = 'CAPACITY';\r\n        capacityLabel.style.fontSize = '12px';\r\n        capacityRow.appendChild(capacityLabel);\r\n        \r\n        const capacityValue = document.createElement('div');\r\n        capacityValue.id = 'cargo-capacity';\r\n        capacityValue.textContent = '0 / 1000';\r\n        HUDStyles.applyStyles(capacityValue, {\r\n            fontSize: '12px',\r\n            fontWeight: '600'\r\n        });\r\n        capacityRow.appendChild(capacityValue);\r\n        \r\n        // Add capacity bar\r\n        const capacityBarContainer = document.createElement('div');\r\n        HUDStyles.applyStyles(capacityBarContainer, {\r\n            width: '100%',\r\n            height: '5px',\r\n            backgroundColor: 'rgba(10, 30, 40, 0.5)',\r\n            borderRadius: '3px',\r\n            overflow: 'hidden',\r\n            marginTop: '5px'\r\n        });\r\n        panel.appendChild(capacityBarContainer);\r\n        \r\n        const capacityBar = document.createElement('div');\r\n        capacityBar.id = 'capacity-bar';\r\n        HUDStyles.applyStyles(capacityBar, {\r\n            width: '0%',\r\n            height: '100%',\r\n            backgroundColor: 'rgba(120, 220, 232, 0.8)',\r\n            transition: 'width 0.3s ease'\r\n        });\r\n        capacityBarContainer.appendChild(capacityBar);\r\n    }\r\n\r\n    static createPanelRow(panel, label, id, defaultValue, isIndicator = false) {\r\n        const row = document.createElement('div');\r\n        row.className = 'panel-row';\r\n        HUDStyles.applyStyles(row, {\r\n            display: 'flex',\r\n            justifyContent: 'space-between',\r\n            alignItems: 'center',\r\n            margin: '8px 0'\r\n        });\r\n        panel.appendChild(row);\r\n        \r\n        const labelEl = document.createElement('span');\r\n        labelEl.className = 'row-label';\r\n        labelEl.textContent = label;\r\n        row.appendChild(labelEl);\r\n        \r\n        const valueEl = document.createElement('span');\r\n        valueEl.id = id;\r\n        valueEl.className = 'row-value';\r\n        valueEl.textContent = defaultValue;\r\n        \r\n        if (isIndicator && defaultValue === 'ON') {\r\n            valueEl.style.color = '#5fff8f';\r\n        } else if (isIndicator && defaultValue === 'OFF') {\r\n            valueEl.style.color = '#ff7f7f';\r\n        }\r\n        \r\n        row.appendChild(valueEl);\r\n    }\r\n\r\n    static createControlsButton(panel) {\r\n        const controlsButton = document.createElement('button');\r\n        controlsButton.id = 'show-controls';\r\n        controlsButton.textContent = 'SYSTEM CONTROLS';\r\n        HUDStyles.applyStyles(controlsButton, HUDStyles.getButtonStyles());\r\n        \r\n        controlsButton.addEventListener('mouseover', () => {\r\n            HUDStyles.applyStyles(controlsButton, {\r\n                backgroundColor: 'rgba(120, 220, 232, 0.3)',\r\n                boxShadow: '0 0 10px rgba(120, 220, 232, 0.5)'\r\n            });\r\n        });\r\n        \r\n        controlsButton.addEventListener('mouseout', () => {\r\n            HUDStyles.applyStyles(controlsButton, {\r\n                backgroundColor: 'rgba(120, 220, 232, 0.15)',\r\n                boxShadow: 'none'\r\n            });\r\n        });\r\n        \r\n        panel.appendChild(controlsButton);\r\n    }\r\n\r\n    static createSoundToggleButton(panel) {\r\n        const soundToggleBtn = document.createElement('button');\r\n        soundToggleBtn.id = 'sound-toggle';\r\n        soundToggleBtn.textContent = 'SOUND: ON';\r\n        HUDStyles.applyStyles(soundToggleBtn, {\r\n            background: 'none',\r\n            border: '1px solid rgba(120, 220, 232, 0.5)',\r\n            color: 'rgba(120, 220, 232, 0.9)',\r\n            padding: '5px 10px',\r\n            borderRadius: '5px',\r\n            cursor: 'pointer',\r\n            fontFamily: '\"Rajdhani\", sans-serif',\r\n            fontSize: '12px',\r\n            marginLeft: '10px',\r\n            marginTop: '10px',\r\n            outline: 'none',\r\n            pointerEvents: 'auto'\r\n        });\r\n        \r\n        // Add click handler for sound toggle\r\n        soundToggleBtn.addEventListener('click', () => {\r\n            if (window.game && window.game.audio) {\r\n                const isMuted = window.game.audio.toggleMute();\r\n                soundToggleBtn.textContent = isMuted ? 'SOUND: OFF' : 'SOUND: ON';\r\n            }\r\n        });\r\n        \r\n        panel.appendChild(soundToggleBtn);\r\n    }\r\n}","// notifications.js - Notification system and message display\r\n\r\nimport { HUDStyles } from './styles.js';\r\n\r\nexport class HUDNotifications {\r\n    static createNotificationsArea(parent) {\r\n        // Create notifications area in the top middle of the screen\r\n        const notificationsArea = document.createElement('div');\r\n        notificationsArea.id = 'notifications-area';\r\n        HUDStyles.applyStyles(notificationsArea, {\r\n            position: 'absolute',\r\n            top: '20px',\r\n            left: '50%',\r\n            transform: 'translateX(-50%)',\r\n            display: 'flex',\r\n            flexDirection: 'column',\r\n            alignItems: 'center',\r\n            gap: '10px'\r\n        });\r\n        parent.appendChild(notificationsArea);\r\n        \r\n        // Add horde mode indicator (hidden by default)\r\n        HUDNotifications.createHordeModeIndicator(notificationsArea);\r\n        \r\n        return notificationsArea;\r\n    }\r\n\r\n    static createHordeModeIndicator(parent) {\r\n        const hordeIndicator = document.createElement('div');\r\n        hordeIndicator.id = 'horde-mode-indicator';\r\n        hordeIndicator.className = 'hud-panel';\r\n        HUDStyles.applyStyles(hordeIndicator, {\r\n            display: 'none', // Hidden by default, will be changed to 'flex' when active\r\n            padding: '8px 12px',\r\n            backgroundColor: 'rgba(51, 10, 10, 0.8)',\r\n            backdropFilter: 'blur(5px)',\r\n            borderRadius: '8px',\r\n            border: '1px solid #ff3030',\r\n            boxShadow: '0 0 15px rgba(255, 48, 48, 0.5)',\r\n            animation: 'pulse-horde 2s infinite',\r\n            marginBottom: '10px',\r\n            fontSize: '18px',\r\n            fontWeight: '600',\r\n            letterSpacing: '1px'\r\n        });\r\n        \r\n        // Create a flex container for the horde mode indicator content\r\n        const hordeContent = document.createElement('div');\r\n        HUDStyles.applyStyles(hordeContent, {\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            justifyContent: 'center',\r\n            gap: '10px'\r\n        });\r\n        \r\n        // Add the text and timer elements\r\n        const hordeLabel = document.createElement('span');\r\n        HUDStyles.applyStyles(hordeLabel, {\r\n            color: '#ff3030',\r\n            textShadow: '0 0 5px rgba(255,48,48,0.5)'\r\n        });\r\n        hordeLabel.textContent = 'HORDE MODE';\r\n        \r\n        const survivalTime = document.createElement('span');\r\n        survivalTime.id = 'horde-survival-time';\r\n        HUDStyles.applyStyles(survivalTime, {\r\n            color: '#ff9999',\r\n            fontWeight: 'bold'\r\n        });\r\n        survivalTime.textContent = '00:00';\r\n        \r\n        // Add the elements to the container\r\n        hordeContent.appendChild(hordeLabel);\r\n        hordeContent.appendChild(survivalTime);\r\n        hordeIndicator.appendChild(hordeContent);\r\n        \r\n        // Add decorative corner elements\r\n        HUDStyles.addCornerElements(hordeIndicator);\r\n        \r\n        parent.appendChild(hordeIndicator);\r\n        \r\n        return hordeIndicator;\r\n    }\r\n\r\n    /**\r\n     * Update the horde mode indicator and survival timer\r\n     */\r\n    static updateHordeModeDisplay() {\r\n        const hordeIndicator = document.getElementById('horde-mode-indicator');\r\n        const survivalTime = document.getElementById('horde-survival-time');\r\n        \r\n        if (!hordeIndicator || !survivalTime) return;\r\n        \r\n        // Check if horde mode is active in the game\r\n        if (window.game && window.game.isHordeActive) {\r\n            // Show the indicator if not already visible\r\n            if (hordeIndicator.style.display === 'none') {\r\n                hordeIndicator.style.display = 'flex';\r\n            }\r\n            \r\n            // Update the survival time display\r\n            if (window.game.getFormattedHordeSurvivalTime) {\r\n                survivalTime.textContent = window.game.getFormattedHordeSurvivalTime();\r\n            } else {\r\n                // Fallback calculation if method not available\r\n                const totalSeconds = Math.floor(window.game.hordeSurvivalTime / 1000);\r\n                const minutes = Math.floor(totalSeconds / 60);\r\n                const seconds = totalSeconds % 60;\r\n                survivalTime.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;\r\n            }\r\n            \r\n            // Increase pulsing intensity based on survival time\r\n            // After 3 minutes, make the pulsing more urgent\r\n            if (window.game.hordeSurvivalTime > 3 * 60 * 1000) {\r\n                const styleEl = document.createElement('style');\r\n                styleEl.textContent = `\r\n                    @keyframes pulse-horde {\r\n                        0% { box-shadow: 0 0 8px rgba(255, 30, 30, 0.7); }\r\n                        50% { box-shadow: 0 0 15px rgba(255, 30, 30, 1); }\r\n                        100% { box-shadow: 0 0 8px rgba(255, 30, 30, 0.7); }\r\n                    }\r\n                `;\r\n                document.head.appendChild(styleEl);\r\n                \r\n                // Make animation faster\r\n                hordeIndicator.style.animation = 'pulse-horde 1s infinite';\r\n            }\r\n        } else {\r\n            // Hide the indicator if horde mode is not active\r\n            hordeIndicator.style.display = 'none';\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Show a temporary notification message\r\n     */\r\n    static showNotification(message, type = 'info', duration = 3000) {\r\n        const notificationsArea = document.getElementById('notifications-area');\r\n        if (!notificationsArea) return;\r\n\r\n        const notification = document.createElement('div');\r\n        notification.className = 'hud-notification';\r\n        \r\n        let backgroundColor, borderColor;\r\n        switch (type) {\r\n            case 'warning':\r\n                backgroundColor = 'rgba(255, 204, 0, 0.1)';\r\n                borderColor = 'rgba(255, 204, 0, 0.5)';\r\n                break;\r\n            case 'error':\r\n                backgroundColor = 'rgba(255, 48, 48, 0.1)';\r\n                borderColor = 'rgba(255, 48, 48, 0.5)';\r\n                break;\r\n            case 'success':\r\n                backgroundColor = 'rgba(95, 255, 143, 0.1)';\r\n                borderColor = 'rgba(95, 255, 143, 0.5)';\r\n                break;\r\n            default: // info\r\n                backgroundColor = 'rgba(120, 220, 232, 0.1)';\r\n                borderColor = 'rgba(120, 220, 232, 0.5)';\r\n        }\r\n\r\n        HUDStyles.applyStyles(notification, {\r\n            padding: '8px 15px',\r\n            backgroundColor: backgroundColor,\r\n            backdropFilter: 'blur(5px)',\r\n            borderRadius: '5px',\r\n            border: `1px solid ${borderColor}`,\r\n            fontSize: '14px',\r\n            color: 'rgba(255, 255, 255, 0.9)',\r\n            textAlign: 'center',\r\n            animation: 'fadeIn 0.3s ease-in-out',\r\n            marginBottom: '5px',\r\n            maxWidth: '300px',\r\n            wordWrap: 'break-word'\r\n        });\r\n\r\n        notification.textContent = message;\r\n        notificationsArea.appendChild(notification);\r\n\r\n        // Add fade-in animation\r\n        const fadeInStyle = document.createElement('style');\r\n        fadeInStyle.textContent = `\r\n            @keyframes fadeIn {\r\n                from { opacity: 0; transform: translateY(-10px); }\r\n                to { opacity: 1; transform: translateY(0); }\r\n            }\r\n            @keyframes fadeOut {\r\n                from { opacity: 1; transform: translateY(0); }\r\n                to { opacity: 0; transform: translateY(-10px); }\r\n            }\r\n        `;\r\n        document.head.appendChild(fadeInStyle);\r\n\r\n        // Remove notification after duration\r\n        setTimeout(() => {\r\n            notification.style.animation = 'fadeOut 0.3s ease-in-out';\r\n            setTimeout(() => {\r\n                if (notification.parentNode) {\r\n                    notification.parentNode.removeChild(notification);\r\n                }\r\n            }, 300);\r\n        }, duration);\r\n    }\r\n\r\n    /**\r\n     * Show a critical alert that requires attention\r\n     */\r\n    static showCriticalAlert(message) {\r\n        HUDNotifications.showNotification(message, 'error', 5000);\r\n        \r\n        // Add screen flash effect for critical alerts\r\n        const flashOverlay = document.createElement('div');\r\n        HUDStyles.applyStyles(flashOverlay, {\r\n            position: 'fixed',\r\n            top: '0',\r\n            left: '0',\r\n            width: '100%',\r\n            height: '100%',\r\n            backgroundColor: 'rgba(255, 0, 0, 0.1)',\r\n            pointerEvents: 'none',\r\n            zIndex: '9999',\r\n            animation: 'flash 0.5s ease-in-out'\r\n        });\r\n\r\n        const flashStyle = document.createElement('style');\r\n        flashStyle.textContent = `\r\n            @keyframes flash {\r\n                0% { opacity: 0; }\r\n                50% { opacity: 1; }\r\n                100% { opacity: 0; }\r\n            }\r\n        `;\r\n        document.head.appendChild(flashStyle);\r\n\r\n        document.body.appendChild(flashOverlay);\r\n\r\n        setTimeout(() => {\r\n            if (flashOverlay.parentNode) {\r\n                flashOverlay.parentNode.removeChild(flashOverlay);\r\n            }\r\n            if (flashStyle.parentNode) {\r\n                flashStyle.parentNode.removeChild(flashStyle);\r\n            }\r\n        }, 500);\r\n    }\r\n}","// statusIndicators.js - Various status indicators (shields, weapons, targeting system, etc.)\r\n\r\nimport { HUDStyles } from './styles.js';\r\n\r\nexport class HUDStatusIndicators {\r\n    static createTargetingSystem(parent) {\r\n        // Main crosshair container\r\n        const targetingSystem = document.createElement('div');\r\n        targetingSystem.id = 'targeting-system';\r\n        HUDStyles.applyStyles(targetingSystem, {\r\n            position: 'absolute',\r\n            top: '50%',\r\n            left: '50%',\r\n            transform: 'translate(-50%, -50%)',\r\n            width: '100px',\r\n            height: '100px',\r\n            zIndex: '100'\r\n        });\r\n        parent.appendChild(targetingSystem);\r\n        \r\n        // Crosshair - create using SVG for more precise styling\r\n        const crosshair = document.createElement('div');\r\n        crosshair.id = 'crosshair';\r\n        HUDStyles.applyStyles(crosshair, {\r\n            position: 'absolute',\r\n            top: '50%',\r\n            left: '50%',\r\n            transform: 'translate(-50%, -50%)',\r\n            width: '50px',\r\n            height: '50px'\r\n        });\r\n        \r\n        // SVG crosshair\r\n        crosshair.innerHTML = `\r\n            <svg width=\"50\" height=\"50\" viewBox=\"0 0 50 50\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                <circle cx=\"25\" cy=\"25\" r=\"20\" stroke=\"rgba(120, 220, 232, 0.5)\" stroke-width=\"1\" stroke-dasharray=\"8 4\"/>\r\n                <circle cx=\"25\" cy=\"25\" r=\"3\" stroke=\"rgba(120, 220, 232, 0.8)\" stroke-width=\"1\"/>\r\n                <circle cx=\"25\" cy=\"25\" r=\"1\" fill=\"rgba(120, 220, 232, 0.8)\"/>\r\n                <line x1=\"25\" y1=\"10\" x2=\"25\" y2=\"18\" stroke=\"rgba(120, 220, 232, 0.8)\" stroke-width=\"1\"/>\r\n                <line x1=\"25\" y1=\"32\" x2=\"25\" y2=\"40\" stroke=\"rgba(120, 220, 232, 0.8)\" stroke-width=\"1\"/>\r\n                <line x1=\"10\" y1=\"25\" x2=\"18\" y2=\"25\" stroke=\"rgba(120, 220, 232, 0.8)\" stroke-width=\"1\"/>\r\n                <line x1=\"32\" y1=\"25\" x2=\"40\" y2=\"25\" stroke=\"rgba(120, 220, 232, 0.8)\" stroke-width=\"1\"/>\r\n                <!-- Add a pulsing animation to the outer circle -->\r\n                <circle cx=\"25\" cy=\"25\" r=\"24\" stroke=\"rgba(120, 220, 232, 0.3)\" stroke-width=\"1\">\r\n                    <animate attributeName=\"r\" values=\"24;28;24\" dur=\"3s\" repeatCount=\"indefinite\"/>\r\n                    <animate attributeName=\"opacity\" values=\"0.3;0.1;0.3\" dur=\"3s\" repeatCount=\"indefinite\"/>\r\n                </circle>\r\n            </svg>\r\n        `;\r\n        \r\n        targetingSystem.appendChild(crosshair);\r\n        \r\n        // Target info display that appears when targeting something\r\n        HUDStatusIndicators.createTargetInfoDisplay(parent);\r\n        \r\n        // Laser beam\r\n        HUDStatusIndicators.createLaserBeam(parent);\r\n        \r\n        return targetingSystem;\r\n    }\r\n\r\n    static createTargetInfoDisplay(parent) {\r\n        const targetInfo = document.createElement('div');\r\n        targetInfo.id = 'target-info';\r\n        targetInfo.className = 'hud-panel';\r\n        \r\n        // Detect mobile device and position accordingly\r\n        const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) ||\r\n                          (navigator.maxTouchPoints && navigator.maxTouchPoints > 2) ||\r\n                          window.innerWidth <= 768;\r\n        \r\n        const positionStyles = isMobile ? {\r\n            bottom: '15px',\r\n            top: 'auto'\r\n        } : {\r\n            top: '15px',\r\n            bottom: 'auto'\r\n        };\r\n\r\n        HUDStyles.applyStyles(targetInfo, {\r\n            position: 'fixed',\r\n            left: '50%',\r\n            transform: 'translateX(-50%)',\r\n            width: '280px',\r\n            padding: '10px 15px',\r\n            backgroundColor: 'rgba(6, 22, 31, 0.7)',\r\n            backdropFilter: 'blur(5px)',\r\n            borderRadius: '8px',\r\n            fontSize: '14px',\r\n            color: 'rgba(120, 220, 232, 0.9)',\r\n            border: '1px solid rgba(120, 220, 232, 0.3)',\r\n            boxShadow: '0 0 15px rgba(120, 220, 232, 0.2)',\r\n            textAlign: 'center',\r\n            display: 'none',\r\n            zIndex: '999',\r\n            fontFamily: '\"Rajdhani\", \"Electrolize\", sans-serif',\r\n            ...positionStyles\r\n        });\r\n        \r\n        parent.appendChild(targetInfo);\r\n        \r\n        // Add decorative corner elements to match other HUD panels\r\n        HUDStyles.addCornerElements(targetInfo);\r\n        \r\n        // Target info content - simplified for less clutter\r\n        targetInfo.innerHTML = `\r\n            <div id=\"target-name\" style=\"font-weight:600; margin-bottom:5px;\">NO TARGET</div>\r\n            <div id=\"target-distance\" style=\"margin-bottom:0;\">DISTANCE: ---</div>\r\n        `;\r\n        \r\n        return targetInfo;\r\n    }\r\n\r\n    static createLaserBeam(parent) {\r\n        const laserBeam = document.createElement('div');\r\n        laserBeam.id = 'laser-beam';\r\n        HUDStyles.applyStyles(laserBeam, {\r\n            position: 'absolute',\r\n            top: '50%',\r\n            left: '50%',\r\n            width: '0px',\r\n            height: '2px',\r\n            backgroundColor: 'rgba(255, 50, 50, 0.8)',\r\n            boxShadow: '0 0 10px rgba(255, 50, 50, 0.8)',\r\n            transformOrigin: 'left',\r\n            transform: 'rotate(var(--angle, 0deg))',\r\n            zIndex: '90',\r\n            display: 'none'\r\n        });\r\n        parent.appendChild(laserBeam);\r\n        \r\n        return laserBeam;\r\n    }\r\n\r\n    static createScanlineEffect(parent) {\r\n        // Scanline effect disabled - returning null\r\n        return null;\r\n        \r\n        // Original scanline code commented out:\r\n        /*\r\n        // Scanline effect overlay\r\n        const scanlineEffect = document.createElement('div');\r\n        scanlineEffect.id = 'scanline-effect';\r\n        HUDStyles.applyStyles(scanlineEffect, HUDStyles.getScanlineEffectStyles());\r\n        parent.appendChild(scanlineEffect);\r\n        \r\n        // Add subtle scan line that moves\r\n        const activeScanline = document.createElement('div');\r\n        activeScanline.id = 'active-scanline';\r\n        HUDStyles.applyStyles(activeScanline, HUDStyles.getActiveScanlineStyles());\r\n        parent.appendChild(activeScanline);\r\n        \r\n        return activeScanline;\r\n        */\r\n    }\r\n\r\n    /**\r\n     * Update shield display with current shield status\r\n     */\r\n    static updateShieldDisplay(spaceship) {\r\n        const shieldBar = document.getElementById('shield-bar');\r\n        if (!shieldBar) return;\r\n        \r\n        let shieldPercentage = 100;\r\n        let shieldFound = false;\r\n        \r\n        // Try to directly access player's health component\r\n        try {\r\n            if (window.game && window.game.world) {\r\n                const players = window.game.world.getEntitiesByTag('player');\r\n                if (players && players.length > 0) {\r\n                    const player = players[0];\r\n                    const health = player.getComponent('HealthComponent');\r\n                    \r\n                    if (health) {\r\n                        shieldPercentage = health.getShieldPercentage();\r\n                        \r\n                        // Ensure spaceship object is in sync with the HealthComponent\r\n                        if (spaceship) {\r\n                            // If HealthComponent shield is higher, use that value\r\n                            if (health.shield > spaceship.shield) {\r\n                                spaceship.shield = health.shield;\r\n                                spaceship.maxShield = health.maxShield;\r\n                            } \r\n                            // If spaceship shield is higher (e.g., after repair), update health component\r\n                            else if (spaceship.shield > health.shield) {\r\n                                health.shield = spaceship.shield;\r\n                                console.log(`Updated HealthComponent shield from spaceship: ${health.shield}`);\r\n                                // Recalculate shield percentage\r\n                                shieldPercentage = health.getShieldPercentage();\r\n                            }\r\n                        }\r\n                        \r\n                        shieldFound = true;\r\n                    }\r\n                }\r\n            }\r\n        } catch (e) {\r\n            console.error(\"Error accessing player shield component:\", e);\r\n        }\r\n        \r\n        // Fallback to spaceship object if health component not found\r\n        if (!shieldFound && spaceship && spaceship.shield !== undefined) {\r\n            shieldPercentage = (spaceship.shield / spaceship.maxShield) * 100;\r\n        }\r\n        \r\n        // Update the shield bar\r\n        shieldBar.style.width = `${shieldPercentage}%`;\r\n        \r\n        // Change color based on shield status\r\n        if (shieldPercentage < 25) {\r\n            shieldBar.style.backgroundColor = 'rgba(255, 80, 80, 0.8)'; // Red for low shields\r\n        } else if (shieldPercentage < 50) {\r\n            shieldBar.style.backgroundColor = 'rgba(255, 204, 0, 0.8)'; // Yellow for medium shields\r\n        } else {\r\n            shieldBar.style.backgroundColor = 'rgba(51, 153, 255, 0.8)'; // Blue for healthy shields\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Update hull display with current hull status\r\n     */\r\n    static updateHullDisplay(spaceship) {\r\n        const hullBar = document.getElementById('hull-bar');\r\n        if (!hullBar) return;\r\n        \r\n        let hullPercentage = 100;\r\n        let healthFound = false;\r\n        \r\n        // Try to directly access player's health component\r\n        try {\r\n            if (window.game && window.game.world) {\r\n                const players = window.game.world.getEntitiesByTag('player');\r\n                if (players && players.length > 0) {\r\n                    const player = players[0];\r\n                    const health = player.getComponent('HealthComponent');\r\n                    \r\n                    if (health) {\r\n                        hullPercentage = health.getHealthPercentage();\r\n                        \r\n                        // Ensure spaceship object is in sync with the HealthComponent\r\n                        if (spaceship) {\r\n                            // If HealthComponent health is higher, use that value\r\n                            if (health.health > spaceship.hull) {\r\n                                spaceship.hull = health.health;\r\n                                spaceship.maxHull = health.maxHealth;\r\n                            }\r\n                            // If spaceship hull is higher (e.g., after repair), update health component\r\n                            else if (spaceship.hull > health.health) {\r\n                                health.health = spaceship.hull;\r\n                                console.log(`Updated HealthComponent health from spaceship: ${health.health}`);\r\n                                // Recalculate hull percentage\r\n                                hullPercentage = health.getHealthPercentage();\r\n                            }\r\n                        }\r\n                        \r\n                        healthFound = true;\r\n                    }\r\n                }\r\n            }\r\n        } catch (e) {\r\n            console.error(\"Error accessing player health component:\", e);\r\n        }\r\n        \r\n        // Fallback to spaceship object if health component not found\r\n        if (!healthFound && spaceship && spaceship.hull !== undefined) {\r\n            hullPercentage = (spaceship.hull / spaceship.maxHull) * 100;\r\n        }\r\n        \r\n        // Update the hull bar\r\n        hullBar.style.width = `${hullPercentage}%`;\r\n        \r\n        // Change color based on hull status\r\n        if (hullPercentage < 30) {\r\n            hullBar.style.backgroundColor = 'rgba(255, 80, 80, 0.8)';\r\n        } else if (hullPercentage < 60) {\r\n            hullBar.style.backgroundColor = 'rgba(255, 204, 0, 0.8)';\r\n        } else {\r\n            hullBar.style.backgroundColor = 'rgba(120, 220, 232, 0.8)';\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Update fuel display with current fuel status\r\n     */\r\n    static updateFuelDisplay(spaceship) {\r\n        const fuelBar = document.getElementById('fuel-bar');\r\n        const fuelValue = document.getElementById('fuel-value');\r\n        if (!fuelBar || !spaceship) return;\r\n        \r\n        // Correctly calculate fuel percentage based on maxFuel\r\n        const fuelPercent = spaceship.maxFuel > 0 ? \r\n            (spaceship.fuel / spaceship.maxFuel) * 100 : 0;\r\n        \r\n        fuelBar.style.width = `${fuelPercent}%`;\r\n        \r\n        // Change color based on fuel level\r\n        if (fuelPercent < 20) {\r\n            fuelBar.style.backgroundColor = 'rgba(255, 80, 80, 0.8)';\r\n        } else if (fuelPercent < 40) {\r\n            fuelBar.style.backgroundColor = 'rgba(255, 204, 0, 0.8)';\r\n        } else {\r\n            fuelBar.style.backgroundColor = 'rgba(120, 220, 232, 0.8)';\r\n        }\r\n        \r\n        // Update text display if it exists\r\n        if (fuelValue) {\r\n            fuelValue.textContent = `${Math.round(spaceship.fuel)} / ${Math.round(spaceship.maxFuel)}`;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Update credits display\r\n     */\r\n    static updateCreditsDisplay(spaceship) {\r\n        const creditsDisplay = document.getElementById('credits-value');\r\n        if (creditsDisplay && spaceship) {\r\n            creditsDisplay.textContent = `${spaceship.credits} CR`;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Update location coordinates display\r\n     */\r\n    static updateCoordinates(x, y, z) {\r\n        const coordsElement = document.getElementById('location-coordinates');\r\n        if (coordsElement) {\r\n            coordsElement.textContent = `X: ${Math.round(x)} Y: ${Math.round(y)} Z: ${Math.round(z)}`;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Update FPS display\r\n     */\r\n    static updateFPS(fps, cap) {\r\n        const fpsElement = document.getElementById('fps-display');\r\n        if (fpsElement) {\r\n            if (cap) {\r\n                // Show actual FPS and the cap\r\n                fpsElement.textContent = `FPS: ${Math.round(fps)}/${cap}`;\r\n                \r\n                // Color code based on performance relative to cap\r\n                if (fps < cap * 0.9) {\r\n                    // Below 90% of target - indicate performance issues\r\n                    fpsElement.style.color = \"rgba(255, 120, 120, 0.9)\";\r\n                } else {\r\n                    // Normal performance - standard color\r\n                    fpsElement.style.color = \"rgba(120, 220, 232, 0.8)\";\r\n                }\r\n            } else {\r\n                // Just show FPS for uncapped mode\r\n                fpsElement.textContent = `FPS: ${Math.round(fps)}`;\r\n                fpsElement.style.color = \"rgba(120, 220, 232, 0.8)\";\r\n            }\r\n            \r\n            // Add auto indicator if using monitor refresh rate\r\n            if (window.game && \r\n                window.game.ui && \r\n                window.game.ui.settings && \r\n                window.game.ui.settings.settings.frameRateCap === 'auto') {\r\n                \r\n                const refreshRate = window.game.ui.settings.monitorRefreshRate || 60;\r\n                \r\n                if (cap > 0) {\r\n                    // Show it's using auto mode with the detected refresh rate\r\n                    fpsElement.textContent = `FPS: ${Math.round(fps)}/${cap} (Auto)`;\r\n                } else {\r\n                    // Using unlimited because refresh rate is high\r\n                    fpsElement.textContent = `FPS: ${Math.round(fps)} (Auto: Unlimited)`;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Update location display\r\n     */\r\n    static updateLocation(locationName, systemName = 'Unknown System') {\r\n        const currentSystem = document.getElementById('current-system');\r\n        \r\n        if (currentSystem) {\r\n            currentSystem.textContent = systemName.toUpperCase();\r\n        }\r\n    }\r\n}","// eventHandlers.js - Event handling and updates for HUD components\r\n\r\nimport { HUDStyles } from './styles.js';\r\n\r\nexport class HUDEventHandlers {\r\n    constructor() {\r\n        this.animationFrames = [];\r\n        this.glitchInterval = null;\r\n        this.scanline = null;\r\n    }\r\n\r\n    /**\r\n     * Initialize startup animation and effects\r\n     */\r\n    animateHudIn() {\r\n        // Add glitch effect for initialization\r\n        this.addStartupGlitchEffect();\r\n        \r\n        // Animate scanlines\r\n        setTimeout(() => {\r\n            if (this.scanline) {\r\n                this.animateScanline();\r\n            }\r\n        }, 1500);\r\n    }\r\n\r\n    /**\r\n     * Add startup glitch effect to show HUD is initializing\r\n     */\r\n    addStartupGlitchEffect() {\r\n        const hudContainer = document.getElementById('hud-container');\r\n        if (!hudContainer) return;\r\n        \r\n        // Incremental fade-in with glitches\r\n        setTimeout(() => {\r\n            hudContainer.style.opacity = '0.3';\r\n            this.addGlitch(hudContainer);\r\n        }, 300);\r\n        \r\n        setTimeout(() => {\r\n            hudContainer.style.opacity = '0.7';\r\n            this.addGlitch(hudContainer);\r\n        }, 800);\r\n        \r\n        setTimeout(() => {\r\n            hudContainer.style.opacity = '1';\r\n            this.addGlitch(hudContainer);\r\n        }, 1200);\r\n        \r\n        // Start random glitch effects at intervals\r\n        this.glitchInterval = setInterval(() => {\r\n            if (Math.random() > 0.7) {\r\n                this.addGlitch(hudContainer);\r\n            }\r\n        }, 5000);\r\n    }\r\n\r\n    /**\r\n     * Add glitch effect to an element\r\n     */\r\n    addGlitch(element) {\r\n        // Create a temporary animation\r\n        const animationName = HUDStyles.createGlitchAnimation();\r\n        \r\n        // Apply animation\r\n        element.style.animation = `${animationName} 1s forwards`;\r\n        \r\n        // Remove animation after it's complete\r\n        setTimeout(() => {\r\n            element.style.animation = '';\r\n            // Find and remove the style element\r\n            const styles = document.querySelectorAll('style');\r\n            styles.forEach(style => {\r\n                if (style.textContent.includes(animationName)) {\r\n                    style.remove();\r\n                }\r\n            });\r\n        }, 1000);\r\n    }\r\n\r\n    /**\r\n     * Animate the scanline moving down the screen\r\n     */\r\n    animateScanline() {\r\n        let position = 0;\r\n        const height = window.innerHeight;\r\n        \r\n        const moveScanline = () => {\r\n            if (!this.scanline) return;\r\n            position = (position + 2) % height;\r\n            this.scanline.style.top = `${position}px`;\r\n            \r\n            // Add random flicker\r\n            if (Math.random() > 0.97) {\r\n                this.scanline.style.opacity = '0';\r\n                setTimeout(() => {\r\n                    if (this.scanline) {\r\n                        this.scanline.style.opacity = '0.7';\r\n                    }\r\n                }, 50);\r\n            }\r\n            \r\n            this.animationFrames.push(requestAnimationFrame(moveScanline));\r\n        };\r\n        \r\n        moveScanline();\r\n    }\r\n\r\n    /**\r\n     * Set the scanline element reference\r\n     */\r\n    setScanline(scanlineElement) {\r\n        this.scanline = scanlineElement;\r\n    }\r\n\r\n    /**\r\n     * Handle location changes with glitch effect\r\n     */\r\n    handleLocationChange(locationName, systemName) {\r\n        const locationPanel = document.getElementById('location-panel');\r\n        if (locationPanel) {\r\n            this.addGlitch(locationPanel);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Show HUD with animations\r\n     */\r\n    show() {\r\n        const hudContainer = document.getElementById('hud-container');\r\n        if (hudContainer) {\r\n            hudContainer.style.opacity = '1';\r\n        }\r\n        \r\n        // Restart scanline animation\r\n        if (this.scanline) {\r\n            this.animateScanline();\r\n        }\r\n        \r\n        // Restart glitch interval\r\n        if (!this.glitchInterval) {\r\n            this.glitchInterval = setInterval(() => {\r\n                if (Math.random() > 0.7) {\r\n                    this.addGlitch(hudContainer);\r\n                }\r\n            }, 5000);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Hide HUD\r\n     */\r\n    hide() {\r\n        const hudContainer = document.getElementById('hud-container');\r\n        if (hudContainer) {\r\n            hudContainer.style.opacity = '0';\r\n        }\r\n        \r\n        // Clear animation frames\r\n        this.animationFrames.forEach(frame => cancelAnimationFrame(frame));\r\n        this.animationFrames = [];\r\n        \r\n        // Clear glitch interval\r\n        if (this.glitchInterval) {\r\n            clearInterval(this.glitchInterval);\r\n            this.glitchInterval = null;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Clean up resources and event listeners\r\n     */\r\n    destroy() {\r\n        // Cancel any active animation frames\r\n        this.animationFrames.forEach(frameId => {\r\n            cancelAnimationFrame(frameId);\r\n        });\r\n        this.animationFrames = [];\r\n        \r\n        // Clear intervals\r\n        if (this.glitchInterval) {\r\n            clearInterval(this.glitchInterval);\r\n            this.glitchInterval = null;\r\n        }\r\n        \r\n        // Remove DOM event listeners\r\n        const controls = document.getElementById('show-controls');\r\n        if (controls) {\r\n            controls.removeEventListener('click', controls.clickHandler);\r\n            controls.removeEventListener('mouseover', controls.mouseoverHandler);\r\n            controls.removeEventListener('mouseout', controls.mouseoutHandler);\r\n        }\r\n        \r\n        // Clear references\r\n        this.scanline = null;\r\n    }\r\n\r\n    /**\r\n     * Handle window resize events\r\n     */\r\n    handleResize() {\r\n        // Update scanline animation bounds if needed\r\n        if (this.scanline) {\r\n            // Restart scanline animation with new dimensions\r\n            this.animateScanline();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Handle performance monitoring\r\n     */\r\n    handlePerformanceUpdate(fps, frameTime) {\r\n        // Could add performance-based UI adjustments here\r\n        // For example, reduce effects if FPS is low\r\n        if (fps < 30) {\r\n            // Reduce glitch frequency if performance is poor\r\n            if (this.glitchInterval) {\r\n                clearInterval(this.glitchInterval);\r\n                this.glitchInterval = setInterval(() => {\r\n                    if (Math.random() > 0.9) { // Less frequent\r\n                        this.addGlitch(document.getElementById('hud-container'));\r\n                    }\r\n                }, 10000); // Less often\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Handle game state changes\r\n     */\r\n    handleGameStateChange(newState, oldState) {\r\n        // React to game state changes with appropriate HUD updates\r\n        switch (newState) {\r\n            case 'playing':\r\n                this.show();\r\n                break;\r\n            case 'paused':\r\n                // Maybe dim the HUD slightly\r\n                const hudContainer = document.getElementById('hud-container');\r\n                if (hudContainer) {\r\n                    hudContainer.style.opacity = '0.5';\r\n                }\r\n                break;\r\n            case 'game-over':\r\n                this.hide();\r\n                break;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Handle critical events that need immediate visual feedback\r\n     */\r\n    handleCriticalEvent(eventType, data) {\r\n        const hudContainer = document.getElementById('hud-container');\r\n        \r\n        switch (eventType) {\r\n            case 'low-health':\r\n                // Flash red for low health\r\n                if (hudContainer) {\r\n                    hudContainer.style.filter = 'hue-rotate(0deg) saturate(1.5)';\r\n                    setTimeout(() => {\r\n                        hudContainer.style.filter = 'none';\r\n                    }, 200);\r\n                }\r\n                break;\r\n            case 'shield-down':\r\n                // Flash blue for shield failure\r\n                if (hudContainer) {\r\n                    hudContainer.style.filter = 'hue-rotate(240deg) saturate(1.5)';\r\n                    setTimeout(() => {\r\n                        hudContainer.style.filter = 'none';\r\n                    }, 300);\r\n                }\r\n                break;\r\n            case 'low-fuel':\r\n                // Flash yellow for low fuel\r\n                if (hudContainer) {\r\n                    hudContainer.style.filter = 'hue-rotate(60deg) saturate(1.5)';\r\n                    setTimeout(() => {\r\n                        hudContainer.style.filter = 'none';\r\n                    }, 250);\r\n                }\r\n                break;\r\n        }\r\n    }\r\n}","// helpers.js - Utility functions and formatting for HUD components\r\n\r\nexport class HUDHelpers {\r\n    /**\r\n     * Format a number with appropriate units (K, M, B)\r\n     */\r\n    static formatNumber(num) {\r\n        if (num >= 1000000000) {\r\n            return (num / 1000000000).toFixed(1) + 'B';\r\n        }\r\n        if (num >= 1000000) {\r\n            return (num / 1000000).toFixed(1) + 'M';\r\n        }\r\n        if (num >= 1000) {\r\n            return (num / 1000).toFixed(1) + 'K';\r\n        }\r\n        return num.toString();\r\n    }\r\n\r\n    /**\r\n     * Format time in MM:SS format\r\n     */\r\n    static formatTime(milliseconds) {\r\n        const totalSeconds = Math.floor(milliseconds / 1000);\r\n        const minutes = Math.floor(totalSeconds / 60);\r\n        const seconds = totalSeconds % 60;\r\n        return `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;\r\n    }\r\n\r\n    /**\r\n     * Format coordinates for display\r\n     */\r\n    static formatCoordinates(x, y, z) {\r\n        return `X: ${Math.round(x)} Y: ${Math.round(y)} Z: ${Math.round(z)}`;\r\n    }\r\n\r\n    /**\r\n     * Format distance with appropriate units\r\n     */\r\n    static formatDistance(distance) {\r\n        if (distance >= 1000) {\r\n            return `${(distance / 1000).toFixed(1)} km`;\r\n        }\r\n        return `${Math.round(distance)} m`;\r\n    }\r\n\r\n    /**\r\n     * Format percentage for display\r\n     */\r\n    static formatPercentage(value, maxValue) {\r\n        if (maxValue === 0) return 0;\r\n        return Math.round((value / maxValue) * 100);\r\n    }\r\n\r\n    /**\r\n     * Get color based on percentage value (green to red)\r\n     */\r\n    static getStatusColor(percentage) {\r\n        if (percentage >= 75) {\r\n            return 'rgba(95, 255, 143, 0.8)'; // Green\r\n        } else if (percentage >= 50) {\r\n            return 'rgba(255, 255, 95, 0.8)'; // Yellow\r\n        } else if (percentage >= 25) {\r\n            return 'rgba(255, 204, 0, 0.8)'; // Orange\r\n        } else {\r\n            return 'rgba(255, 80, 80, 0.8)'; // Red\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Get fuel color based on fuel level\r\n     */\r\n    static getFuelColor(fuelPercent) {\r\n        if (fuelPercent < 20) {\r\n            return 'rgba(255, 80, 80, 0.8)'; // Red for critical\r\n        } else if (fuelPercent < 40) {\r\n            return 'rgba(255, 204, 0, 0.8)'; // Yellow for low\r\n        } else {\r\n            return 'rgba(120, 220, 232, 0.8)'; // Blue for normal\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Get shield color based on shield level\r\n     */\r\n    static getShieldColor(shieldPercent) {\r\n        if (shieldPercent < 25) {\r\n            return 'rgba(255, 80, 80, 0.8)'; // Red for low shields\r\n        } else if (shieldPercent < 50) {\r\n            return 'rgba(255, 204, 0, 0.8)'; // Yellow for medium shields\r\n        } else {\r\n            return 'rgba(51, 153, 255, 0.8)'; // Blue for healthy shields\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Get hull color based on hull integrity\r\n     */\r\n    static getHullColor(hullPercent) {\r\n        if (hullPercent < 30) {\r\n            return 'rgba(255, 80, 80, 0.8)'; // Red for critical damage\r\n        } else if (hullPercent < 60) {\r\n            return 'rgba(255, 204, 0, 0.8)'; // Yellow for damaged\r\n        } else {\r\n            return 'rgba(120, 220, 232, 0.8)'; // Blue for intact\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Check if device is mobile\r\n     */\r\n    static isMobileDevice() {\r\n        return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) ||\r\n               (navigator.maxTouchPoints && navigator.maxTouchPoints > 2) ||\r\n               window.innerWidth <= 768;\r\n    }\r\n\r\n    /**\r\n     * Clamp a value between min and max\r\n     */\r\n    static clamp(value, min, max) {\r\n        return Math.min(Math.max(value, min), max);\r\n    }\r\n\r\n    /**\r\n     * Linear interpolation between two values\r\n     */\r\n    static lerp(start, end, factor) {\r\n        return start + (end - start) * factor;\r\n    }\r\n\r\n    /**\r\n     * Convert degrees to radians\r\n     */\r\n    static degToRad(degrees) {\r\n        return degrees * (Math.PI / 180);\r\n    }\r\n\r\n    /**\r\n     * Convert radians to degrees\r\n     */\r\n    static radToDeg(radians) {\r\n        return radians * (180 / Math.PI);\r\n    }\r\n\r\n    /**\r\n     * Get resource icon color based on type\r\n     */\r\n    static getResourceColor(resourceType) {\r\n        switch (resourceType.toLowerCase()) {\r\n            case 'iron':\r\n                return 'rgba(180, 180, 180, 0.8)';\r\n            case 'gold':\r\n                return 'rgba(255, 215, 0, 0.8)';\r\n            case 'platinum':\r\n                return 'rgba(229, 228, 226, 0.8)';\r\n            case 'titanium':\r\n                return 'rgba(135, 135, 135, 0.8)';\r\n            case 'uranium':\r\n                return 'rgba(0, 255, 0, 0.8)';\r\n            default:\r\n                return 'rgba(120, 220, 232, 0.8)';\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Generate a random ID for temporary elements\r\n     */\r\n    static generateId(prefix = 'hud') {\r\n        return `${prefix}-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\r\n    }\r\n\r\n    /**\r\n     * Debounce function to limit how often a function can be called\r\n     */\r\n    static debounce(func, wait) {\r\n        let timeout;\r\n        return function executedFunction(...args) {\r\n            const later = () => {\r\n                clearTimeout(timeout);\r\n                func(...args);\r\n            };\r\n            clearTimeout(timeout);\r\n            timeout = setTimeout(later, wait);\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Throttle function to limit how often a function can be called\r\n     */\r\n    static throttle(func, limit) {\r\n        let inThrottle;\r\n        return function() {\r\n            const args = arguments;\r\n            const context = this;\r\n            if (!inThrottle) {\r\n                func.apply(context, args);\r\n                inThrottle = true;\r\n                setTimeout(() => inThrottle = false, limit);\r\n            }\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Safe access to nested object properties\r\n     */\r\n    static safeGet(obj, path, defaultValue = null) {\r\n        try {\r\n            return path.split('.').reduce((current, key) => current[key], obj) ?? defaultValue;\r\n        } catch {\r\n            return defaultValue;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Check if an element is visible in the viewport\r\n     */\r\n    static isElementVisible(element) {\r\n        if (!element) return false;\r\n        \r\n        const rect = element.getBoundingClientRect();\r\n        return (\r\n            rect.top >= 0 &&\r\n            rect.left >= 0 &&\r\n            rect.bottom <= (window.innerHeight || document.documentElement.clientHeight) &&\r\n            rect.right <= (window.innerWidth || document.documentElement.clientWidth)\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Get the current game state safely\r\n     */\r\n    static getGameState() {\r\n        return HUDHelpers.safeGet(window, 'game.state', 'unknown');\r\n    }\r\n\r\n    /**\r\n     * Get player data safely\r\n     */\r\n    static getPlayerData() {\r\n        try {\r\n            if (window.game && window.game.world) {\r\n                const players = window.game.world.getEntitiesByTag('player');\r\n                return players && players.length > 0 ? players[0] : null;\r\n            }\r\n        } catch (e) {\r\n            console.error('Error accessing player data:', e);\r\n        }\r\n        return null;\r\n    }\r\n\r\n    /**\r\n     * Get player health component safely\r\n     */\r\n    static getPlayerHealthComponent() {\r\n        const player = HUDHelpers.getPlayerData();\r\n        if (player) {\r\n            try {\r\n                return player.getComponent('HealthComponent');\r\n            } catch (e) {\r\n                console.error('Error accessing health component:', e);\r\n            }\r\n        }\r\n        return null;\r\n    }\r\n\r\n    /**\r\n     * Validate and sanitize user input\r\n     */\r\n    static sanitizeString(str) {\r\n        if (typeof str !== 'string') return '';\r\n        return str.replace(/[<>'\"&]/g, '');\r\n    }\r\n\r\n    /**\r\n     * Check if a value is numeric\r\n     */\r\n    static isNumeric(value) {\r\n        return !isNaN(parseFloat(value)) && isFinite(value);\r\n    }\r\n\r\n    /**\r\n     * Get optimal text color for given background color\r\n     */\r\n    static getOptimalTextColor(backgroundColor) {\r\n        // Simple luminance calculation to determine if text should be light or dark\r\n        const rgb = backgroundColor.match(/\\d+/g);\r\n        if (rgb && rgb.length >= 3) {\r\n            const luminance = (0.299 * rgb[0] + 0.587 * rgb[1] + 0.114 * rgb[2]) / 255;\r\n            return luminance > 0.5 ? '#000000' : '#ffffff';\r\n        }\r\n        return '#ffffff'; // Default to white\r\n    }\r\n}","// hud.js - Refactored HUD orchestrator class\r\n\r\nimport { HUDStyles } from './components/hud/styles.js';\r\nimport { HUDDisplays } from './components/hud/displays.js';\r\nimport { HUDNotifications } from './components/hud/notifications.js';\r\nimport { HUDMinimap } from './components/hud/minimap.js';\r\nimport { HUDStatusIndicators } from './components/hud/statusIndicators.js';\r\nimport { HUDEventHandlers } from './components/hud/eventHandlers.js';\r\nimport { HUDHelpers } from './components/hud/helpers.js';\r\n\r\nexport class HUD {\r\n    constructor(spaceship) {\r\n        this.spaceship = spaceship;\r\n        this.eventHandlers = new HUDEventHandlers();\r\n        this.setupHUD();\r\n        this.eventHandlers.animateHudIn();\r\n    }\r\n    \r\n    setupHUD() {\r\n        // Initialize styles first\r\n        HUDStyles.initializeStyles();\r\n        \r\n        // Create main HUD container\r\n        const hudContainer = this.createMainContainer();\r\n        \r\n        // Create scanline effect and get reference\r\n        const scanline = HUDStatusIndicators.createScanlineEffect(hudContainer);\r\n        this.eventHandlers.setScanline(scanline);\r\n        \r\n        // Create all HUD panels\r\n        HUDDisplays.createFlightPanel(hudContainer);\r\n        HUDDisplays.createStatusPanel(hudContainer);\r\n        HUDStatusIndicators.createTargetingSystem(hudContainer);\r\n        HUDDisplays.createLocationPanel(hudContainer);\r\n        HUDDisplays.createResourcePanel(hudContainer);\r\n        HUDNotifications.createNotificationsArea(hudContainer);\r\n    }\r\n    \r\n    createMainContainer() {\r\n        const hudContainer = document.createElement('div');\r\n        hudContainer.id = 'hud-container';\r\n        HUDStyles.applyStyles(hudContainer, HUDStyles.getMainContainerStyles());\r\n        document.body.appendChild(hudContainer);\r\n        return hudContainer;\r\n    }\r\n    \r\n    update() {\r\n        if (!this.spaceship) return;\r\n        \r\n        // Update all status indicators\r\n        HUDStatusIndicators.updateShieldDisplay(this.spaceship);\r\n        HUDStatusIndicators.updateHullDisplay(this.spaceship);\r\n        HUDStatusIndicators.updateFuelDisplay(this.spaceship);\r\n        HUDStatusIndicators.updateCreditsDisplay(this.spaceship);\r\n        \r\n        // Update horde mode display\r\n        HUDNotifications.updateHordeModeDisplay();\r\n    }\r\n    \r\n    updateLocation(locationName, systemName = 'Unknown System') {\r\n        HUDStatusIndicators.updateLocation(locationName, systemName);\r\n        this.eventHandlers.handleLocationChange(locationName, systemName);\r\n    }\r\n    \r\n    updateCoordinates(x, y, z) {\r\n        HUDStatusIndicators.updateCoordinates(x, y, z);\r\n    }\r\n    \r\n    updateFPS(fps, cap) {\r\n        HUDStatusIndicators.updateFPS(fps, cap);\r\n    }\r\n    \r\n    hide() {\r\n        this.eventHandlers.hide();\r\n    }\r\n    \r\n    show() {\r\n        this.eventHandlers.show();\r\n    }\r\n    \r\n    destroy() {\r\n        this.eventHandlers.destroy();\r\n        \r\n        // Remove DOM elements\r\n        const hudContainer = document.getElementById('hud-container');\r\n        if (hudContainer && hudContainer.parentNode) {\r\n            hudContainer.parentNode.removeChild(hudContainer);\r\n        }\r\n        \r\n        // Clear references\r\n        this.spaceship = null;\r\n        this.eventHandlers = null;\r\n    }\r\n    \r\n    // Backward compatibility methods\r\n    updateShieldDisplay() {\r\n        HUDStatusIndicators.updateShieldDisplay(this.spaceship);\r\n    }\r\n    \r\n    updateHullDisplay() {\r\n        HUDStatusIndicators.updateHullDisplay(this.spaceship);\r\n    }\r\n    \r\n    updateHordeModeDisplay() {\r\n        HUDNotifications.updateHordeModeDisplay();\r\n    }\r\n    \r\n    // Utility methods for external access\r\n    showNotification(message, type = 'info', duration = 3000) {\r\n        HUDNotifications.showNotification(message, type, duration);\r\n    }\r\n    \r\n    showCriticalAlert(message) {\r\n        HUDNotifications.showCriticalAlert(message);\r\n    }\r\n    \r\n    // Helper method access\r\n    static get helpers() {\r\n        return HUDHelpers;\r\n    }\r\n}\r\n\r\n// Maintain backward compatibility as default export\r\nexport default HUD;","// mobileHUD.js - Simplified HUD for mobile devices\r\n\r\nexport class MobileHUD {\r\n    constructor(spaceship) {\r\n        this.spaceship = spaceship;\r\n        this.controls = null; // Will be set from UI class\r\n        this.setupMobileHUD();\r\n    }\r\n    \r\n    setupMobileHUD() {\r\n        // Add CSS for animations\r\n        const style = document.createElement('style');\r\n        style.textContent = `\r\n            @keyframes pulse-horde-mobile {\r\n                0% { box-shadow: 0 0 5px rgba(255, 30, 30, 0.5); }\r\n                50% { box-shadow: 0 0 10px rgba(255, 30, 30, 0.8); }\r\n                100% { box-shadow: 0 0 5px rgba(255, 30, 30, 0.5); }\r\n            }\r\n        `;\r\n        document.head.appendChild(style);\r\n        \r\n        // Create main container for mobile HUD\r\n        const hudContainer = document.createElement('div');\r\n        hudContainer.id = 'mobile-hud-container';\r\n        hudContainer.style.position = 'absolute';\r\n        hudContainer.style.top = '10px';\r\n        hudContainer.style.right = '10px';\r\n        hudContainer.style.width = 'min(140px, 25vw)'; // Responsive width with minimum\r\n        hudContainer.style.backgroundColor = 'rgba(6, 22, 31, 0.8)';\r\n        hudContainer.style.backdropFilter = 'blur(5px)';\r\n        hudContainer.style.webkitBackdropFilter = 'blur(5px)'; // For Safari\r\n        hudContainer.style.borderRadius = '8px';\r\n        hudContainer.style.border = '1px solid rgba(120, 220, 232, 0.3)';\r\n        hudContainer.style.padding = '10px';\r\n        hudContainer.style.color = 'rgba(120, 220, 232, 0.9)';\r\n        hudContainer.style.fontFamily = '\"Rajdhani\", \"Electrolize\", sans-serif';\r\n        hudContainer.style.fontSize = '14px';\r\n        hudContainer.style.boxShadow = '0 0 10px rgba(120, 220, 232, 0.2)';\r\n        hudContainer.style.zIndex = '1000';\r\n        // Add hardware acceleration to improve performance\r\n        hudContainer.style.transform = 'translateZ(0)';\r\n        hudContainer.style.backfaceVisibility = 'hidden';\r\n        document.body.appendChild(hudContainer);\r\n\r\n        // Create status bars with labels\r\n        this.createStatusBar(hudContainer, 'S', 'shield-bar-mobile', 'rgba(51, 153, 255, 0.8)');\r\n        this.createStatusBar(hudContainer, 'H', 'hull-bar-mobile', 'rgba(120, 220, 232, 0.8)');\r\n        this.createStatusBar(hudContainer, 'F', 'fuel-bar-mobile', 'rgba(120, 220, 232, 0.8)');\r\n        \r\n        // Add anomaly count display\r\n        this.createAnomalyDisplay(hudContainer);\r\n        \r\n        // Create cargo display\r\n        const cargoContainer = document.createElement('div');\r\n        cargoContainer.style.display = 'flex';\r\n        cargoContainer.style.justifyContent = 'space-between';\r\n        cargoContainer.style.alignItems = 'center';\r\n        cargoContainer.style.marginTop = '10px';\r\n        \r\n        const cargoLabel = document.createElement('div');\r\n        cargoLabel.textContent = 'C';\r\n        cargoLabel.style.marginRight = '10px';\r\n        cargoLabel.style.fontSize = '14px';\r\n        \r\n        const cargoValue = document.createElement('div');\r\n        cargoValue.id = 'cargo-value-mobile';\r\n        cargoValue.textContent = '0 / 1000';\r\n        cargoValue.style.textAlign = 'right';\r\n        cargoValue.style.flexGrow = '1';\r\n        cargoValue.style.fontSize = '14px';\r\n        \r\n        cargoContainer.appendChild(cargoLabel);\r\n        cargoContainer.appendChild(cargoValue);\r\n        hudContainer.appendChild(cargoContainer);\r\n        \r\n        // Add horde mode indicator (hidden by default)\r\n        const hordeContainer = document.createElement('div');\r\n        hordeContainer.id = 'mobile-horde-indicator';\r\n        hordeContainer.style.display = 'none';\r\n        hordeContainer.style.marginTop = '10px';\r\n        hordeContainer.style.padding = '5px';\r\n        hordeContainer.style.backgroundColor = 'rgba(255, 30, 30, 0.2)';\r\n        hordeContainer.style.borderRadius = '4px';\r\n        hordeContainer.style.border = '1px solid #ff3030';\r\n        hordeContainer.style.animation = 'pulse-horde-mobile 2s infinite';\r\n        hordeContainer.style.fontSize = '12px';\r\n        \r\n        const hordeTimer = document.createElement('div');\r\n        hordeTimer.id = 'mobile-horde-timer';\r\n        hordeTimer.textContent = '00:00';\r\n        hordeTimer.style.textAlign = 'center';\r\n        hordeTimer.style.fontWeight = 'bold';\r\n        hordeTimer.style.color = '#ff3030';\r\n        \r\n        hordeContainer.appendChild(hordeTimer);\r\n        hudContainer.appendChild(hordeContainer);\r\n        \r\n        // Add decorative corner elements\r\n        this.addCornerElements(hudContainer);\r\n    }\r\n    \r\n    createStatusBar(parent, label, id, color) {\r\n        const container = document.createElement('div');\r\n        container.style.display = 'flex';\r\n        container.style.alignItems = 'center';\r\n        container.style.marginBottom = '8px';\r\n        \r\n        const labelElement = document.createElement('div');\r\n        labelElement.textContent = label;\r\n        labelElement.style.marginRight = '8px';\r\n        labelElement.style.width = '16px';\r\n        labelElement.style.textAlign = 'center';\r\n        labelElement.style.fontSize = '14px';\r\n        \r\n        const barContainer = document.createElement('div');\r\n        barContainer.style.flexGrow = '1';\r\n        barContainer.style.height = '8px';\r\n        barContainer.style.backgroundColor = 'rgba(10, 30, 40, 0.5)';\r\n        barContainer.style.borderRadius = '4px';\r\n        barContainer.style.overflow = 'hidden';\r\n        barContainer.style.position = 'relative';\r\n        \r\n        // Add fuel value text if this is the fuel bar\r\n        if (id === 'fuel-bar-mobile') {\r\n            const fuelValue = document.createElement('div');\r\n            fuelValue.id = 'fuel-value-mobile';\r\n            fuelValue.style.position = 'absolute';\r\n            fuelValue.style.right = '0';\r\n            fuelValue.style.top = '-14px';\r\n            fuelValue.style.fontSize = '10px';\r\n            fuelValue.style.color = 'rgba(120, 220, 232, 0.9)';\r\n            fuelValue.textContent = '100 / 100';\r\n            barContainer.appendChild(fuelValue);\r\n        }\r\n        \r\n        const bar = document.createElement('div');\r\n        bar.id = id;\r\n        bar.style.width = '100%';\r\n        bar.style.height = '100%';\r\n        bar.style.backgroundColor = color;\r\n        bar.style.transition = 'width 0.2s ease';\r\n        \r\n        barContainer.appendChild(bar);\r\n        container.appendChild(labelElement);\r\n        container.appendChild(barContainer);\r\n        parent.appendChild(container);\r\n    }\r\n    \r\n    createAnomalyDisplay(parent) {\r\n        const anomalyContainer = document.createElement('div');\r\n        anomalyContainer.style.display = 'flex';\r\n        anomalyContainer.style.justifyContent = 'space-between';\r\n        anomalyContainer.style.alignItems = 'center';\r\n        anomalyContainer.style.marginBottom = '8px';\r\n        \r\n        const anomalyLabel = document.createElement('div');\r\n        anomalyLabel.textContent = 'A';\r\n        anomalyLabel.style.marginRight = '8px';\r\n        anomalyLabel.style.width = '16px';\r\n        anomalyLabel.style.textAlign = 'center';\r\n        anomalyLabel.style.fontSize = '14px';\r\n        \r\n        const anomalyCount = document.createElement('div');\r\n        anomalyCount.id = 'anomaly-count-mobile';\r\n        anomalyCount.textContent = '0';\r\n        anomalyCount.style.textAlign = 'right';\r\n        anomalyCount.style.flexGrow = '1';\r\n        anomalyCount.style.fontSize = '14px';\r\n        anomalyCount.style.fontWeight = 'bold';\r\n        anomalyCount.style.color = 'rgba(120, 220, 232, 0.9)';\r\n        \r\n        anomalyContainer.appendChild(anomalyLabel);\r\n        anomalyContainer.appendChild(anomalyCount);\r\n        parent.appendChild(anomalyContainer);\r\n    }\r\n    \r\n    addCornerElements(panel) {\r\n        // Top left corner\r\n        const topLeft = document.createElement('div');\r\n        topLeft.style.position = 'absolute';\r\n        topLeft.style.top = '0';\r\n        topLeft.style.left = '0';\r\n        topLeft.style.width = '6px';\r\n        topLeft.style.height = '6px';\r\n        topLeft.style.borderTop = '1px solid rgba(120, 220, 232, 0.8)';\r\n        topLeft.style.borderLeft = '1px solid rgba(120, 220, 232, 0.8)';\r\n        panel.appendChild(topLeft);\r\n        \r\n        // Top right corner\r\n        const topRight = document.createElement('div');\r\n        topRight.style.position = 'absolute';\r\n        topRight.style.top = '0';\r\n        topRight.style.right = '0';\r\n        topRight.style.width = '6px';\r\n        topRight.style.height = '6px';\r\n        topRight.style.borderTop = '1px solid rgba(120, 220, 232, 0.8)';\r\n        topRight.style.borderRight = '1px solid rgba(120, 220, 232, 0.8)';\r\n        panel.appendChild(topRight);\r\n        \r\n        // Bottom left corner\r\n        const bottomLeft = document.createElement('div');\r\n        bottomLeft.style.position = 'absolute';\r\n        bottomLeft.style.bottom = '0';\r\n        bottomLeft.style.left = '0';\r\n        bottomLeft.style.width = '6px';\r\n        bottomLeft.style.height = '6px';\r\n        bottomLeft.style.borderBottom = '1px solid rgba(120, 220, 232, 0.8)';\r\n        bottomLeft.style.borderLeft = '1px solid rgba(120, 220, 232, 0.8)';\r\n        panel.appendChild(bottomLeft);\r\n        \r\n        // Bottom right corner\r\n        const bottomRight = document.createElement('div');\r\n        bottomRight.style.position = 'absolute';\r\n        bottomRight.style.bottom = '0';\r\n        bottomRight.style.right = '0';\r\n        bottomRight.style.width = '6px';\r\n        bottomRight.style.height = '6px';\r\n        bottomRight.style.borderBottom = '1px solid rgba(120, 220, 232, 0.8)';\r\n        bottomRight.style.borderRight = '1px solid rgba(120, 220, 232, 0.8)';\r\n        panel.appendChild(bottomRight);\r\n    }\r\n    \r\n    update() {\r\n        // Update shield display\r\n        this.updateShieldDisplay();\r\n        \r\n        // Update hull display\r\n        this.updateHullDisplay();\r\n        \r\n        // Update fuel display\r\n        this.updateFuelDisplay();\r\n        \r\n        // Update cargo display\r\n        this.updateCargoDisplay();\r\n        \r\n        // Update anomaly count\r\n        this.updateAnomalyCount();\r\n        \r\n        // Update horde mode display\r\n        this.updateHordeModeDisplay();\r\n    }\r\n    \r\n    updateShieldDisplay() {\r\n        const shieldBar = document.getElementById('shield-bar-mobile');\r\n        if (!shieldBar) return;\r\n        \r\n        let shieldPercentage = 100;\r\n        \r\n        // Get shield data from spaceship\r\n        if (this.spaceship && typeof this.spaceship.shield !== 'undefined') {\r\n            shieldPercentage = (this.spaceship.shield / this.spaceship.maxShield) * 100;\r\n        }\r\n        \r\n        // Update the shield bar\r\n        shieldBar.style.width = `${shieldPercentage}%`;\r\n        \r\n        // Change color based on shield status\r\n        if (shieldPercentage < 25) {\r\n            shieldBar.style.backgroundColor = 'rgba(255, 80, 80, 0.8)'; // Red for low shields\r\n        } else if (shieldPercentage < 50) {\r\n            shieldBar.style.backgroundColor = 'rgba(255, 204, 0, 0.8)'; // Yellow for medium shields\r\n        } else {\r\n            shieldBar.style.backgroundColor = 'rgba(51, 153, 255, 0.8)'; // Blue for healthy shields\r\n        }\r\n    }\r\n    \r\n    updateHullDisplay() {\r\n        const hullBar = document.getElementById('hull-bar-mobile');\r\n        if (!hullBar) return;\r\n        \r\n        let hullPercentage = 100;\r\n        \r\n        // Get hull data from spaceship\r\n        if (this.spaceship && typeof this.spaceship.hull !== 'undefined') {\r\n            hullPercentage = (this.spaceship.hull / this.spaceship.maxHull) * 100;\r\n        }\r\n        \r\n        // Update the hull bar\r\n        hullBar.style.width = `${hullPercentage}%`;\r\n        \r\n        // Change color based on hull status\r\n        if (hullPercentage < 30) {\r\n            hullBar.style.backgroundColor = 'rgba(255, 80, 80, 0.8)';\r\n        } else if (hullPercentage < 60) {\r\n            hullBar.style.backgroundColor = 'rgba(255, 204, 0, 0.8)';\r\n        } else {\r\n            hullBar.style.backgroundColor = 'rgba(120, 220, 232, 0.8)';\r\n        }\r\n    }\r\n    \r\n    updateFuelDisplay() {\r\n        const fuelBar = document.getElementById('fuel-bar-mobile');\r\n        const fuelValue = document.getElementById('fuel-value-mobile');\r\n        if (!fuelBar || !this.spaceship) return;\r\n        \r\n        // Correctly calculate fuel percentage based on maxFuel\r\n        const fuelPercent = this.spaceship.maxFuel > 0 ? \r\n            (this.spaceship.fuel / this.spaceship.maxFuel) * 100 : 0;\r\n        \r\n        fuelBar.style.width = `${fuelPercent}%`;\r\n        \r\n        // Change color when low based on percentage, not absolute value\r\n        if (fuelPercent < 20) {\r\n            fuelBar.style.backgroundColor = 'rgba(255, 80, 80, 0.8)';\r\n        } else if (fuelPercent < 40) {\r\n            fuelBar.style.backgroundColor = 'rgba(255, 204, 0, 0.8)';\r\n        } else {\r\n            fuelBar.style.backgroundColor = 'rgba(120, 220, 232, 0.8)';\r\n        }\r\n        \r\n        // Update the fuel value text display\r\n        if (fuelValue) {\r\n            fuelValue.textContent = `${Math.round(this.spaceship.fuel)} / ${Math.round(this.spaceship.maxFuel)}`;\r\n        }\r\n    }\r\n    \r\n    updateCargoDisplay() {\r\n        const cargoValue = document.getElementById('cargo-value-mobile');\r\n        if (!cargoValue) return;\r\n        \r\n        // Try to get resources from different possible sources\r\n        let resources = null;\r\n        let maxCargo = 1000; // Default max\r\n        \r\n        // First try to get from controls\r\n        if (this.controls && this.controls.resources) {\r\n            resources = this.controls.resources;\r\n            // Get max capacity from spaceship if available\r\n            if (this.spaceship && typeof this.spaceship.maxCargoCapacity !== 'undefined') {\r\n                maxCargo = this.spaceship.maxCargoCapacity;\r\n            }\r\n        } \r\n        // Fall back to cargo component if available\r\n        else if (this.spaceship && this.spaceship.cargoComponent && this.spaceship.cargoComponent.resources) {\r\n            resources = this.spaceship.cargoComponent.resources;\r\n            maxCargo = this.spaceship.cargoComponent.maxCapacity;\r\n        }\r\n        // Last resort - use previously defined resources structure\r\n        else if (this.spaceship && this.spaceship.resources) {\r\n            resources = this.spaceship.resources;\r\n        }\r\n        \r\n        // If no resources found, exit\r\n        if (!resources) return;\r\n        \r\n        // Calculate total cargo - ensure we're dealing with numbers\r\n        let totalCargo = 0;\r\n        \r\n        // Properly iterate through the resources object and sum numeric values\r\n        for (const key in resources) {\r\n            if (resources.hasOwnProperty(key)) {\r\n                // Get the resource amount, ensure it's a number\r\n                const amount = parseFloat(resources[key]) || 0;\r\n                totalCargo += amount;\r\n            }\r\n        }\r\n        \r\n        // Format to integer for display\r\n        totalCargo = Math.round(totalCargo);\r\n        \r\n        cargoValue.textContent = `${totalCargo} / ${maxCargo}`;\r\n        \r\n        // Change color when cargo is almost full\r\n        if (totalCargo >= maxCargo * 0.9) {\r\n            cargoValue.style.color = 'rgba(255, 80, 80, 0.9)';\r\n        } else if (totalCargo >= maxCargo * 0.7) {\r\n            cargoValue.style.color = 'rgba(255, 204, 0, 0.9)';\r\n        } else {\r\n            cargoValue.style.color = 'rgba(120, 220, 232, 0.9)';\r\n        }\r\n    }\r\n    \r\n    updateAnomalyCount() {\r\n        const anomalyCount = document.getElementById('anomaly-count-mobile');\r\n        if (!anomalyCount) return;\r\n        \r\n        // Get anomaly count from game object if available\r\n        let count = 0;\r\n        if (window.game && window.game.environment && window.game.environment.anomalyCount) {\r\n            count = window.game.environment.anomalyCount;\r\n        }\r\n        \r\n        // Update the anomaly counter\r\n        anomalyCount.textContent = count.toString();\r\n        \r\n        // Highlight if anomalies are present\r\n        if (count > 0) {\r\n            anomalyCount.style.color = 'rgba(255, 204, 0, 0.9)';\r\n            anomalyCount.style.textShadow = '0 0 5px rgba(255, 204, 0, 0.5)';\r\n        } else {\r\n            anomalyCount.style.color = 'rgba(120, 220, 232, 0.9)';\r\n            anomalyCount.style.textShadow = 'none';\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Update the horde mode indicator and timer in the mobile HUD\r\n     */\r\n    updateHordeModeDisplay() {\r\n        const hordeIndicator = document.getElementById('mobile-horde-indicator');\r\n        const hordeTimer = document.getElementById('mobile-horde-timer');\r\n        \r\n        if (!hordeIndicator || !hordeTimer) return;\r\n        \r\n        // Check if horde mode is active\r\n        if (window.game && window.game.isHordeActive) {\r\n            // Show the indicator if not already visible\r\n            if (hordeIndicator.style.display === 'none') {\r\n                hordeIndicator.style.display = 'block';\r\n                hordeIndicator.innerHTML = '<div style=\"text-align:center; color:#ff3030; font-weight:bold; margin-bottom:2px;\">HORDE MODE</div>';\r\n                hordeIndicator.appendChild(hordeTimer);\r\n            }\r\n            \r\n            // Update the timer\r\n            if (window.game.getFormattedHordeSurvivalTime) {\r\n                hordeTimer.textContent = window.game.getFormattedHordeSurvivalTime();\r\n            } else {\r\n                // Fallback calculation\r\n                const totalSeconds = Math.floor(window.game.hordeSurvivalTime / 1000);\r\n                const minutes = Math.floor(totalSeconds / 60);\r\n                const seconds = totalSeconds % 60;\r\n                hordeTimer.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;\r\n            }\r\n            \r\n            // Increase pulsing intensity after 3 minutes\r\n            if (window.game.hordeSurvivalTime > 3 * 60 * 1000) {\r\n                const styleEl = document.createElement('style');\r\n                styleEl.textContent = `\r\n                    @keyframes pulse-horde-mobile {\r\n                        0% { box-shadow: 0 0 5px rgba(255, 30, 30, 0.7); }\r\n                        50% { box-shadow: 0 0 10px rgba(255, 30, 30, 1); }\r\n                        100% { box-shadow: 0 0 5px rgba(255, 30, 30, 0.7); }\r\n                    }\r\n                `;\r\n                document.head.appendChild(styleEl);\r\n                \r\n                // Make animation faster\r\n                hordeIndicator.style.animation = 'pulse-horde-mobile 0.8s infinite';\r\n                hordeIndicator.style.backgroundColor = 'rgba(255, 30, 30, 0.3)';\r\n            }\r\n        } else {\r\n            // Hide the indicator\r\n            hordeIndicator.style.display = 'none';\r\n        }\r\n    }\r\n    \r\n    hide() {\r\n        const container = document.getElementById('mobile-hud-container');\r\n        if (container) {\r\n            container.style.display = 'none';\r\n        }\r\n    }\r\n    \r\n    show() {\r\n        // Check if intro sequence is active\r\n        if (window.game && window.game.introSequenceActive) {\r\n            console.log(\"MobileHUD: Not showing HUD during intro sequence\");\r\n            return; // Don't show during intro\r\n        }\r\n        \r\n        const container = document.getElementById('mobile-hud-container');\r\n        if (container) {\r\n            container.style.display = 'block';\r\n        }\r\n    }\r\n    \r\n    // Add method to set controls reference\r\n    setControls(controls) {\r\n        console.log(\"MobileHUD: Setting controls reference\");\r\n        this.controls = controls;\r\n    }\r\n\r\n    // Update to handle system name and anomaly count in a simpler way\r\n    updateLocation(locationName, systemName = 'Unknown System') {\r\n        // Since we no longer show system name, we just need to update anomaly count\r\n        this.updateAnomalyCount();\r\n    }\r\n} ","// miningDisplay.js - Handles the mining UI and resource display\r\n\r\nexport class MiningDisplay {\r\n    constructor() {\r\n        this.controls = null; // Will be set later\r\n        this.setupMiningDisplay();\r\n    }\r\n    \r\n    setControls(controls) {\r\n        this.controls = controls;\r\n    }\r\n    \r\n    setupMiningDisplay() {\r\n        // Don't create a duplicate target-info element\r\n        // The HUD already creates one that we'll use\r\n        // We just need to ensure mining-time element exists when needed\r\n    }\r\n    \r\n    update() {\r\n        // Update the HUD resource counters in the top right with our resource values\r\n        if (this.controls && this.controls.resources) {\r\n            const ironAmount = document.getElementById('iron-amount');\r\n            const goldAmount = document.getElementById('gold-amount');\r\n            const platinumAmount = document.getElementById('platinum-amount');\r\n            const cargoCapacity = document.getElementById('cargo-capacity');\r\n            const capacityBar = document.getElementById('capacity-bar');\r\n            \r\n            if (ironAmount) ironAmount.textContent = this.controls.resources.iron || 0;\r\n            if (goldAmount) goldAmount.textContent = this.controls.resources.gold || 0;\r\n            if (platinumAmount) platinumAmount.textContent = this.controls.resources.platinum || 0;\r\n            \r\n            // Update cargo capacity\r\n            if (cargoCapacity && capacityBar && this.controls.spaceship) {\r\n                const totalResources = \r\n                    (this.controls.resources.iron || 0) + \r\n                    (this.controls.resources.gold || 0) + \r\n                    (this.controls.resources.platinum || 0);\r\n                const maxCapacity = this.controls.spaceship.maxCargoCapacity || 1000;\r\n                const capacityPercentage = (totalResources / maxCapacity) * 100;\r\n                \r\n                cargoCapacity.textContent = `${totalResources} / ${maxCapacity}`;\r\n                capacityBar.style.width = `${capacityPercentage}%`;\r\n                \r\n                // Change color when near capacity\r\n                if (capacityPercentage > 90) {\r\n                    capacityBar.style.backgroundColor = 'rgba(255, 80, 80, 0.8)';\r\n                } else if (capacityPercentage > 75) {\r\n                    capacityBar.style.backgroundColor = 'rgba(255, 204, 0, 0.8)';\r\n                } else {\r\n                    capacityBar.style.backgroundColor = 'rgba(120, 220, 232, 0.8)';\r\n                }\r\n            }\r\n            \r\n            // Update mining time estimate if targeting an asteroid\r\n            this.updateMiningTimeEstimate();\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Update the mining time estimate based on the targeted asteroid type and mining efficiency\r\n     */\r\n    updateMiningTimeEstimate() {\r\n        const miningTimeElement = document.getElementById('mining-time');\r\n        if (!miningTimeElement || !this.controls || !this.controls.miningSystem) return;\r\n        \r\n        const miningSystem = this.controls.miningSystem;\r\n        if (miningSystem.targetAsteroid && miningSystem.targetAsteroid.resourceType) {\r\n            const resourceType = miningSystem.targetAsteroid.resourceType.toLowerCase();\r\n            const efficiency = miningSystem.getMiningEfficiency();\r\n            const secondsRequired = Math.round(1 / (miningSystem.miningSpeedByType[resourceType] * efficiency));\r\n            \r\n            miningTimeElement.textContent = `Mining time: ${secondsRequired} seconds`;\r\n            miningTimeElement.style.display = 'block';\r\n            \r\n            // Color based on resource value\r\n            if (resourceType === 'platinum') {\r\n                miningTimeElement.style.color = '#66ffff';\r\n            } else if (resourceType === 'gold') {\r\n                miningTimeElement.style.color = '#ffcc00';\r\n            } else {\r\n                miningTimeElement.style.color = '#a0a0a0';\r\n            }\r\n        } else {\r\n            miningTimeElement.style.display = 'none';\r\n        }\r\n    }\r\n    \r\n    hide() {\r\n        // Hide target info\r\n        const targetInfo = document.getElementById('target-info');\r\n        if (targetInfo) {\r\n            targetInfo.style.display = 'none';\r\n        }\r\n    }\r\n    \r\n    show() {\r\n        // Show target info if needed\r\n        // In this implementation, the target info is shown directly by the targeting system\r\n    }\r\n}","// targetingUI.js - Handles the targeting UI components\r\n\r\nexport class TargetingUI {\r\n    constructor() {\r\n        this.setupTargetingUI();\r\n    }\r\n    \r\n    setupTargetingUI() {\r\n        // Create lock-on display\r\n        const lockOnDisplay = document.createElement('div');\r\n        lockOnDisplay.id = 'lock-on-display';\r\n        lockOnDisplay.style.position = 'absolute';\r\n        lockOnDisplay.style.top = '50%';\r\n        lockOnDisplay.style.left = '50%';\r\n        lockOnDisplay.style.width = '150px';\r\n        lockOnDisplay.style.height = '150px';\r\n        lockOnDisplay.style.transform = 'translate(-50%, -50%)';\r\n        lockOnDisplay.style.border = '2px dashed #ff0000';\r\n        lockOnDisplay.style.borderRadius = '50%';\r\n        lockOnDisplay.style.boxSizing = 'border-box';\r\n        lockOnDisplay.style.display = 'none';\r\n        lockOnDisplay.style.zIndex = '997';\r\n        lockOnDisplay.style.pointerEvents = 'none';\r\n        document.body.appendChild(lockOnDisplay);\r\n        \r\n        // Add diagonal lines for better targeting visual\r\n        const diagonalLines = document.createElement('div');\r\n        diagonalLines.style.position = 'absolute';\r\n        diagonalLines.style.width = '100%';\r\n        diagonalLines.style.height = '100%';\r\n        diagonalLines.style.top = '0';\r\n        diagonalLines.style.left = '0';\r\n        diagonalLines.innerHTML = `\r\n            <div style=\"position: absolute; width: 2px; height: 30px; background-color: #ff0000; top: 0; left: 50%; transform: translateX(-50%);\"></div>\r\n            <div style=\"position: absolute; width: 2px; height: 30px; background-color: #ff0000; bottom: 0; left: 50%; transform: translateX(-50%);\"></div>\r\n            <div style=\"position: absolute; width: 30px; height: 2px; background-color: #ff0000; left: 0; top: 50%; transform: translateY(-50%);\"></div>\r\n            <div style=\"position: absolute; width: 30px; height: 2px; background-color: #ff0000; right: 0; top: 50%; transform: translateY(-50%);\"></div>\r\n        `;\r\n        lockOnDisplay.appendChild(diagonalLines);\r\n        \r\n        // Create target indicator for lock-on \r\n        const targetIndicator = document.createElement('div');\r\n        targetIndicator.id = 'target-indicator';\r\n        targetIndicator.style.position = 'absolute';\r\n        targetIndicator.style.bottom = '120px';\r\n        targetIndicator.style.left = '50%';\r\n        targetIndicator.style.transform = 'translateX(-50%)';\r\n        targetIndicator.style.width = '200px';\r\n        targetIndicator.style.textAlign = 'center';\r\n        targetIndicator.style.backgroundColor = 'rgba(255, 50, 50, 0.4)';\r\n        targetIndicator.style.border = '1px solid #ff3030';\r\n        targetIndicator.style.borderRadius = '10px';\r\n        targetIndicator.style.padding = '8px';\r\n        targetIndicator.style.color = '#ffffff';\r\n        targetIndicator.style.fontFamily = 'monospace';\r\n        targetIndicator.style.zIndex = '100';\r\n        targetIndicator.style.display = 'none';\r\n        targetIndicator.style.boxShadow = '0 0 10px #ff3030';\r\n        \r\n        // Add targeting information\r\n        targetIndicator.innerHTML = `\r\n            <div style=\"font-weight: bold; margin-bottom: 5px;\"> TARGET LOCKED </div>\r\n            <div id=\"target-type\">Asteroid</div>\r\n            <div id=\"target-distance\">Distance: 0 units</div>\r\n            <div id=\"target-resource\" style=\"color: #ffcc00;\">Resource: Unknown</div>\r\n        `;\r\n        \r\n        document.body.appendChild(targetIndicator);\r\n    }\r\n    \r\n    showLockOn() {\r\n        const lockOnDisplay = document.getElementById('lock-on-display');\r\n        if (lockOnDisplay) {\r\n            lockOnDisplay.style.display = 'block';\r\n        }\r\n    }\r\n    \r\n    hideLockOn() {\r\n        const lockOnDisplay = document.getElementById('lock-on-display');\r\n        if (lockOnDisplay) {\r\n            lockOnDisplay.style.display = 'none';\r\n        }\r\n    }\r\n    \r\n    updateTargetInfo(targetType, distance, resourceType) {\r\n        const targetIndicator = document.getElementById('target-indicator');\r\n        const targetTypeElement = document.getElementById('target-type');\r\n        const targetDistanceElement = document.getElementById('target-distance');\r\n        const targetResourceElement = document.getElementById('target-resource');\r\n        \r\n        if (targetIndicator && targetTypeElement && targetDistanceElement) {\r\n            // Show the target indicator\r\n            targetIndicator.style.display = 'block';\r\n            \r\n            // Update the target information\r\n            targetTypeElement.textContent = `${targetType}`;\r\n            targetDistanceElement.textContent = `Distance: ${Math.round(distance)} units`;\r\n            \r\n            // Set resource info with proper coloring based on type\r\n            if (targetResourceElement && resourceType) {\r\n                let resourceColor = '#cccccc'; // Default color\r\n                \r\n                // Set color based on resource type\r\n                if (resourceType.toLowerCase() === 'iron') {\r\n                    resourceColor = '#cccccc';\r\n                } else if (resourceType.toLowerCase() === 'gold') {\r\n                    resourceColor = '#ffcc00';\r\n                } else if (resourceType.toLowerCase() === 'platinum') {\r\n                    resourceColor = '#66ffff';\r\n                }\r\n                \r\n                targetResourceElement.textContent = `Resource: ${resourceType}`;\r\n                targetResourceElement.style.color = resourceColor;\r\n            }\r\n            \r\n            // Add pulse animation effect\r\n            this.addPulseEffect(targetIndicator);\r\n        }\r\n    }\r\n    \r\n    // Add a subtle pulse animation to the target indicator\r\n    addPulseEffect(element) {\r\n        // Remove any existing animation\r\n        element.style.animation = 'none';\r\n        \r\n        // Force reflow\r\n        void element.offsetWidth;\r\n        \r\n        // Add pulse animation\r\n        element.style.animation = 'targetPulse 2s infinite';\r\n        \r\n        // Add CSS keyframes if not already present\r\n        if (!document.getElementById('targeting-keyframes')) {\r\n            const style = document.createElement('style');\r\n            style.id = 'targeting-keyframes';\r\n            style.textContent = `\r\n                @keyframes targetPulse {\r\n                    0% { box-shadow: 0 0 10px #ff3030; }\r\n                    50% { box-shadow: 0 0 20px #ff3030; }\r\n                    100% { box-shadow: 0 0 10px #ff3030; }\r\n                }\r\n            `;\r\n            document.head.appendChild(style);\r\n        }\r\n    }\r\n    \r\n    hideTargetInfo() {\r\n        const targetIndicator = document.getElementById('target-indicator');\r\n        if (targetIndicator) {\r\n            targetIndicator.style.display = 'none';\r\n        }\r\n    }\r\n} ","// screen.js - Terminal display rendering and DOM management\r\n\r\nexport class TerminalScreen {\r\n    constructor() {\r\n        this.isMobile = false;\r\n    }\r\n    \r\n    setMobile(isMobile) {\r\n        this.isMobile = isMobile;\r\n    }\r\n    \r\n    createDockingPrompt() {\r\n        const dockingPrompt = document.createElement('div');\r\n        dockingPrompt.id = 'docking-prompt';\r\n        dockingPrompt.style.position = 'absolute';\r\n        dockingPrompt.style.top = '50%';\r\n        dockingPrompt.style.left = '50%';\r\n        dockingPrompt.style.transform = 'translate(-50%, -50%)';\r\n        dockingPrompt.style.backgroundColor = 'rgba(0, 0, 0, 0.7)';\r\n        dockingPrompt.style.color = '#33aaff';\r\n        dockingPrompt.style.padding = '20px';\r\n        dockingPrompt.style.borderRadius = '10px';\r\n        dockingPrompt.style.border = '2px solid #33aaff';\r\n        dockingPrompt.style.boxShadow = '0 0 20px #33aaff';\r\n        dockingPrompt.style.fontFamily = 'Courier New, monospace';\r\n        dockingPrompt.style.fontSize = '18px';\r\n        dockingPrompt.style.textAlign = 'center';\r\n        dockingPrompt.style.zIndex = '1000';\r\n        dockingPrompt.style.display = 'none';\r\n        \r\n        if (this.isMobile) {\r\n            dockingPrompt.style.display = 'none';\r\n            dockingPrompt.dataset.alwaysHide = 'true';\r\n        } else {\r\n            dockingPrompt.textContent = 'Press Q to dock with Stargate';\r\n        }\r\n        \r\n        document.body.appendChild(dockingPrompt);\r\n        return dockingPrompt;\r\n    }\r\n    \r\n    createMainUI() {\r\n        const stargateUI = document.createElement('div');\r\n        stargateUI.id = 'stargate-ui';\r\n        \r\n        if (this.isMobile) {\r\n            stargateUI.style.width = '95%';\r\n            stargateUI.style.maxWidth = '95vw';\r\n            stargateUI.style.webkitOverflowScrolling = 'touch';\r\n            stargateUI.style.touchAction = 'pan-y';\r\n            stargateUI.style.overscrollBehavior = 'contain';\r\n        }\r\n        \r\n        return stargateUI;\r\n    }\r\n    \r\n    showDockingPrompt() {\r\n        const dockingPrompt = document.getElementById('docking-prompt');\r\n        if (dockingPrompt && dockingPrompt.dataset.alwaysHide !== 'true') {\r\n            dockingPrompt.style.display = 'block';\r\n        }\r\n    }\r\n    \r\n    hideDockingPrompt() {\r\n        const dockingPrompt = document.getElementById('docking-prompt');\r\n        if (dockingPrompt) {\r\n            dockingPrompt.style.display = 'none';\r\n        }\r\n    }\r\n    \r\n    updateResourceDisplay(resource, value) {\r\n        const element = document.getElementById(`ms-${resource}`);\r\n        if (element) {\r\n            element.textContent = value;\r\n        }\r\n    }\r\n    \r\n    updateStatusBar(barId, percentage) {\r\n        const bar = document.getElementById(barId);\r\n        if (bar) {\r\n            bar.style.width = `${percentage}%`;\r\n        }\r\n    }\r\n    \r\n    updateCredits(credits) {\r\n        const element = document.getElementById('ms-credits');\r\n        if (element) {\r\n            element.textContent = `${credits} CR`;\r\n        }\r\n    }\r\n    \r\n    updateOrbCount(rarity, count) {\r\n        const element = document.getElementById(`orb-${rarity}-count`);\r\n        if (element) {\r\n            element.textContent = `${count} in inventory`;\r\n        }\r\n    }\r\n    \r\n    updateUpgradeLevel(upgradeType, level) {\r\n        const element = document.getElementById(`current-${upgradeType}-level`);\r\n        if (element) {\r\n            element.textContent = level;\r\n        }\r\n    }\r\n    \r\n    updateUpgradeProgress(upgradeType, percentage) {\r\n        const progressBar = document.getElementById(`${upgradeType}-upgrade-progress`);\r\n        if (progressBar) {\r\n            progressBar.style.width = `${percentage}%`;\r\n        }\r\n    }\r\n    \r\n    updateUpgradeCost(upgradeType, cost) {\r\n        const element = document.getElementById(`${upgradeType}-upgrade-cost`);\r\n        if (element) {\r\n            element.textContent = cost;\r\n        }\r\n    }\r\n    \r\n    showUI() {\r\n        const ui = document.getElementById('stargate-ui');\r\n        if (ui) {\r\n            ui.style.display = 'block';\r\n        }\r\n    }\r\n    \r\n    hideUI() {\r\n        const ui = document.getElementById('stargate-ui');\r\n        if (ui) {\r\n            ui.style.display = 'none';\r\n        }\r\n    }\r\n}","// effects.js - CRT effects, glitch animations, and visual styling\r\n\r\nexport class TerminalEffects {\r\n    constructor() {\r\n        this.stylesInjected = false;\r\n    }\r\n    \r\n    createStyles() {\r\n        if (this.stylesInjected) return;\r\n        \r\n        const style = document.createElement('style');\r\n        style.textContent = `\r\n            @keyframes pulse-warning {\r\n                0% { box-shadow: 0 0 15px rgba(255, 48, 48, 0.5); }\r\n                50% { box-shadow: 0 0 25px rgba(255, 48, 48, 0.8); }\r\n                100% { box-shadow: 0 0 15px rgba(255, 48, 48, 0.5); }\r\n            }\r\n            \r\n            @keyframes pulse-glow {\r\n                0%, 100% { opacity: 0.5; }\r\n                50% { opacity: 1; }\r\n            }\r\n            \r\n            /* Stargate Terminal Base Styles */\r\n            #stargate-ui {\r\n                --primary-bg: rgba(20, 30, 50, 0.9);\r\n                --primary-border: #33aaff;\r\n                --section-bg: rgba(10, 20, 35, 0.8);\r\n                --accent-blue: #33aaff;\r\n                --accent-green: #00cc33;\r\n                --accent-orange: #ff9900;\r\n                --accent-red: #ff3030;\r\n                --accent-purple: #9933cc;\r\n                --accent-cyan: #30cfd0;\r\n                \r\n                position: absolute;\r\n                top: 50%;\r\n                left: 50%;\r\n                transform: translate(-50%, -50%);\r\n                width: 80%;\r\n                max-width: 1000px;\r\n                max-height: 90vh;\r\n                background-color: var(--primary-bg);\r\n                color: #fff;\r\n                border-radius: 15px;\r\n                border: 2px solid var(--primary-border);\r\n                box-shadow: 0 0 30px var(--primary-border);\r\n                font-family: 'Courier New', monospace;\r\n                z-index: 1000;\r\n                display: none;\r\n                overflow-y: auto;\r\n                overflow-x: hidden;\r\n                padding: 0;\r\n            }\r\n            \r\n            /* Layout and Structure Styles */\r\n            #stargate-header {\r\n                background-color: rgba(30, 40, 60, 0.9);\r\n                padding: 15px 20px;\r\n                border-bottom: 1px solid var(--primary-border);\r\n                position: sticky;\r\n                top: 0;\r\n                z-index: 10;\r\n                display: flex;\r\n                flex-direction: column;\r\n                align-items: center;\r\n            }\r\n            \r\n            #stargate-content {\r\n                display: grid;\r\n                grid-template-columns: 1fr 1fr 1fr;\r\n                gap: 20px;\r\n                padding: 20px;\r\n            }\r\n            \r\n            .stargate-section {\r\n                background-color: var(--section-bg);\r\n                border-radius: 10px;\r\n                padding: 15px;\r\n                border: 1px solid rgba(51, 170, 255, 0.3);\r\n            }\r\n            \r\n            .stargate-section h3 {\r\n                color: var(--accent-blue);\r\n                margin-top: 0;\r\n                margin-bottom: 15px;\r\n                padding-bottom: 8px;\r\n                border-bottom: 1px solid rgba(51, 170, 255, 0.3);\r\n                font-size: 1.2em;\r\n            }\r\n            \r\n            ${this.getComponentStyles()}\r\n            \r\n            /* Resource Border Effects */\r\n            .iron-border { \r\n                border: 1px solid #cc6633; \r\n                box-shadow: 0 0 10px rgba(204, 102, 51, 0.3); \r\n            }\r\n            .gold-border { \r\n                border: 1px solid #ffcc33; \r\n                box-shadow: 0 0 10px rgba(255, 204, 51, 0.3); \r\n            }\r\n            .platinum-border { \r\n                border: 1px solid #33ccff; \r\n                box-shadow: 0 0 10px rgba(51, 204, 255, 0.3); \r\n            }\r\n            .common-border { \r\n                border: 1px solid #00ff66; \r\n                box-shadow: 0 0 10px rgba(0, 255, 102, 0.3); \r\n            }\r\n            .uncommon-border { \r\n                border: 1px solid #0066ff; \r\n                box-shadow: 0 0 10px rgba(0, 102, 255, 0.3); \r\n            }\r\n            .rare-border { \r\n                border: 1px solid #9900ff; \r\n                box-shadow: 0 0 10px rgba(153, 0, 255, 0.3); \r\n            }\r\n            .epic-border { \r\n                border: 1px solid #ff6600; \r\n                box-shadow: 0 0 10px rgba(255, 102, 0, 0.3); \r\n            }\r\n            .legendary-border { \r\n                border: 1px solid #ff0000; \r\n                box-shadow: 0 0 10px rgba(255, 0, 0, 0.3); \r\n            }\r\n            \r\n            /* Undock Button Glow Effects */\r\n            .btn-undock {\r\n                background: linear-gradient(135deg, #00a8ff 0%, #0066cc 100%);\r\n                font-size: 1.4em;\r\n                font-weight: bold;\r\n                letter-spacing: 3px;\r\n                padding: 16px 40px;\r\n                width: auto;\r\n                min-width: 200px;\r\n                margin-bottom: 15px;\r\n                border: 2px solid #00d4ff;\r\n                box-shadow: 0 0 20px rgba(0, 212, 255, 0.5), inset 0 0 20px rgba(0, 168, 255, 0.2);\r\n                text-transform: uppercase;\r\n                position: relative;\r\n                overflow: hidden;\r\n                transition: all 0.3s ease;\r\n            }\r\n            \r\n            .btn-undock:hover {\r\n                background: linear-gradient(135deg, #00d4ff 0%, #0088ff 100%);\r\n                box-shadow: 0 0 30px rgba(0, 212, 255, 0.8), inset 0 0 20px rgba(0, 212, 255, 0.3);\r\n                transform: translateY(-2px);\r\n            }\r\n            \r\n            .btn-undock:active {\r\n                transform: translateY(0);\r\n            }\r\n            \r\n            .btn-undock::before {\r\n                content: '';\r\n                position: absolute;\r\n                top: -2px;\r\n                left: -2px;\r\n                right: -2px;\r\n                bottom: -2px;\r\n                background: linear-gradient(45deg, transparent, #00d4ff, transparent);\r\n                z-index: -1;\r\n                opacity: 0;\r\n                transition: opacity 0.3s;\r\n                animation: pulse-glow 2s infinite;\r\n            }\r\n            \r\n            .btn-undock:hover::before {\r\n                opacity: 1;\r\n            }\r\n            \r\n            /* Horde Button Warning Effects */\r\n            .btn-horde { \r\n                background: linear-gradient(135deg, #990000 0%, var(--accent-red) 100%);\r\n                color: #fff;\r\n                border: 2px solid var(--accent-red);\r\n                box-shadow: 0 0 15px rgba(255, 48, 48, 0.5);\r\n                animation: pulse-warning 2s infinite;\r\n            }\r\n        `;\r\n        document.head.appendChild(style);\r\n        this.stylesInjected = true;\r\n    }\r\n    \r\n    applyGlowEffect(element, color = '#33aaff', intensity = 0.5) {\r\n        if (!element) return;\r\n        \r\n        element.style.boxShadow = `0 0 20px rgba(${this.hexToRgb(color)}, ${intensity})`;\r\n    }\r\n    \r\n    removeGlowEffect(element) {\r\n        if (!element) return;\r\n        \r\n        element.style.boxShadow = '';\r\n    }\r\n    \r\n    hexToRgb(hex) {\r\n        const result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex);\r\n        return result ? \r\n            `${parseInt(result[1], 16)}, ${parseInt(result[2], 16)}, ${parseInt(result[3], 16)}` : \r\n            '255, 255, 255';\r\n    }\r\n    \r\n    addPulseAnimation(element, color = '#ff3030') {\r\n        if (!element) return;\r\n        \r\n        element.style.animation = 'pulse-warning 2s infinite';\r\n        element.style.boxShadow = `0 0 15px rgba(${this.hexToRgb(color)}, 0.5)`;\r\n    }\r\n    \r\n    removePulseAnimation(element) {\r\n        if (!element) return;\r\n        \r\n        element.style.animation = '';\r\n        element.style.boxShadow = '';\r\n    }\r\n    \r\n    addBorderGlow(element, type) {\r\n        if (!element) return;\r\n        \r\n        const glowClasses = [\r\n            'iron-border', 'gold-border', 'platinum-border',\r\n            'common-border', 'uncommon-border', 'rare-border',\r\n            'epic-border', 'legendary-border'\r\n        ];\r\n        \r\n        // Remove existing glow classes\r\n        element.classList.remove(...glowClasses);\r\n        \r\n        // Add new glow class\r\n        if (type && glowClasses.includes(`${type}-border`)) {\r\n            element.classList.add(`${type}-border`);\r\n        }\r\n    }\r\n    \r\n    getComponentStyles() {\r\n        return `\r\n            /* Ship Status Section */\r\n            #ship-status-section {\r\n                grid-column: 1;\r\n                display: flex;\r\n                flex-direction: column;\r\n                gap: 15px;\r\n            }\r\n            \r\n            .resources-container {\r\n                display: flex;\r\n                gap: 5px;\r\n                margin-bottom: 10px;\r\n            }\r\n            \r\n            .resource-display {\r\n                flex: 1;\r\n                padding: 8px;\r\n                background-color: rgba(15, 40, 55, 0.8);\r\n                border-radius: 5px;\r\n                text-align: center;\r\n            }\r\n            \r\n            .status-bar-container {\r\n                width: 100%;\r\n                height: 15px;\r\n                background-color: #222;\r\n                border-radius: 10px;\r\n                overflow: hidden;\r\n                margin-bottom: 5px;\r\n            }\r\n            \r\n            .status-bar {\r\n                height: 100%;\r\n                border-radius: 10px;\r\n            }\r\n            \r\n            .status-label {\r\n                display: flex;\r\n                justify-content: space-between;\r\n                margin-bottom: 5px;\r\n                font-size: 0.9em;\r\n            }\r\n            \r\n            /* Market Section */\r\n            #market-section {\r\n                grid-column: 2;\r\n                grid-row: 1;\r\n            }\r\n            \r\n            .sell-buttons {\r\n                display: grid;\r\n                grid-template-columns: 1fr 1fr 1fr;\r\n                gap: 5px;\r\n                margin-bottom: 15px;\r\n            }\r\n            \r\n            .sell-btn {\r\n                padding: 10px;\r\n                background-color: rgba(15, 40, 55, 0.8);\r\n                color: #fff;\r\n                border-radius: 5px;\r\n                cursor: pointer;\r\n                text-align: center;\r\n                transition: all 0.2s;\r\n                border: none;\r\n                font-family: 'Courier New', monospace;\r\n            }\r\n            \r\n            .orb-buttons {\r\n                display: grid;\r\n                grid-template-columns: 1fr 1fr;\r\n                gap: 8px;\r\n            }\r\n            \r\n            /* Upgrades Section */\r\n            #upgrades-section {\r\n                grid-column: 3;\r\n                grid-row: 1;\r\n            }\r\n            \r\n            .upgrade-item {\r\n                margin-bottom: 15px;\r\n                border: 1px solid rgba(85, 85, 85, 0.5);\r\n                border-radius: 8px;\r\n                padding: 12px;\r\n                background-color: rgba(0, 0, 0, 0.3);\r\n            }\r\n            \r\n            .upgrade-header {\r\n                display: flex;\r\n                justify-content: space-between;\r\n                align-items: center;\r\n                margin-bottom: 10px;\r\n            }\r\n            \r\n            .upgrade-progress {\r\n                position: relative;\r\n                height: 8px;\r\n                background-color: #333;\r\n                border-radius: 4px;\r\n                margin-bottom: 12px;\r\n            }\r\n            \r\n            .upgrade-progress-bar {\r\n                position: absolute;\r\n                top: 0;\r\n                left: 0;\r\n                height: 100%;\r\n                width: 20%;\r\n                border-radius: 4px;\r\n            }\r\n            \r\n            .upgrade-footer {\r\n                display: flex;\r\n                justify-content: space-between;\r\n                align-items: center;\r\n            }\r\n            \r\n            .upgrade-description {\r\n                flex: 2;\r\n                padding-right: 10px;\r\n                font-size: 0.85em;\r\n                opacity: 0.8;\r\n            }\r\n            \r\n            /* Features Section */\r\n            #features-section {\r\n                grid-column: 1 / span 2;\r\n                grid-row: 2;\r\n            }\r\n            \r\n            .feature-buttons {\r\n                display: grid;\r\n                grid-template-columns: 1fr 1fr;\r\n                gap: 15px;\r\n            }\r\n            \r\n            .feature-btn {\r\n                padding: 15px;\r\n                border: none;\r\n                border-radius: 5px;\r\n                cursor: pointer;\r\n                font-family: 'Courier New', monospace;\r\n                font-weight: bold;\r\n                font-size: 16px;\r\n                color: #fff;\r\n                display: flex;\r\n                flex-direction: column;\r\n                align-items: center;\r\n                justify-content: center;\r\n                min-height: 80px;\r\n            }\r\n            \r\n            .feature-btn small {\r\n                font-size: 0.8em;\r\n                opacity: 0.8;\r\n                margin-top: 5px;\r\n            }\r\n            \r\n            /* Challenge Section */\r\n            #challenge-section {\r\n                border-color: rgba(255, 48, 48, 0.5);\r\n            }\r\n            \r\n            #challenge-section h3 {\r\n                color: var(--accent-red);\r\n                border-color: rgba(255, 48, 48, 0.3);\r\n            }\r\n            \r\n            /* Common Button Styles */\r\n            .action-btn {\r\n                width: 100%;\r\n                padding: 10px;\r\n                border: none;\r\n                border-radius: 5px;\r\n                cursor: pointer;\r\n                font-family: 'Courier New', monospace;\r\n                font-weight: bold;\r\n                color: #000;\r\n                margin-top: 5px;\r\n            }\r\n            \r\n            /* Button color variations */\r\n            .btn-fuel { background-color: var(--accent-green); }\r\n            .btn-shield { background-color: var(--accent-blue); }\r\n            .btn-hull { background-color: var(--accent-orange); }\r\n            .btn-starmap { background-color: var(--accent-cyan); }\r\n            .btn-blackjack { background-color: var(--accent-purple); }\r\n            .btn-settings { background-color: var(--accent-blue); }\r\n            \r\n            /* Mobile Responsiveness */\r\n            @media (max-width: 900px) {\r\n                #stargate-ui {\r\n                    width: 95%;\r\n                    max-width: 95vw;\r\n                    max-height: 85vh;\r\n                    border-radius: 10px;\r\n                }\r\n                \r\n                #stargate-content {\r\n                    grid-template-columns: 1fr;\r\n                    gap: 15px;\r\n                    padding: 15px;\r\n                }\r\n                \r\n                #ship-status-section,\r\n                #market-section,\r\n                #upgrades-section,\r\n                #features-section {\r\n                    grid-column: 1;\r\n                }\r\n                \r\n                .feature-buttons {\r\n                    grid-template-columns: 1fr;\r\n                }\r\n                \r\n                .sell-buttons {\r\n                    grid-template-columns: 1fr 1fr;\r\n                }\r\n                \r\n                .action-btn {\r\n                    padding: 12px;\r\n                    min-height: 44px;\r\n                }\r\n            }\r\n        `;\r\n    }\r\n}","// parser.js - Command parsing logic for terminal interface\r\n\r\nexport class CommandParser {\r\n    constructor() {\r\n        this.commandHistory = [];\r\n        this.historyIndex = -1;\r\n        this.aliases = new Map();\r\n        this.setupAliases();\r\n    }\r\n    \r\n    setupAliases() {\r\n        // Common command aliases\r\n        this.aliases.set('ls', 'list');\r\n        this.aliases.set('dir', 'list');\r\n        this.aliases.set('h', 'help');\r\n        this.aliases.set('?', 'help');\r\n        this.aliases.set('q', 'quit');\r\n        this.aliases.set('exit', 'quit');\r\n        this.aliases.set('cls', 'clear');\r\n        this.aliases.set('clr', 'clear');\r\n        this.aliases.set('buy', 'purchase');\r\n        this.aliases.set('sell', 'market');\r\n        this.aliases.set('upgrade', 'enhance');\r\n        this.aliases.set('status', 'info');\r\n        this.aliases.set('stat', 'info');\r\n    }\r\n    \r\n    parseCommand(input) {\r\n        if (!input || typeof input !== 'string') {\r\n            return { command: '', args: [], original: '' };\r\n        }\r\n        \r\n        const trimmed = input.trim();\r\n        if (!trimmed) {\r\n            return { command: '', args: [], original: input };\r\n        }\r\n        \r\n        // Add to history if it's a new command\r\n        if (this.commandHistory[this.commandHistory.length - 1] !== trimmed) {\r\n            this.commandHistory.push(trimmed);\r\n            // Limit history to 50 commands\r\n            if (this.commandHistory.length > 50) {\r\n                this.commandHistory.shift();\r\n            }\r\n        }\r\n        this.historyIndex = this.commandHistory.length;\r\n        \r\n        // Parse command and arguments\r\n        const parts = this.tokenize(trimmed);\r\n        const rawCommand = parts[0]?.toLowerCase() || '';\r\n        const command = this.resolveAlias(rawCommand);\r\n        const args = parts.slice(1);\r\n        \r\n        return {\r\n            command,\r\n            args,\r\n            original: trimmed,\r\n            raw: rawCommand\r\n        };\r\n    }\r\n    \r\n    tokenize(input) {\r\n        const tokens = [];\r\n        let current = '';\r\n        let inQuotes = false;\r\n        let quoteChar = '';\r\n        \r\n        for (let i = 0; i < input.length; i++) {\r\n            const char = input[i];\r\n            \r\n            if ((char === '\"' || char === \"'\") && !inQuotes) {\r\n                inQuotes = true;\r\n                quoteChar = char;\r\n            } else if (char === quoteChar && inQuotes) {\r\n                inQuotes = false;\r\n                quoteChar = '';\r\n            } else if (char === ' ' && !inQuotes) {\r\n                if (current) {\r\n                    tokens.push(current);\r\n                    current = '';\r\n                }\r\n            } else {\r\n                current += char;\r\n            }\r\n        }\r\n        \r\n        if (current) {\r\n            tokens.push(current);\r\n        }\r\n        \r\n        return tokens;\r\n    }\r\n    \r\n    resolveAlias(command) {\r\n        return this.aliases.get(command) || command;\r\n    }\r\n    \r\n    getCommandHistory() {\r\n        return [...this.commandHistory];\r\n    }\r\n    \r\n    getPreviousCommand() {\r\n        if (this.historyIndex > 0) {\r\n            this.historyIndex--;\r\n            return this.commandHistory[this.historyIndex];\r\n        }\r\n        return null;\r\n    }\r\n    \r\n    getNextCommand() {\r\n        if (this.historyIndex < this.commandHistory.length - 1) {\r\n            this.historyIndex++;\r\n            return this.commandHistory[this.historyIndex];\r\n        } else if (this.historyIndex === this.commandHistory.length - 1) {\r\n            this.historyIndex++;\r\n            return '';\r\n        }\r\n        return null;\r\n    }\r\n    \r\n    validateCommand(command) {\r\n        const validCommands = [\r\n            'help', 'list', 'clear', 'quit', 'info', 'status',\r\n            'purchase', 'market', 'enhance', 'upgrade', 'refuel',\r\n            'repair', 'undock', 'dock', 'scan', 'navigate',\r\n            'starmap', 'blackjack', 'settings', 'horde'\r\n        ];\r\n        \r\n        return validCommands.includes(command);\r\n    }\r\n    \r\n    getCommandSuggestions(partial) {\r\n        const validCommands = [\r\n            'help', 'list', 'clear', 'quit', 'info',\r\n            'purchase', 'market', 'enhance', 'refuel',\r\n            'repair', 'undock', 'dock', 'scan', 'navigate',\r\n            'starmap', 'blackjack', 'settings', 'horde'\r\n        ];\r\n        \r\n        return validCommands.filter(cmd => \r\n            cmd.startsWith(partial.toLowerCase())\r\n        );\r\n    }\r\n}","// handlers.js - Command execution and action handling\r\n\r\nexport class CommandHandlers {\r\n    constructor(stargateInterface) {\r\n        this.stargate = stargateInterface;\r\n        this.lastCommandTime = 0;\r\n        this.commandCooldown = 100; // ms between commands\r\n    }\r\n    \r\n    async executeCommand(parsedCommand) {\r\n        const now = Date.now();\r\n        if (now - this.lastCommandTime < this.commandCooldown) {\r\n            return { success: false, message: 'Command rate limit exceeded' };\r\n        }\r\n        this.lastCommandTime = now;\r\n        \r\n        const { command, args } = parsedCommand;\r\n        \r\n        try {\r\n            switch (command) {\r\n                case 'help':\r\n                    return this.handleHelp(args);\r\n                case 'list':\r\n                    return this.handleList(args);\r\n                case 'clear':\r\n                    return this.handleClear();\r\n                case 'quit':\r\n                case 'undock':\r\n                    return this.handleUndock();\r\n                case 'info':\r\n                    return this.handleInfo(args);\r\n                case 'purchase':\r\n                    return this.handlePurchase(args);\r\n                case 'market':\r\n                    return this.handleMarket(args);\r\n                case 'enhance':\r\n                    return this.handleEnhance(args);\r\n                case 'refuel':\r\n                    return this.handleRefuel();\r\n                case 'repair':\r\n                    return this.handleRepair(args);\r\n                case 'scan':\r\n                    return this.handleScan();\r\n                case 'starmap':\r\n                    return this.handleStarmap();\r\n                case 'blackjack':\r\n                    return this.handleBlackjack();\r\n                case 'settings':\r\n                    return this.handleSettings();\r\n                case 'horde':\r\n                    return this.handleHorde();\r\n                default:\r\n                    return { \r\n                        success: false, \r\n                        message: `Unknown command: ${command}. Type 'help' for available commands.` \r\n                    };\r\n            }\r\n        } catch (error) {\r\n            console.error('Command execution error:', error);\r\n            return { \r\n                success: false, \r\n                message: 'Command execution failed. Please try again.' \r\n            };\r\n        }\r\n    }\r\n    \r\n    handleHelp(args) {\r\n        const helpTopics = {\r\n            general: `Available Commands:\r\n help [topic] - Show this help or specific topic help\r\n list - Show available services and features  \r\n info [system] - Display ship or system information\r\n market [item] - Access trading interface\r\n purchase <item> - Buy upgrades or services\r\n enhance <system> - Upgrade ship systems\r\n refuel - Refill fuel tanks\r\n repair [system] - Repair ship systems\r\n scan - Perform system scan\r\n starmap - Open navigation interface\r\n blackjack - Access gaming interface\r\n settings - Configure terminal preferences\r\n undock - Leave stargate terminal\r\n clear - Clear terminal display`,\r\n            \r\n            market: `Market Commands:\r\n market - Show all available items\r\n market resources - Show resource prices\r\n market orbs - Show energy orb values\r\n purchase fuel - Refuel ship (100 CR)\r\n purchase shield - Repair shields (150 CR)\r\n purchase hull - Repair hull (200 CR)`,\r\n            \r\n            upgrade: `Upgrade Commands:\r\n enhance fuel - Upgrade fuel tank capacity\r\n enhance engine - Improve ship speed\r\n enhance mining - Increase mining efficiency\r\n enhance hull - Strengthen ship structure\r\n enhance scanner - Extend detection range`\r\n        };\r\n        \r\n        const topic = args[0] || 'general';\r\n        const helpText = helpTopics[topic] || helpTopics.general;\r\n        \r\n        return { success: true, message: helpText };\r\n    }\r\n    \r\n    handleList() {\r\n        return {\r\n            success: true,\r\n            message: `STARGATE SERVICES:\r\n Ship Maintenance & Repair\r\n Resource Trading Market\r\n Ship System Upgrades\r\n Navigation & Mapping\r\n Entertainment (Stellar Blackjack)\r\n System Configuration\r\n Challenge Modes\r\n\r\nType 'help [service]' for detailed information.`\r\n        };\r\n    }\r\n    \r\n    handleClear() {\r\n        return { success: true, message: '', clearScreen: true };\r\n    }\r\n    \r\n    handleUndock() {\r\n        if (this.stargate && this.stargate.hide) {\r\n            this.stargate.hide();\r\n        }\r\n        return { \r\n            success: true, \r\n            message: 'Undocking from stargate terminal...',\r\n            action: 'undock'\r\n        };\r\n    }\r\n    \r\n    handleInfo(args) {\r\n        const system = args[0] || 'ship';\r\n        \r\n        // This would integrate with actual game state\r\n        return {\r\n            success: true,\r\n            message: `${system.toUpperCase()} STATUS:\r\nSystem information would be displayed here.\r\nUse the GUI panels for detailed status.`\r\n        };\r\n    }\r\n    \r\n    handlePurchase(args) {\r\n        const item = args[0];\r\n        if (!item) {\r\n            return { \r\n                success: false, \r\n                message: 'Please specify an item to purchase. Use \"market\" to see available items.' \r\n            };\r\n        }\r\n        \r\n        return {\r\n            success: true,\r\n            message: `Attempting to purchase ${item}...`,\r\n            action: 'purchase',\r\n            target: item\r\n        };\r\n    }\r\n    \r\n    handleMarket(args) {\r\n        const category = args[0] || 'all';\r\n        \r\n        return {\r\n            success: true,\r\n            message: `MARKET INTERFACE - ${category.toUpperCase()}\r\nUse the market panel for transactions.\r\nType 'help market' for command-line trading.`\r\n        };\r\n    }\r\n    \r\n    handleEnhance(args) {\r\n        const system = args[0];\r\n        if (!system) {\r\n            return { \r\n                success: false, \r\n                message: 'Please specify a system to enhance. Use \"info\" to see available systems.' \r\n            };\r\n        }\r\n        \r\n        return {\r\n            success: true,\r\n            message: `Initiating ${system} enhancement...`,\r\n            action: 'enhance',\r\n            target: system\r\n        };\r\n    }\r\n    \r\n    handleRefuel() {\r\n        return {\r\n            success: true,\r\n            message: 'Initiating refueling sequence...',\r\n            action: 'refuel'\r\n        };\r\n    }\r\n    \r\n    handleRepair(args) {\r\n        const system = args[0] || 'all';\r\n        \r\n        return {\r\n            success: true,\r\n            message: `Initiating ${system} repair sequence...`,\r\n            action: 'repair',\r\n            target: system\r\n        };\r\n    }\r\n    \r\n    handleScan() {\r\n        return {\r\n            success: true,\r\n            message: 'Performing system scan...\\nScan results would appear here.'\r\n        };\r\n    }\r\n    \r\n    handleStarmap() {\r\n        return {\r\n            success: true,\r\n            message: 'Opening stellar cartography interface...',\r\n            action: 'starmap'\r\n        };\r\n    }\r\n    \r\n    handleBlackjack() {\r\n        return {\r\n            success: true,\r\n            message: 'Accessing gaming interface...',\r\n            action: 'blackjack'\r\n        };\r\n    }\r\n    \r\n    handleSettings() {\r\n        return {\r\n            success: true,\r\n            message: 'Opening configuration interface...',\r\n            action: 'settings'\r\n        };\r\n    }\r\n    \r\n    handleHorde() {\r\n        return {\r\n            success: true,\r\n            message: 'WARNING: Prepare for extreme challenge mode...',\r\n            action: 'horde'\r\n        };\r\n    }\r\n}","// messages.js - Terminal text content and UI templates\r\n\r\nexport class TerminalMessages {\r\n    constructor() {\r\n        this.welcomeMessages = [\r\n            'STARGATE TERMINAL ONLINE',\r\n            'QUANTUM LINK ESTABLISHED',\r\n            'NEURAL INTERFACE ACTIVE',\r\n            'SYSTEM READY FOR COMMANDS'\r\n        ];\r\n    }\r\n    \r\n    getMainUIContent() {\r\n        return `\r\n            <!-- Header -->\r\n            <div id=\"stargate-header\">\r\n                <button id=\"undock-btn\" class=\"action-btn btn-undock\" data-no-touch-overlay=\"true\">\r\n                    <span class=\"undock-text\"> UNDOCK </span>\r\n                </button>\r\n                <h2 style=\"text-align: center; color: #33aaff; margin: 0;\">STARGATE TERMINAL</h2>\r\n            </div>\r\n            \r\n            <!-- Main Content Grid -->\r\n            <div id=\"stargate-content\">\r\n                <!-- Ship Status Section -->\r\n                <div id=\"ship-status-section\" class=\"stargate-section\">\r\n                    <h3>SHIP STATUS</h3>\r\n                    ${this.getShipStatusContent()}\r\n                </div>\r\n                \r\n                <!-- Market Section -->\r\n                <div id=\"market-section\" class=\"stargate-section\">\r\n                    <h3>MARKET</h3>\r\n                    ${this.getMarketContent()}\r\n                </div>\r\n                \r\n                <!-- Upgrades Section -->\r\n                <div id=\"upgrades-section\" class=\"stargate-section\">\r\n                    <h3>SHIP UPGRADES</h3>\r\n                    ${this.getUpgradesContent()}\r\n                </div>\r\n                \r\n                <!-- Features Section -->\r\n                <div id=\"features-section\" class=\"stargate-section\">\r\n                    <h3>SERVICES</h3>\r\n                    ${this.getFeaturesContent()}\r\n                </div>\r\n                \r\n                <!-- Challenge Section -->\r\n                <div id=\"challenge-section\" class=\"stargate-section\">\r\n                    <h3>EXTREME CHALLENGE</h3>\r\n                    ${this.getChallengeContent()}\r\n                </div>\r\n            </div>\r\n            \r\n            <!-- Footer -->\r\n            <div id=\"stargate-footer\">\r\n                <!-- Footer now empty, undock button moved to header -->\r\n            </div>\r\n        `;\r\n    }\r\n    \r\n    getShipStatusContent() {\r\n        return `\r\n            <!-- Resources section -->\r\n            <div>\r\n                <h4 style=\"color: #33aaff; margin-top: 0; margin-bottom: 10px;\">RESOURCES</h4>\r\n                <div class=\"resources-container\">\r\n                    <div class=\"resource-display iron-border\">\r\n                        <div style=\"font-weight: bold; font-size: 14px;\">IRON</div>\r\n                        <div id=\"ms-iron\" style=\"font-size: 18px; margin-top: 5px;\">0</div>\r\n                        <div style=\"font-size: 10px; opacity: 0.7;\">UNITS</div>\r\n                    </div>\r\n                    <div class=\"resource-display gold-border\">\r\n                        <div style=\"font-weight: bold; font-size: 14px;\">GOLD</div>\r\n                        <div id=\"ms-gold\" style=\"font-size: 18px; margin-top: 5px;\">0</div>\r\n                        <div style=\"font-size: 10px; opacity: 0.7;\">UNITS</div>\r\n                    </div>\r\n                    <div class=\"resource-display platinum-border\">\r\n                        <div style=\"font-weight: bold; font-size: 14px;\">PLATINUM</div>\r\n                        <div id=\"ms-platinum\" style=\"font-size: 18px; margin-top: 5px;\">0</div>\r\n                        <div style=\"font-size: 10px; opacity: 0.7;\">UNITS</div>\r\n                    </div>\r\n                </div>\r\n                \r\n                <div style=\"margin-top: 15px;\">\r\n                    <h4 style=\"color: #33aaff; margin-top: 0; margin-bottom: 10px;\">CREDITS</h4>\r\n                    <div id=\"ms-credits\" style=\"font-size: 18px; font-weight: bold; color: #ffcc33; text-shadow: 0 0 5px rgba(255, 204, 51, 0.5);\">0 CR</div>\r\n                </div>\r\n            </div>\r\n            \r\n            <!-- Fuel section -->\r\n            <div>\r\n                <div class=\"status-label\">\r\n                    <h4 style=\"color: #00cc33; margin: 0;\">FUEL</h4>\r\n                    <span><span id=\"fuel-level\">100</span>%</span>\r\n                </div>\r\n                <div class=\"status-bar-container\" id=\"fuel-gauge-container\">\r\n                    <div class=\"status-bar\" id=\"fuel-gauge\" style=\"background-color: #00cc33; width: 100%;\"></div>\r\n                </div>\r\n                <button id=\"refuel-btn\" class=\"action-btn btn-fuel\">REFUEL (100 CR)</button>\r\n            </div>\r\n            \r\n            <!-- Shield section -->\r\n            <div>\r\n                <div class=\"status-label\">\r\n                    <h4 style=\"color: #3399ff; margin: 0;\">SHIELD</h4>\r\n                    <span><span id=\"shield-level\">100</span>%</span>\r\n                </div>\r\n                <div class=\"status-bar-container\" id=\"shield-gauge-container\">\r\n                    <div class=\"status-bar\" id=\"shield-gauge\" style=\"background-color: #3399ff; width: 100%;\"></div>\r\n                </div>\r\n                <button id=\"repair-shield-btn\" class=\"action-btn btn-shield\">REPAIR SHIELD (150 CR)</button>\r\n            </div>\r\n            \r\n            <!-- Hull section -->\r\n            <div>\r\n                <div class=\"status-label\">\r\n                    <h4 style=\"color: #ff9900; margin: 0;\">HULL INTEGRITY</h4>\r\n                    <span><span id=\"hull-level\">100</span>%</span>\r\n                </div>\r\n                <div class=\"status-bar-container\" id=\"hull-gauge-container\">\r\n                    <div class=\"status-bar\" id=\"hull-gauge\" style=\"background-color: #ff9900; width: 100%;\"></div>\r\n                </div>\r\n                <button id=\"repair-hull-btn\" class=\"action-btn btn-hull\">REPAIR HULL (200 CR)</button>\r\n            </div>\r\n        `;\r\n    }\r\n    \r\n    getMarketContent() {\r\n        return `\r\n            <!-- Resources Market -->\r\n            <h4 style=\"color: #33aaff; margin-top: 0; margin-bottom: 10px;\">MATERIALS</h4>\r\n            <div class=\"sell-buttons\">\r\n                <button id=\"sell-iron\" class=\"sell-btn iron-border\">\r\n                    <div style=\"font-weight: bold;\">SELL IRON</div>\r\n                    <div style=\"font-size: 12px; margin-top: 3px;\">(10 CR each)</div>\r\n                </button>\r\n                <button id=\"sell-gold\" class=\"sell-btn gold-border\">\r\n                    <div style=\"font-weight: bold;\">SELL GOLD</div>\r\n                    <div style=\"font-size: 12px; margin-top: 3px;\">(50 CR each)</div>\r\n                </button>\r\n                <button id=\"sell-platinum\" class=\"sell-btn platinum-border\">\r\n                    <div style=\"font-weight: bold;\">SELL PLATINUM</div>\r\n                    <div style=\"font-size: 12px; margin-top: 3px;\">(200 CR each)</div>\r\n                </button>\r\n            </div>\r\n            \r\n            <!-- Energy Orbs Market -->\r\n            <h4 style=\"color: #33aaff; margin-top: 20px; margin-bottom: 10px;\">ENERGY ORBS</h4>\r\n            <div style=\"font-size: 14px; color: #aaa; margin-bottom: 10px;\">\r\n                Valuable artifacts collected from space anomalies. Increasing rarity yields higher value.\r\n            </div>\r\n            \r\n            <div class=\"orb-buttons\">\r\n                ${this.getOrbButtons()}\r\n            </div>\r\n            \r\n            <!-- Deployable Weapons Section -->\r\n            <h4 style=\"color: #33aaff; margin-top: 20px; margin-bottom: 10px;\">DEPLOYABLE WEAPONS</h4>\r\n            <div class=\"upgrade-item\">\r\n                <div style=\"display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;\">\r\n                    <div>\r\n                        <strong style=\"color: #FF3333;\">Laser Turrets:</strong> <span id=\"current-laser-count\">0</span>\r\n                    </div>\r\n                </div>\r\n                <div style=\"display: flex; justify-content: space-between; align-items: center;\">\r\n                    <div style=\"flex: 2; padding-right: 10px;\">\r\n                        <p style=\"margin: 0; font-size: 12px;\">Deployable laser turrets automatically target and fire at enemies within 1000m range.</p>\r\n                    </div>\r\n                    <button id=\"purchase-laser\" style=\"flex: 1; padding: 10px; background-color: #FF3333; color: #fff; border: none; border-radius: 5px; cursor: pointer; font-family: 'Courier New', monospace; font-weight: bold;\">\r\n                        PURCHASE (1000 CR)\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        `;\r\n    }\r\n    \r\n    getOrbButtons() {\r\n        const orbs = [\r\n            { type: 'common', price: 100 },\r\n            { type: 'uncommon', price: 500 },\r\n            { type: 'rare', price: 1500 },\r\n            { type: 'epic', price: 5000 },\r\n            { type: 'legendary', price: 15000 }\r\n        ];\r\n        \r\n        return orbs.map(orb => `\r\n            <button id=\"sell-orb-${orb.type}\" class=\"sell-btn ${orb.type}-border\">\r\n                <div style=\"font-weight: bold;\">${orb.type.toUpperCase()} ORB</div>\r\n                <div id=\"orb-${orb.type}-count\" style=\"font-size: 12px;\">0 in inventory</div>\r\n                <div style=\"font-size: 12px; margin-top: 3px;\">(${orb.price.toLocaleString()} CR each)</div>\r\n            </button>\r\n        `).join('');\r\n    }\r\n    \r\n    getUpgradesContent() {\r\n        const upgrades = [\r\n            { type: 'fuel', name: 'Fuel Tank', color: '#00cc33', description: 'Increases maximum fuel capacity, allowing for longer journeys.' },\r\n            { type: 'engine', name: 'Engine', color: '#ff9900', description: 'Enhances thruster power, increasing maximum velocity and maneuverability.' },\r\n            { type: 'mining', name: 'Mining Laser', color: '#ff3030', description: 'Increases mining speed and extraction efficiency, allowing faster resource collection.' },\r\n            { type: 'hull', name: 'Hull', color: '#30cfd0', description: 'Reinforces ship structure, improving collision resistance and reducing damage.' },\r\n            { type: 'scanner', name: 'Scanner', color: '#9933cc', description: 'Extends scanner range for detecting asteroids and other objects at greater distances.' }\r\n        ];\r\n        \r\n        return upgrades.map(upgrade => this.getUpgradeItemHTML(upgrade)).join('');\r\n    }\r\n    \r\n    getUpgradeItemHTML(upgrade) {\r\n        const buttonColor = upgrade.color === '#ff3030' || upgrade.color === '#9933cc' ? '#fff' : '#000';\r\n        \r\n        return `\r\n            <div class=\"upgrade-item\">\r\n                <div class=\"upgrade-header\">\r\n                    <div>\r\n                        <strong style=\"color: ${upgrade.color};\">${upgrade.name} Level:</strong> <span id=\"current-${upgrade.type}-level\">1</span>\r\n                    </div>\r\n                    <div style=\"text-align: right;\">\r\n                        <strong>Current:</strong> <span id=\"current-${upgrade.type}-capacity\">--</span>\r\n                        <br>\r\n                        <small style=\"opacity: 0.8;\">Next: <span id=\"next-${upgrade.type}-capacity\">--</span></small>\r\n                    </div>\r\n                </div>\r\n                <div class=\"upgrade-progress\">\r\n                    <div id=\"${upgrade.type}-upgrade-progress\" class=\"upgrade-progress-bar\" style=\"background-color: ${upgrade.color}; width: 20%;\"></div>\r\n                </div>\r\n                <div class=\"upgrade-footer\">\r\n                    <div class=\"upgrade-description\">\r\n                        <p style=\"margin: 0; font-size: 12px;\">${upgrade.description}</p>\r\n                    </div>\r\n                    <button id=\"upgrade-${upgrade.type}\" style=\"flex: 1; padding: 10px; background-color: ${upgrade.color}; color: ${buttonColor}; border: none; border-radius: 5px; cursor: pointer; font-family: 'Courier New', monospace; font-weight: bold;\">\r\n                        UPGRADE (<span id=\"${upgrade.type}-upgrade-cost\">1000</span> CR)\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        `;\r\n    }\r\n    \r\n    getFeaturesContent() {\r\n        return `\r\n            <div class=\"feature-buttons\">\r\n                <button id=\"open-star-map\" class=\"feature-btn\" style=\"background-color: #30cfd0;\">\r\n                    STAR MAP\r\n                    <small>Access star systems navigation</small>\r\n                </button>\r\n                <button id=\"create-custom-system\" class=\"feature-btn\" style=\"background: linear-gradient(135deg, #2c5a8c 0%, #4a76a8 100%); border: 1px solid #4a9dff; box-shadow: 0 0 10px rgba(74, 157, 255, 0.3);\">\r\n                    CREATE NEW SYSTEM\r\n                    <small>Generate custom AI star systems</small>\r\n                </button>\r\n                <button id=\"open-blackjack\" class=\"feature-btn\" style=\"background-color: #9933cc;\">\r\n                    STELLAR BLACKJACK\r\n                    <small>Wager resources in card games</small>\r\n                </button>\r\n                <button id=\"open-settings\" class=\"feature-btn\" style=\"background-color: #33aaff;\">\r\n                    SETTINGS\r\n                    <small>Adjust graphics and audio options</small>\r\n                </button>\r\n            </div>\r\n        `;\r\n    }\r\n    \r\n    getChallengeContent() {\r\n        return `\r\n            <button id=\"unleash-horde\" class=\"action-btn btn-horde\">\r\n                UNLEASH THE HORDE\r\n            </button>\r\n            <p style=\"font-size: 12px; color: #ff9999; margin: 10px 0 0 0;\">WARNING: Activate extreme survival mode with infinitely scaling difficulty</p>\r\n        `;\r\n    }\r\n    \r\n    getRandomWelcomeMessage() {\r\n        return this.welcomeMessages[Math.floor(Math.random() * this.welcomeMessages.length)];\r\n    }\r\n}","// ascii.js - ASCII art, animations, and visual content\r\n\r\nexport class TerminalAscii {\r\n    constructor() {\r\n        this.animationFrames = new Map();\r\n        this.currentAnimations = new Map();\r\n    }\r\n    \r\n    getStargateArt() {\r\n        return `\r\n    \r\n                            STARGATE TERMINAL                       \r\n                                                \r\n                                                          \r\n                              QUANTUM                          \r\n                             LINK CORE                         \r\n                                                               \r\n                                                          \r\n                                                \r\n    \r\n        `;\r\n    }\r\n    \r\n    getShipArt() {\r\n        return `\r\n              \r\n              \r\n            \r\n                \r\n               \r\n                \r\n                 \r\n           \r\n               \r\n              \r\n              \r\n        `;\r\n    }\r\n    \r\n    getLoadingAnimation() {\r\n        return [\r\n            ' Processing...',\r\n            ' Processing...',\r\n            ' Processing...',\r\n            ' Processing...',\r\n            ' Processing...',\r\n            ' Processing...',\r\n            ' Processing...',\r\n            ' Processing...',\r\n            ' Processing...',\r\n            ' Processing...'\r\n        ];\r\n    }\r\n    \r\n    getProgressBar(percentage, width = 20) {\r\n        const filled = Math.floor((percentage / 100) * width);\r\n        const empty = width - filled;\r\n        return `[${''.repeat(filled)}${''.repeat(empty)}] ${percentage}%`;\r\n    }\r\n    \r\n    getSystemStatus(systems) {\r\n        const statusChars = {\r\n            online: '',\r\n            offline: '',\r\n            warning: '',\r\n            error: ''\r\n        };\r\n        \r\n        let art = '    SYSTEM STATUS\\n';\r\n        art += '    \\n';\r\n        \r\n        for (const [name, status] of Object.entries(systems)) {\r\n            const char = statusChars[status] || '?';\r\n            const color = this.getStatusColor(status);\r\n            art += `     ${char} ${name.padEnd(13)} \\n`;\r\n        }\r\n        \r\n        art += '    ';\r\n        return art;\r\n    }\r\n    \r\n    getStatusColor(status) {\r\n        const colors = {\r\n            online: '#00ff00',\r\n            offline: '#666666',\r\n            warning: '#ffaa00',\r\n            error: '#ff0000'\r\n        };\r\n        return colors[status] || '#ffffff';\r\n    }\r\n    \r\n    getResourceMeter(resource, amount, max) {\r\n        const percentage = Math.min(100, (amount / max) * 100);\r\n        const bars = Math.floor(percentage / 10);\r\n        const meter = ''.repeat(bars) + ''.repeat(10 - bars);\r\n        \r\n        return `${resource.toUpperCase().padEnd(8)} [${meter}] ${amount}/${max}`;\r\n    }\r\n    \r\n    getBanner(text) {\r\n        const width = Math.max(text.length + 4, 20);\r\n        const line = ''.repeat(width);\r\n        const padding = ' '.repeat(Math.floor((width - text.length) / 2));\r\n        \r\n        return `\r\n${line}\r\n${padding}${text}${padding}\r\n${line}`;\r\n    }\r\n    \r\n    getAlert(message, type = 'info') {\r\n        const icons = {\r\n            info: '',\r\n            warning: '',\r\n            error: '',\r\n            success: ''\r\n        };\r\n        \r\n        const icon = icons[type] || '';\r\n        const border = type === 'error' ? '!' : type === 'warning' ? '!' : '-';\r\n        const line = border.repeat(message.length + 6);\r\n        \r\n        return `\r\n${line}\r\n${border} ${icon} ${message} ${border}\r\n${line}`;\r\n    }\r\n    \r\n    getConnectionAnimation() {\r\n        return [\r\n            'Connecting    .',\r\n            'Connecting   ..',\r\n            'Connecting  ...',\r\n            'Connecting .... ',\r\n            'Connecting....  ',\r\n            'Connecting...   ',\r\n            'Connecting..    ',\r\n            'Connecting.     '\r\n        ];\r\n    }\r\n    \r\n    getQuantumPattern() {\r\n        return `\r\n            \r\n            \r\n            \r\n            \r\n            \r\n        `;\r\n    }\r\n    \r\n    startAnimation(name, frames, interval = 500) {\r\n        if (this.currentAnimations.has(name)) {\r\n            this.stopAnimation(name);\r\n        }\r\n        \r\n        let frameIndex = 0;\r\n        const animation = setInterval(() => {\r\n            frameIndex = (frameIndex + 1) % frames.length;\r\n            this.animationFrames.set(name, frames[frameIndex]);\r\n        }, interval);\r\n        \r\n        this.currentAnimations.set(name, animation);\r\n        this.animationFrames.set(name, frames[0]);\r\n    }\r\n    \r\n    stopAnimation(name) {\r\n        const animation = this.currentAnimations.get(name);\r\n        if (animation) {\r\n            clearInterval(animation);\r\n            this.currentAnimations.delete(name);\r\n            this.animationFrames.delete(name);\r\n        }\r\n    }\r\n    \r\n    getAnimationFrame(name) {\r\n        return this.animationFrames.get(name) || '';\r\n    }\r\n    \r\n    createMatrix(rows, cols, char = '') {\r\n        let matrix = '';\r\n        for (let i = 0; i < rows; i++) {\r\n            for (let j = 0; j < cols; j++) {\r\n                matrix += Math.random() > 0.7 ? char : ' ';\r\n            }\r\n            matrix += '\\n';\r\n        }\r\n        return matrix;\r\n    }\r\n    \r\n    getHordeWarning() {\r\n        return `\r\n      \r\n  \r\n       \r\n       \r\n    \r\n       \r\n                                         \r\n                \r\n          \r\n       \r\n    \r\n       \r\n             \r\n        `;\r\n    }\r\n}","// keyboard.js - Keyboard event handling and input management\r\n\r\nexport class TerminalKeyboard {\r\n    constructor() {\r\n        this.keyHandlers = new Map();\r\n        this.inputBuffer = '';\r\n        this.isActive = false;\r\n        this.modifiers = {\r\n            shift: false,\r\n            ctrl: false,\r\n            alt: false\r\n        };\r\n        this.setupEventListeners();\r\n    }\r\n    \r\n    setupEventListeners() {\r\n        document.addEventListener('keydown', this.handleKeyDown.bind(this));\r\n        document.addEventListener('keyup', this.handleKeyUp.bind(this));\r\n        document.addEventListener('keypress', this.handleKeyPress.bind(this));\r\n    }\r\n    \r\n    handleKeyDown(event) {\r\n        if (!this.isActive) return;\r\n        \r\n        this.updateModifiers(event, true);\r\n        \r\n        // Handle special keys\r\n        switch (event.code) {\r\n            case 'Enter':\r\n                this.handleEnter(event);\r\n                break;\r\n            case 'Escape':\r\n                this.handleEscape(event);\r\n                break;\r\n            case 'Tab':\r\n                this.handleTab(event);\r\n                break;\r\n            case 'ArrowUp':\r\n                this.handleArrowUp(event);\r\n                break;\r\n            case 'ArrowDown':\r\n                this.handleArrowDown(event);\r\n                break;\r\n            case 'Backspace':\r\n                this.handleBackspace(event);\r\n                break;\r\n            case 'Delete':\r\n                this.handleDelete(event);\r\n                break;\r\n            case 'Home':\r\n                this.handleHome(event);\r\n                break;\r\n            case 'End':\r\n                this.handleEnd(event);\r\n                break;\r\n            default:\r\n                // Handle function keys and other special keys\r\n                if (event.code.startsWith('F')) {\r\n                    this.handleFunctionKey(event);\r\n                }\r\n                break;\r\n        }\r\n        \r\n        // Handle key combinations\r\n        if (this.modifiers.ctrl) {\r\n            this.handleCtrlCombination(event);\r\n        }\r\n        \r\n        if (this.modifiers.alt) {\r\n            this.handleAltCombination(event);\r\n        }\r\n    }\r\n    \r\n    handleKeyUp(event) {\r\n        this.updateModifiers(event, false);\r\n    }\r\n    \r\n    handleKeyPress(event) {\r\n        if (!this.isActive) return;\r\n        \r\n        // Handle printable characters\r\n        if (event.charCode >= 32 && event.charCode <= 126) {\r\n            this.handleCharacterInput(event.key);\r\n        }\r\n    }\r\n    \r\n    updateModifiers(event, pressed) {\r\n        if (event.code === 'ShiftLeft' || event.code === 'ShiftRight') {\r\n            this.modifiers.shift = pressed;\r\n        }\r\n        if (event.code === 'ControlLeft' || event.code === 'ControlRight') {\r\n            this.modifiers.ctrl = pressed;\r\n        }\r\n        if (event.code === 'AltLeft' || event.code === 'AltRight') {\r\n            this.modifiers.alt = pressed;\r\n        }\r\n    }\r\n    \r\n    handleEnter(event) {\r\n        event.preventDefault();\r\n        this.triggerHandler('enter', {\r\n            input: this.inputBuffer,\r\n            modifiers: { ...this.modifiers }\r\n        });\r\n        this.inputBuffer = '';\r\n    }\r\n    \r\n    handleEscape(event) {\r\n        event.preventDefault();\r\n        this.triggerHandler('escape', {\r\n            modifiers: { ...this.modifiers }\r\n        });\r\n        this.inputBuffer = '';\r\n    }\r\n    \r\n    handleTab(event) {\r\n        event.preventDefault();\r\n        this.triggerHandler('tab', {\r\n            input: this.inputBuffer,\r\n            modifiers: { ...this.modifiers }\r\n        });\r\n    }\r\n    \r\n    handleArrowUp(event) {\r\n        event.preventDefault();\r\n        this.triggerHandler('arrowUp', {\r\n            modifiers: { ...this.modifiers }\r\n        });\r\n    }\r\n    \r\n    handleArrowDown(event) {\r\n        event.preventDefault();\r\n        this.triggerHandler('arrowDown', {\r\n            modifiers: { ...this.modifiers }\r\n        });\r\n    }\r\n    \r\n    handleBackspace(event) {\r\n        event.preventDefault();\r\n        if (this.inputBuffer.length > 0) {\r\n            this.inputBuffer = this.inputBuffer.slice(0, -1);\r\n            this.triggerHandler('backspace', {\r\n                input: this.inputBuffer,\r\n                modifiers: { ...this.modifiers }\r\n            });\r\n        }\r\n    }\r\n    \r\n    handleDelete(event) {\r\n        event.preventDefault();\r\n        this.triggerHandler('delete', {\r\n            input: this.inputBuffer,\r\n            modifiers: { ...this.modifiers }\r\n        });\r\n    }\r\n    \r\n    handleHome(event) {\r\n        event.preventDefault();\r\n        this.triggerHandler('home', {\r\n            modifiers: { ...this.modifiers }\r\n        });\r\n    }\r\n    \r\n    handleEnd(event) {\r\n        event.preventDefault();\r\n        this.triggerHandler('end', {\r\n            modifiers: { ...this.modifiers }\r\n        });\r\n    }\r\n    \r\n    handleFunctionKey(event) {\r\n        event.preventDefault();\r\n        const functionNumber = parseInt(event.code.substring(1));\r\n        this.triggerHandler('function', {\r\n            functionNumber,\r\n            modifiers: { ...this.modifiers }\r\n        });\r\n    }\r\n    \r\n    handleCtrlCombination(event) {\r\n        switch (event.code) {\r\n            case 'KeyC':\r\n                event.preventDefault();\r\n                this.triggerHandler('ctrlC', {\r\n                    input: this.inputBuffer,\r\n                    modifiers: { ...this.modifiers }\r\n                });\r\n                break;\r\n            case 'KeyV':\r\n                event.preventDefault();\r\n                this.handlePaste();\r\n                break;\r\n            case 'KeyA':\r\n                event.preventDefault();\r\n                this.triggerHandler('ctrlA', {\r\n                    input: this.inputBuffer,\r\n                    modifiers: { ...this.modifiers }\r\n                });\r\n                break;\r\n            case 'KeyL':\r\n                event.preventDefault();\r\n                this.triggerHandler('ctrlL', {\r\n                    modifiers: { ...this.modifiers }\r\n                });\r\n                break;\r\n        }\r\n    }\r\n    \r\n    handleAltCombination(event) {\r\n        // Handle Alt+key combinations\r\n        this.triggerHandler('alt', {\r\n            key: event.code,\r\n            modifiers: { ...this.modifiers }\r\n        });\r\n    }\r\n    \r\n    handleCharacterInput(character) {\r\n        this.inputBuffer += character;\r\n        this.triggerHandler('character', {\r\n            character,\r\n            input: this.inputBuffer,\r\n            modifiers: { ...this.modifiers }\r\n        });\r\n    }\r\n    \r\n    async handlePaste() {\r\n        try {\r\n            const text = await navigator.clipboard.readText();\r\n            this.inputBuffer += text;\r\n            this.triggerHandler('paste', {\r\n                text,\r\n                input: this.inputBuffer,\r\n                modifiers: { ...this.modifiers }\r\n            });\r\n        } catch (error) {\r\n            console.warn('Clipboard access failed:', error);\r\n        }\r\n    }\r\n    \r\n    registerHandler(event, callback) {\r\n        if (!this.keyHandlers.has(event)) {\r\n            this.keyHandlers.set(event, []);\r\n        }\r\n        this.keyHandlers.get(event).push(callback);\r\n    }\r\n    \r\n    unregisterHandler(event, callback) {\r\n        const handlers = this.keyHandlers.get(event);\r\n        if (handlers) {\r\n            const index = handlers.indexOf(callback);\r\n            if (index > -1) {\r\n                handlers.splice(index, 1);\r\n            }\r\n        }\r\n    }\r\n    \r\n    triggerHandler(event, data) {\r\n        const handlers = this.keyHandlers.get(event);\r\n        if (handlers) {\r\n            handlers.forEach(handler => {\r\n                try {\r\n                    handler(data);\r\n                } catch (error) {\r\n                    console.error(`Error in ${event} handler:`, error);\r\n                }\r\n            });\r\n        }\r\n    }\r\n    \r\n    activate() {\r\n        this.isActive = true;\r\n        this.inputBuffer = '';\r\n    }\r\n    \r\n    deactivate() {\r\n        this.isActive = false;\r\n        this.inputBuffer = '';\r\n    }\r\n    \r\n    clearInput() {\r\n        this.inputBuffer = '';\r\n    }\r\n    \r\n    getInput() {\r\n        return this.inputBuffer;\r\n    }\r\n    \r\n    setInput(text) {\r\n        this.inputBuffer = text || '';\r\n    }\r\n}","// terminalView.js - Main terminal view coordinator\r\n\r\n// Import all terminal modules\r\nimport { TerminalScreen } from './terminal/display/screen.js';\r\nimport { TerminalEffects } from './terminal/display/effects.js';\r\nimport { CommandParser } from './terminal/commands/parser.js';\r\nimport { CommandHandlers } from './terminal/commands/handlers.js';\r\nimport { TerminalMessages } from './terminal/content/messages.js';\r\nimport { TerminalAscii } from './terminal/content/ascii.js';\r\nimport { TerminalKeyboard } from './terminal/input/keyboard.js';\r\n\r\nexport class TerminalView {\r\n    constructor() {\r\n        this.isMobile = false;\r\n        \r\n        // Initialize all modules\r\n        this.screen = new TerminalScreen();\r\n        this.effects = new TerminalEffects();\r\n        this.parser = new CommandParser();\r\n        this.handlers = new CommandHandlers(this);\r\n        this.messages = new TerminalMessages();\r\n        this.ascii = new TerminalAscii();\r\n        this.keyboard = new TerminalKeyboard();\r\n        \r\n        this.setupKeyboardHandlers();\r\n    }\r\n    \r\n    setMobile(isMobile) {\r\n        this.isMobile = isMobile;\r\n        this.screen.setMobile(isMobile);\r\n    }\r\n    \r\n    setupKeyboardHandlers() {\r\n        // Register keyboard event handlers for terminal commands\r\n        this.keyboard.registerHandler('enter', (data) => {\r\n            if (data.input.trim()) {\r\n                this.handleCommand(data.input);\r\n            }\r\n        });\r\n        \r\n        this.keyboard.registerHandler('escape', () => {\r\n            this.hide();\r\n        });\r\n        \r\n        this.keyboard.registerHandler('ctrlL', () => {\r\n            this.clearTerminal();\r\n        });\r\n    }\r\n    \r\n    async handleCommand(input) {\r\n        const parsed = this.parser.parseCommand(input);\r\n        const result = await this.handlers.executeCommand(parsed);\r\n        \r\n        if (result.clearScreen) {\r\n            this.clearTerminal();\r\n        } else if (result.message) {\r\n            this.displayMessage(result.message);\r\n        }\r\n        \r\n        // Handle specific actions\r\n        if (result.action) {\r\n            this.handleAction(result.action, result.target);\r\n        }\r\n    }\r\n    \r\n    handleAction(action, target) {\r\n        // This would trigger the appropriate stargate interface actions\r\n        switch (action) {\r\n            case 'undock':\r\n                this.hide();\r\n                break;\r\n            case 'refuel':\r\n                this.triggerRefuel();\r\n                break;\r\n            case 'repair':\r\n                this.triggerRepair(target);\r\n                break;\r\n            case 'enhance':\r\n                this.triggerUpgrade(target);\r\n                break;\r\n            case 'purchase':\r\n                this.triggerPurchase(target);\r\n                break;\r\n            // Add more actions as needed\r\n        }\r\n    }\r\n    \r\n    displayMessage(message) {\r\n        // This would display the message in a terminal-style interface\r\n        console.log('Terminal:', message);\r\n    }\r\n    \r\n    clearTerminal() {\r\n        // Clear terminal display\r\n        console.clear();\r\n    }\r\n    \r\n    // Delegate methods to modules\r\n    createStyles() {\r\n        this.effects.createStyles();\r\n    }\r\n    \r\n    createDockingPrompt() {\r\n        return this.screen.createDockingPrompt();\r\n    }\r\n    \r\n    createMainUI() {\r\n        return this.screen.createMainUI();\r\n    }\r\n    \r\n    getMainUIContent() {\r\n        return this.messages.getMainUIContent();\r\n    }\r\n    \r\n    getUpgradesContent() {\r\n        return this.messages.getUpgradesContent();\r\n    }\r\n    \r\n    showDockingPrompt() {\r\n        this.screen.showDockingPrompt();\r\n    }\r\n    \r\n    hideDockingPrompt() {\r\n        this.screen.hideDockingPrompt();\r\n    }\r\n    \r\n    show() {\r\n        this.screen.showUI();\r\n        this.keyboard.activate();\r\n    }\r\n    \r\n    hide() {\r\n        this.screen.hideUI();\r\n        this.keyboard.deactivate();\r\n    }\r\n    \r\n    // Event trigger methods for stargate interface integration\r\n    triggerRefuel() {\r\n        // To be implemented by the parent stargate interface\r\n        console.log('Refuel triggered');\r\n    }\r\n    \r\n    triggerRepair(system) {\r\n        // To be implemented by the parent stargate interface\r\n        console.log('Repair triggered for:', system);\r\n    }\r\n    \r\n    triggerUpgrade(system) {\r\n        // To be implemented by the parent stargate interface\r\n        console.log('Upgrade triggered for:', system);\r\n    }\r\n    \r\n    triggerPurchase(item) {\r\n        // To be implemented by the parent stargate interface\r\n        console.log('Purchase triggered for:', item);\r\n    }\r\n}","// systemsView.js - Systems list and navigation UI\r\n\r\nexport class SystemsView {\r\n    constructor() {\r\n        this.starMap = null;\r\n        this.blackjackGame = null;\r\n        this.settings = null;\r\n    }\r\n    \r\n    setStarMap(starMap) {\r\n        this.starMap = starMap;\r\n    }\r\n    \r\n    setBlackjackGame(blackjackGame) {\r\n        this.blackjackGame = blackjackGame;\r\n    }\r\n    \r\n    setSettings(settings) {\r\n        this.settings = settings;\r\n    }\r\n    \r\n    setupStarMapButton() {\r\n        const starMapButton = document.getElementById('open-star-map');\r\n        if (starMapButton && this.starMap) {\r\n            starMapButton.addEventListener('click', () => {\r\n                console.log(\"Opening star map\");\r\n                this.hideStargateUI();\r\n                this.starMap.show();\r\n            });\r\n        } else if (starMapButton) {\r\n            // If star map not available, disable the button\r\n            starMapButton.disabled = true;\r\n            starMapButton.style.backgroundColor = '#555';\r\n            starMapButton.style.cursor = 'not-allowed';\r\n            starMapButton.title = 'Star map not available';\r\n        }\r\n    }\r\n    \r\n    setupBlackjackButton() {\r\n        const blackjackButton = document.getElementById('open-blackjack');\r\n        if (blackjackButton && this.blackjackGame) {\r\n            blackjackButton.addEventListener('click', () => {\r\n                console.log(\"Opening blackjack game\");\r\n                this.hideStargateUI();\r\n                this.blackjackGame.show();\r\n            });\r\n        } else if (blackjackButton) {\r\n            // If blackjack game not available, disable the button\r\n            blackjackButton.disabled = true;\r\n            blackjackButton.style.backgroundColor = '#555';\r\n            blackjackButton.style.cursor = 'not-allowed';\r\n            blackjackButton.title = 'Blackjack game not available';\r\n        }\r\n    }\r\n    \r\n    setupSettingsButton() {\r\n        if (!this.settings) return;\r\n        \r\n        const settingsButton = document.getElementById('open-settings');\r\n        if (settingsButton) {\r\n            settingsButton.addEventListener('click', () => {\r\n                console.log(\"Opening settings\");\r\n                this.hideStargateUI();\r\n                this.settings.show();\r\n            });\r\n        }\r\n    }\r\n    \r\n    setupCustomSystemButton() {\r\n        const customSystemBtn = document.getElementById('create-custom-system');\r\n        if (customSystemBtn) {\r\n            customSystemBtn.addEventListener('click', () => {\r\n                // Check if custom system creator is available on environment\r\n                if (window.game && window.game.environment && window.game.environment.customSystemCreator) {\r\n                    // Close stargate interface\r\n                    this.hideStargateUI();\r\n                    \r\n                    // Show custom system creator\r\n                    window.game.environment.customSystemCreator.show();\r\n                } else {\r\n                    console.error('Custom system creator not available');\r\n                }\r\n            });\r\n        }\r\n    }\r\n    \r\n    hideStargateUI() {\r\n        const stargateUI = document.getElementById('stargate-ui');\r\n        if (stargateUI) {\r\n            stargateUI.style.display = 'none';\r\n        }\r\n    }\r\n    \r\n    setupAllSystemButtons() {\r\n        this.setupStarMapButton();\r\n        this.setupBlackjackButton();\r\n        this.setupSettingsButton();\r\n        this.setupCustomSystemButton();\r\n    }\r\n}","// tradingView.js - Trading interface components and logic\r\n\r\nexport class TradingView {\r\n    constructor() {\r\n        this.spaceship = null;\r\n        this.resources = null;\r\n    }\r\n    \r\n    setGameReferences(spaceship, resources) {\r\n        this.spaceship = spaceship;\r\n        this.resources = resources;\r\n    }\r\n    \r\n    // Sell an energy orb of the specified rarity\r\n    sellEnergyOrb(rarity) {\r\n        // Make sure we have spaceship and resources references\r\n        if (!this.spaceship || !this.resources) {\r\n            console.error(\"Required game objects not available\");\r\n            return false;\r\n        }\r\n        \r\n        // Check if orbs property exists, initialize if needed\r\n        if (!this.resources.orbs) {\r\n            this.resources.orbs = {\r\n                common: 0,\r\n                uncommon: 0,\r\n                rare: 0,\r\n                epic: 0,\r\n                legendary: 0\r\n            };\r\n            return false; // No orbs available yet\r\n        }\r\n        \r\n        // Check if player has any orbs of the specified rarity\r\n        if (!this.resources.orbs[rarity] || this.resources.orbs[rarity] <= 0) {\r\n            console.log(`No ${rarity} orbs available to sell`);\r\n            return false;\r\n        }\r\n        \r\n        // Calculate value based on rarity\r\n        let value = 0;\r\n        switch (rarity) {\r\n            case 'common':\r\n                value = 100;\r\n                break;\r\n            case 'uncommon':\r\n                value = 500;\r\n                break;\r\n            case 'rare':\r\n                value = 1500;\r\n                break;\r\n            case 'epic':\r\n                value = 5000;\r\n                break;\r\n            case 'legendary':\r\n                value = 15000;\r\n                break;\r\n            default:\r\n                console.error(`Unknown orb rarity: ${rarity}`);\r\n                return false;\r\n        }\r\n        \r\n        // Sell the orb - update inventory and credits\r\n        this.resources.orbs[rarity]--;\r\n        this.spaceship.credits += value;\r\n        \r\n        // Show message\r\n        const capitalizedRarity = rarity.charAt(0).toUpperCase() + rarity.slice(1);\r\n        this.showNotification(`Sold ${capitalizedRarity} Energy Orb for ${value} credits`, 0x33aaff);\r\n        \r\n        // Play sound if audio manager is available\r\n        if (window.game && window.game.audio) {\r\n            window.game.audio.playSoundEffect('sell', 0.5);\r\n        }\r\n        \r\n        return true;\r\n    }\r\n    \r\n    /**\r\n     * Purchase a deployable laser turret\r\n     */\r\n    purchaseLaserTurret() {\r\n        console.log(\"Attempting to purchase laser turret\");\r\n        \r\n        // Check if spaceship is available\r\n        if (!this.spaceship) {\r\n            console.error(\"Cannot purchase laser turret: spaceship not found\");\r\n            return;\r\n        }\r\n        \r\n        // Check if player has enough credits\r\n        if (this.spaceship.credits < 1000) {\r\n            console.log(\"Not enough credits to purchase laser turret\");\r\n            // Show notification to the player\r\n            if (window.mainMessageBus) {\r\n                window.mainMessageBus.publish('ui.notification', {\r\n                    message: \"Not enough credits to purchase laser turret\",\r\n                    type: \"error\",\r\n                    duration: 2\r\n                });\r\n            }\r\n            return;\r\n        }\r\n        \r\n        // Purchase the laser turret\r\n        this.spaceship.credits -= 1000;\r\n        \r\n        // Initialize deployableLaserCount if it doesn't exist\r\n        if (typeof this.spaceship.deployableLaserCount === 'undefined') {\r\n            this.spaceship.deployableLaserCount = 0;\r\n        }\r\n        \r\n        // Add a laser turret to the player's inventory\r\n        this.spaceship.deployableLaserCount++;\r\n        \r\n        // Play purchase sound\r\n        if (window.game && window.game.audio && window.game.audio.playSound) {\r\n            window.game.audio.playSound('purchase');\r\n        }\r\n        \r\n        // Show notification to the player\r\n        if (window.mainMessageBus) {\r\n            window.mainMessageBus.publish('ui.notification', {\r\n                message: \"Laser turret purchased\",\r\n                type: \"success\",\r\n                duration: 2\r\n            });\r\n        }\r\n        \r\n        console.log(\"Laser turret purchased successfully\");\r\n    }\r\n    \r\n    // Helper method to show notifications\r\n    showNotification(message, color = 0x33aaff) {\r\n        // Create notification element\r\n        const notification = document.createElement('div');\r\n        notification.style.position = 'fixed';\r\n        notification.style.top = '35%';\r\n        notification.style.left = '50%';\r\n        notification.style.transform = 'translate(-50%, -50%)';\r\n        notification.style.backgroundColor = 'rgba(0, 0, 0, 0.8)';\r\n        notification.style.color = '#fff';\r\n        notification.style.padding = '15px 30px';\r\n        notification.style.borderRadius = '10px';\r\n        notification.style.border = `2px solid #${color.toString(16).padStart(6, '0')}`;\r\n        notification.style.boxShadow = `0 0 15px #${color.toString(16).padStart(6, '0')}`;\r\n        notification.style.fontFamily = 'Courier New, monospace';\r\n        notification.style.fontSize = '16px';\r\n        notification.style.zIndex = '1001'; // Above the stargate UI\r\n        notification.style.textAlign = 'center';\r\n        \r\n        // Set notification text\r\n        notification.textContent = message;\r\n        \r\n        // Add to DOM\r\n        document.body.appendChild(notification);\r\n        \r\n        // Remove after a few seconds\r\n        setTimeout(() => {\r\n            notification.style.opacity = '0';\r\n            notification.style.transition = 'opacity 0.8s';\r\n            \r\n            setTimeout(() => {\r\n                notification.remove();\r\n            }, 800);\r\n        }, 2000);\r\n    }\r\n    \r\n    updateOrbCounts() {\r\n        if (!this.resources.orbs) {\r\n            this.resources.orbs = {\r\n                common: 0,\r\n                uncommon: 0,\r\n                rare: 0,\r\n                epic: 0,\r\n                legendary: 0\r\n            };\r\n        }\r\n        \r\n        // Update orb counts\r\n        document.getElementById('orb-common-count').textContent = this.resources.orbs.common > 0 ? \r\n            `${this.resources.orbs.common} in inventory` : \"0 in inventory\";\r\n        document.getElementById('orb-uncommon-count').textContent = this.resources.orbs.uncommon > 0 ? \r\n            `${this.resources.orbs.uncommon} in inventory` : \"0 in inventory\";\r\n        document.getElementById('orb-rare-count').textContent = this.resources.orbs.rare > 0 ? \r\n            `${this.resources.orbs.rare} in inventory` : \"0 in inventory\";\r\n        document.getElementById('orb-epic-count').textContent = this.resources.orbs.epic > 0 ? \r\n            `${this.resources.orbs.epic} in inventory` : \"0 in inventory\";\r\n        document.getElementById('orb-legendary-count').textContent = this.resources.orbs.legendary > 0 ? \r\n            `${this.resources.orbs.legendary} in inventory` : \"0 in inventory\";\r\n    }\r\n    \r\n    updateOrbSellButtons() {\r\n        const updateOrbSellButton = (buttonId, orbCount, borderColor) => {\r\n            const button = document.getElementById(buttonId);\r\n            if (!button) return;\r\n            \r\n            if (orbCount === 0) {\r\n                button.disabled = true;\r\n                button.style.backgroundColor = 'rgba(40, 40, 40, 0.8)';\r\n                button.style.color = '#777';\r\n                button.style.cursor = 'not-allowed';\r\n                button.style.boxShadow = 'none';\r\n            } else {\r\n                button.disabled = false;\r\n                button.style.backgroundColor = 'rgba(15, 40, 55, 0.8)';\r\n                button.style.color = '#fff';\r\n                button.style.cursor = 'pointer';\r\n                button.style.boxShadow = `0 0 10px ${borderColor}`;\r\n            }\r\n        };\r\n        \r\n        if (!this.resources.orbs) return;\r\n        \r\n        updateOrbSellButton('sell-orb-common', this.resources.orbs.common, 'rgba(0, 255, 102, 0.3)');\r\n        updateOrbSellButton('sell-orb-uncommon', this.resources.orbs.uncommon, 'rgba(0, 102, 255, 0.3)');\r\n        updateOrbSellButton('sell-orb-rare', this.resources.orbs.rare, 'rgba(153, 0, 255, 0.3)');\r\n        updateOrbSellButton('sell-orb-epic', this.resources.orbs.epic, 'rgba(255, 102, 0, 0.3)');\r\n        updateOrbSellButton('sell-orb-legendary', this.resources.orbs.legendary, 'rgba(255, 0, 0, 0.3)');\r\n    }\r\n    \r\n    updateLaserTurretDisplay() {\r\n        // Update the laser turret count\r\n        const laserCountElement = document.getElementById('current-laser-count');\r\n        if (laserCountElement) {\r\n            laserCountElement.textContent = this.spaceship.deployableLaserCount || 0;\r\n        }\r\n        \r\n        // Update the purchase laser button status\r\n        const purchaseLaserBtn = document.getElementById('purchase-laser');\r\n        if (purchaseLaserBtn) {\r\n            if (this.spaceship.credits < 1000) {\r\n                purchaseLaserBtn.disabled = true;\r\n                purchaseLaserBtn.style.backgroundColor = '#555';\r\n                purchaseLaserBtn.style.cursor = 'not-allowed';\r\n            } else {\r\n                purchaseLaserBtn.disabled = false;\r\n                purchaseLaserBtn.style.backgroundColor = '#FF3333';\r\n                purchaseLaserBtn.style.cursor = 'pointer';\r\n            }\r\n        }\r\n    }\r\n    \r\n    updateResourceSellButtons() {\r\n        // Disable sell buttons if no resources\r\n        document.getElementById('sell-iron').disabled = this.resources.iron === 0;\r\n        document.getElementById('sell-gold').disabled = this.resources.gold === 0;\r\n        document.getElementById('sell-platinum').disabled = this.resources.platinum === 0;\r\n        \r\n        // Update sell button styles based on resource availability\r\n        this.updateSellButtonStatus('sell-iron', this.resources.iron, '#cc6633');\r\n        this.updateSellButtonStatus('sell-gold', this.resources.gold, '#ffcc33');\r\n        this.updateSellButtonStatus('sell-platinum', this.resources.platinum, '#33ccff');\r\n        \r\n        // Update button styles based on disabled state\r\n        document.querySelectorAll('.sell-btn').forEach(btn => {\r\n            if (btn.disabled) {\r\n                btn.style.backgroundColor = 'rgba(40, 40, 40, 0.8)';\r\n                btn.style.color = '#777';\r\n                btn.style.cursor = 'not-allowed';\r\n                btn.style.boxShadow = 'none';\r\n            }\r\n        });\r\n    }\r\n    \r\n    // Update sell button styles based on available resources\r\n    updateSellButtonStatus(buttonId, resourceAmount, borderColor) {\r\n        const button = document.getElementById(buttonId);\r\n        if (!button) return;\r\n        \r\n        if (resourceAmount === 0) {\r\n            button.disabled = true;\r\n            button.style.backgroundColor = 'rgba(40, 40, 40, 0.8)';\r\n            button.style.borderColor = '#555';\r\n            button.style.color = '#777';\r\n            button.style.boxShadow = 'none';\r\n            button.style.cursor = 'not-allowed';\r\n        } else {\r\n            button.disabled = false;\r\n            button.style.backgroundColor = 'rgba(15, 40, 55, 0.8)';\r\n            button.style.borderColor = borderColor;\r\n            button.style.color = '#fff';\r\n            button.style.boxShadow = `0 0 10px rgba(${parseInt(borderColor.slice(1, 3), 16)}, ${parseInt(borderColor.slice(3, 5), 16)}, ${parseInt(borderColor.slice(5, 7), 16)}, 0.3)`;\r\n            button.style.cursor = 'pointer';\r\n        }\r\n    }\r\n}","// upgrades.js - Ship upgrades UI and logic\r\n\r\nexport class UpgradesView {\r\n    constructor() {\r\n        this.spaceship = null;\r\n    }\r\n    \r\n    setSpaceship(spaceship) {\r\n        this.spaceship = spaceship;\r\n    }\r\n    \r\n    updateUpgradeDisplays() {\r\n        if (!this.spaceship) return;\r\n        \r\n        // Update Fuel Tank upgrade information\r\n        document.getElementById('current-fuel-level').textContent = this.spaceship.fuelTankLevel;\r\n        document.getElementById('current-fuel-capacity').textContent = this.spaceship.maxFuel;\r\n        document.getElementById('next-fuel-capacity').textContent = this.spaceship.maxFuel * 2;\r\n        document.getElementById('fuel-upgrade-cost').textContent = this.spaceship.fuelUpgradeCost;\r\n        document.getElementById('fuel-upgrade-progress').style.width = `${Math.min(this.spaceship.fuelTankLevel * 20, 100)}%`;\r\n        \r\n        // Update Engine upgrade information\r\n        document.getElementById('current-engine-level').textContent = this.spaceship.engineLevel;\r\n        document.getElementById('current-max-velocity').textContent = this.spaceship.maxVelocity.toFixed(2);\r\n        document.getElementById('next-max-velocity').textContent = (this.spaceship.maxVelocity * 1.25).toFixed(2);\r\n        document.getElementById('engine-upgrade-cost').textContent = this.spaceship.engineUpgradeCost;\r\n        document.getElementById('engine-upgrade-progress').style.width = `${Math.min(this.spaceship.engineLevel * 20, 100)}%`;\r\n        \r\n        // Update Mining Laser upgrade information\r\n        document.getElementById('current-mining-level').textContent = this.spaceship.miningLevel;\r\n        document.getElementById('current-mining-efficiency').textContent = Math.round(this.spaceship.miningEfficiency * 100);\r\n        document.getElementById('next-mining-efficiency').textContent = Math.round(this.spaceship.miningEfficiency * 130);\r\n        document.getElementById('mining-upgrade-cost').textContent = this.spaceship.miningUpgradeCost;\r\n        document.getElementById('mining-upgrade-progress').style.width = `${Math.min(this.spaceship.miningLevel * 20, 100)}%`;\r\n        \r\n        // Update Hull upgrade information\r\n        document.getElementById('current-hull-level').textContent = this.spaceship.hullLevel;\r\n        document.getElementById('current-hull-resistance').textContent = Math.round(this.spaceship.collisionResistance * 100);\r\n        document.getElementById('next-hull-resistance').textContent = Math.round(this.spaceship.collisionResistance * 125);\r\n        document.getElementById('hull-upgrade-cost').textContent = this.spaceship.hullUpgradeCost;\r\n        document.getElementById('hull-upgrade-progress').style.width = `${Math.min(this.spaceship.hullLevel * 20, 100)}%`;\r\n        \r\n        // Update Scanner upgrade information\r\n        document.getElementById('current-scanner-level').textContent = this.spaceship.scannerLevel;\r\n        document.getElementById('current-scanner-range').textContent = Math.round(this.spaceship.scanRange);\r\n        document.getElementById('next-scanner-range').textContent = Math.round(this.spaceship.scanRange * 1.2);\r\n        document.getElementById('scanner-upgrade-cost').textContent = this.spaceship.scannerUpgradeCost;\r\n        document.getElementById('scanner-upgrade-progress').style.width = `${Math.min(this.spaceship.scannerLevel * 20, 100)}%`;\r\n        \r\n        // Update upgrade button statuses\r\n        this.updateUpgradeButtonStatus('upgrade-fuel-tank', this.spaceship.credits, this.spaceship.fuelUpgradeCost, '#00cc33');\r\n        this.updateUpgradeButtonStatus('upgrade-engine', this.spaceship.credits, this.spaceship.engineUpgradeCost, '#ff9900');\r\n        this.updateUpgradeButtonStatus('upgrade-mining', this.spaceship.credits, this.spaceship.miningUpgradeCost, '#ff3030');\r\n        this.updateUpgradeButtonStatus('upgrade-hull', this.spaceship.credits, this.spaceship.hullUpgradeCost, '#30cfd0');\r\n        this.updateUpgradeButtonStatus('upgrade-scanner', this.spaceship.credits, this.spaceship.scannerUpgradeCost, '#9933cc');\r\n    }\r\n    \r\n    // Helper method to update upgrade button status\r\n    updateUpgradeButtonStatus(buttonId, currentCredits, cost, activeColor) {\r\n        const button = document.getElementById(buttonId);\r\n        if (!button) return;\r\n        \r\n        if (currentCredits < cost) {\r\n            button.disabled = true;\r\n            button.style.backgroundColor = '#555';\r\n            button.style.color = '#777';\r\n            button.style.cursor = 'not-allowed';\r\n        } else {\r\n            button.disabled = false;\r\n            button.style.backgroundColor = activeColor;\r\n            button.style.color = activeColor === '#ff9900' || activeColor === '#30cfd0' ? '#000' : '#fff';\r\n            button.style.cursor = 'pointer';\r\n        }\r\n    }\r\n}","// missions.js - Mission selection and display (including challenge systems)\r\n\r\nexport class MissionsView {\r\n    constructor() {\r\n        this.hideStargateUICallback = null;\r\n    }\r\n    \r\n    setHideCallback(callback) {\r\n        this.hideStargateUICallback = callback;\r\n    }\r\n    \r\n    setupHordeButton() {\r\n        const hordeButton = document.getElementById('unleash-horde');\r\n        if (hordeButton) {\r\n            hordeButton.addEventListener('click', () => {\r\n                // Check if spectral drones have started spawning\r\n                const dronesHaveSpawned = window.game && \r\n                                         window.game.ecsWorld && \r\n                                         window.game.ecsWorld.enemySystem && \r\n                                         window.game.ecsWorld.enemySystem.initialSpawnComplete;\r\n                \r\n                if (dronesHaveSpawned) {\r\n                    console.log(\"HORDE MODE: Button clicked, showing confirmation\");\r\n                    this.showHordeConfirmation();\r\n                } else {\r\n                    console.log(\"HORDE MODE: Button clicked but spectral drones haven't appeared yet\");\r\n                    // Show notification that horde mode is not available yet\r\n                    this.showNotification(\"Horde mode is only available after spectral drones appear in the sector.\", 0xff3030);\r\n                }\r\n            });\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Show confirmation dialog for activating horde mode\r\n     */\r\n    showHordeConfirmation() {\r\n        // Create modal overlay\r\n        const modal = document.createElement('div');\r\n        modal.id = 'horde-confirm-modal';\r\n        \r\n        // Create content container\r\n        const content = document.createElement('div');\r\n        content.id = 'horde-confirm-content';\r\n        \r\n        // Add title\r\n        const title = document.createElement('div');\r\n        title.className = 'horde-confirm-title';\r\n        title.textContent = 'UNLEASH THE HORDE?';\r\n        content.appendChild(title);\r\n        \r\n        // Add warning text\r\n        const text = document.createElement('div');\r\n        text.className = 'horde-confirm-text';\r\n        text.innerHTML = `\r\n            <p>You are about to activate EXTREME SURVIVAL MODE.</p>\r\n            <p>Enemies will continuously spawn with increasing:</p>\r\n            <ul style=\"text-align: left; padding-left: 30px; margin: 15px 0;\">\r\n                <li>Numbers (starting at 50, scaling upward)</li>\r\n                <li>Speed (progressively faster movement)</li>\r\n                <li>Health (gradually becoming tougher)</li>\r\n                <li>Damage (increasingly lethal hits)</li>\r\n            </ul>\r\n            <p>Difficulty will scale <strong>infinitely</strong> until you are overwhelmed.</p>\r\n            <p style=\"color: #ff9999;\">This is a test of survival. How long can you last?</p>\r\n        `;\r\n        content.appendChild(text);\r\n        \r\n        // Add buttons container\r\n        const buttons = document.createElement('div');\r\n        buttons.className = 'horde-confirm-buttons';\r\n        \r\n        // Add YES button\r\n        const yesBtn = document.createElement('button');\r\n        yesBtn.className = 'horde-confirm-btn horde-confirm-yes';\r\n        yesBtn.textContent = 'UNLEASH THEM';\r\n        yesBtn.addEventListener('click', () => {\r\n            // Remove the confirmation dialog\r\n            document.body.removeChild(modal);\r\n            \r\n            // Hide the stargate UI\r\n            if (this.hideStargateUICallback) {\r\n                this.hideStargateUICallback();\r\n            }\r\n            \r\n            // Activate horde mode in the game\r\n            if (window.game && typeof window.game.activateHordeMode === 'function') {\r\n                window.game.activateHordeMode();\r\n                console.log(\"HORDE MODE: Activated via stargateInterface\");\r\n            } else {\r\n                console.error(\"HORDE MODE: Failed to activate - game.activateHordeMode not available\");\r\n            }\r\n        });\r\n        \r\n        // Add NO button\r\n        const noBtn = document.createElement('button');\r\n        noBtn.className = 'horde-confirm-btn horde-confirm-no';\r\n        noBtn.textContent = 'CANCEL';\r\n        noBtn.addEventListener('click', () => {\r\n            // Just remove the confirmation dialog\r\n            document.body.removeChild(modal);\r\n        });\r\n        \r\n        // Add buttons to container\r\n        buttons.appendChild(noBtn);  // Cancel on left\r\n        buttons.appendChild(yesBtn); // Confirm on right\r\n        \r\n        // Add buttons to content\r\n        content.appendChild(buttons);\r\n        \r\n        // Add content to modal\r\n        modal.appendChild(content);\r\n        \r\n        // Add modal to body\r\n        document.body.appendChild(modal);\r\n    }\r\n    \r\n    // Helper method to show notifications\r\n    showNotification(message, color = 0x33aaff) {\r\n        // Create notification element\r\n        const notification = document.createElement('div');\r\n        notification.style.position = 'fixed';\r\n        notification.style.top = '35%';\r\n        notification.style.left = '50%';\r\n        notification.style.transform = 'translate(-50%, -50%)';\r\n        notification.style.backgroundColor = 'rgba(0, 0, 0, 0.8)';\r\n        notification.style.color = '#fff';\r\n        notification.style.padding = '15px 30px';\r\n        notification.style.borderRadius = '10px';\r\n        notification.style.border = `2px solid #${color.toString(16).padStart(6, '0')}`;\r\n        notification.style.boxShadow = `0 0 15px #${color.toString(16).padStart(6, '0')}`;\r\n        notification.style.fontFamily = 'Courier New, monospace';\r\n        notification.style.fontSize = '16px';\r\n        notification.style.zIndex = '1001'; // Above the stargate UI\r\n        notification.style.textAlign = 'center';\r\n        \r\n        // Set notification text\r\n        notification.textContent = message;\r\n        \r\n        // Add to DOM\r\n        document.body.appendChild(notification);\r\n        \r\n        // Remove after a few seconds\r\n        setTimeout(() => {\r\n            notification.style.opacity = '0';\r\n            notification.style.transition = 'opacity 0.8s';\r\n            \r\n            setTimeout(() => {\r\n                notification.remove();\r\n            }, 800);\r\n        }, 2000);\r\n    }\r\n}","// eventHandlers.js - Event handling and MessageBus subscriptions\r\n\r\nexport class EventHandlers {\r\n    constructor() {\r\n        this.tradingView = null;\r\n        this.isMobile = false;\r\n    }\r\n    \r\n    setTradingView(tradingView) {\r\n        this.tradingView = tradingView;\r\n    }\r\n    \r\n    setMobile(isMobile) {\r\n        this.isMobile = isMobile;\r\n    }\r\n    \r\n    setupOrbSellHandlers(updateUICallback) {\r\n        // Energy orb sell handlers\r\n        document.getElementById('sell-orb-common').addEventListener('click', () => {\r\n            if (this.tradingView && this.tradingView.sellEnergyOrb('common')) {\r\n                updateUICallback();\r\n            }\r\n        });\r\n        \r\n        document.getElementById('sell-orb-uncommon').addEventListener('click', () => {\r\n            if (this.tradingView && this.tradingView.sellEnergyOrb('uncommon')) {\r\n                updateUICallback();\r\n            }\r\n        });\r\n        \r\n        document.getElementById('sell-orb-rare').addEventListener('click', () => {\r\n            if (this.tradingView && this.tradingView.sellEnergyOrb('rare')) {\r\n                updateUICallback();\r\n            }\r\n        });\r\n        \r\n        document.getElementById('sell-orb-epic').addEventListener('click', () => {\r\n            if (this.tradingView && this.tradingView.sellEnergyOrb('epic')) {\r\n                updateUICallback();\r\n            }\r\n        });\r\n        \r\n        document.getElementById('sell-orb-legendary').addEventListener('click', () => {\r\n            if (this.tradingView && this.tradingView.sellEnergyOrb('legendary')) {\r\n                updateUICallback();\r\n            }\r\n        });\r\n    }\r\n    \r\n    setupLaserPurchaseHandler(updateUICallback) {\r\n        // Add handler for purchasing laser turrets\r\n        const purchaseLaserBtn = document.getElementById('purchase-laser');\r\n        if (purchaseLaserBtn) {\r\n            purchaseLaserBtn.addEventListener('click', () => {\r\n                if (this.tradingView) {\r\n                    this.tradingView.purchaseLaserTurret();\r\n                    updateUICallback();\r\n                }\r\n            });\r\n        }\r\n    }\r\n    \r\n    // Add a new method for setting up touch events\r\n    setupTouchEvents() {\r\n        if (!this.isMobile) return;\r\n        \r\n        const stargateUI = document.getElementById('stargate-ui');\r\n        if (!stargateUI) return;\r\n        \r\n        console.log(\"Setting up touch events for stargate UI\");\r\n        \r\n        // Make sure the undock button has proper touch handling\r\n        const undockBtn = document.getElementById('undock-btn');\r\n        if (undockBtn) {\r\n            undockBtn.style.touchAction = 'manipulation';\r\n            undockBtn.style.webkitTapHighlightColor = 'transparent';\r\n            undockBtn.style.position = 'relative';\r\n            undockBtn.style.zIndex = '9999';\r\n            \r\n            // Ensure proper touch handling\r\n            undockBtn.addEventListener('touchstart', (e) => {\r\n                console.log(\"Touch start on undock button\");\r\n                // Change appearance to show it's being touched\r\n                undockBtn.style.backgroundColor = '#1b88db';\r\n                undockBtn.style.transform = 'scale(0.98)';\r\n                // Prevent any default behavior that might interfere\r\n                e.stopPropagation();\r\n            }, { passive: false });\r\n            \r\n            undockBtn.addEventListener('touchend', (e) => {\r\n                console.log(\"Touch end on undock button\");\r\n                // Reset appearance\r\n                undockBtn.style.backgroundColor = '#33aaff';\r\n                undockBtn.style.transform = 'scale(1)';\r\n                // Prevent any default behavior that might interfere\r\n                e.stopPropagation();\r\n            }, { passive: false });\r\n        }\r\n        \r\n        // Prevent default touchmove on body but allow scrolling within the stargate UI\r\n        stargateUI.addEventListener('touchmove', (e) => {\r\n            // Allow the default scroll behavior within the stargate UI\r\n            e.stopPropagation();\r\n        }, { passive: true });\r\n        \r\n        // Fix for iOS scrolling issues - only prevent at the top, not at the bottom\r\n        stargateUI.addEventListener('touchstart', (e) => {\r\n            // Only prevent pull-to-refresh at the top, don't interfere with bottom scrolling\r\n            const scrollTop = stargateUI.scrollTop;\r\n            \r\n            if (scrollTop <= 0 && e.touches[0].screenY < e.touches[0].clientY) {\r\n                e.preventDefault();\r\n            }\r\n            // Removed condition that was preventing scrolling at the bottom\r\n        }, { passive: false });\r\n        \r\n        // Handle tabbed content for better touch experience\r\n        const tabButtons = stargateUI.querySelectorAll('.tablinks');\r\n        if (tabButtons.length > 0) {\r\n            tabButtons.forEach(button => {\r\n                button.addEventListener('touchend', (e) => {\r\n                    // Prevent rapid multiple touches\r\n                    e.preventDefault();\r\n                    \r\n                    // Simulate a click event\r\n                    button.click();\r\n                });\r\n            });\r\n        }\r\n        \r\n        // Improve touch experience for all buttons in the stargate UI\r\n        const allButtons = stargateUI.querySelectorAll('button');\r\n        allButtons.forEach(button => {\r\n            if (button !== undockBtn) { // We already handled the undock button specially\r\n                button.style.touchAction = 'manipulation';\r\n                button.style.webkitTapHighlightColor = 'transparent';\r\n                \r\n                // Provide visual feedback on touch\r\n                button.addEventListener('touchstart', () => {\r\n                    button.style.transform = 'scale(0.98)';\r\n                }, { passive: true });\r\n                \r\n                button.addEventListener('touchend', () => {\r\n                    button.style.transform = 'scale(1)';\r\n                }, { passive: true });\r\n            }\r\n        });\r\n    }\r\n}","// helpers.js - Utility functions and common operations\r\n\r\nexport class StargateHelpers {\r\n    static updateResourceDisplays(resources) {\r\n        // Update resource display with visual elements\r\n        document.getElementById('ms-iron').textContent = resources.iron;\r\n        document.getElementById('ms-gold').textContent = resources.gold;\r\n        document.getElementById('ms-platinum').textContent = resources.platinum;\r\n    }\r\n    \r\n    static updateCreditsDisplay(spaceship) {\r\n        // Update credits with styling\r\n        document.getElementById('ms-credits').textContent = `${spaceship.credits} CR`;\r\n    }\r\n    \r\n    static updateStatusGauges(spaceship) {\r\n        // Update fuel gauge\r\n        document.getElementById('fuel-gauge').style.width = `${(spaceship.fuel / spaceship.maxFuel) * 100}%`;\r\n        document.getElementById('fuel-level').textContent = Math.round((spaceship.fuel / spaceship.maxFuel) * 100);\r\n        \r\n        // Update shield gauge\r\n        document.getElementById('shield-gauge').style.width = `${(spaceship.shield / spaceship.maxShield) * 100}%`;\r\n        document.getElementById('shield-level').textContent = Math.round((spaceship.shield / spaceship.maxShield) * 100);\r\n        \r\n        // Update hull gauge\r\n        document.getElementById('hull-gauge').style.width = `${(spaceship.hull / spaceship.maxHull) * 100}%`;\r\n        document.getElementById('hull-level').textContent = Math.round((spaceship.hull / spaceship.maxHull) * 100);\r\n    }\r\n    \r\n    static updateServiceButtons(spaceship) {\r\n        // Disable refuel button if not enough credits or fuel is full\r\n        const refuelBtn = document.getElementById('refuel-btn');\r\n        if (spaceship.credits < 100 || spaceship.fuel >= spaceship.maxFuel * 0.999) {\r\n            refuelBtn.disabled = true;\r\n            refuelBtn.style.backgroundColor = '#555';\r\n            refuelBtn.style.cursor = 'not-allowed';\r\n        } else {\r\n            refuelBtn.disabled = false;\r\n            refuelBtn.style.backgroundColor = '#00cc33';\r\n            refuelBtn.style.cursor = 'pointer';\r\n        }\r\n        \r\n        // Disable shield repair button if not enough credits or shield is full\r\n        const repairShieldBtn = document.getElementById('repair-shield-btn');\r\n        if (spaceship.credits < 150 || spaceship.shield >= spaceship.maxShield * 0.999) {\r\n            repairShieldBtn.disabled = true;\r\n            repairShieldBtn.style.backgroundColor = '#555';\r\n            repairShieldBtn.style.cursor = 'not-allowed';\r\n        } else {\r\n            repairShieldBtn.disabled = false;\r\n            repairShieldBtn.style.backgroundColor = '#3399ff';\r\n            repairShieldBtn.style.cursor = 'pointer';\r\n        }\r\n        \r\n        // Disable hull repair button if not enough credits or hull is full\r\n        const repairHullBtn = document.getElementById('repair-hull-btn');\r\n        if (spaceship.credits < 200 || spaceship.hull >= spaceship.maxHull * 0.999) {\r\n            repairHullBtn.disabled = true;\r\n            repairHullBtn.style.backgroundColor = '#555';\r\n            repairHullBtn.style.cursor = 'not-allowed';\r\n        } else {\r\n            repairHullBtn.disabled = false;\r\n            repairHullBtn.style.backgroundColor = '#ff9900';\r\n            repairHullBtn.style.cursor = 'pointer';\r\n        }\r\n    }\r\n    \r\n    static configureMobileUI(stargateUI, isMobile) {\r\n        if (!isMobile) return;\r\n        \r\n        // Ensure proper mobile styling\r\n        stargateUI.style.width = '92%';\r\n        stargateUI.style.maxWidth = '92vw';\r\n        stargateUI.style.maxHeight = '85vh';\r\n        stargateUI.style.webkitOverflowScrolling = 'touch';\r\n        stargateUI.style.touchAction = 'pan-y';\r\n        stargateUI.style.overscrollBehavior = 'auto';\r\n        \r\n        // Ensure proper positioning\r\n        stargateUI.style.position = 'absolute';\r\n        stargateUI.style.top = '50%';\r\n        stargateUI.style.left = '50%';\r\n        stargateUI.style.transform = 'translate(-50%, -50%)';\r\n        stargateUI.style.zIndex = '1000';\r\n        \r\n        // Ensure body is in a state that allows the UI to be visible\r\n        document.body.classList.remove('undocking', 'modal-open');\r\n    }\r\n    \r\n    static syncWithGameResources() {\r\n        // Sync resources with game if available (similar to BlackjackGame)\r\n        if (window.game && window.game.controls) {\r\n            // Get reference to spaceship and resources\r\n            const spaceship = window.game.spaceship;\r\n            const resources = window.game.controls.resources;\r\n            \r\n            // Return references for use by caller\r\n            if (spaceship && resources) {\r\n                console.log(\"Syncing stargate UI with game resources:\", resources);\r\n                return { spaceship, resources };\r\n            }\r\n        }\r\n        return null;\r\n    }\r\n}","// stargateInterface.js - Handles the stargate docking and trading UI\r\n\r\nimport { MobileDetector } from '../../utils/mobileDetector.js';\r\nimport { TerminalView } from './components/stargate/terminalView.js';\r\nimport { SystemsView } from './components/stargate/systemsView.js';\r\nimport { TradingView } from './components/stargate/tradingView.js';\r\nimport { UpgradesView } from './components/stargate/upgrades.js';\r\nimport { MissionsView } from './components/stargate/missions.js';\r\nimport { EventHandlers } from './components/stargate/eventHandlers.js';\r\nimport { StargateHelpers } from './components/stargate/helpers.js';\r\n\r\nexport class StargateInterface {\r\n    constructor() {\r\n        this.starMap = null;\r\n        this.blackjackGame = null;\r\n        this.settings = null;\r\n        this.isMobile = MobileDetector.isMobile();\r\n        \r\n        // Initialize submodules\r\n        this.terminalView = new TerminalView();\r\n        this.systemsView = new SystemsView();\r\n        this.tradingView = new TradingView();\r\n        this.upgradesView = new UpgradesView();\r\n        this.missionsView = new MissionsView();\r\n        this.eventHandlers = new EventHandlers();\r\n        \r\n        // Configure mobile settings\r\n        this.terminalView.setMobile(this.isMobile);\r\n        this.eventHandlers.setMobile(this.isMobile);\r\n        this.eventHandlers.setTradingView(this.tradingView);\r\n        this.missionsView.setHideCallback(() => this.hideStargateUI());\r\n        \r\n        this.setupStargateUI();\r\n        this.setupEventHandlers();\r\n    }\r\n    \r\n    setStarMap(starMap) {\r\n        this.starMap = starMap;\r\n        this.systemsView.setStarMap(starMap);\r\n    }\r\n    \r\n    setBlackjackGame(blackjackGame) {\r\n        this.blackjackGame = blackjackGame;\r\n        this.systemsView.setBlackjackGame(blackjackGame);\r\n    }\r\n    \r\n    setSettings(settings) {\r\n        this.settings = settings;\r\n        this.systemsView.setSettings(settings);\r\n        \r\n        // Pass the stargate interface reference to settings\r\n        if (this.settings) {\r\n            this.settings.setStargateInterface(this);\r\n        }\r\n    }\r\n    \r\n    setupStargateUI() {\r\n        // Create and inject styles\r\n        this.terminalView.createStyles();\r\n        \r\n        // Create docking prompt\r\n        this.terminalView.createDockingPrompt();\r\n        \r\n        // Create main UI container\r\n        const stargateUI = this.terminalView.createMainUI();\r\n        stargateUI.innerHTML = this.terminalView.getMainUIContent();\r\n        \r\n        document.body.appendChild(stargateUI);\r\n    }\r\n    \r\n    showDockingPrompt() {\r\n        this.terminalView.showDockingPrompt();\r\n    }\r\n    \r\n    hideDockingPrompt() {\r\n        this.terminalView.hideDockingPrompt();\r\n    }\r\n    \r\n    showStargateUI() {\r\n        const stargateUI = document.getElementById('stargate-ui');\r\n        if (stargateUI) {\r\n            console.log(\"Showing stargate UI on \" + (this.isMobile ? \"mobile\" : \"desktop\"));\r\n            stargateUI.style.display = 'block';\r\n            stargateUI.style.backgroundColor = 'rgba(20, 30, 50, 0.9)';\r\n            \r\n            // Mobile-specific adjustments\r\n            if (this.isMobile) {\r\n                StargateHelpers.configureMobileUI(stargateUI, this.isMobile);\r\n            }\r\n        }\r\n        \r\n        this.hideDockingPrompt();\r\n        this.systemsView.setupAllSystemButtons();\r\n        \r\n        if (this.isMobile) {\r\n            this.eventHandlers.setupTouchEvents();\r\n        }\r\n        \r\n        // Sync resources with game\r\n        const gameData = StargateHelpers.syncWithGameResources();\r\n        if (gameData) {\r\n            this.updateStargateUI(gameData.spaceship, gameData.resources);\r\n        }\r\n    }\r\n    \r\n    hideStargateUI() {\r\n        const stargateUI = document.getElementById('stargate-ui');\r\n        if (stargateUI) {\r\n            stargateUI.style.display = 'none';\r\n        }\r\n    }\r\n\r\n    // Add alias for compatibility\r\n    hide() {\r\n        this.hideStargateUI();\r\n    }\r\n    \r\n    updateStargateUI(spaceship, resources) {\r\n        // Set references in submodules\r\n        this.tradingView.setGameReferences(spaceship, resources);\r\n        this.upgradesView.setSpaceship(spaceship);\r\n        \r\n        // Update displays using submodules\r\n        StargateHelpers.updateResourceDisplays(resources);\r\n        StargateHelpers.updateCreditsDisplay(spaceship);\r\n        StargateHelpers.updateStatusGauges(spaceship);\r\n        StargateHelpers.updateServiceButtons(spaceship);\r\n        \r\n        this.upgradesView.updateUpgradeDisplays();\r\n        this.tradingView.updateResourceSellButtons();\r\n        this.tradingView.updateOrbCounts();\r\n        this.tradingView.updateOrbSellButtons();\r\n        this.tradingView.updateLaserTurretDisplay();\r\n    }\r\n    setupEventHandlers() {\r\n        const updateUICallback = () => {\r\n            const gameData = StargateHelpers.syncWithGameResources();\r\n            if (gameData) {\r\n                this.updateStargateUI(gameData.spaceship, gameData.resources);\r\n            }\r\n        };\r\n        \r\n        // Setup orb selling handlers\r\n        this.eventHandlers.setupOrbSellHandlers(updateUICallback);\r\n        \r\n        // Setup laser purchase handler\r\n        this.eventHandlers.setupLaserPurchaseHandler(updateUICallback);\r\n        \r\n        // Setup horde mode button\r\n        this.missionsView.setupHordeButton();\r\n    }\r\n}","// gameOverScreen.js - Handles the game over UI\r\n\r\nimport { getAbsolutePath } from '../../utils/pathUtils.js';\r\n\r\nexport class GameOverScreen {\r\n    constructor() {\r\n        this.isVisible = false;\r\n        this.setupGameOverScreen();\r\n    }\r\n    \r\n    // Helper method to handle paths for GitHub Pages and local development\r\n    getPath(relativePath) {\r\n        return getAbsolutePath(relativePath);\r\n    }\r\n    \r\n    setupGameOverScreen() {\r\n        // Add game over container (hidden initially)\r\n        const gameOverContainer = document.createElement('div');\r\n        gameOverContainer.id = 'game-over-container';\r\n        gameOverContainer.style.position = 'absolute';\r\n        gameOverContainer.style.top = '0';\r\n        gameOverContainer.style.left = '0';\r\n        gameOverContainer.style.width = '100%';\r\n        gameOverContainer.style.height = '100%';\r\n        gameOverContainer.style.backgroundColor = 'rgba(0, 0, 0, 0.8)';\r\n        gameOverContainer.style.display = 'flex';\r\n        gameOverContainer.style.flexDirection = 'column';\r\n        gameOverContainer.style.alignItems = 'center';\r\n        gameOverContainer.style.justifyContent = 'center';\r\n        gameOverContainer.style.color = '#fff';\r\n        gameOverContainer.style.fontFamily = 'Courier New, monospace';\r\n        gameOverContainer.style.zIndex = '1000';\r\n        gameOverContainer.style.display = 'none';\r\n        document.body.appendChild(gameOverContainer);\r\n        \r\n        // Game over title\r\n        const gameOverTitle = document.createElement('h1');\r\n        gameOverTitle.textContent = 'GAME OVER';\r\n        gameOverTitle.style.fontSize = '50px';\r\n        gameOverTitle.style.color = '#ff0000';\r\n        gameOverTitle.style.textShadow = '0 0 10px #ff0000';\r\n        gameOverTitle.style.marginBottom = '20px';\r\n        gameOverContainer.appendChild(gameOverTitle);\r\n        \r\n        // Game over message\r\n        const gameOverMessage = document.createElement('p');\r\n        gameOverMessage.id = 'game-over-message';\r\n        gameOverMessage.textContent = 'Your ship was destroyed by asteroid collision';\r\n        gameOverMessage.style.fontSize = '18px';\r\n        gameOverMessage.style.marginBottom = '40px';\r\n        gameOverContainer.appendChild(gameOverMessage);\r\n        \r\n        // Restart button\r\n        this.setupRestartButton(gameOverContainer);\r\n        \r\n        // Resources collected summary (for game over screen)\r\n        const resourcesSummary = document.createElement('div');\r\n        resourcesSummary.id = 'resources-summary';\r\n        resourcesSummary.style.marginTop = '30px';\r\n        resourcesSummary.style.fontSize = '16px';\r\n        resourcesSummary.style.textAlign = 'center';\r\n        gameOverContainer.appendChild(resourcesSummary);\r\n    }\r\n    \r\n    setupRestartButton(container) {\r\n        const restartButton = document.createElement('button');\r\n        restartButton.id = 'restart-game-button';\r\n        restartButton.textContent = 'RESTART MISSION';\r\n        restartButton.style.backgroundColor = 'rgba(120, 220, 232, 0.2)';\r\n        restartButton.style.color = '#fff';\r\n        restartButton.style.border = '1px solid rgba(120, 220, 232, 0.5)';\r\n        restartButton.style.borderRadius = '5px';\r\n        restartButton.style.padding = '15px 30px';\r\n        restartButton.style.fontSize = '20px';\r\n        restartButton.style.fontFamily = '\"Rajdhani\", sans-serif';\r\n        restartButton.style.cursor = 'pointer';\r\n        restartButton.style.marginTop = '30px';\r\n        restartButton.style.transition = 'all 0.2s ease';\r\n        \r\n        restartButton.addEventListener('mouseover', () => {\r\n            restartButton.style.backgroundColor = 'rgba(120, 220, 232, 0.4)';\r\n            restartButton.style.boxShadow = '0 0 15px rgba(120, 220, 232, 0.5)';\r\n        });\r\n        \r\n        restartButton.addEventListener('mouseout', () => {\r\n            restartButton.style.backgroundColor = 'rgba(120, 220, 232, 0.2)';\r\n            restartButton.style.boxShadow = 'none';\r\n        });\r\n        \r\n        restartButton.addEventListener('click', () => {\r\n            // Play the click sound\r\n            if (this.audio) {\r\n                this.audio.playSound('uiClick');\r\n            }\r\n            \r\n            // Show loading status\r\n            const loadingStatus = document.createElement('div');\r\n            loadingStatus.textContent = 'Restarting mission...';\r\n            loadingStatus.style.color = 'rgba(120, 220, 232, 0.9)';\r\n            loadingStatus.style.marginTop = '10px';\r\n            container.appendChild(loadingStatus);\r\n            \r\n            // Disable the button during reload\r\n            restartButton.disabled = true;\r\n            restartButton.style.opacity = '0.5';\r\n            restartButton.style.cursor = 'default';\r\n            \r\n            // Reset game state before reloading\r\n            // This is critical to ensure difficulty level resets properly\r\n            if (window.game) {\r\n                // Reset time-based difficulty scaling\r\n                if (window.game.difficultyManager) {\r\n                    window.game.difficultyManager.gameTime = 0;\r\n                    window.game.difficultyManager.currentLevel = 1;\r\n                    console.log(\"Reset difficulty level to 1\");\r\n                }\r\n                \r\n                // Reset game time counter\r\n                window.game.gameTime = 0;\r\n            }\r\n            \r\n            // Reload the page with a small delay to allow the UI update to be seen\r\n            setTimeout(() => {\r\n                location.reload();\r\n            }, 500);\r\n        });\r\n        \r\n        container.appendChild(restartButton);\r\n    }\r\n    \r\n    show(resources, message) {\r\n        console.log(\"GameOverScreen: Showing game over screen\");\r\n        \r\n        // Show game over screen\r\n        const gameOverContainer = document.getElementById('game-over-container');\r\n        gameOverContainer.style.display = 'flex';\r\n        \r\n        // Set message based on reason\r\n        const gameOverMessage = document.getElementById('game-over-message');\r\n        if (gameOverMessage) {\r\n            // Default message\r\n            let displayMessage = 'Your journey has ended.';\r\n            \r\n            // Check if we received a reason type or just a string message\r\n            if (typeof message === 'object' && message.data && message.data.type) {\r\n                // Use the type field for more reliable message categorization\r\n                const reasonType = message.data.type;\r\n                \r\n                switch (reasonType) {\r\n                    case 'FUEL_DEPLETED':\r\n                        displayMessage = 'Your ship drifted into the void after running out of fuel.';\r\n                        break;\r\n                    case 'COLLISION_ASTEROID':\r\n                        displayMessage = 'Your ship was destroyed by an asteroid collision.';\r\n                        break;\r\n                    case 'COLLISION_PLANET':\r\n                        displayMessage = 'Your ship crashed into a planet!';\r\n                        break;\r\n                    case 'COMBAT_DEATH':\r\n                        displayMessage = 'Your ship was destroyed in combat.';\r\n                        break;\r\n                    case 'SUN_DEATH':\r\n                        displayMessage = \"Your ship was incinerated by the sun's heat!\";\r\n                        break;\r\n                    default:\r\n                        // If we have a reason string but don't recognize the type\r\n                        if (message.data.reason) {\r\n                            displayMessage = message.data.reason;\r\n                        }\r\n                }\r\n            } else if (message) {\r\n                // Fallback to string content checking for backward compatibility\r\n                if (message.includes(\"fuel\")) {\r\n                    displayMessage = 'Your ship drifted into the void after running out of fuel.';\r\n                } else if (message.includes(\"asteroid\")) {\r\n                    displayMessage = 'Your ship was destroyed by an asteroid collision.';\r\n                } else if (message.includes(\"combat\")) {\r\n                    displayMessage = 'Your ship was destroyed in combat.';\r\n                } else if (message.includes(\"sun\")) {\r\n                    displayMessage = \"Your ship was incinerated by the sun's heat!\";\r\n                } else if (message.includes(\"planet\")) {\r\n                    displayMessage = \"Your ship crashed into a planet!\";\r\n                } else {\r\n                    // Use the provided message if none of our standardized reasons match\r\n                    displayMessage = message;\r\n                }\r\n            }\r\n            \r\n            gameOverMessage.textContent = displayMessage;\r\n        }\r\n        \r\n        // Check if game was in horde mode\r\n        let wasHordeMode = false;\r\n        let hordeSurvivalTime = \"00:00\";\r\n        let rawSurvivalTime = 0;\r\n        \r\n        if (resources && resources.hordeMode) {\r\n            wasHordeMode = resources.hordeMode.active;\r\n            hordeSurvivalTime = resources.hordeMode.survivalTime || \"00:00\";\r\n            rawSurvivalTime = resources.hordeMode.rawSurvivalTime || 0;\r\n        }\r\n        \r\n        // Handle different resource data formats\r\n        // It might be wrapped in a gameStats structure or come directly\r\n        let resourceData = resources;\r\n        \r\n        // Check if resources has a nested resources property (from gameOver method in game.js)\r\n        if (resources && resources.resources) {\r\n            console.log(\"GameOverScreen: Using nested resources data structure\");\r\n            resourceData = resources.resources;\r\n        }\r\n        \r\n        // Ensure we have valid resource values with defaults\r\n        const iron = resourceData && resourceData.iron ? resourceData.iron : 0;\r\n        const gold = resourceData && resourceData.gold ? resourceData.gold : 0;\r\n        const platinum = resourceData && resourceData.platinum ? resourceData.platinum : 0;\r\n        \r\n        // Update resources summary with guaranteed safe values\r\n        const resourcesSummary = document.getElementById('resources-summary');\r\n        if (resourcesSummary) {\r\n            // Create horde mode section if applicable\r\n            if (wasHordeMode) {\r\n                // Get minutes for special messages\r\n                const minutes = Math.floor(rawSurvivalTime / 1000 / 60);\r\n                \r\n                // Determine message based on survival time\r\n                let hordeMessage = \"You fought valiantly against overwhelming odds.\";\r\n                if (minutes >= 10) {\r\n                    hordeMessage = \"LEGENDARY! Few have survived the horde this long!\";\r\n                } else if (minutes >= 5) {\r\n                    hordeMessage = \"IMPRESSIVE! You showed exceptional combat skills!\";\r\n                } else if (minutes >= 3) {\r\n                    hordeMessage = \"Well done! You held back the horde longer than most!\";\r\n                }\r\n                \r\n                resourcesSummary.innerHTML = `\r\n                    <div style=\"margin-bottom:20px; padding:15px; background-color:rgba(255,48,48,0.2); border:1px solid #ff3030; border-radius:5px;\">\r\n                        <h3 style=\"color:#ff3030; margin-top:0; text-shadow:0 0 5px rgba(255,48,48,0.5);\">HORDE MODE</h3>\r\n                        <p style=\"font-size:18px; font-weight:bold;\">SURVIVED: <span style=\"color:#ff9999; text-shadow:0 0 5px rgba(255,48,48,0.3);\">${hordeSurvivalTime}</span></p>\r\n                        <p>${hordeMessage}</p>\r\n                    </div>\r\n                    <p>Resources collected:</p>\r\n                    <p>IRON: ${iron} | GOLD: ${gold} | PLATINUM: ${platinum}</p>\r\n                `;\r\n            } else {\r\n                resourcesSummary.innerHTML = `\r\n                    <p>Resources collected:</p>\r\n                    <p>IRON: ${iron} | GOLD: ${gold} | PLATINUM: ${platinum}</p>\r\n                `;\r\n            }\r\n        }\r\n        \r\n        // Simpler approach to play explosion sound as a backup\r\n        try {\r\n            console.log(\"GameOverScreen: Attempting simple audio playback\");\r\n            \r\n            // Create a direct audio element without attaching to DOM\r\n            const boinkSound = new Audio(this.getPath('sounds/effects/boink.wav'));\r\n            boinkSound.volume = 0.8;\r\n            \r\n            // Play with a slight delay to avoid conflict with other sounds\r\n            setTimeout(() => {\r\n                boinkSound.play().catch(err => {\r\n                    console.warn(\"GameOverScreen: Simple sound failed:\", err);\r\n                });\r\n            }, 100);\r\n            \r\n        } catch (err) {\r\n            console.error(\"GameOverScreen: Error with simple sound approach:\", err);\r\n        }\r\n        \r\n        // Lock pointer to prevent camera movement after game over\r\n        if (document.exitPointerLock) {\r\n            document.exitPointerLock();\r\n        }\r\n    }\r\n} ","// controlsMenu.js - Handles the controls menu UI\r\n\r\nexport class ControlsMenu {\r\n    constructor() {\r\n        this.setupControlsMenu();\r\n    }\r\n    \r\n    setupControlsMenu() {\r\n        // Create controls menu\r\n        const controlsMenu = document.createElement('div');\r\n        controlsMenu.id = 'controls-menu';\r\n        controlsMenu.style.position = 'absolute';\r\n        controlsMenu.style.top = '50%';\r\n        controlsMenu.style.left = '50%';\r\n        controlsMenu.style.transform = 'translate(-50%, -50%)';\r\n        controlsMenu.style.backgroundColor = 'rgba(0, 0, 0, 0.8)';\r\n        controlsMenu.style.padding = '15px';\r\n        controlsMenu.style.borderRadius = '10px';\r\n        controlsMenu.style.border = '1px solid #30cfd0';\r\n        controlsMenu.style.boxShadow = '0 0 10px #30cfd0';\r\n        controlsMenu.style.zIndex = '1000';\r\n        controlsMenu.style.display = 'none';\r\n        document.body.appendChild(controlsMenu);\r\n        \r\n        // Controls menu header\r\n        const controlsTitle = document.createElement('div');\r\n        controlsTitle.className = 'help-title';\r\n        controlsTitle.innerHTML = 'CONTROLS <span id=\"close-controls\" style=\"float: right; cursor: pointer; font-weight: bold;\">X</span>';\r\n        controlsMenu.appendChild(controlsTitle);\r\n        \r\n        // Control rows\r\n        const createControlRow = (keyText, actionText) => {\r\n            const row = document.createElement('div');\r\n            row.className = 'control-row';\r\n            row.style.display = 'flex';\r\n            row.style.justifyContent = 'space-between';\r\n            row.style.marginBottom = '5px';\r\n            \r\n            const keySpan = document.createElement('span');\r\n            if (keyText !== 'Mouse') {\r\n                keySpan.className = 'key';\r\n                keySpan.style.backgroundColor = 'rgba(48, 207, 208, 0.2)';\r\n                keySpan.style.border = '1px solid #30cfd0';\r\n                keySpan.style.borderRadius = '4px';\r\n                keySpan.style.padding = '0 5px';\r\n                keySpan.style.minWidth = '20px';\r\n                keySpan.style.textAlign = 'center';\r\n            }\r\n            keySpan.textContent = keyText;\r\n            row.appendChild(keySpan);\r\n            \r\n            const actionSpan = document.createElement('span');\r\n            actionSpan.textContent = actionText;\r\n            row.appendChild(actionSpan);\r\n            \r\n            return row;\r\n        };\r\n        \r\n        // Add all control rows\r\n        controlsMenu.appendChild(createControlRow('W', 'Forward Thrust'));\r\n        controlsMenu.appendChild(createControlRow('S', 'Backward Thrust'));\r\n        controlsMenu.appendChild(createControlRow('A', 'Left Thrust'));\r\n        controlsMenu.appendChild(createControlRow('D', 'Right Thrust'));\r\n        controlsMenu.appendChild(createControlRow('SHIFT', 'Boost'));\r\n        controlsMenu.appendChild(createControlRow('Mouse', 'Ship Rotation'));\r\n        controlsMenu.appendChild(createControlRow('Click', 'Fire Particle Cannon'));\r\n        controlsMenu.appendChild(createControlRow('E', 'Target Lock-On'));\r\n        controlsMenu.appendChild(createControlRow('TAB', 'Cycle Targets'));\r\n        controlsMenu.appendChild(createControlRow('R', 'Toggle Mining'));\r\n        controlsMenu.appendChild(createControlRow('T', 'Deploy Laser Turret'));\r\n        controlsMenu.appendChild(createControlRow('Q', 'Dock with Stargate'));\r\n        \r\n        // Set up event listeners for the controls menu\r\n        document.getElementById('close-controls').addEventListener('click', () => {\r\n            this.hide();\r\n        });\r\n\r\n        // Close menu when clicking outside of it\r\n        document.addEventListener('click', (e) => {\r\n            const controlsMenu = document.getElementById('controls-menu');\r\n            const showControlsButton = document.getElementById('show-controls');\r\n            \r\n            if (controlsMenu.style.display === 'block' && \r\n                !controlsMenu.contains(e.target) && \r\n                e.target !== showControlsButton) {\r\n                this.hide();\r\n            }\r\n        });\r\n    }\r\n    \r\n    show() {\r\n        const controlsMenu = document.getElementById('controls-menu');\r\n        if (controlsMenu) {\r\n            controlsMenu.style.display = 'block';\r\n        }\r\n    }\r\n    \r\n    hide() {\r\n        const controlsMenu = document.getElementById('controls-menu');\r\n        if (controlsMenu) {\r\n            controlsMenu.style.display = 'none';\r\n        }\r\n    }\r\n    \r\n    setupButtonHandler() {\r\n        // Add click handler for the show controls button\r\n        const showControlsButton = document.getElementById('show-controls');\r\n        if (showControlsButton) {\r\n            showControlsButton.addEventListener('click', (e) => {\r\n                this.show();\r\n                e.stopPropagation(); // Prevent click from passing through\r\n            });\r\n        }\r\n    }\r\n} ","// canvasRenderer.js - Handles star map canvas rendering\r\n\r\nexport class CanvasRenderer {\r\n    constructor(isMobile) {\r\n        this.isMobile = isMobile;\r\n    }\r\n\r\n    // Draw the star map on the canvas\r\n    updateCanvas(starSystemGenerator) {\r\n        const canvas = document.getElementById('star-map-canvas');\r\n        if (!canvas) return;\r\n        \r\n        const ctx = canvas.getContext('2d');\r\n        ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n        \r\n        // Define the center of the canvas\r\n        const centerX = canvas.width / 2;\r\n        const centerY = canvas.height / 2;\r\n        \r\n        // Get systems data\r\n        const systems = starSystemGenerator.getAllSystems();\r\n        const currentSystem = starSystemGenerator.currentSystem;\r\n        const connections = starSystemGenerator.warpGates;\r\n        \r\n        // First draw connections\r\n        this.drawConnections(ctx, centerX, centerY, systems, connections);\r\n        \r\n        // Highlight connections from current system\r\n        this.drawCurrentSystemConnections(ctx, centerX, centerY, systems, currentSystem);\r\n        \r\n        // Now draw systems\r\n        this.drawSystems(ctx, centerX, centerY, systems, currentSystem);\r\n    }\r\n\r\n    drawConnections(ctx, centerX, centerY, systems, connections) {\r\n        ctx.lineWidth = 1;\r\n        ctx.strokeStyle = 'rgba(48, 207, 208, 0.4)';\r\n        \r\n        for (const [systemId, connectedSystems] of Object.entries(connections)) {\r\n            const system = systems[systemId];\r\n            if (!system) continue;\r\n            \r\n            // Convert system position to canvas position\r\n            const x1 = centerX + system.position.x;\r\n            const y1 = centerY + system.position.y;\r\n            \r\n            for (const connectedId of connectedSystems) {\r\n                const connectedSystem = systems[connectedId];\r\n                if (!connectedSystem) continue;\r\n                \r\n                // Convert connected system position to canvas position\r\n                const x2 = centerX + connectedSystem.position.x;\r\n                const y2 = centerY + connectedSystem.position.y;\r\n                \r\n                // Draw the connection\r\n                ctx.beginPath();\r\n                ctx.moveTo(x1, y1);\r\n                ctx.lineTo(x2, y2);\r\n                ctx.stroke();\r\n            }\r\n        }\r\n    }\r\n\r\n    drawCurrentSystemConnections(ctx, centerX, centerY, systems, currentSystem) {\r\n        if (currentSystem && systems[currentSystem]) {\r\n            const currentSystemData = systems[currentSystem];\r\n            const x1 = centerX + currentSystemData.position.x;\r\n            const y1 = centerY + currentSystemData.position.y;\r\n            \r\n            ctx.lineWidth = this.isMobile ? 3 : 2;\r\n            ctx.strokeStyle = 'rgba(48, 207, 208, 0.8)';\r\n            \r\n            for (const connectedId of currentSystemData.connections) {\r\n                const connectedSystem = systems[connectedId];\r\n                if (!connectedSystem) continue;\r\n                \r\n                // Convert connected system position to canvas position\r\n                const x2 = centerX + connectedSystem.position.x;\r\n                const y2 = centerY + connectedSystem.position.y;\r\n                \r\n                // Draw the connection\r\n                ctx.beginPath();\r\n                ctx.moveTo(x1, y1);\r\n                ctx.lineTo(x2, y2);\r\n                ctx.stroke();\r\n            }\r\n        }\r\n    }\r\n\r\n    drawSystems(ctx, centerX, centerY, systems, currentSystem, selectedSystem = null) {\r\n        // Now draw systems\r\n        for (const [systemId, system] of Object.entries(systems)) {\r\n            // Convert system position to canvas position\r\n            const x = centerX + system.position.x;\r\n            const y = centerY + system.position.y;\r\n            \r\n            // Determine if it's the current system, selected system, or regular\r\n            const isCurrent = systemId === currentSystem;\r\n            const isSelected = systemId === selectedSystem;\r\n            const isConnected = currentSystem && systems[currentSystem] && \r\n                                systems[currentSystem].connections.includes(systemId);\r\n            \r\n            // Draw a circle for the system\r\n            ctx.beginPath();\r\n            \r\n            // Size based on status and device\r\n            let radius;\r\n            if (this.isMobile) {\r\n                radius = isCurrent ? 18 : isSelected ? 15 : 10;\r\n            } else {\r\n                radius = isCurrent ? 15 : isSelected ? 12 : 8;\r\n            }\r\n            \r\n            // Fill color based on star class\r\n            ctx.fillStyle = system.starColor ? `#${system.starColor.toString(16).padStart(6, '0')}` : '#ffffff';\r\n            \r\n            // Add glow for current and selected\r\n            if (isCurrent || isSelected) {\r\n                ctx.shadowBlur = this.isMobile ? 20 : 15;\r\n                ctx.shadowColor = isCurrent ? '#30cfd0' : '#ffffff';\r\n            } else {\r\n                ctx.shadowBlur = 0;\r\n            }\r\n            \r\n            // Draw the star\r\n            ctx.arc(x, y, radius, 0, Math.PI * 2);\r\n            ctx.fill();\r\n            \r\n            // Reset shadow\r\n            ctx.shadowBlur = 0;\r\n            \r\n            // Draw border for connected systems\r\n            if (isConnected && !isCurrent) {\r\n                ctx.strokeStyle = '#30cfd0';\r\n                ctx.lineWidth = this.isMobile ? 3 : 2;\r\n                ctx.beginPath();\r\n                ctx.arc(x, y, radius + 3, 0, Math.PI * 2);\r\n                ctx.stroke();\r\n            }\r\n            \r\n            // Draw name label\r\n            ctx.fillStyle = isCurrent ? '#30cfd0' : isSelected ? '#ffffff' : '#aaaaaa';\r\n            ctx.font = isCurrent ? \r\n                      (this.isMobile ? 'bold 14px Courier New' : 'bold 12px Courier New') : \r\n                      (this.isMobile ? '12px Courier New' : '10px Courier New');\r\n            ctx.textAlign = 'center';\r\n            ctx.fillText(system.name, x, y + radius + (this.isMobile ? 18 : 15));\r\n        }\r\n    }\r\n\r\n    // Find which system was clicked (if any)\r\n    findSystemAtPosition(x, y, starSystemGenerator) {\r\n        const systems = starSystemGenerator.getAllSystems();\r\n        const currentSystem = starSystemGenerator.currentSystem;\r\n        \r\n        // Define the center of the canvas\r\n        const centerX = 250;\r\n        const centerY = 250;\r\n        \r\n        // Check each system\r\n        for (const [systemId, system] of Object.entries(systems)) {\r\n            // Convert system position to canvas position\r\n            const canvasX = centerX + system.position.x;\r\n            const canvasY = centerY + system.position.y;\r\n            \r\n            // Calculate distance from click to star\r\n            const dx = x - canvasX;\r\n            const dy = y - canvasY;\r\n            const distance = Math.sqrt(dx * dx + dy * dy);\r\n            \r\n            // If click is within the star's radius (make current system bigger)\r\n            // Use larger tap area for mobile\r\n            const radius = systemId === currentSystem ? \r\n                          (this.isMobile ? 20 : 15) : \r\n                          (this.isMobile ? 15 : 10);\r\n            if (distance <= radius) {\r\n                return systemId;\r\n            }\r\n        }\r\n        \r\n        return null;\r\n    }\r\n}","// navigationLogic.js - Handles star map navigation and travel logic\r\n\r\nexport class NavigationLogic {\r\n    constructor(starSystemGenerator, dockingSystem, stargateInterface) {\r\n        this.starSystemGenerator = starSystemGenerator;\r\n        this.dockingSystem = dockingSystem;\r\n        this.stargateInterface = stargateInterface;\r\n        this.selectedSystem = null;\r\n        this.isTraveling = false;\r\n    }\r\n\r\n    // Select a system and update the UI\r\n    selectSystem(systemId, isMobile, updateSelectedSystemCallback, updateTravelButtonCallback) {\r\n        console.log(`Selecting system: ${systemId}`);\r\n        this.selectedSystem = systemId;\r\n        \r\n        if (!systemId) {\r\n            // Clear selection\r\n            updateSelectedSystemCallback(null, isMobile);\r\n            updateTravelButtonCallback(null, false, false);\r\n            return;\r\n        }\r\n        \r\n        // Get system data\r\n        const system = this.starSystemGenerator.getAllSystems()[systemId];\r\n        const currentSystem = this.starSystemGenerator.currentSystem;\r\n        \r\n        // Update selected system info card\r\n        updateSelectedSystemCallback(system, isMobile);\r\n        \r\n        // Enable/disable travel button\r\n        const isConnected = this.starSystemGenerator.getCurrentSystemConnections().includes(systemId);\r\n        const isCurrentSystem = systemId === currentSystem;\r\n        \r\n        updateTravelButtonCallback(systemId, isCurrentSystem, isConnected);\r\n    }\r\n\r\n    // Handle travel to selected system\r\n    handleTravel(hideCallback) {\r\n        if (this.selectedSystem && this.selectedSystem !== this.starSystemGenerator.currentSystem) {\r\n            console.log(`Initiating travel to system: ${this.selectedSystem}`);\r\n            \r\n            // Set traveling flag before hiding the star map\r\n            this.isTraveling = true;\r\n            \r\n            // Close the star map first\r\n            hideCallback();\r\n            \r\n            // Find the environment object to properly handle transition\r\n            const environment = window.game.environment;\r\n            if (environment && environment.travelToSystem) {\r\n                const success = environment.travelToSystem(this.selectedSystem);\r\n                console.log(`Travel to ${this.selectedSystem} initiated: ${success}`);\r\n                \r\n                // Reset traveling flag after travel is complete\r\n                setTimeout(() => {\r\n                    this.isTraveling = false;\r\n                }, 5000); // Wait for transition to complete\r\n            } else {\r\n                // Fallback to direct use of starSystemGenerator\r\n                const success = this.starSystemGenerator.travelToSystem(this.selectedSystem);\r\n                \r\n                if (success) {\r\n                    // Reset selection\r\n                    this.selectSystem(null);\r\n                    \r\n                    // Notify the user\r\n                    this.showTravelNotification(this.starSystemGenerator.getCurrentSystemData().name);\r\n                    \r\n                    // Reset traveling flag\r\n                    this.isTraveling = false;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    // Show travel notification\r\n    showTravelNotification(systemName, isMobile) {\r\n        // Create notification element\r\n        const notification = document.createElement('div');\r\n        notification.style.position = 'fixed';\r\n        notification.style.top = isMobile ? '30%' : '20%';\r\n        notification.style.left = '50%';\r\n        notification.style.transform = 'translate(-50%, -50%)';\r\n        notification.style.backgroundColor = 'rgba(0, 0, 0, 0.8)';\r\n        notification.style.color = '#30cfd0';\r\n        notification.style.padding = isMobile ? '15px 30px' : '20px 40px';\r\n        notification.style.borderRadius = '10px';\r\n        notification.style.border = '2px solid #30cfd0';\r\n        notification.style.boxShadow = '0 0 30px #30cfd0';\r\n        notification.style.fontFamily = 'Courier New, monospace';\r\n        notification.style.fontSize = isMobile ? '18px' : '20px';\r\n        notification.style.fontWeight = 'bold';\r\n        notification.style.zIndex = '9999';\r\n        notification.style.textAlign = 'center';\r\n        notification.textContent = `ARRIVED AT ${systemName}`;\r\n        \r\n        // Add to DOM\r\n        document.body.appendChild(notification);\r\n        \r\n        // Remove after a few seconds\r\n        setTimeout(() => {\r\n            notification.style.opacity = '0';\r\n            notification.style.transition = 'opacity 1s';\r\n            \r\n            setTimeout(() => {\r\n                notification.remove();\r\n            }, 1000);\r\n        }, 3000);\r\n    }\r\n\r\n    getSelectedSystem() {\r\n        return this.selectedSystem;\r\n    }\r\n\r\n    isTravelingToSystem() {\r\n        return this.isTraveling;\r\n    }\r\n}","// dataManager.js - Handles star map data management and system information\r\n\r\nexport class DataManager {\r\n    constructor(starSystemGenerator) {\r\n        this.starSystemGenerator = starSystemGenerator;\r\n    }\r\n\r\n    // Update the current system information\r\n    updateCurrentSystemInfo(isMobile) {\r\n        const system = this.starSystemGenerator.getCurrentSystemData();\r\n        if (!system) return;\r\n        \r\n        // Update system name and class\r\n        document.getElementById('current-system-name').textContent = system.name;\r\n        document.getElementById('current-system-class').textContent = `Class ${system.starClass} - ${system.classification}`;\r\n        \r\n        // Update resource indicators\r\n        document.getElementById('current-iron-indicator').style.width = `${system.resourceMultipliers.iron * 50}%`;\r\n        document.getElementById('current-gold-indicator').style.width = `${system.resourceMultipliers.gold * 50}%`;\r\n        document.getElementById('current-platinum-indicator').style.width = `${system.resourceMultipliers.platinum * 50}%`;\r\n        \r\n        // Update description and features\r\n        document.getElementById('current-system-description').textContent = system.description;\r\n        document.getElementById('current-system-features').textContent = `Special Features: ${system.specialFeatures.join(', ')}`;\r\n    }\r\n\r\n    // Update selected system info card\r\n    updateSelectedSystemInfo(system, isMobile) {\r\n        const selectedCard = document.getElementById('selected-system-card');\r\n        if (!selectedCard) return;\r\n\r\n        if (!system) {\r\n            // Clear selection\r\n            selectedCard.innerHTML = `\r\n                <div class=\"empty-selection\" style=\"color: #777; text-align: center; padding: 20px;\">\r\n                    No system selected.<br>${isMobile ? 'Tap' : 'Click'} on a star system in the map to select it.\r\n                </div>\r\n            `;\r\n            return;\r\n        }\r\n\r\n        selectedCard.innerHTML = `\r\n            <div id=\"selected-system-name\" style=\"font-size: ${isMobile ? '16px' : '18px'}; font-weight: bold; color: #fff; margin-bottom: 5px;\">${system.name}</div>\r\n            <div id=\"selected-system-class\" style=\"font-size: ${isMobile ? '12px' : '14px'}; color: #aaa; margin-bottom: 10px;\">Class ${system.starClass} - ${system.classification}</div>\r\n            <div id=\"selected-system-resources\" style=\"margin-bottom: 10px;\">\r\n                <div style=\"display: flex; justify-content: space-between; margin-bottom: 5px;\">\r\n                    <span>Iron:</span>\r\n                    <div class=\"resource-indicator\" style=\"width: 100px; height: 8px; background: #333; border-radius: 4px; overflow: hidden;\">\r\n                        <div style=\"height: 100%; width: ${system.resourceMultipliers.iron * 50}%; background: #aaa;\"></div>\r\n                    </div>\r\n                </div>\r\n                <div style=\"display: flex; justify-content: space-between; margin-bottom: 5px;\">\r\n                    <span>Gold:</span>\r\n                    <div class=\"resource-indicator\" style=\"width: 100px; height: 8px; background: #333; border-radius: 4px; overflow: hidden;\">\r\n                        <div style=\"height: 100%; width: ${system.resourceMultipliers.gold * 50}%; background: #FFD700;\"></div>\r\n                    </div>\r\n                </div>\r\n                <div style=\"display: flex; justify-content: space-between;\">\r\n                    <span>Platinum:</span>\r\n                    <div class=\"resource-indicator\" style=\"width: 100px; height: 8px; background: #333; border-radius: 4px; overflow: hidden;\">\r\n                        <div style=\"height: 100%; width: ${system.resourceMultipliers.platinum * 50}%; background: #E5E4E2;\"></div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            <div style=\"font-size: ${isMobile ? '11px' : '12px'}; color: #ccc; margin-bottom: 10px;\">\r\n                ${system.description}\r\n            </div>\r\n            <div style=\"font-size: ${isMobile ? '11px' : '12px'}; color: #30cfd0;\">\r\n                Special Features: ${system.specialFeatures.join(', ')}\r\n            </div>\r\n        `;\r\n        \r\n        // Scroll to make selected system info visible on mobile\r\n        if (isMobile) {\r\n            const infoPanel = document.getElementById('system-info-panel');\r\n            if (infoPanel) {\r\n                infoPanel.scrollTop = selectedCard.offsetTop - infoPanel.offsetTop;\r\n            }\r\n        }\r\n    }\r\n\r\n    // Update travel button state\r\n    updateTravelButton(systemId, isCurrentSystem, isConnected) {\r\n        const travelButton = document.getElementById('travel-button');\r\n        if (!travelButton) return;\r\n\r\n        if (!systemId) {\r\n            // No system selected\r\n            travelButton.disabled = true;\r\n            travelButton.style.cursor = 'not-allowed';\r\n            travelButton.style.opacity = '0.5';\r\n            travelButton.textContent = 'TRAVEL TO SYSTEM';\r\n            return;\r\n        }\r\n\r\n        travelButton.disabled = isCurrentSystem || !isConnected;\r\n        travelButton.style.cursor = isCurrentSystem || !isConnected ? 'not-allowed' : 'pointer';\r\n        travelButton.style.opacity = isCurrentSystem || !isConnected ? '0.5' : '1';\r\n        \r\n        // Update button text\r\n        travelButton.textContent = isCurrentSystem ? 'CURRENT LOCATION' : \r\n                                  !isConnected ? 'NO DIRECT ROUTE' : 'TRAVEL TO SYSTEM';\r\n    }\r\n\r\n    getCurrentSystemData() {\r\n        return this.starSystemGenerator.getCurrentSystemData();\r\n    }\r\n\r\n    getAllSystems() {\r\n        return this.starSystemGenerator.getAllSystems();\r\n    }\r\n\r\n    getCurrentSystem() {\r\n        return this.starSystemGenerator.currentSystem;\r\n    }\r\n}","// uiCreator.js - Handles star map UI creation and setup\r\n\r\nexport class UICreator {\r\n    constructor(isMobile) {\r\n        this.isMobile = isMobile;\r\n    }\r\n\r\n    // Create star map UI\r\n    setupStarMapUI() {\r\n        // Create starmap container\r\n        const starMap = document.createElement('div');\r\n        starMap.id = 'star-map';\r\n        starMap.style.position = 'absolute';\r\n        starMap.style.top = '50%';\r\n        starMap.style.left = '50%';\r\n        starMap.style.transform = 'translate(-50%, -50%)';\r\n        \r\n        // Adjust size for mobile devices\r\n        if (this.isMobile) {\r\n            starMap.style.width = '95%';\r\n            starMap.style.height = '85vh'; // Reduced to ensure the button is visible\r\n            starMap.style.maxHeight = '700px';\r\n        } else {\r\n            starMap.style.width = '900px';\r\n            starMap.style.height = '700px';\r\n        }\r\n        \r\n        starMap.style.backgroundColor = 'rgba(10, 15, 30, 0.95)';\r\n        starMap.style.color = '#fff';\r\n        starMap.style.padding = this.isMobile ? '15px' : '30px';\r\n        starMap.style.borderRadius = '10px';\r\n        starMap.style.border = '2px solid #30cfd0';\r\n        starMap.style.boxShadow = '0 0 30px #30cfd0';\r\n        starMap.style.fontFamily = 'Courier New, monospace';\r\n        starMap.style.zIndex = '1500';\r\n        starMap.style.display = 'none';\r\n        starMap.style.overflow = 'hidden';\r\n        \r\n        // Create title\r\n        const title = document.createElement('h2');\r\n        title.textContent = 'STAR MAP';\r\n        title.style.textAlign = 'center';\r\n        title.style.color = '#30cfd0';\r\n        title.style.margin = '0 0 20px 0';\r\n        title.style.fontSize = this.isMobile ? '24px' : '28px';\r\n        starMap.appendChild(title);\r\n        \r\n        // Create map content container with flexible layout\r\n        const content = document.createElement('div');\r\n        content.style.display = 'flex';\r\n        content.style.flexDirection = this.isMobile ? 'column' : 'row';\r\n        content.style.height = this.isMobile ? 'calc(100% - 120px)' : 'calc(100% - 100px)';\r\n        content.style.gap = this.isMobile ? '15px' : '0';\r\n        \r\n        // Left column - System Map (stars and connections)\r\n        const mapContainer = this.createMapContainer();\r\n        \r\n        // Right column - System Information\r\n        const infoPanel = this.createInfoPanel();\r\n        \r\n        // Add all elements to the map\r\n        content.appendChild(mapContainer);\r\n        content.appendChild(infoPanel);\r\n        starMap.appendChild(content);\r\n        \r\n        // Close button\r\n        const closeButton = this.createCloseButton();\r\n        starMap.appendChild(closeButton);\r\n        \r\n        // Add to DOM\r\n        document.body.appendChild(starMap);\r\n    }\r\n\r\n    createMapContainer() {\r\n        const mapContainer = document.createElement('div');\r\n        mapContainer.id = 'star-map-visual';\r\n        mapContainer.style.flex = '1';\r\n        mapContainer.style.background = 'rgba(0, 0, 0, 0.7)';\r\n        mapContainer.style.borderRadius = '10px';\r\n        mapContainer.style.border = '1px solid #30cfd0';\r\n        mapContainer.style.position = 'relative';\r\n        mapContainer.style.overflow = 'hidden';\r\n        mapContainer.style.height = this.isMobile ? '40%' : '100%';\r\n        mapContainer.style.minHeight = this.isMobile ? '250px' : 'auto';\r\n        \r\n        // Create canvas for map visualization\r\n        const canvas = document.createElement('canvas');\r\n        canvas.id = 'star-map-canvas';\r\n        canvas.width = 500;\r\n        canvas.height = 500;\r\n        canvas.style.width = '100%';\r\n        canvas.style.height = '100%';\r\n        mapContainer.appendChild(canvas);\r\n        \r\n        return mapContainer;\r\n    }\r\n\r\n    createInfoPanel() {\r\n        const infoPanel = document.createElement('div');\r\n        infoPanel.id = 'system-info-panel';\r\n        infoPanel.style.width = this.isMobile ? '100%' : '350px';\r\n        infoPanel.style.marginLeft = this.isMobile ? '0' : '20px';\r\n        infoPanel.style.overflowY = 'auto';\r\n        infoPanel.style.height = this.isMobile ? '60%' : '100%';\r\n        infoPanel.style.webkitOverflowScrolling = 'touch'; // For smooth scrolling on iOS\r\n        \r\n        // Current system section\r\n        const currentSystem = this.createCurrentSystemSection();\r\n        infoPanel.appendChild(currentSystem);\r\n        \r\n        // Selected system section\r\n        const selectedSystem = this.createSelectedSystemSection();\r\n        infoPanel.appendChild(selectedSystem);\r\n        \r\n        return infoPanel;\r\n    }\r\n\r\n    createCurrentSystemSection() {\r\n        const currentSystem = document.createElement('div');\r\n        currentSystem.id = 'current-system-info';\r\n        currentSystem.innerHTML = `\r\n            <h3 style=\"color: #30cfd0; margin-top: 0; font-size: ${this.isMobile ? '16px' : '18px'};\">CURRENT SYSTEM</h3>\r\n            <div class=\"system-card\" style=\"background: rgba(0, 0, 0, 0.7); padding: 15px; border-radius: 5px; border: 1px solid #30cfd0; margin-bottom: 20px;\">\r\n                <div id=\"current-system-name\" style=\"font-size: ${this.isMobile ? '16px' : '18px'}; font-weight: bold; color: #fff; margin-bottom: 5px;\">Solar System</div>\r\n                <div id=\"current-system-class\" style=\"font-size: ${this.isMobile ? '12px' : '14px'}; color: #aaa; margin-bottom: 10px;\">Class G - Home System</div>\r\n                <div id=\"current-system-resources\" style=\"margin-bottom: 10px;\">\r\n                    <div style=\"display: flex; justify-content: space-between; margin-bottom: 5px;\">\r\n                        <span>Iron:</span>\r\n                        <div class=\"resource-indicator\" style=\"width: 100px; height: 8px; background: #333; border-radius: 4px; overflow: hidden;\">\r\n                            <div id=\"current-iron-indicator\" style=\"height: 100%; width: 50%; background: #aaa;\"></div>\r\n                        </div>\r\n                    </div>\r\n                    <div style=\"display: flex; justify-content: space-between; margin-bottom: 5px;\">\r\n                        <span>Gold:</span>\r\n                        <div class=\"resource-indicator\" style=\"width: 100px; height: 8px; background: #333; border-radius: 4px; overflow: hidden;\">\r\n                            <div id=\"current-gold-indicator\" style=\"height: 100%; width: 50%; background: #FFD700;\"></div>\r\n                        </div>\r\n                    </div>\r\n                    <div style=\"display: flex; justify-content: space-between;\">\r\n                        <span>Platinum:</span>\r\n                        <div class=\"resource-indicator\" style=\"width: 100px; height: 8px; background: #333; border-radius: 4px; overflow: hidden;\">\r\n                            <div id=\"current-platinum-indicator\" style=\"height: 100%; width: 50%; background: #E5E4E2;\"></div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <div id=\"current-system-description\" style=\"font-size: ${this.isMobile ? '11px' : '12px'}; color: #ccc; margin-bottom: 10px;\">\r\n                    Our home system, with Earth as the starting location.\r\n                </div>\r\n                <div id=\"current-system-features\" style=\"font-size: ${this.isMobile ? '11px' : '12px'}; color: #30cfd0;\">\r\n                    Special Features: Earth\r\n                </div>\r\n            </div>\r\n        `;\r\n        return currentSystem;\r\n    }\r\n\r\n    createSelectedSystemSection() {\r\n        const selectedSystem = document.createElement('div');\r\n        selectedSystem.id = 'selected-system-info';\r\n        selectedSystem.innerHTML = `\r\n            <h3 style=\"color: #30cfd0; font-size: ${this.isMobile ? '16px' : '18px'};\">SELECTED SYSTEM</h3>\r\n            <div id=\"selected-system-card\" class=\"system-card\" style=\"background: rgba(0, 0, 0, 0.7); padding: 15px; border-radius: 5px; border: 1px solid #555; margin-bottom: 20px;\">\r\n                <div class=\"empty-selection\" style=\"color: #777; text-align: center; padding: 20px;\">\r\n                    No system selected.<br>\r\n                    ${this.isMobile ? 'Tap' : 'Click'} on a star system in the map to select it.\r\n                </div>\r\n            </div>\r\n            <button id=\"travel-button\" disabled style=\"width: 100%; padding: ${this.isMobile ? '15px' : '12px'}; background-color: #30cfd0; color: #000; border: none; border-radius: 5px; cursor: not-allowed; font-family: 'Courier New', monospace; font-weight: bold; font-size: ${this.isMobile ? '18px' : '16px'}; opacity: 0.5;\">\r\n                TRAVEL TO SYSTEM\r\n            </button>\r\n        `;\r\n        return selectedSystem;\r\n    }\r\n\r\n    createCloseButton() {\r\n        const closeButton = document.createElement('button');\r\n        closeButton.id = 'close-star-map';\r\n        closeButton.textContent = 'RETURN TO STARGATE';\r\n        closeButton.style.width = '100%';\r\n        closeButton.style.padding = this.isMobile ? '15px' : '12px';\r\n        closeButton.style.marginTop = '20px';\r\n        closeButton.style.backgroundColor = '#555';\r\n        closeButton.style.color = '#fff';\r\n        closeButton.style.border = 'none';\r\n        closeButton.style.borderRadius = '5px';\r\n        closeButton.style.cursor = 'pointer';\r\n        closeButton.style.fontFamily = 'Courier New, monospace';\r\n        closeButton.style.fontWeight = 'bold';\r\n        closeButton.style.fontSize = this.isMobile ? '18px' : '16px';\r\n        \r\n        // Make the button more prominent on mobile\r\n        if (this.isMobile) {\r\n            closeButton.style.backgroundColor = '#30cfd0';\r\n            closeButton.style.color = '#000';\r\n            closeButton.style.boxShadow = '0 0 15px rgba(48, 207, 208, 0.7)';\r\n        }\r\n        \r\n        return closeButton;\r\n    }\r\n}","// starMap.js - Handles the star map UI for interstellar travel\r\n\r\nimport { MobileDetector } from '../../utils/mobileDetector.js';\r\nimport { CanvasRenderer } from './starmap/canvasRenderer.js';\r\nimport { NavigationLogic } from './starmap/navigationLogic.js';\r\nimport { DataManager } from './starmap/dataManager.js';\r\nimport { UICreator } from './starmap/uiCreator.js';\r\n\r\nexport class StarMap {\r\n    constructor(starSystemGenerator, dockingSystem, stargateInterface) {\r\n        this.starSystemGenerator = starSystemGenerator;\r\n        this.dockingSystem = dockingSystem;\r\n        this.stargateInterface = stargateInterface;\r\n        this.isVisible = false;\r\n        this.isMobile = MobileDetector.isMobile();\r\n        \r\n        console.log(\"StarMap constructor - isMobile:\", this.isMobile);\r\n        \r\n        // Initialize component modules\r\n        this.canvasRenderer = new CanvasRenderer(this.isMobile);\r\n        this.navigationLogic = new NavigationLogic(starSystemGenerator, dockingSystem, stargateInterface);\r\n        this.dataManager = new DataManager(starSystemGenerator);\r\n        this.uiCreator = new UICreator(this.isMobile);\r\n        \r\n        // Create star map UI\r\n        this.uiCreator.setupStarMapUI();\r\n        \r\n        // Set event handlers\r\n        this.setupEventHandlers();\r\n    }\r\n    \r\n    \r\n    setupEventHandlers() {\r\n        // Close button\r\n        const closeButton = document.getElementById('close-star-map');\r\n        if (closeButton) {\r\n            closeButton.addEventListener('click', () => {\r\n                if (window.game && window.game.audio) {\r\n                    window.game.audio.playSound('boink');\r\n                }\r\n                this.hide();\r\n            });\r\n            \r\n            // Add touch event for mobile\r\n            if (this.isMobile) {\r\n                closeButton.addEventListener('touchend', (e) => {\r\n                    e.preventDefault();\r\n                    if (window.game && window.game.audio) {\r\n                        console.log(\"Mobile: Playing sound on star map close button\");\r\n                        window.game.audio.playSound('boink');\r\n                        // Give time for the sound to start before hiding\r\n                        setTimeout(() => this.hide(), 50);\r\n                    } else {\r\n                        this.hide();\r\n                    }\r\n                });\r\n            }\r\n        }\r\n        \r\n        // Canvas click/touch handler for selecting systems\r\n        const canvas = document.getElementById('star-map-canvas');\r\n        if (canvas) {\r\n            // Mouse events\r\n            canvas.addEventListener('click', (e) => {\r\n                this.handleMapInteraction(e);\r\n            });\r\n            \r\n            // Touch events for mobile\r\n            if (this.isMobile) {\r\n                canvas.addEventListener('touchend', (e) => {\r\n                    e.preventDefault();\r\n                    this.handleMapInteraction(e.changedTouches[0]);\r\n                });\r\n            }\r\n        }\r\n        \r\n        // Travel button\r\n        const travelButton = document.getElementById('travel-button');\r\n        if (travelButton) {\r\n            const travelHandler = () => {\r\n                this.navigationLogic.handleTravel(() => this.hide());\r\n            };\r\n            \r\n            // Click event\r\n            travelButton.addEventListener('click', travelHandler);\r\n            \r\n            // Touch event for mobile\r\n            if (this.isMobile) {\r\n                travelButton.addEventListener('touchend', (e) => {\r\n                    e.preventDefault();\r\n                    travelHandler();\r\n                });\r\n            }\r\n        }\r\n    }\r\n    \r\n    // Handler for map interactions (click or touch)\r\n    handleMapInteraction(event) {\r\n        // Convert click/touch position to canvas coordinates\r\n        const canvas = document.getElementById('star-map-canvas');\r\n        const rect = canvas.getBoundingClientRect();\r\n        const x = (event.clientX - rect.left) * (canvas.width / rect.width);\r\n        const y = (event.clientY - rect.top) * (canvas.height / rect.height);\r\n        \r\n        // Check if a star system was clicked/tapped\r\n        const clickedSystem = this.canvasRenderer.findSystemAtPosition(x, y, this.starSystemGenerator);\r\n        if (clickedSystem) {\r\n            this.selectSystem(clickedSystem);\r\n            this.updateCanvas(); // Redraw to show selection\r\n        }\r\n    }\r\n    \r\n    // Select a system and update the UI\r\n    selectSystem(systemId) {\r\n        this.navigationLogic.selectSystem(\r\n            systemId, \r\n            this.isMobile,\r\n            (system, isMobile) => this.dataManager.updateSelectedSystemInfo(system, isMobile),\r\n            (systemId, isCurrentSystem, isConnected) => this.dataManager.updateTravelButton(systemId, isCurrentSystem, isConnected)\r\n        );\r\n    }\r\n    \r\n    // Draw the star map on the canvas\r\n    updateCanvas() {\r\n        this.canvasRenderer.updateCanvas(this.starSystemGenerator);\r\n        // Update selected system drawing\r\n        this.canvasRenderer.drawSystems(\r\n            document.getElementById('star-map-canvas').getContext('2d'),\r\n            250, 250, // center coordinates\r\n            this.dataManager.getAllSystems(),\r\n            this.dataManager.getCurrentSystem(),\r\n            this.navigationLogic.getSelectedSystem()\r\n        );\r\n    }\r\n    \r\n    // Update the current system information\r\n    updateCurrentSystemInfo() {\r\n        this.dataManager.updateCurrentSystemInfo(this.isMobile);\r\n    }\r\n    \r\n    // Show the star map\r\n    show() {\r\n        // Update the map with current data\r\n        this.updateCurrentSystemInfo();\r\n        this.updateCanvas();\r\n        \r\n        // Reset selection\r\n        this.selectSystem(null);\r\n        \r\n        // Force audio context resumption for mobile\r\n        if (this.isMobile && window.game && window.game.audio) {\r\n            // Play a sound to kickstart the audio context\r\n            setTimeout(() => {\r\n                console.log(\"Mobile: Attempting to play initial sound in StarMap\");\r\n                window.game.audio.playSound('boink');\r\n            }, 100);\r\n        }\r\n        \r\n        // Show the map\r\n        const starMap = document.getElementById('star-map');\r\n        if (starMap) {\r\n            starMap.style.display = 'block';\r\n            this.isVisible = true;\r\n        }\r\n    }\r\n    \r\n    // Hide the star map\r\n    hide() {\r\n        const starMap = document.getElementById('star-map');\r\n        if (starMap) {\r\n            starMap.style.display = 'none';\r\n            this.isVisible = false;\r\n            \r\n            // Show the stargate UI when returning from star map\r\n            if (this.stargateInterface) {\r\n                this.stargateInterface.showStargateUI();\r\n            } else if (window.game && window.game.ui && window.game.ui.stargateInterface) {\r\n                // Try to find stargate UI via game instance if direct reference fails\r\n                window.game.ui.stargateInterface.showStargateUI();\r\n            } else {\r\n                // Direct DOM access as last resort\r\n                const stargateUI = document.getElementById('stargate-ui');\r\n                if (stargateUI) {\r\n                    stargateUI.style.display = 'block';\r\n                }\r\n            }\r\n        }\r\n    }\r\n    \r\n    // Toggle map visibility\r\n    toggle() {\r\n        if (this.isVisible) {\r\n            this.hide();\r\n        } else {\r\n            this.show();\r\n        }\r\n    }\r\n}","/**\r\n * Blackjack Game Styles - CSS styling and visual theming\r\n */\r\n\r\nexport class BlackjackStyles {\r\n    constructor(isMobile = false) {\r\n        this.isMobile = isMobile;\r\n    }\r\n\r\n    /**\r\n     * Get main game UI styles\r\n     */\r\n    getGameUIStyles() {\r\n        return {\r\n            position: 'absolute',\r\n            top: '50%',\r\n            left: '50%',\r\n            transform: 'translate(-50%, -50%)',\r\n            width: this.isMobile ? '95%' : '900px',\r\n            maxWidth: this.isMobile ? '600px' : 'none',\r\n            height: this.isMobile ? 'auto' : '650px',\r\n            maxHeight: this.isMobile ? '85vh' : 'none',\r\n            backgroundColor: 'rgba(6, 22, 31, 0.85)',\r\n            backdropFilter: 'blur(10px)',\r\n            border: '2px solid #33aaff',\r\n            borderRadius: '15px',\r\n            boxShadow: '0 0 30px rgba(51, 170, 255, 0.5)',\r\n            padding: this.isMobile ? '15px' : '25px',\r\n            zIndex: '1000',\r\n            display: 'none',\r\n            fontFamily: 'Courier New, monospace',\r\n            color: '#fff',\r\n            userSelect: 'none',\r\n            overflowY: this.isMobile ? 'auto' : 'hidden'\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Get mobile-specific styles\r\n     */\r\n    getMobileStyles() {\r\n        if (!this.isMobile) return {};\r\n        \r\n        return {\r\n            webkitOverflowScrolling: 'touch',\r\n            touchAction: 'pan-y',\r\n            overscrollBehavior: 'contain'\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Get scanline effect styles\r\n     */\r\n    getScanlineStyles() {\r\n        return {\r\n            position: 'absolute',\r\n            top: '0',\r\n            left: '0',\r\n            width: '100%',\r\n            height: '100%',\r\n            backgroundImage: 'linear-gradient(transparent 50%, rgba(0, 0, 0, 0.1) 50%)',\r\n            backgroundSize: '100% 4px',\r\n            pointerEvents: 'none',\r\n            zIndex: '1001',\r\n            opacity: '0.15'\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Get header styles\r\n     */\r\n    getHeaderStyles() {\r\n        return {\r\n            textAlign: 'center',\r\n            marginBottom: '20px',\r\n            position: 'relative'\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Get title styles\r\n     */\r\n    getTitleStyles() {\r\n        return {\r\n            color: '#30cfd0',\r\n            textShadow: '0 0 10px rgba(48, 207, 208, 0.7)',\r\n            margin: '0 0 5px 0',\r\n            fontSize: this.isMobile ? '24px' : '32px'\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Get subtitle styles\r\n     */\r\n    getSubtitleStyles() {\r\n        return {\r\n            color: 'rgba(255, 255, 255, 0.6)',\r\n            fontSize: this.isMobile ? '12px' : '14px',\r\n            letterSpacing: '2px'\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Get close button styles\r\n     */\r\n    getCloseButtonStyles() {\r\n        const baseStyles = {\r\n            position: 'absolute',\r\n            top: '0',\r\n            right: '0',\r\n            backgroundColor: 'transparent',\r\n            border: 'none',\r\n            color: '#33aaff',\r\n            fontSize: '32px',\r\n            cursor: 'pointer',\r\n            outline: 'none',\r\n            padding: '0 10px',\r\n            lineHeight: '1'\r\n        };\r\n\r\n        if (this.isMobile) {\r\n            return {\r\n                ...baseStyles,\r\n                fontSize: '42px',\r\n                padding: '5px 15px',\r\n                backgroundColor: 'rgba(0, 0, 0, 0.3)',\r\n                borderRadius: '50%',\r\n                width: '50px',\r\n                height: '50px',\r\n                display: 'flex',\r\n                justifyContent: 'center',\r\n                alignItems: 'center',\r\n                boxShadow: '0 0 10px rgba(51, 170, 255, 0.5)',\r\n                right: '5px',\r\n                top: '5px'\r\n            };\r\n        }\r\n\r\n        return baseStyles;\r\n    }\r\n\r\n    /**\r\n     * Get game area styles\r\n     */\r\n    getGameAreaStyles() {\r\n        return {\r\n            display: 'flex',\r\n            flexDirection: 'column',\r\n            height: this.isMobile ? 'auto' : 'calc(100% - 80px)'\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Get dealer/player area styles\r\n     */\r\n    getPlayerAreaStyles() {\r\n        return {\r\n            flex: '1',\r\n            border: '1px solid rgba(51, 170, 255, 0.3)',\r\n            borderRadius: '8px',\r\n            padding: '15px',\r\n            marginBottom: '15px',\r\n            background: 'linear-gradient(to bottom, rgba(9, 30, 42, 0.4), rgba(9, 30, 42, 0.6))'\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Get dealer area styles\r\n     */\r\n    getDealerAreaStyles() {\r\n        return {\r\n            ...this.getPlayerAreaStyles(),\r\n            background: 'linear-gradient(to bottom, rgba(9, 30, 42, 0.6), rgba(9, 30, 42, 0.4))'\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Get area header styles\r\n     */\r\n    getAreaHeaderStyles() {\r\n        return {\r\n            display: 'flex',\r\n            justifyContent: 'space-between',\r\n            marginBottom: '10px'\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Get dealer title styles\r\n     */\r\n    getDealerTitleStyles() {\r\n        return {\r\n            color: '#33aaff',\r\n            fontWeight: 'bold'\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Get player title styles\r\n     */\r\n    getPlayerTitleStyles() {\r\n        return {\r\n            color: '#30cfd0',\r\n            fontWeight: 'bold'\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Get score display styles\r\n     */\r\n    getScoreStyles(isPlayer = false) {\r\n        return {\r\n            color: '#fff',\r\n            fontWeight: 'bold',\r\n            backgroundColor: isPlayer ? 'rgba(48, 207, 208, 0.2)' : 'rgba(51, 170, 255, 0.2)',\r\n            padding: '0 10px',\r\n            borderRadius: '4px'\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Get cards container styles\r\n     */\r\n    getCardsContainerStyles() {\r\n        return {\r\n            display: 'flex',\r\n            gap: '15px',\r\n            flexWrap: 'wrap',\r\n            height: this.isMobile ? 'auto' : '130px',\r\n            minHeight: this.isMobile ? '120px' : '130px'\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Get card element styles\r\n     */\r\n    getCardStyles(faceDown = false) {\r\n        return {\r\n            width: this.isMobile ? '70px' : '100px',\r\n            height: this.isMobile ? '105px' : '150px',\r\n            fontSize: this.isMobile ? '80%' : '100%',\r\n            backgroundColor: faceDown ? 'rgba(9, 30, 42, 0.8)' : 'rgba(15, 35, 50, 0.9)',\r\n            border: faceDown ? \r\n                '2px solid rgba(51, 170, 255, 0.3)' : \r\n                '2px solid rgba(51, 170, 255, 0.7)',\r\n            borderRadius: '10px',\r\n            boxShadow: faceDown ?\r\n                '0 0 5px rgba(51, 170, 255, 0.3)' :\r\n                '0 0 10px rgba(51, 170, 255, 0.5)',\r\n            position: 'relative',\r\n            display: 'flex',\r\n            justifyContent: 'center',\r\n            alignItems: 'center',\r\n            overflow: 'hidden',\r\n            transition: 'transform 0.3s ease'\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Get card value styles\r\n     */\r\n    getCardValueStyles(position = 'top') {\r\n        const baseStyles = {\r\n            position: 'absolute',\r\n            fontSize: this.isMobile ? '14px' : '20px',\r\n            fontWeight: 'bold'\r\n        };\r\n\r\n        if (position === 'top') {\r\n            return {\r\n                ...baseStyles,\r\n                top: '8px',\r\n                left: '8px'\r\n            };\r\n        } else {\r\n            return {\r\n                ...baseStyles,\r\n                bottom: '8px',\r\n                right: '8px',\r\n                transform: 'rotate(180deg)'\r\n            };\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Get card suit styles\r\n     */\r\n    getCardSuitStyles(position = 'top') {\r\n        const baseStyles = {\r\n            position: 'absolute',\r\n            fontSize: this.isMobile ? '12px' : '16px'\r\n        };\r\n\r\n        if (position === 'top') {\r\n            return {\r\n                ...baseStyles,\r\n                top: '8px',\r\n                right: '8px'\r\n            };\r\n        } else {\r\n            return {\r\n                ...baseStyles,\r\n                bottom: '8px',\r\n                left: '8px',\r\n                transform: 'rotate(180deg)'\r\n            };\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Get center symbol styles\r\n     */\r\n    getCenterSymbolStyles() {\r\n        return {\r\n            fontSize: this.isMobile ? '28px' : '40px',\r\n            lineHeight: '1',\r\n            opacity: '0.9'\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Get card color based on suit\r\n     */\r\n    getCardColor(suit) {\r\n        return ['hearts', 'diamonds'].includes(suit) ? '#e55c8a' : '#30cfd0';\r\n    }\r\n\r\n    /**\r\n     * Get speech bubble styles\r\n     */\r\n    getSpeechBubbleStyles() {\r\n        return {\r\n            position: this.isMobile ? 'relative' : 'absolute',\r\n            bottom: this.isMobile ? 'auto' : '15px',\r\n            right: this.isMobile ? 'auto' : '15px',\r\n            marginTop: this.isMobile ? '10px' : '0',\r\n            backgroundColor: 'rgba(15, 40, 55, 0.9)',\r\n            border: '1px solid #33aaff',\r\n            borderRadius: '8px',\r\n            padding: '10px 15px',\r\n            maxWidth: this.isMobile ? '100%' : '300px',\r\n            fontStyle: 'italic',\r\n            color: '#fff',\r\n            boxShadow: '0 0 10px rgba(51, 170, 255, 0.3)',\r\n            display: 'none'\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Get status area styles\r\n     */\r\n    getStatusAreaStyles() {\r\n        return {\r\n            height: '60px',\r\n            display: 'flex',\r\n            justifyContent: 'center',\r\n            alignItems: 'center',\r\n            marginBottom: '15px'\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Get game status styles\r\n     */\r\n    getGameStatusStyles() {\r\n        return {\r\n            padding: '8px 20px',\r\n            borderRadius: '20px',\r\n            backgroundColor: 'rgba(51, 170, 255, 0.2)',\r\n            border: '1px solid rgba(51, 170, 255, 0.4)',\r\n            color: '#fff',\r\n            textAlign: 'center',\r\n            fontWeight: 'bold',\r\n            letterSpacing: '1px',\r\n            fontSize: this.isMobile ? '12px' : '14px',\r\n            width: this.isMobile ? '100%' : 'auto'\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Get controls area styles\r\n     */\r\n    getControlsAreaStyles() {\r\n        return {\r\n            display: 'flex',\r\n            justifyContent: 'space-between',\r\n            alignItems: 'center',\r\n            height: 'auto',\r\n            flexDirection: this.isMobile ? 'column' : 'row',\r\n            gap: this.isMobile ? '15px' : '0'\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Get betting controls styles\r\n     */\r\n    getBettingControlsStyles() {\r\n        return {\r\n            display: 'flex',\r\n            flexDirection: 'column',\r\n            width: this.isMobile ? '100%' : '250px'\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Get betting title styles\r\n     */\r\n    getBettingTitleStyles() {\r\n        return {\r\n            marginBottom: '10px',\r\n            color: 'rgba(255, 255, 255, 0.8)',\r\n            fontWeight: 'bold'\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Get resource options styles\r\n     */\r\n    getResourceOptionsStyles() {\r\n        return {\r\n            display: 'flex',\r\n            gap: '10px'\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Get resource button styles\r\n     */\r\n    getResourceButtonStyles(color) {\r\n        return {\r\n            flex: '1',\r\n            padding: this.isMobile ? '10px 5px' : '8px 5px',\r\n            backgroundColor: 'rgba(15, 40, 55, 0.8)',\r\n            border: `1px solid ${color}`,\r\n            borderRadius: '5px',\r\n            color: '#fff',\r\n            boxShadow: `0 0 10px rgba(${color.split('(')[1].split(')')[0]}, 0.3)`,\r\n            cursor: 'pointer',\r\n            display: 'flex',\r\n            flexDirection: 'column',\r\n            alignItems: 'center',\r\n            transition: 'background-color 0.2s, box-shadow 0.2s'\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Get resource button hover styles\r\n     */\r\n    getResourceButtonHoverStyles(color) {\r\n        return {\r\n            backgroundColor: 'rgba(25, 60, 80, 0.8)',\r\n            boxShadow: `0 0 15px ${color}`\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Get bet amount controls styles\r\n     */\r\n    getBetAmountControlsStyles() {\r\n        return {\r\n            display: 'flex',\r\n            marginTop: '10px',\r\n            gap: '10px'\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Get bet amount display styles\r\n     */\r\n    getBetAmountDisplayStyles() {\r\n        return {\r\n            flex: '1',\r\n            backgroundColor: 'rgba(15, 40, 55, 0.8)',\r\n            border: '1px solid rgba(51, 170, 255, 0.5)',\r\n            borderRadius: '5px',\r\n            padding: '8px 10px',\r\n            textAlign: 'center',\r\n            fontWeight: 'bold'\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Get control button styles\r\n     */\r\n    getControlButtonStyles() {\r\n        return {\r\n            width: this.isMobile ? '50px' : '40px',\r\n            height: this.isMobile ? '40px' : 'auto',\r\n            backgroundColor: 'rgba(15, 40, 55, 0.8)',\r\n            border: '1px solid rgba(51, 170, 255, 0.5)',\r\n            borderRadius: '5px',\r\n            color: '#fff',\r\n            cursor: 'pointer',\r\n            fontSize: this.isMobile ? '20px' : '16px'\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Get control button hover styles\r\n     */\r\n    getControlButtonHoverStyles() {\r\n        return {\r\n            backgroundColor: 'rgba(25, 60, 80, 0.8)',\r\n            boxShadow: '0 0 10px rgba(51, 170, 255, 0.3)'\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Get game actions styles\r\n     */\r\n    getGameActionsStyles() {\r\n        return {\r\n            display: 'flex',\r\n            gap: '15px',\r\n            flexWrap: this.isMobile ? 'wrap' : 'nowrap',\r\n            justifyContent: this.isMobile ? 'center' : 'flex-end',\r\n            width: this.isMobile ? '100%' : 'auto'\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Get action button styles\r\n     */\r\n    getActionButtonStyles(color) {\r\n        return {\r\n            padding: this.isMobile ? '15px 20px' : '12px 18px',\r\n            backgroundColor: 'rgba(15, 40, 55, 0.8)',\r\n            border: `2px solid ${color}`,\r\n            borderRadius: '5px',\r\n            color: '#fff',\r\n            fontWeight: 'bold',\r\n            cursor: 'pointer',\r\n            boxShadow: `0 0 10px ${color}`,\r\n            transition: 'all 0.2s',\r\n            minWidth: this.isMobile ? '80px' : 'auto',\r\n            flex: this.isMobile ? '1' : 'none'\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Get action button hover styles\r\n     */\r\n    getActionButtonHoverStyles(color) {\r\n        return {\r\n            backgroundColor: 'rgba(25, 60, 80, 0.8)',\r\n            boxShadow: `0 0 15px ${color}`\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Apply styles to an element\r\n     */\r\n    applyStyles(element, styles) {\r\n        Object.assign(element.style, styles);\r\n    }\r\n}","/**\r\n * Blackjack Game View - DOM creation, card display, table layout\r\n */\r\n\r\nimport { BlackjackStyles } from './styles.js';\r\n\r\nexport class BlackjackGameView {\r\n    constructor(isMobile = false) {\r\n        this.isMobile = isMobile;\r\n        this.styles = new BlackjackStyles(isMobile);\r\n        this.cardSymbols = {\r\n            spades: '', // Asteroid symbol\r\n            hearts: '', // Planet symbol\r\n            clubs: '', // Star symbol\r\n            diamonds: '' // Nebula symbol\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Create the main game UI container\r\n     */\r\n    createGameUI() {\r\n        const gameUI = document.createElement('div');\r\n        gameUI.id = 'blackjack-game';\r\n        \r\n        // Apply main UI styles\r\n        this.styles.applyStyles(gameUI, this.styles.getGameUIStyles());\r\n        this.styles.applyStyles(gameUI, this.styles.getMobileStyles());\r\n        \r\n        // Add scanline effect\r\n        const scanlines = document.createElement('div');\r\n        this.styles.applyStyles(scanlines, this.styles.getScanlineStyles());\r\n        gameUI.appendChild(scanlines);\r\n        \r\n        // Create header\r\n        const header = this.createHeader();\r\n        gameUI.appendChild(header);\r\n        \r\n        // Create game area\r\n        const gameArea = this.createGameArea();\r\n        gameUI.appendChild(gameArea);\r\n        \r\n        document.body.appendChild(gameUI);\r\n        return gameUI;\r\n    }\r\n\r\n    /**\r\n     * Create the header section\r\n     */\r\n    createHeader() {\r\n        const header = document.createElement('div');\r\n        this.styles.applyStyles(header, this.styles.getHeaderStyles());\r\n        \r\n        // Title\r\n        const title = document.createElement('h2');\r\n        title.textContent = 'STELLAR BLACKJACK';\r\n        this.styles.applyStyles(title, this.styles.getTitleStyles());\r\n        header.appendChild(title);\r\n        \r\n        // Subtitle\r\n        const subtitle = document.createElement('div');\r\n        subtitle.textContent = 'WAGER RESOURCES  WIN BIG  BEAT THE DEALER';\r\n        this.styles.applyStyles(subtitle, this.styles.getSubtitleStyles());\r\n        header.appendChild(subtitle);\r\n        \r\n        // Close button\r\n        const closeBtn = this.createCloseButton();\r\n        header.appendChild(closeBtn);\r\n        \r\n        return header;\r\n    }\r\n\r\n    /**\r\n     * Create the close button\r\n     */\r\n    createCloseButton() {\r\n        const closeBtn = document.createElement('button');\r\n        closeBtn.textContent = '';\r\n        this.styles.applyStyles(closeBtn, this.styles.getCloseButtonStyles());\r\n        return closeBtn;\r\n    }\r\n\r\n    /**\r\n     * Create the main game area\r\n     */\r\n    createGameArea() {\r\n        const gameArea = document.createElement('div');\r\n        this.styles.applyStyles(gameArea, this.styles.getGameAreaStyles());\r\n        \r\n        // Dealer area\r\n        const dealerArea = this.createDealerArea();\r\n        gameArea.appendChild(dealerArea);\r\n        \r\n        // Status area\r\n        const statusArea = this.createStatusArea();\r\n        gameArea.appendChild(statusArea);\r\n        \r\n        // Player area\r\n        const playerArea = this.createPlayerArea();\r\n        gameArea.appendChild(playerArea);\r\n        \r\n        // Controls area\r\n        const controlsArea = this.createControlsArea();\r\n        gameArea.appendChild(controlsArea);\r\n        \r\n        return gameArea;\r\n    }\r\n\r\n    /**\r\n     * Create the dealer area\r\n     */\r\n    createDealerArea() {\r\n        const dealerArea = document.createElement('div');\r\n        this.styles.applyStyles(dealerArea, this.styles.getDealerAreaStyles());\r\n        \r\n        // Dealer header\r\n        const dealerHeader = this.createAreaHeader('DEALER', 'dealer-score', false);\r\n        dealerArea.appendChild(dealerHeader);\r\n        \r\n        // Dealer cards container\r\n        const dealerCards = document.createElement('div');\r\n        dealerCards.id = 'dealer-cards';\r\n        this.styles.applyStyles(dealerCards, this.styles.getCardsContainerStyles());\r\n        dealerArea.appendChild(dealerCards);\r\n        \r\n        // Dealer speech bubble\r\n        const speechBubble = document.createElement('div');\r\n        speechBubble.id = 'dealer-speech';\r\n        this.styles.applyStyles(speechBubble, this.styles.getSpeechBubbleStyles());\r\n        dealerArea.appendChild(speechBubble);\r\n        \r\n        return dealerArea;\r\n    }\r\n\r\n    /**\r\n     * Create the player area\r\n     */\r\n    createPlayerArea() {\r\n        const playerArea = document.createElement('div');\r\n        this.styles.applyStyles(playerArea, this.styles.getPlayerAreaStyles());\r\n        \r\n        // Player header\r\n        const playerHeader = this.createAreaHeader('YOUR HAND', 'player-score', true);\r\n        playerArea.appendChild(playerHeader);\r\n        \r\n        // Player cards container\r\n        const playerCards = document.createElement('div');\r\n        playerCards.id = 'player-cards';\r\n        this.styles.applyStyles(playerCards, this.styles.getCardsContainerStyles());\r\n        playerArea.appendChild(playerCards);\r\n        \r\n        return playerArea;\r\n    }\r\n\r\n    /**\r\n     * Create area header (dealer/player)\r\n     */\r\n    createAreaHeader(title, scoreId, isPlayer) {\r\n        const header = document.createElement('div');\r\n        header.className = isPlayer ? 'player-header' : 'dealer-header';\r\n        this.styles.applyStyles(header, this.styles.getAreaHeaderStyles());\r\n        \r\n        // Title\r\n        const titleElement = document.createElement('div');\r\n        titleElement.textContent = title;\r\n        this.styles.applyStyles(titleElement, isPlayer ? this.styles.getPlayerTitleStyles() : this.styles.getDealerTitleStyles());\r\n        header.appendChild(titleElement);\r\n        \r\n        // Score\r\n        const score = document.createElement('div');\r\n        score.id = scoreId;\r\n        score.textContent = '0';\r\n        this.styles.applyStyles(score, this.styles.getScoreStyles(isPlayer));\r\n        header.appendChild(score);\r\n        \r\n        return header;\r\n    }\r\n\r\n    /**\r\n     * Create the status area\r\n     */\r\n    createStatusArea() {\r\n        const statusArea = document.createElement('div');\r\n        this.styles.applyStyles(statusArea, this.styles.getStatusAreaStyles());\r\n        \r\n        const gameStatus = document.createElement('div');\r\n        gameStatus.id = 'game-status';\r\n        gameStatus.textContent = 'PLACE YOUR BET TO BEGIN';\r\n        this.styles.applyStyles(gameStatus, this.styles.getGameStatusStyles());\r\n        statusArea.appendChild(gameStatus);\r\n        \r\n        return statusArea;\r\n    }\r\n\r\n    /**\r\n     * Create the controls area\r\n     */\r\n    createControlsArea() {\r\n        const controlsArea = document.createElement('div');\r\n        this.styles.applyStyles(controlsArea, this.styles.getControlsAreaStyles());\r\n        \r\n        // Betting controls\r\n        const bettingControls = this.createBettingControls();\r\n        controlsArea.appendChild(bettingControls);\r\n        \r\n        // Game actions\r\n        const gameActions = this.createGameActions();\r\n        controlsArea.appendChild(gameActions);\r\n        \r\n        return controlsArea;\r\n    }\r\n\r\n    /**\r\n     * Create betting controls\r\n     */\r\n    createBettingControls() {\r\n        const bettingControls = document.createElement('div');\r\n        bettingControls.id = 'betting-controls';\r\n        this.styles.applyStyles(bettingControls, this.styles.getBettingControlsStyles());\r\n        \r\n        // Betting title\r\n        const bettingTitle = document.createElement('div');\r\n        bettingTitle.textContent = 'PLACE YOUR BET';\r\n        this.styles.applyStyles(bettingTitle, this.styles.getBettingTitleStyles());\r\n        bettingControls.appendChild(bettingTitle);\r\n        \r\n        // Resource options\r\n        const resourceOptions = this.createResourceOptions();\r\n        bettingControls.appendChild(resourceOptions);\r\n        \r\n        // Bet amount controls\r\n        const betAmountControls = this.createBetAmountControls();\r\n        bettingControls.appendChild(betAmountControls);\r\n        \r\n        return bettingControls;\r\n    }\r\n\r\n    /**\r\n     * Create resource selection buttons\r\n     */\r\n    createResourceOptions() {\r\n        const resourceOptions = document.createElement('div');\r\n        this.styles.applyStyles(resourceOptions, this.styles.getResourceOptionsStyles());\r\n        \r\n        const resources = [\r\n            { name: 'iron', color: 'rgba(150, 150, 150, 1)' },\r\n            { name: 'gold', color: 'rgba(255, 215, 0, 1)' },\r\n            { name: 'platinum', color: 'rgba(229, 228, 226, 1)' }\r\n        ];\r\n        \r\n        resources.forEach(resource => {\r\n            const btn = this.createResourceButton(resource.name, resource.color);\r\n            resourceOptions.appendChild(btn);\r\n        });\r\n        \r\n        return resourceOptions;\r\n    }\r\n\r\n    /**\r\n     * Create a resource button\r\n     */\r\n    createResourceButton(resource, color) {\r\n        const btn = document.createElement('button');\r\n        btn.className = 'resource-btn';\r\n        btn.dataset.resource = resource;\r\n        this.styles.applyStyles(btn, this.styles.getResourceButtonStyles(color));\r\n        \r\n        // Resource name\r\n        const resourceName = document.createElement('span');\r\n        resourceName.textContent = resource.toUpperCase();\r\n        resourceName.style.fontWeight = 'bold';\r\n        resourceName.style.fontSize = '12px';\r\n        btn.appendChild(resourceName);\r\n        \r\n        // Resource amount\r\n        const resourceAmount = document.createElement('span');\r\n        resourceAmount.className = `${resource}-amount`;\r\n        resourceAmount.textContent = '0 UNITS';\r\n        resourceAmount.style.fontSize = '10px';\r\n        resourceAmount.style.marginTop = '3px';\r\n        resourceAmount.style.opacity = '0.7';\r\n        btn.appendChild(resourceAmount);\r\n        \r\n        return btn;\r\n    }\r\n\r\n    /**\r\n     * Create bet amount controls\r\n     */\r\n    createBetAmountControls() {\r\n        const betAmountControls = document.createElement('div');\r\n        this.styles.applyStyles(betAmountControls, this.styles.getBetAmountControlsStyles());\r\n        \r\n        // Bet amount display\r\n        const betAmountDisplay = document.createElement('div');\r\n        betAmountDisplay.id = 'bet-amount';\r\n        betAmountDisplay.textContent = '0';\r\n        this.styles.applyStyles(betAmountDisplay, this.styles.getBetAmountDisplayStyles());\r\n        betAmountControls.appendChild(betAmountDisplay);\r\n        \r\n        // Decrease button\r\n        const decreaseBtn = document.createElement('button');\r\n        decreaseBtn.textContent = '-';\r\n        decreaseBtn.id = 'decrease-bet-btn';\r\n        this.styles.applyStyles(decreaseBtn, this.styles.getControlButtonStyles());\r\n        betAmountControls.appendChild(decreaseBtn);\r\n        \r\n        // Increase button\r\n        const increaseBtn = document.createElement('button');\r\n        increaseBtn.textContent = '+';\r\n        increaseBtn.id = 'increase-bet-btn';\r\n        this.styles.applyStyles(increaseBtn, this.styles.getControlButtonStyles());\r\n        betAmountControls.appendChild(increaseBtn);\r\n        \r\n        return betAmountControls;\r\n    }\r\n\r\n    /**\r\n     * Create game action buttons\r\n     */\r\n    createGameActions() {\r\n        const gameActions = document.createElement('div');\r\n        this.styles.applyStyles(gameActions, this.styles.getGameActionsStyles());\r\n        \r\n        const actionButtons = [\r\n            { id: 'deal-btn', text: 'DEAL', color: '#30cfd0' },\r\n            { id: 'hit-btn', text: 'HIT', color: '#ff9e3d' },\r\n            { id: 'stand-btn', text: 'STAND', color: '#e55c8a' },\r\n            { id: 'double-btn', text: 'DOUBLE', color: '#a281ff' }\r\n        ];\r\n        \r\n        actionButtons.forEach(btn => {\r\n            const button = this.createActionButton(btn.id, btn.text, btn.color);\r\n            gameActions.appendChild(button);\r\n        });\r\n        \r\n        return gameActions;\r\n    }\r\n\r\n    /**\r\n     * Create an action button\r\n     */\r\n    createActionButton(id, text, color) {\r\n        const button = document.createElement('button');\r\n        button.id = id;\r\n        button.textContent = text;\r\n        this.styles.applyStyles(button, this.styles.getActionButtonStyles(color));\r\n        button.disabled = true;\r\n        button.style.opacity = '0.5';\r\n        return button;\r\n    }\r\n\r\n    /**\r\n     * Create a visual card element\r\n     */\r\n    createCardElement(card, faceDown = false) {\r\n        const cardEl = document.createElement('div');\r\n        cardEl.className = 'card';\r\n        this.styles.applyStyles(cardEl, this.styles.getCardStyles(faceDown));\r\n        \r\n        if (!faceDown) {\r\n            this.createFaceUpCard(cardEl, card);\r\n        } else {\r\n            this.createFaceDownCard(cardEl);\r\n        }\r\n        \r\n        return cardEl;\r\n    }\r\n\r\n    /**\r\n     * Create face-up card content\r\n     */\r\n    createFaceUpCard(cardEl, card) {\r\n        const color = this.styles.getCardColor(card.suit);\r\n        \r\n        // Card value at top-left\r\n        const topValue = document.createElement('div');\r\n        topValue.textContent = card.value;\r\n        topValue.style.color = color;\r\n        this.styles.applyStyles(topValue, this.styles.getCardValueStyles('top'));\r\n        cardEl.appendChild(topValue);\r\n        \r\n        // Suit at top-right\r\n        const topSuit = document.createElement('div');\r\n        topSuit.textContent = this.cardSymbols[card.suit];\r\n        topSuit.style.color = color;\r\n        this.styles.applyStyles(topSuit, this.styles.getCardSuitStyles('top'));\r\n        cardEl.appendChild(topSuit);\r\n        \r\n        // Center symbol\r\n        const centerSymbol = document.createElement('div');\r\n        centerSymbol.textContent = this.cardSymbols[card.suit];\r\n        centerSymbol.style.color = color;\r\n        this.styles.applyStyles(centerSymbol, this.styles.getCenterSymbolStyles());\r\n        cardEl.appendChild(centerSymbol);\r\n        \r\n        // Value at bottom-right (rotated)\r\n        const bottomValue = document.createElement('div');\r\n        bottomValue.textContent = card.value;\r\n        bottomValue.style.color = color;\r\n        this.styles.applyStyles(bottomValue, this.styles.getCardValueStyles('bottom'));\r\n        cardEl.appendChild(bottomValue);\r\n        \r\n        // Suit at bottom-left (rotated)\r\n        const bottomSuit = document.createElement('div');\r\n        bottomSuit.textContent = this.cardSymbols[card.suit];\r\n        bottomSuit.style.color = color;\r\n        this.styles.applyStyles(bottomSuit, this.styles.getCardSuitStyles('bottom'));\r\n        cardEl.appendChild(bottomSuit);\r\n        \r\n        // Card background pattern\r\n        const pattern = document.createElement('div');\r\n        pattern.style.position = 'absolute';\r\n        pattern.style.inset = '0';\r\n        pattern.style.opacity = '0.05';\r\n        pattern.style.backgroundImage = 'radial-gradient(circle, #fff 1px, transparent 1px)';\r\n        pattern.style.backgroundSize = '10px 10px';\r\n        pattern.style.pointerEvents = 'none';\r\n        cardEl.appendChild(pattern);\r\n        \r\n        // Holographic effect\r\n        const holoEffect = document.createElement('div');\r\n        holoEffect.style.position = 'absolute';\r\n        holoEffect.style.inset = '0';\r\n        holoEffect.style.background = 'linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 50%, rgba(255,255,255,0.1) 100%)';\r\n        holoEffect.style.pointerEvents = 'none';\r\n        cardEl.appendChild(holoEffect);\r\n    }\r\n\r\n    /**\r\n     * Create face-down card content\r\n     */\r\n    createFaceDownCard(cardEl) {\r\n        // Back design for face-down card\r\n        const backDesign = document.createElement('div');\r\n        backDesign.style.width = '80%';\r\n        backDesign.style.height = '80%';\r\n        backDesign.style.border = '2px solid rgba(51, 170, 255, 0.4)';\r\n        backDesign.style.borderRadius = '5px';\r\n        backDesign.style.backgroundImage = 'radial-gradient(circle, rgba(51, 170, 255, 0.2) 10%, transparent 10%)';\r\n        backDesign.style.backgroundSize = '10px 10px';\r\n        cardEl.appendChild(backDesign);\r\n        \r\n        // Logo in center of back\r\n        const logo = document.createElement('div');\r\n        logo.style.position = 'absolute';\r\n        logo.style.fontWeight = 'bold';\r\n        logo.style.fontSize = this.isMobile ? '12px' : '14px';\r\n        logo.style.color = 'rgba(51, 170, 255, 0.7)';\r\n        logo.textContent = 'BJ';\r\n        cardEl.appendChild(logo);\r\n    }\r\n\r\n    /**\r\n     * Show the game UI\r\n     */\r\n    show(gameUI) {\r\n        if (gameUI) {\r\n            gameUI.style.display = 'block';\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Hide the game UI\r\n     */\r\n    hide(gameUI) {\r\n        if (gameUI) {\r\n            gameUI.style.display = 'none';\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Update resource display\r\n     */\r\n    updateResourceDisplay(spaceship) {\r\n        if (spaceship && spaceship.cargo) {\r\n            // Ensure cargo has all resources initialized\r\n            if (spaceship.cargo.iron === undefined) spaceship.cargo.iron = 0;\r\n            if (spaceship.cargo.gold === undefined) spaceship.cargo.gold = 0;\r\n            if (spaceship.cargo.platinum === undefined) spaceship.cargo.platinum = 0;\r\n            \r\n            // Update resource amounts\r\n            const ironElement = document.querySelector('.iron-amount');\r\n            if (ironElement) {\r\n                ironElement.textContent = `${spaceship.cargo.iron} UNITS`;\r\n            }\r\n            \r\n            const goldElement = document.querySelector('.gold-amount');\r\n            if (goldElement) {\r\n                goldElement.textContent = `${spaceship.cargo.gold} UNITS`;\r\n            }\r\n            \r\n            const platinumElement = document.querySelector('.platinum-amount');\r\n            if (platinumElement) {\r\n                platinumElement.textContent = `${spaceship.cargo.platinum} UNITS`;\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Update score display\r\n     */\r\n    updateScore(score, isPlayer = true) {\r\n        const scoreElement = document.getElementById(isPlayer ? 'player-score' : 'dealer-score');\r\n        if (scoreElement) {\r\n            scoreElement.textContent = score;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Update game status\r\n     */\r\n    updateGameStatus(message) {\r\n        const statusElement = document.getElementById('game-status');\r\n        if (statusElement) {\r\n            statusElement.textContent = message;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Update bet amount display\r\n     */\r\n    updateBetAmount(amount) {\r\n        const betElement = document.getElementById('bet-amount');\r\n        if (betElement) {\r\n            betElement.textContent = amount;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Clear cards from an area\r\n     */\r\n    clearCards(isPlayer = true) {\r\n        const cardsContainer = document.getElementById(isPlayer ? 'player-cards' : 'dealer-cards');\r\n        if (cardsContainer) {\r\n            cardsContainer.innerHTML = '';\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Add card to an area\r\n     */\r\n    addCard(card, faceDown = false, isPlayer = true) {\r\n        const cardsContainer = document.getElementById(isPlayer ? 'player-cards' : 'dealer-cards');\r\n        if (cardsContainer) {\r\n            const cardEl = this.createCardElement(card, faceDown);\r\n            if (faceDown) {\r\n                cardEl.id = 'face-down-card';\r\n            }\r\n            cardsContainer.appendChild(cardEl);\r\n            \r\n            // Add animation delay\r\n            setTimeout(() => {\r\n                cardEl.style.transform = 'translateY(-5px)';\r\n            }, 50);\r\n            \r\n            return cardEl;\r\n        }\r\n        return null;\r\n    }\r\n\r\n    /**\r\n     * Show dealer speech\r\n     */\r\n    showDealerSpeech(message, duration = 4000) {\r\n        const speechBubble = document.getElementById('dealer-speech');\r\n        if (speechBubble) {\r\n            speechBubble.textContent = message;\r\n            speechBubble.style.display = 'block';\r\n            \r\n            setTimeout(() => {\r\n                speechBubble.style.display = 'none';\r\n            }, duration);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Reveal dealer's face-down card\r\n     */\r\n    revealDealerCard(card) {\r\n        const faceDownEl = document.getElementById('face-down-card');\r\n        if (faceDownEl) {\r\n            faceDownEl.remove();\r\n            \r\n            // Create and add the face-up version\r\n            const cardEl = this.createCardElement(card);\r\n            const dealerCards = document.getElementById('dealer-cards');\r\n            if (dealerCards) {\r\n                dealerCards.appendChild(cardEl);\r\n                \r\n                // Add animation delay\r\n                setTimeout(() => {\r\n                    cardEl.style.transform = 'translateY(-5px)';\r\n                }, 50);\r\n                \r\n                return cardEl;\r\n            }\r\n        }\r\n        return null;\r\n    }\r\n}","/**\r\n * Blackjack Card Deck - Card deck management, shuffling, dealing logic\r\n */\r\n\r\nexport class BlackjackCardDeck {\r\n    constructor() {\r\n        this.deck = [];\r\n        this.createDeck();\r\n    }\r\n\r\n    /**\r\n     * Create a fresh deck of cards\r\n     */\r\n    createDeck() {\r\n        const suits = ['hearts', 'diamonds', 'clubs', 'spades'];\r\n        const values = ['A', '2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K'];\r\n        \r\n        this.deck = [];\r\n        \r\n        for (let suit of suits) {\r\n            for (let value of values) {\r\n                this.deck.push({\r\n                    suit: suit,\r\n                    value: value\r\n                });\r\n            }\r\n        }\r\n        \r\n        this.shuffle();\r\n    }\r\n\r\n    /**\r\n     * Shuffle the deck using Fisher-Yates algorithm\r\n     */\r\n    shuffle() {\r\n        for (let i = this.deck.length - 1; i > 0; i--) {\r\n            const j = Math.floor(Math.random() * (i + 1));\r\n            [this.deck[i], this.deck[j]] = [this.deck[j], this.deck[i]];\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Draw a card from the deck\r\n     * @returns {Object} A card object\r\n     */\r\n    drawCard() {\r\n        if (this.deck.length === 0) {\r\n            this.createDeck();\r\n        }\r\n        return this.deck.pop();\r\n    }\r\n\r\n    /**\r\n     * Get the value of a card\r\n     * @param {Object} card - The card object\r\n     * @returns {number} The value of the card in Blackjack\r\n     */\r\n    getCardValue(card) {\r\n        if (card.value === 'A') {\r\n            return 11;\r\n        } else if (['J', 'Q', 'K'].includes(card.value)) {\r\n            return 10;\r\n        } else {\r\n            return parseInt(card.value);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Check if deck is empty\r\n     * @returns {boolean} True if deck is empty\r\n     */\r\n    isEmpty() {\r\n        return this.deck.length === 0;\r\n    }\r\n\r\n    /**\r\n     * Get remaining cards count\r\n     * @returns {number} Number of cards left in deck\r\n     */\r\n    getRemainingCards() {\r\n        return this.deck.length;\r\n    }\r\n\r\n    /**\r\n     * Reset deck (create new and shuffle)\r\n     */\r\n    reset() {\r\n        this.createDeck();\r\n    }\r\n}","/**\r\n * Blackjack Game Logic - Blackjack rules, hand evaluation, win conditions\r\n */\r\n\r\nexport class BlackjackGameLogic {\r\n    constructor() {\r\n        // Game state\r\n        this.gameActive = false;\r\n        this.playerHand = [];\r\n        this.dealerHand = [];\r\n        this.gameResult = null;\r\n        \r\n        // Dealer personality phrases\r\n        this.dealerPhrases = {\r\n            win: [\r\n                \"Yarr! The cosmos favors ye today!\",\r\n                \"By the stars! Ye've bested me!\",\r\n                \"Void take me! Ye've got luck in yer tanks!\",\r\n                \"Stellar victory, spacer!\",\r\n                \"Blast me thrusters! Ye win this round!\"\r\n            ],\r\n            lose: [\r\n                \"The black hole claims another victim!\",\r\n                \"Better luck in the next galaxy, rookie!\",\r\n                \"Space is cold, and so is defeat!\",\r\n                \"Yarr! The dealer always wins, spacer!\",\r\n                \"Back to the asteroid mines with ye!\"\r\n            ],\r\n            blackjack: [\r\n                \"SUPERNOVA! A cosmic blackjack!\",\r\n                \"By the void! A perfect 21!\",\r\n                \"The stars aligned for ye today!\",\r\n                \"Quantum perfection! A blackjack!\"\r\n            ],\r\n            push: [\r\n                \"A cosmic stalemate, eh?\",\r\n                \"The universe remains in balance.\",\r\n                \"Neither winner nor loser in the void.\",\r\n                \"We split the cosmic dust this time.\"\r\n            ]\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Calculate the score of a hand, adjusting for aces\r\n     * @param {Array} hand - Array of card objects\r\n     * @returns {number} The total score of the hand\r\n     */\r\n    calculateScore(hand) {\r\n        let score = 0;\r\n        let aces = 0;\r\n        \r\n        for (let card of hand) {\r\n            if (card.value === 'A') {\r\n                aces++;\r\n                score += 11;\r\n            } else if (['J', 'Q', 'K'].includes(card.value)) {\r\n                score += 10;\r\n            } else {\r\n                score += parseInt(card.value);\r\n            }\r\n        }\r\n        \r\n        // Adjust for aces if over 21\r\n        while (score > 21 && aces > 0) {\r\n            score -= 10;\r\n            aces--;\r\n        }\r\n        \r\n        return score;\r\n    }\r\n\r\n    /**\r\n     * Calculate the dealer's visible score (excluding face-down card)\r\n     * @returns {number} The visible score\r\n     */\r\n    calculateVisibleDealerScore() {\r\n        if (this.dealerHand.length <= 1) {\r\n            return this.dealerHand.length ? this.getCardValue(this.dealerHand[0]) : 0;\r\n        }\r\n        \r\n        // Calculate score excluding the last card (which is face down)\r\n        return this.calculateScore(this.dealerHand.slice(0, -1));\r\n    }\r\n\r\n    /**\r\n     * Get the value of a card\r\n     * @param {Object} card - The card object\r\n     * @returns {number} The value of the card in Blackjack\r\n     */\r\n    getCardValue(card) {\r\n        if (card.value === 'A') {\r\n            return 11;\r\n        } else if (['J', 'Q', 'K'].includes(card.value)) {\r\n            return 10;\r\n        } else {\r\n            return parseInt(card.value);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Check if a hand is a blackjack (21 with 2 cards)\r\n     * @param {Array} hand - Array of card objects\r\n     * @returns {boolean} True if hand is blackjack\r\n     */\r\n    isBlackjack(hand) {\r\n        return hand.length === 2 && this.calculateScore(hand) === 21;\r\n    }\r\n\r\n    /**\r\n     * Check if a hand is bust (over 21)\r\n     * @param {Array} hand - Array of card objects\r\n     * @returns {boolean} True if hand is bust\r\n     */\r\n    isBust(hand) {\r\n        return this.calculateScore(hand) > 21;\r\n    }\r\n\r\n    /**\r\n     * Check for natural blackjack\r\n     * @returns {string|null} Game result or null if game continues\r\n     */\r\n    checkForNaturalBlackjack() {\r\n        const playerScore = this.calculateScore(this.playerHand);\r\n        const dealerScore = this.calculateScore(this.dealerHand);\r\n        \r\n        if (playerScore === 21 || dealerScore === 21) {\r\n            if (playerScore === 21 && dealerScore === 21) {\r\n                // Both have blackjack - push\r\n                return 'push';\r\n            } else if (playerScore === 21) {\r\n                // Player has blackjack - win with 3:2 payout\r\n                return 'blackjack';\r\n            } else {\r\n                // Dealer has blackjack - player loses\r\n                return 'lose';\r\n            }\r\n        }\r\n        \r\n        return null;\r\n    }\r\n\r\n    /**\r\n     * Determine if dealer should hit (dealer hits on soft 17)\r\n     * @returns {boolean} True if dealer should hit\r\n     */\r\n    shouldDealerHit() {\r\n        const dealerScore = this.calculateScore(this.dealerHand);\r\n        return dealerScore < 17;\r\n    }\r\n\r\n    /**\r\n     * Determine the outcome of the game\r\n     * @returns {string} Game result\r\n     */\r\n    determineOutcome() {\r\n        const playerScore = this.calculateScore(this.playerHand);\r\n        const dealerScore = this.calculateScore(this.dealerHand);\r\n        \r\n        if (dealerScore > 21) {\r\n            // Dealer busts - player wins\r\n            return 'win';\r\n        } else if (playerScore > dealerScore) {\r\n            // Player score higher - player wins\r\n            return 'win';\r\n        } else if (dealerScore > playerScore) {\r\n            // Dealer score higher - player loses\r\n            return 'lose';\r\n        } else {\r\n            // Scores are equal - push\r\n            return 'push';\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Check if player can double down\r\n     * @param {number} currentBetAmount - Current bet amount\r\n     * @param {number} maxBetAmount - Maximum possible bet amount\r\n     * @returns {boolean} True if can double down\r\n     */\r\n    canDoubleDown(currentBetAmount, maxBetAmount) {\r\n        return this.playerHand.length === 2 && currentBetAmount * 2 <= maxBetAmount;\r\n    }\r\n\r\n    /**\r\n     * Get a random dealer phrase\r\n     * @param {string} type - Type of phrase (win, lose, blackjack, push)\r\n     * @returns {string} Random phrase\r\n     */\r\n    getDealerPhrase(type) {\r\n        const phrases = this.dealerPhrases[type];\r\n        if (phrases && phrases.length > 0) {\r\n            return phrases[Math.floor(Math.random() * phrases.length)];\r\n        }\r\n        return '';\r\n    }\r\n\r\n    /**\r\n     * Reset game state\r\n     */\r\n    reset() {\r\n        this.gameActive = false;\r\n        this.playerHand = [];\r\n        this.dealerHand = [];\r\n        this.gameResult = null;\r\n    }\r\n\r\n    /**\r\n     * Start a new game\r\n     */\r\n    startGame() {\r\n        this.gameActive = true;\r\n        this.playerHand = [];\r\n        this.dealerHand = [];\r\n        this.gameResult = null;\r\n    }\r\n\r\n    /**\r\n     * Add card to player hand\r\n     * @param {Object} card - Card object\r\n     */\r\n    addCardToPlayer(card) {\r\n        this.playerHand.push(card);\r\n    }\r\n\r\n    /**\r\n     * Add card to dealer hand\r\n     * @param {Object} card - Card object\r\n     */\r\n    addCardToDealer(card) {\r\n        this.dealerHand.push(card);\r\n    }\r\n\r\n    /**\r\n     * End the game\r\n     * @param {string} result - Game result\r\n     */\r\n    endGame(result) {\r\n        this.gameActive = false;\r\n        this.gameResult = result;\r\n    }\r\n\r\n    /**\r\n     * Get player score\r\n     * @returns {number} Player's current score\r\n     */\r\n    getPlayerScore() {\r\n        return this.calculateScore(this.playerHand);\r\n    }\r\n\r\n    /**\r\n     * Get dealer score\r\n     * @returns {number} Dealer's current score\r\n     */\r\n    getDealerScore() {\r\n        return this.calculateScore(this.dealerHand);\r\n    }\r\n\r\n    /**\r\n     * Get player hand\r\n     * @returns {Array} Player's hand\r\n     */\r\n    getPlayerHand() {\r\n        return [...this.playerHand];\r\n    }\r\n\r\n    /**\r\n     * Get dealer hand\r\n     * @returns {Array} Dealer's hand\r\n     */\r\n    getDealerHand() {\r\n        return [...this.dealerHand];\r\n    }\r\n\r\n    /**\r\n     * Get last card in dealer hand (usually the face-down card)\r\n     * @returns {Object|null} Last dealer card\r\n     */\r\n    getLastDealerCard() {\r\n        return this.dealerHand.length > 0 ? this.dealerHand[this.dealerHand.length - 1] : null;\r\n    }\r\n\r\n    /**\r\n     * Check if game is active\r\n     * @returns {boolean} True if game is active\r\n     */\r\n    isGameActive() {\r\n        return this.gameActive;\r\n    }\r\n\r\n    /**\r\n     * Get game result\r\n     * @returns {string|null} Game result\r\n     */\r\n    getGameResult() {\r\n        return this.gameResult;\r\n    }\r\n}","/**\r\n * Blackjack Animations - Card animations, chip movements, visual effects\r\n */\r\n\r\nexport class BlackjackAnimations {\r\n    constructor(audio = null) {\r\n        this.audio = audio;\r\n    }\r\n\r\n    /**\r\n     * Animate card being dealt\r\n     * @param {HTMLElement} cardElement - The card element to animate\r\n     * @param {number} delay - Animation delay in ms\r\n     */\r\n    animateCardDeal(cardElement, delay = 50) {\r\n        if (!cardElement) return;\r\n        \r\n        // Initial state\r\n        cardElement.style.transform = 'translateY(0px) scale(0.8)';\r\n        cardElement.style.opacity = '0';\r\n        \r\n        // Animate to final position\r\n        setTimeout(() => {\r\n            cardElement.style.transition = 'transform 0.3s ease, opacity 0.3s ease';\r\n            cardElement.style.transform = 'translateY(-5px) scale(1)';\r\n            cardElement.style.opacity = '1';\r\n        }, delay);\r\n    }\r\n\r\n    /**\r\n     * Animate card flip (for revealing dealer's face-down card)\r\n     * @param {HTMLElement} cardElement - The card element to animate\r\n     * @param {Function} callback - Callback to execute at flip midpoint\r\n     */\r\n    animateCardFlip(cardElement, callback = null) {\r\n        if (!cardElement) return;\r\n        \r\n        // First half of flip\r\n        cardElement.style.transition = 'transform 0.2s ease';\r\n        cardElement.style.transform = 'rotateY(90deg) translateY(-5px)';\r\n        \r\n        // At midpoint, execute callback and complete flip\r\n        setTimeout(() => {\r\n            if (callback) callback();\r\n            cardElement.style.transform = 'rotateY(0deg) translateY(-5px)';\r\n        }, 200);\r\n    }\r\n\r\n    /**\r\n     * Animate button press\r\n     * @param {HTMLElement} buttonElement - The button element to animate\r\n     */\r\n    animateButtonPress(buttonElement) {\r\n        if (!buttonElement) return;\r\n        \r\n        // Scale down slightly\r\n        buttonElement.style.transition = 'transform 0.1s ease';\r\n        buttonElement.style.transform = 'scale(0.95)';\r\n        \r\n        // Return to normal size\r\n        setTimeout(() => {\r\n            buttonElement.style.transform = 'scale(1)';\r\n        }, 100);\r\n    }\r\n\r\n    /**\r\n     * Animate resource button selection\r\n     * @param {HTMLElement} buttonElement - The button element to animate\r\n     */\r\n    animateResourceSelection(buttonElement) {\r\n        if (!buttonElement) return;\r\n        \r\n        // Pulse effect\r\n        buttonElement.style.transition = 'transform 0.2s ease, border-width 0.2s ease';\r\n        buttonElement.style.transform = 'scale(1.05)';\r\n        buttonElement.style.borderWidth = '2px';\r\n    }\r\n\r\n    /**\r\n     * Remove resource button selection animation\r\n     * @param {HTMLElement} buttonElement - The button element to reset\r\n     */\r\n    removeResourceSelection(buttonElement) {\r\n        if (!buttonElement) return;\r\n        \r\n        buttonElement.style.transform = 'scale(1)';\r\n        buttonElement.style.borderWidth = '1px';\r\n    }\r\n\r\n    /**\r\n     * Animate bet amount change\r\n     * @param {HTMLElement} betElement - The bet display element\r\n     * @param {string} newAmount - The new amount to display\r\n     */\r\n    animateBetChange(betElement, newAmount) {\r\n        if (!betElement) return;\r\n        \r\n        // Scale up briefly\r\n        betElement.style.transition = 'transform 0.15s ease';\r\n        betElement.style.transform = 'scale(1.1)';\r\n        \r\n        // Update text and scale back\r\n        setTimeout(() => {\r\n            betElement.textContent = newAmount;\r\n            betElement.style.transform = 'scale(1)';\r\n        }, 75);\r\n    }\r\n\r\n    /**\r\n     * Animate score update\r\n     * @param {HTMLElement} scoreElement - The score display element\r\n     * @param {string} newScore - The new score to display\r\n     * @param {boolean} isBust - Whether this score is a bust\r\n     */\r\n    animateScoreUpdate(scoreElement, newScore, isBust = false) {\r\n        if (!scoreElement) return;\r\n        \r\n        // Color flash effect\r\n        const originalColor = scoreElement.style.color;\r\n        const flashColor = isBust ? '#ff6b6b' : '#30cfd0';\r\n        \r\n        scoreElement.style.transition = 'color 0.2s ease, transform 0.2s ease';\r\n        scoreElement.style.color = flashColor;\r\n        scoreElement.style.transform = 'scale(1.1)';\r\n        scoreElement.textContent = newScore;\r\n        \r\n        // Return to normal\r\n        setTimeout(() => {\r\n            scoreElement.style.color = originalColor;\r\n            scoreElement.style.transform = 'scale(1)';\r\n        }, 200);\r\n    }\r\n\r\n    /**\r\n     * Animate game status message\r\n     * @param {HTMLElement} statusElement - The status display element\r\n     * @param {string} message - The new status message\r\n     * @param {string} type - Type of message (win, lose, push, etc.)\r\n     */\r\n    animateStatusUpdate(statusElement, message, type = 'normal') {\r\n        if (!statusElement) return;\r\n        \r\n        // Determine colors based on type\r\n        let bgColor = 'rgba(51, 170, 255, 0.2)';\r\n        let borderColor = 'rgba(51, 170, 255, 0.4)';\r\n        \r\n        switch (type) {\r\n            case 'win':\r\n            case 'blackjack':\r\n                bgColor = 'rgba(48, 207, 208, 0.3)';\r\n                borderColor = 'rgba(48, 207, 208, 0.6)';\r\n                break;\r\n            case 'lose':\r\n            case 'bust':\r\n                bgColor = 'rgba(255, 107, 107, 0.3)';\r\n                borderColor = 'rgba(255, 107, 107, 0.6)';\r\n                break;\r\n            case 'push':\r\n                bgColor = 'rgba(255, 193, 7, 0.3)';\r\n                borderColor = 'rgba(255, 193, 7, 0.6)';\r\n                break;\r\n        }\r\n        \r\n        // Animate background change\r\n        statusElement.style.transition = 'background-color 0.3s ease, border-color 0.3s ease, transform 0.3s ease';\r\n        statusElement.style.backgroundColor = bgColor;\r\n        statusElement.style.borderColor = borderColor;\r\n        statusElement.style.transform = 'scale(1.05)';\r\n        statusElement.textContent = message;\r\n        \r\n        // Return to normal size\r\n        setTimeout(() => {\r\n            statusElement.style.transform = 'scale(1)';\r\n        }, 300);\r\n    }\r\n\r\n    /**\r\n     * Animate speech bubble appearance\r\n     * @param {HTMLElement} speechElement - The speech bubble element\r\n     * @param {string} message - The message to display\r\n     */\r\n    animateSpeechBubble(speechElement, message) {\r\n        if (!speechElement) return;\r\n        \r\n        speechElement.textContent = message;\r\n        speechElement.style.opacity = '0';\r\n        speechElement.style.transform = 'translateY(10px) scale(0.9)';\r\n        speechElement.style.display = 'block';\r\n        \r\n        // Animate in\r\n        setTimeout(() => {\r\n            speechElement.style.transition = 'opacity 0.3s ease, transform 0.3s ease';\r\n            speechElement.style.opacity = '1';\r\n            speechElement.style.transform = 'translateY(0px) scale(1)';\r\n        }, 50);\r\n    }\r\n\r\n    /**\r\n     * Animate speech bubble disappearance\r\n     * @param {HTMLElement} speechElement - The speech bubble element\r\n     */\r\n    hideSpeechBubble(speechElement) {\r\n        if (!speechElement) return;\r\n        \r\n        speechElement.style.transition = 'opacity 0.3s ease, transform 0.3s ease';\r\n        speechElement.style.opacity = '0';\r\n        speechElement.style.transform = 'translateY(-10px) scale(0.9)';\r\n        \r\n        setTimeout(() => {\r\n            speechElement.style.display = 'none';\r\n        }, 300);\r\n    }\r\n\r\n    /**\r\n     * Animate win celebration\r\n     * @param {HTMLElement} gameUI - The main game UI element\r\n     */\r\n    animateWinCelebration(gameUI) {\r\n        if (!gameUI) return;\r\n        \r\n        // Add a glow effect\r\n        gameUI.style.transition = 'box-shadow 0.5s ease';\r\n        gameUI.style.boxShadow = '0 0 50px rgba(48, 207, 208, 0.8)';\r\n        \r\n        // Remove glow after celebration\r\n        setTimeout(() => {\r\n            gameUI.style.boxShadow = '0 0 30px rgba(51, 170, 255, 0.5)';\r\n        }, 2000);\r\n    }\r\n\r\n    /**\r\n     * Animate lose effect\r\n     * @param {HTMLElement} gameUI - The main game UI element\r\n     */\r\n    animateLoseEffect(gameUI) {\r\n        if (!gameUI) return;\r\n        \r\n        // Add a red glow effect\r\n        gameUI.style.transition = 'box-shadow 0.5s ease';\r\n        gameUI.style.boxShadow = '0 0 50px rgba(255, 107, 107, 0.6)';\r\n        \r\n        // Remove glow after effect\r\n        setTimeout(() => {\r\n            gameUI.style.boxShadow = '0 0 30px rgba(51, 170, 255, 0.5)';\r\n        }, 2000);\r\n    }\r\n\r\n    /**\r\n     * Animate blackjack celebration\r\n     * @param {HTMLElement} gameUI - The main game UI element\r\n     */\r\n    animateBlackjackCelebration(gameUI) {\r\n        if (!gameUI) return;\r\n        \r\n        // Intense glow and slight scale\r\n        gameUI.style.transition = 'box-shadow 0.5s ease, transform 0.5s ease';\r\n        gameUI.style.boxShadow = '0 0 80px rgba(48, 207, 208, 1)';\r\n        gameUI.style.transform = 'translate(-50%, -50%) scale(1.02)';\r\n        \r\n        // Return to normal\r\n        setTimeout(() => {\r\n            gameUI.style.boxShadow = '0 0 30px rgba(51, 170, 255, 0.5)';\r\n            gameUI.style.transform = 'translate(-50%, -50%) scale(1)';\r\n        }, 3000);\r\n    }\r\n\r\n    /**\r\n     * Animate card hover effect\r\n     * @param {HTMLElement} cardElement - The card element\r\n     * @param {boolean} isHovering - Whether mouse is hovering\r\n     */\r\n    animateCardHover(cardElement, isHovering) {\r\n        if (!cardElement) return;\r\n        \r\n        if (isHovering) {\r\n            cardElement.style.transition = 'transform 0.2s ease, box-shadow 0.2s ease';\r\n            cardElement.style.transform = 'translateY(-10px) scale(1.05)';\r\n            cardElement.style.boxShadow = '0 0 20px rgba(51, 170, 255, 0.8)';\r\n        } else {\r\n            cardElement.style.transform = 'translateY(-5px) scale(1)';\r\n            cardElement.style.boxShadow = '0 0 10px rgba(51, 170, 255, 0.5)';\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Play card game sound with audio context\r\n     * @param {string} type - The type of sound to play\r\n     */\r\n    playCardSound(type) {\r\n        if (!this.audio) return;\r\n        \r\n        switch (type) {\r\n            case 'deal':\r\n                this.audio.playSound('boink');\r\n                break;\r\n            case 'hit':\r\n                this.audio.playSound('boink');\r\n                break;\r\n            case 'stand':\r\n                this.audio.playSound('boink');\r\n                break;\r\n            case 'double':\r\n                // Play two sounds in quick succession\r\n                this.audio.playSound('boink');\r\n                setTimeout(() => this.audio.playSound('boink'), 150);\r\n                break;\r\n            case 'flip':\r\n                this.audio.playSound('boink');\r\n                break;\r\n            case 'win':\r\n                this.audio.playSound('phaserUp');\r\n                break;\r\n            case 'blackjack':\r\n                // Play multiple sounds for celebration\r\n                this.audio.playSound('phaserUp');\r\n                setTimeout(() => this.audio.playSound('phaserUp'), 300);\r\n                break;\r\n            case 'lose':\r\n                this.audio.playSound('phaserDown');\r\n                break;\r\n            case 'bust':\r\n                this.audio.playSound('phaserDown');\r\n                break;\r\n            case 'push':\r\n                this.audio.playSound('boink');\r\n                break;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Chain multiple animations with delays\r\n     * @param {Array} animations - Array of animation functions\r\n     * @param {number} delay - Delay between animations\r\n     */\r\n    chainAnimations(animations, delay = 300) {\r\n        animations.forEach((animation, index) => {\r\n            setTimeout(() => {\r\n                if (typeof animation === 'function') {\r\n                    animation();\r\n                }\r\n            }, index * delay);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Reset all animations on an element\r\n     * @param {HTMLElement} element - The element to reset\r\n     */\r\n    resetAnimations(element) {\r\n        if (!element) return;\r\n        \r\n        element.style.transition = '';\r\n        element.style.transform = '';\r\n        element.style.opacity = '';\r\n        element.style.boxShadow = '';\r\n    }\r\n}","/**\r\n * Blackjack Betting - Bet management, chip handling, payout calculations\r\n */\r\n\r\nexport class BlackjackBetting {\r\n    constructor(spaceship = null) {\r\n        this.spaceship = spaceship;\r\n        this.currentBet = {\r\n            resource: null,\r\n            amount: 0\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Set the spaceship reference for resource management\r\n     * @param {Object} spaceship - Spaceship object with cargo\r\n     */\r\n    setSpaceship(spaceship) {\r\n        this.spaceship = spaceship;\r\n    }\r\n\r\n    /**\r\n     * Select a resource for betting\r\n     * @param {string} resource - The resource type (iron, gold, platinum)\r\n     */\r\n    selectBetResource(resource) {\r\n        this.currentBet.resource = resource;\r\n        this.currentBet.amount = 1;\r\n    }\r\n\r\n    /**\r\n     * Increase the bet amount\r\n     * @returns {boolean} True if bet was increased, false if at maximum\r\n     */\r\n    increaseBet() {\r\n        const maxAmount = this.getMaxBet();\r\n        if (this.currentBet.amount < maxAmount) {\r\n            this.currentBet.amount++;\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    /**\r\n     * Decrease the bet amount\r\n     * @returns {boolean} True if bet was decreased, false if at minimum\r\n     */\r\n    decreaseBet() {\r\n        if (this.currentBet.amount > 1) {\r\n            this.currentBet.amount--;\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    /**\r\n     * Get the maximum possible bet amount for the selected resource\r\n     * @returns {number} The maximum bet amount\r\n     */\r\n    getMaxBet() {\r\n        if (!this.currentBet.resource || !this.spaceship || !this.spaceship.cargo) {\r\n            return 0;\r\n        }\r\n        \r\n        return this.spaceship.cargo[this.currentBet.resource] || 0;\r\n    }\r\n\r\n    /**\r\n     * Get current bet information\r\n     * @returns {Object} Current bet object\r\n     */\r\n    getCurrentBet() {\r\n        return { ...this.currentBet };\r\n    }\r\n\r\n    /**\r\n     * Check if a valid bet is selected\r\n     * @returns {boolean} True if valid bet exists\r\n     */\r\n    hasValidBet() {\r\n        return this.currentBet.resource && this.currentBet.amount > 0;\r\n    }\r\n\r\n    /**\r\n     * Check if player has enough resources for the current bet\r\n     * @returns {boolean} True if player can afford the bet\r\n     */\r\n    canAffordBet() {\r\n        if (!this.hasValidBet() || !this.spaceship || !this.spaceship.cargo) {\r\n            return false;\r\n        }\r\n        \r\n        const available = this.spaceship.cargo[this.currentBet.resource] || 0;\r\n        return available >= this.currentBet.amount;\r\n    }\r\n\r\n    /**\r\n     * Check if player can afford to double down\r\n     * @returns {boolean} True if player can double the current bet\r\n     */\r\n    canAffordDoubleDown() {\r\n        if (!this.hasValidBet() || !this.spaceship || !this.spaceship.cargo) {\r\n            return false;\r\n        }\r\n        \r\n        const available = this.spaceship.cargo[this.currentBet.resource] || 0;\r\n        return available >= this.currentBet.amount;\r\n    }\r\n\r\n    /**\r\n     * Place the bet (deduct resources)\r\n     * @returns {boolean} True if bet was successfully placed\r\n     */\r\n    placeBet() {\r\n        if (!this.canAffordBet()) {\r\n            return false;\r\n        }\r\n        \r\n        // Deduct bet from player's resources\r\n        this.spaceship.cargo[this.currentBet.resource] -= this.currentBet.amount;\r\n        \r\n        // Sync with the game's resource system if available\r\n        if (window.game && window.game.controls && window.game.controls.resources) {\r\n            window.game.controls.resources[this.currentBet.resource] = this.spaceship.cargo[this.currentBet.resource];\r\n        }\r\n        \r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Double down (double the current bet)\r\n     * @returns {boolean} True if double down was successful\r\n     */\r\n    doubleDown() {\r\n        if (!this.canAffordDoubleDown()) {\r\n            return false;\r\n        }\r\n        \r\n        // Deduct additional bet amount\r\n        this.spaceship.cargo[this.currentBet.resource] -= this.currentBet.amount;\r\n        \r\n        // Double the bet amount\r\n        this.currentBet.amount *= 2;\r\n        \r\n        // Sync with the game's resource system if available\r\n        if (window.game && window.game.controls && window.game.controls.resources) {\r\n            window.game.controls.resources[this.currentBet.resource] = this.spaceship.cargo[this.currentBet.resource];\r\n        }\r\n        \r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Calculate payout for a win (2x bet)\r\n     * @returns {number} Payout amount\r\n     */\r\n    calculateWinPayout() {\r\n        return this.currentBet.amount * 2;\r\n    }\r\n\r\n    /**\r\n     * Calculate payout for a blackjack (3x bet)\r\n     * @returns {number} Payout amount\r\n     */\r\n    calculateBlackjackPayout() {\r\n        return this.currentBet.amount * 3;\r\n    }\r\n\r\n    /**\r\n     * Calculate payout for a push (return bet)\r\n     * @returns {number} Payout amount\r\n     */\r\n    calculatePushPayout() {\r\n        return this.currentBet.amount;\r\n    }\r\n\r\n    /**\r\n     * Pay out winnings to player\r\n     * @param {number} amount - Amount to pay out\r\n     */\r\n    payOut(amount) {\r\n        if (!this.spaceship || !this.spaceship.cargo || !this.currentBet.resource) {\r\n            return;\r\n        }\r\n        \r\n        this.spaceship.cargo[this.currentBet.resource] += amount;\r\n        \r\n        // Sync with the game's resource system if available\r\n        if (window.game && window.game.controls && window.game.controls.resources) {\r\n            window.game.controls.resources[this.currentBet.resource] = this.spaceship.cargo[this.currentBet.resource];\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Handle win payout\r\n     */\r\n    handleWin() {\r\n        const payout = this.calculateWinPayout();\r\n        this.payOut(payout);\r\n        return payout;\r\n    }\r\n\r\n    /**\r\n     * Handle blackjack payout\r\n     */\r\n    handleBlackjack() {\r\n        const payout = this.calculateBlackjackPayout();\r\n        this.payOut(payout);\r\n        return payout;\r\n    }\r\n\r\n    /**\r\n     * Handle push (return bet)\r\n     */\r\n    handlePush() {\r\n        const payout = this.calculatePushPayout();\r\n        this.payOut(payout);\r\n        return payout;\r\n    }\r\n\r\n    /**\r\n     * Reset betting state\r\n     */\r\n    reset() {\r\n        this.currentBet = {\r\n            resource: null,\r\n            amount: 0\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Get resource amounts for display\r\n     * @returns {Object} Resource amounts\r\n     */\r\n    getResourceAmounts() {\r\n        if (!this.spaceship || !this.spaceship.cargo) {\r\n            return { iron: 0, gold: 0, platinum: 0 };\r\n        }\r\n        \r\n        return {\r\n            iron: this.spaceship.cargo.iron || 0,\r\n            gold: this.spaceship.cargo.gold || 0,\r\n            platinum: this.spaceship.cargo.platinum || 0\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Initialize cargo if needed\r\n     */\r\n    initializeCargo() {\r\n        if (!this.spaceship) {\r\n            console.error(\"No spaceship object available\");\r\n            return false;\r\n        }\r\n        \r\n        if (!this.spaceship.cargo) {\r\n            console.warn(\"Creating cargo object for spaceship\");\r\n            this.spaceship.cargo = { iron: 0, gold: 0, platinum: 0 };\r\n        }\r\n        \r\n        // Ensure all resources are defined\r\n        if (this.spaceship.cargo.iron === undefined) this.spaceship.cargo.iron = 0;\r\n        if (this.spaceship.cargo.gold === undefined) this.spaceship.cargo.gold = 0;\r\n        if (this.spaceship.cargo.platinum === undefined) this.spaceship.cargo.platinum = 0;\r\n        \r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Sync with game resources\r\n     */\r\n    syncWithGameResources() {\r\n        if (window.game && window.game.controls && window.game.controls.resources) {\r\n            // Sync with the real game resources\r\n            const gameResources = window.game.controls.resources;\r\n            \r\n            if (!this.spaceship.cargo) {\r\n                this.spaceship.cargo = {};\r\n            }\r\n            \r\n            // Update cargo with current game resources\r\n            this.spaceship.cargo.iron = gameResources.iron || 0;\r\n            this.spaceship.cargo.gold = gameResources.gold || 0;\r\n            this.spaceship.cargo.platinum = gameResources.platinum || 0;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Get bet amount display string\r\n     * @returns {string} Formatted bet amount\r\n     */\r\n    getBetDisplayString() {\r\n        if (!this.hasValidBet()) {\r\n            return '0';\r\n        }\r\n        \r\n        return `${this.currentBet.amount} ${this.currentBet.resource.toUpperCase()}`;\r\n    }\r\n\r\n    /**\r\n     * Get resource color for UI\r\n     * @param {string} resource - Resource type\r\n     * @returns {string} CSS color string\r\n     */\r\n    getResourceColor(resource) {\r\n        switch (resource) {\r\n            case 'iron':\r\n                return 'rgba(150, 150, 150, 1)';\r\n            case 'gold':\r\n                return 'rgba(255, 215, 0, 1)';\r\n            case 'platinum':\r\n                return 'rgba(229, 228, 226, 1)';\r\n            default:\r\n                return 'rgba(255, 255, 255, 1)';\r\n        }\r\n    }\r\n}","/**\r\n * Blackjack Event Handlers - User interactions, button clicks, game events\r\n */\r\n\r\nexport class BlackjackEventHandlers {\r\n    constructor(game, isMobile = false) {\r\n        this.game = game;\r\n        this.isMobile = isMobile;\r\n        this.eventListeners = new Map();\r\n    }\r\n\r\n    /**\r\n     * Set up all event handlers for the game\r\n     */\r\n    setupEventHandlers() {\r\n        this.setupCloseButtonHandler();\r\n        this.setupResourceButtonHandlers();\r\n        this.setupBetControlHandlers();\r\n        this.setupActionButtonHandlers();\r\n        this.setupMobileEventHandlers();\r\n    }\r\n\r\n    /**\r\n     * Setup close button event handler\r\n     */\r\n    setupCloseButtonHandler() {\r\n        const closeBtn = document.querySelector('#blackjack-game button');\r\n        if (closeBtn) {\r\n            const handler = () => this.game.hide();\r\n            this.addEventHandler(closeBtn, 'click', handler);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Setup resource button event handlers\r\n     */\r\n    setupResourceButtonHandlers() {\r\n        const resourceButtons = document.querySelectorAll('.resource-btn');\r\n        \r\n        resourceButtons.forEach(btn => {\r\n            const resource = btn.dataset.resource;\r\n            \r\n            // Create hover effects\r\n            const addHoverEffect = () => {\r\n                if (this.game.gameLogic.isGameActive()) return;\r\n                \r\n                const color = this.game.betting.getResourceColor(resource);\r\n                btn.style.backgroundColor = 'rgba(25, 60, 80, 0.8)';\r\n                btn.style.boxShadow = `0 0 15px ${color}`;\r\n            };\r\n            \r\n            const removeHoverEffect = () => {\r\n                if (this.game.gameLogic.isGameActive()) return;\r\n                \r\n                const color = this.game.betting.getResourceColor(resource);\r\n                btn.style.backgroundColor = 'rgba(15, 40, 55, 0.8)';\r\n                btn.style.boxShadow = `0 0 10px rgba(${color.split('(')[1].split(')')[0]}, 0.3)`;\r\n            };\r\n            \r\n            // Click/tap handler\r\n            const clickHandler = () => {\r\n                if (!this.game.gameLogic.isGameActive()) {\r\n                    this.game.selectBetResource(resource);\r\n                    this.game.animations.playCardSound('boink');\r\n                    \r\n                    // Update button styling\r\n                    document.querySelectorAll('.resource-btn').forEach(button => {\r\n                        this.game.animations.removeResourceSelection(button);\r\n                    });\r\n                    \r\n                    this.game.animations.animateResourceSelection(btn);\r\n                }\r\n            };\r\n            \r\n            // Add event listeners\r\n            this.addEventHandler(btn, 'mouseover', addHoverEffect);\r\n            this.addEventHandler(btn, 'mouseout', removeHoverEffect);\r\n            this.addEventHandler(btn, 'click', clickHandler);\r\n            \r\n            // Touch events for mobile\r\n            if (this.isMobile) {\r\n                this.addEventHandler(btn, 'touchstart', addHoverEffect, {passive: true});\r\n                this.addEventHandler(btn, 'touchend', (e) => {\r\n                    removeHoverEffect();\r\n                    e.preventDefault();\r\n                    clickHandler();\r\n                });\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Setup bet control event handlers (+ and - buttons)\r\n     */\r\n    setupBetControlHandlers() {\r\n        const decreaseBtn = document.getElementById('decrease-bet-btn');\r\n        const increaseBtn = document.getElementById('increase-bet-btn');\r\n        \r\n        if (decreaseBtn) {\r\n            const handler = () => {\r\n                if (!this.game.gameLogic.isGameActive() && this.game.betting.getCurrentBet().resource) {\r\n                    if (this.game.betting.decreaseBet()) {\r\n                        this.game.view.updateBetAmount(this.game.betting.getCurrentBet().amount);\r\n                        this.game.animations.animateBetChange(\r\n                            document.getElementById('bet-amount'),\r\n                            this.game.betting.getCurrentBet().amount\r\n                        );\r\n                        this.game.animations.playCardSound('boink');\r\n                    }\r\n                }\r\n            };\r\n            \r\n            this.setupControlButton(decreaseBtn, handler);\r\n        }\r\n        \r\n        if (increaseBtn) {\r\n            const handler = () => {\r\n                if (!this.game.gameLogic.isGameActive() && this.game.betting.getCurrentBet().resource) {\r\n                    if (this.game.betting.increaseBet()) {\r\n                        this.game.view.updateBetAmount(this.game.betting.getCurrentBet().amount);\r\n                        this.game.animations.animateBetChange(\r\n                            document.getElementById('bet-amount'),\r\n                            this.game.betting.getCurrentBet().amount\r\n                        );\r\n                        this.game.animations.playCardSound('boink');\r\n                    }\r\n                }\r\n            };\r\n            \r\n            this.setupControlButton(increaseBtn, handler);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Setup action button event handlers (Deal, Hit, Stand, Double)\r\n     */\r\n    setupActionButtonHandlers() {\r\n        const actionButtons = [\r\n            { id: 'deal-btn', handler: () => this.game.startGame() },\r\n            { id: 'hit-btn', handler: () => this.game.hit() },\r\n            { id: 'stand-btn', handler: () => this.game.stand() },\r\n            { id: 'double-btn', handler: () => this.game.doubleDown() }\r\n        ];\r\n        \r\n        actionButtons.forEach(action => {\r\n            const button = document.getElementById(action.id);\r\n            if (button) {\r\n                const clickHandler = () => {\r\n                    if (!button.disabled) {\r\n                        this.game.animations.animateButtonPress(button);\r\n                        action.handler();\r\n                        this.game.animations.playCardSound('boink');\r\n                    }\r\n                };\r\n                \r\n                this.setupActionButton(button, clickHandler);\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Setup mobile-specific event handlers\r\n     */\r\n    setupMobileEventHandlers() {\r\n        if (!this.isMobile) return;\r\n        \r\n        // Prevent scrolling when touching the game area\r\n        const gameUI = document.getElementById('blackjack-game');\r\n        if (gameUI) {\r\n            this.addEventHandler(gameUI, 'touchmove', (e) => {\r\n                e.preventDefault();\r\n            }, {passive: false});\r\n        }\r\n        \r\n        // Handle orientation changes\r\n        this.addEventHandler(window, 'orientationchange', () => {\r\n            setTimeout(() => {\r\n                this.game.view.updateResourceDisplay(this.game.spaceship);\r\n            }, 100);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Setup control button with hover and touch effects\r\n     */\r\n    setupControlButton(button, clickHandler) {\r\n        const addHoverEffect = () => {\r\n            if (!button.disabled) {\r\n                const hoverStyles = this.game.view.styles.getControlButtonHoverStyles();\r\n                Object.assign(button.style, hoverStyles);\r\n            }\r\n        };\r\n        \r\n        const removeHoverEffect = () => {\r\n            if (!button.disabled) {\r\n                button.style.backgroundColor = 'rgba(15, 40, 55, 0.8)';\r\n                button.style.boxShadow = 'none';\r\n            }\r\n        };\r\n        \r\n        // Mouse events\r\n        this.addEventHandler(button, 'mouseover', addHoverEffect);\r\n        this.addEventHandler(button, 'mouseout', removeHoverEffect);\r\n        this.addEventHandler(button, 'click', clickHandler);\r\n        \r\n        // Touch events\r\n        if (this.isMobile) {\r\n            this.addEventHandler(button, 'touchstart', addHoverEffect, {passive: true});\r\n            this.addEventHandler(button, 'touchend', (e) => {\r\n                removeHoverEffect();\r\n                e.preventDefault();\r\n                clickHandler();\r\n            });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Setup action button with hover and touch effects\r\n     */\r\n    setupActionButton(button, clickHandler) {\r\n        const color = this.getButtonColor(button.id);\r\n        \r\n        const enableHoverEffects = () => {\r\n            if (!button.disabled) {\r\n                const hoverStyles = this.game.view.styles.getActionButtonHoverStyles(color);\r\n                Object.assign(button.style, hoverStyles);\r\n            }\r\n        };\r\n        \r\n        const disableHoverEffects = () => {\r\n            if (!button.disabled) {\r\n                button.style.backgroundColor = 'rgba(15, 40, 55, 0.8)';\r\n                button.style.boxShadow = `0 0 10px ${color}`;\r\n            }\r\n        };\r\n        \r\n        // Mouse events\r\n        this.addEventHandler(button, 'mouseover', enableHoverEffects);\r\n        this.addEventHandler(button, 'mouseout', disableHoverEffects);\r\n        this.addEventHandler(button, 'click', clickHandler);\r\n        \r\n        // Touch events\r\n        if (this.isMobile) {\r\n            this.addEventHandler(button, 'touchstart', enableHoverEffects, {passive: true});\r\n            this.addEventHandler(button, 'touchend', (e) => {\r\n                disableHoverEffects();\r\n                e.preventDefault();\r\n                clickHandler();\r\n            });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Get button color based on button ID\r\n     */\r\n    getButtonColor(buttonId) {\r\n        switch (buttonId) {\r\n            case 'deal-btn':\r\n                return '#30cfd0';\r\n            case 'hit-btn':\r\n                return '#ff9e3d';\r\n            case 'stand-btn':\r\n                return '#e55c8a';\r\n            case 'double-btn':\r\n                return '#a281ff';\r\n            default:\r\n                return '#33aaff';\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Add event listener and track it for cleanup\r\n     */\r\n    addEventHandler(element, event, handler, options = false) {\r\n        element.addEventListener(event, handler, options);\r\n        \r\n        // Store for cleanup\r\n        const key = `${element.id || element.className}_${event}`;\r\n        if (!this.eventListeners.has(key)) {\r\n            this.eventListeners.set(key, []);\r\n        }\r\n        this.eventListeners.get(key).push({ element, event, handler, options });\r\n    }\r\n\r\n    /**\r\n     * Remove all event listeners\r\n     */\r\n    removeAllEventListeners() {\r\n        this.eventListeners.forEach((listeners) => {\r\n            listeners.forEach(({ element, event, handler, options }) => {\r\n                element.removeEventListener(event, handler, options);\r\n            });\r\n        });\r\n        this.eventListeners.clear();\r\n    }\r\n\r\n    /**\r\n     * Update button states based on game state\r\n     */\r\n    updateButtonStates() {\r\n        const dealBtn = document.getElementById('deal-btn');\r\n        const hitBtn = document.getElementById('hit-btn');\r\n        const standBtn = document.getElementById('stand-btn');\r\n        const doubleBtn = document.getElementById('double-btn');\r\n        \r\n        // Reset all buttons to disabled state\r\n        [dealBtn, hitBtn, standBtn, doubleBtn].forEach(btn => {\r\n            if (btn) {\r\n                btn.disabled = true;\r\n                btn.style.opacity = '0.5';\r\n                btn.style.cursor = 'default';\r\n            }\r\n        });\r\n        \r\n        if (!this.game.gameLogic.isGameActive()) {\r\n            // Before game starts, only deal button may be active\r\n            const canDeal = this.game.betting.hasValidBet();\r\n            if (dealBtn) {\r\n                dealBtn.disabled = !canDeal;\r\n                dealBtn.style.opacity = canDeal ? '1' : '0.5';\r\n                dealBtn.style.cursor = canDeal ? 'pointer' : 'default';\r\n            }\r\n        } else {\r\n            // During game, hit/stand buttons are active\r\n            if (hitBtn) {\r\n                hitBtn.disabled = false;\r\n                hitBtn.style.opacity = '1';\r\n                hitBtn.style.cursor = 'pointer';\r\n            }\r\n            \r\n            if (standBtn) {\r\n                standBtn.disabled = false;\r\n                standBtn.style.opacity = '1';\r\n                standBtn.style.cursor = 'pointer';\r\n            }\r\n            \r\n            // Double down only available on first move with 2 cards\r\n            const playerHand = this.game.gameLogic.getPlayerHand();\r\n            const canDouble = playerHand.length === 2 && this.game.betting.canAffordDoubleDown();\r\n            if (doubleBtn) {\r\n                doubleBtn.disabled = !canDouble;\r\n                doubleBtn.style.opacity = canDouble ? '1' : '0.5';\r\n                doubleBtn.style.cursor = canDouble ? 'pointer' : 'default';\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Handle keyboard events\r\n     */\r\n    setupKeyboardHandlers() {\r\n        const keyHandler = (e) => {\r\n            if (this.game.gameUI.style.display === 'none') return;\r\n            \r\n            switch (e.key.toLowerCase()) {\r\n                case 'escape':\r\n                    this.game.hide();\r\n                    break;\r\n                case 'enter':\r\n                case ' ':\r\n                    if (!this.game.gameLogic.isGameActive() && this.game.betting.hasValidBet()) {\r\n                        this.game.startGame();\r\n                    }\r\n                    break;\r\n                case 'h':\r\n                    if (this.game.gameLogic.isGameActive()) {\r\n                        this.game.hit();\r\n                    }\r\n                    break;\r\n                case 's':\r\n                    if (this.game.gameLogic.isGameActive()) {\r\n                        this.game.stand();\r\n                    }\r\n                    break;\r\n                case 'd':\r\n                    if (this.game.gameLogic.isGameActive()) {\r\n                        this.game.doubleDown();\r\n                    }\r\n                    break;\r\n                case '1':\r\n                    this.selectResource('iron');\r\n                    break;\r\n                case '2':\r\n                    this.selectResource('gold');\r\n                    break;\r\n                case '3':\r\n                    this.selectResource('platinum');\r\n                    break;\r\n                case 'arrowup':\r\n                case '+':\r\n                    if (!this.game.gameLogic.isGameActive() && this.game.betting.getCurrentBet().resource) {\r\n                        if (this.game.betting.increaseBet()) {\r\n                            this.game.view.updateBetAmount(this.game.betting.getCurrentBet().amount);\r\n                        }\r\n                    }\r\n                    e.preventDefault();\r\n                    break;\r\n                case 'arrowdown':\r\n                case '-':\r\n                    if (!this.game.gameLogic.isGameActive() && this.game.betting.getCurrentBet().resource) {\r\n                        if (this.game.betting.decreaseBet()) {\r\n                            this.game.view.updateBetAmount(this.game.betting.getCurrentBet().amount);\r\n                        }\r\n                    }\r\n                    e.preventDefault();\r\n                    break;\r\n            }\r\n        };\r\n        \r\n        this.addEventHandler(document, 'keydown', keyHandler);\r\n    }\r\n\r\n    /**\r\n     * Select resource by name (helper for keyboard events)\r\n     */\r\n    selectResource(resource) {\r\n        if (!this.game.gameLogic.isGameActive()) {\r\n            const button = document.querySelector(`[data-resource=\"${resource}\"]`);\r\n            if (button) {\r\n                button.click();\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Handle window resize events\r\n     */\r\n    setupResizeHandler() {\r\n        const resizeHandler = () => {\r\n            // Update mobile detection in case window was resized\r\n            this.isMobile = window.innerWidth <= 768 || window.innerHeight <= 600;\r\n            \r\n            // Update styles if needed\r\n            if (this.game.view) {\r\n                this.game.view.isMobile = this.isMobile;\r\n            }\r\n        };\r\n        \r\n        this.addEventHandler(window, 'resize', resizeHandler);\r\n    }\r\n\r\n    /**\r\n     * Setup all handlers at once\r\n     */\r\n    initialize() {\r\n        this.setupEventHandlers();\r\n        this.setupKeyboardHandlers();\r\n        this.setupResizeHandler();\r\n    }\r\n\r\n    /**\r\n     * Cleanup method to remove all event listeners\r\n     */\r\n    destroy() {\r\n        this.removeAllEventListeners();\r\n    }\r\n}","/**\r\n * Blackjack Minigame - A futuristic card game for the stargate terminal\r\n * \r\n * Features:\r\n * - Space-themed card designs with futuristic symbols\r\n * - Wager ship resources (Iron, Gold, Platinum)\r\n * - Play against an AI dealer with pirate personality\r\n * - Holographic UI with neon effects\r\n */\r\n\r\nimport { MobileDetector } from '../../utils/mobileDetector.js';\r\nimport { BlackjackGameView } from './components/blackjack/gameView.js';\r\nimport { BlackjackCardDeck } from './components/blackjack/cardDeck.js';\r\nimport { BlackjackGameLogic } from './components/blackjack/gameLogic.js';\r\nimport { BlackjackAnimations } from './components/blackjack/animations.js';\r\nimport { BlackjackBetting } from './components/blackjack/betting.js';\r\nimport { BlackjackEventHandlers } from './components/blackjack/eventHandlers.js';\r\n\r\nexport class BlackjackGame {\r\n    constructor(scene, spaceship, audio) {\r\n        this.scene = scene;\r\n        this.spaceship = spaceship;\r\n        this.audio = audio;\r\n        this.isMobile = MobileDetector.isMobile();\r\n\r\n        console.log(\"BlackjackGame constructor - spaceship:\", this.spaceship);\r\n        console.log(\"BlackjackGame constructor - cargo:\", this.spaceship ? this.spaceship.cargo : null);\r\n        console.log(\"BlackjackGame constructor - isMobile:\", this.isMobile);\r\n        \r\n        // Initialize components\r\n        this.view = new BlackjackGameView(this.isMobile);\r\n        this.deck = new BlackjackCardDeck();\r\n        this.gameLogic = new BlackjackGameLogic();\r\n        this.animations = new BlackjackAnimations(this.audio);\r\n        this.betting = new BlackjackBetting(this.spaceship);\r\n        this.eventHandlers = new BlackjackEventHandlers(this, this.isMobile);\r\n        \r\n        // UI elements\r\n        this.gameUI = null;\r\n    }\r\n    \r\n    /**\r\n     * Initialize the game UI\r\n     */\r\n    init() {\r\n        if (!this.gameUI) {\r\n            this.createGameUI();\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Create the game UI elements\r\n     */\r\n    createGameUI() {\r\n        this.gameUI = this.view.createGameUI();\r\n        this.eventHandlers.initialize();\r\n        this.updateControls();\r\n    }\r\n    \r\n    /**\r\n     * Show the game UI and sync with current game resources\r\n     */\r\n    show() {\r\n        // Don't show during intro sequence\r\n        if (window.game && window.game.introSequenceActive) {\r\n            console.log(\"BlackjackGame: Not showing game UI during intro sequence\");\r\n            return;\r\n        }\r\n        \r\n        if (this.gameUI) {\r\n            this.view.show(this.gameUI);\r\n            this.reset();\r\n            \r\n            // Force audio context resumption for mobile\r\n            if (this.audio && this.isMobile) {\r\n                setTimeout(() => {\r\n                    console.log(\"Mobile: Attempting to play initial sound in BlackjackGame\");\r\n                    this.audio.playSound('boink');\r\n                }, 100);\r\n            }\r\n            \r\n            // Sync with game resources\r\n            this.betting.syncWithGameResources();\r\n            this.view.updateResourceDisplay(this.spaceship);\r\n            this.animations.playCardSound('boink');\r\n        } else {\r\n            this.init();\r\n            this.show();\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Hide the game UI and return to the stargate interface\r\n     */\r\n    hide() {\r\n        if (this.gameUI) {\r\n            this.view.hide(this.gameUI);\r\n            this.animations.playCardSound('boink');\r\n            \r\n            // Show the stargate interface when exiting blackjack\r\n            const stargateUI = document.getElementById('stargate-ui');\r\n            if (stargateUI) {\r\n                stargateUI.style.display = 'block';\r\n            }\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Reset the game state\r\n     */\r\n    reset() {\r\n        this.gameLogic.reset();\r\n        this.betting.reset();\r\n        \r\n        // Reset UI elements\r\n        this.view.clearCards(true);  // Player cards\r\n        this.view.clearCards(false); // Dealer cards\r\n        this.view.updateScore(0, true);  // Player score\r\n        this.view.updateScore(0, false); // Dealer score\r\n        this.view.updateGameStatus('PLACE YOUR BET TO BEGIN');\r\n        this.view.updateBetAmount('0');\r\n        \r\n        // Hide dealer speech\r\n        const speechBubble = document.getElementById('dealer-speech');\r\n        if (speechBubble) {\r\n            speechBubble.style.display = 'none';\r\n        }\r\n        \r\n        // Reset resource selection\r\n        document.querySelectorAll('.resource-btn').forEach(btn => {\r\n            this.animations.removeResourceSelection(btn);\r\n        });\r\n        \r\n        this.updateControls();\r\n    }\r\n    \r\n    /**\r\n     * Select a resource for betting\r\n     */\r\n    selectBetResource(resource) {\r\n        this.betting.selectBetResource(resource);\r\n        this.view.updateBetAmount(this.betting.getCurrentBet().amount);\r\n        this.updateControls();\r\n    }\r\n    \r\n    /**\r\n     * Update the game controls based on the current state\r\n     */\r\n    updateControls() {\r\n        this.eventHandlers.updateButtonStates();\r\n    }\r\n    \r\n    /**\r\n     * Start a new game\r\n     */\r\n    startGame() {\r\n        console.log(\"Starting game with bet:\", this.betting.getCurrentBet());\r\n        \r\n        if (!this.betting.hasValidBet()) {\r\n            console.log(\"No valid bet selected\");\r\n            return;\r\n        }\r\n        \r\n        // Initialize cargo if needed\r\n        if (!this.betting.initializeCargo()) {\r\n            this.view.updateGameStatus('ERROR: GAME DATA MISSING');\r\n            return;\r\n        }\r\n        \r\n        // Check if player has enough resources\r\n        if (!this.betting.canAffordBet()) {\r\n            this.view.updateGameStatus('NOT ENOUGH RESOURCES');\r\n            return;\r\n        }\r\n        \r\n        // Place the bet\r\n        if (!this.betting.placeBet()) {\r\n            this.view.updateGameStatus('BET FAILED');\r\n            return;\r\n        }\r\n        \r\n        this.view.updateResourceDisplay(this.spaceship);\r\n        \r\n        // Create and shuffle deck\r\n        this.deck.reset();\r\n        \r\n        // Clear previous hands and start game\r\n        this.gameLogic.startGame();\r\n        this.view.clearCards(true);\r\n        this.view.clearCards(false);\r\n        \r\n        // Deal initial cards\r\n        this.dealCardToPlayer();\r\n        this.dealCardToPlayer();\r\n        this.dealCardToDealer();\r\n        this.dealCardToDealer(true); // Face down\r\n        \r\n        // Check for natural blackjack\r\n        const naturalResult = this.gameLogic.checkForNaturalBlackjack();\r\n        if (naturalResult) {\r\n            this.handleGameEnd(naturalResult);\r\n        } else {\r\n            this.view.updateGameStatus('YOUR MOVE');\r\n        }\r\n        \r\n        this.updateControls();\r\n        this.animations.playCardSound('deal');\r\n    }\r\n    \r\n    /**\r\n     * Deal a card to the player\r\n     */\r\n    dealCardToPlayer() {\r\n        const card = this.deck.drawCard();\r\n        this.gameLogic.addCardToPlayer(card);\r\n        \r\n        const cardEl = this.view.addCard(card, false, true);\r\n        this.animations.animateCardDeal(cardEl);\r\n        \r\n        const score = this.gameLogic.getPlayerScore();\r\n        this.view.updateScore(score, true);\r\n        \r\n        if (this.gameLogic.isBust(this.gameLogic.getPlayerHand())) {\r\n            this.handleGameEnd('bust');\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Deal a card to the dealer\r\n     */\r\n    dealCardToDealer(faceDown = false) {\r\n        const card = this.deck.drawCard();\r\n        this.gameLogic.addCardToDealer(card);\r\n        \r\n        const cardEl = this.view.addCard(card, faceDown, false);\r\n        this.animations.animateCardDeal(cardEl);\r\n        \r\n        if (!faceDown) {\r\n            const visibleScore = this.gameLogic.calculateVisibleDealerScore();\r\n            this.view.updateScore(visibleScore, false);\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Player action: Hit (take another card)\r\n     */\r\n    hit() {\r\n        if (this.gameLogic.isGameActive()) {\r\n            this.dealCardToPlayer();\r\n            this.animations.playCardSound('hit');\r\n            this.updateControls();\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Player action: Stand (end turn)\r\n     */\r\n    stand() {\r\n        if (this.gameLogic.isGameActive()) {\r\n            this.animations.playCardSound('stand');\r\n            this.dealerPlay();\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Player action: Double Down\r\n     */\r\n    doubleDown() {\r\n        if (this.gameLogic.isGameActive() && this.gameLogic.getPlayerHand().length === 2) {\r\n            if (!this.betting.canAffordDoubleDown()) {\r\n                this.view.updateGameStatus('NOT ENOUGH RESOURCES FOR DOUBLE DOWN');\r\n                return;\r\n            }\r\n            \r\n            // Double the bet\r\n            this.betting.doubleDown();\r\n            this.view.updateResourceDisplay(this.spaceship);\r\n            \r\n            // Deal one more card\r\n            this.dealCardToPlayer();\r\n            \r\n            // If not bust, dealer plays\r\n            if (!this.gameLogic.isBust(this.gameLogic.getPlayerHand())) {\r\n                this.dealerPlay();\r\n            }\r\n            \r\n            this.animations.playCardSound('double');\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Dealer's turn to play\r\n     */\r\n    dealerPlay() {\r\n        // Reveal dealer's face-down card\r\n        const lastCard = this.gameLogic.getLastDealerCard();\r\n        if (lastCard) {\r\n            this.animations.animateCardFlip(\r\n                document.getElementById('face-down-card'),\r\n                () => {\r\n                    this.view.revealDealerCard(lastCard);\r\n                    this.view.updateScore(this.gameLogic.getDealerScore(), false);\r\n                }\r\n            );\r\n        }\r\n        \r\n        // Dealer hits until score is 17 or higher\r\n        const dealerPlayNextCard = () => {\r\n            if (this.gameLogic.shouldDealerHit()) {\r\n                this.dealCardToDealer();\r\n                this.animations.playCardSound('hit');\r\n                \r\n                setTimeout(() => {\r\n                    dealerPlayNextCard();\r\n                }, 800);\r\n            } else {\r\n                const result = this.gameLogic.determineOutcome();\r\n                this.handleGameEnd(result);\r\n            }\r\n        };\r\n        \r\n        setTimeout(dealerPlayNextCard, 800);\r\n    }\r\n    \r\n    /**\r\n     * Handle game end with result\r\n     */\r\n    handleGameEnd(result) {\r\n        this.gameLogic.endGame(result);\r\n        \r\n        let payout = 0;\r\n        let statusMessage = '';\r\n        let speechType = result;\r\n        \r\n        switch (result) {\r\n            case 'win':\r\n                payout = this.betting.handleWin();\r\n                statusMessage = 'YOU WIN!';\r\n                this.animations.animateWinCelebration(this.gameUI);\r\n                this.animations.playCardSound('win');\r\n                break;\r\n                \r\n            case 'blackjack':\r\n                payout = this.betting.handleBlackjack();\r\n                statusMessage = 'BLACKJACK! TRIPLE PAYOUT!';\r\n                this.animations.animateBlackjackCelebration(this.gameUI);\r\n                this.animations.playCardSound('blackjack');\r\n                break;\r\n                \r\n            case 'lose':\r\n            case 'bust':\r\n                statusMessage = result === 'bust' ? 'BUST! YOU LOSE' : 'DEALER WINS';\r\n                this.animations.animateLoseEffect(this.gameUI);\r\n                this.animations.playCardSound(result);\r\n                speechType = 'lose';\r\n                break;\r\n                \r\n            case 'push':\r\n                payout = this.betting.handlePush();\r\n                statusMessage = 'PUSH - BETS RETURNED';\r\n                this.animations.playCardSound('push');\r\n                break;\r\n        }\r\n        \r\n        this.view.updateGameStatus(statusMessage);\r\n        this.view.updateResourceDisplay(this.spaceship);\r\n        \r\n        // Show dealer speech\r\n        const phrase = this.gameLogic.getDealerPhrase(speechType);\r\n        if (phrase) {\r\n            this.view.showDealerSpeech(phrase);\r\n        }\r\n        \r\n        this.updateControls();\r\n    }\r\n    \r\n    /**\r\n     * Cleanup method for destroying the game\r\n     */\r\n    destroy() {\r\n        if (this.eventHandlers) {\r\n            this.eventHandlers.destroy();\r\n        }\r\n        \r\n        if (this.gameUI && this.gameUI.parentNode) {\r\n            this.gameUI.parentNode.removeChild(this.gameUI);\r\n        }\r\n        \r\n        this.gameUI = null;\r\n    }\r\n}","// styles.js - Settings UI styles and CSS generation\r\n\r\nexport class SettingsStyles {\r\n    constructor(isMobile) {\r\n        this.isMobile = isMobile;\r\n    }\r\n\r\n    /**\r\n     * Creates the main settings container with responsive styling\r\n     */\r\n    createSettingsContainer() {\r\n        const settingsContainer = document.createElement('div');\r\n        settingsContainer.id = 'settings-container';\r\n        settingsContainer.style.position = 'absolute';\r\n        settingsContainer.style.top = '50%';\r\n        settingsContainer.style.left = '50%';\r\n        settingsContainer.style.transform = 'translate(-50%, -50%)';\r\n        \r\n        // Adjust size for mobile\r\n        if (this.isMobile) {\r\n            settingsContainer.style.width = '95%';\r\n            settingsContainer.style.maxWidth = '600px';\r\n            settingsContainer.style.height = '90vh';\r\n        } else {\r\n            settingsContainer.style.width = '700px';\r\n            settingsContainer.style.maxHeight = '90vh';\r\n        }\r\n        \r\n        settingsContainer.style.overflowY = 'auto';\r\n        settingsContainer.style.backgroundColor = 'rgba(20, 30, 50, 0.9)';\r\n        settingsContainer.style.color = '#fff';\r\n        settingsContainer.style.padding = this.isMobile ? '20px' : '30px';\r\n        settingsContainer.style.borderRadius = '15px';\r\n        settingsContainer.style.border = '2px solid #33aaff';\r\n        settingsContainer.style.boxShadow = '0 0 30px #33aaff';\r\n        settingsContainer.style.fontFamily = 'Courier New, monospace';\r\n        settingsContainer.style.zIndex = '1000';\r\n        settingsContainer.style.display = 'none';\r\n        \r\n        // Add mobile-specific scroll support\r\n        if (this.isMobile) {\r\n            settingsContainer.style.webkitOverflowScrolling = 'touch';\r\n            settingsContainer.style.touchAction = 'pan-y';\r\n            settingsContainer.style.overscrollBehavior = 'contain';\r\n        }\r\n        \r\n        return settingsContainer;\r\n    }\r\n\r\n    /**\r\n     * Gets responsive styles for settings rows\r\n     */\r\n    getSettingsRowStyle() {\r\n        return `display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; flex-direction: ${this.isMobile ? 'column' : 'row'}; align-items: ${this.isMobile ? 'flex-start' : 'center'};`;\r\n    }\r\n\r\n    /**\r\n     * Gets styles for setting labels\r\n     */\r\n    getSettingLabelStyle() {\r\n        return `margin-bottom: ${this.isMobile ? '8px' : '0'}; ${this.isMobile ? 'width: 100%' : ''}`;\r\n    }\r\n\r\n    /**\r\n     * Gets styles for setting controls\r\n     */\r\n    getSettingControlStyle() {\r\n        return `${this.isMobile ? 'width: 100%' : ''}`;\r\n    }\r\n\r\n    /**\r\n     * Gets styles for toggle controls\r\n     */\r\n    getToggleControlStyle() {\r\n        return `${this.isMobile ? 'width: 100%; display: flex; justify-content: flex-end;' : ''}`;\r\n    }\r\n\r\n    /**\r\n     * Gets styles for label text\r\n     */\r\n    getLabelTextStyle() {\r\n        return `font-weight: bold; font-size: ${this.isMobile ? '15px' : 'inherit'};`;\r\n    }\r\n\r\n    /**\r\n     * Gets styles for description text\r\n     */\r\n    getDescriptionTextStyle() {\r\n        return `margin: 5px 0 0 0; font-size: ${this.isMobile ? '11px' : '12px'}; color: #aaa;`;\r\n    }\r\n\r\n    /**\r\n     * Gets styles for select elements\r\n     */\r\n    getSelectStyle() {\r\n        return `background-color: #2a3a5a; color: white; border: 1px solid #33aaff; padding: ${this.isMobile ? '10px' : '8px'}; border-radius: 5px; width: ${this.isMobile ? '100%' : 'auto'}; font-size: ${this.isMobile ? '16px' : 'inherit'};`;\r\n    }\r\n\r\n    /**\r\n     * Gets styles for toggle switches\r\n     */\r\n    getToggleStyle() {\r\n        return `display: inline-block; position: relative; width: ${this.isMobile ? '70px' : '60px'}; height: ${this.isMobile ? '34px' : '30px'};`;\r\n    }\r\n\r\n    /**\r\n     * Gets styles for toggle inputs\r\n     */\r\n    getToggleInputStyle() {\r\n        return 'opacity: 0; width: 0; height: 0;';\r\n    }\r\n\r\n    /**\r\n     * Gets styles for toggle sliders\r\n     */\r\n    getToggleSliderStyle() {\r\n        return `position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #555; border-radius: ${this.isMobile ? '17px' : '15px'}; transition: .4s;`;\r\n    }\r\n\r\n    /**\r\n     * Gets styles for section headers\r\n     */\r\n    getSectionHeaderStyle() {\r\n        return `color: #33aaff; border-bottom: 1px solid #33aaff; padding-bottom: 10px; font-size: ${this.isMobile ? '18px' : '20px'};`;\r\n    }\r\n\r\n    /**\r\n     * Gets styles for main title\r\n     */\r\n    getMainTitleStyle() {\r\n        return `text-align: center; color: #33aaff; margin-top: 0; font-size: ${this.isMobile ? '24px' : '28px'};`;\r\n    }\r\n\r\n    /**\r\n     * Gets styles for preset buttons container\r\n     */\r\n    getPresetContainerStyle() {\r\n        return `display: flex; justify-content: space-between; margin-bottom: 20px; flex-direction: ${this.isMobile ? 'column' : 'row'}; gap: ${this.isMobile ? '10px' : '0'};`;\r\n    }\r\n\r\n    /**\r\n     * Gets styles for preset buttons\r\n     */\r\n    getPresetButtonStyle() {\r\n        return `flex: 1; margin-right: ${this.isMobile ? '0' : '10px'}; padding: ${this.isMobile ? '15px' : '10px'}; background-color: #2a3a5a; color: white; border: 1px solid #33aaff; border-radius: 5px; cursor: pointer; font-size: ${this.isMobile ? '16px' : 'inherit'};`;\r\n    }\r\n\r\n    /**\r\n     * Gets styles for action buttons container\r\n     */\r\n    getActionButtonsContainerStyle() {\r\n        return `display: flex; justify-content: space-between; flex-direction: ${this.isMobile ? 'column' : 'row'}; gap: ${this.isMobile ? '15px' : '0'};`;\r\n    }\r\n\r\n    /**\r\n     * Gets styles for apply button\r\n     */\r\n    getApplyButtonStyle() {\r\n        return `flex: 1; margin-right: ${this.isMobile ? '0' : '10px'}; padding: ${this.isMobile ? '20px' : '15px'}; background-color: #33aaff; color: black; border: none; border-radius: 5px; cursor: pointer; font-family: 'Courier New', monospace; font-weight: bold; font-size: ${this.isMobile ? '18px' : '16px'};`;\r\n    }\r\n\r\n    /**\r\n     * Gets styles for back button\r\n     */\r\n    getBackButtonStyle() {\r\n        return `flex: 1; padding: ${this.isMobile ? '20px' : '15px'}; background-color: #555; color: white; border: none; border-radius: 5px; cursor: pointer; font-family: 'Courier New', monospace; font-weight: bold; font-size: ${this.isMobile ? '18px' : '16px'};`;\r\n    }\r\n\r\n    /**\r\n     * Gets styles for notification\r\n     */\r\n    getNotificationStyle() {\r\n        return {\r\n            position: 'fixed',\r\n            top: this.isMobile ? '25%' : '20%',\r\n            left: '50%',\r\n            transform: 'translate(-50%, -50%)',\r\n            backgroundColor: 'rgba(0, 0, 0, 0.8)',\r\n            color: '#33aaff',\r\n            padding: this.isMobile ? '20px 40px' : '15px 30px',\r\n            borderRadius: '10px',\r\n            fontFamily: 'Courier New, monospace',\r\n            fontSize: this.isMobile ? '18px' : '16px',\r\n            zIndex: '9999',\r\n            textAlign: 'center'\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Injects toggle slider CSS into the document head\r\n     */\r\n    injectToggleCSS() {\r\n        const style = document.createElement('style');\r\n        style.textContent = `\r\n            .slider:before {\r\n                position: absolute;\r\n                content: \"\";\r\n                height: ${this.isMobile ? '26px' : '22px'};\r\n                width: ${this.isMobile ? '26px' : '22px'};\r\n                left: 4px;\r\n                bottom: 4px;\r\n                background-color: white;\r\n                border-radius: 50%;\r\n                transition: .4s;\r\n            }\r\n            \r\n            input:checked + .slider {\r\n                background-color: #33aaff;\r\n            }\r\n            \r\n            input:checked + .slider:before {\r\n                transform: translateX(${this.isMobile ? '36px' : '30px'});\r\n            }\r\n        `;\r\n        \r\n        document.head.appendChild(style);\r\n    }\r\n\r\n    /**\r\n     * Creates a settings row with label and control\r\n     */\r\n    createSettingRow(labelText, description, controlHtml) {\r\n        return `\r\n            <div class=\"settings-row\" style=\"${this.getSettingsRowStyle()}\">\r\n                <div style=\"${this.getSettingLabelStyle()}\">\r\n                    <label style=\"${this.getLabelTextStyle()}\">${labelText}</label>\r\n                    <p style=\"${this.getDescriptionTextStyle()}\">${description}</p>\r\n                </div>\r\n                <div style=\"${this.getSettingControlStyle()}\">\r\n                    ${controlHtml}\r\n                </div>\r\n            </div>\r\n        `;\r\n    }\r\n\r\n    /**\r\n     * Creates a toggle settings row\r\n     */\r\n    createToggleRow(labelText, description, inputId) {\r\n        const toggleHtml = `\r\n            <label class=\"toggle\" style=\"${this.getToggleStyle()}\">\r\n                <input type=\"checkbox\" id=\"${inputId}\" style=\"${this.getToggleInputStyle()}\">\r\n                <span class=\"slider\" style=\"${this.getToggleSliderStyle()}\"></span>\r\n            </label>\r\n        `;\r\n\r\n        return `\r\n            <div class=\"settings-row\" style=\"${this.getSettingsRowStyle()}\">\r\n                <div style=\"${this.getSettingLabelStyle()}\">\r\n                    <label style=\"${this.getLabelTextStyle()}\">${labelText}</label>\r\n                    <p style=\"${this.getDescriptionTextStyle()}\">${description}</p>\r\n                </div>\r\n                <div style=\"${this.getToggleControlStyle()}\">\r\n                    ${toggleHtml}\r\n                </div>\r\n            </div>\r\n        `;\r\n    }\r\n\r\n    /**\r\n     * Creates a select dropdown settings row\r\n     */\r\n    createSelectRow(labelText, description, selectId, options) {\r\n        const optionsHtml = options.map(option => \r\n            `<option value=\"${option.value}\">${option.text}</option>`\r\n        ).join('');\r\n\r\n        const selectHtml = `\r\n            <select id=\"${selectId}\" style=\"${this.getSelectStyle()}\">\r\n                ${optionsHtml}\r\n            </select>\r\n        `;\r\n\r\n        return this.createSettingRow(labelText, description, selectHtml);\r\n    }\r\n}","// audioSettings.js - Audio settings controls and logic\r\n\r\nexport class AudioSettings {\r\n    constructor(game, styles) {\r\n        this.game = game;\r\n        this.styles = styles;\r\n    }\r\n\r\n    /**\r\n     * Creates the audio settings section HTML\r\n     */\r\n    createAudioSettingsHTML() {\r\n        return `\r\n            <div style=\"margin-bottom: 20px;\">\r\n                <h3 style=\"${this.styles.getSectionHeaderStyle()}\">AUDIO SETTINGS</h3>\r\n                \r\n                ${this.styles.createToggleRow(\r\n                    'Spatial Audio',\r\n                    '3D positional sound effects',\r\n                    'spatial-audio'\r\n                )}\r\n            </div>\r\n        `;\r\n    }\r\n\r\n    /**\r\n     * Applies audio settings to the game\r\n     */\r\n    applyAudioSettings(settings) {\r\n        if (!this.game.audio) return;\r\n        \r\n        const audio = this.game.audio;\r\n        \r\n        // Apply spatial audio setting\r\n        if (audio.spatialAudio !== undefined) {\r\n            audio.spatialAudio = settings.spatialAudio;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Updates audio-related UI elements with current settings\r\n     */\r\n    updateAudioUI(settings) {\r\n        const spatialAudioElement = document.getElementById('spatial-audio');\r\n        if (spatialAudioElement) {\r\n            spatialAudioElement.checked = settings.spatialAudio;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Reads audio settings from UI elements\r\n     */\r\n    readAudioSettings() {\r\n        const spatialAudioElement = document.getElementById('spatial-audio');\r\n        \r\n        return {\r\n            spatialAudio: spatialAudioElement ? spatialAudioElement.checked : true\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Applies audio preset settings\r\n     */\r\n    applyAudioPreset(preset, settings) {\r\n        switch (preset) {\r\n            case 'performance':\r\n                settings.spatialAudio = false;\r\n                break;\r\n                \r\n            case 'balanced':\r\n            case 'quality':\r\n                settings.spatialAudio = true;\r\n                break;\r\n        }\r\n        \r\n        return settings;\r\n    }\r\n}","// graphicsSettings.js - Graphics settings controls and logic\r\n\r\nimport * as THREE from 'three';\r\n\r\nexport class GraphicsSettings {\r\n    constructor(game, styles) {\r\n        this.game = game;\r\n        this.styles = styles;\r\n    }\r\n\r\n    /**\r\n     * Creates the graphics settings section HTML\r\n     */\r\n    createGraphicsSettingsHTML() {\r\n        return `\r\n            <div style=\"margin-bottom: 20px;\">\r\n                <h3 style=\"${this.styles.getSectionHeaderStyle()}\">GRAPHICS SETTINGS</h3>\r\n                \r\n                ${this.styles.createSelectRow(\r\n                    'Graphical Quality',\r\n                    'Affects overall visual fidelity and performance',\r\n                    'graphical-quality',\r\n                    [\r\n                        { value: 'low', text: 'Low' },\r\n                        { value: 'medium', text: 'Medium' },\r\n                        { value: 'high', text: 'High' }\r\n                    ]\r\n                )}\r\n                \r\n                ${this.styles.createToggleRow(\r\n                    'Post-processing Effects',\r\n                    'Bloom, anti-aliasing, and visual effects',\r\n                    'post-processing'\r\n                )}\r\n                \r\n                ${this.styles.createToggleRow(\r\n                    'Volumetric Light Rays',\r\n                    'Enable sunlight rays effect',\r\n                    'god-rays-enabled'\r\n                )}\r\n                \r\n                ${this.styles.createSelectRow(\r\n                    'Light Ray Type',\r\n                    'Choose light ray effect style',\r\n                    'god-rays-type',\r\n                    [\r\n                        { value: 'standard', text: 'Standard God Rays' },\r\n                        { value: 'claude', text: 'Claude Rays' }\r\n                    ]\r\n                )}\r\n                \r\n                ${this.styles.createSelectRow(\r\n                    'Asteroid Detail',\r\n                    'Affects asteroid count and model complexity',\r\n                    'asteroid-detail',\r\n                    [\r\n                        { value: 'low', text: 'Low' },\r\n                        { value: 'medium', text: 'Medium' },\r\n                        { value: 'high', text: 'High' }\r\n                    ]\r\n                )}\r\n                \r\n                ${this.styles.createSelectRow(\r\n                    'Lighting Quality',\r\n                    'Affects light sources and shadows',\r\n                    'lighting-quality',\r\n                    [\r\n                        { value: 'low', text: 'Low' },\r\n                        { value: 'medium', text: 'Medium' },\r\n                        { value: 'high', text: 'High' }\r\n                    ]\r\n                )}\r\n                \r\n                ${this.styles.createSelectRow(\r\n                    'Particle Effects',\r\n                    'Affects thruster, explosion, and other particle effects',\r\n                    'particle-effects',\r\n                    [\r\n                        { value: 'low', text: 'Low' },\r\n                        { value: 'medium', text: 'Medium' },\r\n                        { value: 'high', text: 'High' }\r\n                    ]\r\n                )}\r\n                \r\n                ${this.styles.createSelectRow(\r\n                    'Resolution Scale',\r\n                    'Adjusts rendering resolution',\r\n                    'resolution-scale',\r\n                    [\r\n                        { value: 'low', text: 'Low (75%)' },\r\n                        { value: 'medium', text: 'Medium (100%)' },\r\n                        { value: 'high', text: 'High (125%)' }\r\n                    ]\r\n                )}\r\n            </div>\r\n        `;\r\n    }\r\n\r\n    /**\r\n     * Applies graphics settings to the game renderer\r\n     */\r\n    applyGraphicsSettings(settings) {\r\n        if (!this.game) return;\r\n        \r\n        // Apply renderer settings\r\n        this.applyRendererSettings(settings);\r\n        \r\n        // Apply environment settings\r\n        this.applyEnvironmentSettings(settings);\r\n        \r\n        console.log('Graphics settings applied successfully');\r\n    }\r\n\r\n    /**\r\n     * Applies renderer-specific graphics settings\r\n     */\r\n    applyRendererSettings(settings) {\r\n        if (!this.game.renderer) return;\r\n        \r\n        const renderer = this.game.renderer;\r\n        \r\n        // Apply graphical quality\r\n        switch (settings.graphicalQuality) {\r\n            case 'low':\r\n                // Disable antialiasing\r\n                if (renderer.renderer) {\r\n                    renderer.renderer.antialias = false;\r\n                }\r\n                \r\n                // Set low shadow map size\r\n                if (renderer.renderer && renderer.renderer.shadowMap) {\r\n                    renderer.renderer.shadowMap.enabled = false;\r\n                }\r\n                break;\r\n                \r\n            case 'medium':\r\n                // Enable antialiasing\r\n                if (renderer.renderer) {\r\n                    renderer.renderer.antialias = true;\r\n                }\r\n                \r\n                // Set medium shadow map size\r\n                if (renderer.renderer && renderer.renderer.shadowMap) {\r\n                    renderer.renderer.shadowMap.enabled = true;\r\n                    renderer.renderer.shadowMap.type = THREE.PCFShadowMap;\r\n                }\r\n                break;\r\n                \r\n            case 'high':\r\n                // Enable antialiasing\r\n                if (renderer.renderer) {\r\n                    renderer.renderer.antialias = true;\r\n                }\r\n                \r\n                // Set high shadow map size\r\n                if (renderer.renderer && renderer.renderer.shadowMap) {\r\n                    renderer.renderer.shadowMap.enabled = true;\r\n                    renderer.renderer.shadowMap.type = THREE.PCFSoftShadowMap;\r\n                }\r\n                break;\r\n        }\r\n        \r\n        // Apply post-processing setting\r\n        if (renderer.composer) {\r\n            renderer.useBasicRendering = !settings.postProcessing;\r\n        }\r\n        \r\n        // Apply god ray type setting first (this affects ambient light)\r\n        if (renderer.setRayType) {\r\n            const useClaudeRays = settings.godRaysType === 'claude';\r\n            renderer.setRayType(useClaudeRays);\r\n        }\r\n        \r\n        // Apply volumetric lighting (god rays) settings\r\n        if (renderer.setVolumetricLightEnabled) {\r\n            renderer.setVolumetricLightEnabled(settings.godRaysEnabled);\r\n            \r\n            // Ensure lighting is adjusted even when disabling god rays\r\n            if (renderer.adjustLightingForRayType) {\r\n                renderer.adjustLightingForRayType();\r\n            }\r\n        }\r\n        \r\n        // Apply volumetric light intensity based on quality setting\r\n        if (renderer.setVolumetricLightIntensity) {\r\n            let intensity;\r\n            switch (settings.graphicalQuality) {\r\n                case 'low':\r\n                    intensity = 0.4; // Increased from 0.3\r\n                    break;\r\n                case 'medium':\r\n                    intensity = 0.65; // Increased from 0.5\r\n                    break;\r\n                case 'high':\r\n                    intensity = 0.85; // Increased from 0.7\r\n                    break;\r\n                default:\r\n                    intensity = 0.65;\r\n            }\r\n            renderer.setVolumetricLightIntensity(intensity);\r\n        }\r\n        \r\n        // Apply bloom settings based on quality\r\n        if (renderer.bloomPass) {\r\n            switch (settings.graphicalQuality) {\r\n                case 'low':\r\n                    renderer.adjustBloom(0.4, 0.3, 0.9);\r\n                    break;\r\n                case 'medium':\r\n                    renderer.adjustBloom(0.6, 0.4, 0.85);\r\n                    break;\r\n                case 'high':\r\n                    renderer.adjustBloom(0.8, 0.5, 0.8);\r\n                    break;\r\n            }\r\n        }\r\n        \r\n        // Apply resolution scaling\r\n        if (renderer.renderer) {\r\n            let pixelRatio = window.devicePixelRatio || 1;\r\n            \r\n            switch (settings.resolutionScale) {\r\n                case 'low':\r\n                    pixelRatio *= 0.75;\r\n                    break;\r\n                case 'medium':\r\n                    // Use default pixel ratio\r\n                    break;\r\n                case 'high':\r\n                    pixelRatio *= 1.25;\r\n                    break;\r\n            }\r\n            \r\n            renderer.renderer.setPixelRatio(pixelRatio);\r\n            \r\n            // Update size to apply new pixel ratio\r\n            renderer.handleResize();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Applies environment-related graphics settings\r\n     */\r\n    applyEnvironmentSettings(settings) {\r\n        if (!this.game.environment) return;\r\n        \r\n        const environment = this.game.environment;\r\n        \r\n        // Apply asteroid detail settings\r\n        if (environment.asteroidBelt && environment.asteroidBelt.updateDensity) {\r\n            switch (settings.asteroidDetail) {\r\n                case 'low':\r\n                    environment.asteroidBelt.updateDensity(0.5); // 50% density\r\n                    break;\r\n                case 'medium':\r\n                    environment.asteroidBelt.updateDensity(1.0); // 100% density\r\n                    break;\r\n                case 'high':\r\n                    environment.asteroidBelt.updateDensity(1.5); // 150% density\r\n                    break;\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Applies physics settings related to graphics\r\n     */\r\n    applyPhysicsSettings(settings) {\r\n        // Physics settings don't need much adjustment, but we can optimize collision detection\r\n        // based on asteroid detail setting\r\n        if (this.game.physics) {\r\n            const physics = this.game.physics;\r\n            \r\n            switch (settings.asteroidDetail) {\r\n                case 'low':\r\n                    physics.collisionDistance = 10; // Reduced collision distance\r\n                    break;\r\n                case 'medium':\r\n                    physics.collisionDistance = 15; // Default\r\n                    break;\r\n                case 'high':\r\n                    physics.collisionDistance = 20; // More precise collision\r\n                    break;\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Updates graphics-related UI elements with current settings\r\n     */\r\n    updateGraphicsUI(settings) {\r\n        const elements = {\r\n            'graphical-quality': settings.graphicalQuality,\r\n            'post-processing': settings.postProcessing,\r\n            'asteroid-detail': settings.asteroidDetail,\r\n            'lighting-quality': settings.lightingQuality,\r\n            'particle-effects': settings.particleEffects,\r\n            'resolution-scale': settings.resolutionScale,\r\n            'god-rays-enabled': settings.godRaysEnabled,\r\n            'god-rays-type': settings.godRaysType\r\n        };\r\n\r\n        for (const [elementId, value] of Object.entries(elements)) {\r\n            const element = document.getElementById(elementId);\r\n            if (element) {\r\n                if (element.type === 'checkbox') {\r\n                    element.checked = value;\r\n                } else {\r\n                    element.value = value;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Reads graphics settings from UI elements\r\n     */\r\n    readGraphicsSettings() {\r\n        return {\r\n            graphicalQuality: this.getElementValue('graphical-quality', 'medium'),\r\n            postProcessing: this.getElementChecked('post-processing', true),\r\n            asteroidDetail: this.getElementValue('asteroid-detail', 'medium'),\r\n            lightingQuality: this.getElementValue('lighting-quality', 'medium'),\r\n            particleEffects: this.getElementValue('particle-effects', 'medium'),\r\n            resolutionScale: this.getElementValue('resolution-scale', 'medium'),\r\n            godRaysEnabled: this.getElementChecked('god-rays-enabled', false),\r\n            godRaysType: this.getElementValue('god-rays-type', 'standard')\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Helper to get element value with fallback\r\n     */\r\n    getElementValue(elementId, defaultValue) {\r\n        const element = document.getElementById(elementId);\r\n        return element ? element.value : defaultValue;\r\n    }\r\n\r\n    /**\r\n     * Helper to get element checked state with fallback\r\n     */\r\n    getElementChecked(elementId, defaultValue) {\r\n        const element = document.getElementById(elementId);\r\n        return element ? element.checked : defaultValue;\r\n    }\r\n\r\n    /**\r\n     * Applies graphics preset settings\r\n     */\r\n    applyGraphicsPreset(preset, settings) {\r\n        switch (preset) {\r\n            case 'performance':\r\n                // Performance preset - prioritizes frame rate\r\n                settings.graphicalQuality = 'low';\r\n                settings.postProcessing = false;\r\n                settings.asteroidDetail = 'low';\r\n                settings.lightingQuality = 'low';\r\n                settings.particleEffects = 'low';\r\n                settings.resolutionScale = 'low';\r\n                settings.godRaysEnabled = false; // Disable god rays for performance\r\n                break;\r\n                \r\n            case 'balanced':\r\n                // Balanced preset - moderate settings\r\n                settings.graphicalQuality = 'medium';\r\n                settings.postProcessing = true;\r\n                settings.asteroidDetail = 'medium';\r\n                settings.lightingQuality = 'medium';\r\n                settings.particleEffects = 'medium';\r\n                settings.resolutionScale = 'medium';\r\n                settings.godRaysEnabled = true; // Enable god rays\r\n                settings.godRaysType = 'standard'; // Use standard rays\r\n                break;\r\n                \r\n            case 'quality':\r\n                // Quality preset - prioritizes visuals\r\n                settings.graphicalQuality = 'high';\r\n                settings.postProcessing = true;\r\n                settings.asteroidDetail = 'high';\r\n                settings.lightingQuality = 'high';\r\n                settings.particleEffects = 'high';\r\n                settings.resolutionScale = 'high';\r\n                settings.godRaysEnabled = true; // Enable god rays\r\n                settings.godRaysType = 'claude'; // Use Claude rays for dramatic effect\r\n                break;\r\n        }\r\n        \r\n        return settings;\r\n    }\r\n}","// settingsView.js - Settings panel layout and view management\r\n\r\nexport class SettingsView {\r\n    constructor(styles, graphicsSettings, audioSettings, helpers) {\r\n        this.styles = styles;\r\n        this.graphicsSettings = graphicsSettings;\r\n        this.audioSettings = audioSettings;\r\n        this.helpers = helpers;\r\n    }\r\n\r\n    /**\r\n     * Creates the complete settings UI\r\n     */\r\n    createSettingsUI() {\r\n        // Create settings container\r\n        const settingsContainer = this.styles.createSettingsContainer();\r\n        \r\n        // Create settings content\r\n        settingsContainer.innerHTML = this.createSettingsHTML();\r\n        \r\n        // Inject toggle CSS\r\n        this.styles.injectToggleCSS();\r\n        \r\n        // Add to document\r\n        document.body.appendChild(settingsContainer);\r\n        \r\n        return settingsContainer;\r\n    }\r\n\r\n    /**\r\n     * Creates the complete settings HTML content\r\n     */\r\n    createSettingsHTML() {\r\n        return `\r\n            <h2 style=\"${this.styles.getMainTitleStyle()}\">GAME SETTINGS</h2>\r\n            \r\n            ${this.graphicsSettings.createGraphicsSettingsHTML()}\r\n            \r\n            ${this.createPerformanceSettingsHTML()}\r\n            \r\n            ${this.audioSettings.createAudioSettingsHTML()}\r\n            \r\n            ${this.createPresetsHTML()}\r\n            \r\n            ${this.createActionButtonsHTML()}\r\n        `;\r\n    }\r\n\r\n    /**\r\n     * Creates the performance settings section HTML\r\n     */\r\n    createPerformanceSettingsHTML() {\r\n        return `\r\n            <div style=\"margin-bottom: 20px;\">\r\n                <h3 style=\"${this.styles.getSectionHeaderStyle()}\">PERFORMANCE SETTINGS</h3>\r\n                \r\n                ${this.styles.createSelectRow(\r\n                    'Frame Rate Cap',\r\n                    'Limits maximum frame rate',\r\n                    'frame-rate-cap',\r\n                    [\r\n                        { value: '30', text: '30 FPS' },\r\n                        { value: '60', text: '60 FPS' },\r\n                        { value: 'auto', text: `Monitor Refresh Rate (60Hz)` },\r\n                        { value: '0', text: 'Unlimited' }\r\n                    ]\r\n                )}\r\n                \r\n                ${this.styles.createToggleRow(\r\n                    'Show FPS Counter',\r\n                    'Display current frame rate',\r\n                    'show-fps'\r\n                )}\r\n                \r\n                ${this.styles.createToggleRow(\r\n                    'Auto-Adjust Quality',\r\n                    'Automatically adjusts settings based on performance',\r\n                    'auto-quality'\r\n                )}\r\n            </div>\r\n        `;\r\n    }\r\n\r\n    /**\r\n     * Creates the presets section HTML\r\n     */\r\n    createPresetsHTML() {\r\n        return `\r\n            <div style=\"margin-bottom: 20px;\">\r\n                <h3 style=\"${this.styles.getSectionHeaderStyle()}\">PRESETS</h3>\r\n                \r\n                <div style=\"${this.styles.getPresetContainerStyle()}\">\r\n                    <button id=\"preset-performance\" style=\"${this.styles.getPresetButtonStyle()}\">\r\n                        PERFORMANCE\r\n                    </button>\r\n                    <button id=\"preset-balanced\" style=\"${this.styles.getPresetButtonStyle()}\">\r\n                        BALANCED\r\n                    </button>\r\n                    <button id=\"preset-quality\" style=\"${this.styles.getPresetButtonStyle()}\">\r\n                        QUALITY\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        `;\r\n    }\r\n\r\n    /**\r\n     * Creates the action buttons HTML\r\n     */\r\n    createActionButtonsHTML() {\r\n        return `\r\n            <div style=\"${this.styles.getActionButtonsContainerStyle()}\">\r\n                <button id=\"apply-settings\" style=\"${this.styles.getApplyButtonStyle()}\">\r\n                    APPLY\r\n                </button>\r\n                <button id=\"settings-back\" style=\"${this.styles.getBackButtonStyle()}\">\r\n                    BACK\r\n                </button>\r\n            </div>\r\n        `;\r\n    }\r\n\r\n    /**\r\n     * Shows the settings panel\r\n     */\r\n    show() {\r\n        const settingsContainer = document.getElementById('settings-container');\r\n        if (settingsContainer) {\r\n            settingsContainer.style.display = 'block';\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    /**\r\n     * Hides the settings panel\r\n     */\r\n    hide() {\r\n        const settingsContainer = document.getElementById('settings-container');\r\n        if (settingsContainer) {\r\n            settingsContainer.style.display = 'none';\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    /**\r\n     * Updates the refresh rate display in the frame rate cap dropdown\r\n     */\r\n    updateRefreshRateDisplay(refreshRate) {\r\n        const frameRateSelect = document.getElementById('frame-rate-cap');\r\n        if (frameRateSelect) {\r\n            const autoOption = frameRateSelect.querySelector('option[value=\"auto\"]');\r\n            if (autoOption) {\r\n                autoOption.textContent = `Monitor Refresh Rate (${refreshRate}Hz)`;\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Shows a settings applied notification\r\n     */\r\n    showSettingsApplied() {\r\n        // Create notification\r\n        const notification = document.createElement('div');\r\n        const notificationStyles = this.styles.getNotificationStyle();\r\n        \r\n        // Apply all styles\r\n        Object.assign(notification.style, notificationStyles);\r\n        notification.textContent = 'Settings applied and saved';\r\n        \r\n        document.body.appendChild(notification);\r\n        \r\n        // Remove after a few seconds\r\n        setTimeout(() => {\r\n            notification.style.opacity = '0';\r\n            notification.style.transition = 'opacity 0.5s';\r\n            \r\n            setTimeout(() => {\r\n                notification.remove();\r\n            }, 500);\r\n        }, 1500);\r\n    }\r\n}","// persistence.js - Settings save/load and localStorage handling\r\n\r\nexport class SettingsPersistence {\r\n    constructor() {\r\n        this.storageKey = 'asteroidMinerSettings';\r\n    }\r\n\r\n    /**\r\n     * Gets default settings object\r\n     */\r\n    getDefaultSettings() {\r\n        return {\r\n            graphicalQuality: 'medium',    // low, medium, high\r\n            postProcessing: true,          // true, false\r\n            asteroidDetail: 'medium',      // low, medium, high\r\n            lightingQuality: 'medium',     // low, medium, high\r\n            particleEffects: 'medium',     // low, medium, high\r\n            resolutionScale: 'medium',     // low, medium, high\r\n            frameRateCap: 'auto',          // 30, 60, auto (monitor refresh rate), 0 (unlimited)\r\n            showFPS: false,                // Show FPS counter\r\n            spatialAudio: true,            // Enable spatial audio\r\n            autoQuality: true,             // Automatically adjust quality based on performance\r\n            godRaysEnabled: false,         // Enable/disable volumetric lighting effects\r\n            godRaysType: 'standard'        // 'standard' (new god rays) or 'claude' (Claude Rays)\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Loads settings from localStorage\r\n     */\r\n    loadSettings() {\r\n        try {\r\n            const savedSettings = localStorage.getItem(this.storageKey);\r\n            if (savedSettings) {\r\n                const parsedSettings = JSON.parse(savedSettings);\r\n                // Merge saved settings with defaults to handle new settings\r\n                const defaultSettings = this.getDefaultSettings();\r\n                const mergedSettings = {...defaultSettings, ...parsedSettings};\r\n                console.log(\"Settings loaded from localStorage:\", mergedSettings);\r\n                return mergedSettings;\r\n            }\r\n        } catch (error) {\r\n            console.error(\"Error loading settings:\", error);\r\n        }\r\n        \r\n        // Return defaults if loading fails\r\n        return this.getDefaultSettings();\r\n    }\r\n\r\n    /**\r\n     * Saves settings to localStorage\r\n     */\r\n    saveSettings(settings) {\r\n        try {\r\n            localStorage.setItem(this.storageKey, JSON.stringify(settings));\r\n            console.log(\"Settings saved to localStorage\");\r\n            return true;\r\n        } catch (error) {\r\n            console.error(\"Error saving settings:\", error);\r\n            return false;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Validates settings object to ensure all required properties exist\r\n     */\r\n    validateSettings(settings) {\r\n        const defaults = this.getDefaultSettings();\r\n        const validatedSettings = {...defaults};\r\n        \r\n        // Only copy valid properties from the input settings\r\n        for (const key in defaults) {\r\n            if (settings.hasOwnProperty(key)) {\r\n                validatedSettings[key] = settings[key];\r\n            }\r\n        }\r\n        \r\n        return validatedSettings;\r\n    }\r\n\r\n    /**\r\n     * Clears saved settings (resets to defaults)\r\n     */\r\n    clearSettings() {\r\n        try {\r\n            localStorage.removeItem(this.storageKey);\r\n            console.log(\"Settings cleared from localStorage\");\r\n            return true;\r\n        } catch (error) {\r\n            console.error(\"Error clearing settings:\", error);\r\n            return false;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Exports settings as JSON string\r\n     */\r\n    exportSettings(settings) {\r\n        try {\r\n            return JSON.stringify(settings, null, 2);\r\n        } catch (error) {\r\n            console.error(\"Error exporting settings:\", error);\r\n            return null;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Imports settings from JSON string\r\n     */\r\n    importSettings(jsonString) {\r\n        try {\r\n            const importedSettings = JSON.parse(jsonString);\r\n            return this.validateSettings(importedSettings);\r\n        } catch (error) {\r\n            console.error(\"Error importing settings:\", error);\r\n            return null;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Backs up current settings with timestamp\r\n     */\r\n    backupSettings(settings) {\r\n        const timestamp = new Date().toISOString();\r\n        const backupKey = `${this.storageKey}_backup_${timestamp}`;\r\n        \r\n        try {\r\n            localStorage.setItem(backupKey, JSON.stringify({\r\n                timestamp,\r\n                settings\r\n            }));\r\n            console.log(`Settings backed up with key: ${backupKey}`);\r\n            return backupKey;\r\n        } catch (error) {\r\n            console.error(\"Error backing up settings:\", error);\r\n            return null;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Lists available setting backups\r\n     */\r\n    listBackups() {\r\n        const backups = [];\r\n        const backupPrefix = `${this.storageKey}_backup_`;\r\n        \r\n        try {\r\n            for (let i = 0; i < localStorage.length; i++) {\r\n                const key = localStorage.key(i);\r\n                if (key && key.startsWith(backupPrefix)) {\r\n                    const backupData = JSON.parse(localStorage.getItem(key));\r\n                    backups.push({\r\n                        key,\r\n                        timestamp: backupData.timestamp,\r\n                        date: new Date(backupData.timestamp)\r\n                    });\r\n                }\r\n            }\r\n            \r\n            // Sort by date, newest first\r\n            backups.sort((a, b) => b.date - a.date);\r\n            return backups;\r\n        } catch (error) {\r\n            console.error(\"Error listing backups:\", error);\r\n            return [];\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Restores settings from a backup\r\n     */\r\n    restoreFromBackup(backupKey) {\r\n        try {\r\n            const backupData = localStorage.getItem(backupKey);\r\n            if (backupData) {\r\n                const parsedBackup = JSON.parse(backupData);\r\n                return this.validateSettings(parsedBackup.settings);\r\n            }\r\n        } catch (error) {\r\n            console.error(\"Error restoring from backup:\", error);\r\n        }\r\n        return null;\r\n    }\r\n\r\n    /**\r\n     * Cleans up old backups (keeps only the most recent N backups)\r\n     */\r\n    cleanupBackups(keepCount = 5) {\r\n        const backups = this.listBackups();\r\n        \r\n        // Remove backups beyond the keep count\r\n        for (let i = keepCount; i < backups.length; i++) {\r\n            try {\r\n                localStorage.removeItem(backups[i].key);\r\n                console.log(`Removed old backup: ${backups[i].key}`);\r\n            } catch (error) {\r\n                console.error(`Error removing backup ${backups[i].key}:`, error);\r\n            }\r\n        }\r\n    }\r\n}","// eventHandlers.js - Settings UI event handling\r\n\r\nexport class SettingsEventHandlers {\r\n    constructor(settings, isMobile) {\r\n        this.settings = settings;\r\n        this.isMobile = isMobile;\r\n    }\r\n\r\n    /**\r\n     * Sets up all event listeners for the settings UI\r\n     */\r\n    setupEventListeners() {\r\n        this.setupBackButton();\r\n        this.setupApplyButton();\r\n        this.setupPresetButtons();\r\n    }\r\n\r\n    /**\r\n     * Sets up the back button event listeners\r\n     */\r\n    setupBackButton() {\r\n        const backButton = document.getElementById('settings-back');\r\n        if (backButton) {\r\n            // Mouse event\r\n            backButton.addEventListener('click', () => {\r\n                this.settings.hide();\r\n            });\r\n            \r\n            // Touch event for mobile\r\n            if (this.isMobile) {\r\n                backButton.addEventListener('touchend', (e) => {\r\n                    e.preventDefault();\r\n                    this.settings.hide();\r\n                });\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Sets up the apply button event listeners\r\n     */\r\n    setupApplyButton() {\r\n        const applyButton = document.getElementById('apply-settings');\r\n        if (applyButton) {\r\n            const applyHandler = () => {\r\n                this.settings.updateSettings();\r\n                this.settings.saveSettings();\r\n                this.settings.applyAllSettings();\r\n                \r\n                // Show confirmation message\r\n                this.settings.showSettingsApplied();\r\n            };\r\n            \r\n            // Mouse event\r\n            applyButton.addEventListener('click', applyHandler);\r\n            \r\n            // Touch event for mobile\r\n            if (this.isMobile) {\r\n                applyButton.addEventListener('touchend', (e) => {\r\n                    e.preventDefault();\r\n                    applyHandler();\r\n                });\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Sets up preset button event listeners\r\n     */\r\n    setupPresetButtons() {\r\n        this.setupPresetButton('preset-performance', 'performance');\r\n        this.setupPresetButton('preset-balanced', 'balanced');\r\n        this.setupPresetButton('preset-quality', 'quality');\r\n    }\r\n\r\n    /**\r\n     * Sets up a single preset button with event listeners and effects\r\n     */\r\n    setupPresetButton(buttonId, presetName) {\r\n        const button = document.getElementById(buttonId);\r\n        if (!button) return;\r\n        \r\n        const presetHandler = () => {\r\n            this.settings.applyPreset(presetName);\r\n        };\r\n        \r\n        // Mouse event\r\n        button.addEventListener('click', presetHandler);\r\n        \r\n        // Touch event for mobile\r\n        if (this.isMobile) {\r\n            button.addEventListener('touchend', (e) => {\r\n                e.preventDefault();\r\n                presetHandler();\r\n            });\r\n        }\r\n        \r\n        // Add hover/touch effects\r\n        this.setupButtonEffects(button);\r\n    }\r\n\r\n    /**\r\n     * Sets up visual effects for buttons (hover/touch feedback)\r\n     */\r\n    setupButtonEffects(button) {\r\n        if (this.isMobile) {\r\n            // Touch effects for mobile\r\n            button.addEventListener('touchstart', () => {\r\n                button.style.backgroundColor = '#3a4b6a';\r\n                button.style.boxShadow = '0 0 10px #33aaff';\r\n            }, { passive: true });\r\n            \r\n            button.addEventListener('touchend', () => {\r\n                button.style.backgroundColor = '#2a3a5a';\r\n                button.style.boxShadow = 'none';\r\n            }, { passive: true });\r\n        } else {\r\n            // Mouse effects for desktop\r\n            button.addEventListener('mouseover', () => {\r\n                button.style.backgroundColor = '#3a4b6a';\r\n                button.style.boxShadow = '0 0 10px #33aaff';\r\n            });\r\n            \r\n            button.addEventListener('mouseout', () => {\r\n                button.style.backgroundColor = '#2a3a5a';\r\n                button.style.boxShadow = 'none';\r\n            });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Sets up keyboard navigation for settings (optional enhancement)\r\n     */\r\n    setupKeyboardNavigation() {\r\n        document.addEventListener('keydown', (e) => {\r\n            // ESC key to close settings\r\n            if (e.key === 'Escape' && this.settings.isVisible) {\r\n                this.settings.hide();\r\n                e.preventDefault();\r\n            }\r\n            \r\n            // Enter key to apply settings\r\n            if (e.key === 'Enter' && this.settings.isVisible && e.ctrlKey) {\r\n                const applyButton = document.getElementById('apply-settings');\r\n                if (applyButton) {\r\n                    applyButton.click();\r\n                    e.preventDefault();\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Removes all event listeners (cleanup)\r\n     */\r\n    removeEventListeners() {\r\n        // Remove button event listeners\r\n        const buttons = [\r\n            'settings-back',\r\n            'apply-settings', \r\n            'preset-performance',\r\n            'preset-balanced',\r\n            'preset-quality'\r\n        ];\r\n        \r\n        buttons.forEach(buttonId => {\r\n            const button = document.getElementById(buttonId);\r\n            if (button) {\r\n                // Clone and replace to remove all event listeners\r\n                const newButton = button.cloneNode(true);\r\n                button.parentNode.replaceChild(newButton, button);\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Validates form inputs before applying settings\r\n     */\r\n    validateSettingsForm() {\r\n        // Add validation logic here if needed\r\n        // For now, all settings are from dropdowns/checkboxes so they're valid by default\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Handles setting changes in real-time (optional)\r\n     */\r\n    setupRealTimeUpdates() {\r\n        const settingElements = [\r\n            'graphical-quality',\r\n            'post-processing',\r\n            'asteroid-detail',\r\n            'lighting-quality',\r\n            'particle-effects',\r\n            'resolution-scale',\r\n            'frame-rate-cap',\r\n            'show-fps',\r\n            'spatial-audio',\r\n            'auto-quality',\r\n            'god-rays-enabled',\r\n            'god-rays-type'\r\n        ];\r\n\r\n        settingElements.forEach(elementId => {\r\n            const element = document.getElementById(elementId);\r\n            if (element) {\r\n                element.addEventListener('change', () => {\r\n                    // Optional: Apply settings immediately on change\r\n                    // this.settings.updateSettings();\r\n                    // this.settings.applyAllSettings();\r\n                });\r\n            }\r\n        });\r\n    }\r\n}","// helpers.js - Settings utility functions and validation\r\n\r\nexport class SettingsHelpers {\r\n    constructor() {\r\n        this.monitorRefreshRate = 60; // Default refresh rate\r\n    }\r\n\r\n    /**\r\n     * Detects system capabilities for auto-configuration\r\n     */\r\n    detectSystemCapabilities() {\r\n        const performance = {};\r\n        \r\n        // Check device pixel ratio (higher on high-end devices)\r\n        performance.highDPI = window.devicePixelRatio > 1;\r\n        \r\n        // Check if WebGL2 is available\r\n        const canvas = document.createElement('canvas');\r\n        const gl = canvas.getContext('webgl2');\r\n        performance.webgl2 = !!gl;\r\n        \r\n        // Get GPU info if available\r\n        if (gl) {\r\n            const debugInfo = gl.getExtension('WEBGL_debug_renderer_info');\r\n            if (debugInfo) {\r\n                performance.gpu = gl.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL);\r\n            }\r\n        }\r\n        \r\n        // Check for recent browser features that suggest a modern device\r\n        performance.modernBrowser = \r\n            'IntersectionObserver' in window && \r\n            'requestAnimationFrame' in window &&\r\n            'localStorage' in window;\r\n            \r\n        // Make a recommendation based on the detected capabilities\r\n        if (performance.webgl2 && performance.highDPI && performance.modernBrowser) {\r\n            return 'high';\r\n        } else if (performance.webgl2 && performance.modernBrowser) {\r\n            return 'medium';\r\n        } else {\r\n            return 'low';\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Detects monitor refresh rate\r\n     */\r\n    detectMonitorRefreshRate() {\r\n        // Start with intelligent default based on common scenarios\r\n        this.monitorRefreshRate = 60;\r\n        \r\n        try {\r\n            // Method 1: Try modern Chrome API first (most reliable when available)\r\n            if ('getScreenDetails' in window && window.getScreenDetails) {\r\n                window.getScreenDetails().then(details => {\r\n                    if (details && details.currentScreen && details.currentScreen.refreshRate) {\r\n                        this.monitorRefreshRate = Math.round(details.currentScreen.refreshRate);\r\n                        console.log(`Using getScreenDetails API: ${this.monitorRefreshRate}Hz`);\r\n                        this.updateRefreshRateCallback?.();\r\n                    }\r\n                }).catch(err => {\r\n                    console.log(\"getScreenDetails not available, falling back to other methods\");\r\n                });\r\n            }\r\n            \r\n            // Method 2: Try screen.refresh (older API but sometimes available)\r\n            if (window.screen && typeof window.screen.refresh === 'number' && window.screen.refresh > 0) {\r\n                this.monitorRefreshRate = Math.round(window.screen.refresh);\r\n                console.log(`Using screen.refresh value: ${this.monitorRefreshRate}Hz`);\r\n                return; // Use this value immediately if available\r\n            }\r\n            \r\n            // Method 3: Quick synchronous measurement (first few frames)\r\n            const quickMeasure = this.quickRefreshRateMeasure();\r\n            if (quickMeasure > 0) {\r\n                this.monitorRefreshRate = quickMeasure;\r\n                console.log(`Quick measure refresh rate: ${this.monitorRefreshRate}Hz`);\r\n            }\r\n            \r\n            // Method 4: Start accurate async measurement for refinement\r\n            this.startAccurateRefreshDetection();\r\n            \r\n        } catch (error) {\r\n            console.warn(\"Error detecting refresh rate:\", error);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Quick refresh rate measurement\r\n     */\r\n    quickRefreshRateMeasure() {\r\n        // Check if we have screen refresh rate available\r\n        if (window.screen && typeof window.screen.refresh === 'number' && window.screen.refresh > 0) {\r\n            return Math.round(window.screen.refresh);\r\n        }\r\n        \r\n        // Check common indicators for high refresh displays\r\n        const userAgent = navigator.userAgent.toLowerCase();\r\n        const isGaming = userAgent.includes('gaming') || userAgent.includes('rog');\r\n        const isHighEnd = window.screen && window.screen.width > 2560;\r\n        \r\n        // Make educated guess based on device\r\n        const isMobile = /Mobi|Android/i.test(navigator.userAgent);\r\n        if (isMobile) {\r\n            return 60; // Most mobile devices are 60Hz\r\n        } else if (isGaming || isHighEnd) {\r\n            return 144; // Assume high refresh for gaming systems\r\n        }\r\n        \r\n        // Default to 60Hz for standard displays\r\n        return 60;\r\n    }\r\n\r\n    /**\r\n     * Starts accurate refresh rate detection over time\r\n     */\r\n    startAccurateRefreshDetection() {\r\n        let warmupFrames = 5; // Skip initial irregular frames\r\n        let frameCount = 0;\r\n        const timestamps = [];\r\n        const startTime = performance.now();\r\n        \r\n        const detectFrame = (timestamp) => {\r\n            frameCount++;\r\n            \r\n            // Skip warmup frames\r\n            if (frameCount <= warmupFrames) {\r\n                requestAnimationFrame(detectFrame);\r\n                return;\r\n            }\r\n            \r\n            timestamps.push(timestamp);\r\n            \r\n            // Collect for 1 second or 120 frames\r\n            if (timestamps.length < 120 && performance.now() - startTime < 1000) {\r\n                requestAnimationFrame(detectFrame);\r\n            } else {\r\n                this.processRefreshRateSamples(timestamps);\r\n            }\r\n        };\r\n        \r\n        requestAnimationFrame(detectFrame);\r\n    }\r\n\r\n    /**\r\n     * Processes refresh rate samples to determine accurate rate\r\n     */\r\n    processRefreshRateSamples(timestamps) {\r\n        if (timestamps.length < 2) return;\r\n        \r\n        const intervals = [];\r\n        for (let i = 1; i < timestamps.length; i++) {\r\n            const delta = timestamps[i] - timestamps[i-1];\r\n            if (delta > 0) {\r\n                intervals.push(1000 / delta);\r\n            }\r\n        }\r\n        \r\n        if (intervals.length === 0) return;\r\n        \r\n        // Remove outliers using IQR method\r\n        intervals.sort((a, b) => a - b);\r\n        const q1 = intervals[Math.floor(intervals.length * 0.25)];\r\n        const q3 = intervals[Math.floor(intervals.length * 0.75)];\r\n        const iqr = q3 - q1;\r\n        \r\n        const validRates = intervals.filter(rate => \r\n            rate >= q1 - 1.5 * iqr && rate <= q3 + 1.5 * iqr\r\n        );\r\n        \r\n        if (validRates.length > 0) {\r\n            const avg = validRates.reduce((a, b) => a + b, 0) / validRates.length;\r\n            const newRate = this.roundToCommonRefreshRate(avg);\r\n            \r\n            // Only update if significantly different\r\n            if (Math.abs(newRate - this.monitorRefreshRate) >= 5) {\r\n                console.log(`Refined refresh rate: ${this.monitorRefreshRate}Hz -> ${newRate}Hz`);\r\n                this.monitorRefreshRate = newRate;\r\n                \r\n                // Notify callback if set\r\n                this.updateRefreshRateCallback?.();\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Rounds measured rate to common refresh rates\r\n     */\r\n    roundToCommonRefreshRate(rate) {\r\n        // Common refresh rates in 2024\r\n        const commonRates = [24, 30, 48, 50, 60, 72, 75, 90, 100, 120, 144, 165, 180, 240, 360, 480];\r\n        \r\n        let closest = 60;\r\n        let minDiff = Math.abs(rate - 60);\r\n        \r\n        for (const commonRate of commonRates) {\r\n            const diff = Math.abs(rate - commonRate);\r\n            if (diff < minDiff) {\r\n                minDiff = diff;\r\n                closest = commonRate;\r\n            }\r\n        }\r\n        \r\n        // Only accept if within 10% of a common rate\r\n        if (minDiff / closest < 0.1) {\r\n            return closest;\r\n        }\r\n        \r\n        return Math.round(rate); // Return raw rate if no close match\r\n    }\r\n\r\n    /**\r\n     * Gets the current monitor refresh rate\r\n     */\r\n    getMonitorRefreshRate() {\r\n        return this.monitorRefreshRate;\r\n    }\r\n\r\n    /**\r\n     * Sets a callback to be called when refresh rate is updated\r\n     */\r\n    setRefreshRateUpdateCallback(callback) {\r\n        this.updateRefreshRateCallback = callback;\r\n    }\r\n\r\n    /**\r\n     * Validates a settings object\r\n     */\r\n    validateSettings(settings) {\r\n        const validationRules = {\r\n            graphicalQuality: ['low', 'medium', 'high'],\r\n            asteroidDetail: ['low', 'medium', 'high'],\r\n            lightingQuality: ['low', 'medium', 'high'],\r\n            particleEffects: ['low', 'medium', 'high'],\r\n            resolutionScale: ['low', 'medium', 'high'],\r\n            frameRateCap: ['30', '60', 'auto', '0'],\r\n            godRaysType: ['standard', 'claude']\r\n        };\r\n\r\n        const errors = [];\r\n\r\n        // Validate enum values\r\n        for (const [key, validValues] of Object.entries(validationRules)) {\r\n            if (settings[key] && !validValues.includes(settings[key])) {\r\n                errors.push(`Invalid value for ${key}: ${settings[key]}`);\r\n            }\r\n        }\r\n\r\n        // Validate boolean values\r\n        const booleanSettings = ['postProcessing', 'showFPS', 'spatialAudio', 'autoQuality', 'godRaysEnabled'];\r\n        booleanSettings.forEach(key => {\r\n            if (settings[key] !== undefined && typeof settings[key] !== 'boolean') {\r\n                errors.push(`Invalid value for ${key}: must be boolean`);\r\n            }\r\n        });\r\n\r\n        return {\r\n            isValid: errors.length === 0,\r\n            errors\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Gets performance recommendation based on system capabilities\r\n     */\r\n    getPerformanceRecommendation() {\r\n        const capability = this.detectSystemCapabilities();\r\n        \r\n        const recommendations = {\r\n            low: {\r\n                graphicalQuality: 'low',\r\n                postProcessing: false,\r\n                asteroidDetail: 'low',\r\n                lightingQuality: 'low',\r\n                particleEffects: 'low',\r\n                resolutionScale: 'low',\r\n                frameRateCap: '30',\r\n                godRaysEnabled: false\r\n            },\r\n            medium: {\r\n                graphicalQuality: 'medium',\r\n                postProcessing: true,\r\n                asteroidDetail: 'medium',\r\n                lightingQuality: 'medium',\r\n                particleEffects: 'medium',\r\n                resolutionScale: 'medium',\r\n                frameRateCap: '60',\r\n                godRaysEnabled: true,\r\n                godRaysType: 'standard'\r\n            },\r\n            high: {\r\n                graphicalQuality: 'high',\r\n                postProcessing: true,\r\n                asteroidDetail: 'high',\r\n                lightingQuality: 'high',\r\n                particleEffects: 'high',\r\n                resolutionScale: 'high',\r\n                frameRateCap: 'auto',\r\n                godRaysEnabled: true,\r\n                godRaysType: 'claude'\r\n            }\r\n        };\r\n\r\n        return recommendations[capability] || recommendations.medium;\r\n    }\r\n\r\n    /**\r\n     * Formats settings for display\r\n     */\r\n    formatSettingsForDisplay(settings) {\r\n        const formatted = {};\r\n        \r\n        for (const [key, value] of Object.entries(settings)) {\r\n            if (typeof value === 'boolean') {\r\n                formatted[key] = value ? 'Enabled' : 'Disabled';\r\n            } else if (key === 'frameRateCap') {\r\n                if (value === '0') {\r\n                    formatted[key] = 'Unlimited';\r\n                } else if (value === 'auto') {\r\n                    formatted[key] = `Monitor Refresh Rate (${this.monitorRefreshRate}Hz)`;\r\n                } else {\r\n                    formatted[key] = `${value} FPS`;\r\n                }\r\n            } else {\r\n                formatted[key] = value.charAt(0).toUpperCase() + value.slice(1);\r\n            }\r\n        }\r\n        \r\n        return formatted;\r\n    }\r\n\r\n    /**\r\n     * Calculates estimated performance impact of settings\r\n     */\r\n    calculatePerformanceImpact(settings) {\r\n        let impact = 0;\r\n        \r\n        // Quality settings impact\r\n        const qualityMap = { low: 1, medium: 2, high: 3 };\r\n        impact += qualityMap[settings.graphicalQuality] || 2;\r\n        impact += qualityMap[settings.asteroidDetail] || 2;\r\n        impact += qualityMap[settings.lightingQuality] || 2;\r\n        impact += qualityMap[settings.particleEffects] || 2;\r\n        impact += qualityMap[settings.resolutionScale] || 2;\r\n        \r\n        // Boolean settings impact\r\n        if (settings.postProcessing) impact += 1;\r\n        if (settings.godRaysEnabled) impact += 2;\r\n        \r\n        // Normalize to 0-100 scale\r\n        const maxImpact = 17; // Maximum possible impact\r\n        return Math.round((impact / maxImpact) * 100);\r\n    }\r\n}","// settings.js - Handles game settings and performance options\r\n\r\nimport { MobileDetector } from '../../utils/mobileDetector.js';\r\nimport { SettingsStyles } from './components/settings/styles.js';\r\nimport { AudioSettings } from './components/settings/audioSettings.js';\r\nimport { GraphicsSettings } from './components/settings/graphicsSettings.js';\r\nimport { SettingsView } from './components/settings/settingsView.js';\r\nimport { SettingsPersistence } from './components/settings/persistence.js';\r\nimport { SettingsEventHandlers } from './components/settings/eventHandlers.js';\r\nimport { SettingsHelpers } from './components/settings/helpers.js';\r\n\r\nexport class Settings {\r\n    constructor(game) {\r\n        this.game = game;\r\n        this.stargateInterface = null;\r\n        this.isVisible = false;\r\n        this.isMobile = MobileDetector.isMobile();\r\n        \r\n        console.log(\"Settings constructor - isMobile:\", this.isMobile);\r\n        \r\n        // Initialize submodules\r\n        this.styles = new SettingsStyles(this.isMobile);\r\n        this.helpers = new SettingsHelpers();\r\n        this.persistence = new SettingsPersistence();\r\n        this.graphicsSettings = new GraphicsSettings(this.game, this.styles);\r\n        this.audioSettings = new AudioSettings(this.game, this.styles);\r\n        this.settingsView = new SettingsView(this.styles, this.graphicsSettings, this.audioSettings, this.helpers);\r\n        this.eventHandlers = new SettingsEventHandlers(this, this.isMobile);\r\n        \r\n        // Set up refresh rate callback\r\n        this.helpers.setRefreshRateUpdateCallback(() => {\r\n            this.settingsView.updateRefreshRateDisplay(this.helpers.getMonitorRefreshRate());\r\n        });\r\n        \r\n        // Detect monitor refresh rate\r\n        this.helpers.detectMonitorRefreshRate();\r\n        \r\n        // Load settings from localStorage if available\r\n        this.settings = this.persistence.loadSettings();\r\n        \r\n        // Create settings UI\r\n        this.setupSettingsUI();\r\n        \r\n        // Apply initial settings\r\n        this.applyAllSettings();\r\n        \r\n        // Apply initial FPS display visibility\r\n        setTimeout(() => this.applyUISettings(), 100);\r\n    }\r\n    \r\n    setStargateInterface(stargateInterface) {\r\n        this.stargateInterface = stargateInterface;\r\n    }\r\n    \r\n    loadSettings() {\r\n        this.settings = this.persistence.loadSettings();\r\n    }\r\n    \r\n    saveSettings() {\r\n        this.persistence.saveSettings(this.settings);\r\n    }\r\n    \r\n    setupSettingsUI() {\r\n        // Create settings UI using the settings view\r\n        this.settingsView.createSettingsUI();\r\n        \r\n        // Add event listeners\r\n        this.eventHandlers.setupEventListeners();\r\n    }\r\n    \r\n    \r\n    updateSettings() {\r\n        // Read graphics settings\r\n        const graphicsSettings = this.graphicsSettings.readGraphicsSettings();\r\n        Object.assign(this.settings, graphicsSettings);\r\n        \r\n        // Read audio settings\r\n        const audioSettings = this.audioSettings.readAudioSettings();\r\n        Object.assign(this.settings, audioSettings);\r\n        \r\n        // Read performance settings\r\n        const frameRateCapElement = document.getElementById('frame-rate-cap');\r\n        const showFPSElement = document.getElementById('show-fps');\r\n        const autoQualityElement = document.getElementById('auto-quality');\r\n        \r\n        if (frameRateCapElement) this.settings.frameRateCap = frameRateCapElement.value;\r\n        if (showFPSElement) this.settings.showFPS = showFPSElement.checked;\r\n        if (autoQualityElement) this.settings.autoQuality = autoQualityElement.checked;\r\n    }\r\n    \r\n    updateUI() {\r\n        // Update graphics UI\r\n        this.graphicsSettings.updateGraphicsUI(this.settings);\r\n        \r\n        // Update audio UI\r\n        this.audioSettings.updateAudioUI(this.settings);\r\n        \r\n        // Update performance UI\r\n        const frameRateCapElement = document.getElementById('frame-rate-cap');\r\n        const showFPSElement = document.getElementById('show-fps');\r\n        const autoQualityElement = document.getElementById('auto-quality');\r\n        \r\n        if (frameRateCapElement) frameRateCapElement.value = this.settings.frameRateCap;\r\n        if (showFPSElement) showFPSElement.checked = this.settings.showFPS;\r\n        if (autoQualityElement) autoQualityElement.checked = this.settings.autoQuality;\r\n    }\r\n    \r\n    applyPreset(preset) {\r\n        console.log(`Applying ${preset} preset`);\r\n        \r\n        // Apply graphics preset\r\n        this.settings = this.graphicsSettings.applyGraphicsPreset(preset, this.settings);\r\n        \r\n        // Apply audio preset\r\n        this.settings = this.audioSettings.applyAudioPreset(preset, this.settings);\r\n        \r\n        // Apply performance preset\r\n        switch (preset) {\r\n            case 'performance':\r\n                this.settings.frameRateCap = '60'; // Cap at 60 FPS for better consistency\r\n                break;\r\n                \r\n            case 'balanced':\r\n                this.settings.frameRateCap = 'auto'; // Use monitor refresh rate\r\n                break;\r\n                \r\n            case 'quality':\r\n                this.settings.frameRateCap = '0'; // Unlimited\r\n                break;\r\n        }\r\n        \r\n        // Don't change auto quality and FPS display settings\r\n        \r\n        // Update the UI to reflect new settings\r\n        this.updateUI();\r\n        \r\n        // Show confirmation message\r\n        this.showSettingsApplied();\r\n    }\r\n    \r\n    applyAllSettings() {\r\n        if (!this.game) return;\r\n        \r\n        // Apply graphics settings\r\n        this.graphicsSettings.applyGraphicsSettings(this.settings);\r\n        \r\n        // Apply physics settings related to graphics\r\n        this.graphicsSettings.applyPhysicsSettings(this.settings);\r\n        \r\n        // Apply audio settings\r\n        this.audioSettings.applyAudioSettings(this.settings);\r\n        \r\n        // Apply UI settings\r\n        this.applyUISettings();\r\n        \r\n        console.log('All settings applied successfully');\r\n    }\r\n    \r\n    applyGraphicsSettings() {\r\n        if (!this.game) return;\r\n        \r\n        // Apply graphics settings\r\n        this.graphicsSettings.applyGraphicsSettings(this.settings);\r\n        \r\n        console.log('Graphics settings applied successfully');\r\n    }\r\n    \r\n    \r\n    applyUISettings() {\r\n        // Apply FPS counter setting - we'll use the existing HUD FPS display\r\n        const fpsElement = document.getElementById('fps-display');\r\n        if (fpsElement) {\r\n            if (this.settings.showFPS) {\r\n                // Show FPS display in HUD\r\n                fpsElement.style.display = 'block';\r\n                \r\n                // Update FPS immediately if we have a current value\r\n                if (this.game && this.game.currentFPS) {\r\n                    fpsElement.textContent = `FPS: ${Math.round(this.game.currentFPS)}`;\r\n                }\r\n            } else {\r\n                // Hide FPS display in HUD\r\n                fpsElement.style.display = 'none';\r\n            }\r\n        } else {\r\n            console.warn(\"FPS display element not found in HUD. It should have ID 'fps-display'\");\r\n        }\r\n        \r\n        // Update frame rate cap in game\r\n        if (this.game) {\r\n            const oldCap = this.game.frameRateCap;\r\n            const monitorRefreshRate = this.helpers.getMonitorRefreshRate();\r\n            \r\n            // Handle auto (monitor refresh rate) setting\r\n            if (this.settings.frameRateCap === 'auto') {\r\n                // If refresh rate is over 65Hz, set to unlimited (0)\r\n                if (monitorRefreshRate > 65) {\r\n                    this.game.frameRateCap = 0;\r\n                    console.log(`Using unlimited frame rate (refresh rate ${monitorRefreshRate}Hz > 65Hz)`);\r\n                } else {\r\n                    this.game.frameRateCap = monitorRefreshRate;\r\n                    console.log(`Setting frame rate cap to monitor refresh rate: ${monitorRefreshRate}Hz`);\r\n                }\r\n            } else {\r\n                // Use the selected numeric value\r\n                this.game.frameRateCap = parseInt(this.settings.frameRateCap) || 0;\r\n            }\r\n            \r\n            // Only reset timing when changing from unlimited to limited or vice versa\r\n            // This prevents disrupting the animation loop when just changing cap values\r\n            if ((oldCap === 0 && this.game.frameRateCap > 0) || \r\n                (oldCap > 0 && this.game.frameRateCap === 0)) {\r\n                this.game.lastFrameTime = 0;\r\n            }\r\n            \r\n            console.log(`Frame rate cap changed from ${oldCap} to ${this.game.frameRateCap}`);\r\n        }\r\n    }\r\n    \r\n    showSettingsApplied() {\r\n        this.settingsView.showSettingsApplied();\r\n    }\r\n    \r\n    show() {\r\n        // Update UI to reflect current settings\r\n        this.updateUI();\r\n        \r\n        // Show settings\r\n        if (this.settingsView.show()) {\r\n            this.isVisible = true;\r\n        }\r\n    }\r\n    \r\n    hide() {\r\n        if (this.settingsView.hide()) {\r\n            this.isVisible = false;\r\n            \r\n            // Show the stargate UI when returning from settings\r\n            if (this.stargateInterface) {\r\n                this.stargateInterface.showStargateUI();\r\n            }\r\n        }\r\n    }\r\n    \r\n    toggle() {\r\n        if (this.isVisible) {\r\n            this.hide();\r\n        } else {\r\n            this.show();\r\n        }\r\n    }\r\n} ","// startScreen.js - Manages the game's start screen UI\r\n\r\nexport class StartScreen {\r\n    constructor(game, ui) {\r\n        this.game = game;\r\n        this.ui = ui;\r\n        this.isVisible = false;\r\n        this.setupStartScreen();\r\n    }\r\n\r\n    setupStartScreen() {\r\n        // Create start screen container\r\n        const startScreen = document.createElement('div');\r\n        startScreen.id = 'start-screen';\r\n        startScreen.className = 'start-screen';\r\n        startScreen.style.display = 'none';\r\n\r\n        // Add content to start screen\r\n        startScreen.innerHTML = `\r\n            <div class=\"start-screen-inner\">\r\n                <h1 class=\"game-title\">Solar System Asteroid Miner</h1>\r\n                <div class=\"button-container\">\r\n                    <button id=\"play-button\" class=\"start-button\">Play</button>\r\n                    <button id=\"how-to-play-button\" class=\"start-button\">How to Play</button>\r\n                </div>\r\n                <div class=\"version\">v0.5.8</div>\r\n            </div>\r\n            \r\n            <div id=\"how-to-play-modal\" class=\"modal\">\r\n                <div class=\"modal-content\">\r\n                    <h2>How to Play</h2>\r\n                    \r\n                    <div class=\"gameplay-section\">\r\n                        <h3>Game Overview</h3>\r\n                        <p>Welcome to Solar System Asteroid Miner! Your mission is to mine asteroids, collect resources, and upgrade your ship.</p>\r\n                        \r\n                        <h4>Core Objectives:</h4>\r\n                        <ul>\r\n                            <li><strong>Mining:</strong> Target asteroids (E key), then use your mining laser (R key) to extract resources.</li>\r\n                            <li><strong>Trading:</strong> Dock at stargates (Q key) to sell resources and purchase ship upgrades.</li>\r\n                            <li><strong>Combat:</strong> Defend yourself against enemy ships using your weapons.</li>\r\n                            <li><strong>Exploration:</strong> Travel between star systems through stargates to discover new resources.</li>\r\n                            <li><strong>Anomalies:</strong> Find and collect energy orbs from space anomalies for credits.</li>\r\n                            <li><strong>Defense:</strong> Deploy autonomous laser turrets (T key) to protect mining operations.</li>\r\n                        </ul>\r\n                        \r\n                        <h4>Horde Mode:</h4>\r\n                        <p>Work toward activating the ultimate challenge - Horde Mode:</p>\r\n                        <ul>\r\n                            <li><strong>Endless Survival:</strong> Face waves of increasingly difficult enemies that never stop coming.</li>\r\n                            <li><strong>Escalating Difficulty:</strong> Enemy health, damage, speed, and spawn rates increase over time.</li>\r\n                            <li><strong>Preparation:</strong> Upgrade your ship's weapons, shields, and hull before activating.</li>\r\n                            <li><strong>Strategy:</strong> Deploy multiple laser turrets (T key) around your position to create defensive perimeters.</li>\r\n                            <li><strong>High Score:</strong> How long can you survive as difficulty scales to infinity?</li>\r\n                        </ul>\r\n                    </div>\r\n                    \r\n                    <div class=\"control-section\">\r\n                        <h3>Movement</h3>\r\n                        <div class=\"control-row\"><span class=\"key\">W</span> <span>Forward</span></div>\r\n                        <div class=\"control-row\"><span class=\"key\">S</span> <span>Backward</span></div>\r\n                        <div class=\"control-row\"><span class=\"key\">A</span> <span>Left</span></div>\r\n                        <div class=\"control-row\"><span class=\"key\">D</span> <span>Right</span></div>\r\n                        <div class=\"control-row\"><span class=\"key\">SHIFT</span> <span>Boost</span></div>\r\n                        <div class=\"control-row\"><span class=\"key\">Mouse</span> <span>Ship Rotation</span></div>\r\n                    </div>\r\n                    \r\n                    <div class=\"control-section\">\r\n                        <h3>Combat & Mining</h3>\r\n                        <div class=\"control-row\"><span class=\"key\">LMB</span> <span>Fire Weapons</span></div>\r\n                        <div class=\"control-row\"><span class=\"key\">E</span> <span>Toggle Target Lock-On</span></div>\r\n                        <div class=\"control-row\"><span class=\"key\">R</span> <span>Toggle Mining Laser</span></div>\r\n                        <div class=\"control-row\"><span class=\"key\">TAB</span> <span>Cycle Targets</span></div>\r\n                    </div>\r\n                    \r\n                    <div class=\"control-section\">\r\n                        <h3>Special</h3>\r\n                        <div class=\"control-row\"><span class=\"key\">T</span> <span>Deploy Laser Turret</span></div>\r\n                        <div class=\"control-row\"><span class=\"key\">Q</span> <span>Dock/Undock at Stargate</span></div>\r\n                        <div class=\"control-row\"><span class=\"key\">ESC</span> <span>Pause Game</span></div>\r\n                    </div>\r\n                    \r\n                    <button id=\"close-how-to-play\" class=\"modal-close-button\">Close</button>\r\n                </div>\r\n            </div>\r\n        `;\r\n\r\n        // Add to document body\r\n        document.body.appendChild(startScreen);\r\n\r\n        // Set up event listeners\r\n        this.setupEventListeners();\r\n    }\r\n\r\n    setupEventListeners() {\r\n        // Play button\r\n        const playButton = document.getElementById('play-button');\r\n        if (playButton) {\r\n            playButton.addEventListener('click', () => {\r\n                console.log(\"Play button clicked\");\r\n                console.log(\"Game object:\", this.game);\r\n                console.log(\"Game methods available:\", Object.getOwnPropertyNames(Object.getPrototypeOf(this.game)));\r\n                \r\n                this.hide();\r\n                // Check if intro has been played before\r\n                const introPlayed = localStorage.getItem('introPlayed') === 'true';\r\n                console.log(\"Intro played before:\", introPlayed);\r\n                \r\n                if (introPlayed) {\r\n                    // Returning player - go directly to docked state\r\n                    console.log(\"Starting game in docked state for returning player\");\r\n                    if (this.game && this.game.startDocked) {\r\n                        this.game.startDocked();\r\n                    } else {\r\n                        console.error(\"Game.startDocked not found\", this.game);\r\n                    }\r\n                } else {\r\n                    // New player - start intro sequence\r\n                    console.log(\"Starting intro sequence for new player\");\r\n                    if (this.game && this.game.startIntroSequence) {\r\n                        this.game.startIntroSequence();\r\n                    } else {\r\n                        console.error(\"Game.startIntroSequence not found\", this.game);\r\n                    }\r\n                }\r\n            });\r\n        }\r\n\r\n        // How to Play button\r\n        const howToPlayButton = document.getElementById('how-to-play-button');\r\n        const howToPlayModal = document.getElementById('how-to-play-modal');\r\n        const closeHowToPlayButton = document.getElementById('close-how-to-play');\r\n\r\n        if (howToPlayButton && howToPlayModal) {\r\n            howToPlayButton.addEventListener('click', () => {\r\n                howToPlayModal.style.display = 'flex';\r\n            });\r\n        }\r\n\r\n        if (closeHowToPlayButton && howToPlayModal) {\r\n            closeHowToPlayButton.addEventListener('click', () => {\r\n                howToPlayModal.style.display = 'none';\r\n            });\r\n\r\n            // Also close when clicking outside the modal content\r\n            howToPlayModal.addEventListener('click', (e) => {\r\n                if (e.target === howToPlayModal) {\r\n                    howToPlayModal.style.display = 'none';\r\n                }\r\n            });\r\n        }\r\n    }\r\n\r\n    show() {\r\n        const startScreen = document.getElementById('start-screen');\r\n        if (startScreen) {\r\n            startScreen.style.display = 'flex';\r\n            this.isVisible = true;\r\n            \r\n            // End timing for initialization when start screen becomes visible\r\n            if (window.initialTimestamp) {\r\n                const timeToStartScreen = performance.now() - window.initialTimestamp;\r\n                console.log(`Time to start screen visible: ${timeToStartScreen.toFixed(2)}ms`);\r\n                // Remove console.timeEnd since console.time was never called\r\n            }\r\n        }\r\n    }\r\n\r\n    hide() {\r\n        const startScreen = document.getElementById('start-screen');\r\n        if (startScreen) {\r\n            startScreen.style.display = 'none';\r\n            this.isVisible = false;\r\n        }\r\n\r\n        // Also hide How to Play modal if it's open\r\n        const howToPlayModal = document.getElementById('how-to-play-modal');\r\n        if (howToPlayModal) {\r\n            howToPlayModal.style.display = 'none';\r\n        }\r\n    }\r\n} ","// ui.js - Main UI class that integrates all UI components\r\n\r\nimport { HUD } from './ui/hud.js';\r\nimport { MobileHUD } from './ui/mobileHUD.js';\r\nimport { MiningDisplay } from './ui/miningDisplay.js';\r\nimport { TargetingUI } from './ui/targetingUI.js';\r\nimport { StargateInterface } from './ui/stargateInterface.js';\r\nimport { GameOverScreen } from './ui/gameOverScreen.js';\r\nimport { ControlsMenu } from './ui/controlsMenu.js';\r\nimport { StarMap } from './ui/starMap.js';\r\nimport { BlackjackGame } from './ui/blackjackGame.js';\r\nimport { Settings } from './ui/settings.js';\r\nimport { StartScreen } from './ui/startScreen.js';\r\nimport { MemoryStats } from '../utils/memoryManager.js';\r\nimport { MobileDetector } from '../utils/mobileDetector.js';\r\n\r\nexport class UI {\r\n    constructor(spaceship, environment) {\r\n        this.spaceship = spaceship;\r\n        this.environment = environment;\r\n        this.controls = null; // Will be set via setControls\r\n        this.audio = null; // Will be set via setAudio\r\n        this.isMobile = MobileDetector.isMobile();\r\n        \r\n        console.log(`Initializing UI components for ${this.isMobile ? 'mobile' : 'desktop'} device...`);\r\n        \r\n        // Load mobile CSS if on mobile device\r\n        if (this.isMobile) {\r\n            this.loadMobileCSS();\r\n        }\r\n        \r\n        // Initialize UI components\r\n        if (this.isMobile) {\r\n            this.hud = new MobileHUD(spaceship);\r\n        } else {\r\n            this.hud = new HUD(spaceship);\r\n        }\r\n        \r\n        this.miningDisplay = new MiningDisplay();\r\n        this.targetingUI = new TargetingUI();\r\n        this.stargateInterface = new StargateInterface();\r\n        this.gameOverScreen = new GameOverScreen();\r\n        this.controlsMenu = new ControlsMenu();\r\n        \r\n        // Initialize star map (requires environment, docking system, and stargate interface)\r\n        this.starMap = new StarMap(this.environment.starSystemGenerator, null, this.stargateInterface);\r\n        \r\n        // Initialize Blackjack game (will be fully initialized after audio is set)\r\n        this.blackjackGame = null;\r\n        \r\n        // Initialize settings (requires game instance)\r\n        this.settings = null;\r\n        \r\n        // Link starMap to stargateInterface\r\n        this.stargateInterface.setStarMap(this.starMap);\r\n        \r\n        // StartScreen will be initialized after game instance is available\r\n        this.startScreen = null;\r\n        \r\n        // Initialize performance monitoring if in debug mode\r\n        if (window.DEBUG_MODE) {\r\n            this.initializePerformanceMonitor();\r\n        }\r\n        \r\n        console.log(\"UI components initialized\");\r\n    }\r\n    \r\n    loadMobileCSS() {\r\n        // Create link element for mobile CSS\r\n        const mobileCSS = document.createElement('link');\r\n        mobileCSS.rel = 'stylesheet';\r\n        mobileCSS.href = 'css/mobile.css';\r\n        mobileCSS.type = 'text/css';\r\n        \r\n        // Add to document head\r\n        document.head.appendChild(mobileCSS);\r\n        \r\n        console.log(\"Mobile CSS loaded\");\r\n    }\r\n    \r\n    setAudio(audio) {\r\n        console.log(\"Setting audio reference in UI\");\r\n        this.audio = audio;\r\n        \r\n        // Now that we have audio, initialize BlackjackGame\r\n        if (this.audio) {\r\n            // Make sure spaceship has cargo property\r\n            if (this.spaceship && !this.spaceship.cargo) {\r\n                this.spaceship.cargo = { iron: 0, gold: 0, platinum: 0 };\r\n                console.warn(\"UI: Created empty cargo object for spaceship\");\r\n            }\r\n            \r\n            this.blackjackGame = new BlackjackGame(null, this.spaceship, this.audio);\r\n            console.log(\"UI: Created BlackjackGame with spaceship:\", this.spaceship);\r\n            \r\n            // Link blackjackGame to stargateInterface\r\n            this.stargateInterface.setBlackjackGame(this.blackjackGame);\r\n        }\r\n    }\r\n    \r\n    setControls(controls) {\r\n        console.log(\"Setting controls reference in UI\");\r\n        this.controls = controls;\r\n        \r\n        // Now that we have controls, we can set it in components that need it\r\n        if (this.miningDisplay.setControls) {\r\n            this.miningDisplay.setControls(this.controls);\r\n        }\r\n        \r\n        // Set controls in the mobile HUD if we're on mobile\r\n        if (this.isMobile && this.hud && this.hud.setControls) {\r\n            this.hud.setControls(this.controls);\r\n        }\r\n        \r\n        // Update star map with docking system\r\n        if (this.starMap && this.controls.dockingSystem) {\r\n            this.starMap.dockingSystem = this.controls.dockingSystem;\r\n        }\r\n        \r\n        // Set up button handlers\r\n        this.setupEventHandlers();\r\n    }\r\n    \r\n    // Initialize settings with the game instance\r\n    initializeSettings(game) {\r\n        if (!game) {\r\n            console.error(\"Cannot initialize settings without game instance\");\r\n            return;\r\n        }\r\n        \r\n        // Create settings\r\n        this.settings = new Settings(game);\r\n        \r\n        // Link settings to stargateInterface\r\n        this.stargateInterface.setSettings(this.settings);\r\n        \r\n        // Initialize start screen now that we have game instance\r\n        this.startScreen = new StartScreen(game, this);\r\n        \r\n        console.log(\"Settings and StartScreen initialized with game instance\");\r\n    }\r\n    \r\n    /**\r\n     * Set up event handlers\r\n     */\r\n    setupEventHandlers() {\r\n        console.log(\"Setting up UI event handlers\");\r\n        \r\n        // Set up controls menu button handler\r\n        if (this.controlsMenu && this.controlsMenu.setupButtonHandler) {\r\n            this.controlsMenu.setupButtonHandler();\r\n        }\r\n        \r\n        // Set up stargate UI control handlers if controls are available\r\n        if (this.controls && this.controls.setupStargateUIControls) {\r\n            this.controls.setupStargateUIControls();\r\n        }\r\n        \r\n        // Listen for UI notification events\r\n        window.mainMessageBus.subscribe('ui.notification', this.handleNotification.bind(this));\r\n        \r\n        // Add resize handler to update mobile detection\r\n        window.addEventListener('resize', () => {\r\n            const wasMobile = this.isMobile;\r\n            this.isMobile = MobileDetector.isMobile();\r\n            \r\n            // If device type changed, reload the page to apply correct UI\r\n            if (wasMobile !== this.isMobile) {\r\n                console.log(`Device type changed from ${wasMobile ? 'mobile' : 'desktop'} to ${this.isMobile ? 'mobile' : 'desktop'}`);\r\n                location.reload();\r\n            }\r\n        });\r\n    }\r\n    \r\n    /**\r\n     * Handle UI notification events\r\n     * @param {Object} message The notification message\r\n     */\r\n    handleNotification(message) {\r\n        if (message && message.data) {\r\n            const content = message.data.message || 'System notification';\r\n            const duration = message.data.duration || 3000;\r\n            this.showNotification(content, duration);\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Handle game over event\r\n     * @param {Object} message Event data\r\n     */\r\n    handleGameOver(message) {\r\n        // ... existing code ...\r\n    }\r\n    \r\n    update() {\r\n        // Update appropriate HUD based on device type\r\n        if (this.hud && this.hud.update) {\r\n            this.hud.update();\r\n        }\r\n        \r\n        if (this.miningDisplay && this.miningDisplay.update) {\r\n            this.miningDisplay.update();\r\n        }\r\n        \r\n        // Update touch controls if on mobile\r\n        if (this.isMobile && this.controls && this.controls.touchControls) {\r\n            this.controls.touchControls.update();\r\n        }\r\n    }\r\n    \r\n    updateLocation(locationName) {\r\n        // Get the current star system name from the environment\r\n        let systemName = 'Unknown System';\r\n        if (this.environment && this.environment.starSystemGenerator) {\r\n            const systemData = this.environment.starSystemGenerator.getCurrentSystemData();\r\n            systemName = systemData ? systemData.name : 'Unknown System';\r\n        }\r\n        \r\n        if (this.hud && this.hud.updateLocation) {\r\n            // Only pass the system name since we removed the location display\r\n            this.hud.updateLocation(null, systemName);\r\n        }\r\n    }\r\n    \r\n    updateCoordinates(x, y, z) {\r\n        if (this.hud && this.hud.updateCoordinates) {\r\n            this.hud.updateCoordinates(x, y, z);\r\n        }\r\n    }\r\n    \r\n    updateFPS(fps, cap) {\r\n        if (this.hud && this.hud.updateFPS) {\r\n            // Pass both actual FPS and cap to HUD\r\n            this.hud.updateFPS(fps, cap);\r\n            \r\n            // Control visibility of FPS display based on settings\r\n            if (this.settings && this.settings.settings) {\r\n                const fpsDisplay = document.getElementById('fps-display');\r\n                if (fpsDisplay) {\r\n                    fpsDisplay.style.display = this.settings.settings.showFPS ? 'block' : 'none';\r\n                }\r\n            }\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Show a notification message to the user\r\n     * @param {string} message - The message to display\r\n     * @param {number} duration - Time in milliseconds to show the notification\r\n     */\r\n    showNotification(message, duration = 3000) {\r\n        const notificationsArea = document.getElementById('notifications-area');\r\n        if (!notificationsArea) return;\r\n        \r\n        const notification = document.createElement('div');\r\n        notification.className = 'notification';\r\n        notification.textContent = message;\r\n        notification.style.backgroundColor = 'rgba(6, 22, 31, 0.7)';\r\n        notification.style.backdropFilter = 'blur(5px)';\r\n        notification.style.color = 'rgba(120, 220, 232, 0.9)';\r\n        notification.style.padding = '8px 15px';\r\n        notification.style.borderRadius = '5px';\r\n        notification.style.marginBottom = '10px';\r\n        notification.style.border = '1px solid rgba(120, 220, 232, 0.3)';\r\n        notification.style.boxShadow = '0 0 10px rgba(120, 220, 232, 0.2)';\r\n        notification.style.textAlign = 'center';\r\n        notification.style.opacity = '0';\r\n        notification.style.transition = 'opacity 0.3s';\r\n        \r\n        notificationsArea.appendChild(notification);\r\n        \r\n        // Fade in\r\n        setTimeout(() => {\r\n            notification.style.opacity = '1';\r\n        }, 10);\r\n        \r\n        // Fade out and remove after duration\r\n        setTimeout(() => {\r\n            notification.style.opacity = '0';\r\n            setTimeout(() => {\r\n                if (notification.parentNode) {\r\n                    notification.parentNode.removeChild(notification);\r\n                }\r\n            }, 300);\r\n        }, duration);\r\n    }\r\n    \r\n    showGameOver(resources, message) {\r\n        console.log(\"Showing game over screen\");\r\n        console.log(\"Resources data:\", resources); // Add logging to see structure\r\n        \r\n        // Show game over screen\r\n        if (this.gameOverScreen && this.gameOverScreen.show) {\r\n            // Make sure element exists in DOM first\r\n            if (!document.getElementById('game-over-container')) {\r\n                console.warn(\"Game over container not found in DOM, recreating\");\r\n                this.gameOverScreen.setupGameOverScreen();\r\n            }\r\n            \r\n            // Pass the audio reference to the game over screen\r\n            if (this.audio) {\r\n                this.gameOverScreen.audio = this.audio;\r\n            }\r\n            \r\n            // Pass the message object through directly - gameOverScreen will handle the parsing\r\n            this.gameOverScreen.show(resources, message);\r\n            \r\n            // Remove all direct sound playback from here\r\n            // The GameOverScreen will handle playing the sound\r\n        } else {\r\n            console.error(\"Game over screen not properly initialized\");\r\n            // Create a very simple fallback\r\n            const fallbackOverlay = document.createElement('div');\r\n            fallbackOverlay.id = 'fallback-overlay';\r\n            fallbackOverlay.style.position = 'fixed';\r\n            fallbackOverlay.style.top = '0';\r\n            fallbackOverlay.style.left = '0';\r\n            fallbackOverlay.style.width = '100%';\r\n            fallbackOverlay.style.height = '100%';\r\n            fallbackOverlay.style.backgroundColor = 'rgba(0, 0, 0, 0.8)';\r\n            fallbackOverlay.style.display = 'flex';\r\n            fallbackOverlay.style.justifyContent = 'center';\r\n            fallbackOverlay.style.alignItems = 'center';\r\n            fallbackOverlay.style.zIndex = '9999';\r\n            \r\n            // Extract message text if it's an object\r\n            const messageText = typeof message === 'string' ? message : \r\n                               (message && message.data && message.data.reason ? message.data.reason : \r\n                                'Your ship was destroyed!');\r\n            \r\n            const content = document.createElement('div');\r\n            content.innerHTML = `\r\n                <h1 style=\"color: #ff3030; font-size: 48px; margin-bottom: 20px;\">GAME OVER</h1>\r\n                <p style=\"color: #fff; font-size: 24px; margin-bottom: 30px;\">${messageText}</p>\r\n                <button id=\"restart-btn\" style=\"padding: 15px 30px; background-color: #ff3030; color: #fff; border: none; \r\n                    font-size: 24px; cursor: pointer; border-radius: 5px;\">RESTART GAME</button>\r\n            `;\r\n            fallbackOverlay.appendChild(content);\r\n            document.body.appendChild(fallbackOverlay);\r\n            \r\n            // Add restart button handler\r\n            document.getElementById('restart-btn').addEventListener('click', () => {\r\n                location.reload();\r\n            });\r\n        }\r\n        \r\n        // Hide other UI elements\r\n        this.hideUI();\r\n    }\r\n    \r\n    hideUI() {\r\n        console.log(\"Hiding UI elements\");\r\n        \r\n        // Force hide ALL UI elements during intro sequence\r\n        if (window.game && window.game.introSequenceActive) {\r\n            console.log(\"Intro sequence active - forcing ALL UI elements to be hidden\");\r\n            \r\n            // Get references to each UI element we need to hide\r\n            const elements = [\r\n                document.getElementById('hud-container'),\r\n                document.getElementById('mobile-hud-container'),\r\n                document.getElementById('pointer-lock-instructions'),\r\n                document.getElementById('notifications-area')\r\n            ];\r\n            \r\n            // Hide each found element (being careful to check if it exists)\r\n            elements.forEach(element => {\r\n                if (element) {\r\n                    element.style.display = 'none';\r\n                }\r\n            });\r\n            \r\n            // Hide any additional UI panels that might be visible\r\n            const allPanels = document.querySelectorAll('.ui-panel, .panel, .hud-panel, .status-panel');\r\n            allPanels.forEach(panel => {\r\n                panel.style.display = 'none';\r\n            });\r\n            \r\n            return; // Skip standard hiding - we've handled everything\r\n        }\r\n        \r\n        // Standard UI hiding for non-intro cases\r\n        // Hide main UI elements but not game over screen\r\n        if (this.hud && this.hud.hide) {\r\n            this.hud.hide();\r\n        }\r\n        \r\n        if (this.miningDisplay && this.miningDisplay.hide) {\r\n            this.miningDisplay.hide();\r\n        }\r\n        \r\n        if (this.targetingUI && this.targetingUI.hideLockOn) {\r\n            this.targetingUI.hideLockOn();\r\n        }\r\n        \r\n        if (this.targetingUI && this.targetingUI.hideTargetInfo) {\r\n            this.targetingUI.hideTargetInfo();\r\n        }\r\n        \r\n        if (this.stargateInterface && this.stargateInterface.hideDockingPrompt) {\r\n            this.stargateInterface.hideDockingPrompt();\r\n        }\r\n        \r\n        // Hide touch controls if on mobile\r\n        if (this.isMobile && this.controls && this.controls.touchControls) {\r\n            this.controls.touchControls.hide();\r\n        }\r\n    }\r\n    \r\n    showUI() {\r\n        console.log(\"Showing UI elements\");\r\n        \r\n        // Don't show UI if intro sequence is active\r\n        if (window.game && window.game.introSequenceActive) {\r\n            console.warn(\"showUI called while intro is still active - not showing UI elements\");\r\n            return; // Exit early - don't show any UI during intro\r\n        }\r\n        \r\n        // Don't show UI if start screen is visible\r\n        if (this.startScreen && this.startScreen.isVisible) {\r\n            console.warn(\"showUI called while start screen is visible - not showing UI elements\");\r\n            return;\r\n        }\r\n        \r\n        // First, show UI components through their interfaces\r\n        if (this.hud && this.hud.show) {\r\n            console.log(\"Calling hud.show()\");\r\n            this.hud.show();\r\n        }\r\n        \r\n        if (this.miningDisplay && this.miningDisplay.show) {\r\n            this.miningDisplay.show();\r\n        }\r\n        \r\n        // Show touch controls if on mobile\r\n        if (this.isMobile && this.controls && this.controls.touchControls) {\r\n            this.controls.touchControls.show();\r\n        }\r\n        \r\n        // FORCE restore elements that might have been forcibly hidden\r\n        // But only if intro is not active\r\n        if (window.game && window.game.introSequenceActive) {\r\n            return; // Double-check intro is not active before forcing visibility\r\n        }\r\n        \r\n        console.log(\"Forcing all UI elements to be displayed\");\r\n        \r\n        // Ensure HUD container is visible\r\n        const hudContainer = document.getElementById('hud-container');\r\n        if (hudContainer) {\r\n            console.log(\"Setting hudContainer to display:block\");\r\n            hudContainer.style.display = 'block';\r\n            hudContainer.style.visibility = 'visible'; // Double ensure visibility\r\n        } else {\r\n            console.warn(\"HUD container not found - could not make visible\");\r\n        }\r\n        \r\n        // Ensure mobile HUD is visible if on mobile\r\n        const mobileHudContainer = document.getElementById('mobile-hud-container');\r\n        if (mobileHudContainer) {\r\n            mobileHudContainer.style.display = 'block';\r\n            mobileHudContainer.style.visibility = 'visible';\r\n        }\r\n        \r\n        // Show pointer lock instructions only if not locked\r\n        const pointerLockInstructions = document.getElementById('pointer-lock-instructions');\r\n        if (pointerLockInstructions && !document.pointerLockElement) {\r\n            pointerLockInstructions.style.display = 'block';\r\n            pointerLockInstructions.style.visibility = 'visible';\r\n        }\r\n        \r\n        // Show notifications area\r\n        const notificationsArea = document.getElementById('notifications-area');\r\n        if (notificationsArea) {\r\n            notificationsArea.style.display = 'block';\r\n            notificationsArea.style.visibility = 'visible';\r\n        }\r\n\r\n        // Also show any panels that might have been hidden (except target-info which should stay hidden)\r\n        const allPanels = document.querySelectorAll('.ui-panel, .panel, .hud-panel, .status-panel');\r\n        allPanels.forEach(panel => {\r\n            // Don't force target-info to be visible - let targeting system control it\r\n            if (panel.id !== 'target-info') {\r\n                panel.style.display = 'block';\r\n            }\r\n            panel.style.visibility = 'visible';\r\n        });\r\n    }\r\n    \r\n    /**\r\n     * Initialize performance monitor for debugging\r\n     */\r\n    initializePerformanceMonitor() {\r\n        // Create container for performance stats\r\n        const statsContainer = document.createElement('div');\r\n        statsContainer.id = 'performance-stats';\r\n        statsContainer.style.position = 'fixed';\r\n        statsContainer.style.bottom = '10px';\r\n        statsContainer.style.right = '10px';\r\n        statsContainer.style.backgroundColor = 'rgba(0, 0, 0, 0.7)';\r\n        statsContainer.style.color = '#0ff';\r\n        statsContainer.style.padding = '10px';\r\n        statsContainer.style.fontFamily = 'monospace';\r\n        statsContainer.style.fontSize = '12px';\r\n        statsContainer.style.borderRadius = '4px';\r\n        statsContainer.style.zIndex = '1000';\r\n        statsContainer.style.maxWidth = '300px';\r\n        statsContainer.style.maxHeight = '200px';\r\n        statsContainer.style.overflow = 'auto';\r\n        \r\n        // Memory stats container\r\n        const memoryStats = document.createElement('div');\r\n        memoryStats.id = 'memory-stats';\r\n        statsContainer.appendChild(memoryStats);\r\n        \r\n        // FPS counter\r\n        const fpsCounter = document.createElement('div');\r\n        fpsCounter.id = 'fps-counter';\r\n        statsContainer.appendChild(fpsCounter);\r\n        \r\n        // Add to DOM\r\n        document.body.appendChild(statsContainer);\r\n        \r\n        // Update stats every second\r\n        this.statsInterval = setInterval(() => {\r\n            // Update memory stats display\r\n            memoryStats.innerHTML = MemoryStats.getReport().replace(/\\n/g, '<br>');\r\n            \r\n            // Display current FPS if available\r\n            if (window.game && window.game.currentFPS) {\r\n                fpsCounter.innerHTML = `FPS: ${Math.round(window.game.currentFPS)}`;\r\n            }\r\n        }, 1000);\r\n    }\r\n    \r\n    // Make sure to clean up stats interval when necessary\r\n    onDisabled() {\r\n        // Clear stats interval if it exists\r\n        if (this.statsInterval) {\r\n            clearInterval(this.statsInterval);\r\n            this.statsInterval = null;\r\n        }\r\n    }\r\n} ","// context.js - Web Audio API context management and compatibility\r\nexport class AudioContext {\r\n    constructor() {\r\n        this.audioContext = null;\r\n        this.activeNodes = new Set();\r\n        this.gcInterval = null;\r\n        \r\n        this.initializeContext();\r\n        this.setupGarbageCollection();\r\n    }\r\n    \r\n    // Initialize Web Audio API context with compatibility\r\n    initializeContext() {\r\n        try {\r\n            this.audioContext = new (window.AudioContext || window.webkitAudioContext)();\r\n            console.log(\"Web Audio API context created successfully\");\r\n        } catch (error) {\r\n            console.error(\"Failed to create Web Audio API context:\", error);\r\n        }\r\n    }\r\n    \r\n    // Resume audio context on user interaction\r\n    resumeAudioContext() {\r\n        if (this.audioContext && this.audioContext.state === 'suspended') {\r\n            return this.audioContext.resume().then(() => {\r\n                console.log(\"AudioContext resumed successfully\");\r\n            }).catch(error => {\r\n                console.error(\"Failed to resume AudioContext:\", error);\r\n            });\r\n        }\r\n        return Promise.resolve();\r\n    }\r\n    \r\n    // Get the audio context instance\r\n    getContext() {\r\n        return this.audioContext;\r\n    }\r\n    \r\n    // Check if context is available and ready\r\n    isReady() {\r\n        return this.audioContext && this.audioContext.state !== 'closed';\r\n    }\r\n    \r\n    // Set up regular garbage collection for unused audio nodes\r\n    setupGarbageCollection() {\r\n        // Clean up inactive nodes every 30 seconds\r\n        this.gcInterval = setInterval(() => this.cleanupInactiveNodes(), 30000);\r\n        console.log(\"Audio garbage collection scheduled\");\r\n    }\r\n    \r\n    // Clean up inactive audio nodes to prevent memory leaks\r\n    cleanupInactiveNodes() {\r\n        let count = 0;\r\n        this.activeNodes.forEach(node => {\r\n            // Check if node is inactive\r\n            if (node._inactive || (node.disposed === true)) {\r\n                this.activeNodes.delete(node);\r\n                count++;\r\n            }\r\n        });\r\n        \r\n        if (count > 0) {\r\n            console.log(`Audio context: cleaned up ${count} inactive audio objects`);\r\n        }\r\n    }\r\n    \r\n    // Track an audio node for garbage collection\r\n    trackNode(node) {\r\n        if (node) {\r\n            this.activeNodes.add(node);\r\n        }\r\n        return node;\r\n    }\r\n    \r\n    // Initialize a minimal Tone.js compatibility layer for the intro sequence\r\n    initializeToneCompatibility() {\r\n        // Create a dummy masterEQ object that the intro sequence can connect to\r\n        // This allows the intro sequence code to remain unchanged\r\n        this.masterEQ = {\r\n            // Dummy connect method that returns the input\r\n            connect: function(node) {\r\n                return node;\r\n            }\r\n        };\r\n        \r\n        console.log(\"Audio compatibility layer initialized for intro sequence\");\r\n        return this.masterEQ;\r\n    }\r\n    \r\n    // Clean up context and resources\r\n    cleanup() {\r\n        console.log(\"Cleaning up AudioContext resources...\");\r\n        \r\n        // Clear intervals\r\n        if (this.gcInterval) {\r\n            clearInterval(this.gcInterval);\r\n            this.gcInterval = null;\r\n        }\r\n        \r\n        // Close audio context\r\n        if (this.audioContext) {\r\n            return this.audioContext.close().then(() => {\r\n                console.log(\"AudioContext closed successfully\");\r\n                this.audioContext = null;\r\n            }).catch(error => {\r\n                console.error(\"Error closing AudioContext:\", error);\r\n            });\r\n        }\r\n        \r\n        return Promise.resolve();\r\n    }\r\n}","// loader.js - Audio file loading, decoding, and caching\r\nimport { getAbsolutePath } from '../../../utils/pathUtils.js';\r\n\r\nexport class AudioLoader {\r\n    constructor(audioContextManager) {\r\n        this.audioContextManager = audioContextManager;\r\n        this.sounds = {}; // Stores decoded AudioBuffers\r\n    }\r\n    \r\n    // Helper method to handle paths correctly for both local and GitHub Pages deployment\r\n    getPath(relativePath) {\r\n        return getAbsolutePath(relativePath);\r\n    }\r\n    \r\n    // Load and decode a sound file using Web Audio API\r\n    async loadAndDecodeSound(name, url) {\r\n        try {\r\n            console.log(`Loading and decoding sound: ${name} from ${url}`);\r\n            \r\n            const audioContext = this.audioContextManager.getContext();\r\n            if (!audioContext) {\r\n                throw new Error(\"AudioContext not available\");\r\n            }\r\n            \r\n            // Fetch the audio file\r\n            const response = await fetch(url);\r\n            if (!response.ok) {\r\n                throw new Error(`Failed to fetch sound ${name}: ${response.status} ${response.statusText}`);\r\n            }\r\n            \r\n            // Get the audio data as an ArrayBuffer\r\n            const audioData = await response.arrayBuffer();\r\n            \r\n            // Decode the audio data\r\n            const audioBuffer = await audioContext.decodeAudioData(audioData);\r\n            \r\n            // Store the decoded buffer\r\n            this.sounds[name] = audioBuffer;\r\n            \r\n            console.log(`Sound ${name} loaded and decoded successfully`);\r\n            return audioBuffer;\r\n        } catch (error) {\r\n            console.error(`Error loading and decoding sound ${name}:`, error);\r\n            \r\n            // Create a dummy buffer for this sound to prevent errors\r\n            this.sounds[name] = null;\r\n            throw error;\r\n        }\r\n    }\r\n    \r\n    // Pre-decode only essential UI sounds for quick startup\r\n    async preDecodeEssentialSounds() {\r\n        try {\r\n            console.log(\"Pre-decoding essential UI sounds...\");\r\n            \r\n            // List of essential sounds needed for UI interaction\r\n            const essentialSounds = [\r\n                { name: 'boink', path: 'sounds/effects/boink.wav' },\r\n                { name: 'phaserUp', path: 'sounds/effects/phaserUp.wav' },\r\n                { name: 'phaserDown', path: 'sounds/effects/phaserDown.wav' },\r\n            ];\r\n            \r\n            // Create a promise for each sound to load\r\n            const loadPromises = essentialSounds.map(sound => \r\n                this.loadAndDecodeSound(sound.name, this.getPath(sound.path))\r\n            );\r\n            \r\n            // Wait for all essential sounds to be loaded and decoded\r\n            await Promise.all(loadPromises);\r\n            \r\n            console.log(\"Essential UI sounds pre-decoded successfully\");\r\n            \r\n        } catch (error) {\r\n            console.error(\"Error pre-decoding essential sounds:\", error);\r\n            this.createDummySounds();\r\n        }\r\n    }\r\n    \r\n    // Load remaining gameplay sounds in the background\r\n    async loadGameplaySounds() {\r\n        try {\r\n            console.log(\"Loading gameplay sounds in background...\");\r\n            \r\n            // List of gameplay sounds to load\r\n            const gameplaySounds = [\r\n                { name: 'thrust', path: 'sounds/effects/thrust.wav' },\r\n                { name: 'laser', path: 'sounds/effects/laser.wav' },\r\n                { name: 'mining-laser', path: 'sounds/effects/mining-laser.wav' },\r\n                { name: 'explosion', path: 'sounds/effects/explosion.wav' },\r\n            ];\r\n            \r\n            // Load sounds sequentially to avoid overwhelming the audio decoder\r\n            for (const sound of gameplaySounds) {\r\n                try {\r\n                    await this.loadAndDecodeSound(sound.name, this.getPath(sound.path));\r\n                } catch (err) {\r\n                    console.warn(`Could not load gameplay sound ${sound.name}:`, err);\r\n                }\r\n            }\r\n            \r\n            // Explicitly set up projectile sound using the laser sound\r\n            // This is needed for weapon firing\r\n            if (this.sounds.laser && !this.sounds.projectile) {\r\n                console.log(\"Setting up projectile sound using laser sound buffer\");\r\n                this.sounds.projectile = this.sounds.laser;\r\n            }\r\n            \r\n            console.log(\"All gameplay sounds loaded successfully\");\r\n        } catch (error) {\r\n            console.error(\"Error loading gameplay sounds:\", error);\r\n        }\r\n    }\r\n    \r\n    // Create dummy sounds if loading fails\r\n    createDummySounds() {\r\n        console.warn(\"Creating dummy silent AudioBuffers as fallback\");\r\n        \r\n        const soundEffects = ['laser', 'thrust', 'explosion', 'boink', 'phaserUp', 'phaserDown', 'mining-laser', 'projectile'];\r\n        const audioContext = this.audioContextManager.getContext();\r\n        \r\n        for (const name of soundEffects) {\r\n            // Create a silent buffer (0.1 seconds of silence)\r\n            if (audioContext) {\r\n                try {\r\n                    const buffer = audioContext.createBuffer(\r\n                        2, // stereo\r\n                        audioContext.sampleRate * 0.1, // 0.1 seconds\r\n                        audioContext.sampleRate\r\n                    );\r\n                    this.sounds[name] = buffer;\r\n                } catch (error) {\r\n                    console.error(`Failed to create dummy buffer for ${name}:`, error);\r\n                    this.sounds[name] = null;\r\n                }\r\n            } else {\r\n                this.sounds[name] = null;\r\n            }\r\n        }\r\n    }\r\n    \r\n    // Helper method to check if a file exists\r\n    async checkFileExists(path) {\r\n        console.log(`Checking if file/directory exists: ${path}`);\r\n        try {\r\n            // Try to fetch the resource\r\n            const response = await fetch(path, { \r\n                method: 'HEAD',\r\n                cache: 'no-cache' // Avoid caching issues\r\n            });\r\n            \r\n            console.log(`Fetch response for ${path}: status=${response.status}, ok=${response.ok}`);\r\n            \r\n            return { \r\n                path, \r\n                exists: response.ok \r\n            };\r\n        } catch (err) {\r\n            console.error(`Error checking if file exists (${path}):`, err);\r\n            return { path, exists: false };\r\n        }\r\n    }\r\n    \r\n    // Check if the required sound directories exist and notify user if they don't\r\n    async checkSoundDirectories() {\r\n        // Check for sounds directory\r\n        const soundsDirExists = await this.checkFileExists(this.getPath('sounds'));\r\n        if (!soundsDirExists.exists) {\r\n            console.warn(\"Sounds directory not found, but will attempt to load files directly anyway.\");\r\n        }\r\n        \r\n        // Check for soundtrack directory\r\n        const soundtrackDirExists = await this.checkFileExists(this.getPath('sounds/soundtrack'));\r\n        if (!soundtrackDirExists.exists) {\r\n            console.warn(\"Soundtrack directory not found, but will attempt to load files directly anyway.\");\r\n        }\r\n        \r\n        // Check for sound effects directory\r\n        const effectsDirExists = await this.checkFileExists(this.getPath('sounds/effects'));\r\n        if (!effectsDirExists.exists) {\r\n            console.warn(\"Sound effects directory not found. Some sounds may not play correctly.\");\r\n        }\r\n        \r\n        // Always return true to continue loading process\r\n        return true;\r\n    }\r\n    \r\n    // Get a loaded sound buffer\r\n    getSound(name) {\r\n        return this.sounds[name];\r\n    }\r\n    \r\n    // Get all loaded sounds\r\n    getAllSounds() {\r\n        return this.sounds;\r\n    }\r\n}","// playlist.js - Music queue management and shuffling\r\nimport { getAbsolutePath } from '../../../utils/pathUtils.js';\r\n\r\nexport class MusicPlaylist {\r\n    constructor() {\r\n        this.music = []; // Store all background music tracks\r\n        this.musicVolume = 0.21; // Reduced by 30% from 0.3\r\n    }\r\n    \r\n    // Helper method to handle paths correctly for both local and GitHub Pages deployment\r\n    getPath(relativePath) {\r\n        return getAbsolutePath(relativePath);\r\n    }\r\n    \r\n    // Fisher-Yates shuffle algorithm for arrays\r\n    shuffleArray(array) {\r\n        let currentIndex = array.length, randomIndex;\r\n        \r\n        // While there remain elements to shuffle\r\n        while (currentIndex > 0) {\r\n            // Pick a remaining element\r\n            randomIndex = Math.floor(Math.random() * currentIndex);\r\n            currentIndex--;\r\n            \r\n            // Swap it with the current element\r\n            [array[currentIndex], array[randomIndex]] = [array[randomIndex], array[currentIndex]];\r\n        }\r\n        \r\n        return array;\r\n    }\r\n    \r\n    // Helper method to check if a file exists\r\n    async checkFileExists(path) {\r\n        console.log(`Checking if file/directory exists: ${path}`);\r\n        try {\r\n            // Try to fetch the resource\r\n            const response = await fetch(path, { \r\n                method: 'HEAD',\r\n                cache: 'no-cache' // Avoid caching issues\r\n            });\r\n            \r\n            console.log(`Fetch response for ${path}: status=${response.status}, ok=${response.ok}`);\r\n            \r\n            return { \r\n                path, \r\n                exists: response.ok \r\n            };\r\n        } catch (err) {\r\n            console.error(`Error checking if file exists (${path}):`, err);\r\n            return { path, exists: false };\r\n        }\r\n    }\r\n    \r\n    // Load all music files from the soundtrack folder\r\n    async loadBackgroundMusic() {\r\n        try {\r\n            console.log(\"Loading soundtrack files...\");\r\n            \r\n            // Directly use the exact soundtrack files from the user's folder\r\n            const soundtrackFiles = [\r\n                this.getPath('sounds/soundtrack/The Sound of Lightyears.wav'),\r\n                this.getPath('sounds/soundtrack/Aurora Drifts.wav'),\r\n                this.getPath('sounds/soundtrack/Tidal Lock.wav'),\r\n                this.getPath('sounds/soundtrack/Solar Drift.wav'),\r\n                this.getPath('sounds/soundtrack/Orbital Resonance.wav'),\r\n                this.getPath('sounds/soundtrack/Starlight Trails.wav'),\r\n                this.getPath('sounds/soundtrack/Orbit Bloom.wav')\r\n            ];\r\n            \r\n            console.log(`Loading ${soundtrackFiles.length} soundtrack files...`);\r\n            \r\n            // Load the music files\r\n            await this.loadMusicFiles(soundtrackFiles);\r\n            \r\n        } catch (error) {\r\n            console.error(\"Error loading background music:\", error);\r\n            \r\n            // Create a dummy audio element if loading fails\r\n            console.warn(\"Falling back to a dummy silent track\");\r\n            const dummyAudio = new Audio();\r\n            dummyAudio.loop = true;\r\n            this.music.push(dummyAudio);\r\n        }\r\n    }\r\n    \r\n    // Helper method to load music files\r\n    async loadMusicFiles(files) {\r\n        // Note: Currently keeping music as HTML5 Audio for compatibility\r\n        // Could be updated to Web Audio API in the future\r\n        console.log(`Found ${files.length} music files:`, files);\r\n        \r\n        // Create a copy of the files array and shuffle it to randomize the order\r\n        const shuffledFiles = [...files];\r\n        this.shuffleArray(shuffledFiles);\r\n        \r\n        console.log(`Randomized playlist order:`, shuffledFiles.map(file => file.split('/').pop()));\r\n        \r\n        // Check if any files exist before trying to load them\r\n        let anyFilesExist = false;\r\n        for (const file of shuffledFiles) {\r\n            const fileExists = await this.checkFileExists(file);\r\n            if (fileExists.exists) {\r\n                anyFilesExist = true;\r\n                break;\r\n            }\r\n        }\r\n        \r\n        if (!anyFilesExist) {\r\n            console.warn(\"None of the music files could be found. Using fallback audio.\");\r\n            this.createDummyTrack();\r\n            return;\r\n        }\r\n        \r\n        // Load each music track in the randomized order\r\n        for (const file of shuffledFiles) {\r\n            try {\r\n                console.log(`Attempting to load audio file: ${file}`);\r\n                const audio = new Audio(file);\r\n                audio.loop = false; // We'll handle looping manually for playlist functionality\r\n                audio.volume = this.musicVolume;\r\n                \r\n                // Add error handler\r\n                audio.addEventListener('error', (e) => {\r\n                    console.error(`Error loading music file ${file}:`, e);\r\n                });\r\n                \r\n                // Add a load event to confirm successful loading\r\n                audio.addEventListener('canplaythrough', () => {\r\n                    console.log(`Successfully loaded music file: ${file}`);\r\n                });\r\n                \r\n                this.music.push(audio);\r\n                console.log(`Added music track to playlist: ${file}`);\r\n            } catch (err) {\r\n                console.error(`Failed to load music file ${file}:`, err);\r\n            }\r\n        }\r\n        \r\n        console.log(`Loaded ${this.music.length} music tracks in randomized order`);\r\n        \r\n        // If we haven't found any music, create a dummy audio element\r\n        // so that the music system doesn't break\r\n        if (this.music.length === 0) {\r\n            console.warn(\"No music files could be loaded, creating a dummy track\");\r\n            this.createDummyTrack();\r\n        }\r\n    }\r\n    \r\n    // Create dummy track if loading fails\r\n    createDummyTrack() {\r\n        const dummyAudio = new Audio();\r\n        dummyAudio.loop = true;\r\n        this.music.push(dummyAudio);\r\n    }\r\n    \r\n    // Play the next music track in the playlist\r\n    playNextTrack() {\r\n        if (this.music.length === 0) return null;\r\n        \r\n        // Move current track to the end of the playlist\r\n        const currentTrack = this.music.shift();\r\n        this.music.push(currentTrack);\r\n        \r\n        // Return the next track\r\n        return this.getCurrentTrack();\r\n    }\r\n    \r\n    // Get the current track (first in queue)\r\n    getCurrentTrack() {\r\n        return this.music.length > 0 ? this.music[0] : null;\r\n    }\r\n    \r\n    // Get all tracks\r\n    getTracks() {\r\n        return this.music;\r\n    }\r\n    \r\n    // Set volume for all tracks\r\n    setVolume(volume) {\r\n        this.musicVolume = volume;\r\n        for (const track of this.music) {\r\n            track.volume = volume;\r\n        }\r\n    }\r\n    \r\n    // Get current volume\r\n    getVolume() {\r\n        return this.musicVolume;\r\n    }\r\n    \r\n    // Check if playlist has tracks\r\n    hasTracks() {\r\n        return this.music.length > 0;\r\n    }\r\n}","// player.js - Music playback control and volume management\r\nexport class MusicPlayer {\r\n    constructor(playlist) {\r\n        this.playlist = playlist;\r\n        this.currentMusic = null;\r\n        this.muted = false;\r\n    }\r\n    \r\n    // Start playing background music\r\n    playBackgroundMusic(userHasInteracted) {\r\n        if (!this.playlist.hasTracks() || this.muted) return;\r\n        \r\n        // Only attempt to play if the user has interacted with the page\r\n        if (!userHasInteracted) {\r\n            console.log(\"Deferring music playback until user interaction\");\r\n            return;\r\n        }\r\n        \r\n        // Get the track at the front of the queue\r\n        const track = this.playlist.getCurrentTrack();\r\n        if (!track) return;\r\n        \r\n        console.log(`Starting to play track: ${track.src.split('/').pop()}`);\r\n        \r\n        // Set up ended event listener for this track if not already set\r\n        if (!track.hasEndedListener) {\r\n            track.addEventListener('ended', () => this.playNextTrack(userHasInteracted));\r\n            track.hasEndedListener = true;\r\n        }\r\n        \r\n        // Reset the track to the beginning\r\n        track.currentTime = 0;\r\n        \r\n        // Attempt to play the track\r\n        const playPromise = track.play();\r\n        \r\n        // Handle play promise (modern browsers return a promise from play())\r\n        if (playPromise !== undefined) {\r\n            playPromise\r\n                .then(() => {\r\n                    console.log(\"Started playing background music\");\r\n                    this.currentMusic = track;\r\n                })\r\n                .catch(err => {\r\n                    if (err.name === 'NotAllowedError') {\r\n                        console.log(\"Autoplay prevented by browser. Music will play after user interaction.\");\r\n                    } else {\r\n                        console.error(\"Error playing background music:\", err);\r\n                    }\r\n                });\r\n        } else {\r\n            this.currentMusic = track;\r\n        }\r\n    }\r\n    \r\n    // Play the next track in the playlist\r\n    playNextTrack(userHasInteracted) {\r\n        const nextTrack = this.playlist.playNextTrack();\r\n        if (nextTrack && userHasInteracted) {\r\n            this.playBackgroundMusic(userHasInteracted);\r\n        }\r\n    }\r\n    \r\n    // Toggle mute for music\r\n    toggleMute() {\r\n        this.muted = !this.muted;\r\n        \r\n        // Adjust music volume\r\n        const tracks = this.playlist.getTracks();\r\n        for (const track of tracks) {\r\n            track.volume = this.muted ? 0 : this.playlist.getVolume();\r\n        }\r\n        \r\n        console.log(`Music ${this.muted ? 'muted' : 'unmuted'}`);\r\n        return this.muted;\r\n    }\r\n    \r\n    // Set music volume\r\n    setVolume(volume) {\r\n        this.playlist.setVolume(this.muted ? 0 : volume);\r\n    }\r\n    \r\n    // Get current music volume\r\n    getVolume() {\r\n        return this.playlist.getVolume();\r\n    }\r\n    \r\n    // Check if music is muted\r\n    isMuted() {\r\n        return this.muted;\r\n    }\r\n    \r\n    // Pause all music\r\n    pauseAll() {\r\n        const tracks = this.playlist.getTracks();\r\n        for (const track of tracks) {\r\n            track.pause();\r\n        }\r\n        this.currentMusic = null;\r\n    }\r\n    \r\n    // Get current playing track\r\n    getCurrentTrack() {\r\n        return this.currentMusic;\r\n    }\r\n}","// soundPlayer.js - Sound effects playback with 3D audio and volume control\r\nexport class SoundPlayer {\r\n    constructor(audioContextManager, audioLoader) {\r\n        this.audioContextManager = audioContextManager;\r\n        this.audioLoader = audioLoader;\r\n        this.sfxVolume = 0.5; // Default sound effects volume\r\n        this.muted = false;\r\n        \r\n        // Track active continuous sounds\r\n        this.activeSounds = {\r\n            laser: null,\r\n            thrust: null,\r\n            \"mining-laser\": null\r\n        };\r\n    }\r\n    \r\n    // Play a sound effect using Web Audio API\r\n    playSound(name, userHasInteracted) {\r\n        console.log(`Attempting to play sound: ${name}`);\r\n        \r\n        if (this.muted) {\r\n            console.log(`Sound ${name} not played: audio is muted`);\r\n            return;\r\n        }\r\n        \r\n        if (!userHasInteracted) {\r\n            console.log(`Sound ${name} not played: waiting for user interaction`);\r\n            return;\r\n        }\r\n        \r\n        const audioContext = this.audioContextManager.getContext();\r\n        \r\n        // Make sure AudioContext is running\r\n        if (audioContext && audioContext.state === 'suspended') {\r\n            this.audioContextManager.resumeAudioContext();\r\n        }\r\n        \r\n        // Handle the case where the name is 'weapon' or similar, map to projectile sound\r\n        if (name === 'weapon' || name === 'fire' || name === 'shoot') {\r\n            console.log(`Mapping ${name} sound to projectile sound`);\r\n            name = 'projectile';\r\n            // Use 'laser' sound for projectile if projectile sound is not available\r\n            const sounds = this.audioLoader.getAllSounds();\r\n            if (!sounds.projectile && sounds.laser) {\r\n                console.log(\"Using laser sound for projectile\");\r\n                sounds.projectile = sounds.laser;\r\n            }\r\n        }\r\n        \r\n        const soundBuffer = this.audioLoader.getSound(name);\r\n        if (!soundBuffer) {\r\n            console.warn(`Sound \"${name}\" not found in loaded sounds`);\r\n            return;\r\n        }\r\n        \r\n        try {\r\n            // Handle looped sounds vs one-shot sounds\r\n            if (name === 'laser' || name === 'thrust' || name === 'mining-laser') {\r\n                // For continuous sounds, create and track the sound source node\r\n                if (!this.activeSounds[name]) {\r\n                    // Create source node for looping sound\r\n                    const sourceNode = audioContext.createBufferSource();\r\n                    sourceNode.buffer = soundBuffer;\r\n                    sourceNode.loop = true;\r\n                    \r\n                    // Create gain node for volume control\r\n                    const gainNode = audioContext.createGain();\r\n                    gainNode.gain.value = this.sfxVolume * (name === 'thrust' ? 1.5 : 1.0);\r\n                    \r\n                    // Connect nodes: source -> gain -> destination\r\n                    sourceNode.connect(gainNode);\r\n                    gainNode.connect(audioContext.destination);\r\n                    \r\n                    // Start playing\r\n                    sourceNode.start(0);\r\n                    \r\n                    // Store references to these nodes for later control\r\n                    this.activeSounds[name] = {\r\n                        source: sourceNode,\r\n                        gain: gainNode\r\n                    };\r\n                    \r\n                    // Track nodes for garbage collection\r\n                    this.audioContextManager.trackNode(sourceNode);\r\n                    this.audioContextManager.trackNode(gainNode);\r\n                }\r\n            } else {\r\n                // For one-shot sounds\r\n                // Create source node\r\n                const sourceNode = audioContext.createBufferSource();\r\n                sourceNode.buffer = soundBuffer;\r\n                \r\n                // Create gain node for volume control\r\n                const gainNode = audioContext.createGain();\r\n                // Increase volume slightly for projectile sounds to make them more noticeable\r\n                const volumeMultiplier = name === 'projectile' ? 0.7 : 0.5;\r\n                gainNode.gain.value = this.sfxVolume * volumeMultiplier;\r\n                \r\n                // Connect nodes: source -> gain -> destination\r\n                sourceNode.connect(gainNode);\r\n                gainNode.connect(audioContext.destination);\r\n                \r\n                // Start playing (one-shot)\r\n                sourceNode.start(0);\r\n                \r\n                // Set ended callback for cleanup\r\n                sourceNode.onended = () => {\r\n                    sourceNode._inactive = true;\r\n                    gainNode._inactive = true;\r\n                };\r\n                \r\n                // Track nodes for garbage collection\r\n                this.audioContextManager.trackNode(sourceNode);\r\n                this.audioContextManager.trackNode(gainNode);\r\n                \r\n                // Log successful playback\r\n                console.log(`Started playback of one-shot sound: ${name}`);\r\n            }\r\n        } catch (err) {\r\n            console.error(`Error playing sound ${name}:`, err);\r\n        }\r\n    }\r\n    \r\n    // Stop a continuous sound effect\r\n    stopSound(name) {\r\n        if (!this.activeSounds[name]) return;\r\n        \r\n        try {\r\n            if (name === 'laser' || name === 'thrust' || name === 'mining-laser') {\r\n                // For looping sounds\r\n                if (this.activeSounds[name]) {\r\n                    const nodes = this.activeSounds[name];\r\n                    \r\n                    // Stop the source node\r\n                    if (nodes.source) {\r\n                        try {\r\n                            nodes.source.stop();\r\n                        } catch (e) {\r\n                            // Ignore errors if already stopped\r\n                        }\r\n                        nodes.source._inactive = true;\r\n                    }\r\n                    \r\n                    // Mark gain node as inactive\r\n                    if (nodes.gain) {\r\n                        nodes.gain._inactive = true;\r\n                    }\r\n                    \r\n                    // Clear reference\r\n                    this.activeSounds[name] = null;\r\n                }\r\n            }\r\n        } catch (err) {\r\n            console.error(`Error stopping sound ${name}:`, err);\r\n        }\r\n    }\r\n    \r\n    // Set the volume for thrust sound based on thrust level\r\n    setThrustVolume(thrustLevel) {\r\n        if (!this.activeSounds.thrust || !this.activeSounds.thrust.gain) return;\r\n        \r\n        // Scale the volume based on thrust level\r\n        const volume = Math.min(1.0, Math.max(0.1, thrustLevel)) * this.sfxVolume * 1.5;\r\n        \r\n        // Apply volume to gain node\r\n        try {\r\n            this.activeSounds.thrust.gain.gain.value = volume;\r\n        } catch (err) {\r\n            console.error(\"Error setting thrust volume:\", err);\r\n        }\r\n    }\r\n    \r\n    // Play weapon firing sound - dedicated method for weapon sounds\r\n    playWeaponSound(userHasInteracted) {\r\n        console.log(\"Playing weapon firing sound\");\r\n        \r\n        // Check usual conditions\r\n        if (this.muted || !userHasInteracted) {\r\n            return;\r\n        }\r\n        \r\n        const audioContext = this.audioContextManager.getContext();\r\n        \r\n        // Make sure AudioContext is running\r\n        if (audioContext && audioContext.state === 'suspended') {\r\n            this.audioContextManager.resumeAudioContext();\r\n        }\r\n        \r\n        // Make sure we have a projectile sound (use laser as fallback)\r\n        const sounds = this.audioLoader.getAllSounds();\r\n        if (!sounds.projectile && sounds.laser) {\r\n            console.log(\"Using laser sound for projectile in playWeaponSound\");\r\n            sounds.projectile = sounds.laser;\r\n        }\r\n        \r\n        if (!sounds.projectile) {\r\n            console.warn(\"Projectile sound not found\");\r\n            return;\r\n        }\r\n        \r\n        try {\r\n            // Create source node\r\n            const sourceNode = audioContext.createBufferSource();\r\n            sourceNode.buffer = sounds.projectile;\r\n            \r\n            // Create gain node with higher volume for weapon sound\r\n            const gainNode = audioContext.createGain();\r\n            gainNode.gain.value = this.sfxVolume * 0.8; // Higher volume for weapon sounds\r\n            \r\n            // Connect nodes: source -> gain -> destination\r\n            sourceNode.connect(gainNode);\r\n            gainNode.connect(audioContext.destination);\r\n            \r\n            // Start playing\r\n            sourceNode.start(0);\r\n            \r\n            // Set ended callback for cleanup\r\n            sourceNode.onended = () => {\r\n                sourceNode._inactive = true;\r\n                gainNode._inactive = true;\r\n            };\r\n            \r\n            // Track nodes for garbage collection\r\n            this.audioContextManager.trackNode(sourceNode);\r\n            this.audioContextManager.trackNode(gainNode);\r\n            \r\n            console.log(\"Weapon sound started playing\");\r\n        } catch (err) {\r\n            console.error(\"Error playing weapon sound:\", err);\r\n        }\r\n    }\r\n    \r\n    // Toggle mute for sound effects\r\n    toggleMute() {\r\n        this.muted = !this.muted;\r\n        \r\n        // Stop any active sound effects when muting\r\n        if (this.muted) {\r\n            this.stopSound('laser');\r\n            this.stopSound('thrust');\r\n            this.stopSound('mining-laser');\r\n        }\r\n        \r\n        console.log(`Sound effects ${this.muted ? 'muted' : 'unmuted'}`);\r\n        return this.muted;\r\n    }\r\n    \r\n    // Set sound effects volume\r\n    setVolume(volume) {\r\n        this.sfxVolume = volume;\r\n    }\r\n    \r\n    // Get sound effects volume\r\n    getVolume() {\r\n        return this.sfxVolume;\r\n    }\r\n    \r\n    // Check if sound effects are muted\r\n    isMuted() {\r\n        return this.muted;\r\n    }\r\n    \r\n    // Stop all active sounds\r\n    stopAllSounds() {\r\n        this.stopSound('laser');\r\n        this.stopSound('thrust');\r\n        this.stopSound('mining-laser');\r\n    }\r\n}","// enabler.js - Mobile audio unlock handling and user interaction detection\r\nexport class MobileAudioEnabler {\r\n    constructor(audioContextManager, musicPlayer) {\r\n        this.audioContextManager = audioContextManager;\r\n        this.musicPlayer = musicPlayer;\r\n        this.userHasInteracted = false;\r\n        \r\n        this.setupUserInteractionListener();\r\n    }\r\n    \r\n    // Check if user has interacted\r\n    hasUserInteracted() {\r\n        return this.userHasInteracted;\r\n    }\r\n    \r\n    // Show a notification to the user when a directory is missing\r\n    showDirectoryMissingNotification(directory) {\r\n        console.warn(`Directory not found: ${directory}`);\r\n        \r\n        // Create a notification element\r\n        const notification = document.createElement('div');\r\n        notification.style.position = 'fixed';\r\n        notification.style.top = '20px';\r\n        notification.style.left = '50%';\r\n        notification.style.transform = 'translateX(-50%)';\r\n        notification.style.backgroundColor = 'rgba(0, 0, 0, 0.7)';\r\n        notification.style.color = '#ff4400';\r\n        notification.style.padding = '10px 15px';\r\n        notification.style.borderRadius = '5px';\r\n        notification.style.zIndex = '9999';\r\n        notification.style.fontSize = '14px';\r\n        notification.style.maxWidth = '80%';\r\n        notification.style.textAlign = 'center';\r\n        \r\n        // Add message\r\n        notification.innerHTML = `\r\n            <div style=\"margin-bottom: 5px;\">\r\n                <strong>Note:</strong> ${directory} directory not found.\r\n            </div>\r\n            <div style=\"font-size: 12px; color: #aaa;\">\r\n                Game will continue with limited audio. This is normal when running on GitHub Pages.\r\n            </div>\r\n        `;\r\n        \r\n        // Add close button\r\n        const closeButton = document.createElement('div');\r\n        closeButton.style.position = 'absolute';\r\n        closeButton.style.top = '5px';\r\n        closeButton.style.right = '10px';\r\n        closeButton.style.cursor = 'pointer';\r\n        closeButton.style.color = '#aaa';\r\n        closeButton.textContent = '';\r\n        closeButton.addEventListener('click', () => notification.remove());\r\n        notification.appendChild(closeButton);\r\n        \r\n        // Add to document\r\n        document.body.appendChild(notification);\r\n        \r\n        // Auto-remove after 5 seconds\r\n        setTimeout(() => {\r\n            if (document.body.contains(notification)) {\r\n                notification.style.opacity = '0';\r\n                notification.style.transition = 'opacity 0.5s ease';\r\n                setTimeout(() => {\r\n                    if (document.body.contains(notification)) {\r\n                        notification.remove();\r\n                    }\r\n                }, 500);\r\n            }\r\n        }, 5000);\r\n    }\r\n    \r\n    // Set up a listener to detect the first user interaction\r\n    setupUserInteractionListener() {\r\n        const handleInteraction = () => {\r\n            if (!this.userHasInteracted) {\r\n                this.userHasInteracted = true;\r\n                console.log(\"User interaction detected, enabling audio playback\");\r\n                \r\n                // Resume AudioContext if it's suspended\r\n                this.audioContextManager.resumeAudioContext();\r\n                \r\n                // Start playing background music once the user interacts\r\n                this.musicPlayer.playBackgroundMusic(true);\r\n                \r\n                // Clean up the event listeners\r\n                document.removeEventListener('click', handleInteraction);\r\n                document.removeEventListener('keydown', handleInteraction);\r\n                document.removeEventListener('touchstart', handleInteraction);\r\n            }\r\n        };\r\n        \r\n        // Add event listeners for user interactions\r\n        document.addEventListener('click', handleInteraction);\r\n        document.addEventListener('keydown', handleInteraction);\r\n        document.addEventListener('touchstart', handleInteraction);\r\n        \r\n        // Additional handling specifically for mobile devices\r\n        if ('ontouchstart' in window || navigator.maxTouchPoints > 0) {\r\n            console.log(\"Mobile device detected - adding additional audio handlers\");\r\n            \r\n            // Force audio context resumption on specific UI interactions for mobile\r\n            const forceAudioResume = () => {\r\n                this.userHasInteracted = true;\r\n                \r\n                // Resume AudioContext if it's suspended\r\n                this.audioContextManager.resumeAudioContext();\r\n                \r\n                // Ensure background music is playing\r\n                const playlist = this.musicPlayer.playlist;\r\n                if (playlist.hasTracks() && !this.musicPlayer.isMuted()) {\r\n                    const currentTrack = playlist.getCurrentTrack();\r\n                    if (currentTrack && currentTrack.paused) {\r\n                        console.log(\"Mobile: Forcing background music playback\");\r\n                        this.musicPlayer.playBackgroundMusic(true);\r\n                    }\r\n                }\r\n            };\r\n            \r\n            // Add these handlers to common UI interaction points\r\n            document.addEventListener('touchend', forceAudioResume, {passive: true});\r\n            \r\n            // Attach to specific game buttons when they're created\r\n            const attachToButtons = () => {\r\n                // Check for UI elements every 500ms for 5 seconds after page load\r\n                let attempts = 0;\r\n                const interval = setInterval(() => {\r\n                    attempts++;\r\n                    \r\n                    // Find and attach to important action buttons\r\n                    const actionButtons = document.querySelectorAll('button');\r\n                    if (actionButtons.length > 0) {\r\n                        console.log(`Mobile: Found ${actionButtons.length} buttons to attach audio handlers`);\r\n                        actionButtons.forEach(button => {\r\n                            if (!button.hasAudioHandler) {\r\n                                button.addEventListener('touchend', forceAudioResume, {passive: true});\r\n                                button.hasAudioHandler = true;\r\n                            }\r\n                        });\r\n                    }\r\n                    \r\n                    // Stop checking after 10 attempts (5 seconds)\r\n                    if (attempts >= 10) {\r\n                        clearInterval(interval);\r\n                    }\r\n                }, 500);\r\n            };\r\n            \r\n            // Run initially and also after document is fully loaded\r\n            attachToButtons();\r\n            if (document.readyState === 'complete') {\r\n                attachToButtons();\r\n            } else {\r\n                window.addEventListener('load', attachToButtons);\r\n            }\r\n        }\r\n    }\r\n    \r\n    // Clean up event listeners\r\n    cleanup() {\r\n        // Note: The actual cleanup of event listeners is handled in the main handler\r\n        // This method is here for consistency with other modules\r\n        this.userHasInteracted = false;\r\n        console.log(\"Mobile audio enabler cleanup complete\");\r\n    }\r\n}","// audio.js - Main AudioManager facade that delegates to specialized modules\r\nimport { AudioContext } from './core/context.js';\r\nimport { AudioLoader } from './core/loader.js';\r\nimport { MusicPlaylist } from './music/playlist.js';\r\nimport { MusicPlayer } from './music/player.js';\r\nimport { SoundPlayer } from './effects/soundPlayer.js';\r\nimport { MobileAudioEnabler } from './mobile/enabler.js';\r\n\r\nexport class AudioManager {\r\n    constructor() {\r\n        // Initialize core components\r\n        this.audioContextManager = new AudioContext();\r\n        this.audioLoader = new AudioLoader(this.audioContextManager);\r\n        this.musicPlaylist = new MusicPlaylist();\r\n        this.musicPlayer = new MusicPlayer(this.musicPlaylist);\r\n        this.soundPlayer = new SoundPlayer(this.audioContextManager, this.audioLoader);\r\n        this.mobileEnabler = new MobileAudioEnabler(this.audioContextManager, this.musicPlayer);\r\n        \r\n        // Exposed properties for compatibility\r\n        this.sounds = this.audioLoader.getAllSounds();\r\n        this.soundSources = {}; // Legacy compatibility\r\n        this.backgroundMusic = []; // Legacy compatibility\r\n        this.currentMusicIndex = 0; // Legacy compatibility\r\n        this.currentMusic = null; // Legacy compatibility\r\n        this.music = this.musicPlaylist.getTracks();\r\n        this.activeNodes = this.audioContextManager.activeNodes;\r\n        this.activeSounds = this.soundPlayer.activeSounds;\r\n        \r\n        // Set up compatibility layer for intro sequence\r\n        this.masterEQ = this.audioContextManager.initializeToneCompatibility();\r\n        \r\n        console.log(\"Initializing audio manager with Web Audio API...\");\r\n    }\r\n    \r\n    // Getter/setter for volume properties\r\n    get isMuted() {\r\n        return this.soundPlayer.isMuted() || this.musicPlayer.isMuted();\r\n    }\r\n    \r\n    set isMuted(value) {\r\n        // Legacy setter - use toggleMute() instead\r\n        if (value !== this.isMuted) {\r\n            this.toggleMute();\r\n        }\r\n    }\r\n    \r\n    get muted() {\r\n        return this.isMuted;\r\n    }\r\n    \r\n    set muted(value) {\r\n        this.isMuted = value;\r\n    }\r\n    \r\n    get musicVolume() {\r\n        return this.musicPlayer.getVolume();\r\n    }\r\n    \r\n    set musicVolume(value) {\r\n        this.musicPlayer.setVolume(value);\r\n    }\r\n    \r\n    get sfxVolume() {\r\n        return this.soundPlayer.getVolume();\r\n    }\r\n    \r\n    set sfxVolume(value) {\r\n        this.soundPlayer.setVolume(value);\r\n    }\r\n    \r\n    get userHasInteracted() {\r\n        return this.mobileEnabler.hasUserInteracted();\r\n    }\r\n    \r\n    get audioContext() {\r\n        return this.audioContextManager.getContext();\r\n    }\r\n    \r\n    // Initialize audio - load all sounds and music\r\n    async initialize() {\r\n        try {\r\n            console.log(\"Loading audio files...\");\r\n            \r\n            // Ensure audio context is resumed on first user interaction\r\n            if (this.audioContext && this.audioContext.state === 'suspended') {\r\n                this.audioContextManager.resumeAudioContext();\r\n            }\r\n            \r\n            // Check if the sound directories exist for music\r\n            await this.audioLoader.checkSoundDirectories();\r\n            \r\n            // Load only the essential UI sounds first for faster startup\r\n            await this.audioLoader.preDecodeEssentialSounds();\r\n            \r\n            // Load music in the background (non-blocking)\r\n            this.musicPlaylist.loadBackgroundMusic().catch(error => {\r\n                console.error(\"Error loading background music:\", error);\r\n            });\r\n            \r\n            console.log(\"Essential audio initialization complete\");\r\n            \r\n            // Music will play automatically once the user interacts with the page\r\n            // If the user has already interacted, we can play immediately\r\n            if (this.userHasInteracted) {\r\n                this.musicPlayer.playBackgroundMusic(true);\r\n            } else {\r\n                console.log(\"Music playback waiting for user interaction.\");\r\n            }\r\n            \r\n            // Schedule loading of remaining gameplay sounds in the background \r\n            // after a short delay to let the UI fully initialize\r\n            setTimeout(() => {\r\n                this.audioLoader.loadGameplaySounds();\r\n            }, 1000);\r\n            \r\n            return true;\r\n        } catch (error) {\r\n            console.error(\"Error initializing audio:\", error);\r\n            return false;\r\n        }\r\n    }\r\n    \r\n    // Legacy method for compatibility\r\n    async preDecodeAllSoundEffects() {\r\n        console.log(\"Using optimized sound loading path instead of preDecodeAllSoundEffects\");\r\n        await this.audioLoader.preDecodeEssentialSounds();\r\n        await this.audioLoader.loadGameplaySounds();\r\n    }\r\n    \r\n    // Resume audio context on user interaction\r\n    resumeAudioContext() {\r\n        return this.audioContextManager.resumeAudioContext();\r\n    }\r\n    \r\n    // Start playing background music\r\n    playBackgroundMusic() {\r\n        this.musicPlayer.playBackgroundMusic(this.userHasInteracted);\r\n    }\r\n    \r\n    // Play the next music track in the playlist\r\n    playNextTrack() {\r\n        this.musicPlayer.playNextTrack(this.userHasInteracted);\r\n    }\r\n    \r\n    // Play a sound effect\r\n    playSound(name) {\r\n        this.soundPlayer.playSound(name, this.userHasInteracted);\r\n    }\r\n    \r\n    // Stop a continuous sound effect\r\n    stopSound(name) {\r\n        this.soundPlayer.stopSound(name);\r\n    }\r\n    \r\n    // Set the volume for thrust sound based on thrust level\r\n    setThrustVolume(thrustLevel) {\r\n        this.soundPlayer.setThrustVolume(thrustLevel);\r\n    }\r\n    \r\n    // Play weapon firing sound\r\n    playWeaponSound() {\r\n        this.soundPlayer.playWeaponSound(this.userHasInteracted);\r\n    }\r\n    \r\n    // Toggle mute for all audio\r\n    toggleMute() {\r\n        const soundMuted = this.soundPlayer.toggleMute();\r\n        const musicMuted = this.musicPlayer.toggleMute();\r\n        \r\n        const overallMuted = soundMuted || musicMuted;\r\n        console.log(`Audio ${overallMuted ? 'muted' : 'unmuted'}`);\r\n        return overallMuted;\r\n    }\r\n    \r\n    // Track an audio node for garbage collection (legacy compatibility)\r\n    trackNode(node) {\r\n        return this.audioContextManager.trackNode(node);\r\n    }\r\n    \r\n    // Clean up inactive audio nodes (legacy compatibility)\r\n    cleanupInactiveNodes() {\r\n        this.audioContextManager.cleanupInactiveNodes();\r\n    }\r\n    \r\n    // Setup garbage collection (legacy compatibility)\r\n    setupGarbageCollection() {\r\n        // Already handled in audioContextManager constructor\r\n        console.log(\"Garbage collection already set up in context manager\");\r\n    }\r\n    \r\n    // Setup user interaction listener (legacy compatibility)\r\n    setupUserInteractionListener() {\r\n        // Already handled in mobileEnabler constructor\r\n        console.log(\"User interaction listener already set up in mobile enabler\");\r\n    }\r\n    \r\n    // Initialize tone compatibility (legacy compatibility)\r\n    initializeToneCompatibility() {\r\n        return this.masterEQ;\r\n    }\r\n    \r\n    // Clean up resources when destroying the audio manager\r\n    cleanup() {\r\n        console.log(\"Cleaning up AudioManager resources...\");\r\n        \r\n        // Stop all active sounds\r\n        this.soundPlayer.stopAllSounds();\r\n        \r\n        // Pause all music\r\n        this.musicPlayer.pauseAll();\r\n        \r\n        // Clean up mobile enabler\r\n        this.mobileEnabler.cleanup();\r\n        \r\n        // Clean up audio context\r\n        this.audioContextManager.cleanup();\r\n        \r\n        console.log(\"AudioManager cleanup complete\");\r\n    }\r\n}"],"file":"assets/modules-BUUuAvZs.js"}