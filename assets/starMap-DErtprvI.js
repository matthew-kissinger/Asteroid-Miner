var g=Object.defineProperty;var b=(u,e,t)=>e in u?g(u,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):u[e]=t;var l=(u,e,t)=>b(u,typeof e!="symbol"?e+"":e,t);import{c as v}from"./game-core-OtPnLuF2.js";import"./three-DBvJLP14.js";class S{constructor(e){l(this,"isMobile");this.isMobile=e}updateCanvas(e){const t=document.getElementById("star-map-canvas");if(!t)return;const s=t.getContext("2d");if(!s)return;s.clearRect(0,0,t.width,t.height);const i=t.width/2,o=t.height/2,n=e.getAllSystems(),r=e.currentSystem,a=e.warpGates;this.drawConnections(s,i,o,n,a),this.drawCurrentSystemConnections(s,i,o,n,r),this.drawSystems(s,i,o,n,r)}drawConnections(e,t,s,i,o){e.lineWidth=1,e.strokeStyle="rgba(48, 207, 208, 0.4)";for(const[n,r]of Object.entries(o)){const a=i[n];if(!a)continue;const d=t+a.position.x,p=s+a.position.y;for(const c of r){const y=i[c];if(!y)continue;const m=t+y.position.x,h=s+y.position.y;e.beginPath(),e.moveTo(d,p),e.lineTo(m,h),e.stroke()}}}drawCurrentSystemConnections(e,t,s,i,o){if(o&&i[o]){const n=i[o],r=t+n.position.x,a=s+n.position.y;e.lineWidth=this.isMobile?3:2,e.strokeStyle="rgba(48, 207, 208, 0.8)";for(const d of n.connections){const p=i[d];if(!p)continue;const c=t+p.position.x,y=s+p.position.y;e.beginPath(),e.moveTo(r,a),e.lineTo(c,y),e.stroke()}}}drawSystems(e,t,s,i,o,n=null){for(const[r,a]of Object.entries(i)){const d=t+a.position.x,p=s+a.position.y,c=r===o,y=r===n,m=o&&i[o]&&i[o].connections.includes(r);e.beginPath();let h;this.isMobile?h=c?18:y?15:10:h=c?15:y?12:8,e.fillStyle=a.starColor?`#${a.starColor.toString(16).padStart(6,"0")}`:"#ffffff",c||y?(e.shadowBlur=this.isMobile?20:15,e.shadowColor=c?"#30cfd0":"#ffffff"):e.shadowBlur=0,e.arc(d,p,h,0,Math.PI*2),e.fill(),e.shadowBlur=0,m&&!c&&(e.strokeStyle="#30cfd0",e.lineWidth=this.isMobile?3:2,e.beginPath(),e.arc(d,p,h+3,0,Math.PI*2),e.stroke()),e.fillStyle=c?"#30cfd0":y?"#ffffff":"#aaaaaa",e.font=c?this.isMobile?"bold 14px Courier New":"bold 12px Courier New":this.isMobile?"12px Courier New":"10px Courier New",e.textAlign="center",e.fillText(a.name,d,p+h+(this.isMobile?18:15))}}findSystemAtPosition(e,t,s){const i=s.getAllSystems(),o=s.currentSystem,n=250,r=250;for(const[a,d]of Object.entries(i)){const p=n+d.position.x,c=r+d.position.y,y=e-p,m=t-c,h=Math.sqrt(y*y+m*m),f=a===o?this.isMobile?20:15:this.isMobile?15:10;if(h<=f)return a}return null}}class x{constructor(e,t,s){l(this,"starSystemGenerator");l(this,"selectedSystem");l(this,"isTraveling");this.starSystemGenerator=e,this.selectedSystem=null,this.isTraveling=!1}selectSystem(e,t,s,i){if(console.log(`Selecting system: ${e}`),this.selectedSystem=e,!e){s(null,t),i(null,!1,!1);return}const o=this.starSystemGenerator.getAllSystems()[e],n=this.starSystemGenerator.currentSystem;s(o,t);const r=this.starSystemGenerator.getCurrentSystemConnections().includes(e);i(e,e===n,r)}handleTravel(e){if(this.selectedSystem&&this.selectedSystem!==this.starSystemGenerator.currentSystem){console.log(`Initiating travel to system: ${this.selectedSystem}`),this.isTraveling=!0,e();const t=window.game.environment;if(t&&t.travelToSystem){const s=t.travelToSystem(this.selectedSystem);console.log(`Travel to ${this.selectedSystem} initiated: ${s}`),setTimeout(()=>{this.isTraveling=!1},5e3)}else if(this.starSystemGenerator.travelToSystem(this.selectedSystem)){this.selectSystem(null,!1,()=>{},()=>{});const i=this.starSystemGenerator.getCurrentSystemData();i&&this.showTravelNotification(i.name,!1),this.isTraveling=!1}}}showTravelNotification(e,t){const s=document.createElement("div");s.style.position="fixed",s.style.top=t?"30%":"20%",s.style.left="50%",s.style.transform="translate(-50%, -50%)",s.style.backgroundColor="rgba(0, 0, 0, 0.8)",s.style.color="#30cfd0",s.style.padding=t?"15px 30px":"20px 40px",s.style.borderRadius="10px",s.style.border="2px solid #30cfd0",s.style.boxShadow="0 0 30px #30cfd0",s.style.fontFamily="Courier New, monospace",s.style.fontSize=t?"18px":"20px",s.style.fontWeight="bold",s.style.zIndex="9999",s.style.textAlign="center",s.textContent=`ARRIVED AT ${e}`,document.body.appendChild(s),setTimeout(()=>{s.style.opacity="0",s.style.transition="opacity 1s",setTimeout(()=>{s.remove()},1e3)},3e3)}getSelectedSystem(){return this.selectedSystem}isTravelingToSystem(){return this.isTraveling}}class w{constructor(e){l(this,"starSystemGenerator");this.starSystemGenerator=e}updateCurrentSystemInfo(e){const t=this.starSystemGenerator.getCurrentSystemData();if(!t)return;const s=document.getElementById("current-system-name"),i=document.getElementById("current-system-class");s&&(s.textContent=t.name),i&&(i.textContent=`Class ${t.starClass} - ${t.classification}`);const o=document.getElementById("current-iron-indicator"),n=document.getElementById("current-gold-indicator"),r=document.getElementById("current-platinum-indicator");o&&(o.style.width=`${t.resourceMultipliers.iron*50}%`),n&&(n.style.width=`${t.resourceMultipliers.gold*50}%`),r&&(r.style.width=`${t.resourceMultipliers.platinum*50}%`);const a=document.getElementById("current-system-description"),d=document.getElementById("current-system-features");a&&(a.textContent=t.description),d&&(d.textContent=`Special Features: ${t.specialFeatures.join(", ")}`)}updateSelectedSystemInfo(e,t){const s=document.getElementById("selected-system-card");if(s){if(!e){s.innerHTML=`
                <div class="empty-selection" style="color: #777; text-align: center; padding: 20px;">
                    No system selected.<br>${t?"Tap":"Click"} on a star system in the map to select it.
                </div>
            `;return}if(s.innerHTML=`
            <div id="selected-system-name" style="font-size: ${t?"16px":"18px"}; font-weight: bold; color: #fff; margin-bottom: 5px;">${e.name}</div>
            <div id="selected-system-class" style="font-size: ${t?"12px":"14px"}; color: #aaa; margin-bottom: 10px;">Class ${e.starClass} - ${e.classification}</div>
            <div id="selected-system-resources" style="margin-bottom: 10px;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                    <span>Iron:</span>
                    <div class="resource-indicator" style="width: 100px; height: 8px; background: #333; border-radius: 4px; overflow: hidden;">
                        <div style="height: 100%; width: ${e.resourceMultipliers.iron*50}%; background: #aaa;"></div>
                    </div>
                </div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                    <span>Gold:</span>
                    <div class="resource-indicator" style="width: 100px; height: 8px; background: #333; border-radius: 4px; overflow: hidden;">
                        <div style="height: 100%; width: ${e.resourceMultipliers.gold*50}%; background: #FFD700;"></div>
                    </div>
                </div>
                <div style="display: flex; justify-content: space-between;">
                    <span>Platinum:</span>
                    <div class="resource-indicator" style="width: 100px; height: 8px; background: #333; border-radius: 4px; overflow: hidden;">
                        <div style="height: 100%; width: ${e.resourceMultipliers.platinum*50}%; background: #E5E4E2;"></div>
                    </div>
                </div>
            </div>
            <div style="font-size: ${t?"11px":"12px"}; color: #ccc; margin-bottom: 10px;">
                ${e.description}
            </div>
            <div style="font-size: ${t?"11px":"12px"}; color: #30cfd0;">
                Special Features: ${e.specialFeatures.join(", ")}
            </div>
        `,t){const i=document.getElementById("system-info-panel");i&&s&&(i.scrollTop=s.offsetTop-i.offsetTop)}}}updateTravelButton(e,t,s){const i=document.getElementById("travel-button");if(i){if(!e){i.disabled=!0,i.style.cursor="not-allowed",i.style.opacity="0.5",i.textContent="TRAVEL TO SYSTEM";return}i.disabled=t||!s,i.style.cursor=t||!s?"not-allowed":"pointer",i.style.opacity=t||!s?"0.5":"1",i.textContent=t?"CURRENT LOCATION":s?"TRAVEL TO SYSTEM":"NO DIRECT ROUTE"}}getCurrentSystemData(){return this.starSystemGenerator.getCurrentSystemData()}getAllSystems(){return this.starSystemGenerator.getAllSystems()}getCurrentSystem(){return this.starSystemGenerator.currentSystem}}class M{constructor(e){l(this,"isMobile");this.isMobile=e}setupStarMapUI(){const e=document.createElement("div");e.id="star-map",e.style.position="absolute",e.style.top="50%",e.style.left="50%",e.style.transform="translate(-50%, -50%)",this.isMobile?(e.style.width="95%",e.style.height="85vh",e.style.maxHeight="700px"):(e.style.width="900px",e.style.height="700px"),e.style.backgroundColor="rgba(10, 15, 30, 0.95)",e.style.color="#fff",e.style.padding=this.isMobile?"15px":"30px",e.style.borderRadius="10px",e.style.border="2px solid #30cfd0",e.style.boxShadow="0 0 30px #30cfd0",e.style.fontFamily="Courier New, monospace",e.style.zIndex="1500",e.style.display="none",e.style.overflow="hidden";const t=document.createElement("h2");t.textContent="STAR MAP",t.style.textAlign="center",t.style.color="#30cfd0",t.style.margin="0 0 20px 0",t.style.fontSize=this.isMobile?"24px":"28px",e.appendChild(t);const s=document.createElement("div");s.style.display="flex",s.style.flexDirection=this.isMobile?"column":"row",s.style.height=this.isMobile?"calc(100% - 120px)":"calc(100% - 100px)",s.style.gap=this.isMobile?"15px":"0";const i=this.createMapContainer(),o=this.createInfoPanel();s.appendChild(i),s.appendChild(o),e.appendChild(s);const n=this.createCloseButton();e.appendChild(n),document.body.appendChild(e)}createMapContainer(){const e=document.createElement("div");e.id="star-map-visual",e.style.flex="1",e.style.background="rgba(0, 0, 0, 0.7)",e.style.borderRadius="10px",e.style.border="1px solid #30cfd0",e.style.position="relative",e.style.overflow="hidden",e.style.height=this.isMobile?"40%":"100%",e.style.minHeight=this.isMobile?"250px":"auto";const t=document.createElement("canvas");return t.id="star-map-canvas",t.width=500,t.height=500,t.style.width="100%",t.style.height="100%",e.appendChild(t),e}createInfoPanel(){const e=document.createElement("div");e.id="system-info-panel",e.style.width=this.isMobile?"100%":"350px",e.style.marginLeft=this.isMobile?"0":"20px",e.style.overflowY="auto",e.style.height=this.isMobile?"60%":"100%",e.style.webkitOverflowScrolling="touch";const t=this.createCurrentSystemSection();e.appendChild(t);const s=this.createSelectedSystemSection();return e.appendChild(s),e}createCurrentSystemSection(){const e=document.createElement("div");return e.id="current-system-info",e.innerHTML=`
            <h3 style="color: #30cfd0; margin-top: 0; font-size: ${this.isMobile?"16px":"18px"};">CURRENT SYSTEM</h3>
            <div class="system-card" style="background: rgba(0, 0, 0, 0.7); padding: 15px; border-radius: 5px; border: 1px solid #30cfd0; margin-bottom: 20px;">
                <div id="current-system-name" style="font-size: ${this.isMobile?"16px":"18px"}; font-weight: bold; color: #fff; margin-bottom: 5px;">Solar System</div>
                <div id="current-system-class" style="font-size: ${this.isMobile?"12px":"14px"}; color: #aaa; margin-bottom: 10px;">Class G - Home System</div>
                <div id="current-system-resources" style="margin-bottom: 10px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                        <span>Iron:</span>
                        <div class="resource-indicator" style="width: 100px; height: 8px; background: #333; border-radius: 4px; overflow: hidden;">
                            <div id="current-iron-indicator" style="height: 100%; width: 50%; background: #aaa;"></div>
                        </div>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                        <span>Gold:</span>
                        <div class="resource-indicator" style="width: 100px; height: 8px; background: #333; border-radius: 4px; overflow: hidden;">
                            <div id="current-gold-indicator" style="height: 100%; width: 50%; background: #FFD700;"></div>
                        </div>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span>Platinum:</span>
                        <div class="resource-indicator" style="width: 100px; height: 8px; background: #333; border-radius: 4px; overflow: hidden;">
                            <div id="current-platinum-indicator" style="height: 100%; width: 50%; background: #E5E4E2;"></div>
                        </div>
                    </div>
                </div>
                <div id="current-system-description" style="font-size: ${this.isMobile?"11px":"12px"}; color: #ccc; margin-bottom: 10px;">
                    Our home system, with Earth as the starting location.
                </div>
                <div id="current-system-features" style="font-size: ${this.isMobile?"11px":"12px"}; color: #30cfd0;">
                    Special Features: Earth
                </div>
            </div>
        `,e}createSelectedSystemSection(){const e=document.createElement("div");return e.id="selected-system-info",e.innerHTML=`
            <h3 style="color: #30cfd0; font-size: ${this.isMobile?"16px":"18px"};">SELECTED SYSTEM</h3>
            <div id="selected-system-card" class="system-card" style="background: rgba(0, 0, 0, 0.7); padding: 15px; border-radius: 5px; border: 1px solid #555; margin-bottom: 20px;">
                <div class="empty-selection" style="color: #777; text-align: center; padding: 20px;">
                    No system selected.<br>
                    ${this.isMobile?"Tap":"Click"} on a star system in the map to select it.
                </div>
            </div>
            <button id="travel-button" disabled style="width: 100%; padding: ${this.isMobile?"15px":"12px"}; background-color: #30cfd0; color: #000; border: none; border-radius: 5px; cursor: not-allowed; font-family: 'Courier New', monospace; font-weight: bold; font-size: ${this.isMobile?"18px":"16px"}; opacity: 0.5;">
                TRAVEL TO SYSTEM
            </button>
        `,e}createCloseButton(){const e=document.createElement("button");return e.id="close-star-map",e.textContent="RETURN TO STARGATE",e.style.width="100%",e.style.padding=this.isMobile?"15px":"12px",e.style.marginTop="20px",e.style.backgroundColor="#555",e.style.color="#fff",e.style.border="none",e.style.borderRadius="5px",e.style.cursor="pointer",e.style.fontFamily="Courier New, monospace",e.style.fontWeight="bold",e.style.fontSize=this.isMobile?"18px":"16px",this.isMobile&&(e.style.backgroundColor="#30cfd0",e.style.color="#000",e.style.boxShadow="0 0 15px rgba(48, 207, 208, 0.7)"),e}}class I{constructor(e,t,s){l(this,"starSystemGenerator");l(this,"dockingSystem");l(this,"stargateInterface");l(this,"isVisible");l(this,"isMobile");l(this,"canvasRenderer");l(this,"navigationLogic");l(this,"dataManager");l(this,"uiCreator");this.starSystemGenerator=e,this.dockingSystem=t,this.stargateInterface=s,this.isVisible=!1,this.isMobile=v.isMobile(),console.log("StarMap constructor - isMobile:",this.isMobile),this.canvasRenderer=new S(this.isMobile),this.navigationLogic=new x(e,t,s),this.dataManager=new w(e),this.uiCreator=new M(this.isMobile),this.uiCreator.setupStarMapUI(),this.setupEventHandlers()}setupEventHandlers(){const e=document.getElementById("close-star-map");e&&(e.addEventListener("click",()=>{window.game&&window.game.audio&&window.game.audio.playSound("boink"),this.hide()}),this.isMobile&&e.addEventListener("touchend",i=>{i.preventDefault(),window.game&&window.game.audio?(console.log("Mobile: Playing sound on star map close button"),window.game.audio.playSound("boink"),setTimeout(()=>this.hide(),50)):this.hide()}));const t=document.getElementById("star-map-canvas");t&&(t.addEventListener("click",i=>{this.handleMapInteraction(i)}),this.isMobile&&t.addEventListener("touchend",i=>{i.preventDefault(),this.handleMapInteraction(i.changedTouches[0])}));const s=document.getElementById("travel-button");if(s){const i=()=>{this.navigationLogic.handleTravel(()=>this.hide())};s.addEventListener("click",i),this.isMobile&&s.addEventListener("touchend",o=>{o.preventDefault(),i()})}}handleMapInteraction(e){const t=document.getElementById("star-map-canvas");if(!t)return;const s=t.getBoundingClientRect(),i=(e.clientX-s.left)*(t.width/s.width),o=(e.clientY-s.top)*(t.height/s.height),n=this.canvasRenderer.findSystemAtPosition(i,o,this.starSystemGenerator);n&&(this.selectSystem(n),this.updateCanvas())}selectSystem(e){this.navigationLogic.selectSystem(e,this.isMobile,(t,s)=>this.dataManager.updateSelectedSystemInfo(t,s),(t,s,i)=>this.dataManager.updateTravelButton(t,s,i))}updateCanvas(){this.canvasRenderer.updateCanvas(this.starSystemGenerator);const e=document.getElementById("star-map-canvas");if(!e)return;const t=e.getContext("2d");t&&this.canvasRenderer.drawSystems(t,250,250,this.dataManager.getAllSystems(),this.dataManager.getCurrentSystem(),this.navigationLogic.getSelectedSystem())}updateCurrentSystemInfo(){this.dataManager.updateCurrentSystemInfo(this.isMobile)}show(){this.updateCurrentSystemInfo(),this.updateCanvas(),this.selectSystem(null),this.isMobile&&window.game&&window.game.audio&&setTimeout(()=>{console.log("Mobile: Attempting to play initial sound in StarMap"),window.game.audio.playSound("boink")},100);const e=document.getElementById("star-map");e&&(e.style.display="block",this.isVisible=!0)}hide(){var t;const e=document.getElementById("star-map");if(e)if(e.style.display="none",this.isVisible=!1,(t=this.stargateInterface)!=null&&t.showStargateUI)this.stargateInterface.showStargateUI();else if(window.game&&window.game.ui&&window.game.ui.stargateInterface)window.game.ui.stargateInterface.showStargateUI();else{const s=document.getElementById("stargate-ui");s&&(s.style.display="block")}}toggle(){this.isVisible?this.hide():this.show()}}export{I as StarMap};
//# sourceMappingURL=starMap-DErtprvI.js.map
