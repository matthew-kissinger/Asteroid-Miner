{"version":3,"file":"vibeVersePortals-CvNQUYkr.js","sources":["../../js/modules/environment/vibeVersePortals.ts"],"sourcesContent":["// vibeVersePortals.ts - Implements VibeVerse portal entrance and exit\n\nimport * as THREE from 'three';\n\ninterface SpaceshipLike {\n    mesh?: THREE.Object3D;\n    velocity?: THREE.Vector3;\n}\n\ninterface GameGlobal {\n    selfUsername?: string;\n    currentSpeed?: number;\n}\n\nexport class VibeVersePortals {\n    scene: THREE.Scene;\n    spaceship: SpaceshipLike;\n    startPortalGroup: THREE.Group | null;\n    exitPortalGroup: THREE.Group | null;\n    startPortalBox: THREE.Box3 | null;\n    exitPortalBox: THREE.Box3 | null;\n    startPortalParticleSystem: THREE.Points | null;\n    exitPortalParticleSystem: THREE.Points | null;\n    shouldCreateStartPortal: boolean;\n    refUrl: string;\n    _isRedirecting?: boolean;\n\n    constructor(scene: THREE.Scene, spaceship: SpaceshipLike) {\n        this.scene = scene;\n        this.spaceship = spaceship;\n        this.startPortalGroup = null;\n        this.exitPortalGroup = null;\n        this.startPortalBox = null;\n        this.exitPortalBox = null;\n        this.startPortalParticleSystem = null;\n        this.exitPortalParticleSystem = null;\n\n        // Check if we should create a start portal\n        const search = (window as any).location?.search || '';\n        this.shouldCreateStartPortal = new URLSearchParams(search).has('portal');\n\n        // Get reference URL if it exists\n        this.refUrl = new URLSearchParams(search).get('ref') || '';\n\n        // Initialize portals\n        this.init();\n    }\n\n    init(): void {\n        // Create start portal if needed (based on URL parameter)\n        if (this.shouldCreateStartPortal) {\n            this.createStartPortal();\n        }\n\n        // Exit portal removed - no longer creating it\n    }\n\n    createStartPortal(): void {\n        // Create a portal group\n        this.startPortalGroup = new THREE.Group();\n        this.startPortalGroup.name = 'startPortal';\n\n        // Create portal ring - INCREASED SIZE\n        const ringGeometry = new THREE.TorusGeometry(150, 15, 32, 100);\n        const ringMaterial = new THREE.MeshStandardMaterial({\n            color: 0xff0000,\n            emissive: 0xff0000,\n            emissiveIntensity: 0.5,\n            roughness: 0.3,\n            metalness: 0.7\n        });\n        const ring = new THREE.Mesh(ringGeometry, ringMaterial);\n        this.startPortalGroup.add(ring);\n\n        // Create portal surface (semi-transparent) - INCREASED SIZE\n        const surfaceGeometry = new THREE.CircleGeometry(135, 32);\n        const surfaceMaterial = new THREE.MeshBasicMaterial({\n            color: 0xff0000,\n            transparent: true,\n            opacity: 0.3,\n            side: THREE.DoubleSide\n        });\n        const surface = new THREE.Mesh(surfaceGeometry, surfaceMaterial);\n        surface.position.z = 0.1; // Slight offset to avoid z-fighting\n        this.startPortalGroup.add(surface);\n\n        // Create particle system\n        const particleCount = 500;\n        const particleGeometry = new THREE.BufferGeometry();\n        const positions = new Float32Array(particleCount * 3);\n\n        // Position particles in a ring pattern - ADJUSTED FOR LARGER SIZE\n        for (let i = 0; i < particleCount; i++) {\n            const angle = (i / particleCount) * Math.PI * 2;\n            const radius = 135 + (Math.random() * 30 - 15); // Random variation around the ring\n\n            positions[i * 3] = Math.cos(angle) * radius;\n            positions[i * 3 + 1] = Math.sin(angle) * radius;\n            positions[i * 3 + 2] = (Math.random() - 0.5) * 15; // Small variation in z\n        }\n\n        particleGeometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));\n\n        const particleMaterial = new THREE.PointsMaterial({\n            color: 0xff5555,\n            size: 3.5, // Increased particle size\n            blending: THREE.AdditiveBlending,\n            transparent: true\n        });\n\n        this.startPortalParticleSystem = new THREE.Points(particleGeometry, particleMaterial);\n        this.startPortalGroup.add(this.startPortalParticleSystem);\n\n        // Position the portal higher above the stargate and centered on y-axis\n        this.startPortalGroup.position.set(0, 15000, 0); // Centered above stargate\n        this.startPortalGroup.rotation.x = Math.PI / 2; // Face straight down\n\n        // Add to scene\n        this.scene.add(this.startPortalGroup);\n\n        // Create collision box\n        this.startPortalBox = new THREE.Box3().setFromObject(this.startPortalGroup);\n\n        console.log(\"Start portal created at position:\", this.startPortalGroup.position);\n    }\n\n    createExitPortal(): void {\n        // Create a portal group\n        this.exitPortalGroup = new THREE.Group();\n        this.exitPortalGroup.name = 'exitPortal';\n\n        // Create portal ring - INCREASED SIZE\n        const ringGeometry = new THREE.TorusGeometry(150, 15, 32, 100);\n        const ringMaterial = new THREE.MeshStandardMaterial({\n            color: 0x00ff00,\n            emissive: 0x00ff00,\n            emissiveIntensity: 0.5,\n            roughness: 0.3,\n            metalness: 0.7\n        });\n        const ring = new THREE.Mesh(ringGeometry, ringMaterial);\n        this.exitPortalGroup.add(ring);\n\n        // Create portal surface (semi-transparent) - INCREASED SIZE\n        const surfaceGeometry = new THREE.CircleGeometry(135, 32);\n        const surfaceMaterial = new THREE.MeshBasicMaterial({\n            color: 0x00ff00,\n            transparent: true,\n            opacity: 0.3,\n            side: THREE.DoubleSide\n        });\n        const surface = new THREE.Mesh(surfaceGeometry, surfaceMaterial);\n        surface.position.z = 0.1; // Slight offset to avoid z-fighting\n        this.exitPortalGroup.add(surface);\n\n        // Create particle system\n        const particleCount = 500;\n        const particleGeometry = new THREE.BufferGeometry();\n        const positions = new Float32Array(particleCount * 3);\n\n        // Position particles in a ring pattern - ADJUSTED FOR LARGER SIZE\n        for (let i = 0; i < particleCount; i++) {\n            const angle = (i / particleCount) * Math.PI * 2;\n            const radius = 135 + (Math.random() * 30 - 15); // Random variation around the ring\n\n            positions[i * 3] = Math.cos(angle) * radius;\n            positions[i * 3 + 1] = Math.sin(angle) * radius;\n            positions[i * 3 + 2] = (Math.random() - 0.5) * 15; // Small variation in z\n        }\n\n        particleGeometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));\n\n        const particleMaterial = new THREE.PointsMaterial({\n            color: 0x55ff55,\n            size: 3.5, // Increased particle size\n            blending: THREE.AdditiveBlending,\n            transparent: true\n        });\n\n        this.exitPortalParticleSystem = new THREE.Points(particleGeometry, particleMaterial);\n        this.exitPortalGroup.add(this.exitPortalParticleSystem);\n\n        // Create text label for the portal - INCREASED SIZE\n        const canvas = document.createElement('canvas');\n        canvas.width = 1024; // Increased size\n        canvas.height = 256; // Increased size\n        const ctx = canvas.getContext('2d');\n        if (ctx) {\n            ctx.fillStyle = 'black';\n            ctx.fillRect(0, 0, canvas.width, canvas.height);\n            ctx.font = '72px Arial'; // Increased font size\n            ctx.fillStyle = '#00ff00';\n            ctx.textAlign = 'center';\n            ctx.textBaseline = 'middle';\n            ctx.fillText('VIBEVERSE PORTAL', canvas.width / 2, canvas.height / 2);\n        }\n\n        const texture = new THREE.CanvasTexture(canvas);\n        const labelGeometry = new THREE.PlaneGeometry(200, 50); // Increased size\n        const labelMaterial = new THREE.MeshBasicMaterial({\n            map: texture,\n            transparent: true,\n            side: THREE.DoubleSide\n        });\n\n        const label = new THREE.Mesh(labelGeometry, labelMaterial);\n        label.position.set(0, 200, 0); // Position above the portal (increased)\n        this.exitPortalGroup.add(label);\n\n        // Position the portal higher above the stargate and centered on y-axis\n        this.exitPortalGroup.position.set(0, 16000, 0); // Centered above stargate, bit higher than start portal\n        this.exitPortalGroup.rotation.x = Math.PI / 2; // Face straight down\n\n        // Add to scene\n        this.scene.add(this.exitPortalGroup);\n\n        // Create collision box\n        this.exitPortalBox = new THREE.Box3().setFromObject(this.exitPortalGroup);\n\n        console.log(\"Exit portal created at position:\", this.exitPortalGroup.position);\n    }\n\n    animateStartPortal(deltaTime: number): void {\n        if (!this.startPortalGroup || !this.startPortalParticleSystem || !this.startPortalBox) return;\n\n        // Rotate particle system\n        this.startPortalParticleSystem.rotation.z += deltaTime * 0.5;\n\n        // Update collision box (only periodically to save performance)\n        if (Math.random() < 0.05) {\n            this.startPortalBox.setFromObject(this.startPortalGroup);\n        }\n    }\n\n    animateExitPortal(deltaTime: number): void {\n        if (!this.exitPortalGroup || !this.exitPortalParticleSystem || !this.exitPortalBox) return;\n\n        // Rotate particle system\n        this.exitPortalParticleSystem.rotation.z += deltaTime * 0.5;\n\n        // Update collision box (only periodically to save performance)\n        if (Math.random() < 0.05) {\n            this.exitPortalBox.setFromObject(this.exitPortalGroup);\n        }\n    }\n\n    checkPortalInteractions(_deltaTime: number): void {\n        void _deltaTime;\n        if (!this.spaceship || !this.spaceship.mesh) return;\n\n        // Create a box for the spaceship (used for collision detection)\n        const shipBox = new THREE.Box3().setFromObject(this.spaceship.mesh);\n\n        // Check start portal interaction (if it exists)\n        if (this.startPortalGroup && this.startPortalBox) {\n            const distance = this.spaceship.mesh.position.distanceTo(this.startPortalGroup.position);\n\n            // If player is close to the start portal - INCREASED DETECTION RANGE\n            if (distance < 400) { // Increased from 200 to match much larger portal size\n                // Check for collision\n                if (shipBox.intersectsBox(this.startPortalBox)) {\n                    this.handleStartPortalEntry();\n                }\n            }\n        }\n\n        // Exit portal interaction removed\n    }\n\n    handleStartPortalEntry(): void {\n        // Prevent multiple redirects\n        if (this._isRedirecting) return;\n        this._isRedirecting = true;\n\n        console.log(\"Player entered start portal\");\n\n        // Get the reference URL from the query parameter\n        let targetUrl = this.refUrl;\n\n        // Make sure the URL has the https:// prefix\n        if (targetUrl && !targetUrl.startsWith('http')) {\n            targetUrl = 'https://' + targetUrl;\n        }\n\n        // If no target URL, do nothing\n        if (!targetUrl) {\n            console.error(\"No target URL specified for portal\");\n            this._isRedirecting = false;\n            return;\n        }\n\n        // Parse current URL parameters (excluding 'ref')\n        const currentParams = new URLSearchParams((window as any).location?.search || '');\n        currentParams.delete('ref');\n        currentParams.delete('portal');\n\n        // Create a URL object for the target\n        let finalUrl: URL;\n        try {\n            finalUrl = new URL(targetUrl);\n\n            // Append any other current parameters to the target URL\n            for (const [key, value] of currentParams.entries()) {\n                finalUrl.searchParams.append(key, value);\n            }\n        } catch (e) {\n            console.error(\"Invalid target URL:\", targetUrl);\n            this._isRedirecting = false;\n            return;\n        }\n\n        console.log(\"Redirecting to:\", finalUrl.toString());\n\n        // Short delay before redirecting\n        setTimeout(() => {\n            (window as any).location.href = finalUrl.toString();\n        }, 100);\n    }\n\n    handleExitPortalEntry(): void {\n        // Prevent multiple redirects\n        if (this._isRedirecting) return;\n        this._isRedirecting = true;\n\n        console.log(\"Player entered exit portal\");\n\n        // Construct next page URL\n        const nextPage = 'https://portal.pieter.com';\n\n        // Get current parameters\n        const currentParams = new URLSearchParams((window as any).location?.search || '');\n\n        // Create URL object\n        const url = new URL(nextPage);\n\n        // Add required parameters\n        url.searchParams.append('portal', 'true');\n        url.searchParams.append('username', this.getUsername());\n        url.searchParams.append('color', 'white'); // Default color\n        url.searchParams.append('speed', this.getPlayerSpeed());\n\n        // Copy other parameters from current URL\n        for (const [key, value] of currentParams.entries()) {\n            if (!['portal', 'username', 'color', 'speed'].includes(key)) {\n                url.searchParams.append(key, value);\n            }\n        }\n\n        console.log(\"Redirecting to:\", url.toString());\n\n        // Short delay before redirecting\n        setTimeout(() => {\n            (window as any).location.href = url.toString();\n        }, 100);\n    }\n\n    getUsername(): string {\n        // Get username from game state if available\n        const game = (window as any).game as GameGlobal | undefined;\n        if (game && game.selfUsername) {\n            return game.selfUsername;\n        }\n\n        // Fallback: generate a random username\n        return `Miner${Math.floor(Math.random() * 10000)}`;\n    }\n\n    getPlayerSpeed(): string {\n        // Get current speed from game state if available\n        const game = (window as any).game as GameGlobal | undefined;\n        if (game && game.currentSpeed) {\n            return game.currentSpeed.toString();\n        }\n\n        // Try to get speed from spaceship if available\n        if (this.spaceship && this.spaceship.velocity) {\n            return this.spaceship.velocity.length().toString();\n        }\n\n        // Fallback: default speed\n        return '10';\n    }\n\n    update(deltaTime: number): void {\n        // Animate start portal only (if it exists)\n        this.animateStartPortal(deltaTime);\n\n        // Check for portal interactions\n        this.checkPortalInteractions(deltaTime);\n    }\n\n    dispose(): void {\n        // Clean up resources\n        if (this.startPortalGroup) {\n            this.scene.remove(this.startPortalGroup);\n        }\n\n        if (this.exitPortalGroup) {\n            this.scene.remove(this.exitPortalGroup);\n        }\n\n        // Clear references\n        this.startPortalGroup = null;\n        this.exitPortalGroup = null;\n        this.startPortalBox = null;\n        this.exitPortalBox = null;\n        this.startPortalParticleSystem = null;\n        this.exitPortalParticleSystem = null;\n    }\n}\n"],"names":["VibeVersePortals","scene","spaceship","__publicField","search","_a","THREE.Group","ringGeometry","THREE.TorusGeometry","ringMaterial","THREE.MeshStandardMaterial","ring","THREE.Mesh","surfaceGeometry","THREE.CircleGeometry","surfaceMaterial","THREE.MeshBasicMaterial","THREE.DoubleSide","surface","particleCount","particleGeometry","THREE.BufferGeometry","positions","i","angle","radius","THREE.BufferAttribute","particleMaterial","THREE.PointsMaterial","THREE.AdditiveBlending","THREE.Points","THREE.Box3","canvas","ctx","texture","THREE.CanvasTexture","labelGeometry","THREE.PlaneGeometry","labelMaterial","label","deltaTime","_deltaTime","shipBox","targetUrl","currentParams","finalUrl","key","value","nextPage","url","game"],"mappings":"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"}