var u=Object.defineProperty;var p=(o,e,t)=>e in o?u(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var r=(o,e,t)=>p(o,typeof e!="symbol"?e+"":e,t);import{c as m}from"./game-core-OtPnLuF2.js";import{P as y,ak as f}from"./three-DBvJLP14.js";class S{constructor(e){r(this,"isMobile");this.isMobile=e}createSettingsContainer(){const e=document.createElement("div");return e.id="settings-container",e.style.position="absolute",e.style.top="50%",e.style.left="50%",e.style.transform="translate(-50%, -50%)",this.isMobile?(e.style.width="95%",e.style.maxWidth="600px",e.style.height="90vh"):(e.style.width="700px",e.style.maxHeight="90vh"),e.style.overflowY="auto",e.style.backgroundColor="rgba(20, 30, 50, 0.9)",e.style.color="#fff",e.style.padding=this.isMobile?"20px":"30px",e.style.borderRadius="15px",e.style.border="2px solid #33aaff",e.style.boxShadow="0 0 30px #33aaff",e.style.fontFamily="Courier New, monospace",e.style.zIndex="1000",e.style.display="none",this.isMobile&&(e.style.webkitOverflowScrolling="touch",e.style.touchAction="pan-y",e.style.overscrollBehavior="contain"),e}getSettingsRowStyle(){return`display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; flex-direction: ${this.isMobile?"column":"row"}; align-items: ${this.isMobile?"flex-start":"center"};`}getSettingLabelStyle(){return`margin-bottom: ${this.isMobile?"8px":"0"}; ${this.isMobile?"width: 100%":""}`}getSettingControlStyle(){return`${this.isMobile?"width: 100%":""}`}getToggleControlStyle(){return`${this.isMobile?"width: 100%; display: flex; justify-content: flex-end;":""}`}getLabelTextStyle(){return`font-weight: bold; font-size: ${this.isMobile?"15px":"inherit"};`}getDescriptionTextStyle(){return`margin: 5px 0 0 0; font-size: ${this.isMobile?"11px":"12px"}; color: #aaa;`}getSelectStyle(){return`background-color: #2a3a5a; color: white; border: 1px solid #33aaff; padding: ${this.isMobile?"10px":"8px"}; border-radius: 5px; width: ${this.isMobile?"100%":"auto"}; font-size: ${this.isMobile?"16px":"inherit"};`}getToggleStyle(){return`display: inline-block; position: relative; width: ${this.isMobile?"70px":"60px"}; height: ${this.isMobile?"34px":"30px"};`}getToggleInputStyle(){return"opacity: 0; width: 0; height: 0;"}getToggleSliderStyle(){return`position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #555; border-radius: ${this.isMobile?"17px":"15px"}; transition: .4s;`}getSectionHeaderStyle(){return`color: #33aaff; border-bottom: 1px solid #33aaff; padding-bottom: 10px; font-size: ${this.isMobile?"18px":"20px"};`}getMainTitleStyle(){return`text-align: center; color: #33aaff; margin-top: 0; font-size: ${this.isMobile?"24px":"28px"};`}getPresetContainerStyle(){return`display: flex; justify-content: space-between; margin-bottom: 20px; flex-direction: ${this.isMobile?"column":"row"}; gap: ${this.isMobile?"10px":"0"};`}getPresetButtonStyle(){return`flex: 1; margin-right: ${this.isMobile?"0":"10px"}; padding: ${this.isMobile?"15px":"10px"}; background-color: #2a3a5a; color: white; border: 1px solid #33aaff; border-radius: 5px; cursor: pointer; font-size: ${this.isMobile?"16px":"inherit"};`}getActionButtonsContainerStyle(){return`display: flex; justify-content: space-between; flex-direction: ${this.isMobile?"column":"row"}; gap: ${this.isMobile?"15px":"0"};`}getApplyButtonStyle(){return`flex: 1; margin-right: ${this.isMobile?"0":"10px"}; padding: ${this.isMobile?"20px":"15px"}; background-color: #33aaff; color: black; border: none; border-radius: 5px; cursor: pointer; font-family: 'Courier New', monospace; font-weight: bold; font-size: ${this.isMobile?"18px":"16px"};`}getBackButtonStyle(){return`flex: 1; padding: ${this.isMobile?"20px":"15px"}; background-color: #555; color: white; border: none; border-radius: 5px; cursor: pointer; font-family: 'Courier New', monospace; font-weight: bold; font-size: ${this.isMobile?"18px":"16px"};`}getNotificationStyle(){return{position:"fixed",top:this.isMobile?"25%":"20%",left:"50%",transform:"translate(-50%, -50%)",backgroundColor:"rgba(0, 0, 0, 0.8)",color:"#33aaff",padding:this.isMobile?"20px 40px":"15px 30px",borderRadius:"10px",fontFamily:"Courier New, monospace",fontSize:this.isMobile?"18px":"16px",zIndex:"9999",textAlign:"center"}}injectToggleCSS(){const e=document.createElement("style");e.textContent=`
            .slider:before {
                position: absolute;
                content: "";
                height: ${this.isMobile?"26px":"22px"};
                width: ${this.isMobile?"26px":"22px"};
                left: 4px;
                bottom: 4px;
                background-color: white;
                border-radius: 50%;
                transition: .4s;
            }
            
            input:checked + .slider {
                background-color: #33aaff;
            }
            
            input:checked + .slider:before {
                transform: translateX(${this.isMobile?"36px":"30px"});
            }
        `,document.head.appendChild(e)}createSettingRow(e,t,s){return`
            <div class="settings-row" style="${this.getSettingsRowStyle()}">
                <div style="${this.getSettingLabelStyle()}">
                    <label style="${this.getLabelTextStyle()}">${e}</label>
                    <p style="${this.getDescriptionTextStyle()}">${t}</p>
                </div>
                <div style="${this.getSettingControlStyle()}">
                    ${s}
                </div>
            </div>
        `}createToggleRow(e,t,s){const i=`
            <label class="toggle" style="${this.getToggleStyle()}">
                <input type="checkbox" id="${s}" style="${this.getToggleInputStyle()}">
                <span class="slider" style="${this.getToggleSliderStyle()}"></span>
            </label>
        `;return`
            <div class="settings-row" style="${this.getSettingsRowStyle()}">
                <div style="${this.getSettingLabelStyle()}">
                    <label style="${this.getLabelTextStyle()}">${e}</label>
                    <p style="${this.getDescriptionTextStyle()}">${t}</p>
                </div>
                <div style="${this.getToggleControlStyle()}">
                    ${i}
                </div>
            </div>
        `}createSelectRow(e,t,s,i){const a=i.map(h=>`<option value="${h.value}">${h.text}</option>`).join(""),n=`
            <select id="${s}" style="${this.getSelectStyle()}">
                ${a}
            </select>
        `;return this.createSettingRow(e,t,n)}}class b{constructor(e,t){r(this,"game");r(this,"styles");this.game=e,this.styles=t}createAudioSettingsHTML(){return`
            <div style="margin-bottom: 20px;">
                <h3 style="${this.styles.getSectionHeaderStyle()}">AUDIO SETTINGS</h3>
                
                ${this.styles.createToggleRow("Spatial Audio","3D positional sound effects","spatial-audio")}
            </div>
        `}applyAudioSettings(e){if(!this.game.audio)return;const t=this.game.audio;t.spatialAudio!==void 0&&(t.spatialAudio=e.spatialAudio)}updateAudioUI(e){const t=document.getElementById("spatial-audio");t&&(t.checked=e.spatialAudio)}readAudioSettings(){const e=document.getElementById("spatial-audio");return{spatialAudio:e?e.checked:!0}}applyAudioPreset(e,t){switch(e){case"performance":t.spatialAudio=!1;break;case"balanced":case"quality":t.spatialAudio=!0;break}return t}}class w{constructor(e,t){r(this,"game");r(this,"styles");this.game=e,this.styles=t}createGraphicsSettingsHTML(){return`
            <div style="margin-bottom: 20px;">
                <h3 style="${this.styles.getSectionHeaderStyle()}">GRAPHICS SETTINGS</h3>
                
                ${this.styles.createSelectRow("Graphical Quality","Affects overall visual fidelity and performance","graphical-quality",[{value:"low",text:"Low"},{value:"medium",text:"Medium"},{value:"high",text:"High"}])}
                
                ${this.styles.createToggleRow("Post-processing Effects","Bloom, anti-aliasing, and visual effects","post-processing")}
                
                ${this.styles.createToggleRow("Volumetric Light Rays","Enable sunlight rays effect","god-rays-enabled")}
                
                ${this.styles.createSelectRow("Light Ray Type","Choose light ray effect style","god-rays-type",[{value:"standard",text:"Standard God Rays"},{value:"claude",text:"Claude Rays"}])}
                
                ${this.styles.createSelectRow("Asteroid Detail","Affects asteroid count and model complexity","asteroid-detail",[{value:"low",text:"Low"},{value:"medium",text:"Medium"},{value:"high",text:"High"}])}
                
                ${this.styles.createSelectRow("Lighting Quality","Affects light sources and shadows","lighting-quality",[{value:"low",text:"Low"},{value:"medium",text:"Medium"},{value:"high",text:"High"}])}
                
                ${this.styles.createSelectRow("Particle Effects","Affects thruster, explosion, and other particle effects","particle-effects",[{value:"low",text:"Low"},{value:"medium",text:"Medium"},{value:"high",text:"High"}])}
                
                ${this.styles.createSelectRow("Resolution Scale","Adjusts rendering resolution","resolution-scale",[{value:"low",text:"Low (75%)"},{value:"medium",text:"Medium (100%)"},{value:"high",text:"High (125%)"}])}
            </div>
        `}applyGraphicsSettings(e){this.game&&(this.applyRendererSettings(e),this.applyEnvironmentSettings(e),console.log("Graphics settings applied successfully"))}applyRendererSettings(e){if(!this.game.renderer)return;const t=this.game.renderer;switch(e.graphicalQuality){case"low":t.renderer&&(t.renderer.antialias=!1),t.renderer&&t.renderer.shadowMap&&(t.renderer.shadowMap.enabled=!1);break;case"medium":t.renderer&&(t.renderer.antialias=!0),t.renderer&&t.renderer.shadowMap&&(t.renderer.shadowMap.enabled=!0,t.renderer.shadowMap.type=f);break;case"high":t.renderer&&(t.renderer.antialias=!0),t.renderer&&t.renderer.shadowMap&&(t.renderer.shadowMap.enabled=!0,t.renderer.shadowMap.type=y);break}if(t.composer&&(t.useBasicRendering=!e.postProcessing),t.setRayType){const s=e.godRaysType==="claude";t.setRayType(s)}if(t.setVolumetricLightEnabled&&(t.setVolumetricLightEnabled(e.godRaysEnabled),t.adjustLightingForRayType&&t.adjustLightingForRayType()),t.setVolumetricLightIntensity){let s;switch(e.graphicalQuality){case"low":s=.4;break;case"medium":s=.65;break;case"high":s=.85;break;default:s=.65}t.setVolumetricLightIntensity(s)}if(t.bloomPass)switch(e.graphicalQuality){case"low":t.adjustBloom(.4,.3,.9);break;case"medium":t.adjustBloom(.6,.4,.85);break;case"high":t.adjustBloom(.8,.5,.8);break}if(t.renderer){let s=window.devicePixelRatio||1;switch(e.resolutionScale){case"low":s*=.75;break;case"medium":break;case"high":s*=1.25;break}t.renderer.setPixelRatio(s),t.handleResize()}}applyEnvironmentSettings(e){if(!this.game.environment)return;const t=this.game.environment;if(t.asteroidBelt&&t.asteroidBelt.updateDensity)switch(e.asteroidDetail){case"low":t.asteroidBelt.updateDensity(.5);break;case"medium":t.asteroidBelt.updateDensity(1);break;case"high":t.asteroidBelt.updateDensity(1.5);break}}applyPhysicsSettings(e){if(this.game.physics){const t=this.game.physics;switch(e.asteroidDetail){case"low":t.collisionDistance=10;break;case"medium":t.collisionDistance=15;break;case"high":t.collisionDistance=20;break}}}updateGraphicsUI(e){const t={"graphical-quality":e.graphicalQuality,"post-processing":e.postProcessing,"asteroid-detail":e.asteroidDetail,"lighting-quality":e.lightingQuality,"particle-effects":e.particleEffects,"resolution-scale":e.resolutionScale,"god-rays-enabled":e.godRaysEnabled,"god-rays-type":e.godRaysType};for(const[s,i]of Object.entries(t)){const a=document.getElementById(s);a&&(a.type==="checkbox"?a.checked=i:a.value=i)}}readGraphicsSettings(){return{graphicalQuality:this.getElementValue("graphical-quality","medium"),postProcessing:this.getElementChecked("post-processing",!0),asteroidDetail:this.getElementValue("asteroid-detail","medium"),lightingQuality:this.getElementValue("lighting-quality","medium"),particleEffects:this.getElementValue("particle-effects","medium"),resolutionScale:this.getElementValue("resolution-scale","medium"),godRaysEnabled:this.getElementChecked("god-rays-enabled",!1),godRaysType:this.getElementValue("god-rays-type","standard")}}getElementValue(e,t){const s=document.getElementById(e);return s?s.value:t}getElementChecked(e,t){const s=document.getElementById(e);return s?s.checked:t}applyGraphicsPreset(e,t){switch(e){case"performance":t.graphicalQuality="low",t.postProcessing=!1,t.asteroidDetail="low",t.lightingQuality="low",t.particleEffects="low",t.resolutionScale="low",t.godRaysEnabled=!1;break;case"balanced":t.graphicalQuality="medium",t.postProcessing=!0,t.asteroidDetail="medium",t.lightingQuality="medium",t.particleEffects="medium",t.resolutionScale="medium",t.godRaysEnabled=!0,t.godRaysType="standard";break;case"quality":t.graphicalQuality="high",t.postProcessing=!0,t.asteroidDetail="high",t.lightingQuality="high",t.particleEffects="high",t.resolutionScale="high",t.godRaysEnabled=!0,t.godRaysType="claude";break}return t}}class R{constructor(e,t,s,i,a){r(this,"styles");r(this,"graphicsSettings");r(this,"audioSettings");r(this,"helpers");r(this,"persistence");r(this,"_isVisible",!1);this.styles=e,this.graphicsSettings=t,this.audioSettings=s,this.helpers=i,this.persistence=a}updateSettings(){console.warn("SettingsView: updateSettings not fully implemented yet.")}saveSettings(){console.warn("SettingsView: saveSettings not fully implemented yet.")}applyAllSettings(){console.warn("SettingsView: applyAllSettings not fully implemented yet.")}applyPreset(e){console.warn(`SettingsView: applyPreset('${e}') not fully implemented yet.`)}get isVisible(){return this._isVisible}createSettingsUI(){const e=this.styles.createSettingsContainer();return e.innerHTML=this.createSettingsHTML(),this.styles.injectToggleCSS(),document.body.appendChild(e),e}createSettingsHTML(){return`
            <h2 style="${this.styles.getMainTitleStyle()}">GAME SETTINGS</h2>
            
            ${this.graphicsSettings.createGraphicsSettingsHTML()}
            
            ${this.createPerformanceSettingsHTML()}
            
            ${this.audioSettings.createAudioSettingsHTML()}
            
            ${this.createPresetsHTML()}
            
            ${this.createActionButtonsHTML()}
        `}createPerformanceSettingsHTML(){return`
            <div style="margin-bottom: 20px;">
                <h3 style="${this.styles.getSectionHeaderStyle()}">PERFORMANCE SETTINGS</h3>
                
                ${this.styles.createSelectRow("Frame Rate Cap","Limits maximum frame rate","frame-rate-cap",[{value:"30",text:"30 FPS"},{value:"60",text:"60 FPS"},{value:"auto",text:"Monitor Refresh Rate (60Hz)"},{value:"0",text:"Unlimited"}])}
                
                ${this.styles.createToggleRow("Show FPS Counter","Display current frame rate","show-fps")}
                
                ${this.styles.createToggleRow("Auto-Adjust Quality","Automatically adjusts settings based on performance","auto-quality")}
            </div>
        `}createPresetsHTML(){return`
            <div style="margin-bottom: 20px;">
                <h3 style="${this.styles.getSectionHeaderStyle()}">PRESETS</h3>
                
                <div style="${this.styles.getPresetContainerStyle()}">
                    <button id="preset-performance" style="${this.styles.getPresetButtonStyle()}">
                        PERFORMANCE
                    </button>
                    <button id="preset-balanced" style="${this.styles.getPresetButtonStyle()}">
                        BALANCED
                    </button>
                    <button id="preset-quality" style="${this.styles.getPresetButtonStyle()}">
                        QUALITY
                    </button>
                </div>
            </div>
        `}createActionButtonsHTML(){return`
            <div style="${this.styles.getActionButtonsContainerStyle()}">
                <button id="apply-settings" style="${this.styles.getApplyButtonStyle()}">
                    APPLY
                </button>
                <button id="settings-back" style="${this.styles.getBackButtonStyle()}">
                    BACK
                </button>
            </div>
        `}show(){const e=document.getElementById("settings-container");return e?(e.style.display="block",this._isVisible=!0,!0):!1}hide(){const e=document.getElementById("settings-container");return e?(e.style.display="none",this._isVisible=!1,!0):!1}updateRefreshRateDisplay(e){const t=document.getElementById("frame-rate-cap");if(t){const s=t.querySelector('option[value="auto"]');s&&(s.textContent=`Monitor Refresh Rate (${e}Hz)`)}}showSettingsApplied(){const e=document.createElement("div"),t=this.styles.getNotificationStyle();Object.assign(e.style,t),e.textContent="Settings applied and saved",document.body.appendChild(e),setTimeout(()=>{e.style.opacity="0",e.style.transition="opacity 0.5s",setTimeout(()=>{e.remove()},500)},1500)}}class x{constructor(){r(this,"storageKey");this.storageKey="asteroidMinerSettings"}getDefaultSettings(){return{graphicalQuality:"medium",postProcessing:!0,asteroidDetail:"medium",lightingQuality:"medium",particleEffects:"medium",resolutionScale:"medium",frameRateCap:"auto",showFPS:!1,spatialAudio:!0,autoQuality:!0,godRaysEnabled:!1,godRaysType:"standard"}}loadSettings(){try{const e=localStorage.getItem(this.storageKey);if(e){const t=JSON.parse(e),i={...this.getDefaultSettings(),...t};return console.log("Settings loaded from localStorage:",i),i}}catch(e){console.error("Error loading settings:",e)}return this.getDefaultSettings()}saveSettings(e){try{return localStorage.setItem(this.storageKey,JSON.stringify(e)),console.log("Settings saved to localStorage"),!0}catch(t){return console.error("Error saving settings:",t),!1}}validateSettings(e){const t=this.getDefaultSettings(),s={...t};for(const i in t)Object.prototype.hasOwnProperty.call(e,i)&&(s[i]=e[i]);return s}clearSettings(){try{return localStorage.removeItem(this.storageKey),console.log("Settings cleared from localStorage"),!0}catch(e){return console.error("Error clearing settings:",e),!1}}exportSettings(e){try{return JSON.stringify(e,null,2)}catch(t){return console.error("Error exporting settings:",t),null}}importSettings(e){try{const t=JSON.parse(e);return this.validateSettings(t)}catch(t){return console.error("Error importing settings:",t),null}}backupSettings(e){const t=new Date().toISOString(),s=`${this.storageKey}_backup_${t}`;try{return localStorage.setItem(s,JSON.stringify({timestamp:t,settings:e})),console.log(`Settings backed up with key: ${s}`),s}catch(i){return console.error("Error backing up settings:",i),null}}listBackups(){const e=[],t=`${this.storageKey}_backup_`;try{for(let s=0;s<localStorage.length;s++){const i=localStorage.key(s);if(i&&i.startsWith(t)){const a=JSON.parse(localStorage.getItem(i)||"{}");e.push({key:i,timestamp:a.timestamp,date:new Date(a.timestamp)})}}return e.sort((s,i)=>i.date.getTime()-s.date.getTime()),e}catch(s){return console.error("Error listing backups:",s),[]}}restoreFromBackup(e){try{const t=localStorage.getItem(e);if(t){const s=JSON.parse(t);return this.validateSettings(s.settings)}}catch(t){console.error("Error restoring from backup:",t)}return null}cleanupBackups(e=5){const t=this.listBackups();for(let s=e;s<t.length;s++)try{localStorage.removeItem(t[s].key),console.log(`Removed old backup: ${t[s].key}`)}catch(i){console.error(`Error removing backup ${t[s].key}:`,i)}}}class v{constructor(e,t){r(this,"settings");r(this,"isMobile");this.settings=e,this.isMobile=t}setupEventListeners(){this.setupBackButton(),this.setupApplyButton(),this.setupPresetButtons()}setupBackButton(){const e=document.getElementById("settings-back");e&&(e.addEventListener("click",()=>{this.settings.hide()}),this.isMobile&&e.addEventListener("touchend",t=>{t.preventDefault(),this.settings.hide()}))}setupApplyButton(){const e=document.getElementById("apply-settings");if(e){const t=()=>{this.settings.updateSettings(),this.settings.saveSettings(),this.settings.applyAllSettings(),this.settings.showSettingsApplied()};e.addEventListener("click",t),this.isMobile&&e.addEventListener("touchend",s=>{s.preventDefault(),t()})}}setupPresetButtons(){this.setupPresetButton("preset-performance","performance"),this.setupPresetButton("preset-balanced","balanced"),this.setupPresetButton("preset-quality","quality")}setupPresetButton(e,t){const s=document.getElementById(e);if(!s)return;const i=()=>{this.settings.applyPreset(t)};s.addEventListener("click",i),this.isMobile&&s.addEventListener("touchend",a=>{a.preventDefault(),i()}),this.setupButtonEffects(s)}setupButtonEffects(e){this.isMobile?(e.addEventListener("touchstart",()=>{e.style.backgroundColor="#3a4b6a",e.style.boxShadow="0 0 10px #33aaff"},{passive:!0}),e.addEventListener("touchend",()=>{e.style.backgroundColor="#2a3a5a",e.style.boxShadow="none"},{passive:!0})):(e.addEventListener("mouseover",()=>{e.style.backgroundColor="#3a4b6a",e.style.boxShadow="0 0 10px #33aaff"}),e.addEventListener("mouseout",()=>{e.style.backgroundColor="#2a3a5a",e.style.boxShadow="none"}))}setupKeyboardNavigation(){document.addEventListener("keydown",e=>{if(e.key==="Escape"&&this.settings.isVisible&&(this.settings.hide(),e.preventDefault()),e.key==="Enter"&&this.settings.isVisible&&e.ctrlKey){const t=document.getElementById("apply-settings");t&&(t.click(),e.preventDefault())}})}removeEventListeners(){["settings-back","apply-settings","preset-performance","preset-balanced","preset-quality"].forEach(t=>{var i;const s=document.getElementById(t);if(s){const a=s.cloneNode(!0);(i=s.parentNode)==null||i.replaceChild(a,s)}})}validateSettingsForm(){return!0}setupRealTimeUpdates(){["graphical-quality","post-processing","asteroid-detail","lighting-quality","particle-effects","resolution-scale","frame-rate-cap","show-fps","spatial-audio","auto-quality","god-rays-enabled","god-rays-type"].forEach(t=>{const s=document.getElementById(t);s&&s.addEventListener("change",()=>{})})}}class E{constructor(){r(this,"monitorRefreshRate");r(this,"updateRefreshRateCallback");this.monitorRefreshRate=60}detectSystemCapabilities(){const e={};e.highDPI=window.devicePixelRatio>1;const s=document.createElement("canvas").getContext("webgl2");if(e.webgl2=!!s,s){const i=s.getExtension("WEBGL_debug_renderer_info");i&&(e.gpu=s.getParameter(i.UNMASKED_RENDERER_WEBGL))}return e.modernBrowser="IntersectionObserver"in window&&"requestAnimationFrame"in window&&"localStorage"in window,e.webgl2&&e.highDPI&&e.modernBrowser?"high":e.webgl2&&e.modernBrowser?"medium":"low"}detectMonitorRefreshRate(){this.monitorRefreshRate=60;try{if("getScreenDetails"in window&&window.getScreenDetails&&window.getScreenDetails().then(t=>{var s;t&&t.currentScreen&&t.currentScreen.refreshRate&&(this.monitorRefreshRate=Math.round(t.currentScreen.refreshRate),console.log(`Using getScreenDetails API: ${this.monitorRefreshRate}Hz`),(s=this.updateRefreshRateCallback)==null||s.call(this))}).catch(t=>{console.log("getScreenDetails not available, falling back to other methods")}),window.screen&&typeof window.screen.refresh=="number"&&window.screen.refresh>0){this.monitorRefreshRate=Math.round(window.screen.refresh),console.log(`Using screen.refresh value: ${this.monitorRefreshRate}Hz`);return}const e=this.quickRefreshRateMeasure();e>0&&(this.monitorRefreshRate=e,console.log(`Quick measure refresh rate: ${this.monitorRefreshRate}Hz`)),this.startAccurateRefreshDetection()}catch(e){console.warn("Error detecting refresh rate:",e)}}quickRefreshRateMeasure(){if(window.screen&&typeof window.screen.refresh=="number"&&window.screen.refresh>0)return Math.round(window.screen.refresh);const e=navigator.userAgent.toLowerCase(),t=e.includes("gaming")||e.includes("rog"),s=window.screen&&window.screen.width>2560;return/Mobi|Android/i.test(navigator.userAgent)?60:t||s?144:60}startAccurateRefreshDetection(){let e=5,t=0;const s=[],i=performance.now(),a=n=>{if(t++,t<=e){requestAnimationFrame(a);return}s.push(n),s.length<120&&performance.now()-i<1e3?requestAnimationFrame(a):this.processRefreshRateSamples(s)};requestAnimationFrame(a)}processRefreshRateSamples(e){var h;if(e.length<2)return;const t=[];for(let l=1;l<e.length;l++){const c=e[l]-e[l-1];c>0&&t.push(1e3/c)}if(t.length===0)return;t.sort((l,c)=>l-c);const s=t[Math.floor(t.length*.25)],i=t[Math.floor(t.length*.75)],a=i-s,n=t.filter(l=>l>=s-1.5*a&&l<=i+1.5*a);if(n.length>0){const l=n.reduce((d,g)=>d+g,0)/n.length,c=this.roundToCommonRefreshRate(l);Math.abs(c-this.monitorRefreshRate)>=5&&(console.log(`Refined refresh rate: ${this.monitorRefreshRate}Hz -> ${c}Hz`),this.monitorRefreshRate=c,(h=this.updateRefreshRateCallback)==null||h.call(this))}}roundToCommonRefreshRate(e){const t=[24,30,48,50,60,72,75,90,100,120,144,165,180,240,360,480];let s=60,i=Math.abs(e-60);for(const a of t){const n=Math.abs(e-a);n<i&&(i=n,s=a)}return i/s<.1?s:Math.round(e)}getMonitorRefreshRate(){return this.monitorRefreshRate}setRefreshRateUpdateCallback(e){this.updateRefreshRateCallback=e}validateSettings(e){const t={graphicalQuality:["low","medium","high"],asteroidDetail:["low","medium","high"],lightingQuality:["low","medium","high"],particleEffects:["low","medium","high"],resolutionScale:["low","medium","high"],frameRateCap:["30","60","auto","0"],godRaysType:["standard","claude"]},s=[];for(const[a,n]of Object.entries(t))e[a]&&!n.includes(e[a])&&s.push(`Invalid value for ${a}: ${e[a]}`);return["postProcessing","showFPS","spatialAudio","autoQuality","godRaysEnabled"].forEach(a=>{e[a]!==void 0&&typeof e[a]!="boolean"&&s.push(`Invalid value for ${a}: must be boolean`)}),{isValid:s.length===0,errors:s}}getPerformanceRecommendation(){const e=this.detectSystemCapabilities(),t={low:{graphicalQuality:"low",postProcessing:!1,asteroidDetail:"low",lightingQuality:"low",particleEffects:"low",resolutionScale:"low",frameRateCap:"30",godRaysEnabled:!1},medium:{graphicalQuality:"medium",postProcessing:!0,asteroidDetail:"medium",lightingQuality:"medium",particleEffects:"medium",resolutionScale:"medium",frameRateCap:"60",godRaysEnabled:!0,godRaysType:"standard"},high:{graphicalQuality:"high",postProcessing:!0,asteroidDetail:"high",lightingQuality:"high",particleEffects:"high",resolutionScale:"high",frameRateCap:"auto",godRaysEnabled:!0,godRaysType:"claude"}};return t[e]||t.medium}formatSettingsForDisplay(e){const t={};for(const[s,i]of Object.entries(e))typeof i=="boolean"?t[s]=i?"Enabled":"Disabled":s==="frameRateCap"?i==="0"?t[s]="Unlimited":i==="auto"?t[s]=`Monitor Refresh Rate (${this.monitorRefreshRate}Hz)`:t[s]=`${i} FPS`:t[s]=i.charAt(0).toUpperCase()+i.slice(1);return t}calculatePerformanceImpact(e){let t=0;const s={low:1,medium:2,high:3};return t+=s[e.graphicalQuality]||2,t+=s[e.asteroidDetail]||2,t+=s[e.lightingQuality]||2,t+=s[e.particleEffects]||2,t+=s[e.resolutionScale]||2,e.postProcessing&&(t+=1),e.godRaysEnabled&&(t+=2),Math.round(t/17*100)}}class C{constructor(e){r(this,"game");r(this,"stargateInterface");r(this,"isVisible");r(this,"isMobile");r(this,"styles");r(this,"helpers");r(this,"persistence");r(this,"graphicsSettings");r(this,"audioSettings");r(this,"settingsView");r(this,"eventHandlers");r(this,"settings");this.game=e,this.stargateInterface=null,this.isVisible=!1,this.isMobile=m.isMobile(),console.log("Settings constructor - isMobile:",this.isMobile),this.styles=new S(this.isMobile),this.helpers=new E,this.persistence=new x,this.graphicsSettings=new w(this.game,this.styles),this.audioSettings=new b(this.game,this.styles),this.settingsView=new R(this.styles,this.graphicsSettings,this.audioSettings,this.helpers,this.persistence),this.eventHandlers=new v(this,this.isMobile),this.helpers.setRefreshRateUpdateCallback(()=>{this.settingsView.updateRefreshRateDisplay(this.helpers.getMonitorRefreshRate())}),this.helpers.detectMonitorRefreshRate(),this.settings=this.persistence.loadSettings(),this.setupSettingsUI(),this.applyAllSettings(),setTimeout(()=>this.applyUISettings(),100)}setStargateInterface(e){this.stargateInterface=e}loadSettings(){this.settings=this.persistence.loadSettings()}saveSettings(){this.persistence.saveSettings(this.settings)}setupSettingsUI(){this.settingsView.createSettingsUI(),this.eventHandlers.setupEventListeners()}updateSettings(){const e=this.graphicsSettings.readGraphicsSettings();Object.assign(this.settings,e);const t=this.audioSettings.readAudioSettings();Object.assign(this.settings,t);const s=document.getElementById("frame-rate-cap"),i=document.getElementById("show-fps"),a=document.getElementById("auto-quality");s&&(this.settings.frameRateCap=s.value),i&&(this.settings.showFPS=i.checked),a&&(this.settings.autoQuality=a.checked)}updateUI(){this.graphicsSettings.updateGraphicsUI(this.settings),this.audioSettings.updateAudioUI(this.settings);const e=document.getElementById("frame-rate-cap"),t=document.getElementById("show-fps"),s=document.getElementById("auto-quality");e&&(e.value=this.settings.frameRateCap),t&&(t.checked=this.settings.showFPS),s&&(s.checked=this.settings.autoQuality)}applyPreset(e){switch(console.log(`Applying ${e} preset`),this.settings=this.graphicsSettings.applyGraphicsPreset(e,this.settings),this.settings=this.audioSettings.applyAudioPreset(e,this.settings),e){case"performance":this.settings.frameRateCap="60";break;case"balanced":this.settings.frameRateCap="auto";break;case"quality":this.settings.frameRateCap="0";break}this.updateUI(),this.showSettingsApplied()}applyAllSettings(){this.game&&(this.graphicsSettings.applyGraphicsSettings(this.settings),this.graphicsSettings.applyPhysicsSettings(this.settings),this.audioSettings.applyAudioSettings(this.settings),this.applyUISettings(),console.log("All settings applied successfully"))}applyGraphicsSettings(){this.game&&(this.graphicsSettings.applyGraphicsSettings(this.settings),console.log("Graphics settings applied successfully"))}applyUISettings(){const e=document.getElementById("fps-display");if(e?this.settings.showFPS?(e.style.display="block",this.game&&this.game.currentFPS&&(e.textContent=`FPS: ${Math.round(this.game.currentFPS)}`)):e.style.display="none":console.warn("FPS display element not found in HUD. It should have ID 'fps-display'"),this.game){const t=this.game.frameRateCap,s=this.helpers.getMonitorRefreshRate();this.settings.frameRateCap==="auto"?s>65?(this.game.frameRateCap=0,console.log(`Using unlimited frame rate (refresh rate ${s}Hz > 65Hz)`)):(this.game.frameRateCap=s,console.log(`Setting frame rate cap to monitor refresh rate: ${s}Hz`)):this.game.frameRateCap=parseInt(this.settings.frameRateCap)||0,(t===0&&this.game.frameRateCap>0||t>0&&this.game.frameRateCap===0)&&(this.game.lastFrameTime=0),console.log(`Frame rate cap changed from ${t} to ${this.game.frameRateCap}`)}}showSettingsApplied(){this.settingsView.showSettingsApplied()}show(){this.updateUI(),this.settingsView.show()&&(this.isVisible=!0)}hide(){this.settingsView.hide()&&(this.isVisible=!1,this.stargateInterface&&this.stargateInterface.showStargateUI())}toggle(){this.isVisible?this.hide():this.show()}}export{C as Settings};
//# sourceMappingURL=settings-BHCPrtiN.js.map
