var h=Object.defineProperty;var c=(o,i,t)=>i in o?h(o,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[i]=t;var s=(o,i,t)=>c(o,typeof i!="symbol"?i+"":i,t);import{K as m,y as p,z as y,o as u,J as T}from"./three-DBvJLP14.js";class f{constructor(i,t){s(this,"scene");s(this,"camera");s(this,"isTransitioning");s(this,"transitionDuration");s(this,"onTransitionComplete");s(this,"warpTunnel");s(this,"originalPositions");s(this,"overlay");s(this,"initialCameraPosition");s(this,"initialCameraRotation");s(this,"startTime");this.scene=i,this.camera=t,this.isTransitioning=!1,this.transitionDuration=3e3,this.onTransitionComplete=null,this.startTime=0,this.setupTransitionElements()}setupTransitionElements(){this.warpTunnel=new m(new p,new y({color:3198928,size:2,blending:u,transparent:!0,sizeAttenuation:!0})),this.createWarpParticles(),this.createOverlay()}createWarpParticles(){const t=new Float32Array(6e3);for(let n=0;n<2e3;n++){const e=n*3,a=50+Math.random()*50,r=Math.random()*Math.PI*2,l=-500-Math.random()*3e3;t[e]=a*Math.cos(r),t[e+1]=a*Math.sin(r),t[e+2]=l}this.warpTunnel.geometry.setAttribute("position",new T(t,3)),this.originalPositions=new Float32Array(t)}createOverlay(){this.overlay=document.createElement("div"),this.overlay.id="warp-overlay",this.overlay.style.position="fixed",this.overlay.style.top="0",this.overlay.style.left="0",this.overlay.style.width="100%",this.overlay.style.height="100%",this.overlay.style.backgroundColor="#30cfd0",this.overlay.style.opacity="0",this.overlay.style.transition="opacity 0.5s",this.overlay.style.pointerEvents="none",this.overlay.style.zIndex="9999",document.body.appendChild(this.overlay)}startTransition(i){this.isTransitioning||(console.log("Starting system transition..."),this.isTransitioning=!0,this.onTransitionComplete=i||null,this.scene.add(this.warpTunnel),this.initialCameraPosition=this.camera.position.clone(),this.initialCameraRotation=this.camera.rotation.clone(),this.startTime=Date.now(),this.showOverlay(),this.animate())}animate(){if(!this.isTransitioning)return;const t=Date.now()-this.startTime,n=Math.min(t/this.transitionDuration,1);if(this.updateWarpEffect(n),n>=1){this.completeTransition();return}requestAnimationFrame(this.animate.bind(this))}updateWarpEffect(i){const t=this.warpTunnel.geometry.attributes.position.array,n=3+i*20;for(let e=0;e<t.length;e+=3)t[e+2]+=n,t[e+2]>100&&(t[e]=this.originalPositions[e],t[e+1]=this.originalPositions[e+1],t[e+2]=this.originalPositions[e+2]-500);this.warpTunnel.geometry.attributes.position.needsUpdate=!0,this.camera&&(this.camera.rotation.z+=5e-4*Math.sin(i*Math.PI))}showOverlay(){this.overlay&&(this.overlay.style.opacity="0.2",setTimeout(()=>{this.overlay.style.opacity="1",setTimeout(()=>{this.overlay.style.opacity="0"},500)},this.transitionDuration-1e3))}completeTransition(){console.log("System transition complete"),this.isTransitioning=!1,this.scene.remove(this.warpTunnel),this.camera&&this.initialCameraPosition&&this.initialCameraRotation&&(this.camera.position.copy(this.initialCameraPosition),this.camera.rotation.copy(this.initialCameraRotation)),this.onTransitionComplete&&typeof this.onTransitionComplete=="function"&&setTimeout(()=>{console.log("Executing transition completion callback"),this.onTransitionComplete&&this.onTransitionComplete()},100)}}export{f as SystemTransition};
//# sourceMappingURL=systemTransition-C90waWqc.js.map
